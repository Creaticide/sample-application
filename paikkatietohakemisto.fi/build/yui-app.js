/* This is a packed Oskari app (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
/* This is a packed Oskari bundle (bundle script version Fri Feb 10 2012 09:27:05 GMT+0200 (Suomen normaaliaika)) */ 
Proj4js={defaultDatum:"WGS84",transform:function(e,b,a){if(!e.readyToUse||!b.readyToUse){this.reportError("Proj4js initialization for "+e.srsCode+" not yet complete");return a}if((e.srsProjNumber=="900913"&&b.datumCode!="WGS84")||(b.srsProjNumber=="900913"&&e.datumCode!="WGS84")){var d=Proj4js.WGS84;this.transform(e,d,a);e=d}if(e.projName=="longlat"){a.x*=Proj4js.common.D2R;a.y*=Proj4js.common.D2R}else{if(e.to_meter){a.x*=e.to_meter;a.y*=e.to_meter}e.inverse(a)}if(e.from_greenwich){a.x+=e.from_greenwich}a=this.datum_transform(e.datum,b.datum,a);if(b.from_greenwich){a.x-=b.from_greenwich}if(b.projName=="longlat"){a.x*=Proj4js.common.R2D;a.y*=Proj4js.common.R2D}else{b.forward(a);if(b.to_meter){a.x/=b.to_meter;a.y/=b.to_meter}}return a},datum_transform:function(d,b,a){if(d.compare_datums(b)){return a}if(d.datum_type==Proj4js.common.PJD_NODATUM||b.datum_type==Proj4js.common.PJD_NODATUM){return a}if(d.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}if(b.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}if(d.es!=b.es||d.a!=b.a||d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM||b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM){d.geodetic_to_geocentric(a);if(d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM){d.geocentric_to_wgs84(a)}if(b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM){b.geocentric_from_wgs84(a)}b.geocentric_to_geodetic(a)}if(b.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}return a},reportError:function(a){},extend:function(a,e){a=a||{};if(e){for(var d in e){var b=e[d];if(b!==undefined){a[d]=b}}}return a},Class:function(){var b=function(){this.initialize.apply(this,arguments)};var a={};var e;for(var d=0;d<arguments.length;++d){if(typeof arguments[d]=="function"){e=arguments[d].prototype}else{e=arguments[d]}Proj4js.extend(a,e)}b.prototype=a;return b},bind:function(d,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var e=a.concat(Array.prototype.slice.apply(arguments,[0]));return d.apply(b,e)}},scriptName:"proj4js-compressed.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath}var f=this.scriptName;var e=f.length;var a=document.getElementsByTagName("script");for(var d=0;d<a.length;d++){var g=a[d].getAttribute("src");if(g){var b=g.lastIndexOf(f);if((b>-1)&&(b+e==g.length)){this.libPath=g.slice(0,-e);break}}}return this.libPath||""},loadScript:function(e,f,d,a){var b=document.createElement("script");b.defer=false;b.type="text/javascript";b.id=e;b.src=e;b.onload=f;b.onerror=d;b.loadCheck=a;if(/MSIE/.test(navigator.userAgent)){b.onreadystatechange=this.checkReadyState}document.getElementsByTagName("head")[0].appendChild(b)},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror()}else{this.onload()}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,x0:0,y0:0,initialize:function(d){this.srsCodeInput=d;if(d.indexOf("urn:")==0){var a=d.split(":");if((a[1]=="ogc"||a[1]=="x-ogc")&&(a[2]=="def")&&(a[3]=="crs")){d=a[4]+":"+a[a.length-1]}}else{if(d.indexOf("http://")==0){var b=d.split("#");if(b[0].match(/epsg.org/)){d="EPSG:"+b[1]}else{if(b[0].match(/RIG.xml/)){d="IGNF:"+b[1]}}}}this.srsCode=d.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5)}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5)}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth="";this.srsProjNumber=this.srsCode}}}this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();
return}var a=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var a=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true}else{return false}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(b){if(Proj4js.Proj[b]){this.initTransforms();return}var a=Proj4js.getScriptLocation()+"projCode/"+b+".js";Proj4js.loadScript(a,Proj4js.bind(this.loadProjCodeSuccess,this,b),Proj4js.bind(this.loadProjCodeFailure,this,b),Proj4js.bind(this.checkCodeLoaded,this,b))},loadProjCodeSuccess:function(a){if(Proj4js.Proj[a].dependsOn){this.loadProjCode(Proj4js.Proj[a].dependsOn)}else{this.initTransforms()}},loadProjCodeFailure:function(a){Proj4js.reportError("failed to find projection file for: "+a)},checkCodeLoaded:function(a){if(Proj4js.Proj[a]){return true}else{return false}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,b;if(!this.defData){return}var a=this.defData.split("+");for(var f=0;f<a.length;f++){var d=a[f].split("=");e=d[0].toLowerCase();b=d[1];switch(e.replace(/\s/gi,"")){case"":break;case"title":this.title=b;break;case"proj":this.projName=b.replace(/\s/gi,"");break;case"units":this.units=b.replace(/\s/gi,"");break;case"datum":this.datumCode=b.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=b.replace(/\s/gi,"");break;case"ellps":this.ellps=b.replace(/\s/gi,"");break;case"a":this.a=parseFloat(b);break;case"b":this.b=parseFloat(b);break;case"rf":this.rf=parseFloat(b);break;case"lat_0":this.lat0=b*Proj4js.common.D2R;break;case"lat_1":this.lat1=b*Proj4js.common.D2R;break;case"lat_2":this.lat2=b*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=b*Proj4js.common.D2R;break;case"lon_0":this.long0=b*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(b)*Proj4js.common.D2R;break;case"lonc":this.longc=b*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(b);break;case"y_0":this.y0=parseFloat(b);break;case"k_0":this.k0=parseFloat(b);break;case"k":this.k0=parseFloat(b);break;case"r_a":this.R_A=true;break;case"zone":this.zone=parseInt(b);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=b.split(",");break;case"to_meter":this.to_meter=parseFloat(b);break;case"from_greenwich":this.from_greenwich=b*Proj4js.common.D2R;break;case"pm":b=b.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[b]?Proj4js.PrimeMeridian[b]:parseFloat(b);this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":break;default:}}this.deriveConstants()},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none"}if(this.datumCode&&this.datumCode!="none"){var a=Proj4js.Datum[this.datumCode];if(a){this.datum_params=a.towgs84?a.towgs84.split(","):null;this.ellps=a.ellipse;this.datumName=a.datumName?a.datumName:this.datumCode}}if(!this.a){var b=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,b)}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0){this.k0=1}this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(a){return a
},inverse:function(a){return a}};Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(d,b,e){var a=d*b;return e/(Math.sqrt(1-a*a))},tsfnz:function(f,e,d){var a=f*d;var b=0.5*f;a=Math.pow(((1-a)/(1+a)),b);return(Math.tan(0.5*(this.HALF_PI-e))/a)},phi2z:function(g,f){var e=0.5*g;var a,b;var d=this.HALF_PI-2*Math.atan(f);for(i=0;i<=15;i++){a=g*Math.sin(d);b=this.HALF_PI-2*Math.atan(f*(Math.pow(((1-a)/(1+a)),e)))-d;d+=b;if(Math.abs(b)<=1e-10){return d}}alert("phi2z has NoConvergence");return(-9999)},qsfnz:function(d,b){var a;if(d>1e-7){a=d*b;return((1-d*d)*(b/(1-a*a)-(0.5/d)*Math.log((1-a)/(1+a))))}else{return(2*b)}},asinz:function(a){if(Math.abs(a)>1){a=(a>1)?1:-1}return Math.asin(a)},e0fn:function(a){return(1-0.25*a*(1+a/16*(3+1.25*a)))},e1fn:function(a){return(0.375*a*(1+0.25*a*(1+0.46875*a)))},e2fn:function(a){return(0.05859375*a*a*(1+0.75*a))},e3fn:function(a){return(a*a*a*(35/3072))},mlfn:function(f,e,d,b,a){return(f*a-e*Math.sin(2*a)+d*Math.sin(4*a)-b*Math.sin(6*a))},srat:function(a,b){return(Math.pow((1-a)/(1+a),b))},sign:function(a){if(a<0){return(-1)}else{return(1)}},adjust_lon:function(a){a=(Math.abs(a)<this.PI)?a:(a-(this.sign(a)*this.TWO_PI));return a},adjust_lat:function(a){a=(Math.abs(a)<this.HALF_PI)?a:(a-(this.sign(a)*this.PI));return a},latiso:function(e,d,b){if(Math.abs(d)>this.HALF_PI){return +Number.NaN}if(d==this.HALF_PI){return Number.POSITIVE_INFINITY}if(d==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY}var a=e*b;return Math.log(Math.tan((this.HALF_PI+d)/2))+e*Math.log((1-a)/(1+a))/2},fL:function(b,a){return 2*Math.atan(b*Math.exp(a))-this.HALF_PI},invlatiso:function(f,d){var b=this.fL(1,d);var e=0;var a=0;do{e=b;a=f*Math.sin(e);b=this.fL(Math.exp(f*Math.log((1+a)/(1-a))/2),d)}while(Math.abs(b-e)>1e-12);return b},sinh:function(a){var b=Math.exp(a);b=(b-1/b)/2;return b},cosh:function(a){var b=Math.exp(a);b=(b+1/b)/2;return b},tanh:function(a){var b=Math.exp(a);b=(b-1/b)/(b+1/b);return b},asinh:function(a){var b=(a>=0?1:-1);return b*(Math.log(Math.abs(a)+Math.sqrt(a*a+1)))},acosh:function(a){return 2*Math.log(Math.sqrt((a+1)/2)+Math.sqrt((a-1)/2))},atanh:function(a){return Math.log((a-1)/(a+1))/2},gN:function(b,g,f){var d=g*f;return b/Math.sqrt(1-d*d)}};Proj4js.datum=Proj4js.Class({initialize:function(b){this.datum_type=Proj4js.common.PJD_WGS84;if(b.datumCode&&b.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM}if(b&&b.datum_params){for(var a=0;a<b.datum_params.length;a++){b.datum_params[a]=parseFloat(b.datum_params[a])}if(b.datum_params[0]!=0||b.datum_params[1]!=0||b.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM}if(b.datum_params.length>3){if(b.datum_params[3]!=0||b.datum_params[4]!=0||b.datum_params[5]!=0||b.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;b.datum_params[3]*=Proj4js.common.SEC_TO_RAD;b.datum_params[4]*=Proj4js.common.SEC_TO_RAD;b.datum_params[5]*=Proj4js.common.SEC_TO_RAD;b.datum_params[6]=(b.datum_params[6]/1000000)+1}}}if(b){this.a=b.a;this.b=b.b;this.es=b.es;
this.ep2=b.ep2;this.datum_params=b.datum_params}},compare_datums:function(a){if(this.datum_type!=a.datum_type){return false}else{if(this.a!=a.a||Math.abs(this.es-a.es)>5e-11){return false}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2])}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]&&this.datum_params[3]==a.datum_params[3]&&this.datum_params[4]==a.datum_params[4]&&this.datum_params[5]==a.datum_params[5]&&this.datum_params[6]==a.datum_params[6])}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(a.params,"snadgrids").s)==0}else{return true}}}}}},geodetic_to_geocentric:function(d){var q=d.x;var j=d.y;var e=d.z?d.z:0;var f;var b;var a;var m=0;var o;var l;var h;var g;if(j<-Proj4js.common.HALF_PI&&j>-1.001*Proj4js.common.HALF_PI){j=-Proj4js.common.HALF_PI}else{if(j>Proj4js.common.HALF_PI&&j<1.001*Proj4js.common.HALF_PI){j=Proj4js.common.HALF_PI}else{if((j<-Proj4js.common.HALF_PI)||(j>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+j);return null}}}if(q>Proj4js.common.PI){q-=(2*Proj4js.common.PI)}l=Math.sin(j);g=Math.cos(j);h=l*l;o=this.a/(Math.sqrt(1-this.es*h));f=(o+e)*g*Math.cos(q);b=(o+e)*g*Math.sin(q);a=((o*(1-this.es))+e)*l;d.x=f;d.y=b;d.z=a;return m},geocentric_to_geodetic:function(C){var H=1e-12;var D=(H*H);var g=30;var q;var j;var a;var u;var b;var r;var o;var G;var F;var m;var z;var w;var f;var E;var h=C.x;var e=C.y;var d=C.z?C.z:0;var l;var B;var v;f=false;q=Math.sqrt(h*h+e*e);j=Math.sqrt(h*h+e*e+d*d);if(q/this.a<H){f=true;l=0;if(j/this.a<H){B=Proj4js.common.HALF_PI;v=-this.b;return}}else{l=Math.atan2(e,h)}a=d/j;u=q/j;b=1/Math.sqrt(1-this.es*(2-this.es)*u*u);G=u*(1-this.es)*b;F=a*b;E=0;do{E++;o=this.a/Math.sqrt(1-this.es*F*F);v=q*G+d*F-o*(1-this.es*F*F);r=this.es*o/(o+v);b=1/Math.sqrt(1-r*(2-r)*u*u);m=u*(1-r)*b;z=a*b;w=z*G-m*F;G=m;F=z}while(w*w>D&&E<g);B=Math.atan(z/Math.abs(m));C.x=l;C.y=B;C.z=v;return C},geocentric_to_geodetic_noniter:function(B){var e=B.x;var d=B.y;var a=B.z?B.z:0;var h;var z;var q;var f;var u;var w;var r;var m;var j;var l;var E;var g;var D;var C;var v;var o;var b;e=parseFloat(e);d=parseFloat(d);a=parseFloat(a);b=false;if(e!=0){h=Math.atan2(d,e)}else{if(d>0){h=Proj4js.common.HALF_PI}else{if(d<0){h=-Proj4js.common.HALF_PI}else{b=true;h=0;if(a>0){z=Proj4js.common.HALF_PI}else{if(a<0){z=-Proj4js.common.HALF_PI}else{z=Proj4js.common.HALF_PI;q=-this.b;return}}}}}u=e*e+d*d;f=Math.sqrt(u);w=a*Proj4js.common.AD_C;m=Math.sqrt(w*w+u);l=w/m;g=f/m;E=l*l*l;r=a+this.b*this.ep2*E;o=f-this.a*this.es*g*g*g;j=Math.sqrt(r*r+o*o);D=r/j;C=o/j;v=this.a/Math.sqrt(1-this.es*D*D);if(C>=Proj4js.common.COS_67P5){q=f/C-v}else{if(C<=-Proj4js.common.COS_67P5){q=f/-C-v}else{q=a/D+v*(this.es-1)}}if(b==false){z=Math.atan(D/C)}B.x=h;B.y=z;B.z=q;return B},geocentric_to_wgs84:function(b){if(this.datum_type==Proj4js.common.PJD_3PARAM){b.x+=this.datum_params[0];b.y+=this.datum_params[1];b.z+=this.datum_params[2]}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var g=this.datum_params[0];var e=this.datum_params[1];var l=this.datum_params[2];var f=this.datum_params[3];var m=this.datum_params[4];var j=this.datum_params[5];var h=this.datum_params[6];var d=h*(b.x-j*b.y+m*b.z)+g;var a=h*(j*b.x+b.y-f*b.z)+e;var o=h*(-m*b.x+f*b.y+b.z)+l;b.x=d;b.y=a;b.z=o}}},geocentric_from_wgs84:function(d){if(this.datum_type==Proj4js.common.PJD_3PARAM){d.x-=this.datum_params[0];d.y-=this.datum_params[1];d.z-=this.datum_params[2]}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var h=this.datum_params[0];var e=this.datum_params[1];var m=this.datum_params[2];var g=this.datum_params[3];var o=this.datum_params[4];var l=this.datum_params[5];var j=this.datum_params[6];var f=(d.x-h)/j;var b=(d.y-e)/j;var a=(d.z-m)/j;d.x=f+l*b-o*a;d.y=-l*f+b+g*a;d.z=o*f-g*b+a}}}});Proj4js.Point=Proj4js.Class({initialize:function(a,e,d){if(typeof a=="object"){this.x=a[0];
this.y=a[1];this.z=a[2]||0}else{if(typeof a=="string"){var b=a.split(",");this.x=parseFloat(b[0]);this.y=parseFloat(b[1]);this.z=parseFloat(b[2])||0}else{this.x=a;this.y=e;this.z=d||0}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return("x="+this.x+",y="+this.y)},toShortString:function(){return(this.x+", "+this.y)}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};
Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1)}else{this.ns0=this.con}this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0},forward:function(f){var g=f.x;var e=f.y;this.sin_phi=Math.sin(e);this.cos_phi=Math.cos(e);var b=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);var j=this.a*Math.sqrt(this.c-this.ns0*b)/this.ns0;var d=this.ns0*Proj4js.common.adjust_lon(g-this.long0);var a=j*Math.sin(d)+this.x0;var h=this.rh-j*Math.cos(d)+this.y0;f.x=a;f.y=h;return f},inverse:function(f){var h,a,b,d,g,e;f.x-=this.x0;f.y=this.rh-f.y+this.y0;if(this.ns0>=0){h=Math.sqrt(f.x*f.x+f.y*f.y);b=1}else{h=-Math.sqrt(f.x*f.x+f.y*f.y);b=-1}d=0;if(h!=0){d=Math.atan2(b*f.x,b*f.y)}b=h*this.ns0/this.a;a=(this.c-b*b)/this.ns0;if(this.e3>=1e-10){b=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;if(Math.abs(Math.abs(b)-Math.abs(a))>1e-10){e=this.phi1z(this.e3,a)}else{if(a>=0){e=0.5*PI}else{e=-0.5*PI}}}else{e=this.phi1z(e3,a)}g=Proj4js.common.adjust_lon(d/this.ns0+this.long0);f.x=g;f.y=e;return f},phi1z:function(j,a){var b,d,e;var h=Proj4js.common.asinz(0.5*a);if(j<Proj4js.common.EPSLN){return h}var g=j*j;for(var f=1;f<=25;f++){sinphi=Math.sin(h);cosphi=Math.cos(h);b=j*sinphi;d=1-b*b;e=0.5*d*d/cosphi*(a/(1-g)-sinphi/d+0.5/j*Math.log((1-b)/(1+b)));h=h+e;if(Math.abs(e)<=1e-7){return h}}Proj4js.reportError("aea:phi1z:Convergence error");return null}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;if(!this.title){this.title="Oblique Stereographic Alternative"}},forward:function(a){a.x=Proj4js.common.adjust_lon(a.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[a]);sinc=Math.sin(a.y);cosc=Math.cos(a.y);cosl=Math.cos(a.x);k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);a.x=k*cosc*Math.sin(a.x);a.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);a.x=this.a*a.x+this.x0;a.y=this.a*a.y+this.y0;return a},inverse:function(b){var d,a;b.x=(b.x-this.x0)/this.a;b.y=(b.y-this.y0)/this.a;b.x/=this.k0;b.y/=this.k0;if((rho=Math.sqrt(b.x*b.x+b.y*b.y))){c=2*Math.atan2(rho,this.R2);sinc=Math.sin(c);cosc=Math.cos(c);a=Math.asin(cosc*this.sinc0+b.y*sinc*this.cosc0/rho);d=Math.atan2(b.x*sinc,rho*this.cosc0*cosc-b.y*this.sinc0*sinc)}else{a=this.phic0;d=0}b.x=d;b.y=a;Proj4js.Proj.gauss.inverse.apply(this,[b]);b.x=Proj4js.common.adjust_lon(b.x+this.long0);return b}};function phi4z(e,l,j,h,g,D,C,B,f){var m,z,v,w,r,q,p,o,d,u;f=D;for(u=1;u<=15;u++){m=Math.sin(f);tanphi=Math.tan(f);B=tanphi*Math.sqrt(1-e*m*m);z=Math.sin(2*f);w=l*f-j*z+h*Math.sin(4*f)-g*Math.sin(6*f);r=l-2*j*Math.cos(2*f)+4*h*Math.cos(4*f)-6*g*Math.cos(6*f);q=2*w+B*(w*w+C)-2*D*(B*w+1);p=e*z*(w*w+C-2*D*w)/(2*B);o=2*(D-w)*(B*r-2/z)-2*r;d=q/(p+o);f+=d;if(Math.abs(d)<=1e-10){return(f)}}Proj4js.reportError("phi4z: No convergence");return null}function e4fn(a){var b,d;b=1+a;d=1-a;return(Math.sqrt((Math.pow(b,b))*(Math.pow(d,d))))}Proj4js.Proj.poly={init:function(){var a;if(this.lat0=0){this.lat0=90}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var a,g;var j;var m;var f,h;var d;var q,o;var b=e.x;var l=e.y;f=Proj4js.common.adjust_lon(b-this.long0);if(Math.abs(l)<=1e-7){q=this.x0+this.a*f;o=this.y0-this.a*this.ml0}else{a=Math.sin(l);g=Math.cos(l);h=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,l);d=Proj4js.common.msfnz(this.e,a,g);f=a;q=this.x0+this.a*d*Math.sin(f)/a;o=this.y0+this.a*(h-this.ml0+d*(1-Math.cos(f))/a)}e.x=q;e.y=o;return e},inverse:function(d){var o,h;var g;var q;var l;var e,f;var m;var a,j;d.x-=this.x0;d.y-=this.y0;g=this.ml0+d.y/this.a;m=0;if(Math.abs(g)<=1e-7){a=d.x/this.a+this.long0;j=0}else{q=g*g+(d.x/this.a)*(d.x/this.a);m=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,q,l,j);if(m!=1){return(m)}a=Proj4js.common.adjust_lon((Proj4js.common.asinz(d.x*l/this.a)/Math.sin(j))+this.long0)}d.x=a;d.y=j;return d}};Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0}if(!this.y0){this.y0=0}if(!this.lat0){this.lat0=0}if(!this.long0){this.long0=0}},forward:function(e){var f=e.x;var d=e.y;var b=Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+this.a*b*Math.cos(this.lat0);var g=this.y0+this.a*d;this.t1=a;this.t2=Math.cos(this.lat0);e.x=a;e.y=g;return e},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var a=b.y/this.a;if(Math.abs(a)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError")}var d=Proj4js.common.adjust_lon(this.long0+b.x/(this.a*Math.cos(this.lat0)));b.x=d;b.y=a}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts)}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts))}}},forward:function(f){var g=f.x;var e=f.y;if(e*Proj4js.common.R2D>90&&e*Proj4js.common.R2D<-90&&g*Proj4js.common.R2D>180&&g*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+g+" : "+e);return null}var a,h;if(Math.abs(Math.abs(e)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");return null}else{if(this.sphere){a=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(g-this.long0);h=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*e))}else{var d=Math.sin(e);var b=Proj4js.common.tsfnz(this.e,e,d);a=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(g-this.long0);h=this.y0-this.a*this.k0*Math.log(b)}f.x=a;f.y=h;return f}},inverse:function(e){var a=e.x-this.x0;var g=e.y-this.y0;var f,d;if(this.sphere){d=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-g/this.a*this.k0))}else{var b=Math.exp(-g/(this.a*this.k0));d=Proj4js.common.phi2z(this.e,b);if(d==-9999){Proj4js.reportError("merc:inverse: lat = -9999");return null}}f=Proj4js.common.adjust_lon(this.long0+a/(this.a*this.k0));e.x=f;e.y=d;return e}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return}this.lat0=0;this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;this.x0=500000;this.y0=this.utmSouth?10000000:0;this.k0=0.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}};Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes")}this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);
if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)}else{this.ns=this.sinphi}}else{this.ns=this.sinphi}this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(e){var f=e.x;var d=e.y;var j=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,d);var h=this.a*(this.g-j);var b=this.ns*Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+h*Math.sin(b);var g=this.y0+this.rh-h*Math.cos(b);e.x=a;e.y=g;return e},inverse:function(e){e.x-=this.x0;e.y=this.rh-e.y+this.y0;var a,h;if(this.ns>=0){var h=Math.sqrt(e.x*e.x+e.y*e.y);var a=1}else{h=-Math.sqrt(e.x*e.x+e.y*e.y);a=-1}var b=0;if(h!=0){b=Math.atan2(a*e.x,a*e.y)}var g=this.g-h/this.a;var d=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);var f=Proj4js.common.adjust_lon(this.long0+b/this.ns);e.x=f;e.y=d;return e},phi3z:function(j,h,g,f,e){var d;var a;d=j;for(var b=0;b<15;b++){a=(j+g*Math.sin(2*d)-f*Math.sin(4*d)+e*Math.sin(6*d))/h-d;d+=a;if(Math.abs(a)<=1e-10){return d}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(d){var a=d.x;var q=d.y;var g=Proj4js.common.adjust_lon(a-this.long0);var e;var z,v;var w=Math.sin(q);var m=Math.cos(q);if(this.sphere){var u=m*Math.sin(g);if((Math.abs(Math.abs(u)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return(93)}else{z=0.5*this.a*this.k0*Math.log((1+u)/(1-u));e=Math.acos(m*Math.cos(g)/Math.sqrt(1-u*u));if(q<0){e=-e}v=this.a*this.k0*(e-this.lat0)}}else{var l=m*g;var j=Math.pow(l,2);var o=this.ep2*Math.pow(m,2);var r=Math.tan(q);var B=Math.pow(r,2);e=1-this.es*Math.pow(w,2);var f=this.a/Math.sqrt(e);var h=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,q);z=this.k0*f*l*(1+j/6*(1-B+o+j/20*(5-18*B+Math.pow(B,2)+72*o-58*this.ep2)))+this.x0;v=this.k0*(h-this.ml0+f*r*(j*(0.5+j/24*(5-B+9*o+4*Math.pow(o,2)+j/30*(61-58*B+Math.pow(B,2)+600*o-330*this.ep2)))))+this.y0}d.x=z;d.y=v;return d},inverse:function(D){var l,e;var M;var F;var q=6;var o,j;if(this.sphere){var I=Math.exp(D.x/(this.a*this.k0));var H=0.5*(I-1/I);var K=this.lat0+D.y/(this.a*this.k0);var G=Math.cos(K);l=Math.sqrt((1-G*G)/(1+H*H));o=Proj4js.common.asinz(l);if(K<0){o=-o}if((H==0)&&(G==0)){j=this.long0}else{j=Proj4js.common.adjust_lon(Math.atan2(H,G)+this.long0)}}else{var v=D.x-this.x0;var u=D.y-this.y0;l=(this.ml0+u/this.k0)/this.a;e=l;for(F=0;true;F++){M=((l+this.e1*Math.sin(2*e)-this.e2*Math.sin(4*e)+this.e3*Math.sin(6*e))/this.e0)-e;e+=M;if(Math.abs(M)<=Proj4js.common.EPSLN){break}if(F>=q){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return(95)}}if(Math.abs(e)<Proj4js.common.HALF_PI){var b=Math.sin(e);var N=Math.cos(e);var w=Math.tan(e);var L=this.ep2*Math.pow(N,2);var m=Math.pow(L,2);var z=Math.pow(w,2);var a=Math.pow(z,2);l=1-this.es*Math.pow(b,2);var E=this.a/Math.sqrt(l);var B=E*(1-this.es)/l;var J=v/(E*this.k0);var C=Math.pow(J,2);o=e-(E*w*C/B)*(0.5-C/24*(5+3*z+10*L-4*m-9*this.ep2-C/30*(61+90*z+298*L+45*a-252*this.ep2-3*m)));j=Proj4js.common.adjust_lon(this.long0+(J*(1-C/6*(1+2*z+L-C/20*(5-2*L+28*z-3*m+8*this.ep2+24*a)))/N))}else{o=Proj4js.common.HALF_PI*Proj4js.common.sign(u);j=this.long0}}D.x=j;D.y=o;return D}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var a=this.b/this.a;this.e=Math.sqrt(1-a*a);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var d=Math.sin(this.lat0);var b=Math.asin(d/this.rs);var e=Math.sin(b);this.cp=Proj4js.common.latiso(0,b,e)-this.rs*Proj4js.common.latiso(this.e,this.lat0,d);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*d*d);
this.xs=this.x0;this.ys=this.y0-this.n2*b;if(!this.title){this.title="Gauss Schreiber transverse mercator"}},forward:function(f){var h=f.x;var e=f.y;var a=this.rs*(h-this.lc);var b=this.cp+(this.rs*Proj4js.common.latiso(this.e,e,Math.sin(e)));var g=Math.asin(Math.sin(a)/Proj4js.common.cosh(b));var d=Proj4js.common.latiso(0,g,Math.sin(g));f.x=this.xs+(this.n2*d);f.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(b)/Math.cos(a)));return f},inverse:function(e){var b=e.x;var g=e.y;var a=Math.atan(Proj4js.common.sinh((b-this.xs)/this.n2)/Math.cos((g-this.ys)/this.n2));var f=Math.asin(Math.sin((g-this.ys)/this.n2)/Proj4js.common.cosh((b-this.xs)/this.n2));var d=Proj4js.common.latiso(0,f,Math.sin(f));e.x=this.lc+a/this.rs;e.y=Proj4js.common.invlatiso(this.e,(d-this.cp)/this.rs);return e}};Proj4js.Proj.ortho={init:function(a){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0)},forward:function(d){var a,e;var q;var o;var f;var h;var b=d.x;var j=d.y;q=Proj4js.common.adjust_lon(b-this.long0);a=Math.sin(j);e=Math.cos(j);o=Math.cos(q);h=this.sin_p14*a+this.cos_p14*e*o;f=1;if((h>0)||(Math.abs(h)<=Proj4js.common.EPSLN)){var m=this.a*f*e*Math.sin(q);var l=this.y0+this.a*f*(this.cos_p14*a-this.sin_p14*e*o)}else{Proj4js.reportError("orthoFwdPointError")}d.x=m;d.y=l;return d},inverse:function(b){var h;var g;var e,l;var j;var d;var a,f;b.x-=this.x0;b.y-=this.y0;h=Math.sqrt(b.x*b.x+b.y*b.y);if(h>this.a+1e-7){Proj4js.reportError("orthoInvDataError")}g=Proj4js.common.asinz(h/this.a);e=Math.sin(g);l=Math.cos(g);a=this.long0;if(Math.abs(h)<=Proj4js.common.EPSLN){f=this.lat0}f=Proj4js.common.asinz(l*this.sin_p14+(b.y*e*this.cos_p14)/h);d=Math.abs(lat0)-Proj4js.common.HALF_PI;if(Math.abs(d)<=Proj4js.common.EPSLN){if(this.lat0>=0){a=Proj4js.common.adjust_lon(this.long0+Math.atan2(b.x,-b.y))}else{a=Proj4js.common.adjust_lon(this.long0-Math.atan2(-b.x,b.y))}}d=l-this.sin_p14*Math.sin(f);if((Math.abs(d)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){a=Proj4js.common.adjust_lon(this.long0+Math.atan2((b.x*e*this.cos_p14),(d*h)))}b.x=a;b.y=f;return b}};Proj4js.Proj.somerc={init:function(){var b=this.lat0;this.lambda0=this.long0;var a=Math.sin(b);var f=this.a;var d=this.rf;var g=1/d;var j=2*g-Math.pow(g,2);var h=this.e=Math.sqrt(j);this.R=f*Math.sqrt(1-j)/(1-j*Math.pow(a,2));this.alpha=Math.sqrt(1+j/(1-j)*Math.pow(Math.cos(b),4));this.b0=Math.asin(a/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+b/2))+this.alpha*h/2*Math.log((1+h*a)/(1-h*a))},forward:function(g){var l=Math.log(Math.tan(Math.PI/4-g.y/2));var h=this.e/2*Math.log((1+this.e*Math.sin(g.y))/(1-this.e*Math.sin(g.y)));var e=-this.alpha*(l+h)+this.K;var a=2*(Math.atan(Math.exp(e))-Math.PI/4);var d=this.alpha*(g.x-this.lambda0);var j=Math.atan(Math.sin(d)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(d)));var f=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(d));g.y=this.R/2*Math.log((1+Math.sin(f))/(1-Math.sin(f)))+this.y0;g.x=this.R*j+this.x0;return g},inverse:function(e){var d=e.x-this.x0;var f=e.y-this.y0;var q=d/this.R;var g=2*(Math.atan(Math.exp(f/this.R))-Math.PI/4);var m=Math.asin(Math.cos(this.b0)*Math.sin(g)+Math.sin(this.b0)*Math.cos(g)*Math.cos(q));var o=Math.atan(Math.sin(q)/(Math.cos(this.b0)*Math.cos(q)-Math.sin(this.b0)*Math.tan(g)));var l=this.lambda0+o/this.alpha;var j=0;var r=m;var a=-1000;var h=0;while(Math.abs(r-a)>1e-7){if(++h>20){Proj4js.reportError("omercFwdInfinity");return}j=1/this.alpha*(Math.log(Math.tan(Math.PI/4+m/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(r))/2));a=r;r=2*Math.atan(Math.exp(j))-Math.PI/2}e.x=l;e.y=r;return e}};Proj4js.Proj.stere={ssfn_:function(a,d,b){d*=b;return(Math.tan(0.5*(Proj4js.common.HALF_PI+a))*Math.pow((1-d)/(1+d),0.5*b))},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var a=Math.abs(this.lat0);if((Math.abs(a)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE}else{this.mode=a>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT
}this.phits=Math.abs(this.phits);if(this.es){var b;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e))}else{a=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,a);a*=this.e;this.akm1/=Math.sqrt(1-a*a)}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:a=Math.sin(this.lat0);b=2*Math.atan(this.ssfn_(this.lat0,a,this.e))-Proj4js.common.HALF_PI;a*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-a*a);this.sinX1=Math.sin(b);this.cosX1=Math.cos(b);break}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;break}}},forward:function(d){var b=d.x;b=Proj4js.common.adjust_lon(b-this.long0);var g=d.y;var l,h;if(this.sphere){var a,e,j,f;a=Math.sin(g);e=Math.cos(g);j=Math.cos(b);f=Math.sin(b);switch(this.mode){case this.EQUIT:h=1+e*j;if(h<=Proj4js.common.EPSLN){F_ERROR}h=this.akm1/h;l=h*e*f;h*=a;break;case this.OBLIQ:h=1+this.sinph0*a+this.cosph0*e*j;if(h<=Proj4js.common.EPSLN){F_ERROR}h=this.akm1/h;l=h*e*f;h*=this.cosph0*a-this.sinph0*e*j;break;case this.N_POLE:j=-j;g=-g;case this.S_POLE:if(Math.abs(g-Proj4js.common.HALF_PI)<this.TOL){F_ERROR}h=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*g);l=f*h;h*=j;break}}else{j=Math.cos(b);f=Math.sin(b);a=Math.sin(g);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(g,a,this.e));sinX=Math.sin(X-Proj4js.common.HALF_PI);cosX=Math.cos(X)}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*j));h=A*(this.cosX1*sinX-this.sinX1*cosX*j);l=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*j);h=A*sinX;l=A*cosX;break;case this.S_POLE:g=-g;j=-j;a=-a;case this.N_POLE:l=this.akm1*Proj4js.common.tsfnz(this.e,g,a);h=-l*j;break}l=l*f}d.x=l*this.a+this.x0;d.y=h*this.a+this.y0;return d},inverse:function(d){var v=(d.x-this.x0)/this.a;var q=(d.y-this.y0)/this.a;var b,o;var h,a,u=0,e=0,r,g=0,l=0;var j;if(this.sphere){var m,w,f,z;w=Math.sqrt(v*v+q*q);m=2*Math.atan(w/this.akm1);f=Math.sin(m);z=Math.cos(m);b=0;switch(this.mode){case this.EQUIT:if(Math.abs(w)<=Proj4js.common.EPSLN){o=0}else{o=Math.asin(q*f/w)}if(z!=0||v!=0){b=Math.atan2(v*f,z*w)}break;case this.OBLIQ:if(Math.abs(w)<=Proj4js.common.EPSLN){o=this.phi0}else{o=Math.asin(z*sinph0+q*f*cosph0/w)}m=z-sinph0*Math.sin(o);if(m!=0||v!=0){b=Math.atan2(v*f*cosph0,m*w)}break;case this.N_POLE:q=-q;case this.S_POLE:if(Math.abs(w)<=Proj4js.common.EPSLN){o=this.phi0}else{o=Math.asin(this.mode==this.S_POLE?-z:z)}b=(v==0&&q==0)?0:Math.atan2(v,q);break}}else{r=Math.sqrt(v*v+q*q);switch(this.mode){case this.OBLIQ:case this.EQUIT:u=2*Math.atan2(r*this.cosX1,this.akm1);h=Math.cos(u);a=Math.sin(u);if(r==0){e=Math.asin(h*this.sinX1)}else{e=Math.asin(h*this.sinX1+(q*a*this.cosX1/r))}u=Math.tan(0.5*(Proj4js.common.HALF_PI+e));v*=a;q=r*this.cosX1*h-q*this.sinX1*a;l=Proj4js.common.HALF_PI;g=0.5*this.e;break;case this.N_POLE:q=-q;case this.S_POLE:u=-r/this.akm1;e=Proj4js.common.HALF_PI-2*Math.atan(u);l=-Proj4js.common.HALF_PI;g=-0.5*this.e;break}for(j=this.NITER;j--;e=o){a=this.e*Math.sin(e);o=2*Math.atan(u*Math.pow((1+a)/(1-a),g))-l;if(Math.abs(e-o)<this.CONV){if(this.mode==this.S_POLE){o=-o}b=(v==0&&q==0)?0:Math.atan2(v,q);d.x=Proj4js.common.adjust_lon(b+this.long0);d.y=o;return d}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();this.A[1]=+0.6399175073;this.A[2]=-0.1358797613;this.A[3]=+0.063294409;this.A[4]=-0.02526853;this.A[5]=+0.0117879;this.A[6]=-0.0055161;this.A[7]=+0.0026906;this.A[8]=-0.001333;this.A[9]=+0.00067;this.A[10]=-0.00034;this.B_re=new Array();this.B_im=new Array();this.B_re[1]=+0.7557853228;this.B_im[1]=0;this.B_re[2]=+0.249204646;this.B_im[2]=+0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=+0.04105856;
this.B_re[4]=-0.10162907;this.B_im[4]=+0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array();this.C_im=new Array();this.C_re[1]=+1.3231270439;this.C_im[1]=0;this.C_re[2]=-0.577245789;this.C_im[2]=-0.007809598;this.C_re[3]=+0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;this.C_im[4]=+0.18200602;this.C_re[5]=+1.01418179;this.C_im[5]=+1.64497696;this.C_re[6]=+1.9660549;this.C_im[6]=+2.5127645;this.D=new Array();this.D[1]=+1.5627014243;this.D[2]=+0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;this.D[6]=+0.007317;this.D[7]=+0.0122;this.D[8]=+0.00394;this.D[9]=-0.0013},forward:function(d){var b=d.x;var u=d.y;var z=u-this.lat0;var l=b-this.long0;var e=z/Proj4js.common.SEC_TO_RAD*0.00001;var a=l;var o=1;var j=0;for(n=1;n<=10;n++){o=o*e;j=j+this.A[n]*o}var m=j;var g=a;var q=1;var h=0;var w;var f;var v=0;var r=0;for(n=1;n<=6;n++){w=q*m-h*g;f=h*m+q*g;q=w;h=f;v=v+this.B_re[n]*q-this.B_im[n]*h;r=r+this.B_im[n]*q+this.B_re[n]*h}x=(r*this.a)+this.x0;y=(v*this.a)+this.y0;d.x=x;d.y=y;return d},inverse:function(B){var v=B.x;var u=B.y;var F=v-this.x0;var E=u-this.y0;var r=E/this.a;var f=F/this.a;var l=1;var L=0;var g;var I;var m=0;var a=0;for(n=1;n<=6;n++){g=l*r-L*f;I=L*r+l*f;l=g;L=I;m=m+this.C_re[n]*l-this.C_im[n]*L;a=a+this.C_im[n]*l+this.C_re[n]*L}for(i=0;i<this.iterations;i++){var w=m;var j=a;var D;var z;var d=r;var H=f;for(n=2;n<=6;n++){D=w*m-j*a;z=j*m+w*a;w=D;j=z;d=d+(n-1)*(this.B_re[n]*w-this.B_im[n]*j);H=H+(n-1)*(this.B_im[n]*w+this.B_re[n]*j)}w=1;j=0;var b=this.B_re[1];var G=this.B_im[1];for(n=2;n<=6;n++){D=w*m-j*a;z=j*m+w*a;w=D;j=z;b=b+n*(this.B_re[n]*w-this.B_im[n]*j);G=G+n*(this.B_im[n]*w+this.B_re[n]*j)}var e=b*b+G*G;m=(d*b+H*G)/e;a=(H*b-d*G)/e}var C=m;var q=a;var J=1;var K=0;for(n=1;n<=9;n++){J=J*C;K=K+this.D[n]*J}var o=this.lat0+(K*Proj4js.common.SEC_TO_RAD*100000);var h=this.long0+q;B.x=h;B.y=o;return B}};Proj4js.Proj.mill={init:function(){},forward:function(e){var f=e.x;var d=e.y;var b=Proj4js.common.adjust_lon(f-this.long0);var a=this.x0+this.a*b;var g=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(d/2.5)))*1.25;e.x=a;e.y=g;return e},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var d=Proj4js.common.adjust_lon(this.long0+b.x/this.a);var a=2.5*(Math.atan(Math.exp(0.8*b.y/this.a))-Proj4js.common.PI/4);b.x=d;b.y=a;return b}};Proj4js.Proj.gnom={init:function(a){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1000*this.a},forward:function(d){var a,e;var m;var l;var f;var h;var b=d.x;var j=d.y;m=Proj4js.common.adjust_lon(b-this.long0);a=Math.sin(j);e=Math.cos(j);l=Math.cos(m);h=this.sin_p14*a+this.cos_p14*e*l;f=1;if((h>0)||(Math.abs(h)<=Proj4js.common.EPSLN)){x=this.x0+this.a*f*e*Math.sin(m)/h;y=this.y0+this.a*f*(this.cos_p14*a-this.sin_p14*e*l)/h}else{Proj4js.reportError("orthoFwdPointError");x=this.x0+this.infinity_dist*e*Math.sin(m);y=this.y0+this.infinity_dist*(this.cos_p14*a-this.sin_p14*e*l)}d.x=x;d.y=y;return d},inverse:function(f){var a;var h;var b,d;var j;var g,e;f.x=(f.x-this.x0)/this.a;f.y=(f.y-this.y0)/this.a;f.x/=this.k0;f.y/=this.k0;if((a=Math.sqrt(f.x*f.x+f.y*f.y))){j=Math.atan2(a,this.rc);b=Math.sin(j);d=Math.cos(j);e=Proj4js.common.asinz(d*this.sin_p14+(f.y*b*this.cos_p14)/a);g=Math.atan2(f.x*b,a*this.cos_p14*d-f.y*this.sin_p14*b);g=Proj4js.common.adjust_lon(this.long0+g)}else{e=this.phic0;g=0}f.x=g;f.y=e;return f}};Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(e){var a,g,b;var f=e.x;var d=e.y;b=Proj4js.common.adjust_lon(f-this.long0);a=this.R*b*Math.cos(d)+this.x0;g=this.R*d+this.y0;e.x=a;e.y=g;return e},inverse:function(d){var b,a,e;d.x-=this.x0;d.y-=this.y0;b=d.y/this.R;if(Math.abs(b)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError")}a=Math.abs(b)-Proj4js.common.HALF_PI;if(Math.abs(a)>Proj4js.common.EPSLN){a=this.long0+d.x/(this.R*Math.cos(b));e=Proj4js.common.adjust_lon(a)}else{e=this.long0}d.x=e;d.y=b;return d}};Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(d){var a=d.x;var u=d.y;var B=Proj4js.common.adjust_lon(a-this.long0);
var z,v;if(Math.abs(u)<=Proj4js.common.EPSLN){z=this.x0+this.R*B;v=this.y0}var f=Proj4js.common.asinz(2*Math.abs(u/Proj4js.common.PI));if((Math.abs(B)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(u)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){z=this.x0;if(u>=0){v=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*f)}else{v=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*f)}}var q=0.5*Math.abs((Proj4js.common.PI/B)-(B/Proj4js.common.PI));var e=q*q;var r=Math.sin(f);var o=Math.cos(f);var l=o/(r+o-1);var j=l*l;var h=l*(2/r-1);var w=h*h;var b=Proj4js.common.PI*this.R*(q*(l-w)+Math.sqrt(e*(l-w)*(l-w)-(w+e)*(j-w)))/(w+e);if(B<0){b=-b}z=this.x0+b;b=Math.abs(b/(Proj4js.common.PI*this.R));if(u>=0){v=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-b*b-2*q*b)}else{v=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-b*b-2*q*b)}d.x=z;d.y=v;return d},inverse:function(f){var w;var a,q,v,l,j,h;var m,g;var e;var u;var b;var r;var o;f.x-=this.x0;f.y-=this.y0;b=Proj4js.common.PI*this.R;a=f.x/b;q=f.y/b;v=a*a+q*q;l=-Math.abs(q)*(1+v);j=l-2*q*q+a*a;h=-2*l+1+2*q*q+v*v;o=q*q/h+(2*j*j*j/h/h/h-9*l*j/h/h)/27;e=(l-j*j/3/h)/h;u=2*Math.sqrt(-e/3);b=((3*o)/e)/u;if(Math.abs(b)>1){if(b>=0){b=1}else{b=-1}}r=Math.acos(b)/3;if(f.y>=0){lat=(-u*Math.cos(r+Proj4js.common.PI/3)-j/3/h)*Proj4js.common.PI}else{lat=-(-u*Math.cos(r+PI/3)-j/3/h)*Proj4js.common.PI}if(Math.abs(a)<Proj4js.common.EPSLN){lon=this.long0}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(v-1+Math.sqrt(1+2*(a*a-q*q)+v*v))/2/a);f.x=lon;f.y=lat;return f}};Proj4js.Proj.cea={init:function(){},forward:function(d){var e=d.x;var b=d.y;dlon=Proj4js.common.adjust_lon(e-this.long0);var a=this.x0+this.a*dlon*Math.cos(this.lat_ts);var f=this.y0+this.a*Math.sin(b)/Math.cos(this.lat_ts);d.x=a;d.y=f;return d},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var d=Proj4js.common.adjust_lon(this.long0+(b.x/this.a)/Math.cos(this.lat_ts));var a=Math.asin((b.y/this.a)*Math.cos(this.lat_ts));b.x=d;b.y=a;return b}};Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0}if(!this.y0){this.y0=0}if(!this.lat0){this.lat0=0}if(!this.long0){this.long0=0}if(!this.lat_ts){this.lat_ts=0}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)"}this.rc=Math.cos(this.lat_ts)},forward:function(e){var f=e.x;var d=e.y;var b=Proj4js.common.adjust_lon(f-this.long0);var a=Proj4js.common.adjust_lat(d-this.lat0);e.x=this.x0+(this.a*b*this.rc);e.y=this.y0+(this.a*a);return e},inverse:function(b){var a=b.x;var d=b.y;b.x=Proj4js.common.adjust_lon(this.long0+((a-this.x0)/(this.a*this.rc)));b.y=Proj4js.common.adjust_lat(this.lat0+((d-this.y0)/(this.a)));return b}};Proj4js.Proj.cass={init:function(){if(!this.sphere){this.en=this.pj_enfn(this.es);this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en)}},C1:0.16666666666666666,C2:0.008333333333333333,C3:0.041666666666666664,C4:0.3333333333333333,C5:0.06666666666666667,forward:function(e){var a,f;var b=e.x;var d=e.y;b=Proj4js.common.adjust_lon(b-this.long0);if(this.sphere){a=Math.asin(Math.cos(d)*Math.sin(b));f=Math.atan2(Math.tan(d),Math.cos(b))-this.phi0}else{this.n=Math.sin(d);this.c=Math.cos(d);f=this.pj_mlfn(d,this.n,this.c,this.en);this.n=1/Math.sqrt(1-this.es*this.n*this.n);this.tn=Math.tan(d);this.t=this.tn*this.tn;this.a1=b*this.c;this.c*=this.es*this.c/(1-this.es);this.a2=this.a1*this.a1;a=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2));f-=this.m0-this.n*this.tn*this.a2*(0.5+(5-this.t+6*this.c)*this.a2*this.C3)}e.x=this.a*a+this.x0;e.y=this.a*f+this.y0;return e},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var a=b.x/this.a;var d=b.y/this.a;if(this.sphere){this.dd=d+this.lat0;phi=Math.asin(Math.sin(this.dd)*Math.cos(a));lam=Math.atan2(Math.tan(a),Math.cos(this.dd))}else{ph1=this.pj_inv_mlfn(this.m0+d,this.es,this.en);this.tn=Math.tan(ph1);this.t=this.tn*this.tn;this.n=Math.sin(ph1);this.r=1/(1-this.es*this.n*this.n);this.n=Math.sqrt(this.r);this.r*=(1-this.es)*this.n;this.dd=a/this.n;this.d2=this.dd*this.dd;phi=ph1-(this.n*this.tn/this.r)*this.d2*(0.5-(1+3*this.t)*this.d2*this.C3);lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)
}b.x=Proj4js.common.adjust_lon(this.long0+lam);b.y=phi;return b},pj_enfn:function(b){en=new Array();en[0]=this.C00-b*(this.C02+b*(this.C04+b*(this.C06+b*this.C08)));en[1]=b*(this.C22-b*(this.C04+b*(this.C06+b*this.C08)));var a=b*b;en[2]=a*(this.C44-b*(this.C46+b*this.C48));a*=b;en[3]=a*(this.C66-b*this.C68);en[4]=a*b*this.C88;return en},pj_mlfn:function(e,a,d,b){d*=a;a*=a;return(b[0]*e-d*(b[1]+a*(b[2]+a*(b[3]+a*b[4]))))},pj_inv_mlfn:function(a,d,b){k=1/(1-d);phi=a;for(i=Proj4js.common.MAX_ITER;i;--i){s=Math.sin(phi);t=1-d*s*s;t=(this.pj_mlfn(phi,s,Math.cos(phi),b)-a)*(t*Math.sqrt(t))*k;phi-=t;if(Math.abs(t)<Proj4js.common.EPSLN){return phi}}Proj4js.reportError("cass:pj_inv_mlfn: Convergence error");return phi},C00:1,C02:0.25,C04:0.046875,C06:0.01953125,C08:0.01068115234375,C22:0.75,C44:0.46875,C46:0.013020833333333334,C48:0.007120768229166667,C66:0.3645833333333333,C68:0.005696614583333333,C88:0.3076171875};Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(b){var d=b.x;var a=b.y;b.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*a+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(a),this.ratexp))-Proj4js.common.HALF_PI;b.x=this.C*d;return b},inverse:function(e){var d=1e-14;var f=e.x/this.C;var b=e.y;num=Math.pow(Math.tan(0.5*b+Proj4js.common.FORTPI)/this.K,1/this.C);for(var a=Proj4js.common.MAX_ITER;a>0;--a){b=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(e.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(b-e.y)<d){break}e.y=b}if(!a){Proj4js.reportError("gauss:inverse:convergence failed");return null}e.x=f;e.y=b;return e}};Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0}if(!this.lon1){this.lon1=0;this.mode=1}if(!this.lon2){this.lon2=0}if(!this.lat2){this.lat2=0}var a=this.b/this.a;var d=1-Math.pow(a,2);var b=Math.sqrt(d);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-d);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-d));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1)}else{this.f=this.d-Math.sqrt(this.d*this.d-1)}}else{this.f=this.d}this.el=this.f*Math.pow(this.ts,this.bl)}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}}else{Proj4js.reportError("omerc:Init:DataError")}}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=0.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI}this.dlon=this.lon1-this.lon2;
this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")}else{this.con=Math.abs(this.lat1)}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError")}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")}}this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}}},forward:function(B){var l;var e,I;var H;var G,u,d;var g,C,E;var z,m,F;var v,D;var w;var a;var h;var f=B.x;var j=B.y;e=Math.sin(j);a=Proj4js.common.adjust_lon(f-this.longc);F=Math.sin(this.bl*a);if(Math.abs(Math.abs(j)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){h=Proj4js.common.tsfnz(this.e,j,e);z=this.el/(Math.pow(h,this.bl));w=0.5*(z-1/z);u=0.5*(z+1/z);v=(w*this.singam-F*this.cosgam)/u;g=Math.cos(this.bl*a);if(Math.abs(g)<1e-7){m=this.al*this.bl*a}else{m=this.al*Math.atan((w*this.cosgam+F*this.singam)/g)/this.bl;if(g<0){m=m+Proj4js.common.PI*this.al/this.bl}}}else{if(j>=0){v=this.singam}else{v=-this.singam}m=this.al*j/this.bl}if(Math.abs(Math.abs(v)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity")}D=0.5*this.al*Math.log((1-v)/(1+v))/this.bl;m=m-this.u;var r=this.x0+D*this.cosaz+m*this.sinaz;var o=this.y0+m*this.cosaz-D*this.sinaz;B.x=r;B.y=o;return B},inverse:function(v){var I;var j;var f;var e,H;var G;var E,o,d;var g,w,C;var z,l,u,r,h;var D,m,F;var a;var B;v.x-=this.x0;v.y-=this.y0;B=0;z=v.x*this.cosaz-v.y*this.sinaz;l=v.y*this.cosaz+v.x*this.sinaz;l=l+this.u;u=Math.exp(-this.bl*z/this.al);r=0.5*(u-1/u);o=0.5*(u+1/u);D=Math.sin(this.bl*l/this.al);m=(D*this.cosgam+r*this.singam)/o;if(Math.abs(Math.abs(m)-1)<=Proj4js.common.EPSLN){lon=this.longc;if(m>=0){lat=Proj4js.common.HALF_PI}else{lat=-Proj4js.common.HALF_PI}}else{g=1/this.bl;h=Math.pow((this.el/Math.sqrt((1+m)/(1-m))),g);lat=Proj4js.common.phi2z(this.e,h);j=this.longc-Math.atan2((r*this.cosgam-D*this.singam),g)/this.bl;lon=Proj4js.common.adjust_lon(j)}v.x=lon;v.y=lat;return v}};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0}if(!this.k0){this.k0=1}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return}var m=this.b/this.a;this.e=Math.sqrt(1-m*m);var h=Math.sin(this.lat1);var f=Math.cos(this.lat1);var l=Proj4js.common.msfnz(this.e,h,f);var b=Proj4js.common.tsfnz(this.e,this.lat1,h);var g=Math.sin(this.lat2);var e=Math.cos(this.lat2);var j=Proj4js.common.msfnz(this.e,g,e);var a=Proj4js.common.tsfnz(this.e,this.lat2,g);var d=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(l/j)/Math.log(b/a)}else{this.ns=h}this.f0=l/(this.ns*Math.pow(b,this.ns));this.rh=this.a*this.f0*Math.pow(d,this.ns);if(!this.title){this.title="Lambert Conformal Conic"}},forward:function(f){var g=f.x;var e=f.y;if(e<=90&&e>=-90&&g<=180&&g>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+g+" : "+e);return null}var a=Math.abs(Math.abs(e)-Proj4js.common.HALF_PI);var d,h;if(a>Proj4js.common.EPSLN){d=Proj4js.common.tsfnz(this.e,e,Math.sin(e));h=this.a*this.f0*Math.pow(d,this.ns)}else{a=e*this.ns;if(a<=0){Proj4js.reportError("lcc:forward: No Projection");return null}h=0}var b=this.ns*Proj4js.common.adjust_lon(g-this.long0);f.x=this.k0*(h*Math.sin(b))+this.x0;f.y=this.k0*(this.rh-h*Math.cos(b))+this.y0;return f},inverse:function(f){var h,a,d;var e,g;x=(f.x-this.x0)/this.k0;y=(this.rh-(f.y-this.y0)/this.k0);if(this.ns>0){h=Math.sqrt(x*x+y*y);a=1}else{h=-Math.sqrt(x*x+y*y);
a=-1}var b=0;if(h!=0){b=Math.atan2((a*x),(a*y))}if((h!=0)||(this.ns>0)){a=1/this.ns;d=Math.pow((h/(this.a*this.f0)),a);e=Proj4js.common.phi2z(this.e,d);if(e==-9999){return null}}else{e=-Proj4js.common.HALF_PI}g=Proj4js.common.adjust_lon(b/this.ns+this.long0);f.x=g;f.y=e;return f}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var a=Math.abs(this.lat0);if(Math.abs(a-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE}else{if(Math.abs(a)<Proj4js.common.EPSLN){this.mode=this.EQUIT}else{this.mode=this.OBLIQ}}if(this.es>0){var b;this.qp=Proj4js.common.qsfnz(this.e,1);this.mmf=0.5/(1-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(0.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=0.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(0.5*this.qp);b=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,b)/this.qp;this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*b*b)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd;break}}else{if(this.mode==this.OBLIQ){this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0)}}},forward:function(f){var u,o;var v=f.x;var l=f.y;v=Proj4js.common.adjust_lon(v-this.long0);if(this.sphere){var r,h,d;d=Math.sin(l);h=Math.cos(l);r=Math.cos(v);switch(this.mode){case this.EQUIT:o=(this.mode==this.EQUIT)?1+h*r:1+this.sinph0*d+this.cosph0*h*r;if(o<=Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:y less than eps");return null}o=Math.sqrt(2/o);u=o*h*Math.sin(v);o*=(this.mode==this.EQUIT)?d:this.cosph0*d-this.sinph0*h*r;break;case this.N_POLE:r=-r;case this.S_POLE:if(Math.abs(l+this.phi0)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:phi < eps");return null}o=Proj4js.common.FORTPI-l*0.5;o=2*((this.mode==this.S_POLE)?Math.cos(o):Math.sin(o));u=o*Math.sin(v);o*=r;break}}else{var r,j,d,e,g=0,a=0,m=0;r=Math.cos(v);j=Math.sin(v);d=Math.sin(l);e=Proj4js.common.qsfnz(this.e,d);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){g=e/this.qp;a=Math.sqrt(1-g*g)}switch(this.mode){case this.OBLIQ:m=1+this.sinb1*g+this.cosb1*a*r;break;case this.EQUIT:m=1+a*r;break;case this.N_POLE:m=Proj4js.common.HALF_PI+l;e=this.qp-e;break;case this.S_POLE:m=l-Proj4js.common.HALF_PI;e=this.qp+e;break}if(Math.abs(m)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:b < eps");return null}switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m);if(this.mode==this.OBLIQ){o=this.ymf*m*(this.cosb1*g-this.sinb1*a*r)}else{o=(m=Math.sqrt(2/(1+a*r)))*g*this.ymf}u=this.xmf*m*a*j;break;case this.N_POLE:case this.S_POLE:if(e>=0){u=(m=Math.sqrt(e))*j;o=r*((this.mode==this.S_POLE)?m:-m)}else{u=o=0}break}}f.x=this.a*u+this.x0;f.y=this.a*o+this.y0;return f},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var j=b.x/this.a;var g=b.y/this.a;if(this.sphere){var r=0,m,d=0;m=Math.sqrt(j*j+g*g);var f=m*0.5;if(f>1){Proj4js.reportError("laea:Inv:DataError");return null}f=2*Math.asin(f);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){d=Math.sin(f);r=Math.cos(f)}switch(this.mode){case this.EQUIT:f=(Math.abs(m)<=Proj4js.common.EPSLN)?0:Math.asin(g*d/m);j*=d;g=r*m;break;case this.OBLIQ:f=(Math.abs(m)<=Proj4js.common.EPSLN)?this.phi0:Math.asin(r*sinph0+g*d*cosph0/m);j*=d*cosph0;g=(r-Math.sin(f)*sinph0)*m;break;case this.N_POLE:g=-g;f=Proj4js.common.HALF_PI-f;break;case this.S_POLE:f-=Proj4js.common.HALF_PI;break}lam=(g==0&&(this.mode==this.EQUIT||this.mode==this.OBLIQ))?0:Math.atan2(j,g)}else{var l,e,a,h,o=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:j/=this.dd;g*=this.dd;h=Math.sqrt(j*j+g*g);if(h<Proj4js.common.EPSLN){b.x=0;b.y=this.phi0;return b}e=2*Math.asin(0.5*h/this.rq);l=Math.cos(e);j*=(e=Math.sin(e));if(this.mode==this.OBLIQ){o=l*this.sinb1+g*e*this.cosb1/h;a=this.qp*o;g=h*this.cosb1*l-g*this.sinb1*e}else{o=g*e/h;a=this.qp*o;g=h*l}break;case this.N_POLE:g=-g;case this.S_POLE:a=(j*j+g*g);if(!a){b.x=0;b.y=this.phi0;return b}o=1-a/this.qp;if(this.mode==this.S_POLE){o=-o}break}lam=Math.atan2(j,g);f=this.authlat(Math.asin(o),this.apa)
}b.x=Proj4js.common.adjust_lon(this.long0+lam);b.y=f;return b},P00:0.3333333333333333,P01:0.17222222222222222,P02:0.10257936507936508,P10:0.06388888888888888,P11:0.0664021164021164,P20:0.016415012942191543,authset:function(b){var a;var d=new Array();d[0]=b*this.P00;a=b*b;d[0]+=a*this.P01;d[1]=a*this.P10;a*=b;d[0]+=a*this.P02;d[1]+=a*this.P11;d[2]=a*this.P20;return d},authlat:function(b,d){var a=b+b;return(b+d[0]*Math.sin(a)+d[1]*Math.sin(a+a)+d[2]*Math.sin(a+a+a))}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0)},forward:function(d){var b=d.x;var l=d.y;var f;var a=Math.sin(d.y);var e=Math.cos(d.y);var o=Proj4js.common.adjust_lon(b-this.long0);var m=Math.cos(o);var h=this.sin_p12*a+this.cos_p12*e*m;if(Math.abs(Math.abs(h)-1)<Proj4js.common.EPSLN){f=1;if(h<0){Proj4js.reportError("aeqd:Fwd:PointError");return}}else{var j=Math.acos(h);f=j/Math.sin(j)}d.x=this.x0+this.a*f*e*Math.sin(o);d.y=this.y0+this.a*f*(this.cos_p12*a-this.sin_p12*e*m);return d},inverse:function(b){b.x-=this.x0;b.y-=this.y0;var h=Math.sqrt(b.x*b.x+b.y*b.y);if(h>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");return}var f=h/this.a;var e=Math.sin(f);var l=Math.cos(f);var a=this.long0;var g;if(Math.abs(h)<=Proj4js.common.EPSLN){g=this.lat0}else{g=Proj4js.common.asinz(l*this.sin_p12+(b.y*e*this.cos_p12)/h);var d=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(d)<=Proj4js.common.EPSLN){if(lat0>=0){a=Proj4js.common.adjust_lon(this.long0+Math.atan2(b.x,-b.y))}else{a=Proj4js.common.adjust_lon(this.long0-Math.atan2(-b.x,b.y))}}else{d=l-this.sin_p12*Math.sin(g);if((Math.abs(d)<Proj4js.common.EPSLN)&&(Math.abs(b.x)<Proj4js.common.EPSLN)){}else{var j=Math.atan2((b.x*e*this.cos_p12),(d*h));a=Proj4js.common.adjust_lon(this.long0+Math.atan2((b.x*e*this.cos_p12),(d*h)))}}}b.x=a;b.y=g;return b}};Proj4js.Proj.moll={init:function(){},forward:function(d){var a=d.x;var j=d.y;var g=Proj4js.common.adjust_lon(a-this.long0);var f=j;var e=Proj4js.common.PI*Math.sin(j);for(var h=0;true;h++){var b=-(f+Math.sin(f)-e)/(1+Math.cos(f));f+=b;if(Math.abs(b)<Proj4js.common.EPSLN){break}if(h>=50){Proj4js.reportError("moll:Fwd:IterationError")}}f/=2;if(Proj4js.common.PI/2-Math.abs(j)<Proj4js.common.EPSLN){g=0}var m=0.900316316158*this.a*g*Math.cos(f)+this.x0;var l=1.4142135623731*this.a*Math.sin(f)+this.y0;d.x=m;d.y=l;return d},inverse:function(e){var b;var a;e.x-=this.x0;var a=e.y/(1.4142135623731*this.a);if(Math.abs(a)>0.999999999999){a=0.999999999999}var b=Math.asin(a);var f=Proj4js.common.adjust_lon(this.long0+(e.x/(0.900316316158*this.a*Math.cos(b))));if(f<(-Proj4js.common.PI)){f=-Proj4js.common.PI}if(f>Proj4js.common.PI){f=Proj4js.common.PI}a=(2*b+Math.sin(2*b))/Proj4js.common.PI;if(Math.abs(a)>1){a=1}var d=Math.asin(a);e.x=f;e.y=d;return e}};Proj4js.defs["EPSG:3067"]="+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs";Proj4js.defs["EPSG:4326"]="+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";OpenLayers.Class=function(){var a=arguments.length;var e=arguments[0];var d=arguments[a-1];var f=typeof d.initialize=="function"?d.initialize:function(){e.prototype.initialize.apply(this,arguments)};if(a>1){var b=[f,e].concat(Array.prototype.slice.call(arguments).slice(1,a-1),d);OpenLayers.inherit.apply(null,b)}else{f.prototype=d}return f};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}}};OpenLayers.Class.inherit=function(b){var d=function(){b.call(this)};var a=[d].concat(Array.prototype.slice.call(arguments));OpenLayers.inherit.apply(null,a);return d.prototype};OpenLayers.inherit=function(g,e){var d=function(){};d.prototype=e.prototype;g.prototype=new d;var b,a,f;for(b=2,a=arguments.length;b<a;b++){f=arguments[b];if(typeof f==="function"){f=f.prototype}OpenLayers.Util.extend(g.prototype,f)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(a,f){a=a||{};if(f){for(var e in f){var d=f[e];if(d!==undefined){a[e]=d}}var b=typeof window.Event=="function"&&f instanceof window.Event;
if(!b&&f.hasOwnProperty&&f.hasOwnProperty("toString")){a.toString=f.toString}}return a};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){var e=[];for(var d=0,a=arguments.length;d<a;d++){var b=arguments[d];if(typeof b=="string"){b=document.getElementById(b)}if(arguments.length==1){return b}e.push(b)}return e};OpenLayers.Util.isElement=function(a){return !!(a&&a.nodeType===1)};OpenLayers.Util.isArray=function(b){return(Object.prototype.toString.call(b)==="[object Array]")};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement}OpenLayers.Util.removeItem=function(d,b){for(var a=d.length-1;a>=0;a--){if(d[a]==b){d.splice(a,1)}}return d};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0};OpenLayers.Util.indexOf=function(e,d){if(typeof e.indexOf=="function"){return e.indexOf(d)}else{for(var b=0,a=e.length;b<a;b++){if(e[b]==d){return b}}return -1}};OpenLayers.Util.modifyDOMElement=function(f,j,e,g,a,d,h,b){if(j){f.id=j}if(e){f.style.left=e.x+"px";f.style.top=e.y+"px"}if(g){f.style.width=g.w+"px";f.style.height=g.h+"px"}if(a){f.style.position=a}if(d){f.style.border=d}if(h){f.style.overflow=h}if(parseFloat(b)>=0&&parseFloat(b)<1){f.style.filter="alpha(opacity="+(b*100)+")";f.style.opacity=b}else{if(parseFloat(b)==1){f.style.filter="";f.style.opacity=""}}};OpenLayers.Util.createDiv=function(a,l,j,g,f,d,b,h){var e=document.createElement("div");if(g){e.style.backgroundImage="url("+g+")"}if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!f){f="absolute"}OpenLayers.Util.modifyDOMElement(e,a,l,j,f,d,b,h);return e};OpenLayers.Util.createImage=function(a,j,h,f,e,d,g,l){var b=document.createElement("img");if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!e){e="relative"}OpenLayers.Util.modifyDOMElement(b,a,j,h,e,d,null,g);if(l){b.style.display="none";OpenLayers.Event.observe(b,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,b));OpenLayers.Event.observe(b,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,b))}b.style.alt=a;b.galleryImg="no";if(f){b.src=f}return b};OpenLayers.Util.setOpacity=function(b,a){OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display=""}OpenLayers.Element.removeClass(this,"olImageLoadError")};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var e=this.urls;if(e&&OpenLayers.Util.isArray(e)&&e.length>1){var f=this.src.toString();var d,a;for(a=0;d=e[a];a++){if(f.indexOf(d)!=-1){break}}var g=Math.floor(e.length*Math.random());var b=e[g];a=0;while(b==d&&a++<4){g=Math.floor(e.length*Math.random());b=e[g]}this.src=f.replace(d,b)}else{this.src=this.src}}else{OpenLayers.Element.addClass(this,"olImageLoadError")}this.style.display=""};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var f=navigator.appVersion.split("MSIE");var a=parseFloat(f[1]);var b=false;try{b=!!(document.body.filters)}catch(d){}OpenLayers.Util.alphaHackNeeded=(b&&(a>=5.5)&&(a<7))}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(a,b,m,l,h,g,d,e,j){OpenLayers.Util.modifyDOMElement(a,b,m,l,g,null,null,j);var f=a.childNodes[0];if(h){f.src=h}OpenLayers.Util.modifyDOMElement(f,a.id+"_innerImage",null,l,"relative",d);if(OpenLayers.Util.alphaHack()){if(a.style.display!="none"){a.style.display="inline-block"}if(e==null){e="scale"}a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f.src+"', sizingMethod='"+e+"')";if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1){a.style.filter+=" alpha(opacity="+a.style.opacity*100+")"}f.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(b,m,l,h,g,d,e,j,o){var a=OpenLayers.Util.createDiv();var f=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);
a.appendChild(f);if(o){f.style.display="none";OpenLayers.Event.observe(f,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,a));OpenLayers.Event.observe(f,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,a))}OpenLayers.Util.modifyAlphaImageDiv(a,b,m,l,h,g,d,e,j);return a};OpenLayers.Util.upperCaseObject=function(b){var a={};for(var d in b){a[d.toUpperCase()]=b[d]}return a};OpenLayers.Util.applyDefaults=function(e,d){e=e||{};var b=typeof window.Event=="function"&&d instanceof window.Event;for(var a in d){if(e[a]===undefined||(!b&&d.hasOwnProperty&&d.hasOwnProperty(a)&&!e.hasOwnProperty(a))){e[a]=d[a]}}if(!b&&d&&d.hasOwnProperty&&d.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")){e.toString=d.toString}return e};OpenLayers.Util.getParameterString=function(d){var b=[];for(var j in d){var h=d[j];if((h!=null)&&(typeof h!="function")){var e;if(typeof h=="object"&&h.constructor==Array){var f=[];var l;for(var a=0,g=h.length;a<g;a++){l=h[a];f.push(encodeURIComponent((l===null||l===undefined)?"":l))}e=f.join(",")}else{e=encodeURIComponent(h)}b.push(encodeURIComponent(j)+"="+e)}}return b.join("&")};OpenLayers.Util.urlAppend=function(a,b){var e=a;if(b){var d=(a+" ").split(/[?&]/);e+=(d.pop()===" "?b:d.length?"&"+b:"?"+b)}return e};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")};OpenLayers.Util.Try=function(){var f=null;for(var d=0,a=arguments.length;d<a;d++){var b=arguments[d];try{f=b();break}catch(g){}}return f};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent}if(!b){b=a.firstChild.nodeValue}},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,d){var b=(a.relatedTarget)?a.relatedTarget:a.toElement;while(b!=d&&b!=null){b=b.parentNode}return(b!=d)};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(b,a){if(a==null){a=OpenLayers.Util.DEFAULT_PRECISION}if(typeof b!=="number"){b=parseFloat(b)}return a===0?b:parseFloat(b.toPrecision(a))};OpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.deg=function(a){return a*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(h,g){var o=OpenLayers.Util.VincentyConstants;var T=o.a,S=o.b,O=o.f;var r=OpenLayers.Util.rad(g.lon-h.lon);var R=Math.atan((1-O)*Math.tan(OpenLayers.Util.rad(h.lat)));var Q=Math.atan((1-O)*Math.tan(OpenLayers.Util.rad(g.lat)));var q=Math.sin(R),l=Math.cos(R);var p=Math.sin(Q),j=Math.cos(Q);var z=r,u=2*Math.PI;var w=20;while(Math.abs(z-u)>1e-12&&--w>0){var J=Math.sin(z),e=Math.cos(z);var U=Math.sqrt((j*J)*(j*J)+(l*p-q*j*e)*(l*p-q*j*e));if(U==0){return 0}var M=q*p+l*j*e;var I=Math.atan2(U,M);var m=Math.asin(l*j*J/U);var N=Math.cos(m)*Math.cos(m);var v=M-2*q*p/N;var F=O/16*N*(4+O*(4-3*N));u=z;z=r+(1-F)*O*Math.sin(m)*(I+F*U*(v+F*M*(-1+2*v*v)))}if(w==0){return NaN}var E=N*(T*T-S*S)/(S*S);var H=1+E/16384*(4096+E*(-768+E*(320-175*E)));var G=E/1024*(256+E*(-128+E*(74-47*E)));var K=G*U*(v+G/4*(M*(-1+2*v*v)-G/6*v*(-3+4*U*U)*(-3+4*v*v)));var D=S*H*(I-K);var P=D.toFixed(3)/1000;return P};OpenLayers.Util.destinationVincenty=function(p,W,M){var v=OpenLayers.Util;var l=v.VincentyConstants;var Y=l.a,V=l.b,R=l.f;var U=p.lon;var h=p.lat;var z=M;var K=v.rad(W);var O=Math.sin(K);var j=Math.cos(K);var N=(1-R)*Math.tan(v.rad(h));var d=1/Math.sqrt((1+N*N)),m=N*d;var w=Math.atan2(N,j);var I=d*O;var Q=1-I*I;var E=Q*(Y*Y-V*V)/(V*V);var H=1+E/16384*(4096+E*(-768+E*(320-175*E)));var F=E/1024*(256+E*(-128+E*(74-47*E)));var G=z/(V*H),S=2*Math.PI;while(Math.abs(G-S)>1e-12){var q=Math.cos(2*w+G);var Z=Math.sin(G);var P=Math.cos(G);var J=F*Z*(q+F/4*(P*(-1+2*q*q)-F/6*q*(-3+4*Z*Z)*(-3+4*q*q)));S=G;G=z/(V*H)+J}var T=m*Z-d*P*j;var e=Math.atan2(m*P+d*Z*j,(1-R)*Math.sqrt(I*I+T*T));var r=Math.atan2(Z*O,d*P-m*Z*j);var D=R/16*Q*(4+R*(4-3*Q));var o=r-(1-D)*R*I*(G+D*Z*(q+D*P*(-1+2*q*q)));var g=Math.atan2(I,-T);return new OpenLayers.LonLat(U+v.deg(o),v.deg(e))};OpenLayers.Util.getParameters=function(b){b=(b===null||b===undefined)?window.location.href:b;
var a="";if(OpenLayers.String.contains(b,"?")){var d=b.indexOf("?")+1;var g=OpenLayers.String.contains(b,"#")?b.indexOf("#"):b.length;a=b.substring(d,g)}var p={};var e=a.split(/[&;]/);for(var j=0,l=e.length;j<l;++j){var h=e[j].split("=");if(h[0]){var o=h[0];try{o=decodeURIComponent(o)}catch(f){o=unescape(o)}var m=(h[1]||"").replace(/\+/g," ");try{m=decodeURIComponent(m)}catch(f){m=unescape(m)}m=m.split(",");if(m.length==1){m=m[0]}p[o]=m}}return p};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a)};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_"}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});
OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){var a=(b>1)?(1/b):b;return a};OpenLayers.Util.getResolutionFromScale=function(e,a){var b;if(e){if(a==null){a="degrees"}var d=OpenLayers.Util.normalizeScale(e);b=1/(d*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH)}return b};OpenLayers.Util.getScaleFromResolution=function(b,a){if(a==null){a="degrees"}var d=b*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH;return d};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true)};OpenLayers.Util.pagePosition=function(e){var l=[0,0];var j=OpenLayers.Util.getViewportElement();if(!e||e==window||e==j){return l}var g=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(e,"position")=="absolute"&&(e.style.top==""||e.style.left=="");var m=null;var h;if(e.getBoundingClientRect){h=e.getBoundingClientRect();var b=j.scrollTop;var d=j.scrollLeft;l[0]=h.left+d;l[1]=h.top+b}else{if(document.getBoxObjectFor&&!g){h=document.getBoxObjectFor(e);var a=document.getBoxObjectFor(j);l[0]=h.screenX-a.screenX;l[1]=h.screenY-a.screenY}else{l[0]=e.offsetLeft;l[1]=e.offsetTop;m=e.offsetParent;if(m!=e){while(m){l[0]+=m.offsetLeft;l[1]+=m.offsetTop;m=m.offsetParent}}var f=OpenLayers.BROWSER_NAME;if(f=="opera"||(f=="safari"&&OpenLayers.Element.getStyle(e,"position")=="absolute")){l[1]-=document.body.offsetTop}m=e.offsetParent;while(m&&m!=document.body){l[0]-=m.scrollLeft;if(f!="opera"||m.tagName!="TR"){l[1]-=m.scrollTop}m=m.offsetParent}}}return l};OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;if(a==undefined){a=(OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat")?document.body:document.documentElement;arguments.callee.viewportElement=a}return a};OpenLayers.Util.isEquivalentUrl=function(g,f,d){d=d||{};OpenLayers.Util.applyDefaults(d,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var b=OpenLayers.Util.createUrlObject(g,d);var a=OpenLayers.Util.createUrlObject(f,d);for(var e in b){if(e!=="args"){if(b[e]!=a[e]){return false}}}for(var e in b.args){if(b.args[e]!=a.args[e]){return false}delete a.args[e]}for(var e in a.args){return false}return true};OpenLayers.Util.createUrlObject=function(d,o){o=o||{};if(!(/^\w+:\/\//).test(d)){var h=window.location;var f=h.port?":"+h.port:"";var j=h.protocol+"//"+h.host.split(":").shift()+f;if(d.indexOf("/")===0){d=j+d}else{var g=h.pathname.split("/");g.pop();d=j+g.join("/")+"/"+d}}if(o.ignoreCase){d=d.toLowerCase()}var l=document.createElement("a");l.href=d;var e={};e.host=l.host.split(":").shift();e.protocol=l.protocol;if(o.ignorePort80){e.port=(l.port=="80"||l.port=="0")?"":l.port}else{e.port=(l.port==""||l.port=="0")?"80":l.port}e.hash=(o.ignoreHash||l.hash==="#")?"":l.hash;var b=l.search;if(!b){var m=d.indexOf("?");b=(m!=-1)?d.substr(m):""}e.args=OpenLayers.Util.getParameters(b);e.pathname=(l.pathname.charAt(0)=="/")?l.pathname:"/"+l.pathname;return e};OpenLayers.Util.removeTail=function(b){var d=null;var a=b.indexOf("?");var e=b.indexOf("#");if(a==-1){d=(e!=-1)?b.substr(0,e):b}else{d=(e!=-1)?b.substr(0,Math.min(a,e)):b.substr(0,a)}return d};OpenLayers.IS_GECKO=(function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("webkit")==-1&&a.indexOf("gecko")!=-1})();OpenLayers.BROWSER_NAME=(function(){var a="";var b=navigator.userAgent.toLowerCase();if(b.indexOf("opera")!=-1){a="opera"}else{if(b.indexOf("msie")!=-1){a="msie"}else{if(b.indexOf("safari")!=-1){a="safari"}else{if(b.indexOf("mozilla")!=-1){if(b.indexOf("firefox")!=-1){a="firefox"}else{a="mozilla"}}}}}return a})();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(b,r,u){var o,f;var a=document.createElement("div");a.style.visibility="hidden";var q=(u&&u.containerElement)?u.containerElement:document.body;if(r){if(r.w){o=r.w;a.style.width=o+"px"}else{if(r.h){f=r.h;a.style.height=f+"px"}}}if(u&&u.displayClass){a.className=u.displayClass}var g=document.createElement("div");g.innerHTML=b;g.style.overflow="visible";if(g.childNodes){for(var e=0,d=g.childNodes.length;
e<d;e++){if(!g.childNodes[e].style){continue}g.childNodes[e].style.overflow="visible"}}a.appendChild(g);q.appendChild(a);var p=false;var m=a.parentNode;while(m&&m.tagName.toLowerCase()!="body"){var j=OpenLayers.Element.getStyle(m,"position");if(j=="absolute"){p=true;break}else{if(j&&j!="static"){break}}m=m.parentNode}if(!p){a.style.position="absolute"}if(!o){o=parseInt(g.scrollWidth);a.style.width=o+"px"}if(!f){f=parseInt(g.scrollHeight)}a.removeChild(g);q.removeChild(a);return new OpenLayers.Size(o,f)};OpenLayers.Util.getScrollbarWidth=function(){var d=OpenLayers.Util._scrollbarWidth;if(d==null){var f=null;var e=null;var a=0;var b=0;f=document.createElement("div");f.style.position="absolute";f.style.top="-1000px";f.style.left="-1000px";f.style.width="100px";f.style.height="50px";f.style.overflow="hidden";e=document.createElement("div");e.style.width="100%";e.style.height="200px";f.appendChild(e);document.body.appendChild(f);a=e.offsetWidth;f.style.overflow="scroll";b=e.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(a-b);d=OpenLayers.Util._scrollbarWidth}return d};OpenLayers.Util.getFormattedLonLat=function(j,b,f){if(!f){f="dms"}j=(j+540)%360-180;var e=Math.abs(j);var l=Math.floor(e);var a=(e-l)/(1/60);var d=a;a=Math.floor(a);var h=(d-a)/(1/60);h=Math.round(h*10);h/=10;if(h>=60){h-=60;a+=1;if(a>=60){a-=60;l+=1}}if(l<10){l="0"+l}var g=l+"\u00B0";if(f.indexOf("dm")>=0){if(a<10){a="0"+a}g+=a+"'";if(f.indexOf("dms")>=0){if(h<10){h="0"+h}g+=h+'"'}}if(b=="lon"){g+=j<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")}else{g+=j<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")}return g};OpenLayers.String={startsWith:function(b,a){return(b.indexOf(a)==0)},contains:function(b,a){return(b.indexOf(a)!=-1)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(g){var e=g.split("-");var b=e[0];for(var d=1,a=e.length;d<a;d++){var f=e[d];b+=f.charAt(0).toUpperCase()+f.substring(1)}return b},format:function(e,d,a){if(!d){d=window}var b=function(l,f){var j;var h=f.split(/\.+/);for(var g=0;g<h.length;g++){if(g==0){j=d}j=j[h[g]]}if(typeof j=="function"){j=a?j.apply(null,a):j()}if(typeof j=="undefined"){return"undefined"}else{return j}};return e.replace(OpenLayers.String.tokenRegEx,b)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a)}}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a)}}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this)}}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this)}}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,d){var b=0;if(d>0){b=parseFloat(a.toPrecision(d))}return b},format:function(d,a,h,l){a=(typeof a!="undefined")?a:0;h=(typeof h!="undefined")?h:OpenLayers.Number.thousandsSeparator;l=(typeof l!="undefined")?l:OpenLayers.Number.decimalSeparator;if(a!=null){d=parseFloat(d.toFixed(a))}var b=d.toString().split(".");if(b.length==1&&a==null){a=0}var e=b[0];if(h){var f=/(-?[0-9]+)([0-9]{3})/;while(f.test(e)){e=e.replace(f,"$1"+h+"$2")}}var g;if(a==0){g=e}else{var j=b.length>1?b[1]:"0";if(a!=null){j=j+new Array(a-j.length+1).join("0")}g=e+l+j}return g}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));
return OpenLayers.Number.limitSigDigs(this,a)}}OpenLayers.Function={bind:function(d,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var e=a.concat(Array.prototype.slice.apply(arguments,[0]));return d.apply(b,e)}},bindAsEventListener:function(b,a){return function(d){return b.call(a,d||window.event)}},False:function(){return false},True:function(){return true},Void:function(){}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments)}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a)}}OpenLayers.Array={filter:function(h,g,b){var e=[];if(Array.prototype.filter){e=h.filter(g,b)}else{var a=h.length;if(typeof g!="function"){throw new TypeError()}for(var d=0;d<a;d++){if(d in h){var f=h[d];if(g.call(b,f,d,h)){e.push(f)}}}}return e}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,a,b,d){if(e!=null){this.left=OpenLayers.Util.toFloat(e)}if(a!=null){this.bottom=OpenLayers.Util.toFloat(a)}if(b!=null){this.right=OpenLayers.Util.toFloat(b)}if(d!=null){this.top=OpenLayers.Util.toFloat(d)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(b){var a=false;if(b!=null){a=((this.left==b.left)&&(this.right==b.right)&&(this.top==b.top)&&(this.bottom==b.bottom))}return a},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(a){if(a===true){return[this.bottom,this.left,this.top,this.right]}else{return[this.left,this.bottom,this.right,this.top]}},toBBOX:function(b,f){if(b==null){b=6}var h=Math.pow(10,b);var g=Math.round(this.left*h)/h;var e=Math.round(this.bottom*h)/h;var d=Math.round(this.right*h)/h;var a=Math.round(this.top*h)/h;if(f===true){return e+","+g+","+a+","+d}else{return g+","+e+","+d+","+a}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(f,d){if(d==null){d=this.getCenterLonLat()}var a,j;if(d.CLASS_NAME=="OpenLayers.LonLat"){a=d.lon;j=d.lat}else{a=d.x;j=d.y}var h=(this.left-a)*f+a;var b=(this.bottom-j)*f+j;var e=(this.right-a)*f+a;var g=(this.top-j)*f+j;return new OpenLayers.Bounds(h,b,e,g)},add:function(a,d){if((a==null)||(d==null)){var b=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Bounds(this.left+a,this.bottom+d,this.right+a,this.top+d)},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a;break}if(b){this.centerLonLat=null;if((this.left==null)||(b.left<this.left)){this.left=b.left}if((this.bottom==null)||(b.bottom<this.bottom)){this.bottom=b.bottom}if((this.right==null)||(b.right>this.right)){this.right=b.right}if((this.top==null)||(b.top>this.top)){this.top=b.top}}}},containsLonLat:function(b,a){return this.contains(b.lon,b.lat,a)},containsPixel:function(b,a){return this.contains(b.x,b.y,a)
},contains:function(b,e,a){if(a==null){a=true}if(b==null||e==null){return false}b=OpenLayers.Util.toFloat(b);e=OpenLayers.Util.toFloat(e);var d=false;if(a){d=((b>=this.left)&&(b<=this.right)&&(e>=this.bottom)&&(e<=this.top))}else{d=((b>this.left)&&(b<this.right)&&(e>this.bottom)&&(e<this.top))}return d},intersectsBounds:function(f,b){if(b==null){b=true}var e=false;var j=(this.left==f.right||this.right==f.left||this.top==f.bottom||this.bottom==f.top);if(b||!j){var h=(((f.bottom>=this.bottom)&&(f.bottom<=this.top))||((this.bottom>=f.bottom)&&(this.bottom<=f.top)));var g=(((f.top>=this.bottom)&&(f.top<=this.top))||((this.top>f.bottom)&&(this.top<f.top)));var d=(((f.left>=this.left)&&(f.left<=this.right))||((this.left>=f.left)&&(this.left<=f.right)));var a=(((f.right>=this.left)&&(f.right<=this.right))||((this.right>=f.left)&&(this.right<=f.right)));e=((h||g)&&(d||a))}return e},containsBounds:function(h,b,a){if(b==null){b=false}if(a==null){a=true}var d=this.contains(h.left,h.bottom,a);var e=this.contains(h.right,h.bottom,a);var g=this.contains(h.left,h.top,a);var f=this.contains(h.right,h.top,a);return(b)?(d||e||g||f):(d&&e&&g&&f)},determineQuadrant:function(d){var b="";var a=this.getCenterLonLat();b+=(d.lat<a.lat)?"b":"t";b+=(d.lon<a.lon)?"l":"r";return b},transform:function(e,b){this.centerLonLat=null;var f=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,b);var a=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,b);var d=OpenLayers.Projection.transform({x:this.left,y:this.top},e,b);var g=OpenLayers.Projection.transform({x:this.right,y:this.top},e,b);this.left=Math.min(f.x,d.x);this.bottom=Math.min(f.y,a.y);this.right=Math.max(a.x,g.x);this.top=Math.max(d.y,g.y);return this},wrapDateLine:function(a,d){d=d||{};var e=d.leftTolerance||0;var b=d.rightTolerance||0;var f=this.clone();if(a){while(f.left<a.left&&(f.right-b)<=a.left){f=f.add(a.getWidth(),0)}while((f.left+e)>=a.right&&f.right>a.right){f=f.add(-a.getWidth(),0)}}return f},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(d,b){var a=d.split(",");return OpenLayers.Bounds.fromArray(a,b)};OpenLayers.Bounds.fromArray=function(b,a){return a===true?new OpenLayers.Bounds(parseFloat(b[1]),parseFloat(b[0]),parseFloat(b[3]),parseFloat(b[2])):new OpenLayers.Bounds(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]))};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=(a.charAt(0)=="t")?"b":"t";b+=(a.charAt(1)=="l")?"r":"l";return b};OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(b){return b.toISOString()}}else{function a(d,b){var e=d+"";while(e.length<b){e="0"+e}return e}return function(b){var d;if(isNaN(b.getTime())){d="Invalid Date"}else{d=b.getUTCFullYear()+"-"+a(b.getUTCMonth()+1,2)+"-"+a(b.getUTCDate(),2)+"T"+a(b.getUTCHours(),2)+":"+a(b.getUTCMinutes(),2)+":"+a(b.getUTCSeconds(),2)+"."+a(b.getUTCMilliseconds(),3)+"Z"}return d}}})(),parse:function(m){var b;var j=m.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);if(j&&(j[1]||j[7])){var o=parseInt(j[1],10)||0;var l=(parseInt(j[2],10)-1)||0;var q=parseInt(j[3],10)||1;b=new Date(Date.UTC(o,l,q));var p=j[7];if(p){var r=parseInt(j[4],10);var e=parseInt(j[5],10);var a=parseFloat(j[6]);var u=a|0;var d=Math.round(1000*(a-u));b.setUTCHours(r,e,u,d);if(p!=="Z"){var h=parseInt(p,10);var g=parseInt(j[8],10)||0;var f=-1000*(60*(h*60)+g*60);b=new Date(b.getTime()+f)}}}else{b=new Date("invalid")}return b}};OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none"},toggle:function(){for(var d=0,a=arguments.length;d<a;d++){var b=OpenLayers.Util.getElement(arguments[d]);var e=OpenLayers.Element.visible(b)?"hide":"show";OpenLayers.Element[e](b)}},hide:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = 'none';"}));for(var d=0,a=arguments.length;d<a;d++){var b=OpenLayers.Util.getElement(arguments[d]);
if(b){b.style.display="none"}}},show:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = '';"}));for(var d=0,a=arguments.length;d<a;d++){var b=OpenLayers.Util.getElement(arguments[d]);if(b){b.style.display=""}}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},getDimensions:function(d){d=OpenLayers.Util.getElement(d);if(OpenLayers.Element.getStyle(d,"display")!="none"){return{width:d.offsetWidth,height:d.offsetHeight}}var b=d.style;var g=b.visibility;var e=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="";var h=d.clientWidth;var f=d.clientHeight;b.display=a;b.position=e;b.visibility=g;return{width:h,height:f}},hasClass:function(b,a){var d=b.className;return(!!d&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(d))},addClass:function(b,a){if(!OpenLayers.Element.hasClass(b,a)){b.className+=(b.className?" ":"")+a}return b},removeClass:function(b,a){var d=b.className;if(d){b.className=OpenLayers.String.trim(d.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)")," "))}return b},toggleClass:function(b,a){if(OpenLayers.Element.hasClass(b,a)){OpenLayers.Element.removeClass(b,a)}else{OpenLayers.Element.addClass(b,a)}return b},getStyle:function(d,e){d=OpenLayers.Util.getElement(d);var f=null;if(d&&d.style){f=d.style[OpenLayers.String.camelize(e)];if(!f){if(document.defaultView&&document.defaultView.getComputedStyle){var b=document.defaultView.getComputedStyle(d,null);f=b?b.getPropertyValue(e):null}else{if(d.currentStyle){f=d.currentStyle[OpenLayers.String.camelize(e)]}}}var a=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(a,e)!=-1)&&(OpenLayers.Element.getStyle(d,"position")=="static")){f="auto"}}return f=="auto"?null:f}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(b,a){this.lon=OpenLayers.Util.toFloat(b);this.lat=OpenLayers.Util.toFloat(a)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(d,a){if((d==null)||(a==null)){var b=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(d),this.lat+OpenLayers.Util.toFloat(a))},equals:function(b){var a=false;if(b!=null){a=((this.lon==b.lon&&this.lat==b.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(b.lon)&&isNaN(b.lat)))}return a},transform:function(d,b){var a=OpenLayers.Projection.transform({x:this.lon,y:this.lat},d,b);this.lon=a.x;this.lat=a.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){while(b.lon<a.left){b.lon+=a.getWidth()}while(b.lon>a.right){b.lon-=a.getWidth()}}return b},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){var a=b.split(",");return new OpenLayers.LonLat(a[0],a[1])};OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a),e=b&&a[0],d=b&&a[1];return new OpenLayers.LonLat(e,d)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)))}return b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,d){if((a==null)||(d==null)){var b=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Pixel(this.x+a,this.y+d)},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(b){var a=false;if(b!=null){a=((this.w==b.w&&this.h==b.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(b.w)&&isNaN(b.h)))
}return a},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var b=document.getElementsByTagName("script");for(var d=0,a=b.length;d<a;++d){if(b[d].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=(a)?a:OpenLayers.Easing.Expo.easeOut},start:function(d,b,e,a){this.playing=true;this.begin=d;this.finish=b;this.duration=e;this.callbacks=a.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}window.clearInterval(this.interval);this.interval=null;this.playing=false},play:function(){var g={};for(var d in this.begin){var a=this.begin[d];var e=this.finish[d];if(a==null||e==null||isNaN(a)||isNaN(e)){OpenLayers.Console.error("invalid value for Tween")}var h=e-a;g[d]=this.easing.apply(this,[this.time,a,h,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,g)}if(this.time>this.duration){this.stop()}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,a,g,f){return g*e/f+a},easeOut:function(e,a,g,f){return g*e/f+a},easeInOut:function(e,a,g,f){return g*e/f+a},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,a,g,f){return(e==0)?a:g*Math.pow(2,10*(e/f-1))+a},easeOut:function(e,a,g,f){return(e==f)?a+g:g*(-Math.pow(2,-10*e/f)+1)+a},easeInOut:function(e,a,g,f){if(e==0){return a}if(e==f){return a+g}if((e/=f/2)<1){return g/2*Math.pow(2,10*(e-1))+a}return g/2*(-Math.pow(2,-10*--e)+2)+a},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,a,g,f){return g*(e/=f)*e+a},easeOut:function(e,a,g,f){return -g*(e/=f)*(e-2)+a},easeInOut:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a}return -g/2*((--e)*(e-2)-1)+a},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Kinetic=OpenLayers.Class({threshold:0,interval:10,deceleration:0.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){clearInterval(this.timerId);this.timerId=undefined;this.points=[]},update:function(a){this.points.unshift({xy:a,tick:new Date().getTime()});if(this.points.length>this.nbPoints){this.points.pop()}},end:function(o){var m,a=new Date().getTime();for(var g=0,f=this.points.length,j;g<f;g++){j=this.points[g];if(a-j.tick>this.delay){break}m=j}if(!m){return}var e=new Date().getTime()-m.tick;var h=Math.sqrt(Math.pow(o.x-m.xy.x,2)+Math.pow(o.y-m.xy.y,2));var d=h/e;if(d==0||d<this.threshold){return}var b=Math.asin((o.y-m.xy.y)/h);if(m.xy.x<=o.x){b=Math.PI-b}return{speed:d,theta:b}},move:function(d,m){var l=d.speed;var h=Math.cos(d.theta);var g=-Math.sin(d.theta);var f=0;var e=new Date().getTime();var b=0;var a=0;var j=function(){if(this.timerId==null){return}f+=this.interval;var z=new Date().getTime()-e;var u=(f+z)/2;var w=(-this.deceleration*Math.pow(u,2))/2+l*u;var o=w*h;var B=w*g;var r={};r.end=false;var q=-this.deceleration*u+l;if(q<=0){clearInterval(this.timerId);this.timerId=null;r.end=true}r.x=o-b;r.y=B-a;b=o;a=B;m(r.x,r.y,r.end)};this.timerId=window.setInterval(OpenLayers.Function.bind(j,this),this.interval)},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Rico=OpenLayers.Rico||{};
OpenLayers.Rico.Corner={round:function(f,b){f=OpenLayers.Util.getElement(f);this._setOptions(b);var a=this.options.color;if(this.options.color=="fromElement"){a=this._background(f)}var d=this.options.bgColor;if(this.options.bgColor=="fromParent"){d=this._background(f.offsetParent)}this._roundCornersImpl(f,a,d)},changeColor:function(d,b){d.style.backgroundColor=b;var a=d.parentNode.getElementsByTagName("span");for(var e=0;e<a.length;e++){a[e].style.backgroundColor=b}},changeOpacity:function(d,g){var e=g;var a="alpha(opacity="+g*100+")";d.style.opacity=e;d.style.filter=a;var b=d.parentNode.getElementsByTagName("span");for(var f=0;f<b.length;f++){b[f].style.opacity=e;b[f].style.filter=a}},reRound:function(e,d){var b=e.parentNode.childNodes[0];var a=e.parentNode.childNodes[2];e.parentNode.removeChild(b);e.parentNode.removeChild(a);this.round(e.parentNode,d)},_roundCornersImpl:function(d,a,b){if(this.options.border){this._renderBorder(d,b)}if(this._isTopRounded()){this._roundTopCorners(d,a,b)}if(this._isBottomRounded()){this._roundBottomCorners(d,a,b)}},_renderBorder:function(e,f){var b="1px solid "+this._borderColor(f);var a="border-left: "+b;var g="border-right: "+b;var d="style='"+a+";"+g+"'";e.innerHTML="<div "+d+">"+e.innerHTML+"</div>"},_roundTopCorners:function(d,a,f){var e=this._createCorner(f);for(var b=0;b<this.options.numSlices;b++){e.appendChild(this._createCornerSlice(a,f,b,"top"))}d.style.paddingTop=0;d.insertBefore(e,d.firstChild)},_roundBottomCorners:function(d,a,f){var e=this._createCorner(f);for(var b=(this.options.numSlices-1);b>=0;b--){e.appendChild(this._createCornerSlice(a,f,b,"bottom"))}d.style.paddingBottom=0;d.appendChild(e)},_createCorner:function(b){var a=document.createElement("div");a.style.backgroundColor=(this._isTransparent()?"transparent":b);return a},_createCornerSlice:function(d,e,h,a){var f=document.createElement("span");var b=f.style;b.backgroundColor=d;b.display="block";b.height="1px";b.overflow="hidden";b.fontSize="1px";var g=this._borderColor(d,e);if(this.options.border&&h==0){b.borderTopStyle="solid";b.borderTopWidth="1px";b.borderLeftWidth="0px";b.borderRightWidth="0px";b.borderBottomWidth="0px";b.height="0px";b.borderColor=g}else{if(g){b.borderColor=g;b.borderStyle="solid";b.borderWidth="0px 1px"}}if(!this.options.compact&&(h==(this.options.numSlices-1))){b.height="2px"}this._setMargin(f,h,a);this._setBorder(f,h,a);return f},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else{if(this.options.corners.indexOf("tr")>=0){return"right"}}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else{if(this.options.corners.indexOf("br")>=0){return"right"}}return""},_borderColor:function(a,b){if(a=="transparent"){return b}else{if(this.options.border){return this.options.border}else{if(this.options.blend){return this._blend(b,a)}else{return""}}}},_setMargin:function(e,f,b){var d=this._marginSize(f);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){e.style.marginLeft=d+"px";e.style.marginRight="0px"}else{if(a=="right"){e.style.marginRight=d+"px";e.style.marginLeft="0px"}else{e.style.marginLeft=d+"px";e.style.marginRight=d+"px"}}},_setBorder:function(e,f,b){var d=this._borderSize(f);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){e.style.borderLeftWidth=d+"px";e.style.borderRightWidth="0px"}else{if(a=="right"){e.style.borderRightWidth=d+"px";e.style.borderLeftWidth="0px"}else{e.style.borderLeftWidth=d+"px";
e.style.borderRightWidth=d+"px"}}if(this.options.border!=false){e.style.borderLeftWidth=d+"px";e.style.borderRightWidth=d+"px"}},_marginSize:function(f){if(this._isTransparent()){return 0}var e=[5,3,2,1];var a=[3,2,1,0];var d=[2,1];var b=[1,0];if(this.options.compact&&this.options.blend){return b[f]}else{if(this.options.compact){return d[f]}else{if(this.options.blend){return a[f]}else{return e[f]}}}},_borderSize:function(f){var e=[5,3,2,1];var b=[2,1,1,1];var a=[1,0];var d=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else{if(this.options.compact){return a[f]}else{if(this.options.blend){return b[f]}else{if(this.options.border){return d[f]}else{if(this._isTransparent()){return e[f]}}}}}return 0},_hasString:function(b){for(var a=1;a<arguments.length;a++){if(b.indexOf(arguments[a])>=0){return true}}return false},_blend:function(d,a){var b=OpenLayers.Rico.Color.createFromHex(d);b.blend(OpenLayers.Rico.Color.createFromHex(a));return b},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(d,b,a){this.rgb={r:d,g:b,b:a}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(b){var a=this.asHSB();a.h=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setSaturation:function(b){var a=this.asHSB();a.s=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setBrightness:function(a){var d=this.asHSB();d.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(d.h,d.s,d.b)},darken:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.max(a.b-b,0))},brighten:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.min(a.b+b,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){var a=this.asHSB();return this.asHSB().b>0.5},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(e){if(e.length==4){var b=e;var e="#";for(var d=1;d<4;d++){e+=(b.charAt(d)+b.charAt(d))}}if(e.indexOf("#")==0){e=e.substring(1)}var g=e.substring(0,2);var f=e.substring(2,4);var a=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(g,16),parseInt(f,16),parseInt(a,16))};OpenLayers.Rico.Color.createColorFromBackground=function(e){var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(e),"backgroundColor");if(b=="transparent"&&e.parentNode){return OpenLayers.Rico.Color.createColorFromBackground(e.parentNode)}if(b==null){return new OpenLayers.Rico.Color(255,255,255)}if(b.indexOf("rgb(")==0){var a=b.substring(4,b.length-1);var d=a.split(",");return new OpenLayers.Rico.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}else{if(b.indexOf("#")==0){return OpenLayers.Rico.Color.createFromHex(b)}else{return new OpenLayers.Rico.Color(255,255,255)}}};OpenLayers.Rico.Color.HSBtoRGB=function(l,g,o){var d=0;var e=0;var r=0;if(g==0){d=parseInt(o*255+0.5);e=d;r=d}else{var j=(l-Math.floor(l))*6;var m=j-Math.floor(j);var b=o*(1-g);var a=o*(1-g*m);var u=o*(1-(g*(1-m)));switch(parseInt(j)){case 0:d=(o*255+0.5);e=(u*255+0.5);r=(b*255+0.5);break;case 1:d=(a*255+0.5);e=(o*255+0.5);r=(b*255+0.5);break;case 2:d=(b*255+0.5);e=(o*255+0.5);r=(u*255+0.5);break;
case 3:d=(b*255+0.5);e=(a*255+0.5);r=(o*255+0.5);break;case 4:d=(u*255+0.5);e=(b*255+0.5);r=(o*255+0.5);break;case 5:d=(o*255+0.5);e=(b*255+0.5);r=(a*255+0.5);break}}return{r:parseInt(d),g:parseInt(e),b:parseInt(r)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,h,p){var j;var f;var o;var q=(a>h)?a:h;if(p>q){q=p}var l=(a<h)?a:h;if(p<l){l=p}o=q/255;if(q!=0){f=(q-l)/q}else{f=0}if(f==0){j=0}else{var d=(q-a)/(q-l);var m=(q-h)/(q-l);var e=(q-p)/(q-l);if(a==q){j=e-m}else{if(h==q){j=2+d-e}else{j=4+m-d}}j=j/6;if(j<0){j=j+1}}return{h:j,s:f,b:o}};OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}))};OpenLayers.loadURL=function(e,h,b,f,d){if(typeof h=="string"){h=OpenLayers.Util.getParameters(h)}var g=(f)?f:OpenLayers.nullHandler;var a=(d)?d:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:e,params:h,success:g,failure:a,scope:b})};OpenLayers.parseXMLString=function(d){var a=d.indexOf("<");if(a>0){d=d.substring(a)}var b=OpenLayers.Util.Try(function(){var e=new ActiveXObject("Microsoft.XMLDOM");e.loadXML(d);return e},function(){return new DOMParser().parseFromString(d,"text/xml")},function(){var e=new XMLHttpRequest();e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),false);if(e.overrideMimeType){e.overrideMimeType("text/xml")}e.send(null);return e.responseXML});return b};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(b){for(var a=0;a<this.responders.length;a++){if(b==this.responders[a]){return}}this.responders.push(b)},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a)},dispatch:function(h,d,g){var a;for(var b=0;b<this.responders.length;b++){a=this.responders[b];if(a[h]&&typeof a[h]=="function"){try{a[h].apply(a,[d,g])}catch(f){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(b,a){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[a]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(b,"http")){b=OpenLayers.ProxyHost+encodeURIComponent(b)}this.transport=OpenLayers.Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var f=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){f._method=this.method;this.method="post"}this.parameters=f;if(f=OpenLayers.Util.getParameterString(f)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+f}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_="}}}try{var a=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}OpenLayers.Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(d){this.dispatchException(d)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)
}},setRequestHeaders:function(){var f={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};if(this.method=="post"){f["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){f.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var d=this.options.requestHeaders;if(typeof d.push=="function"){for(var b=0,e=d.length;b<e;b+=2){f[d[b]]=d[b+1]}}else{for(var b in d){f[b]=d[b]}}}for(var a in f){this.transport.setRequestHeader(a,f[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var d=OpenLayers.Ajax.Request.Events[a];var b=new OpenLayers.Ajax.Response(this);if(d=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(b)}catch(f){this.dispatchException(f)}var g=b.getHeader("Content-type")}try{(this.options["on"+d]||OpenLayers.Ajax.emptyFunction)(b);OpenLayers.Ajax.Responders.dispatch("on"+d,this,b)}catch(f){this.dispatchException(f)}if(d=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction}},getHeader:function(a){try{return this.transport.getResponseHeader(a)}catch(b){return null}},dispatchException:function(d){var e=this.options.onException;if(e){e(this,d);OpenLayers.Ajax.Responders.dispatch("onException",this,d)}else{var f=false;var a=OpenLayers.Ajax.Responders.responders;for(var b=0;b<a.length;b++){if(a[b].onException){f=true;break}}if(f){OpenLayers.Ajax.Responders.dispatch("onException",this,d)}else{throw d}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(d){this.request=d;var e=this.transport=d.transport,a=this.readyState=e.readyState;if((a>2&&!(!!(window.attachEvent&&!window.opera)))||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=e.responseText==null?"":String(e.responseText)}if(a==4){var b=e.responseXML;this.responseXML=b===undefined?null:b}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a)}});OpenLayers.Ajax.getElementsByTagNameNS=function(b,a,d,f){var e=null;if(b.getElementsByTagNameNS){e=b.getElementsByTagNameNS(a,f)}else{e=b.getElementsByTagName(d+":"+f)}return e};OpenLayers.Ajax.serializeXMLToString=function(a){var b=new XMLSerializer();var d=b.serializeToString(a);return d};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&a.touches.length==1},isMultiTouch:function(a){return a.touches&&a.touches.length>1},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)))},stop:function(b,a){if(!a){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}},findElement:function(d,b){var a=OpenLayers.Event.element(d);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observe:function(b,e,d,a){var f=OpenLayers.Util.getElement(b);a=a||false;if(e=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.attachEvent)){e="keydown"}if(!this.observers){this.observers={}}if(!f._eventCacheID){var g="eventCacheID_";if(f.id){g=f.id+"_"+g}f._eventCacheID=OpenLayers.Util.createUniqueID(g)}var h=f._eventCacheID;if(!this.observers[h]){this.observers[h]=[]
}this.observers[h].push({element:f,name:e,observer:d,useCapture:a});if(f.addEventListener){f.addEventListener(e,d,a)}else{if(f.attachEvent){f.attachEvent("on"+e,d)}}},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a);var d=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[d])},_removeElementObservers:function(f){if(f){for(var b=f.length-1;b>=0;b--){var d=f[b];var a=new Array(d.element,d.name,d.observer,d.useCapture);var e=OpenLayers.Event.stopObserving.apply(this,a)}}},stopObserving:function(j,a,h,b){b=b||false;var g=OpenLayers.Util.getElement(j);var e=g._eventCacheID;if(a=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.detachEvent){a="keydown"}}var m=false;var d=OpenLayers.Event.observers[e];if(d){var f=0;while(!m&&f<d.length){var l=d[f];if((l.name==a)&&(l.observer==h)&&(l.useCapture==b)){d.splice(f,1);if(d.length==0){delete OpenLayers.Event.observers[e]}m=true;break}f++}}if(m){if(g.removeEventListener){g.removeEventListener(a,h,b)}else{if(g&&g.detachEvent){g.detachEvent("on"+a,h)}}}return m},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)}else{var Event=OpenLayers.Event}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(d,f,h,g,b){OpenLayers.Util.extend(this,b);this.object=d;this.fallThrough=g;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(h!=null){for(var e=0,a=h.length;e<a;e++){this.addEventType(h[e])}}if(f!=null){this.attachToElement(f)}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[]}},attachToElement:function(e){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}this.element=e;for(var d=0,a=this.BROWSER_EVENTS.length;d<a;d++){var b=this.BROWSER_EVENTS[d];this.addEventType(b);OpenLayers.Event.observe(e,b,this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b])}}},register:function(b,e,d){if((d!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,b)!=-1)){if(e==null){e=this.object}var a=this.listeners[b];a.push({obj:e,func:d})}},registerPriority:function(b,e,d){if(d!=null){if(e==null){e=this.object}var a=this.listeners[b];if(a!=null){a.unshift({obj:e,func:d})}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b])}}},unregister:function(e,g,f){if(g==null){g=this.object}var d=this.listeners[e];if(d!=null){for(var b=0,a=d.length;b<a;b++){if(d[b].obj==g&&d[b].func==f){d.splice(b,1);break}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[]}},triggerEvent:function(f,b){var e=this.listeners[f];if(!e||e.length==0){return undefined}if(b==null){b={}}b.object=this.object;b.element=this.element;if(!b.type){b.type=f}e=e.slice();var g;for(var d=0,a=e.length;d<a;d++){var h=e[d];g=h.func.apply(h.obj,[b]);if((g!=undefined)&&(g==false)){break}}if(!this.fallThrough){OpenLayers.Event.stop(b,true)}return g},handleBrowserEvent:function(l){var f=l.type,g=this.listeners[f];
if(!g||g.length==0){return}var d=l.touches;if(d&&d[0]){var j=0;var h=0;var e=d.length;var b;for(var a=0;a<e;++a){b=d[a];j+=b.clientX;h+=b.clientY}l.clientX=j/e;l.clientY=h/e}if(this.includeXY){l.xy=this.getMousePosition(l)}this.triggerEvent(f,l)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var a=document.body;if(a&&!((a.scrollTop!=0||a.scrollLeft!=0)&&navigator.userAgent.match(/iPhone/i))){this.element.offsets=null}},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[b.scrollLeft,b.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element)}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(e){var h=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=OpenLayers.Util.applyDefaults(e,h);var g=new OpenLayers.Request.XMLHttpRequest();var a=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));var l=!(a.indexOf("http")==0);var b=!l&&a.match(this.URL_SPLIT_REGEX);if(b){var m=window.location;l=b[1]==m.protocol&&b[3]==m.hostname;var f=b[4],d=m.port;if(f!=80&&f!=""||d!="80"&&d!=""){l=l&&f==d}}if(!l){if(e.proxy){if(typeof e.proxy=="function"){a=e.proxy(a)}else{a=e.proxy+encodeURIComponent(a)}}else{OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:a})}}g.open(e.method,a,e.async,e.user,e.password);for(var j in e.headers){g.setRequestHeader(j,e.headers[j])}var p=this.events;var o=this;g.onreadystatechange=function(){if(g.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var q=p.triggerEvent("complete",{request:g,config:e,requestUrl:a});if(q!==false){o.runCallbacks({request:g,config:e,requestUrl:a})}}};if(e.async===false){g.send(e.data)}else{window.setTimeout(function(){if(g.readyState!==0){g.send(e.data)}},0)}return g},runCallbacks:function(e){var f=e.request;var d=e.config;var a=(d.scope)?OpenLayers.Function.bind(d.callback,d.scope):d.callback;var g;if(d.success){g=(d.scope)?OpenLayers.Function.bind(d.success,d.scope):d.success}var b;if(d.failure){b=(d.scope)?OpenLayers.Function.bind(d.failure,d.scope):d.failure}if(OpenLayers.Util.createUrlObject(d.url).protocol=="file:"&&f.responseText){f.status=200}a(f);if(!f.status||(f.status>=200&&f.status<300)){this.events.triggerEvent("success",e);if(g){g(f)}}if(f.status&&(f.status<200||f.status>=300)){this.events.triggerEvent("failure",e);if(b){b(f)}}},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});
return OpenLayers.Request.issue(a)}};(function(){var h=window.XMLHttpRequest;var a=!!window.controllers,m=window.document.all&&!window.opera,o=m&&window.navigator.userAgent.match(/MSIE 7.0/);function e(){this._object=h&&!o?new h:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function d(){return new e}d.prototype=e.prototype;if(a&&h.wrapped){d.wrapped=h.wrapped}d.UNSENT=0;d.OPENED=1;d.HEADERS_RECEIVED=2;d.LOADING=3;d.DONE=4;d.prototype.readyState=d.UNSENT;d.prototype.responseText="";d.prototype.responseXML=null;d.prototype.status=0;d.prototype.statusText="";d.prototype.priority="NORMAL";d.prototype.onreadystatechange=null;d.onreadystatechange=null;d.onopen=null;d.onsend=null;d.onabort=null;d.prototype.open=function(u,z,r,B,q){delete this._headers;if(arguments.length<3){r=true}this._async=r;var w=this,v=this.readyState,p;if(m&&r){p=function(){if(v!=d.DONE){f(w);w.abort()}};window.attachEvent("onunload",p)}if(d.onopen){d.onopen.apply(this,arguments)}if(arguments.length>4){this._object.open(u,z,r,B,q)}else{if(arguments.length>3){this._object.open(u,z,r,B)}else{this._object.open(u,z,r)}}this.readyState=d.OPENED;b(this);this._object.onreadystatechange=function(){if(a&&!r){return}w.readyState=w._object.readyState;j(w);if(w._aborted){w.readyState=d.UNSENT;return}if(w.readyState==d.DONE){delete w._data;f(w);if(m&&r){window.detachEvent("onunload",p)}}if(v!=w.readyState){b(w)}v=w.readyState}};function g(p){p._object.send(p._data);if(a&&!p._async){p.readyState=d.OPENED;j(p);while(p.readyState<d.DONE){p.readyState++;b(p);if(p._aborted){return}}}}d.prototype.send=function(p){if(d.onsend){d.onsend.apply(this,arguments)}if(!arguments.length){p=null}if(p&&p.nodeType){p=window.XMLSerializer?new window.XMLSerializer().serializeToString(p):p.xml;if(!oRequest._headers["Content-Type"]){oRequest._object.setRequestHeader("Content-Type","application/xml")}}this._data=p;g(this)};d.prototype.abort=function(){if(d.onabort){d.onabort.apply(this,arguments)}if(this.readyState>d.UNSENT){this._aborted=true}this._object.abort();f(this);this.readyState=d.UNSENT;delete this._data};d.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};d.prototype.getResponseHeader=function(p){return this._object.getResponseHeader(p)};d.prototype.setRequestHeader=function(p,q){if(!this._headers){this._headers={}}this._headers[p]=q;return this._object.setRequestHeader(p,q)};d.prototype.addEventListener=function(u,r,q){for(var p=0,v;v=this._listeners[p];p++){if(v[0]==u&&v[1]==r&&v[2]==q){return}}this._listeners.push([u,r,q])};d.prototype.removeEventListener=function(u,r,q){for(var p=0,v;v=this._listeners[p];p++){if(v[0]==u&&v[1]==r&&v[2]==q){break}}if(v){this._listeners.splice(p,1)}};d.prototype.dispatchEvent=function(q){var r={type:q.type,target:this,currentTarget:this,eventPhase:2,bubbles:q.bubbles,cancelable:q.cancelable,timeStamp:q.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(r.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[r])}for(var p=0,u;u=this._listeners[p];p++){if(u[0]==r.type&&!u[2]){(u[1].handleEvent||u[1]).apply(this,[r])}}};d.prototype.toString=function(){return"[object XMLHttpRequest]"};d.toString=function(){return"[XMLHttpRequest]"};function b(p){if(d.onreadystatechange){d.onreadystatechange.apply(p)}p.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})}function l(r){var q=r.responseXML,p=r.responseText;if(m&&p&&q&&!q.documentElement&&r.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){q=new window.ActiveXObject("Microsoft.XMLDOM");q.async=false;q.validateOnParse=false;q.loadXML(p)}if(q){if((m&&q.parseError!=0)||!q.documentElement||(q.documentElement&&q.documentElement.tagName=="parsererror")){return null}}return q}function j(p){try{p.responseText=p._object.responseText}catch(q){}try{p.responseXML=l(p._object)}catch(q){}try{p.status=p._object.status}catch(q){}try{p.statusText=p._object.statusText}catch(q){}}function f(p){p._object.onreadystatechange=new window.Function
}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(p,q){if(!q){q=[]}p.__func=this;p.__func(q[0],q[1],q[2],q[3],q[4]);delete p.__func}}OpenLayers.Request.XMLHttpRequest=d})();OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.projCode=b;if(window.Proj4js){this.proj=new Proj4js.Proj(b)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var f=a,b=false;if(f){if(window.Proj4js&&this.proj.defData&&f.proj.defData){b=this.proj.defData.replace(this.titleRegEx,"")==f.proj.defData.replace(this.titleRegEx,"")}else{if(f.getCode){var d=this.getCode(),e=f.getCode();b=d==e||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][e]===OpenLayers.Projection.nullTransform}}}return b},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(d,b,a){if(!OpenLayers.Projection.transforms[d]){OpenLayers.Projection.transforms[d]={}}OpenLayers.Projection.transforms[d][b]=a};OpenLayers.Projection.transform=function(a,d,b){if(d.proj&&b.proj){a=Proj4js.transform(d.proj,b.proj,a)}else{if(d&&b&&OpenLayers.Projection.transforms[d.getCode()]&&OpenLayers.Projection.transforms[d.getCode()][b.getCode()]){OpenLayers.Projection.transforms[d.getCode()][b.getCode()](a)}}return a};OpenLayers.Projection.nullTransform=function(a){return a};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","preremovelayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(a,l){if(arguments.length===1&&typeof a==="object"){l=a;a=l&&l.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,l);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(a);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var d=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);var f=document.createElement("div");f.id=this.id+"_events";f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.style.zIndex=this.Z_INDEX_BASE.Control-1;this.viewPortDiv.appendChild(f);this.eventsDiv=f;this.events=new OpenLayers.Events(this,this.eventsDiv,this.EVENT_TYPES,this.fallThrough,{includeXY:true});d=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(d);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.eventsDiv.appendChild(this.layerContainerDiv);
this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var e=true;var b=document.getElementsByTagName("link");for(var g=0,h=b.length;g<h;++g){if(OpenLayers.Util.isEquivalentUrl(b.item(g).href,this.theme)){e=false;break}}if(e){var j=document.createElement("link");j.setAttribute("rel","stylesheet");j.setAttribute("type","text/css");j.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(j)}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var g=0,h=this.controls.length;g<h;g++){this.addControlToMap(this.controls[g])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(l&&l.layers){delete this.center;this.addLayers(l.layers);if(l.center){this.setCenter(l.center,l.zoom)}}},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy()}this.controls=null}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a);b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})},getTileSize:function(){return this.tileSize},getBy:function(f,d,a){var e=(typeof a.test=="function");var b=OpenLayers.Array.filter(this[f],function(g){return g[d]==a||(e&&a.test(g[d]))});return b},getLayersBy:function(b,a){return this.getBy("layers",b,a)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(b,a){return this.getBy("controls",b,a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(f){var b=null;for(var e=0,a=this.layers.length;e<a;e++){var d=this.layers[e];if(d.id==f){b=d;break}}return b},setLayerZIndex:function(b,a){b.setZIndex(this.Z_INDEX_BASE[b.isBaseLayer?"BaseLayer":"Overlay"]+a*5)},resetLayersZIndex:function(){for(var d=0,a=this.layers.length;d<a;d++){var b=this.layers[d];this.setLayerZIndex(b,d)}},addLayer:function(d){for(var b=0,a=this.layers.length;b<a;b++){if(this.layers[b]==d){var e=OpenLayers.i18n("layerAlreadyAdded",{layerName:d.name});OpenLayers.Console.warn(e);return false}}if(this.events.triggerEvent("preaddlayer",{layer:d})===false){return}if(this.allOverlays){d.isBaseLayer=false}d.div.className="olLayerDiv";d.div.style.overflow="";this.setLayerZIndex(d,this.layers.length);if(d.isFixed){this.viewPortDiv.appendChild(d.div)}else{this.layerContainerDiv.appendChild(d.div)}this.layers.push(d);d.setMap(this);if(d.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(d)
}else{d.setVisibility(false)}}else{d.redraw()}this.events.triggerEvent("addlayer",{layer:d});d.events.triggerEvent("added",{map:this,layer:d});d.afterAdd()},addLayers:function(d){for(var b=0,a=d.length;b<a;b++){this.addLayer(d[b])}},removeLayer:function(d,f){if(this.events.triggerEvent("preremovelayer",{layer:d})===false){return}if(f==null){f=true}if(d.isFixed){this.viewPortDiv.removeChild(d.div)}else{this.layerContainerDiv.removeChild(d.div)}OpenLayers.Util.removeItem(this.layers,d);d.removeMap(this);d.map=null;if(this.baseLayer==d){this.baseLayer=null;if(f){for(var b=0,a=this.layers.length;b<a;b++){var e=this.layers[b];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:d});d.events.triggerEvent("removed",{map:this,layer:d})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(e,b){var f=this.getLayerIndex(e);if(b<0){b=0}else{if(b>this.layers.length){b=this.layers.length}}if(f!=b){this.layers.splice(f,1);this.layers.splice(b,0,e);for(var d=0,a=this.layers.length;d<a;d++){this.setLayerZIndex(this.layers[d],d)}this.events.triggerEvent("changelayer",{layer:e,property:"order"});if(this.allOverlays){if(b===0){this.setBaseLayer(e)}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}}},raiseLayer:function(b,d){var a=this.getLayerIndex(b)+d;this.setLayerIndex(b,a)},setBaseLayer:function(d){if(d!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,d)!=-1){var a=this.getCachedCenter();var e=OpenLayers.Util.getResolutionFromScale(this.getScale(),d.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=d;this.viewRequestID++;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true)}if(a!=null){var b=this.getZoomForResolution(e||this.resolution,true);this.setCenter(a,b,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(b,a){this.controls.push(b);this.addControlToMap(b,a)},addControls:function(b,h){var f=(arguments.length===1)?[]:h;for(var e=0,a=b.length;e<a;e++){var g=b[e];var d=(f[e])?f[e]:null;this.addControl(g,d)}},addControlToMap:function(b,a){b.outsideViewport=(b.div!=null);if(this.displayProjection&&!b.displayProjection){b.displayProjection=this.displayProjection}b.setMap(this);var d=b.draw(a);if(d){if(!b.outsideViewport){d.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(d)}}if(b.autoActivate){b.activate()}},getControl:function(f){var b=null;for(var d=0,a=this.controls.length;d<a;d++){var e=this.controls[d];if(e.id==f){b=e;break}}return b},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if(a.div&&(a.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.controls,a)}},addPopup:function(a,e){if(e){for(var b=this.popups.length-1;b>=0;--b){this.removePopup(this.popups[b])}}a.map=this;this.popups.push(a);var d=a.draw();if(d){d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(d)}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div)}catch(b){}}a.map=null},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone()}return a},updateSize:function(){var d=this.getCurrentSize();if(d&&!isNaN(d.h)&&!isNaN(d.w)){this.events.clearMouseCache();var g=this.getSize();if(g==null){this.size=g=d}if(!d.equals(g)){this.size=d;for(var e=0,b=this.layers.length;e<b;e++){this.layers[e].onMapResize()}var a=this.getCachedCenter();if(this.baseLayer!=null&&a!=null){var f=this.getZoom();this.zoom=null;this.setCenter(a,f)}}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=this.div.offsetWidth;a.h=this.div.offsetHeight}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height)
}return a},calculateBounds:function(a,b){var f=null;if(a==null){a=this.getCachedCenter()}if(b==null){b=this.getResolution()}if((a!=null)&&(b!=null)){var e=this.getSize();var g=e.w*b;var d=e.h*b;f=new OpenLayers.Bounds(a.lon-g/2,a.lat-d/2,a.lon+g/2,a.lat+d/2)}return f},getCenter:function(){var a=null;var b=this.getCachedCenter();if(b){a=b.clone()}return a},getCachedCenter:function(){if(!this.center&&this.size){this.center=this.getLonLatFromViewPortPx(new OpenLayers.Pixel(this.size.w/2,this.size.h/2))}return this.center},getZoom:function(){return this.zoom},pan:function(e,d,f){f=OpenLayers.Util.applyDefaults(f,{animate:true,dragging:false});if(f.dragging){if(e!=0||d!=0){this.moveByPx(e,d)}}else{var g=this.getViewPortPxFromLonLat(this.getCachedCenter());var b=g.add(e,d);if(this.dragging||!b.equals(g)){var a=this.getLonLatFromViewPortPx(b);if(f.animate){this.panTo(a)}else{this.moveTo(a);this.dragging=false;this.events.triggerEvent("moveend")}}}},panTo:function(e){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(e)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)}var a=this.getCachedCenter();if(e.equals(a)){return}var g=this.getPixelFromLonLat(a);var f=this.getPixelFromLonLat(e);var b={x:f.x-g.x,y:f.y-g.y};var d={x:0,y:0};this.panTween.start({x:0,y:0},b,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(j){var h=j.x-d.x,l=j.y-d.y;this.moveByPx(h,l);d.x=Math.round(j.x);d.y=Math.round(j.y)},this),done:OpenLayers.Function.bind(function(h){this.moveTo(e);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(e)}},setCenter:function(d,a,b,e){this.panTween&&this.panTween.stop();this.moveTo(d,a,{dragging:b,forceZoomChange:e})},moveByPx:function(r,q){var j=this.size.w/2;var d=this.size.h/2;var o=j+r;var m=d+q;var e=this.baseLayer.wrapDateLine;var p=0;var l=0;if(this.restrictedExtent){p=j;l=d;e=false}r=e||o<=this.maxPx.x-p&&o>=this.minPx.x+p?Math.round(r):0;q=m<=this.maxPx.y-l&&m>=this.minPx.y+l?Math.round(q):0;var b=this.minPx.x,a=this.maxPx.x;if(r||q){if(!this.dragging){this.dragging=true;this.events.triggerEvent("movestart")}this.center=null;if(r){this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-r+"px";this.minPx.x-=r;this.maxPx.x-=r;if(e){if(this.maxPx.x>a){this.maxPx.x-=(a-b)}if(this.minPx.x<b){this.minPx.x+=(a-b)}}}if(q){this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-q+"px";this.minPx.y-=q;this.maxPx.y-=q}var g,f,h;for(f=0,h=this.layers.length;f<h;++f){g=this.layers[f];if(g.visibility&&(g===this.baseLayer||g.inRange)){g.moveByPx(r,q);g.events.triggerEvent("move")}}this.events.triggerEvent("move")}},moveTo:function(l,b,f){if(!f){f={}}if(b!=null){b=parseFloat(b);if(!this.fractionalZoom){b=Math.round(b)}}var v=f.dragging||this.dragging;var o=f.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(l)){l=this.maxExtent.getCenterLonLat();this.center=l.clone()}if(this.restrictedExtent!=null){if(l==null){l=this.center}if(b==null){b=this.getZoom()}var w=this.getResolutionForZoom(b);var q=this.calculateBounds(l,w);if(!this.restrictedExtent.containsBounds(q)){var F=this.restrictedExtent.getCenterLonLat();if(q.getWidth()>this.restrictedExtent.getWidth()){l=new OpenLayers.LonLat(F.lon,l.lat)}else{if(q.left<this.restrictedExtent.left){l=l.add(this.restrictedExtent.left-q.left,0)}else{if(q.right>this.restrictedExtent.right){l=l.add(this.restrictedExtent.right-q.right,0)}}}if(q.getHeight()>this.restrictedExtent.getHeight()){l=new OpenLayers.LonLat(l.lon,F.lat)}else{if(q.bottom<this.restrictedExtent.bottom){l=l.add(0,this.restrictedExtent.bottom-q.bottom)}else{if(q.top>this.restrictedExtent.top){l=l.add(0,this.restrictedExtent.top-q.top)}}}}}var p=o||((this.isValidZoomLevel(b))&&(b!=this.getZoom()));var j=(this.isValidLonLat(l))&&(!l.equals(this.center));if(p||j||v){v||this.events.triggerEvent("movestart");if(j){if(!p&&this.center){this.centerLayerContainer(l)}this.center=l.clone()}var G=p?this.getResolutionForZoom(b):this.getResolution();if(p||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();
this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var u=this.getMaxExtent({restricted:true});var e=u.getCenterLonLat();var m=this.center.lon-e.lon;var d=e.lat-this.center.lat;var D=Math.round(u.getWidth()/G);var C=Math.round(u.getHeight()/G);var g=(this.size.w-D)/2-m/G;var r=(this.size.h-C)/2-d/G;this.minPx=new OpenLayers.Pixel(g,r);this.maxPx=new OpenLayers.Pixel(g+D,r+C)}if(p){this.zoom=b;this.resolution=G;this.viewRequestID++}var h=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(h,p,f.dragging);f.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:p})}h=this.baseLayer.getExtent();for(var z=this.layers.length-1;z>=0;--z){var E=this.layers[z];if(E!==this.baseLayer&&!E.isBaseLayer){var a=E.calculateInRange();if(E.inRange!=a){E.inRange=a;if(!a){E.display(false)}this.events.triggerEvent("changelayer",{layer:E,property:"visibility"})}if(a&&E.visibility){E.moveTo(h,p,f.dragging);f.dragging||E.events.triggerEvent("moveend",{zoomChanged:p})}}}this.events.triggerEvent("move");v||this.events.triggerEvent("moveend");if(p){for(var z=0,B=this.popups.length;z<B;z++){this.popups[z].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(d){var e=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var h=this.getViewPortPxFromLonLat(d);if((e!=null)&&(h!=null)){var a=parseInt(this.layerContainerDiv.style.left);var b=parseInt(this.layerContainerDiv.style.top);var g=Math.round(e.x-h.x);var f=Math.round(e.y-h.y);this.layerContainerDiv.style.left=g+"px";this.layerContainerDiv.style.top=f+"px";var l=a-g;var j=b-f;this.minPx.x-=l;this.maxPx.x-=l;this.minPx.y-=j;this.maxPx.y-=j}},isValidZoomLevel:function(a){return((a!=null)&&(a>=0)&&(a<this.getNumZoomLevels()))},isValidLonLat:function(d){var b=false;if(d!=null){var a=this.getMaxExtent();b=a.containsLonLat(d)}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection}return a},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution}return a},getMaxExtent:function(b){var a=null;if(b&&b.restricted&&this.restrictedExtent){a=this.restrictedExtent}else{if(this.baseLayer!=null){a=this.baseLayer.maxExtent}}return a},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels}return a},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent()}return a},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution()}else{if(this.allOverlays===true&&this.layers.length>0){a=this.layers[0].getResolution()}}return a},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units}return a},getScale:function(){var d=null;if(this.baseLayer!=null){var b=this.getResolution();var a=this.baseLayer.units;d=OpenLayers.Util.getScaleFromResolution(b,a)}return d},getZoomForExtent:function(d,b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getZoomForExtent(d,b)}return a},getResolutionForZoom:function(b){var a=null;if(this.baseLayer){a=this.baseLayer.getResolutionForZoom(b)}return a},getZoomForResolution:function(a,d){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForResolution(a,d)}return b},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,d){var b=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var a=this.getMaxExtent();e=e.clone();while(e.right<e.left){e.right+=a.getWidth()}b=e.getCenterLonLat().wrapDateLine(a)}this.setCenter(b,this.getZoomForExtent(e,d))},zoomToMaxExtent:function(d){var b=(d)?d.restricted:true;var a=this.getMaxExtent({restricted:b});this.zoomToExtent(a)},zoomToScale:function(j,h){var e=OpenLayers.Util.getResolutionFromScale(j,this.baseLayer.units);var d=this.getSize();var g=d.w*e;var b=d.h*e;var a=this.getCachedCenter();var f=new OpenLayers.Bounds(a.lon-g/2,a.lat-b/2,a.lon+g/2,a.lat+b/2);
this.zoomToExtent(f,h)},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getLonLatFromViewPortPx(a)}return b},getViewPortPxFromLonLat:function(b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getViewPortPxFromLonLat(b)}return a},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(b){var a=this.getViewPortPxFromLonLat(b);a.x=Math.round(a.x);a.y=Math.round(a.y);return a},getGeodesicPixelSize:function(h){var e=h?this.getLonLatFromPixel(h):(this.getCachedCenter()||new OpenLayers.LonLat(0,0));var f=this.getResolution();var d=e.add(-f/2,0);var l=e.add(f/2,0);var b=e.add(0,-f/2);var g=e.add(0,f/2);var j=new OpenLayers.Projection("EPSG:4326");var a=this.getProjectionObject()||j;if(!a.equals(j)){d.transform(a,j);l.transform(a,j);b.transform(a,j);g.transform(a,j)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(d,l),OpenLayers.Util.distVincenty(b,g))},getViewPortPxFromLayerPx:function(e){var d=null;if(e!=null){var b=parseInt(this.layerContainerDiv.style.left);var a=parseInt(this.layerContainerDiv.style.top);d=e.add(b,a)}return d},getLayerPxFromViewPortPx:function(d){var e=null;if(d!=null){var b=-parseInt(this.layerContainerDiv.style.left);var a=-parseInt(this.layerContainerDiv.style.top);e=d.add(b,a);if(isNaN(e.x)||isNaN(e.y)){e=null}}return e},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(b){var a=this.getPixelFromLonLat(b);return this.getLayerPxFromViewPortPx(a)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend","added","removed"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(b,a){this.addOptions(a);this.name=b;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true}},destroy:function(a){if(a==null){a=true}if(this.map!=null){this.map.removeLayer(this,a)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.getOptions())}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},getOptions:function(){var a={};for(var b in this.options){a[b]=this[b]}return a},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(f,a){if(this.options==null){this.options={}}OpenLayers.Util.extend(this.options,f);OpenLayers.Util.extend(this,f);if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()}if(this.map){var b=this.map.getResolution();var d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in f){if(f.hasOwnProperty(e)&&OpenLayers.Util.indexOf(d,e)>=0){this.initResolutions();
if(a&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(b),false,true);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}}},onMapResize:function(){},redraw:function(){var b=false;if(this.map){this.inRange=this.calculateInRange();var d=this.getExtent();if(d&&this.inRange&&this.visibility){var a=true;this.moveTo(d,a,false);this.events.triggerEvent("moveend",{zoomChanged:a});b=true}}return b},moveTo:function(b,a,d){var e=this.visibility;if(!this.isBaseLayer){e=e&&this.inRange}this.display(e)},moveByPx:function(b,a){},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return(this.imageSize||this.tileSize)},setTileSize:function(a){var b=(a)?a:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=b;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(b.w+(2*this.gutter),b.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(a){if(a!=(this.div.style.display!="none")){this.div.style.display=(a&&this.calculateInRange())?"block":"none"}},calculateInRange:function(){var b=false;if(this.alwaysInRange){b=true}else{if(this.map){var a=this.map.getResolution();b=((a>=this.minResolution)&&(a<=this.maxResolution))}}return b},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var f,a,j;var g={},e=true;for(f=0,a=this.RESOLUTION_PROPERTIES.length;f<a;f++){j=this.RESOLUTION_PROPERTIES[f];g[j]=this.options[j];if(e&&this.options[j]){e=false}}if(this.alwaysInRange==null){this.alwaysInRange=e}if(g.resolutions==null){g.resolutions=this.resolutionsFromScales(g.scales)}if(g.resolutions==null){g.resolutions=this.calculateResolutions(g)}if(g.resolutions==null){for(f=0,a=this.RESOLUTION_PROPERTIES.length;f<a;f++){j=this.RESOLUTION_PROPERTIES[f];g[j]=this.options[j]!=null?this.options[j]:this.map[j]}if(g.resolutions==null){g.resolutions=this.resolutionsFromScales(g.scales)}if(g.resolutions==null){g.resolutions=this.calculateResolutions(g)}}var d;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){d=this.options.maxResolution}if(this.options.minScale){d=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)}var b;if(this.options.minResolution&&this.options.minResolution!=="auto"){b=this.options.minResolution}if(this.options.maxScale){b=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)}if(g.resolutions){g.resolutions.sort(function(m,l){return(l-m)});if(!d){d=g.resolutions[0]}if(!b){var h=g.resolutions.length-1;b=g.resolutions[h]}}this.resolutions=g.resolutions;if(this.resolutions){a=this.resolutions.length;this.scales=new Array(a);for(f=0;f<a;f++){this.scales[f]=OpenLayers.Util.getScaleFromResolution(this.resolutions[f],this.units)}this.numZoomLevels=a}this.minResolution=b;if(b){this.maxScale=OpenLayers.Util.getScaleFromResolution(b,this.units)}this.maxResolution=d;if(d){this.minScale=OpenLayers.Util.getScaleFromResolution(d,this.units)}},resolutionsFromScales:function(e){if(e==null){return}var b,d,a;a=e.length;b=new Array(a);for(d=0;d<a;d++){b[d]=OpenLayers.Util.getResolutionFromScale(e[d],this.units)}return b
},calculateResolutions:function(m){var o,l,h;var p=m.maxResolution;if(m.minScale!=null){p=OpenLayers.Util.getResolutionFromScale(m.minScale,this.units)}else{if(p=="auto"&&this.maxExtent!=null){o=this.map.getSize();l=this.maxExtent.getWidth()/o.w;h=this.maxExtent.getHeight()/o.h;p=Math.max(l,h)}}var g=m.minResolution;if(m.maxScale!=null){g=OpenLayers.Util.getResolutionFromScale(m.maxScale,this.units)}else{if(m.minResolution=="auto"&&this.minExtent!=null){o=this.map.getSize();l=this.minExtent.getWidth()/o.w;h=this.minExtent.getHeight()/o.h;g=Math.max(l,h)}}var a=m.maxZoomLevel;var b=m.numZoomLevels;if(typeof g==="number"&&typeof p==="number"&&b===undefined){var j=p/g;b=Math.floor(Math.log(j)/Math.log(2))+1}else{if(b===undefined&&a!=null){b=a+1}}if(typeof b!=="number"||b<=0||(typeof p!=="number"&&typeof g!=="number")){return}var e=new Array(b);var d=2;if(typeof g=="number"&&typeof p=="number"){d=Math.pow((p/g),(1/(b-1)))}var f;if(typeof p==="number"){for(f=0;f<b;f++){e[f]=p/Math.pow(d,f)}}else{for(f=0;f<b;f++){e[b-1-f]=g*Math.pow(d,f)}}return e},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(b,d){var e=this.map.getSize();var a=Math.max(b.getWidth()/e.w,b.getHeight()/e.h);return this.getZoomForResolution(a,d)},getDataExtent:function(){},getResolutionForZoom:function(d){d=Math.max(0,Math.min(d,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var a=Math.floor(d);var e=Math.ceil(d);b=this.resolutions[a]-((d-a)*(this.resolutions[a]-this.resolutions[e]))}else{b=this.resolutions[Math.round(d)]}return b},getZoomForResolution:function(f,b){var q,g,h;if(this.map.fractionalZoom){var m=0;var d=this.resolutions.length-1;var e=this.resolutions[m];var a=this.resolutions[d];var l;for(g=0,h=this.resolutions.length;g<h;++g){l=this.resolutions[g];if(l>=f){e=l;m=g}if(l<=f){a=l;d=g;break}}var j=e-a;if(j>0){q=m+((e-f)/j)}else{q=m}}else{var o;var p=Number.POSITIVE_INFINITY;for(g=0,h=this.resolutions.length;g<h;g++){if(b){o=Math.abs(this.resolutions[g]-f);if(o>p){break}p=o}else{if(this.resolutions[g]<f){break}}}q=Math.max(0,g-1)}return q},getLonLatFromViewPortPx:function(b){var e=null;var g=this.map;if(b!=null&&g.minPx){var d=g.getResolution();var a=g.getMaxExtent({restricted:true});var h=(b.x-g.minPx.x)*d+a.left;var f=(g.minPx.y-b.y)*d+a.top;e=new OpenLayers.LonLat(h,f);if(this.wrapDateLine){e=e.wrapDateLine(this.maxExtent)}}return e},getViewPortPxFromLonLat:function(e){var b=null;if(e!=null){var a=this.map.getResolution();var d=this.map.getExtent();b=new OpenLayers.Pixel((1/a*(e.lon-d.left)),(1/a*(d.top-e.lat)))}return b},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var e=0,a=this.div.childNodes.length;e<a;++e){var d=this.div.childNodes[e].firstChild;OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,b)}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(b){if(this.gutter){var a=this.gutter*this.map.getResolution();b=new OpenLayers.Bounds(b.left-a,b.bottom-a,b.right+a,b.top+a)}if(this.wrapDateLine){var d={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};b=b.wrapDateLine(this.maxExtent,d)}return b},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,e,d){this.url=a;this.size=(b)?b:new OpenLayers.Size(20,20);this.offset=e?e:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=d;var f=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(f)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){if(a!=null){this.size=a}this.draw()
},setUrl:function(a){if(a!=null){this.url=a}this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)}},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null){this.px=a}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b)}}},display:function(a){this.imageDiv.style.display=(a)?"":"none"},isDrawn:function(){var a=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return a},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(d,b){this.lonlat=d;var a=(b)?b:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=a}else{this.icon.url=a.url;this.icon.size=a.size;this.icon.offset=a.offset;this.icon.calculateOffset=a.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(a){return this.icon.draw(a)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(a){if((a!=null)&&(this.icon!=null)){this.icon.moveTo(a)}this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=(this.icon&&this.icon.isDrawn());return a},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},inflate:function(b){if(this.icon){var a=new OpenLayers.Size(this.icon.size.w*b,this.icon.size.h*b);this.icon.setSize(a)}},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var a=OpenLayers.Util.getImagesLocation()+"marker.png";var b=new OpenLayers.Size(21,25);var d=function(e){return new OpenLayers.Pixel(-(e.w/2),-e.h)};return new OpenLayers.Icon(a,b,null,d)};OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(b,d,a){this.bounds=b;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div,null);this.setBorder(d,a)},destroy:function(){this.bounds=null;this.div=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){if(!a){a="red"}if(!b){b=2}this.div.style.border=b+"px solid "+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,null,a,b);return this.div},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsBounds(this.bounds,true,true)}return b},display:function(a){this.div.style.display=(a)?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(h,d,g,b,f,e){if(h==null){h=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=h;this.lonlat=d;this.contentSize=(g!=null)?g:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(b!=null){this.contentHTML=b}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");
this.div.className=this.displayClass;var a=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(a,null,null,null,"relative",null,"hidden");var h=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(h,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(f){this.addCloseBox(e)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(!this.disableFirefoxOverflowHack&&OpenLayers.BROWSER_NAME=="firefox"){this.map.events.register("movestart",this,function(){var b=document.defaultView.getComputedStyle(this.contentDiv,null);var d=b.getPropertyValue("overflow");if(d!="hidden"){this.contentDiv._oldOverflow=d;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null}})}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a)}}},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){this.div.style.display="";if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){this.div.style.display="none"},setSize:function(d){this.size=d.clone();var b=this.getContentDivPadding();var a=b.left+b.right;var f=b.top+b.bottom;this.fixPadding();a+=this.padding.left+this.padding.right;f+=this.padding.top+this.padding.bottom;if(this.closeDiv){var e=parseInt(this.closeDiv.style.width);a+=e+b.right}this.size.w+=a;this.size.h+=f;if(OpenLayers.BROWSER_NAME=="msie"){this.contentSize.w+=b.left+b.right;this.contentSize.h+=b.bottom+b.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=d.w+"px";this.contentDiv.style.height=d.h+"px"}},updateSize:function(){var f="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var j=(this.map)?this.map.layerContainerDiv:document.body;var l=OpenLayers.Util.getRenderedDimensions(f,null,{displayClass:this.displayClass,containerElement:j});var h=this.getSafeContentSize(l);var g=null;if(h.equals(l)){g=l}else{var b=new OpenLayers.Size();b.w=(h.w<l.w)?h.w:null;b.h=(h.h<l.h)?h.h:null;if(b.w&&b.h){g=h}else{var e=OpenLayers.Util.getRenderedDimensions(f,b,{displayClass:this.contentDisplayClass,containerElement:j});var d=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((d!="hidden")&&(e.equals(h))){var a=OpenLayers.Util.getScrollbarWidth();if(b.w){e.h+=a}else{e.w+=a}}g=this.getSafeContentSize(e)}}this.setSize(g)},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(a){if(a!=undefined){this.opacity=a}if(this.div!=null){this.div.style.opacity=this.opacity;
this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(a){if(a!=undefined){this.border=a}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(a){if(a!=null){this.contentHTML=a}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var g=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)};var b=this.contentDiv.getElementsByTagName("img");for(var f=0,a=b.length;f<a;f++){var d=b[f];if(d.width==0||d.height==0){var e={popup:this,img:d};d._onImgLoad=OpenLayers.Function.bind(g,e);OpenLayers.Event.observe(d,"load",d._onImgLoad)}}},getSafeContentSize:function(o){var e=o.clone();var l=this.getContentDivPadding();var m=l.left+l.right;var h=l.top+l.bottom;this.fixPadding();m+=this.padding.left+this.padding.right;h+=this.padding.top+this.padding.bottom;if(this.closeDiv){var d=parseInt(this.closeDiv.style.width);m+=d+l.right}if(this.minSize){e.w=Math.max(e.w,(this.minSize.w-m));e.h=Math.max(e.h,(this.minSize.h-h))}if(this.maxSize){e.w=Math.min(e.w,(this.maxSize.w-m));e.h=Math.min(e.h,(this.maxSize.h-h))}if(this.map&&this.map.size){var g=0,f=0;if(this.keepInMap&&!this.panMapIfOutOfView){var j=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":g=j.x;f=this.map.size.h-j.y;break;case"tl":g=this.map.size.w-j.x;f=this.map.size.h-j.y;break;case"bl":g=this.map.size.w-j.x;f=j.y;break;case"br":g=j.x;f=j.y;break;default:g=j.x;f=this.map.size.h-j.y;break}}var a=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-h-f;var b=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-m-g;e.w=Math.min(e.w,b);e.h=Math.min(e.h,a)}return e},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return a},addCloseBox:function(d){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);var a=d||function(f){this.hide();OpenLayers.Event.stop(f)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(a,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))},panIntoView:function(){var f=this.map.getSize();var e=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var d=e.clone();if(e.x<this.map.paddingForPopups.left){d.x=this.map.paddingForPopups.left}else{if((e.x+this.size.w)>(f.w-this.map.paddingForPopups.right)){d.x=f.w-this.map.paddingForPopups.right-this.size.w}}if(e.y<this.map.paddingForPopups.top){d.y=this.map.paddingForPopups.top}else{if((e.y+this.size.h)>(f.h-this.map.paddingForPopups.bottom)){d.y=f.h-this.map.paddingForPopups.bottom-this.size.h}}var b=e.x-d.x;var a=e.y-d.y;this.map.pan(b,a)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);function a(b){OpenLayers.Event.stop(b,true)}this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:a,scope:this})},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true)
},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true)}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true)}},onclick:function(a){OpenLayers.Event.stop(a,true)},onmouseout:function(a){this.mousedown=false},ondblclick:function(a){OpenLayers.Event.stop(a,true)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(f,a,g,d,e,b){this.layer=f;this.position=a.clone();this.bounds=g.clone();this.url=d;if(e){this.size=e.clone()}this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);OpenLayers.Util.extend(this,b)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)}OpenLayers.Util.applyDefaults(a,this);return a},draw:function(){var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));this.shouldDraw=(b||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw},moveTo:function(b,a,d){if(d==null){d=true}this.bounds=b.clone();this.position=a.clone();if(d){this.draw()}},clear:function(){},getBoundsFromBaseLayer:function(a){var g=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(g);var e=this.layer.map.getLonLatFromLayerPx(a);var d=a.clone();d.x+=this.size.w;d.y+=this.size.h;var b=this.layer.map.getLonLatFromLayerPx(d);if(e.lon>b.lon){if(e.lon<0){e.lon=-180-(e.lon+180)}else{b.lon=180+b.lon+180}}var f=new OpenLayers.Bounds(e.lon,b.lat,b.lon,e.lat);return f},showTile:function(){if(this.shouldDraw){this.show()}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,isFirstDraw:true,backBufferTile:null,maxGetUrlLength:null,initialize:function(f,a,g,d,e,b){OpenLayers.Tile.prototype.initialize.apply(this,arguments);if(this.maxGetUrlLength!=null){OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)}this.url=d;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){this.removeImgDiv()}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else{if(this.backBufferTile){this.backBufferTile.clear()}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}}if(!a){return false}if(this.isLoading){this.events.triggerEvent("reload")
}else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));if(b){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile()}this.backBufferTile.hide()}},renderTile:function(){if(this.layer.async){this.initImgDiv();this.layer.getURLasync(this.bounds,this,"url",this.positionImage)}else{this.url=this.layer.getURL(this.bounds);this.initImgDiv();this.positionImage()}return true},positionImage:function(){if(this.layer===null){return}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var a=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url)}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}}},initImgDiv:function(){if(this.imgDiv==null){var e=this.layer.imageOffset;var b=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,e,b,null,"relative",null,null,null,true)}else{this.imgDiv=OpenLayers.Util.createImage(null,e,b,null,"relative",null,null,true)}if(OpenLayers.Util.isArray(this.layer.url)){this.imgDiv.urls=this.layer.url.slice()}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var d=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(d,this))}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(d,this))}var a=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){d.call(this)}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(a,this))}this.imgDiv.viewRequestID=this.layer.map.viewRequestID},removeImgDiv:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null;var a=this.imgDiv.firstChild;if(a){OpenLayers.Event.stopObservingElement(a);this.imgDiv.removeChild(a);delete a}else{this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide()}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return}var e=1;if(this.backBufferTile.resolution){e=this.backBufferTile.resolution/this.layer.getResolution()}if(e!=1){if(this.layer.transitionEffect=="resize"){var d=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var b=new OpenLayers.Size(this.backBufferTile.size.w*e,this.backBufferTile.size.h*e);var a=this.layer.map.getLayerPxFromLonLat(d);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,a,b);var f=this.backBufferTile.imageSize;f=new OpenLayers.Size(f.w*e,f.h*e);var g=this.backBufferTile.imageOffset;if(g){g=new OpenLayers.Pixel(g.x*e,g.y*e)}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,g,f);this.backBufferTile.show()}}else{if(this.layer.singleTile){this.backBufferTile.show()}else{this.backBufferTile.hide()}}},show:function(){this.frame.style.display="";
if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(OpenLayers.IS_GECKO===true){this.frame.scrollLeft=this.frame.scrollLeft}}},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.BROWSER_NAME=="safari"||OpenLayers.BROWSER_NAME=="opera");OpenLayers.Tile.Image.IFrame={useIFrame:null,clear:function(){if(this.useIFrame){if(this.imgDiv){var a=this.imgDiv.firstChild;OpenLayers.Event.stopObservingElement(a);this.imgDiv.removeChild(a);delete a}}else{OpenLayers.Tile.Image.prototype.clear.apply(this,arguments)}},renderTile:function(){if(OpenLayers.Tile.Image.prototype.renderTile.apply(this,arguments)&&this.useIFrame){var a=this.createRequestForm();this.imgDiv.appendChild(a);a.submit();this.imgDiv.removeChild(a);delete a}return true},initImgDiv:function(){this.useIFrame=this.maxGetUrlLength!==null&&!this.layer.async&&this.url.length>this.maxGetUrlLength;if(this.imgDiv!=null){var b=this.imgDiv.nodeName.toLowerCase();if((this.useIFrame&&b=="img")||(!this.useIFrame&&b=="div")){this.removeImgDiv();this.imgDiv=null}}if(this.useIFrame){if(this.imgDiv==null){var a=document.createElement("div");if(OpenLayers.BROWSER_NAME=="msie"){a.style.backgroundColor="#FFFFFF";a.style.filter="chroma(color=#FFFFFF)"}OpenLayers.Util.modifyDOMElement(a,null,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute");this.imgDiv=document.createElement("div");this.imgDiv.appendChild(a);OpenLayers.Util.modifyDOMElement(this.imgDiv,this.id,null,this.layer.getImageSize(),"relative");this.imgDiv.className="olTileImage";this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map}this.imgDiv.viewRequestID=this.layer.map.viewRequestID}else{OpenLayers.Tile.Image.prototype.initImgDiv.apply(this,arguments)}},createIFrame:function(){var d=this.id+"_iFrame";var a;if(OpenLayers.BROWSER_NAME=="msie"){a=document.createElement('<iframe name="'+d+'">');a.style.backgroundColor="#FFFFFF";a.style.filter="chroma(color=#FFFFFF)"}else{a=document.createElement("iframe");a.style.backgroundColor="transparent";a.name=d}a.id=d;a.scrolling="no";a.marginWidth="0px";a.marginHeight="0px";a.frameBorder="0";OpenLayers.Util.modifyDOMElement(a,d,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute");var b=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(b,this));return a},createRequestForm:function(){var b=document.createElement("form");b.method="POST";var g=this.layer.params._OLSALT;g=(g?g+"_":"")+this.bounds.toBBOX();b.action=OpenLayers.Util.urlAppend(this.layer.url,g);this.imgDiv.insertBefore(this.createIFrame(),this.imgDiv.firstChild);b.target=this.id+"_iFrame";var d=this.layer.getImageSize();var f=OpenLayers.Util.getParameters(this.url);for(var a in f){var e=document.createElement("input");e.type="hidden";e.name=a;e.value=f[a];b.appendChild(e)}return b}};OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(d,b,f,e,a){this.url=b;this.extent=f;this.maxExtent=f;this.size=e;OpenLayers.Layer.prototype.initialize.apply(this,[d,a]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(f,a,g){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
var b=(this.tile==null);if(a||b){this.setTileSize();var e=new OpenLayers.LonLat(this.extent.left,this.extent.top);var d=this.map.getLayerPxFromLonLat(e);if(b){this.tile=new OpenLayers.Tile.Image(this,d,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=d.clone()}this.tile.draw()}},setTileSize:function(){var b=this.extent.getWidth()/this.map.getResolution();var a=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(b,a)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;this.pane=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.BROWSER_NAME=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"}if(this.isFixed){this.map.eventsDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(a){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var h=this.map.getSize();var a=Math.min(h.w,300);var f=Math.min(h.h,200);var b=new OpenLayers.Size(a,f);var e=new OpenLayers.Pixel(h.w/2,h.h/2);var d=e.add(-b.w/2,-b.h/2);var g=OpenLayers.Util.createDiv(this.name+"_warning",d,b,null,null,null,"auto");g.style.padding="7px";g.style.backgroundColor="yellow";g.innerHTML=this.getWarningHTML();this.div.appendChild(g)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(b,a){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);if(this.dragPanMapObject){this.dragPanMapObject(b,-a)}else{this.moveTo(this.map.getCachedCenter())}},moveTo:function(d,e,m){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var f=this.map.getCenter();var h=this.map.getZoom();if(f!=null){var g=this.getMapObjectCenter();var b=this.getOLLonLatFromMapObjectLonLat(g);var j=this.getMapObjectZoom();var q=this.getOLZoomFromMapObjectZoom(j);if(!(f.equals(b))||!(h==q)){if(!e&&b&&this.dragPanMapObject&&this.smoothDragPan){var l=this.map.getViewPortPxFromLonLat(b);var o=this.map.getViewPortPxFromLonLat(f);this.dragPanMapObject(o.x-l.x,l.y-o.y)}else{var a=this.getMapObjectLonLatFromOLLonLat(f);var p=this.getMapObjectZoomFromOLZoom(h);this.setMapObjectCenter(a,p,m)}}}}},getLonLatFromViewPortPx:function(a){var b=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var e=this.getMapObjectPixelFromOLPixel(a);var d=this.getMapObjectLonLatFromMapObjectPixel(e);b=this.getOLLonLatFromMapObjectLonLat(d)}return b},getViewPortPxFromLonLat:function(b){var a=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var e=this.getMapObjectLonLatFromOLLonLat(b);
var d=this.getMapObjectPixelFromMapObjectLonLat(e);a=this.getOLPixelFromMapObjectPixel(d)}return a},getOLLonLatFromMapObjectLonLat:function(e){var a=null;if(e!=null){var d=this.getLongitudeFromMapObjectLonLat(e);var b=this.getLatitudeFromMapObjectLonLat(e);a=new OpenLayers.LonLat(d,b)}return a},getMapObjectLonLatFromOLLonLat:function(a){var b=null;if(a!=null){b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)}return b},getOLPixelFromMapObjectPixel:function(e){var b=null;if(e!=null){var a=this.getXFromMapObjectPixel(e);var d=this.getYFromMapObjectPixel(e);b=new OpenLayers.Pixel(a,d)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;if(a!=null){b=this.getMapObjectPixelFromXY(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var d=new Array("minZoomLevel","maxZoomLevel","numZoomLevels");for(var b=0,a=d.length;b<a;b++){var g=d[b];this[g]=(this.options[g]!=null)?this.options[g]:this.map[g]}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var h;var f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){h=this.maxZoomLevel-this.minZoomLevel+1}else{h=this.numZoomLevels}if(h!=null){this.numZoomLevels=Math.min(h,f)}else{this.numZoomLevels=f}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var e=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++){this.resolutions[e++]=this.RESOLUTIONS[b]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}else{var a=null;var d=this.map.getSize();var b=this.getExtent();if((d!=null)&&(b!=null)){a=Math.max(b.getWidth()/d.w,b.getHeight()/d.h)}return a}},getExtent:function(){var d=null;var b=this.map.getSize();var f=new OpenLayers.Pixel(0,0);var g=this.getLonLatFromViewPortPx(f);var a=new OpenLayers.Pixel(b.w,b.h);var e=this.getLonLatFromViewPortPx(a);if((g!=null)&&(e!=null)){d=new OpenLayers.Bounds(g.lon,e.lat,e.lon,g.lat)}return d},getZoomForResolution:function(a){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)}},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=a-this.minZoomLevel;if(this.map.baseLayer!==this){b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b))}}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=a+this.minZoomLevel;if(this.map.baseLayer!==this){b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b))}}return b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(d,b,e,a){OpenLayers.Layer.prototype.initialize.apply(this,[d,a]);this.url=b;this.params=OpenLayers.Util.extend({},e)},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setUrl:function(a){this.url=a},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);var a=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})}return a},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(f,e){var d=1;for(var b=0,a=f.length;b<a;b++){d*=f.charCodeAt(b)*this.URL_HASH_FACTOR;d-=Math.floor(d)}return e[Math.floor(d*e.length)]},getFullRequestString:function(h,e){var b=e||this.url;
var g=OpenLayers.Util.extend({},this.params);g=OpenLayers.Util.extend(g,h);var f=OpenLayers.Util.getParameterString(g);if(OpenLayers.Util.isArray(b)){b=this.selectUrl(f,b)}var a=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var d in g){if(d.toUpperCase() in a){delete g[d]}}f=OpenLayers.Util.getParameterString(g);return OpenLayers.Util.urlAppend(b,f)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,grid:null,singleTile:false,ratio:1.5,buffer:0,numLoadingTiles:0,tileLoadingDelay:100,timerId:null,initialize:function(d,b,e,a){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[];this._moveGriddedTiles=OpenLayers.Function.bind(this.moveGriddedTiles,this)},removeMap:function(a){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var g=0,b=this.grid.length;g<b;g++){var f=this.grid[g];for(var d=0,a=f.length;d<a;d++){var e=f[d];this.removeTileMonitoringHooks(e);e.destroy()}}this.grid=[]}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},moveTo:function(e,a,f){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);e=e||this.map.getExtent();if(e!=null){var d=!this.grid.length||a;var b=this.getTilesBounds();if(this.singleTile){if(d||(!f&&!b.containsBounds(e))){this.initSingleTile(e)}}else{if(d||!b.containsBounds(e,true)){this.initGriddedTiles(e)}else{this.scheduleMoveGriddedTiles()}}}},moveByPx:function(b,a){if(!this.singleTile){this.scheduleMoveGriddedTiles()}},scheduleMoveGriddedTiles:function(){if(this.timerId!=null){window.clearTimeout(this.timerId)}this.timerId=window.setTimeout(this._moveGriddedTiles,this.tileLoadingDelay)},setTileSize:function(a){if(this.singleTile){a=this.map.getSize();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds()},getTilesBounds:function(){var f=null;if(this.grid.length){var a=this.grid.length-1;var e=this.grid[a][0];var b=this.grid[0].length-1;var d=this.grid[0][b];f=new OpenLayers.Bounds(e.bounds.left,e.bounds.bottom,d.bounds.right,d.bounds.top)}return f},initSingleTile:function(g){var a=g.getCenterLonLat();var j=g.getWidth()*this.ratio;var b=g.getHeight()*this.ratio;var h=new OpenLayers.Bounds(a.lon-(j/2),a.lat-(b/2),a.lon+(j/2),a.lat+(b/2));var e=new OpenLayers.LonLat(h.left,h.top);var d=this.map.getLayerPxFromLonLat(e);if(!this.grid.length){this.grid[0]=[]}var f=this.grid[0][0];if(!f){f=this.addTile(h,d);this.addTileMonitoringHooks(f);f.draw();this.grid[0][0]=f}else{f.moveTo(h,d)}this.removeExcessTiles(1,1)},calculateGridLayout:function(a,r,f){var o=f*this.tileSize.w;var d=f*this.tileSize.h;var l=a.left-r.lon;var p=Math.floor(l/o)-this.buffer;var m=l/o-p;var g=-m*this.tileSize.w;var q=r.lon+p*o;var b=a.top-(r.lat+d);var j=Math.ceil(b/d)+this.buffer;var u=j-b/d;var e=-u*this.tileSize.h;var h=r.lat+j*d;return{tilelon:o,tilelat:d,tileoffsetlon:q,tileoffsetlat:h,tileoffsetx:g,tileoffsety:e}},getTileOrigin:function(){var b=this.tileOrigin;if(!b){var d=this.getMaxExtent();var a=({tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]})[this.tileOriginCorner];b=new OpenLayers.LonLat(d[a[0]],d[a[1]])}return b},initGriddedTiles:function(l){var h=this.map.getSize();var D=Math.ceil(h.h/this.tileSize.h)+Math.max(1,2*this.buffer);var F=Math.ceil(h.w/this.tileSize.w)+Math.max(1,2*this.buffer);
var H=this.getTileOrigin();var w=this.map.getResolution();var v=this.calculateGridLayout(l,H,w);var g=Math.round(v.tileoffsetx);var d=Math.round(v.tileoffsety);var o=v.tileoffsetlon;var r=v.tileoffsetlat;var f=v.tilelon;var m=v.tilelat;this.origin=new OpenLayers.Pixel(g,d);var C=g;var E=o;var B=0;var a=parseInt(this.map.layerContainerDiv.style.left);var z=parseInt(this.map.layerContainerDiv.style.top);do{var j=this.grid[B++];if(!j){j=[];this.grid.push(j)}o=E;g=C;var e=0;do{var b=new OpenLayers.Bounds(o,r,o+f,r+m);var q=g;q-=a;var p=d;p-=z;var u=new OpenLayers.Pixel(q,p);var G=j[e++];if(!G){G=this.addTile(b,u);this.addTileMonitoringHooks(G);j.push(G)}else{G.moveTo(b,u,false)}o+=f;g+=this.tileSize.w}while((o<=l.right+f*this.buffer)||e<F);r-=m;d+=this.tileSize.h}while((r>=l.bottom-m*this.buffer)||B<D);this.removeExcessTiles(B,e);this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){var b=[];var j=["right","down","left","up"];var h=0;var a=-1;var m=OpenLayers.Util.indexOf(j,"right");var o=0;while(o<j.length){var l=h;var d=a;switch(j[m]){case"right":d++;break;case"down":l++;break;case"left":d--;break;case"up":l--;break}var g=null;if((l<this.grid.length)&&(l>=0)&&(d<this.grid[0].length)&&(d>=0)){g=this.grid[l][d]}if((g!=null)&&(!g.queued)){b.unshift(g);g.queued=true;o=0;h=l;a=d}else{m=(m+1)%4;o++}}for(var e=0,f=b.length;e<f;e++){var g=b[e];g.draw();g.queued=false}},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize,this.tileOptions)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(){var e=true;var d=this.buffer||1;var b=this.grid[0][0].position;var a=parseInt(this.map.layerContainerDiv.style.left);var g=parseInt(this.map.layerContainerDiv.style.top);var f=b.add(a,g);if(f.x>-this.tileSize.w*(d-1)){this.shiftColumn(true)}else{if(f.x<-this.tileSize.w*d){this.shiftColumn(false)}else{if(f.y>-this.tileSize.h*(d-1)){this.shiftRow(true)}else{if(f.y<-this.tileSize.h*d){this.shiftRow(false)}else{e=false}}}}if(e){this.timerId=window.setTimeout(this._moveGriddedTiles,0)}},shiftRow:function(q){var d=(q)?0:(this.grid.length-1);var b=this.grid;var g=b[d];var f=this.map.getResolution();var j=(q)?-this.tileSize.h:this.tileSize.h;var h=f*-j;var p=(q)?b.pop():b.shift();for(var l=0,o=g.length;l<o;l++){var e=g[l];var a=e.bounds.clone();var m=e.position.clone();a.bottom=a.bottom+h;a.top=a.top+h;m.y=m.y+j;p[l].moveTo(a,m)}if(q){b.unshift(p)}else{b.push(p)}},shiftColumn:function(p){var e=(p)?-this.tileSize.w:this.tileSize.w;var d=this.map.getResolution();var m=d*e;for(var f=0,h=this.grid.length;f<h;f++){var o=this.grid[f];var l=(p)?0:(o.length-1);var b=o[l];var a=b.bounds.clone();var g=b.position.clone();a.left=a.left+m;a.right=a.right+m;g.x=g.x+e;var j=p?this.grid[f].pop():this.grid[f].shift();j.moveTo(a,g);if(p){o.unshift(j)}else{o.push(j)}}},removeExcessTiles:function(f,d){while(this.grid.length>f){var g=this.grid.pop();for(var b=0,a=g.length;b<a;b++){var e=g[b];this.removeTileMonitoringHooks(e);e.destroy()}}while(this.grid[0].length>d){for(var b=0,a=this.grid.length;b<a;b++){var g=this.grid[b];var e=g.pop();this.removeTileMonitoringHooks(e);e.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(e){var d=this.maxExtent;var g=this.getResolution();var f=g*this.tileSize.w;var b=g*this.tileSize.h;var j=this.getLonLatFromViewPortPx(e);var a=d.left+(f*Math.floor((j.lon-d.left)/f));var h=d.bottom+(b*Math.floor((j.lat-d.bottom)/b));return new OpenLayers.Bounds(a,h,a+f,h+b)
},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var d=0,a=this.markers.length;d<a;d++){this.markers[d].setOpacity(this.opacity)}}},moveTo:function(e,b,f){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var d=0,a=this.markers.length;d<a;d++){this.drawMarker(this.markers[d])}this.drawn=true}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a)}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);a.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null){a.display(false)}else{if(!a.isDrawn()){var d=a.draw(b);this.div.appendChild(d)}else{if(a.icon){a.icon.moveTo(b)}}}},getDataExtent:function(){var b=null;if(this.markers&&(this.markers.length>0)){var b=new OpenLayers.Bounds();for(var e=0,a=this.markers.length;e<a;e++){var d=this.markers[e];b.extend(d.lonlat)}}return b},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=new Array()},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var a=function(b){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this});this.loaded=true}}},moveTo:function(d,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(m){var p=m.responseText;var r={};OpenLayers.Util.extend(r,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){r.externalProjection=this.projection;r.internalProjection=this.map.getProjectionObject()}var b=new OpenLayers.Format.Text(r);var d=b.read(p);for(var h=0,j=d.length;h<j;h++){var g={};var q=d[h];var o;var l,e;o=new OpenLayers.LonLat(q.geometry.x,q.geometry.y);if(q.style.graphicWidth&&q.style.graphicHeight){l=new OpenLayers.Size(q.style.graphicWidth,q.style.graphicHeight)}if(q.style.graphicXOffset!==undefined&&q.style.graphicYOffset!==undefined){e=new OpenLayers.Pixel(q.style.graphicXOffset,q.style.graphicYOffset)}if(q.style.externalGraphic!=null){g.icon=new OpenLayers.Icon(q.style.externalGraphic,l,e)}else{g.icon=OpenLayers.Marker.defaultIcon();if(l!=null){g.icon.setSize(l)}}if((q.attributes.title!=null)&&(q.attributes.description!=null)){g.popupContentHTML="<h2>"+q.attributes.title+"</h2><p>"+q.attributes.description+"</p>"}g.overflow=q.attributes.overflow||"auto";var a=new OpenLayers.Feature(this,o,g);this.features.push(a);var f=a.createMarker();if((q.attributes.title!=null)&&(q.attributes.description!=null)){f.events.register("click",a,this.markerClick)}this.addMarker(f)}this.events.triggerEvent("loadend")},markerClick:function(b){var e=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!e)?this:null;for(var d=0,a=this.layer.map.popups.length;d<a;d++){this.layer.map.removePopup(this.layer.map.popups[d])}if(!e){this.layer.map.addPopup(this.createPopup())}OpenLayers.Event.stop(b)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(e,d,f,b){var a=[];
f=OpenLayers.Util.upperCaseObject(f);if(parseFloat(f.VERSION)>=1.3&&!f.EXCEPTIONS){f.EXCEPTIONS="INIMAGE"}a.push(e,d,f,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()])},getURL:function(d){d=this.adjustBounds(d);var e=this.getImageSize();var f={};var b=this.reverseAxisOrder();f.BBOX=this.encodeBBOX?d.toBBOX(null,b):d.toArray(b);f.WIDTH=e.w;f.HEIGHT=e.h;var a=this.getFullRequestString(f);return a},mergeNewParams:function(d){var b=OpenLayers.Util.upperCaseObject(d);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(f,d){var b=this.map.getProjectionObject();var a=this.projection&&this.projection.equals(b)?this.projection.getCode():b.getCode();var e=(a=="none")?null:a;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=e}else{this.params.SRS=e}if(typeof this.params.TRANSPARENT=="boolean"){f.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:true,initialize:function(d,b,f,a){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var e="The OpenLayers.Layer.WMS.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.WMS class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(e)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.WMS.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"});OpenLayers.Layer.WMS.Post=OpenLayers.Class(OpenLayers.Layer.WMS,{unsupportedBrowsers:["mozilla","firefox","opera"],SUPPORTED_TRANSITIONS:[],usePost:null,initialize:function(e,d,f,b){var a=[];a.push(e,d,f,b);OpenLayers.Layer.WMS.prototype.initialize.apply(this,a);this.usePost=OpenLayers.Util.indexOf(this.unsupportedBrowsers,OpenLayers.BROWSER_NAME)==-1},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize,{maxGetUrlLength:this.usePost?0:null})},CLASS_NAME:"OpenLayers.Layer.WMS.Post"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(d){var g={url:true,layer:true,style:true,matrixSet:true};for(var h in g){if(!(h in d)){throw new Error("Missing property '"+h+"' in layer configuration.")}}d.params=OpenLayers.Util.upperCaseObject(d.params);var b=[d.name,d.url,d.params,d];OpenLayers.Layer.Grid.prototype.initialize.apply(this,b);if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()}if(this.matrixIds){var a=this.matrixIds.length;if(a&&typeof this.matrixIds[0]==="string"){var f=this.matrixIds;this.matrixIds=new Array(a);for(var e=0;e<a;++e){this.matrixIds[e]={identifier:f[e]}}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);
this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)}if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(b,a,d){if(a||!this.matrix){this.updateMatrixProperties()}return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMTS(this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getMatrix:function(){var b;if(!this.matrixIds||this.matrixIds.length===0){b={identifier:this.map.getZoom()+this.zoomOffset}}else{if("scaleDenominator" in this.matrixIds[0]){var a=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/0.00028;var f=Number.POSITIVE_INFINITY;var g;for(var d=0,e=this.matrixIds.length;d<e;++d){g=Math.abs(1-(this.matrixIds[d].scaleDenominator/a));if(g<f){f=g;b=this.matrixIds[d]}}}else{b=this.matrixIds[this.map.getZoom()+this.zoomOffset]}}return b},getTileInfo:function(g){var b=this.map.getResolution();var e=(g.lon-this.tileOrigin.lon)/(b*this.tileSize.w);var d=(this.tileOrigin.lat-g.lat)/(b*this.tileSize.h);var a=Math.floor(e);var f=Math.floor(d);return{col:a,row:f,i:Math.floor((e-a)*this.tileSize.w),j:Math.floor((d-f)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var a=e.getCenterLonLat();var g=this.getTileInfo(a);var j=this.matrix.identifier;if(this.requestEncoding.toUpperCase()==="REST"){var f=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions){for(var d=0;d<this.dimensions.length;d++){if(this.params[this.dimensions[d]]){f=f+this.params[this.dimensions[d]]+"/"}}}f=f+this.matrixSet+"/"+this.matrix.identifier+"/"+g.row+"/"+g.col+"."+this.formatSuffix;if(OpenLayers.Util.isArray(this.url)){b=this.selectUrl(f,this.url)}else{b=this.url}if(!b.match(/\/$/)){b=b+"/"}b=b+f}else{if(this.requestEncoding.toUpperCase()==="KVP"){var h={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:g.row,TILECOL:g.col,FORMAT:this.format};b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[h])}}}return b},mergeNewParams:function(a){if(this.requestEncoding.toUpperCase()==="KVP"){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(j,e,h,d,b,g,f){var a=[j,e,h,d,g,f];OpenLayers.Popup.prototype.initialize.apply(this,a);this.anchor=(b!=null)?b:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(d){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(d);var e=this.calculateNewPx(d);var a=new Array(e);OpenLayers.Popup.prototype.moveTo.apply(this,a);if(this.relativePosition!=b){this.updateRelativePosition()}},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a)}},calculateRelativePosition:function(b){var e=this.map.getLonLatFromLayerPx(b);var d=this.map.getExtent();var a=d.determineQuadrant(e);return OpenLayers.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},calculateNewPx:function(b){var f=b.offset(this.anchor.offset);var a=this.size||this.contentSize;var e=(this.relativePosition.charAt(0)=="t");f.y+=(e)?-a.h:this.anchor.size.h;
var d=(this.relativePosition.charAt(1)=="l");f.x+=(d)?-a.w:this.anchor.size.w;return f},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(h,d,g,b,a,f,e){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)}}},setBorder:function(a){this.border=0},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity()}},getCornersToRound:function(){var a=["tl","tr","bl","br"];var b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(a,b);return a.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(h,d,g,b,a,f,e){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(j){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(f){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];if(b.image){b.div.removeChild(b.image)}b.image=null;if(b.div){this.groupDiv.removeChild(b.div)}b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);b=b.offset(this.positionBlocks[this.relativePosition].offset);return b},createBlocks:function(){this.blocks=[];var g=null;for(var f in this.positionBlocks){g=f;break}var a=this.positionBlocks[g];for(var e=0;e<a.blocks.length;e++){var j={};this.blocks.push(j);var b=this.id+"_FrameDecorationDiv_"+e;j.div=OpenLayers.Util.createDiv(b,null,null,null,"absolute",null,"hidden",null);var d=this.id+"_FrameDecorationImg_"+e;var h=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;j.image=h(d,null,this.imageSize,this.imageSrc,"absolute",null,null,null);j.div.appendChild(j.image);
this.groupDiv.appendChild(j.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var m=this.positionBlocks[this.relativePosition];for(var g=0;g<m.blocks.length;g++){var d=m.blocks[g];var f=this.blocks[g];var e=d.anchor.left;var o=d.anchor.bottom;var a=d.anchor.right;var q=d.anchor.top;var p=(isNaN(d.size.w))?this.size.w-(a+e):d.size.w;var j=(isNaN(d.size.h))?this.size.h-(o+q):d.size.h;f.div.style.width=(p<0?0:p)+"px";f.div.style.height=(j<0?0:j)+"px";f.div.style.left=(e!=null)?e+"px":"";f.div.style.bottom=(o!=null)?o+"px":"";f.div.style.right=(a!=null)?a+"px":"";f.div.style.top=(q!=null)?q+"px":"";f.image.style.left=d.position.x+"px";f.image.style.top=d.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(h,d,g,b,a,f,e){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);
this.contentDiv.className=this.contentDisplayClass},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,d,b){this.layer=a;this.lonlat=d;this.data=(b!=null)?b:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var b=false;if((this.layer!=null)&&(this.layer.map!=null)){var a=this.layer.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){if(this.lonlat!=null){if(!this.popup){var a=(this.marker)?this.marker.icon:null;var d=this.popupClass?this.popupClass:OpenLayers.Popup.AnchoredBubble;this.popup=new d(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,a,b)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(d,a,b){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,a]);this.lonlat=null;this.geometry=d?d:null;this.state=null;this.attributes={};if(a){this.attributes=OpenLayers.Util.extend(this.attributes,a)}this.style=b?b:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var d=false;if(this.layer&&this.layer.map){var a=this.layer.map.getExtent();if(e){var b=this.geometry.getBounds();d=a.intersectsBounds(b)}else{var f=a.toGeometry();d=f.intersects(this.geometry)}}return d},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(b,e,d){var a=false;if(this.geometry){a=this.geometry.atPoint(b,e,d)}return a},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move){return undefined}var b;if(a.CLASS_NAME=="OpenLayers.LonLat"){b=this.layer.getViewPortPxFromLonLat(a)}else{b=a}var e=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var d=this.layer.map.getResolution();this.geometry.move(d*(b.x-e.x),d*(e.y-b.y));this.layer.drawFeature(this);return e},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else{if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break}}else{if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;
break}}else{if(a==OpenLayers.State.UNKNOWN){this.state=a}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(d,b){var a=arguments;var e=this.processXMLNode(b);a=new Array(d,e.lonlat,e);OpenLayers.Feature.prototype.initialize.apply(this,a);this.createMarker();this.layer.addMarker(this.marker)},destroy:function(){if(this.marker!=null){this.layer.removeMarker(this.marker)}OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(b){var a=OpenLayers.Ajax.getElementsByTagNameNS(b,"http://www.opengis.net/gml","gml","Point");var e=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(a[0],"http://www.opengis.net/gml","gml","coordinates")[0]);var d=e.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(d[0]),parseFloat(d[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(e,b,a){OpenLayers.Util.extend(this,a);this.control=e;this.callbacks=b;var d=this.map||e.map;if(d){this.setMap(d)}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(this.keyMask==null){return true}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask)},activate:function(){if(this.active){return false}var d=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=d.length;b<a;b++){if(this[d[b]]){this.register(d[b],this[d[b]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var d=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=d.length;b<a;b++){if(this[d[b]]){this.unregister(d[b],this[d[b]])}}this.active=false;return true},callback:function(b,a){if(b&&this.callbacks[b]){this.callbacks[b].apply(this.control,a)}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,touch:false,down:null,last:null,first:null,rightclickTimerId:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},touchstart:function(a){if(!this.touch){this.unregisterMouseListeners();this.touch=true}this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return true},touchmove:function(a){this.last=this.getEventInfo(a);
return true},touchend:function(a){if(this.down){a.xy=this.last.xy;a.lastTouches=this.last.touches;this.handleSingle(a);this.down=null}return true},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(a){this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return true},mouseup:function(b){var a=true;if(this.checkModifiers(b)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(b)){a=this.rightclick(b)}return a},rightclick:function(b){if(this.passesTolerance(b)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[b]);return !this.stopDouble}else{var a=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);var d=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(d,this.delay)}}return !this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a])}},click:function(a){if(!this.last){this.last=this.getEventInfo(a)}this.handleSingle(a);return !this.stopSingle},dblclick:function(a){this.handleDouble(a);return !this.stopDouble},handleDouble:function(a){if(this["double"]&&this.passesDblclickTolerance(a)){this.callback("dblclick",[a])}},handleSingle:function(b){if(this.passesTolerance(b)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){OpenLayers.Event.stop(b)}this.handleDouble(b)}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()}}else{this.first=this.getEventInfo(b);var a=this.single?OpenLayers.Util.extend({},b):null;this.queuePotentialClick(a)}}},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var e=true;if(this.pixelTolerance!=null&&this.down&&this.down.xy){e=this.pixelTolerance>=this.down.xy.distanceTo(a.xy);if(e&&this.touch&&this.down.touches.length===this.last.touches.length){for(var b=0,d=this.down.touches.length;b<d;++b){if(this.getTouchDistance(this.down.touches[b],this.last.touches[b])>this.pixelTolerance){e=false;break}}}}return e},getTouchDistance:function(b,a){return Math.sqrt(Math.pow(b.clientX-a.clientX,2)+Math.pow(b.clientY-a.clientY,2))},passesDblclickTolerance:function(a){var b=true;if(this.down&&this.first){b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance}return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a])}},getEventInfo:function(b){var e;if(b.touches){var a=b.touches.length;e=new Array(a);var f;for(var d=0;d<a;d++){f=b.touches[d];e[d]={clientX:f.clientX,clientY:f.clientY}}}return{xy:b.xy,touches:e}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;this.touch=false;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}return !this.stopMove},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.eventsDiv)){this.clearTimer();this.callback("move",[a])}return true},passesTolerance:function(b){var d=true;if(this.pixelTolerance&&this.px){var a=Math.sqrt(Math.pow(this.px.x-b.x,2)+Math.pow(this.px.y-b.y,2));if(a<this.pixelTolerance){d=false}}return d},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.callback("pause",[a])
},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true}return a},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,layerOptions:null,pixelTolerance:5,touch:false,lastTouchPx:null,initialize:function(d,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);var d=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(d);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}this.cancel();if(this.layer.map!=null){this.destroyFeature(true);this.layer.destroy(false)}this.layer=null;this.touch=false;return true},destroyFeature:function(a){if(this.layer&&(a||!this.persist)){this.layer.destroyFeatures()}this.point=null},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>1){this.layer.features[0].destroy()}},finalize:function(b){var a=b?"cancel":"done";this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(a,[this.geometryClone()]);this.destroyFeature(b)},cancel:function(){this.finalize(true)},click:function(a){OpenLayers.Event.stop(a);return false},dblclick:function(a){OpenLayers.Event.stop(a);return false},modifyFeature:function(a){if(!this.point){this.createFeature(a)}var b=this.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point,false]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPoint([a])}return a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}this.lastTouchPx=a.xy;return this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){this.lastTouchPx=a.xy;return this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){a.xy=this.lastTouchPx;return this.up(a)},down:function(a){this.mouseDown=true;this.lastDown=a.xy;if(!this.touch){this.modifyFeature(a.xy)}this.stoppedDown=this.stopDown;return !this.stopDown},move:function(a){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(a.xy)}return true},up:function(a){this.mouseDown=false;this.stoppedDown=this.stopDown;if(!this.checkModifiers(a)){return true}if(this.lastUp&&this.lastUp.equals(a.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(a.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=a.xy;this.finalize();return !this.stopUp}else{return true}},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.eventsDiv)){this.stoppedDown=this.stopDown;this.mouseDown=false}},passesTolerance:function(f,e,a){var b=true;if(a!=null&&f&&e){var d=f.distanceTo(e);if(d>a){b=false}}return b},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:false,freehandToggle:"shiftKey",timerId:null,redoStack:null,initialize:function(d,b,a){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)
},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);var d=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(d);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a);this.line=null},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(b,a){var d=this.getCurrentPointIndex()-1;var e=this.line.geometry.components[d];if(e&&!isNaN(e.x)&&!isNaN(e.y)){this.insertXY(e.x+b,e.y+a)}},insertDirectionLength:function(e,d){e*=Math.PI/180;var b=d*Math.cos(e);var a=d*Math.sin(e);this.insertDeltaXY(b,a)},insertDeflectionLength:function(d,b){var e=this.getCurrentPointIndex()-1;if(e>0){var f=this.line.geometry.components[e];var g=this.line.geometry.components[e-1];var a=Math.atan2(f.y-g.y,f.x-g.x);this.insertDirectionLength((a*180/Math.PI)+d,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var f=this.line.geometry;var b=f.components;var a=this.getCurrentPointIndex()-1;var e=b[a];var d=f.removeComponent(e);if(d){if(!this.redoStack){this.redoStack=[]}this.redoStack.push(e);this.drawFeature()}return d},redo:function(){var a=this.redoStack&&this.redoStack.pop();if(a){this.line.geometry.addComponent(a,this.getCurrentPointIndex());this.drawFeature()}return !!a},freehandMode:function(a){return(this.freehandToggle&&a[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(b,a){if(!this.line){this.createFeature(b)}var d=this.control.map.getLonLatFromPixel(b);this.point.geometry.x=d.lon;this.point.geometry.y=d.lat;this.callback("modify",[this.point.geometry,this.getSketch(),a]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiLineString([a])}return a},touchstart:function(a){if(this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return false}else{if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,a)}},down:function(a){var b=this.stopDown;if(this.freehandMode(a)){b=true}if(!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance))){this.modifyFeature(a.xy,!!this.lastUp)}this.mouseDown=true;this.lastDown=a.xy;this.stoppedDown=b;return !b},move:function(a){if(this.stoppedDown&&this.freehandMode(a)){if(this.persist){this.destroyPersistedFeature()}this.addPoint(a.xy);return false}if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(a.xy,!!this.lastUp)}return true},up:function(a){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(a.xy))){if(this.stoppedDown&&this.freehandMode(a)){if(this.persist){this.destroyPersistedFeature()
}this.removePoint();this.finalize()}else{if(this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(a.xy)}if(this.lastUp==null&&this.persist){this.destroyPersistedFeature()}this.addPoint(a.xy);this.lastUp=a.xy;if(this.line.geometry.components.length===this.maxVertices+1){this.finishGeometry()}}}}this.stoppedDown=this.stopDown;this.mouseDown=false;return !this.stopUp},finishGeometry:function(){var a=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[a]);this.removePoint();this.finalize()},dblclick:function(a){if(!this.freehandMode(a)){this.finishGeometry()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:false,polygon:null,initialize:function(d,b,a){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);var d=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(d);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},addPoint:function(a){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){var g=this.point.geometry;var f=this.control.layer.features;var e,d;for(var b=f.length-1;b>=0;--b){e=f[b].geometry;if((e instanceof OpenLayers.Geometry.Polygon||e instanceof OpenLayers.Geometry.MultiPolygon)&&e.intersects(g)){d=f[b];this.control.layer.removeFeatures([d],{silent:true});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);d.geometry.addComponent(this.line.geometry);this.polygon=d;this.drawingHole=true;break}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var a=e.vertex;var d=this.line.geometry.components;if(!this.polygon.geometry.intersects(a)){var b=d[d.length-3];a.x=b.x;a.y=b.y}},finishGeometry:function(){var a=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[a]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var d=this.line.geometry;var b=(d.getArea()!==0);if(b){var l=this.polygon.geometry.components;for(var e=l.length-2;e>=0;--e){if(d.intersects(l[e])){b=false;break}}if(b){var h;outer:for(var e=l.length-2;e>0;--e){var f=l[e].components;for(var a=0,g=f.length;a<g;++a){if(d.containsPoint(f[a])){b=false;break outer}}}}}if(b){if(this.polygon.state!==OpenLayers.State.INSERT){this.polygon.state=OpenLayers.State.UPDATE}}else{this.polygon.geometry.removeComponent(d)}this.restoreFeature();return false},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(true)}return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:true});this.control.layer.addFeatures([this.polygon],{silent:true});this.drawingHole=false;if(!a){this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})}},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPolygon([a])
}return a},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:false,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(e,b,d,a){OpenLayers.Handler.prototype.initialize.apply(this,[e,d,a]);this.layer=b},touchstart:function(a){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}return OpenLayers.Event.isMultiTouch(a)?true:this.mousedown(a)},touchmove:function(a){OpenLayers.Event.stop(a)},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true},click:function(a){return this.handle(a)?!this.stopClick:true},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out){return true}this.handle(a);return true},dblclick:function(a){return !this.handle(a)},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){if(this.feature&&!this.feature.layer){this.feature=null}var d=a.type;var g=false;var f=!!(this.feature);var e=(d=="click"||d=="dblclick"||d=="touchstart");this.feature=this.layer.getFeatureFromEvent(a);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){if(d==="touchstart"){OpenLayers.Event.stop(a)}var b=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(f&&b){if(this.lastFeature){this.triggerCallback(d,"out",[this.lastFeature])}this.triggerCallback(d,"in",[this.feature])}else{if(!f||e){this.triggerCallback(d,"in",[this.feature])}}this.lastFeature=this.feature;g=true}else{if(this.lastFeature&&(f&&b||e)){this.triggerCallback(d,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(f||e)){this.triggerCallback(d,"out",[this.lastFeature])}}return g},triggerCallback:function(e,f,b){var d=this.EVENTMAP[e][f];if(d){if(e=="click"&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(a<=this.clickTolerance){this.callback(d,b)}}else{this.callback(d,b)}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.touch=false;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},handleMapEvents:function(a){if(a.type=="removelayer"||a.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(a)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,touch:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(e,d,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===true){var b=this;this._docMove=function(f){b.mousemove({xy:{x:f.clientX,y:f.clientY},element:document})};this._docUp=function(f){b.mouseup({xy:{x:f.clientX,y:f.clientY}})
}}},dragstart:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b))){this.started=true;this.start=b.xy;this.last=b.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(b);this.callback("down",[b.xy]);OpenLayers.Event.stop(b);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True}document.onselectstart=OpenLayers.Function.False;a=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return a},dragmove:function(a){this.lastMoveEvt=a;if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(a.element===document){this.adjustXY(a);this.setEvent(a)}else{this.removeDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=a.xy}return true},dragend:function(b){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(b);this.removeDocumentEvents()}var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy])}document.onselectstart=this.oldOnselectstart}return true},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})}return this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null;if(this.dragging){this.mousemove(this.lastMoveEvt)}},mouseup:function(a){return this.dragend(a)},touchend:function(a){a.xy=this.last;return this.dragend(a)},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.eventsDiv)){if(this.documentDrag===true){this.addDocumentEvents()}else{var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(a){return(this.start==this.last)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.touch=false;this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0];a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=true;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:false,pinching:false,last:null,start:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},touchstart:function(b){var a=true;this.pinching=false;if(OpenLayers.Event.isMultiTouch(b)){this.started=true;this.last=this.start={distance:this.getDistance(b.touches),delta:0,scale:1};
this.callback("start",[b,this.start]);a=!this.stopDown}else{this.started=false;this.start=null;this.last=null}OpenLayers.Event.stop(b);return a},touchmove:function(a){if(this.started&&OpenLayers.Event.isMultiTouch(a)){this.pinching=true;var b=this.getPinchData(a);this.callback("move",[a,b]);this.last=b;OpenLayers.Event.stop(a)}return true},touchend:function(a){if(this.started){this.started=false;this.pinching=false;this.callback("done",[a,this.start,this.last]);this.start=null;this.last=null}return true},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.pinching=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.pinching=false;this.start=null;this.last=null;a=true}return a},getDistance:function(d){var b=d[0];var a=d[1];return Math.sqrt(Math.pow(b.clientX-a.clientX,2)+Math.pow(b.clientY-a.clientY,2))},getPinchData:function(a){var d=this.getDistance(a.touches);var b=d/this.start.distance;return{distance:d,delta:this.last.distance-d,scale:b}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(d,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.Drag.prototype.initialize.apply(this,[d,b,a]);this.options=(a)?a:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},activate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy()}}this.layer=null;this.feature=null;a=true}return a},down:function(a){this.fixedRadius=!!(this.radius);var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}if(this.persist){this.clear()}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(d){var g=this.map.getLonLatFromPixel(d.xy);var a=new OpenLayers.Geometry.Point(g.lon,g.lat);if(this.irregular){var h=Math.sqrt(2)*Math.abs(a.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,h)}else{if(this.fixedRadius){this.origin=a}else{this.calculateAngle(a,d);this.radius=Math.max(this.map.getResolution()/2,a.distanceTo(this.origin))}}this.modifyGeometry();if(this.irregular){var e=a.x-this.origin.x;var b=a.y-this.origin.y;var f;if(b==0){f=e/(this.radius*Math.sqrt(2))}else{f=e/b}this.feature.geometry.resize(1,this.origin,f);this.feature.geometry.move(e/2,b/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize();if(this.start==this.last){this.callback("done",[a.xy])}},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,a;var b=this.feature.geometry.components[0];if(b.components.length!=(this.sides+1)){this.createGeometry();b=this.feature.geometry.components[0]}for(var d=0;d<this.sides;++d){a=b.components[d];e=this.angle+(d*2*Math.PI/this.sides);a.x=this.origin.x+(this.radius*Math.cos(e));
a.y=this.origin.y+(this.radius*Math.sin(e));a.clearBounds()}},calculateAngle:function(a,b){var e=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!b[this.snapToggle])){var d=(Math.PI/180)*this.snapAngle;this.angle=Math.round(e/d)*d}else{this.angle=e}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures()}},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()])}if(!this.persist&&(b=="done"||b=="cancel")){this.clear()}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a)}},startBox:function(a){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",new OpenLayers.Pixel(-9999,-9999));this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.eventsDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.eventsDiv,"olDrawBox")},moveBox:function(f){var e=this.dragHandler.start.x;var b=this.dragHandler.start.y;var d=Math.abs(e-f.x);var a=Math.abs(b-f.y);var g=this.getBoxOffsets();this.zoomBox.style.width=(d+g.width+1)+"px";this.zoomBox.style.height=(a+g.height+1)+"px";this.zoomBox.style.left=(f.x<e?e-d-g.left:e-g.left)+"px";this.zoomBox.style.top=(f.y<b?b-a-g.top:b-g.top)+"px"},endBox:function(b){var a;if(Math.abs(this.dragHandler.start.x-b.x)>5||Math.abs(this.dragHandler.start.y-b.y)>5){var h=this.dragHandler.start;var g=Math.min(h.y,b.y);var d=Math.max(h.y,b.y);var f=Math.min(h.x,b.x);var e=Math.max(h.x,b.x);a=new OpenLayers.Bounds(f,d,e,g)}else{a=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[a])},removeBox:function(){this.map.eventsDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.eventsDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){if(this.dragHandler.deactivate()){if(this.zoomBox){this.removeBox()}}return true}else{return false}},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute";e.style.border="1px solid black";e.style.width="3px";document.body.appendChild(e);var a=e.clientWidth==3;document.body.removeChild(e);var g=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"));var d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"));var f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"));var b=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:g,right:d,top:f,bottom:b,width:a===false?g+d:0,height:a===false?f+b:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(m){if(!this.map||!this.checkModifiers(m)){return
}var h=false;var p=false;var g=false;var b=OpenLayers.Event.element(m);while((b!=null)&&!g&&!h){if(!h){try{if(b.currentStyle){d=b.currentStyle.overflow}else{var a=document.defaultView.getComputedStyle(b,null);var d=a.getPropertyValue("overflow")}h=(d&&(d=="auto")||(d=="scroll"))}catch(f){}}if(!p){for(var j=0,l=this.map.layers.length;j<l;j++){if(b==this.map.layers[j].div||b==this.map.layers[j].pane){p=true;break}}}g=(b==this.map.div);b=b.parentNode}if(!h&&g){if(p){var o=0;if(!m){m=window.event}if(m.wheelDelta){o=m.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){o=-o}}else{if(m.detail){o=-m.detail/3}}this.delta=this.delta+o;if(this.interval){window.clearTimeout(this._timeoutId);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(m)},this),this.interval)}else{this.wheelZoom(m)}}OpenLayers.Event.stop(m)}},wheelZoom:function(a){var b=this.delta;this.delta=0;if(b){if(this.mousePosition){a.xy=this.mousePosition}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter())}if(b<0){this.callback("down",[a,this.cumulative?b:-1])}else{this.callback("up",[a,this.cumulative?b:1])}}},mousemove:function(a){this.mousePosition=a.xy},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true}else{return false}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(d,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.observe(document,this.KEY_EVENTS[b],this.eventListener)}return true}else{return false}},deactivate:function(){var d=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[b],this.eventListener)}d=true}return d},handleKeyEvent:function(a){if(this.checkModifiers(a)){this.callback(a.type,[a])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a)}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";
this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}if(this.title!=""){this.div.title=this.title}}if(a!=null){this.position=a.clone()}this.moveTo(this.position);return this.div},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var d=0,a=this.map.layers.length;d<a;d++){var b=this.map.layers[d];if(b.attribution&&b.getVisibility()){if(OpenLayers.Util.indexOf(e,b.attribution)===-1){e.push(b.attribution)}}}this.div.innerHTML=e.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(j){if(j instanceof OpenLayers.Bounds){var b;if(!this.out){var l=this.map.getLonLatFromPixel(new OpenLayers.Pixel(j.left,j.bottom));var q=this.map.getLonLatFromPixel(new OpenLayers.Pixel(j.right,j.top));b=new OpenLayers.Bounds(l.lon,l.lat,q.lon,q.lat)}else{var h=Math.abs(j.right-j.left);var m=Math.abs(j.top-j.bottom);var f=Math.min((this.map.size.h/m),(this.map.size.w/h));var r=this.map.getExtent();var a=this.map.getLonLatFromPixel(j.getCenterPixel());var d=a.lon-(r.getWidth()/2)*f;var g=a.lon+(r.getWidth()/2)*f;var p=a.lat-(r.getHeight()/2)*f;var e=a.lat+(r.getHeight()/2)*f;b=new OpenLayers.Bounds(d,p,g,e)}var o=this.map.getZoom();this.map.zoomToExtent(b);if(o==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(o+(this.out?-1:1))}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(j),this.map.getZoom()+1)}else{this.map.setCenter(this.map.getLonLatFromPixel(j),this.map.getZoom()-1)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:1,documentDrag:false,kinetic:null,enableKinetic:false,kineticInterval:10,draw:function(){if(this.enableKinetic){var a={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){a=OpenLayers.Util.extend(a,this.enableKinetic)}this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})
},panMapStart:function(){if(this.kinetic){this.kinetic.begin()}},panMap:function(a){if(this.kinetic){this.kinetic.update(a)}this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:true,animate:false})},panMapDone:function(d){if(this.panned){var b=null;if(this.kinetic){b=this.kinetic.end(d)}this.map.pan(this.handler.last.x-d.x,this.handler.last.y-d.y,{dragging:!!b,animate:false});if(b){var a=this;this.kinetic.move(b,function(e,g,f){a.map.pan(e,g,{dragging:!f,animate:false})})}this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;if(this.pinchZoom){this.pinchZoom.destroy()}this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate()}if(this.pinchZoom){this.pinchZoom.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.pinchZoom){this.pinchZoom.deactivate()}this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False}var a={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);if(OpenLayers.Control.PinchZoom){this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))}},defaultClick:function(a){if(a.lastTouches&&a.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1)},defaultDblRightClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom-1)},wheelChange:function(l,d){var j=this.map.getZoom();var g=this.map.getZoom()+Math.round(d);g=Math.max(g,0);g=Math.min(g,this.map.getNumZoomLevels());if(g===j){return}var m=this.map.getSize();var f=m.w/2-l.xy.x;var e=l.xy.y-m.h/2;var h=this.map.baseLayer.getResolutionForZoom(g);var a=this.map.getLonLatFromPixel(l.xy);var b=new OpenLayers.LonLat(a.lon+f*h,a.lat+e*h);this.map.setCenter(b,g)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate()}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerOrigin:null,pinchOrigin:null,currentCenter:null,autoActivate:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var a=OpenLayers.Control.prototype.activate.apply(this,arguments);if(a){this.map.events.on({moveend:this.updateContainerOrigin,scope:this});this.updateContainerOrigin()}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.apply(this,arguments);if(this.map&&this.map.events){this.map.events.un({moveend:this.updateContainerOrigin,scope:this})}return a},updateContainerOrigin:function(){var a=this.map.layerContainerDiv;this.containerOrigin={x:parseInt(a.style.left,10),y:parseInt(a.style.top,10)}},pinchStart:function(a,b){this.pinchOrigin=a.xy;this.currentCenter=a.xy},pinchMove:function(b,j){var h=j.scale;var g=this.containerOrigin;var e=this.pinchOrigin;var f=b.xy;var d=Math.round((f.x-e.x)+(h-1)*(g.x-e.x));var a=Math.round((f.y-e.y)+(h-1)*(g.y-e.y));this.applyTransform("translate("+d+"px, "+a+"px) scale("+h+")");this.currentCenter=f},applyTransform:function(a){var b=this.map.layerContainerDiv.style;b["-webkit-transform"]=a;b["-moz-transform"]=a},pinchDone:function(b,j,h){this.applyTransform("");var g=this.map.getZoomForResolution(this.map.getResolution()/h.scale,true);if(g!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var e=this.map.getResolutionForZoom(g);var a=this.map.getLonLatFromPixel(this.pinchOrigin);var d=this.currentCenter;var f=this.map.getSize();a.lon+=e*((f.w/2)-d.x);a.lat-=e*((f.h/2)-d.y);this.map.setCenter(a,g)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:false,autoActivate:true,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.pinchZoom){this.pinchZoom.destroy();delete this.pinchZoom}OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.dragPan.activate();this.handlers.click.activate();this.pinchZoom.activate();return true}return false},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.dragPan.deactivate();this.handlers.click.deactivate();this.pinchZoom.deactivate();return true}return false},draw:function(){var a={click:this.defaultClick,dblclick:this.defaultDblClick};var b=OpenLayers.Util.extend({"double":true,stopDouble:true,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(a){if(a.lastTouches&&a.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});
this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}var a=!this.performedDrag;this.performedDrag=false;return a},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.eventsDiv.appendChild(this.zoomBox)}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(a)},defaultMouseMove:function(f){this.mousePosition=f.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var e=Math.abs(this.mouseDragStart.x-f.xy.x);var b=Math.abs(this.mouseDragStart.y-f.xy.y);this.zoomBox.style.width=Math.max(1,e)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(f.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=f.xy.x+"px"}if(f.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=f.xy.y+"px"}}else{var e=this.mouseDragStart.x-f.xy.x;var b=this.mouseDragStart.y-f.xy.y;var g=this.map.getSize();var a=new OpenLayers.Pixel(g.w/2+e,g.h/2+b);var d=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(d,null,true);this.mouseDragStart=f.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomBox){this.zoomBoxEnd(a)}else{if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor=""},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.eventsDiv)){if(this.zoomBox){this.removeZoomBox()}this.mouseDragStart=null}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1)}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1)}},zoomBoxEnd:function(b){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-b.xy.x)>5||Math.abs(this.mouseDragStart.y-b.xy.y)>5){var j=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var a=this.map.getLonLatFromViewPortPx(b.xy);var h=Math.max(j.lat,a.lat);var d=Math.min(j.lat,a.lat);var g=Math.min(j.lon,a.lon);var e=Math.max(j.lon,a.lon);var f=new OpenLayers.Bounds(g,d,e,h);this.map.zoomToExtent(f)}else{var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(new OpenLayers.LonLat((a.lon),(a.lat)),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.eventsDiv.removeChild(this.zoomBox);this.zoomBox=null},onWheelEvent:function(d){var b=false;var a=OpenLayers.Event.element(d);while(a!=null){if(this.map&&a==this.map.div){b=true;break}a=a.parentNode}if(b){var f=0;if(!d){d=window.event}if(d.wheelDelta){f=d.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){f=-f}}else{if(d.detail){f=-d.detail/3}}if(f){d.xy=this.mousePosition;if(f<0){this.defaultWheelDown(d)}else{this.defaultWheelUp(d)}}OpenLayers.Event.stop(d)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}return this.div},redraw:function(a){var d;if(a==null){this.reset();return}else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return}d=this.map.getLonLatFromPixel(a.xy);if(!d){return}if(this.displayProjection){d.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=a.xy}var b=this.formatOutput(d);if(b!=this.element.innerHTML){this.element.innerHTML=b}},reset:function(a){if(this.emptyString!=null){this.element.innerHTML=this.emptyString}},formatOutput:function(b){var d=parseInt(this.numDigits);var a=this.prefix+b.lon.toFixed(d)+this.separator+b.lat.toFixed(d)+this.suffix;return a},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,maximized:false,initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){if(!this.mapDiv){return}if(this.handlers.click){this.handlers.click.destroy()}if(this.handlers.drag){this.handlers.drag.destroy()}this.ovmap&&this.ovmap.eventsDiv.removeChild(this.extentRectangle);this.extentRectangle=null;if(this.rectEvents){this.rectEvents.destroy();this.rectEvents=null}if(this.ovmap){this.ovmap.destroy();this.ovmap=null}this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){OpenLayers.Event.stopObservingElement(this.minimizeDiv);this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var e=this.map.baseLayer.clone();this.layers=[e]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var f=OpenLayers.Util.getImagesLocation();var b=f+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(18,18),b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));
this.div.appendChild(this.maximizeDiv);var b=f+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(18,18),b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var g=["dblclick","mousedown"];for(var d=0,a=g.length;d<a;d++){OpenLayers.Event.observe(this.maximizeDiv,g[d],OpenLayers.Event.stop);OpenLayers.Event.observe(this.minimizeDiv,g[d],OpenLayers.Event.stop)}this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);if(this.maximized){this.maximizeControl()}return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(l){var e=this.handlers.drag.last.x-l.x;var b=this.handlers.drag.last.y-l.y;if(e!=0||b!=0){var h=this.rectPxBounds.top;var a=this.rectPxBounds.left;var f=Math.abs(this.rectPxBounds.getHeight());var d=this.rectPxBounds.getWidth();var g=Math.max(0,(h-b));g=Math.min(g,this.ovmap.size.h-this.hComp-f);var j=Math.max(0,(a-e));j=Math.min(j,this.ovmap.size.w-this.wComp-d);this.setRectPxBounds(new OpenLayers.Bounds(j,g+f,j+d,g))}},mapDivClick:function(l){var b=this.rectPxBounds.getCenterPixel();var f=l.xy.x-b.x;var e=l.xy.y-b.y;var h=this.rectPxBounds.top;var d=this.rectPxBounds.left;var m=Math.abs(this.rectPxBounds.getHeight());var a=this.rectPxBounds.getWidth();var g=Math.max(0,(h+e));g=Math.min(g,this.ovmap.size.h-m);var j=Math.max(0,(d+f));j=Math.min(j,this.ovmap.size.w-a);this.setRectPxBounds(new OpenLayers.Bounds(j,g+m,j+a,g));this.updateMapToRect()},maximizeControl:function(a){this.element.style.display="";this.showToggle(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.element.style.display="none";this.showToggle(true);if(a!=null){OpenLayers.Event.stop(a)}},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":""},update:function(){if(this.ovmap==null){this.createMap()}if(this.autoPan||!this.isSuitableOverview()){this.updateOverview()}this.updateRectToMap()},isSuitableOverview:function(){var b=this.map.getExtent();var a=this.map.maxExtent;var d=new OpenLayers.Bounds(Math.max(b.left,a.left),Math.max(b.bottom,a.bottom),Math.min(b.right,a.right),Math.min(b.top,a.top));if(this.ovmap.getProjection()!=this.map.getProjection()){d=d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}var e=this.ovmap.getResolution()/this.map.getResolution();return((e>this.minRatio)&&(e<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(d)))},updateOverview:function(){var d=this.map.getResolution();var b=this.ovmap.getResolution();var e=b/d;if(e>this.maxRatio){b=this.minRatio*d}else{if(e<=this.minRatio){b=this.maxRatio*d}}var a;if(this.ovmap.getProjection()!=this.map.getProjection()){a=this.map.center.clone();a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{a=this.map.center}this.ovmap.setCenter(a,this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var b=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,b);this.ovmap.eventsDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;
this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(f){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(f){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}});if(this.ovmap.getProjection()!=this.map.getProjection()){var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var a=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=d&&a?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[a]:1}},updateRectToMap:function(){var b;if(this.ovmap.getProjection()!=this.map.getProjection()){b=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{b=this.map.getExtent()}var a=this.getRectBoundsFromMapBounds(b);if(a){this.setRectPxBounds(a)}},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection()){a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())}this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(e){var h=Math.max(e.top,0);var f=Math.max(e.left,0);var b=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp);var j=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp);var d=Math.max(j-f,0);var l=Math.max(b-h,0);if(d<this.minRectSize||l<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var g=f+(d/2)-(this.minRectSize/2);var a=h+(l/2)-(this.minRectSize/2);this.extentRectangle.style.top=Math.round(a)+"px";this.extentRectangle.style.left=Math.round(g)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(h)+"px";this.extentRectangle.style.left=Math.round(f)+"px";this.extentRectangle.style.height=Math.round(l)+"px";this.extentRectangle.style.width=Math.round(d)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(f),Math.round(b),Math.round(j),Math.round(h))},getRectBoundsFromMapBounds:function(e){var a=new OpenLayers.LonLat(e.left,e.bottom);var g=new OpenLayers.LonLat(e.right,e.top);var d=this.getOverviewPxFromLonLat(a);var b=this.getOverviewPxFromLonLat(g);var f=null;if(d&&b){f=new OpenLayers.Bounds(d.x,d.y,b.x,b.y)}return f},getMapBoundsFromRectBounds:function(e){var d=new OpenLayers.Pixel(e.left,e.bottom);var b=new OpenLayers.Pixel(e.right,e.top);var a=this.getLonLatFromOverviewPx(d);var f=this.getLonLatFromOverviewPx(b);return new OpenLayers.Bounds(a.lon,a.lat,f.lon,f.lat)},getLonLatFromOverviewPx:function(g){var d=this.ovmap.size;var b=this.ovmap.getResolution();var a=this.ovmap.getExtent().getCenterLonLat();var f=g.x-(d.w/2);var e=g.y-(d.h/2);return new OpenLayers.LonLat(a.lon+f*b,a.lat-e*b)},getOverviewPxFromLonLat:function(e){var b=this.ovmap.getResolution();var d=this.ovmap.getExtent();var a=null;if(d){a=new OpenLayers.Pixel(Math.round(1/b*(e.lon-d.left)),Math.round(1/b*(d.top-e.lat)))}return a},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,slideFactor:75,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress})},defaultKeyPress:function(a){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);
break;case 33:var b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:var b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:var b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:var b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.removeButtons();this.buttons=null;this.position=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position;this.buttons=[];var d=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+d.w/2,b.y);this._addButton("panup","north-mini.png",a,d);b.y=a.y+d.h;this._addButton("panleft","west-mini.png",b,d);this._addButton("panright","east-mini.png",b.add(d.w,0),d);this._addButton("pandown","south-mini.png",a.add(0,d.h*2),d);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,d.h*3+5),d);this._addButton("zoomworld","zoom-world-mini.png",a.add(0,d.h*4+5),d);this._addButton("zoomout","zoom-minus-mini.png",a.add(0,d.h*5+5),d);return this.div},_addButton:function(a,e,l,h){var g=OpenLayers.Util.getImagesLocation()+e;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,l,h,g,"absolute");b.style.cursor="pointer";this.div.appendChild(b);OpenLayers.Event.observe(b,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,b));OpenLayers.Event.observe(b,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));b.action=a;b.map=this.map;if(!this.slideRatio){var d=this.slideFactor;var f=function(){return d}}else{var j=this.slideRatio;var f=function(m){return this.map.getSize()[m]*j}}b.getSlideFactor=f;this.buttons.push(b);return b},_removeButton:function(a){OpenLayers.Event.stopObservingElement(a);a.map=null;a.getSlideFactor=null;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a){this._removeButton(this.buttons[a])}},doubleClick:function(a){OpenLayers.Event.stop(a);return false},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break}OpenLayers.Event.stop(a)},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,panIcons:true,forceFixedZoomLevel:false,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position.clone();this.buttons=[];var e=new OpenLayers.Size(18,18);if(this.panIcons){var a=new OpenLayers.Pixel(b.x+e.w/2,b.y);var d=e.w;if(this.zoomWorldIcon){a=new OpenLayers.Pixel(b.x+e.w,b.y)
}this._addButton("panup","north-mini.png",a,e);b.y=a.y+e.h;this._addButton("panleft","west-mini.png",b,e);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",b.add(e.w,0),e);d*=2}this._addButton("panright","east-mini.png",b.add(d,0),e);this._addButton("pandown","south-mini.png",a.add(0,e.h*2),e);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,e.h*3+5),e);a=this._addZoomBar(a.add(0,e.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",a,e)}else{this._addButton("zoomin","zoom-plus-mini.png",b,e);a=this._addZoomBar(b.add(0,e.h));this._addButton("zoomout","zoom-minus-mini.png",a,e);if(this.zoomWorldIcon){a=a.add(0,e.h+3);this._addButton("zoomworld","zoom-world-mini.png",a,e)}}return this.div},_addZoomBar:function(a){var f=OpenLayers.Util.getImagesLocation();var h=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var d=OpenLayers.Util.createAlphaImageDiv(h,a.add(-1,b*this.zoomStopHeight),new OpenLayers.Size(20,9),f+"slider.png","absolute");d.style.cursor="move";this.slider=d;this.sliderEvents=new OpenLayers.Events(this,d,null,true,{includeXY:true});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var e=new OpenLayers.Size();e.h=this.zoomStopHeight*this.map.getNumZoomLevels();e.w=this.zoomStopWidth;var g=null;if(OpenLayers.Util.alphaHack()){var h=this.id+"_"+this.map.id;g=OpenLayers.Util.createAlphaImageDiv(h,a,new OpenLayers.Size(e.w,this.zoomStopHeight),f+"zoombar.png","absolute",null,"crop");g.style.height=e.h+"px"}else{g=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,e,f+"zoombar.png")}g.style.cursor="pointer";this.zoombarDiv=g;this.divEvents=new OpenLayers.Events(this,g,null,true,{includeXY:true});this.divEvents.on({touchmove:this.passEventToSlider,mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(g);this.startTop=parseInt(g.style.top);this.div.appendChild(d);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a},_removeZoomBar:function(){this.sliderEvents.un({touchmove:this.zoomBarDrag,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({touchmove:this.passEventToSlider,mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}var d=a.xy.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){d=Math.floor(d)}var b=(this.map.getNumZoomLevels()-1)-d;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b);OpenLayers.Event.stop(a)},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)&&!OpenLayers.Event.isSingleTouch(a)){return}this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a)},zoomBarDrag:function(b){if(this.mouseDragStart!=null){var a=this.mouseDragStart.y-b.xy.y;var e=OpenLayers.Util.pagePosition(this.zoombarDiv);if((b.clientY-e[1])>0&&(b.clientY-e[1])<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-a;this.slider.style.top=d+"px";this.mouseDragStart=b.xy.clone()}this.deltaY=this.zoomStart.y-b.xy.y;OpenLayers.Event.stop(b)}},zoomBarUp:function(a){if(!OpenLayers.Event.isLeftClick(a)&&a.type!=="touchend"){return}if(this.mouseDragStart){this.div.style.cursor="";
this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){b+=this.deltaY/this.zoomStopHeight;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)}else{b+=this.deltaY/this.zoomStopHeight;b=Math.max(Math.round(b),0)}this.map.zoomTo(b);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(b){b=b||window.location.href;var d=OpenLayers.Util.getParameters(b);var a=b.indexOf("#");if(a>0){b="?"+b.substring(a+1,b.length);OpenLayers.Util.extend(d,OpenLayers.Util.getParameters(b))}return d},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var d=0,a=this.map.controls.length;d<a;d++){var e=this.map.controls[d];if((e!=this)&&(e.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(e.displayProjection!=this.displayProjection){this.displayProjection=e.displayProjection}break}}if(d==this.map.controls.length){var b=this.getParameters();if(b.layers){this.layers=b.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(b.lat&&b.lon){this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat));if(b.zoom){this.zoom=parseInt(b.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var d=0,a=this.layers.length;d<a;d++){var b=this.map.layers[d];var e=this.layers.charAt(d);if(e=="B"){this.map.setBaseLayer(b)}else{if((e=="T")||(e=="F")){b.setVisibility(e=="T")}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:false,base:"",displayProjection:null,initialize:function(b,d,a){if(b!==null&&typeof b=="object"&&!OpenLayers.Util.isElement(b)){a=b;this.base=document.location.href;OpenLayers.Control.prototype.initialize.apply(this,[a]);if(this.element!=null){this.element=OpenLayers.Util.getElement(this.element)}}else{OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b);this.base=d||document.location.href}},destroy:function(){if(this.element.parentNode==this.div){this.div.removeChild(this.element)}this.element=null;this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,a=this.map.controls.length;b<a;b++){var d=this.map.controls[b];if(d.CLASS_NAME==this.argParserClass.CLASS_NAME){if(d.displayProjection!=this.displayProjection){this.displayProjection=d.displayProjection}break}}if(b==this.map.controls.length){this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element&&!this.anchor){this.element=document.createElement("a");this.element.innerHTML=OpenLayers.i18n("Permalink");this.element.href="";this.div.appendChild(this.element)}this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var b=this.anchor?"#":"?";var a=this.base;if(a.indexOf(b)!=-1){a=a.substring(0,a.indexOf(b))}a+=b+OpenLayers.Util.getParameterString(this.createParams());
if(this.anchor&&!this.element){window.location.href=a}else{this.element.href=a}},createParams:function(a,m,f){a=a||this.map.getCenter();var e=OpenLayers.Util.getParameters(this.base);if(a){e.zoom=m||this.map.getZoom();var l=a.lat;var b=a.lon;if(this.displayProjection){var d=OpenLayers.Projection.transform({x:b,y:l},this.map.getProjectionObject(),this.displayProjection);b=d.x;l=d.y}e.lat=Math.round(l*100000)/100000;e.lon=Math.round(b*100000)/100000;f=f||this.map.layers;e.layers="";for(var g=0,j=f.length;g<j;g++){var h=f[g];if(h.isBaseLayer){e.layers+=(h==this.map.baseLayer)?"B":"0"}else{e.layers+=(h.getVisibility())?"T":"F"}}}return e},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var d;if(this.geodesic===true){var a=this.map.getUnits();if(!a){return}var b=OpenLayers.INCHES_PER_UNIT;d=(this.map.getGeodesicPixelSize().w||0.000001)*b.km*OpenLayers.DOTS_PER_INCH}else{d=this.map.getScale()}if(!d){return}if(d>=9500&&d<=950000){d=Math.round(d/1000)+"K"}else{if(d>=950000){d=Math.round(d/1000000)+"M"}else{d=Math.round(d)}}this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:d})},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(b){var e=parseInt(Math.log(b)/Math.log(10));var a=Math.pow(10,e);var d=parseInt(b/a);var f;if(d>5){f=5}else{if(d>2){f=2}else{f=1}}return f*a},update:function(){var m=this.map.getResolution();if(!m){return}var u=this.map.getUnits();var f=OpenLayers.INCHES_PER_UNIT;var p=this.maxWidth*m*f[u];var r=1;if(this.geodesic===true){var b=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;var g=p/f.km;r=b/g;p*=r}var a;var e;if(p>100000){a=this.topOutUnits;e=this.bottomOutUnits}else{a=this.topInUnits;e=this.bottomInUnits}var j=p/f[a];var o=p/f[e];var l=this.getBarLen(j);var h=this.getBarLen(o);j=l/f[u]*f[a];o=h/f[u]*f[e];var d=j/m/r;var q=o/m/r;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(q)+"px";this.eBottom.innerHTML=h+" "+e}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(d)+"px";this.eTop.innerHTML=l+" "+a}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesnap","snap","unsnap"],DEFAULTS:{tolerance:10,node:true,edge:true,vertex:true},greedy:true,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.layer){this.setLayer(this.options.layer)}var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);
this.setTargets(this.options.targets);if(this.targets.length===0&&this.layer){this.addTargetLayer(this.layer)}this.geoToleranceCache={}},setLayer:function(a){if(this.active){this.deactivate();this.layer=a;this.activate()}else{this.layer=a}},setTargets:function(b){this.targets=[];if(b&&b.length){var e;for(var d=0,a=b.length;d<a;++d){e=b[d];if(e instanceof OpenLayers.Layer.Vector){this.addTargetLayer(e)}else{this.addTarget(e)}}}},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=a.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)},removeTargetLayer:function(b){var d;for(var a=this.targets.length-1;a>=0;--a){d=this.targets[a];if(d.layer===b){this.removeTarget(d)}}},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}this.feature=null;this.point=null;return a},onSketchModified:function(a){this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(j,e){var a={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null};var d=false;var l,g;for(var b=0,f=this.targets.length;b<f;++b){g=this.targets[b];l=this.testTarget(g,e);if(l){if(this.greedy){a=l;a.target=g;d=true;break}else{if((l.rank<a.rank)||(l.rank===a.rank&&l.dist<a.dist)){a=l;a.target=g;d=true}}}}if(d){var h=this.events.triggerEvent("beforesnap",{point:j,x:a.x,y:a.y,distance:a.dist,layer:a.target.layer,snapType:this.precedence[a.rank]});if(h!==false){j.x=a.x;j.y=a.y;this.point=j;this.events.triggerEvent("snap",{point:j,snapType:this.precedence[a.rank],layer:a.target.layer,distance:a.dist})}else{d=false}}if(this.point&&!d){j.x=e.x;j.y=e.y;this.point=null;this.events.triggerEvent("unsnap",{point:j})}},testTarget:function(G,g){var v=this.layer.map.getResolution();if("minResolution" in G){if(v<G.minResolution){return null}}if("maxResolution" in G){if(v>=G.maxResolution){return null}}var E={node:this.getGeoTolerance(G.nodeTolerance,v),vertex:this.getGeoTolerance(G.vertexTolerance,v),edge:this.getGeoTolerance(G.edgeTolerance,v)};var h=Math.max(E.node,E.vertex,E.edge);var l={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY};var f=false;var d=G.layer.features;var b,a,e,F,q,r,p;var o=this.precedence.length;var m=new OpenLayers.LonLat(g.x,g.y);for(var C=0,D=d.length;C<D;++C){b=d[C];if(b!==this.feature&&!b._sketch&&b.state!==OpenLayers.State.DELETE&&(!G.filter||G.filter.evaluate(b.attributes))){if(b.atPoint(m,h,h)){for(var B=0,u=Math.min(l.rank+1,o);B<u;++B){a=this.precedence[B];if(G[a]){if(a==="edge"){q=b.geometry.distanceTo(g,{details:true});r=q.distance;if(r<=E[a]&&r<l.dist){l={rank:B,dist:r,x:q.x0,y:q.y0};f=true;break}}else{e=b.geometry.getVertices(a==="node");p=false;for(var z=0,w=e.length;z<w;++z){F=e[z];r=F.distanceTo(g);if(r<=E[a]&&(B<l.rank||(B===l.rank&&r<l.dist))){l={rank:B,dist:r,x:F.x,y:F.y};f=true;p=true}}if(p){break}}}}}}}return f?l:null},getGeoTolerance:function(a,b){if(b!==this.resolution){this.resolution=b;this.geoToleranceCache={}}var d=this.geoToleranceCache[a];if(d===undefined){d=a*b;this.geoToleranceCache[a]=d}return d},destroy:function(){if(this.active){this.deactivate()}delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});
OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesplit","split","aftersplit"],layer:null,source:null,sourceOptions:null,tolerance:null,edge:true,deferDelete:false,mutual:true,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.source){this.setSource(this.options.source)}},setSource:function(a){if(this.active){this.deactivate();if(this.handler){this.handler.destroy();delete this.handler}this.source=a;this.activate()}else{this.source=a}},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(!this.source){if(!this.handler){this.handler=new OpenLayers.Handler.Path(this,{done:function(b){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(b)})}},{layerOptions:this.sourceOptions})}this.handler.activate()}else{if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.source&&this.source.events){this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}return a},onSketchComplete:function(a){this.feature=null;return !this.considerSplit(a.feature)},afterFeatureModified:function(b){if(b.modified){var a=b.feature;if(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString){this.feature=b.feature;this.considerSplit(b.feature)}}},removeByGeometry:function(d,e){for(var b=0,a=d.length;b<a;++b){if(d[b].geometry===e){d.splice(b,1);break}}},isEligible:function(a){return(a.state!==OpenLayers.State.DELETE)&&(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString)&&(this.feature!==a)&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes))},considerSplit:function(d){var l=false;var g=false;if(!this.sourceFilter||this.sourceFilter.evaluate(d.attributes)){var h=this.layer&&this.layer.features||[];var F,r,a;var o=[],E=[];var e=(this.layer===this.source)&&this.mutual;var b={edge:this.edge,tolerance:this.tolerance,mutual:e};var m=[d.geometry];var q,f;var v,u;for(var C=0,D=h.length;C<D;++C){q=h[C];if(this.isEligible(q)){f=[q.geometry];for(var B=0;B<m.length;++B){v=m[B];for(var w=0;w<f.length;++w){F=f[w];if(v.getBounds().intersectsBounds(F.getBounds())){r=v.split(F,b);if(r){a=this.events.triggerEvent("beforesplit",{source:d,target:q});if(a!==false){if(e){u=r[0];if(u.length>1){u.unshift(B,1);Array.prototype.splice.apply(m,u);B+=u.length-3}r=r[1]}if(r.length>1){r.unshift(w,1);Array.prototype.splice.apply(f,r);w+=r.length-3}}}}}}if(f&&f.length>1){this.geomsToFeatures(q,f);this.events.triggerEvent("split",{original:q,features:f});Array.prototype.push.apply(o,f);E.push(q);g=true}}}if(m&&m.length>1){this.geomsToFeatures(d,m);this.events.triggerEvent("split",{original:d,features:m});Array.prototype.push.apply(o,m);E.push(d);l=true}if(l||g){if(this.deferDelete){var p,z=[];for(var C=0,D=E.length;C<D;++C){p=E[C];if(p.state===OpenLayers.State.INSERT){z.push(p)}else{p.state=OpenLayers.State.DELETE;this.layer.drawFeature(p)}}this.layer.destroyFeatures(z,{silent:true});for(var C=0,D=o.length;C<D;++C){o[C].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(E,{silent:true})}this.layer.addFeatures(o,{silent:true});this.events.triggerEvent("aftersplit",{source:d,features:o})}}return l},geomsToFeatures:function(d,e){var g=d.clone();delete g.geometry;var f;for(var b=0,a=e.length;b<a;++b){f=g.clone();f.geometry=e[b];f.state=OpenLayers.State.INSERT;e[b]=f}},destroy:function(){if(this.active){this.deactivate()}OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:true,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.layerStates=[]},destroy:function(){OpenLayers.Event.stopObservingElement(this.div);OpenLayers.Event.stopObservingElement(this.minimizeDiv);OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},clearLayersArray:function(e){var f=this[e+"Layers"];if(f){for(var d=0,a=f.length;d<a;d++){var b=f[d];OpenLayers.Event.stopObservingElement(b.inputElem);OpenLayers.Event.stopObservingElement(b.labelSpan)}}this[e+"LayersDiv"].innerHTML="";this[e+"Layers"]=[]},checkRedraw:function(){var f=false;if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){f=true}else{for(var d=0,a=this.layerStates.length;d<a;d++){var e=this.layerStates[d];var b=this.map.layers[d];if((e.name!=b.name)||(e.inRange!=b.inRange)||(e.id!=b.id)||(e.visibility!=b.visibility)){f=true;break}}}return f},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var e=false;var p=false;var j=this.map.layers.length;this.layerStates=new Array(j);for(var g=0;g<j;g++){var h=this.map.layers[g];this.layerStates[g]={name:h.name,visibility:h.visibility,inRange:h.inRange,id:h.id}}var f=this.map.layers.slice();if(!this.ascending){f.reverse()}for(var g=0,j=f.length;g<j;g++){var h=f[g];var l=h.isBaseLayer;if(h.displayInLayerSwitcher){if(l){p=true}else{e=true}var o=(l)?(h==this.map.baseLayer):h.getVisibility();var m=document.createElement("input");m.id=this.id+"_input_"+h.name;m.name=(l)?this.id+"_baseLayers":h.name;m.type=(l)?"radio":"checkbox";m.value=h.name;m.checked=o;m.defaultChecked=o;if(!l&&!h.inRange){m.disabled=true}var a={inputElem:m,layer:h,layerSwitcher:this};OpenLayers.Event.observe(m,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var b=document.createElement("span");OpenLayers.Element.addClass(b,"labelSpan");if(!l&&!h.inRange){b.style.color="gray"}b.innerHTML=h.name;b.style.verticalAlign=(l)?"bottom":"baseline";OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var r=document.createElement("br");var q=(l)?this.baseLayers:this.dataLayers;q.push({layer:h,inputElem:m,labelSpan:b});var d=(l)?this.baseLayersDiv:this.dataLayersDiv;d.appendChild(m);d.appendChild(b);d.appendChild(r)}}this.dataLbl.style.display=(e)?"":"none";this.baseLbl.style.display=(p)?"":"none";return this.div},onInputClick:function(a){if(!this.inputElem.disabled){if(this.inputElem.type=="radio"){this.inputElem.checked=true;this.layer.map.setBaseLayer(this.layer)}else{this.inputElem.checked=!this.inputElem.checked;this.layerSwitcher.updateMap()}}OpenLayers.Event.stop(a)},onLayerClick:function(a){this.updateMap()},updateMap:function(){for(var b=0,a=this.baseLayers.length;b<a;b++){var d=this.baseLayers[b];if(d.inputElem.checked){this.map.setBaseLayer(d.layer,false)}}for(var b=0,a=this.dataLayers.length;b<a;b++){var d=this.dataLayers[b];d.layer.setVisibility(d.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="";this.div.style.height="";this.showControls(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(a!=null){OpenLayers.Event.stop(a)}},showControls:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""},loadContents:function(){OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this));OpenLayers.Event.observe(this.div,"click",this.ignoreEvent);
OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this));OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent);this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);if(this.roundedCorner){OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:false});OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75)}var d=OpenLayers.Util.getImagesLocation();var b=new OpenLayers.Size(18,18);var a=d+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,b,a,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv");this.maximizeDiv.style.display="none";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var a=d+"layer-switcher-minimize.png";var b=new OpenLayers.Size(18,18);this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,b,a,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv");this.minimizeDiv.style.display="none";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv)},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=true;this.ignoreEvent(a)},mouseUp:function(a){if(this.isMouseDown){this.isMouseDown=false;this.ignoreEvent(a)}},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(b,d,a){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(g,f){this.layer.events.triggerEvent("sketchmodified",{vertex:g,feature:f})},create:function(g,f){this.layer.events.triggerEvent("sketchstarted",{vertex:g,feature:f})}},this.callbacks);this.layer=b;this.handlerOptions=this.handlerOptions||{};if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi}var e=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(e){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":e})})}this.handler=new d(this,this.callbacks,this.handlerOptions)},drawFeature:function(d){var a=new OpenLayers.Feature.Vector(d);var b=this.layer.events.triggerEvent("sketchcomplete",{feature:a});if(b!==false){a.state=OpenLayers.State.INSERT;this.layer.addFeatures([a]);this.featureAdded(a);this.events.triggerEvent("featureadded",{feature:a})}},insertXY:function(a,b){if(this.handler&&this.handler.line){this.handler.insertXY(a,b)}},insertDeltaXY:function(b,a){if(this.handler&&this.handler.line){this.handler.insertDeltaXY(b,a)
}},insertDirectionLength:function(b,a){if(this.handler&&this.handler.line){this.handler.insertDirectionLength(b,a)}},insertDeflectionLength:function(b,a){if(this.handler&&this.handler.line){this.handler.insertDeflectionLength(b,a)}},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(b,a){},onDrag:function(b,a){},onComplete:function(b,a){},onEnter:function(a){},onLeave:function(a){},documentDrag:false,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=b;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){if(this.handlers.feature.touch&&!this.over&&this.overFeature(a)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=false}},clickoutFeature:function(a){if(this.handlers.feature.touch&&this.over){this.outFeature(a);this.handlers.drag.stopDown=true}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(b){var a=false;if(!this.handlers.drag.dragging){this.feature=b;this.handlers.drag.activate();a=true;this.over=true;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(b)}else{if(this.feature.id==b.id){this.over=true}else{this.over=false}}return a},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(a);this.feature=null}else{if(this.feature.id==a.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,d){d=d||{};this.layer=e;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,d.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;
this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[d]);if(!(OpenLayers.Util.isArray(this.deleteCodes))){this.deleteCodes=[this.deleteCodes]}var g=this;var a={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};if(this.standalone===false){this.selectControl=new OpenLayers.Control.SelectFeature(e,a)}var b={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(j,h){g.dragStart.apply(g,[j,h])},onDrag:function(j,h){g.dragVertex.apply(g,[j,h])},onComplete:function(h){g.dragComplete.apply(g,[h])},featureCallbacks:{over:function(h){if(g.standalone!==true||h._sketch||g.feature===h){g.dragControl.overFeature.apply(g.dragControl,[h])}}}};this.dragControl=new OpenLayers.Control.DragFeature(e,b);var f={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,f)}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return((this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var d=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();var a=this.feature;var b=a&&a.geometry&&a.layer;if(this.standalone===false){if(b){this.selectControl.unselect.apply(this.selectControl,[a])}this.selectControl.deactivate()}else{if(b){this.unselectFeature(a)}}this.handlers.keyboard.deactivate();d=true}return d},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(b){if(!this.standalone||this.beforeSelectFeature(b)!==false){this.feature=b;this.modified=false;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)}var a=b.modified;if(b.geometry&&!(a&&a.geometry)){this._originalGeometry=b.geometry.clone()}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified});this.modified=false},dragStart:function(b,a){if(b!=this.feature&&!b.geometry.parent&&b!=this.dragHandle&&b!=this.radiusHandle){if(this.standalone===false&&this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)!=-1){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[b]);this.dragControl.overFeature.apply(this.dragControl,[b]);this.dragControl.lastPixel=a;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=a;this.dragControl.handlers.drag.last=a}}},dragVertex:function(b,a){this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=b){this.feature=b}this.layer.events.triggerEvent("vertexmodified",{vertex:b.geometry,feature:this.feature,pixel:a})}else{if(b._index){b.geometry.parent.addComponent(b.geometry,b._index);delete b._index;OpenLayers.Util.removeItem(this.virtualVertices,b);this.vertices.push(b)}else{if(b==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});
this.radiusHandle=null}}else{if(b!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:b.geometry,feature:this.feature,pixel:a})}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent)}this.layer.drawFeature(b)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE;if(this.modified&&this._originalGeometry){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry});delete this._originalGeometry}}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&OpenLayers.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,b)!=-1){var d=this.dragControl.feature;if(d&&OpenLayers.Util.indexOf(this.vertices,d)!=-1&&!this.dragControl.handlers.drag.dragging&&d.geometry.parent){d.geometry.parent.removeComponent(d.geometry);this.layer.events.triggerEvent("vertexremoved",{vertex:d.geometry,feature:this.feature,pixel:a.xy});this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent);this.modified=true;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var a=this;function b(j){var e,f,l,g;if(j.CLASS_NAME=="OpenLayers.Geometry.Point"){f=new OpenLayers.Feature.Vector(j);f._sketch=true;f.renderIntent=a.vertexRenderIntent;a.vertices.push(f)}else{var d=j.components.length;if(j.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){d-=1}for(e=0;e<d;++e){l=j.components[e];if(l.CLASS_NAME=="OpenLayers.Geometry.Point"){f=new OpenLayers.Feature.Vector(l);f._sketch=true;f.renderIntent=a.vertexRenderIntent;a.vertices.push(f)}else{b(l)}}if(j.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(e=0,g=j.components.length;e<g-1;++e){var p=j.components[e];var q=j.components[e+1];if(p.CLASS_NAME=="OpenLayers.Geometry.Point"&&q.CLASS_NAME=="OpenLayers.Geometry.Point"){var m=(p.x+q.x)/2;var h=(p.y+q.y)/2;var o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m,h),null,a.virtualStyle);o.geometry.parent=j;o._index=e+1;o._sketch=true;a.virtualVertices.push(o)}}}}}b.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var e=this.feature.geometry;var a=e.getBounds().getCenterLonLat();var d=new OpenLayers.Geometry.Point(a.lon,a.lat);var b=new OpenLayers.Feature.Vector(d);d.move=function(f,g){OpenLayers.Geometry.Point.prototype.move.call(this,f,g);e.move(f,g)};b._sketch=true;this.dragHandle=b;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var j=this.feature.geometry;var a=j.getBounds();
var b=a.getCenterLonLat();var l=new OpenLayers.Geometry.Point(b.lon,b.lat);var h=new OpenLayers.Geometry.Point(a.right,a.bottom);var g=new OpenLayers.Feature.Vector(h);var d=(this.mode&OpenLayers.Control.ModifyFeature.RESIZE);var f=(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE);var e=(this.mode&OpenLayers.Control.ModifyFeature.ROTATE);h.move=function(C,B){OpenLayers.Geometry.Point.prototype.move.call(this,C,B);var D=this.x-l.x;var v=this.y-l.y;var E=D-C;var w=v-B;if(e){var o=Math.atan2(w,E);var m=Math.atan2(v,D);var r=m-o;r*=180/Math.PI;j.rotate(r,l)}if(d){var q,z;if(f){q=v/w;z=(D/E)/q}else{var u=Math.sqrt((E*E)+(w*w));var p=Math.sqrt((D*D)+(v*v));q=p/u}j.resize(q,l,z)}};g._sketch=true;this.radiusHandle=g;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(a){this.standalone||this.selectControl.setMap(a);this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:true,defaultControl:null,saveState:false,allowDepress:false,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[];this.activeState={}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--){a=this.controls[b];if(a.events){a.events.un({activate:this.iconOn,deactivate:this.iconOff})}OpenLayers.Event.stopObservingElement(a.panel_div);a.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){var d;for(var b=0,a=this.controls.length;b<a;b++){d=this.controls[b];if(d===this.defaultControl||(this.saveState&&this.activeState[d.id])){d.activate()}}if(this.saveState===true){this.defaultControl=null}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){var d;for(var b=0,a=this.controls.length;b<a;b++){d=this.controls[b];this.activeState[d.id]=d.deactivate()}this.redraw();return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var b=this.div.childNodes.length,d=b-1;d>=0;d--){this.div.removeChild(this.div.childNodes[d])}this.div.innerHTML="";if(this.active){for(var d=0,a=this.controls.length;d<a;d++){this.div.appendChild(this.controls[d].panel_div)}}},activateControl:function(d){if(!this.active){return false}if(d.type==OpenLayers.Control.TYPE_BUTTON){d.trigger();return}if(d.type==OpenLayers.Control.TYPE_TOGGLE){if(d.active){d.deactivate()}else{d.activate()}return}if(this.allowDepress&&d.active){d.deactivate()}else{var e;for(var b=0,a=this.controls.length;b<a;b++){e=this.controls[b];if(e!=d&&(e.type===OpenLayers.Control.TYPE_TOOL||e.type==null)){e.deactivate()}}d.activate()}},addControls:function(b){if(!(OpenLayers.Util.isArray(b))){b=[b]}this.controls=this.controls.concat(b);for(var e=0,a=b.length;e<a;e++){var d=document.createElement("div");d.className=b[e].displayClass+"ItemInactive";b[e].panel_div=d;if(b[e].title!=""){b[e].panel_div.title=b[e].title}OpenLayers.Event.observe(b[e].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,b[e]));OpenLayers.Event.observe(b[e].panel_div,"dblclick",OpenLayers.Function.bind(this.onDoubleClick,this,b[e]));OpenLayers.Event.observe(b[e].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}if(this.map){this.addControlsToMap(b);this.redraw()}},addControlsToMap:function(b){var e;for(var d=0,a=b.length;d<a;d++){e=b[d];if(e.autoActivate===true){e.autoActivate=false;this.map.addControl(e);e.autoActivate=true}else{this.map.addControl(e);e.deactivate()}e.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var a=this.panel_div;a.className=a.className.replace(/ItemInactive$/,"ItemActive")
},iconOff:function(){var a=this.panel_div;a.className=a.className.replace(/ItemActive$/,"ItemInactive")},onClick:function(b,a){OpenLayers.Event.stop(a?a:window.event);this.activateControl(b)},onDoubleClick:function(b,a){OpenLayers.Event.stop(a?a:window.event)},getControlsBy:function(d,a){var e=(typeof a.test=="function");var b=OpenLayers.Array.filter(this.controls,function(f){return f[d]==a||(e&&a.test(f[d]))});return b},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(d,a){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);if(this.scope===null){this.scope=this}this.initLayer(d);var b={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){b.over=this.overFeature;b.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(b,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},initLayer:function(a){if(OpenLayers.Util.isArray(a)){this.layers=a;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})}else{this.layer=a}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(b){var g=this.layers||[this.layer];var f,e;for(var a=0;a<g.length;++a){f=g[a];for(var d=f.selectedFeatures.length-1;d>=0;--d){e=f.selectedFeatures[d];if(!b||b.except!=e){this.unselect(e)}}}},clickFeature:function(a){if(!this.hover){var b=(OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1);if(b){if(this.toggleSelect()){this.unselect(a)}else{if(!this.multipleSelect()){this.unselectAll({except:a})}}}else{if(!this.multipleSelect()){this.unselectAll({except:a})}this.select(a)}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(b){var a=b.layer;if(this.hover){if(this.highlightOnly){this.highlight(b)}else{if(OpenLayers.Util.indexOf(a.selectedFeatures,b)==-1){this.select(b)}}}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(a._lastHighlighter==this.id){if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);if(b){b.highlight(a)}}else{this.unhighlight(a)}}}else{this.unselect(a)}}},highlight:function(d){var b=d.layer;var a=this.events.triggerEvent("beforefeaturehighlighted",{feature:d});if(a!==false){d._prevHighlighter=d._lastHighlighter;d._lastHighlighter=this.id;var e=this.selectStyle||this.renderIntent;
b.drawFeature(d,e);this.events.triggerEvent("featurehighlighted",{feature:d})}},unhighlight:function(b){var a=b.layer;if(b._prevHighlighter==undefined){delete b._lastHighlighter}else{if(b._prevHighlighter==this.id){delete b._prevHighlighter}else{b._lastHighlighter=b._prevHighlighter;delete b._prevHighlighter}}a.drawFeature(b,b.style||b.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:b})},select:function(d){var a=this.onBeforeSelect.call(this.scope,d);var b=d.layer;if(a!==false){a=b.events.triggerEvent("beforefeatureselected",{feature:d});if(a!==false){b.selectedFeatures.push(d);this.highlight(d);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=b.selectedFeatures[0]}b.events.triggerEvent("featureselected",{feature:d});this.onSelect.call(this.scope,d)}}},unselect:function(b){var a=b.layer;this.unhighlight(b);OpenLayers.Util.removeItem(a.selectedFeatures,b);a.events.triggerEvent("featureunselected",{feature:b});this.onUnselect.call(this.scope,b)},selectBox:function(f){if(f instanceof OpenLayers.Bounds){var j=this.map.getLonLatFromPixel(new OpenLayers.Pixel(f.left,f.bottom));var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(f.right,f.top));var a=new OpenLayers.Bounds(j.lon,j.lat,o.lon,o.lat);if(!this.multipleSelect()){this.unselectAll()}var m=this.multiple;this.multiple=true;var e=this.layers||[this.layer];var g;for(var b=0;b<e.length;++b){g=e[b];for(var d=0,h=g.features.length;d<h;++d){var p=g.features[d];if(!p.getVisibility()){continue}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,p.geometry.CLASS_NAME)>-1){if(a.toGeometry().intersects(p.geometry)){if(OpenLayers.Util.indexOf(g.selectedFeatures,p)==-1){this.select(p)}}}}}this.multiple=m}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(b){var a=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(b);this.handlers.feature.layer=this.layer;if(a){this.activate()}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);var d={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(d,this.nextOptions);this.next=new OpenLayers.Control.Button(d);this.clear()},onPreviousChange:function(b,a){if(b&&!this.previous.active){this.previous.activate()}else{if(!b&&this.previous.active){this.previous.deactivate()}}},onNextChange:function(b,a){if(b&&!this.next.active){this.next.activate()}else{if(!b&&this.next.active){this.next.deactivate()}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var b=this.previousStack.shift();var a=this.previousStack.shift();if(a!=undefined){this.nextStack.unshift(b);this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(b)}return a},nextTrigger:function(){var a=this.nextStack.shift();
if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return a},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(f){var a,e;if(this.map.getProjectionObject()==f.projection){e=this.map.getZoomForResolution(f.resolution);a=f.center}else{a=f.center.clone();a.transform(f.projection,this.map.getProjectionObject());var g=f.units;var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var d=g&&b?OpenLayers.INCHES_PER_UNIT[g]/OpenLayers.INCHES_PER_UNIT[b]:1;e=this.map.getZoomForResolution(d*f.resolution)}this.map.setCenter(a,e)},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b])}a=true;if(this.previousStack.length==0){this.initStack()}}}return a},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var b=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var a in this.listeners){this.map.events.unregister(a,this,this.listeners[a])}if(this.clearOnDeactivate){this.clear()}b=true}}return b},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["measure","measurepartial"],handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,immediate:false,initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.Measure.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);var d={done:this.measureComplete,point:this.measurePartial};if(this.immediate){d.modify=this.measureImmediate}this.callbacks=OpenLayers.Util.extend(d,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new b(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(a){this.immediate=a;if(this.immediate){this.callbacks.modify=this.measureImmediate}else{delete this.callbacks.modify}},updateHandler:function(b,a){var d=this.active;if(d){this.deactivate()}this.handler=new b(this,this.callbacks,a);if(d){this.activate()}},measureComplete:function(a){this.cancelDelay();this.measure(a,"measure")},measurePartial:function(a,b){this.cancelDelay();b=b.clone();if(this.handler.freehandMode(this.handler.evt)){this.measure(b,"measurepartial")}else{this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(b,"measurepartial")},this),this.partialDelay)}},measureImmediate:function(a,d,b){if(b&&this.delayedTrigger===null&&!this.handler.freehandMode(this.handler.evt)){this.measure(d.geometry,"measurepartial")}},cancelDelay:function(){if(this.delayedTrigger!==null){window.clearTimeout(this.delayedTrigger);
this.delayedTrigger=null}},measure:function(e,b){var d,a;if(e.CLASS_NAME.indexOf("LineString")>-1){d=this.getBestLength(e);a=1}else{d=this.getBestArea(e);a=2}this.events.triggerEvent(b,{measure:d[0],units:d[1],order:a,geometry:e})},getBestArea:function(g){var b=this.displaySystemUnits[this.displaySystem];var f,e;for(var d=0,a=b.length;d<a;++d){f=b[d];e=this.getArea(g,f);if(e>1){break}}return[e,f]},getArea:function(g,a){var b,d;if(this.geodesic){b=g.getGeodesicArea(this.map.getProjectionObject());d="m"}else{b=g.getArea();d=this.map.getUnits()}var f=OpenLayers.INCHES_PER_UNIT[a];if(f){var e=OpenLayers.INCHES_PER_UNIT[d];b*=Math.pow((e/f),2)}return b},getBestLength:function(g){var b=this.displaySystemUnits[this.displaySystem];var f,e;for(var d=0,a=b.length;d<a;++d){f=b[d];e=this.getLength(g,f);if(e>1){break}}return[e,f]},getLength:function(g,a){var b,d;if(this.geodesic){b=g.getGeodesicLength(this.map.getProjectionObject());d="m"}else{b=g.getLength();d=this.map.getUnits()}var f=OpenLayers.INCHES_PER_UNIT[a];if(f){var e=OpenLayers.INCHES_PER_UNIT[d];b*=(e/f)}return b},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},activate:function(){if(!this.active){this.handler.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});this.request(a.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var f=this.layers||this.map.layers;var g=[];var e,b;for(var d=0,a=f.length;d<a;++d){e=f[d];if(e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){b=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;if(this.drillDown===false&&!this.url){this.url=b}if(this.drillDown===true||this.urlMatches(b)){g.push(e)}}}return g},urlMatches:function(b){var e=OpenLayers.Util.isEquivalentUrl(this.url,b);if(!e&&this.layerUrls){for(var d=0,a=this.layerUrls.length;d<a;++d){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[d],b)){e=true;break}}}return e},buildWMSOptions:function(b,f,d,o){var l=[],p=[];for(var g=0,j=f.length;g<j;g++){l=l.concat(f[g].params.LAYERS);p=p.concat(this.getStyleNames(f[g]))}var a=f[0];var h=this.map.getProjection();var m=a.projection;if(m&&m.equals(this.map.getProjectionObject())){h=m.getCode()}var e=OpenLayers.Util.extend({service:"WMS",version:a.params.VERSION,request:"GetFeatureInfo",layers:l,query_layers:l,styles:p,bbox:this.map.getExtent().toBBOX(null,a.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:o,info_format:a.params.INFO_FORMAT||this.infoFormat},(parseFloat(a.params.VERSION)>=1.3)?{crs:h,i:parseInt(d.x),j:parseInt(d.y)}:{srs:h,x:parseInt(d.x),y:parseInt(d.y)});
OpenLayers.Util.applyDefaults(e,this.vendorParams);return{url:b,params:OpenLayers.Util.upperCaseObject(e),callback:function(q){this.handleResponse(d,q,b)},scope:this}},getStyleNames:function(b){var a;if(b.params.STYLES){a=b.params.STYLES}else{if(OpenLayers.Util.isArray(b.params.LAYERS)){a=new Array(b.params.LAYERS.length)}else{a=b.params.LAYERS.replace(/[^,]/g,"")}}return a},request:function(b,p){var e=this.findLayers();if(e.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return}p=p||{};if(this.drillDown===false){var m=this.buildWMSOptions(this.url,e,b,e[0].params.FORMAT);var d=OpenLayers.Request.GET(m);if(p.hover===true){this.hoverRequest=d}}else{this._requestCount=0;this._numRequests=0;this.features=[];var l={},a;for(var f=0,j=e.length;f<j;f++){var g=e[f];var h,o=false;a=OpenLayers.Util.isArray(g.url)?g.url[0]:g.url;if(a in l){l[a].push(g)}else{this._numRequests++;l[a]=[g]}}var e;for(var a in l){e=l[a];var m=this.buildWMSOptions(a,e,b,e[0].params.FORMAT);OpenLayers.Request.GET(m)}}},triggerGetFeatureInfo:function(b,d,a){this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:a,request:b,xy:d});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(f,d,a){var e=d.responseXML;if(!e||!e.documentElement){e=d.responseText}var b=this.format.read(e);if(this.drillDown===false){this.triggerGetFeatureInfo(d,f,b)}else{this._requestCount++;if(this.output==="object"){this._features=(this._features||[]).concat({url:a,features:b})}else{this._features=(this._features||[]).concat(b)}if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(d,f,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,requestEncoding:"KVP",drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:true,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","getfeatureinfo","exception"],pending:0,initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMTSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){--this.pending;if(this.pending<=0){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");this.pending=0}this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var d=this.layers||this.map.layers;var e=[];var b;for(var a=d.length-1;a>=0;--a){b=d[a];if(b instanceof OpenLayers.Layer.WMTS&&b.requestEncoding===this.requestEncoding&&(!this.queryVisible||b.getVisibility())){e.push(b);if(!this.drillDown||this.hover){break}}}return e},buildRequestOptions:function(b,d){var g=this.map.getLonLatFromPixel(d);var f=b.getURL(new OpenLayers.Bounds(g.lon,g.lat,g.lon,g.lat));var e=OpenLayers.Util.getParameters(f);var a=b.getTileInfo(g);OpenLayers.Util.extend(e,{service:"WMTS",version:b.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:a.i,j:a.j});OpenLayers.Util.applyDefaults(e,this.vendorParams);return{url:OpenLayers.Util.isArray(b.url)?b.url[0]:b.url,params:OpenLayers.Util.upperCaseObject(e),callback:function(h){this.handleResponse(d,h,b)},scope:this}},request:function(j,l){l=l||{};
var d=this.findLayers();if(d.length>0){var h,f;for(var e=0,g=d.length;e<g;e++){f=d[e];h=this.events.triggerEvent("beforegetfeatureinfo",{xy:j,layer:f});if(h!==false){++this.pending;var a=this.buildRequestOptions(f,j);var b=OpenLayers.Request.GET(a);if(l.hover===true){this.hoverRequest=b}}}if(this.pending>0){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}}},handleResponse:function(h,f,b){--this.pending;if(this.pending<=0){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");this.pending=0}if(f.status&&(f.status<200||f.status>=300)){this.events.triggerEvent("exception",{xy:h,request:f,layer:b})}else{var g=f.responseXML;if(!g||!g.documentElement){g=f.responseText}var e,d;try{e=this.format.read(g)}catch(a){d=true;this.events.triggerEvent("exception",{xy:h,request:f,error:a,layer:b})}if(!d){this.events.triggerEvent("getfeatureinfo",{text:f.responseText,features:e,request:f,xy:h,layer:b})}}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesetfeature","setfeature","beforetransform","transform","transformcomplete"],geometryTypes:null,layer:null,preserveAspectRatio:false,rotate:true,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.TransformFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=b;if(!this.rotationHandleSymbolizer){this.rotationHandleSymbolizer={stroke:false,pointRadius:10,fillOpacity:0,cursor:"pointer"}}this.createBox();this.createControl()},activate:function(){var a=false;if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.dragControl.activate();this.layer.addFeatures([this.box]);this.rotate&&this.layer.addFeatures(this.rotationHandles);this.layer.addFeatures(this.handles);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.handles);this.rotate&&this.layer.removeFeatures(this.rotationHandles);this.layer.removeFeatures([this.box]);this.dragControl.deactivate();a=true}if(a){this.unsetFeature()}return a},setMap:function(a){this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(l,d){d=OpenLayers.Util.applyDefaults(d,{rotation:0,scale:1,ratio:1});var f=this.rotation;var a=this.center;OpenLayers.Util.extend(this,d);var m=this.events.triggerEvent("beforesetfeature",{feature:l});if(m===false){return}this.feature=l;this.activate();this._setfeature=true;var b=this.feature.geometry.getBounds();this.box.move(b.getCenterLonLat());this.box.geometry.rotate(-f,a);this._angle=0;var g;if(this.rotation){var h=l.geometry.clone();h.rotate(-this.rotation,this.center);var e=new OpenLayers.Feature.Vector(h.getBounds().toGeometry());e.geometry.rotate(this.rotation,this.center);this.box.geometry.rotate(this.rotation,this.center);this.box.move(e.geometry.getBounds().getCenterLonLat());var j=e.geometry.components[0].components[0];g=j.getBounds().getCenterLonLat()}else{g=new OpenLayers.LonLat(b.left,b.bottom)}this.handles[0].move(g);delete this._setfeature;this.events.triggerEvent("setfeature",{feature:l})},unsetFeature:function(){if(this.active){this.deactivate()}else{this.feature=null;this.rotation=0;this.scale=1;this.ratio=1}},createBox:function(){var f=this;this.center=new OpenLayers.Geometry.Point(0,0);var g=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,typeof this.renderIntent=="string"?null:this.renderIntent);g.geometry.move=function(r,u){f._moving=true;
OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);f.center.move(r,u);delete f._moving};var a=function(r,u){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(r,u);this._handle.geometry.move(r,u)};var q=function(v,r,u){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(v,r,u);this._handle.geometry.resize(v,r,u)};var o=function(u,r){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(u,r);this._handle.geometry.rotate(u,r)};var j=function(H,F){var M=this.x,J=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,H,F);if(f._moving){return}var K=f.dragControl.handlers.drag.evt;var r=!f._setfeature&&f.preserveAspectRatio;var z=!r&&!(K&&K.shiftKey);var G=new OpenLayers.Geometry.Point(M,J);var D=f.center;this.rotate(-f.rotation,D);G.rotate(-f.rotation,D);var I=this.x-D.x;var B=this.y-D.y;var L=I-(this.x-G.x);var C=B-(this.y-G.y);this.x=M;this.y=J;var v,E=1;if(z){v=Math.abs(C)<0.00001?1:B/C;E=(Math.abs(L)<0.00001?1:(I/L))/v}else{var w=Math.sqrt((L*L)+(C*C));var u=Math.sqrt((I*I)+(B*B));v=u/w}f._moving=true;f.box.geometry.rotate(-f.rotation,D);delete f._moving;f.box.geometry.resize(v,D,E);f.box.geometry.rotate(f.rotation,D);f.transformFeature({scale:v,ratio:E})};var d=function(E,C){var K=this.x,H=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,E,C);if(f._moving){return}var I=f.dragControl.handlers.drag.evt;var D=(I&&I.shiftKey)?45:1;var B=f.center;var G=this.x-B.x;var w=this.y-B.y;var J=G-E;var z=w-C;this.x=K;this.y=H;var u=Math.atan2(z,J);var r=Math.atan2(w,G);var v=r-u;v*=180/Math.PI;f._angle=(f._angle+v)%360;var F=f.rotation%D;if(Math.abs(f._angle)>=D||F!==0){v=Math.round(f._angle/D)*D-F;f._angle=0;f.box.geometry.rotate(v,B);f.transformFeature({rotation:v})}};var p=new Array(8);var l=new Array(4);var m,h,b;for(var e=0;e<8;++e){m=g.geometry.components[e];h=new OpenLayers.Feature.Vector(m.clone(),null,typeof this.renderIntent=="string"?null:this.renderIntent);if(e%2==0){b=new OpenLayers.Feature.Vector(m.clone(),null,typeof this.rotationHandleSymbolizer=="string"?null:this.rotationHandleSymbolizer);b.geometry.move=d;m._rotationHandle=b;l[e/2]=b}m.move=a;m.resize=q;m.rotate=o;h.geometry.move=j;m._handle=h;p[e]=h}this.box=g;this.rotationHandles=l;this.handles=p},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:true,moveFeature:function(b){if(this.feature===a.feature){this.feature=a.box}OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(d,b){if(d===a.box){a.transformFeature({center:a.center});a.drawHandles()}},onStart:function(f,d){var b=!a.geometryTypes||OpenLayers.Util.indexOf(a.geometryTypes,f.geometry.CLASS_NAME)!==-1;var e=OpenLayers.Util.indexOf(a.handles,f);e+=OpenLayers.Util.indexOf(a.rotationHandles,f);if(f!==a.feature&&f!==a.box&&e==-2&&b){a.setFeature(f)}},onComplete:function(d,b){a.events.triggerEvent("transformcomplete",{feature:a.feature})}})},drawHandles:function(){var b=this.layer;for(var a=0;a<8;++a){if(this.rotate&&a%2===0){b.drawFeature(this.rotationHandles[a/2],this.rotationHandleSymbolizer)}b.drawFeature(this.handles[a],this.renderIntent)}},transformFeature:function(f){if(!this._setfeature){this.scale*=(f.scale||1);this.ratio*=(f.ratio||1);var b=this.rotation;this.rotation=(this.rotation+(f.rotation||0))%360;if(this.events.triggerEvent("beforetransform",f)!==false){var e=this.feature;var d=e.geometry;var a=this.center;d.rotate(-b,a);if(f.scale||f.ratio){d.resize(f.scale,a,f.ratio)}else{if(f.center){e.move(f.center.getBounds().getCenterLonLat())}}d.rotate(this.rotation,a);this.layer.drawFeature(e);e.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",f)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){var b;for(var a=0;a<8;++a){b=this.box.geometry.components[a];b._handle.destroy();b._handle=null;b._rotationHandle&&b._rotationHandle.destroy();
b._rotationHandle=null}this.box.destroy();this.box=null;this.layer=null;this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry()},setBounds:function(a){if(a){this.bounds=a.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(b){var a=this.getBounds();if(!a){this.setBounds(b)}else{this.bounds.extend(b)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(b,a){},getVertices:function(a){},atPoint:function(f,j,g){var d=false;var e=this.getBounds();if((e!=null)&&(f!=null)){var b=(j!=null)?j:0;var a=(g!=null)?g:0;var h=new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-a,this.bounds.right+b,this.bounds.top+a);d=h.containsLonLat(f)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(g){var h=arguments.callee.format;if(!h){h=new OpenLayers.Format.WKT();arguments.callee.format=h}var e;var b=h.read(g);if(b instanceof OpenLayers.Feature.Vector){e=b.geometry}else{if(OpenLayers.Util.isArray(b)){var a=b.length;var f=new Array(a);for(var d=0;d<a;++d){f[d]=b[d].geometry}e=new OpenLayers.Geometry.Collection(f)}}return e};OpenLayers.Geometry.segmentsIntersect=function(a,N,b){var z=b&&b.point;var F=b&&b.tolerance;var g=false;var H=a.x1-N.x1;var L=a.y1-N.y1;var u=a.x2-a.x1;var E=a.y2-a.y1;var B=N.y2-N.y1;var o=N.x2-N.x1;var J=(B*u)-(o*E);var f=(o*L)-(B*H);var e=(u*L)-(E*H);if(J==0){if(f==0&&e==0){g=true}}else{var K=f/J;var I=e/J;if(K>=0&&K<=1&&I>=0&&I<=1){if(!z){g=true}else{var l=a.x1+(K*u);var h=a.y1+(K*E);g=new OpenLayers.Geometry.Point(l,h)}}}if(F){var w;if(g){if(z){var r=[a,N];var G,l,h;outer:for(var D=0;D<2;++D){G=r[D];for(var C=1;C<3;++C){l=G["x"+C];h=G["y"+C];w=Math.sqrt(Math.pow(l-g.x,2)+Math.pow(h-g.y,2));if(w<F){g.x=l;g.y=h;break outer}}}}}else{var r=[a,N];var v,M,l,h,q,m;outer:for(var D=0;D<2;++D){v=r[D];M=r[(D+1)%2];for(var C=1;C<3;++C){q={x:v["x"+C],y:v["y"+C]};m=OpenLayers.Geometry.distanceToSegment(q,M);if(m.distance<F){if(z){g=new OpenLayers.Geometry.Point(q.x,q.y)}else{g=true}break outer}}}}}return g};OpenLayers.Geometry.distanceToSegment=function(o,e){var d=o.x;var m=o.y;var b=e.x1;var l=e.y1;var a=e.x2;var g=e.y2;var q=a-b;var p=g-l;var j=((q*(d-b))+(p*(m-l)))/(Math.pow(q,2)+Math.pow(p,2));var h,f;if(j<=0){h=b;f=l}else{if(j>=1){h=a;f=g}else{h=b+j*q;f=l+j*p}}return{distance:Math.sqrt(Math.pow(h-d,2)+Math.pow(f-m,2)),x:h,y:f}};OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(b,e,d,a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=b;this.y=e;this.width=d;this.height=a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var a=(2*this.width)+(2*this.height);return a},getArea:function(){var a=this.width*this.height;return a},CLASS_NAME:"OpenLayers.Geometry.Rectangle"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a)}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(geometry,this);return geometry
},getComponentsString:function(){var b=[];for(var d=0,a=this.components.length;d<a;d++){b.push(this.components[d].toShortString())}return b.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds();var d=this.components;if(d){for(var b=0,a=d.length;b<a;b++){e.extend(d[b].getBounds())}}if(e.left!=null&&e.bottom!=null&&e.right!=null&&e.top!=null){this.setBounds(e)}},addComponents:function(d){if(!(OpenLayers.Util.isArray(d))){d=[d]}for(var b=0,a=d.length;b<a;b++){this.addComponent(d[b])}},addComponent:function(b,a){var e=false;if(b){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,b.CLASS_NAME)>-1)){if(a!=null&&(a<this.components.length)){var f=this.components.slice(0,a);var d=this.components.slice(a,this.components.length);f.push(b);this.components=f.concat(d)}else{this.components.push(b)}b.parent=this;this.clearBounds();e=true}}return e},removeComponents:function(b){var d=false;if(!(OpenLayers.Util.isArray(b))){b=[b]}for(var a=b.length-1;a>=0;--a){d=this.removeComponent(b[a])||d}return d},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds();return true},getLength:function(){var d=0;for(var b=0,a=this.components.length;b<a;b++){d+=this.components[b].getLength()}return d},getArea:function(){var d=0;for(var b=0,a=this.components.length;b<a;b++){d+=this.components[b].getArea()}return d},getGeodesicArea:function(b){var e=0;for(var d=0,a=this.components.length;d<a;d++){e+=this.components[d].getGeodesicArea(b)}return e},getCentroid:function(h){if(!h){return this.components.length&&this.components[0].getCentroid()}var o=this.components.length;if(!o){return false}var b=[];var d=[];var e=0;var j=Number.MAX_VALUE;var p;for(var m=0;m<o;++m){p=this.components[m];var f=p.getArea();var g=p.getCentroid(true);if(isNaN(f)||isNaN(g.x)||isNaN(g.y)){continue}b.push(f);e+=f;j=(f<j&&f>0)?f:j;d.push(g)}o=b.length;if(e===0){for(var m=0;m<o;++m){b[m]=1}e=b.length}else{for(var m=0;m<o;++m){b[m]/=j}e/=j}var l=0,a=0,g,f;for(var m=0;m<o;++m){g=d[m];f=b[m];l+=g.x*f;a+=g.y*f}return new OpenLayers.Geometry.Point(l/e,a/e)},getGeodesicLength:function(b){var e=0;for(var d=0,a=this.components.length;d<a;d++){e+=this.components[d].getGeodesicLength(b)}return e},move:function(b,e){for(var d=0,a=this.components.length;d<a;d++){this.components[d].move(b,e)}},rotate:function(e,b){for(var d=0,a=this.components.length;d<a;++d){this.components[d].rotate(e,b)}},resize:function(e,a,d){for(var b=0;b<this.components.length;++b){this.components[b].resize(e,a,d)}return this},distanceTo:function(j,l){var d=!(l&&l.edge===false);var a=d&&l&&l.details;var m,e,b;var f=Number.POSITIVE_INFINITY;for(var g=0,h=this.components.length;g<h;++g){m=this.components[g].distanceTo(j,l);b=a?m.distance:m;if(b<f){f=b;e=m;if(f==0){break}}}return e},equals:function(e){var b=true;if(!e||!e.CLASS_NAME||(this.CLASS_NAME!=e.CLASS_NAME)){b=false}else{if(!(OpenLayers.Util.isArray(e.components))||(e.components.length!=this.components.length)){b=false}else{for(var d=0,a=this.components.length;d<a;++d){if(!this.components[d].equals(e.components[d])){b=false;break}}}}return b},transform:function(f,d){if(f&&d){for(var e=0,a=this.components.length;e<a;e++){var b=this.components[e];b.transform(f,d)}this.bounds=null}return this},intersects:function(e){var b=false;for(var d=0,a=this.components.length;d<a;++d){b=e.intersects(this.components[d]);if(b){break}}return b},getVertices:function(b){var d=[];for(var e=0,a=this.components.length;e<a;++e){Array.prototype.push.apply(d,this.components[e].getVertices(b))}return d},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(g,m){var e=!(m&&m.edge===false);
var a=e&&m&&m.details;var b,f,j,d,h,l;if(g instanceof OpenLayers.Geometry.Point){f=this.x;j=this.y;d=g.x;h=g.y;b=Math.sqrt(Math.pow(f-d,2)+Math.pow(j-h,2));l=!a?b:{x0:f,y0:j,x1:d,y1:h,distance:b}}else{l=g.distanceTo(this,m);if(a){l={x0:l.x1,y0:l.y1,x1:l.x0,y1:l.y0,distance:l.distance}}}return l},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)))}return b},toShortString:function(){return(this.x+", "+this.y)},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds()},rotate:function(e,b){e*=Math.PI/180;var a=this.distanceTo(b);var d=e+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+(a*Math.cos(d));this.y=b.y+(a*Math.sin(d));this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(d,a,b){b=(b==undefined)?1:b;this.x=a.x+(d*b*(this.x-a.x));this.y=a.y+(d*(this.y-a.y));this.clearBounds();return this},intersects:function(b){var a=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.equals(b)}else{a=b.intersects(this)}return a},transform:function(b,a){if((b&&a)){OpenLayers.Projection.transform(this,b,a);this.bounds=null}return this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var d=0;if(this.components&&(this.components.length>1)){for(var b=1,a=this.components.length;b<a;b++){d+=this.components[b-1].distanceTo(this.components[b])}}return d},getGeodesicLength:function(b){var f=this;if(b){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(b)){f=this.clone().transform(b,d)}}var g=0;if(f.components&&(f.components.length>1)){var j,h;for(var e=1,a=f.components.length;e<a;e++){j=f.components[e-1];h=f.components[e];g+=OpenLayers.Util.distVincenty({lon:j.x,lat:j.y},{lon:h.x,lat:h.y})}}return g*1000},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(a){var b=this.components&&(this.components.length>2);if(b){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}return b},intersects:function(p){var d=false;var o=p.CLASS_NAME;if(o=="OpenLayers.Geometry.LineString"||o=="OpenLayers.Geometry.LinearRing"||o=="OpenLayers.Geometry.Point"){var u=this.getSortedSegments();var q;if(o=="OpenLayers.Geometry.Point"){q=[{x1:p.x,y1:p.y,x2:p.x,y2:p.y}]}else{q=p.getSortedSegments()}var z,h,f,a,w,v,e,b;outer:for(var l=0,m=u.length;l<m;++l){z=u[l];h=z.x1;f=z.x2;a=z.y1;w=z.y2;inner:for(var g=0,r=q.length;g<r;++g){v=q[g];if(v.x1>f){break}if(v.x2<h){continue}e=v.y1;b=v.y2;if(Math.min(e,b)>Math.max(a,w)){continue}if(Math.max(e,b)<Math.min(a,w)){continue}if(OpenLayers.Geometry.segmentsIntersect(z,v)){d=true;break outer}}}}else{d=p.intersects(this)}return d},getSortedSegments:function(){var a=this.components.length-1;var b=new Array(a),f,e;for(var d=0;d<a;++d){f=this.components[d];e=this.components[d+1];if(f.x<e.x){b[d]={x1:f.x,y1:f.y,x2:e.x,y2:e.y}}else{b[d]={x1:e.x,y1:e.y,x2:f.x,y2:f.y}}}function g(j,h){return j.x1-h.x1}return b.sort(g)},splitWithSegment:function(w,b){var d=!(b&&b.edge===false);var r=b&&b.tolerance;var a=[];var B=this.getVertices();var q=[];var D=[];var j=false;var f,e,o;var l,v,C;var g={point:true,tolerance:r};var h=null;for(var p=0,m=B.length-2;p<=m;++p){f=B[p];q.push(f.clone());e=B[p+1];C={x1:f.x,y1:f.y,x2:e.x,y2:e.y};o=OpenLayers.Geometry.segmentsIntersect(w,C,g);
if(o instanceof OpenLayers.Geometry.Point){if((o.x===w.x1&&o.y===w.y1)||(o.x===w.x2&&o.y===w.y2)||o.equals(f)||o.equals(e)){v=true}else{v=false}if(v||d){if(!o.equals(D[D.length-1])){D.push(o.clone())}if(p===0){if(o.equals(f)){continue}}if(o.equals(e)){continue}j=true;if(!o.equals(f)){q.push(o)}a.push(new OpenLayers.Geometry.LineString(q));q=[o.clone()]}}}if(j){q.push(e.clone());a.push(new OpenLayers.Geometry.LineString(q))}if(D.length>0){var u=w.x1<w.x2?1:-1;var z=w.y1<w.y2?1:-1;h={lines:a,points:D.sort(function(F,E){return(u*F.x-u*E.x)||(z*F.y-z*E.y)})}}return h},split:function(E,b){var p=null;var e=b&&b.mutual;var m,f,o,d;if(E instanceof OpenLayers.Geometry.LineString){var D=this.getVertices();var h,g,C,l,a,r;var w=[];o=[];for(var z=0,q=D.length-2;z<=q;++z){h=D[z];g=D[z+1];C={x1:h.x,y1:h.y,x2:g.x,y2:g.y};d=d||[E];if(e){w.push(h.clone())}for(var v=0;v<d.length;++v){l=d[v].splitWithSegment(C,b);if(l){a=l.lines;if(a.length>0){a.unshift(v,1);Array.prototype.splice.apply(d,a);v+=a.length-2}if(e){for(var u=0,B=l.points.length;u<B;++u){r=l.points[u];if(!r.equals(h)){w.push(r);o.push(new OpenLayers.Geometry.LineString(w));if(r.equals(g)){w=[]}else{w=[r.clone()]}}}}}}}if(e&&o.length>0&&w.length>0){w.push(g.clone());o.push(new OpenLayers.Geometry.LineString(w))}}else{p=E.splitWith(this,b)}if(d&&d.length>1){f=true}else{d=[]}if(o&&o.length>1){m=true}else{o=[]}if(f||m){if(e){p=[o,d]}else{p=d}}return p},splitWith:function(b,a){return b.split(this,a)},getVertices:function(a){var b;if(a===true){b=[this.components[0],this.components[this.components.length-1]]}else{if(a===false){b=this.components.slice(1,this.components.length-1)}else{b=this.components.slice()}}return b},distanceTo:function(l,h){var m=!(h&&h.edge===false);var H=m&&h&&h.details;var v,f={};var B=Number.POSITIVE_INFINITY;if(l instanceof OpenLayers.Geometry.Point){var w=this.getSortedSegments();var u=l.x;var r=l.y;var F;for(var D=0,E=w.length;D<E;++D){F=w[D];v=OpenLayers.Geometry.distanceToSegment(l,F);if(v.distance<B){B=v.distance;f=v;if(B===0){break}}else{if(F.x2>u&&((r>F.y1&&r<F.y2)||(r<F.y1&&r>F.y2))){break}}}if(H){f={distance:f.distance,x0:f.x,y0:f.y,x1:u,y1:r}}else{f=f.distance}}else{if(l instanceof OpenLayers.Geometry.LineString){var e=this.getSortedSegments();var d=l.getSortedSegments();var b,a,q,G,g;var p=d.length;var o={point:true};outer:for(var D=0,E=e.length;D<E;++D){b=e[D];G=b.x1;g=b.y1;for(var C=0;C<p;++C){a=d[C];q=OpenLayers.Geometry.segmentsIntersect(b,a,o);if(q){B=0;f={distance:0,x0:q.x,y0:q.y,x1:q.x,y1:q.y};break outer}else{v=OpenLayers.Geometry.distanceToSegment({x:G,y:g},a);if(v.distance<B){B=v.distance;f={distance:B,x0:G,y0:g,x1:v.x,y1:v.y}}}}}if(!H){f=f.distance}if(B!==0){if(b){v=l.distanceTo(new OpenLayers.Geometry.Point(b.x2,b.y2),h);var z=H?v.distance:v;if(z<B){if(H){f={distance:B,x0:v.x1,y0:v.y1,x1:v.x0,y1:v.y0}}else{f=z}}}}}else{f=l.distanceTo(this,h);if(H){f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0}}}}return f},simplify:function(j){if(this&&this!==null){var m=this.getVertices();if(m.length<3){return this}var e=function(p,o){return(p-o)};var d=function(r,w,u,o){var v=0;var q=0;for(var p=w,z;p<u;p++){z=b(r[w],r[u],r[p]);if(z>v){v=z;q=p}}if(v>o&&q!=w){f.push(q);d(r,w,q,o);d(r,q,u,o)}};var b=function(u,r,p){var v=Math.abs(0.5*(u.x*r.y+r.x*p.y+p.x*u.y-r.x*u.y-p.x*r.y-u.x*p.y));var q=Math.sqrt(Math.pow(u.x-r.x,2)+Math.pow(u.y-r.y,2));var o=v/q*2;return o};var g=0;var l=m.length-1;var f=[];f.push(g);f.push(l);while(m[g].equals(m[l])){l--;f.push(l)}d(m,g,l,j);var a=[];f.sort(e);for(var h=0;h<f.length;h++){a.push(m[f[h]])}return new OpenLayers.Geometry.LineString(a)}else{return this}},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(a,b){var d=false;var e=this.components.pop();if(b!=null||!a.equals(e)){d=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var f=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[f]);
return d},removeComponent:function(a){var b=this.components&&(this.components.length>3);if(b){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var d=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[d])}return b},move:function(b,e){for(var d=0,a=this.components.length;d<a-1;d++){this.components[d].move(b,e)}},rotate:function(e,b){for(var d=0,a=this.components.length;d<a-1;++d){this.components[d].rotate(e,b)}},resize:function(f,b,e){for(var d=0,a=this.components.length;d<a-1;++d){this.components[d].resize(f,b,e)}return this},transform:function(f,d){if(f&&d){for(var e=0,a=this.components.length;e<a-1;e++){var b=this.components[e];b.transform(f,d)}this.bounds=null}return this},getCentroid:function(){if(this.components&&(this.components.length>2)){var h=0;var g=0;for(var e=0;e<this.components.length-1;e++){var d=this.components[e];var l=this.components[e+1];h+=(d.x+l.x)*(d.x*l.y-l.x*d.y);g+=(d.y+l.y)*(d.x*l.y-l.x*d.y)}var f=-1*this.getArea();var a=h/(6*f);var j=g/(6*f);return new OpenLayers.Geometry.Point(a,j)}else{return null}},getArea:function(){var g=0;if(this.components&&(this.components.length>2)){var f=0;for(var e=0,d=this.components.length;e<d-1;e++){var a=this.components[e];var h=this.components[e+1];f+=(a.x+h.x)*(h.y-a.y)}g=-f/2}return g},getGeodesicArea:function(b){var e=this;if(b){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(b)){e=this.clone().transform(b,d)}}var g=0;var a=e.components&&e.components.length;if(a>2){var j,h;for(var f=0;f<a-1;f++){j=e.components[f];h=e.components[f+1];g+=OpenLayers.Util.rad(h.x-j.x)*(2+Math.sin(OpenLayers.Util.rad(j.y))+Math.sin(OpenLayers.Util.rad(h.y)))}g=g*6378137*6378137/2}return g},containsPoint:function(p){var z=OpenLayers.Number.limitSigDigs;var o=14;var m=z(p.x,o);var l=z(p.y,o);function w(F,C,E,B,D){return(((C-B)*F)+((B*E)-(C*D)))/(E-D)}var a=this.components.length-1;var h,g,v,e,r,b,f,d;var j=0;for(var q=0;q<a;++q){h=this.components[q];v=z(h.x,o);e=z(h.y,o);g=this.components[q+1];r=z(g.x,o);b=z(g.y,o);if(e==b){if(l==e){if(v<=r&&(m>=v&&m<=r)||v>=r&&(m<=v&&m>=r)){j=-1;break}}continue}f=z(w(l,v,e,r,b),o);if(f==m){if(e<b&&(l>=e&&l<=b)||e>b&&(l<=e&&l>=b)){j=-1;break}}if(f<=m){continue}if(v!=r&&(f<Math.min(v,r)||f>Math.max(v,r))){continue}if(e<b&&(l>=e&&l<b)||e>b&&(l<e&&l>=b)){++j}}var u=(j==-1)?1:!!(j&1);return u},intersects:function(e){var b=false;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(e)}else{if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=e.intersects(this)}else{if(e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e])}else{for(var d=0,a=e.components.length;d<a;++d){b=e.components[d].intersects(this);if(b){break}}}}}return b},getVertices:function(a){return(a===true)?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var d=0;if(this.components&&(this.components.length>0)){d+=Math.abs(this.components[0].getArea());for(var b=1,a=this.components.length;b<a;b++){d-=Math.abs(this.components[b].getArea())}}return d},getGeodesicArea:function(b){var e=0;if(this.components&&(this.components.length>0)){e+=Math.abs(this.components[0].getGeodesicArea(b));for(var d=1,a=this.components.length;d<a;d++){e-=Math.abs(this.components[d].getGeodesicArea(b))}}return e},containsPoint:function(a){var f=this.components.length;var d=false;if(f>0){d=this.components[0].containsPoint(a);if(d!==1){if(d&&f>1){var e;for(var b=1;b<f;++b){e=this.components[b].containsPoint(a);if(e){if(e===1){d=1}else{d=false}break}}}}}return d},intersects:function(f){var b=false;var e,a;if(f.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(f)}else{if(f.CLASS_NAME=="OpenLayers.Geometry.LineString"||f.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(e=0,a=this.components.length;
e<a;++e){b=f.intersects(this.components[e]);if(b){break}}if(!b){for(e=0,a=f.components.length;e<a;++e){b=this.containsPoint(f.components[e]);if(b){break}}}}else{for(e=0,a=f.components.length;e<a;++e){b=this.intersects(f.components[e]);if(b){break}}}}if(!b&&f.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var d=this.components[0];for(e=0,a=d.components.length;e<a;++e){b=f.containsPoint(d.components[e]);if(b){break}}}return b},distanceTo:function(e,b){var d=!(b&&b.edge===false);var a;if(!d&&this.intersects(e)){a=0}else{a=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,b])}return a},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(l,g,b,o){var d=Math.PI*((1/b)-(1/2));if(o){d+=(o/180)*Math.PI}var a,j,h;var m=[];for(var f=0;f<b;++f){a=d+(f*2*Math.PI/b);j=l.x+(g*Math.cos(a));h=l.y+(g*Math.sin(a));m.push(new OpenLayers.Geometry.Point(j,h))}var e=new OpenLayers.Geometry.LinearRing(m);return new OpenLayers.Geometry.Polygon([e])};OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},split:function(p,w){var h=null;var v=w&&w.mutual;var q,a,u,o,b;var f=[];var r=[p];for(var g=0,l=this.components.length;g<l;++g){a=this.components[g];o=false;for(var e=0;e<r.length;++e){q=a.split(r[e],w);if(q){if(v){u=q[0];for(var d=0,m=u.length;d<m;++d){if(d===0&&f.length){f[f.length-1].addComponent(u[d])}else{f.push(new OpenLayers.Geometry.MultiLineString([u[d]]))}}o=true;q=q[1]}if(q.length){q.unshift(e,1);Array.prototype.splice.apply(r,q);break}}}if(!o){if(f.length){f[f.length-1].addComponent(a.clone())}else{f=[new OpenLayers.Geometry.MultiLineString(a.clone())]}}}if(f&&f.length>1){o=true}else{f=[]}if(r&&r.length>1){b=true}else{r=[]}if(o||b){if(v){h=[f,r]}else{h=r}}return h},splitWith:function(p,w){var h=null;var v=w&&w.mutual;var q,d,u,o,a,f,r;if(p instanceof OpenLayers.Geometry.LineString){r=[];f=[p];for(var g=0,l=this.components.length;g<l;++g){a=false;d=this.components[g];for(var e=0;e<f.length;++e){q=f[e].split(d,w);if(q){if(v){u=q[0];if(u.length){u.unshift(e,1);Array.prototype.splice.apply(f,u);e+=u.length-2}q=q[1];if(q.length===0){q=[d.clone()]}}for(var b=0,m=q.length;b<m;++b){if(b===0&&r.length){r[r.length-1].addComponent(q[b])}else{r.push(new OpenLayers.Geometry.MultiLineString([q[b]]))}}a=true}}if(!a){if(r.length){r[r.length-1].addComponent(d.clone())}else{r=[new OpenLayers.Geometry.MultiLineString([d.clone()])]}}}}else{h=p.split(this)}if(f&&f.length>1){o=true}else{f=[]}if(r&&r.length>1){a=true}else{r=[]}if(o||a){if(v){h=[f,r]}else{h=r}}return h},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Geometry.Surface=OpenLayers.Class(OpenLayers.Geometry,{initialize:function(){OpenLayers.Geometry.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.Surface"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a);OpenLayers.Util.extend(this,b)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null}},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(d,f){if(f==null){f=d.style}if(d.geometry){var g=d.geometry.getBounds();if(g){if(!g.intersectsBounds(this.extent)){f={display:"none"}}var j=this.drawGeometry(d.geometry,f,d.id);if(f.display!="none"&&f.label&&j!==false){var a=d.geometry.getCentroid();
if(f.labelXOffset||f.labelYOffset){var e=isNaN(f.labelXOffset)?0:f.labelXOffset;var h=isNaN(f.labelYOffset)?0:f.labelYOffset;var b=this.getResolution();a.move(e*b,h*b)}this.drawText(d.id,f,a)}else{this.removeText(d.id)}return j}}},drawGeometry:function(d,a,b){},drawText:function(d,b,a){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(e){if(!(OpenLayers.Util.isArray(e))){e=[e]}for(var d=0,a=e.length;d<a;++d){var b=e[d];this.eraseGeometry(b.geometry,b.id);this.removeText(b.id)}},eraseGeometry:function(b,a){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(b){var a=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(b.stroke===false){delete a.strokeWidth;delete a.strokeColor}if(b.fill===false){delete a.fillColor}OpenLayers.Util.extend(a,b);return a},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(d){if(this.exists(d)){this.remove(d)}var g=d.id;this.determineZIndex(d);var e=-1;var f=this.order.length;var a;while(f-e>1){a=parseInt((e+f)/2);var b=this.compare(this,d,OpenLayers.Util.getElement(this.order[a]));if(b>0){e=a}else{f=a}}this.order.splice(f,0,g);this.indices[g]=this.getZIndex(d);return this.getNextElement(f)},remove:function(b){var e=b.id;var a=OpenLayers.Util.indexOf(this.order,e);if(a>=0){this.order.splice(a,1);delete this.indices[e];if(this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return(this.indices[a.id]!=null)},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b}else{if(b>this.maxZIndex){this.maxZIndex=b}}},getNextElement:function(b){var a=b+1;if(a<this.order.length){var d=OpenLayers.Util.getElement(this.order[a]);if(d==undefined){d=this.getNextElement(a)}return d}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(f,e,b){var a=f.getZIndex(e);var g=0;if(b){var d=f.getZIndex(b);g=a-d}return g},Z_ORDER_DRAWING_ORDER:function(d,b,a){var e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,b,a);if(a&&e==0){e=1}return e},Z_ORDER_Y_ORDER:function(e,d,b){var f=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,b);if(b&&f===0){var a=b._boundsBottom-d._boundsBottom;f=(a===0)?1:a}return f}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var b;var a=this.vectorRoot;if(a){while(b=a.firstChild){a.removeChild(b)}}a=this.textRoot;if(a){while(b=a.firstChild){a.removeChild(b)}}if(this.indexer){this.indexer.clear()}},getNodeType:function(b,a){},drawGeometry:function(l,a,e){var j=l.CLASS_NAME;var d=true;if((j=="OpenLayers.Geometry.Collection")||(j=="OpenLayers.Geometry.MultiPoint")||(j=="OpenLayers.Geometry.MultiLineString")||(j=="OpenLayers.Geometry.MultiPolygon")){for(var g=0,h=l.components.length;
g<h;g++){d=this.drawGeometry(l.components[g],a,e)&&d}return d}d=false;var f=false;if(a.display!="none"){if(a.backgroundGraphic){this.redrawBackgroundNode(l.id,l,a,e)}else{f=true}d=this.redrawNode(l.id,l,a,e)}if(d==false){var b=document.getElementById(l.id);if(b){if(b._style.backgroundGraphic){f=true}b.parentNode.removeChild(b)}}if(f){var b=document.getElementById(l.id+this.BACKGROUND_ID_SUFFIX);if(b){b.parentNode.removeChild(b)}}return d},redrawNode:function(h,g,b,f){b=this.applyDefaultSymbolizer(b);var d=this.nodeFactory(h,this.getNodeType(g,b));d._featureId=f;d._boundsBottom=g.getBounds().bottom;d._geometryClass=g.CLASS_NAME;d._style=b;var a=this.drawGeometryNode(d,g,b);if(a===false){return false}d=a.node;if(this.indexer){var e=this.indexer.insert(d);if(e){this.vectorRoot.insertBefore(d,e)}else{this.vectorRoot.appendChild(d)}}else{if(d.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(d)}}this.postDraw(d);return a.complete},redrawBackgroundNode:function(f,e,b,d){var a=OpenLayers.Util.extend({},b);a.externalGraphic=a.backgroundGraphic;a.graphicXOffset=a.backgroundXOffset;a.graphicYOffset=a.backgroundYOffset;a.graphicZIndex=a.backgroundGraphicZIndex;a.graphicWidth=a.backgroundWidth||a.graphicWidth;a.graphicHeight=a.backgroundHeight||a.graphicHeight;a.backgroundGraphic=null;a.backgroundXOffset=null;a.backgroundYOffset=null;a.backgroundGraphicZIndex=null;return this.redrawNode(f+this.BACKGROUND_ID_SUFFIX,e,a,null)},drawGeometryNode:function(d,f,b){b=b||d._style;var a={isFilled:b.fill===undefined?true:b.fill,isStroked:b.stroke===undefined?!!b.strokeWidth:b.stroke};var e;switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.graphic===false){a.isFilled=false;a.isStroked=false}e=this.drawPoint(d,f);break;case"OpenLayers.Geometry.LineString":a.isFilled=false;e=this.drawLineString(d,f);break;case"OpenLayers.Geometry.LinearRing":e=this.drawLinearRing(d,f);break;case"OpenLayers.Geometry.Polygon":e=this.drawPolygon(d,f);break;case"OpenLayers.Geometry.Surface":e=this.drawSurface(d,f);break;case"OpenLayers.Geometry.Rectangle":e=this.drawRectangle(d,f);break;default:break}d._options=a;if(e!=false){return{node:this.setStyle(d,b,a,f),complete:e}}else{return false}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},removeText:function(b){var a=document.getElementById(b+this.LABEL_ID_SUFFIX);if(a){this.textRoot.removeChild(a)}},getFeatureIdFromEvent:function(a){var e=a.target;var b=e&&e.correspondingUseElement;var d=b?b:(e||a.srcElement);var f=d._featureId;return f},eraseGeometry:function(h,g){if((h.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(h.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(h.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(h.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var e=0,a=h.components.length;e<a;e++){this.eraseGeometry(h.components[e],g)}}else{var d=OpenLayers.Util.getElement(h.id);if(d&&d.parentNode){if(d.geometry){d.geometry.destroy();d.geometry=null}d.parentNode.removeChild(d);if(this.indexer){this.indexer.remove(d)}if(d._style.backgroundGraphic){var b=h.id+this.BACKGROUND_ID_SUFFIX;var f=OpenLayers.Util.getElement(b);if(f&&f.parentNode){f.parentNode.removeChild(f)}}}}},nodeFactory:function(d,a){var b=OpenLayers.Util.getElement(d);if(b){if(!this.nodeTypeCompare(b,a)){b.parentNode.removeChild(b);b=this.nodeFactory(d,a)}}else{b=this.createNode(a,d)}return b},nodeTypeCompare:function(b,a){},createNode:function(a,b){},moveRoot:function(b){var a=this.root;if(b.root.parentNode==this.rendererRoot){a=b.root}a.parentNode.removeChild(a);b.rendererRoot.appendChild(a)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return(a!="circle")&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};
OpenLayers.Renderer.NG=OpenLayers.Class(OpenLayers.Renderer.Elements,{labelNodeType:null,updateDimensions:function(b){var a=this.map.getExtent();var e=a.scale(3);this.setExtent(e,true);var d=this.getResolution();var h=this.rendererRoot.parentNode;var f=parseFloat(h.parentNode.style.left);var g=parseFloat(h.parentNode.style.top);h.style.left=((e.left-a.left)/d-f)+"px";h.style.top=((a.top-e.top)/d-g)+"px"},setSize:function(){this.map.getExtent()&&this.updateDimensions()},drawFeature:function(b,d){if(d==null){d=b.style}if(b.geometry){var e=this.drawGeometry(b.geometry,d,b.id);if(e!==false&&d.label){var a=b.geometry.getCentroid();this.drawText(b.id,d,a)}else{this.removeText(b.id)}return e}},drawText:function(h,f,a){var b;if(typeof h!=="string"){b=h}else{b=this.nodeFactory(h+this.LABEL_ID_SUFFIX,this.labelNodeType);b._featureId=h}b._style=f;b._x=a.x;b._y=a.y;if(f.labelXOffset||f.labelYOffset){var e=isNaN(f.labelXOffset)?0:f.labelXOffset;var g=isNaN(f.labelYOffset)?0:f.labelYOffset;var d=this.getResolution();a.move(e*d,g*d)}if(b.parentNode!==this.textRoot){this.textRoot.appendChild(b)}return b},CLASS_NAME:"OpenLayers.Renderer.NG"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")))},inValidRange:function(a,f,b){var e=a+(b?0:this.translationParameters.x);var d=f+(b?0:this.translationParameters.y);return(e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL)},setExtent:function(b,e){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var a=this.getResolution();var g=-b.left/a;var f=b.top/a;if(e){this.left=g;this.top=f;var d="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",d);this.translate(0,0);return true}else{var h=this.translate(g-this.left,f-this.top);if(!h){this.setExtent(b,true)}return h}},translate:function(a,d){if(!this.inValidRange(a,d,true)){return false}else{var b="";if(a||d){b="translate("+a+","+d+")"}this.root.setAttributeNS(null,"transform",b);this.translationParameters={x:a,y:d};return true}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(d,b){var a=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image"}else{if(this.isComplexSymbol(b.graphicName)){a="svg"}else{a="circle"}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="path";break;default:break}return a},setStyle:function(v,B,b){B=B||v._style;b=b||v._options;var o=parseFloat(v.getAttributeNS(null,"r"));var m=1;var e;if(v._geometryClass=="OpenLayers.Geometry.Point"&&o){v.style.visibility="";if(B.graphic===false){v.style.visibility="hidden"}else{if(B.externalGraphic){e=this.getPosition(v);if(B.graphicTitle){v.setAttributeNS(null,"title",B.graphicTitle);var g=this.nodeFactory(null,"title");g.textContent=B.graphicTitle;v.appendChild(g)}if(B.graphicWidth&&B.graphicHeight){v.setAttributeNS(null,"preserveAspectRatio","none")}var u=B.graphicWidth||B.graphicHeight;var q=B.graphicHeight||B.graphicWidth;u=u?u:B.pointRadius*2;q=q?q:B.pointRadius*2;var C=(B.graphicXOffset!=undefined)?B.graphicXOffset:-(0.5*u);var h=(B.graphicYOffset!=undefined)?B.graphicYOffset:-(0.5*q);var a=B.graphicOpacity||B.fillOpacity;
v.setAttributeNS(null,"x",(e.x+C).toFixed());v.setAttributeNS(null,"y",(e.y+h).toFixed());v.setAttributeNS(null,"width",u);v.setAttributeNS(null,"height",q);v.setAttributeNS(this.xlinkns,"href",B.externalGraphic);v.setAttributeNS(null,"style","opacity: "+a);v.onclick=OpenLayers.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(B.graphicName)){var d=B.pointRadius*3;var p=d*2;var f=this.importSymbol(B.graphicName);e=this.getPosition(v);m=this.symbolMetrics[f.id][0]*3/p;var j=v.parentNode;var l=v.nextSibling;if(j){j.removeChild(v)}v.firstChild&&v.removeChild(v.firstChild);v.appendChild(f.firstChild.cloneNode(true));v.setAttributeNS(null,"viewBox",f.getAttributeNS(null,"viewBox"));v.setAttributeNS(null,"width",p);v.setAttributeNS(null,"height",p);v.setAttributeNS(null,"x",e.x-d);v.setAttributeNS(null,"y",e.y-d);if(l){j.insertBefore(v,l)}else{if(j){j.appendChild(v)}}}else{v.setAttributeNS(null,"r",B.pointRadius)}}}var z=B.rotation;if((z!==undefined||v._rotation!==undefined)&&e){v._rotation=z;z|=0;if(v.nodeName!=="svg"){v.setAttributeNS(null,"transform","rotate("+z+" "+e.x+" "+e.y+")")}else{var w=this.symbolMetrics[f.id];v.firstChild.setAttributeNS(null,"transform","rotate("+z+" "+w[1]+" "+w[2]+")")}}}if(b.isFilled){v.setAttributeNS(null,"fill",B.fillColor);v.setAttributeNS(null,"fill-opacity",B.fillOpacity)}else{v.setAttributeNS(null,"fill","none")}if(b.isStroked){v.setAttributeNS(null,"stroke",B.strokeColor);v.setAttributeNS(null,"stroke-opacity",B.strokeOpacity);v.setAttributeNS(null,"stroke-width",B.strokeWidth*m);v.setAttributeNS(null,"stroke-linecap",B.strokeLinecap||"round");v.setAttributeNS(null,"stroke-linejoin","round");B.strokeDashstyle&&v.setAttributeNS(null,"stroke-dasharray",this.dashStyle(B,m))}else{v.setAttributeNS(null,"stroke","none")}if(B.pointerEvents){v.setAttributeNS(null,"pointer-events",B.pointerEvents)}if(B.cursor!=null){v.setAttributeNS(null,"cursor",B.cursor)}return v},dashStyle:function(d,b){var a=d.strokeWidth*b;var e=d.strokeDashstyle;switch(e){case"solid":return"none";case"dot":return[1,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,1,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,1,4*a].join();default:return OpenLayers.String.trim(e).replace(/\s+/g,",")}},createNode:function(a,d){var b=document.createElementNS(this.xmlns,a);if(d){b.setAttributeNS(null,"id",d)}return b},nodeTypeCompare:function(b,a){return(a==b.nodeName)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(e,f,b){var d=this.getResolution();var a=(f.x/d+this.left);var g=(this.top-f.y/d);if(this.inValidRange(a,g)){e.setAttributeNS(null,"cx",a);e.setAttributeNS(null,"cy",g);e.setAttributeNS(null,"r",b);return e}else{return false}},drawLineString:function(b,d){var a=this.getComponentsString(d.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawLinearRing:function(b,d){var a=this.getComponentsString(d.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawPolygon:function(b,l){var h="";var m=true;var a=true;var e,o;for(var f=0,g=l.components.length;f<g;f++){h+=" M";e=this.getComponentsString(l.components[f].components," ");o=e.path;if(o){h+=" "+o;a=e.complete&&a}else{m=false}}h+=" z";if(m){b.setAttributeNS(null,"d",h);b.setAttributeNS(null,"fill-rule","evenodd");return a?b:null}else{return false}},drawRectangle:function(d,e){var b=this.getResolution();var a=(e.x/b+this.left);var f=(this.top-e.y/b);if(this.inValidRange(a,f)){d.setAttributeNS(null,"x",a);d.setAttributeNS(null,"y",f);d.setAttributeNS(null,"width",e.width/b);d.setAttributeNS(null,"height",e.height/b);return d}else{return false}},drawSurface:function(g,j){var h=null;var b=true;for(var f=0,a=j.components.length;
f<a;f++){if((f%3)==0&&(f/3)==0){var e=this.getShortString(j.components[f]);if(!e){b=false}h="M "+e}else{if((f%3)==1){var e=this.getShortString(j.components[f]);if(!e){b=false}h+=" C "+e}else{var e=this.getShortString(j.components[f]);if(!e){b=false}h+=" "+e}}}h+=" Z";if(b){g.setAttributeNS(null,"d",h);return g}else{return false}},drawText:function(f,a,q){var b=this.getResolution();var p=(q.x/b+this.left);var l=(q.y/b-this.top);var o=this.nodeFactory(f+this.LABEL_ID_SUFFIX,"text");o.setAttributeNS(null,"x",p);o.setAttributeNS(null,"y",-l);if(a.fontColor){o.setAttributeNS(null,"fill",a.fontColor)}if(a.fontOpacity){o.setAttributeNS(null,"opacity",a.fontOpacity)}if(a.fontFamily){o.setAttributeNS(null,"font-family",a.fontFamily)}if(a.fontSize){o.setAttributeNS(null,"font-size",a.fontSize)}if(a.fontWeight){o.setAttributeNS(null,"font-weight",a.fontWeight)}if(a.fontStyle){o.setAttributeNS(null,"font-style",a.fontStyle)}if(a.labelSelect===true){o.setAttributeNS(null,"pointer-events","visible");o._featureId=f}else{o.setAttributeNS(null,"pointer-events","none")}var h=a.labelAlign||"cm";o.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[0]]||"middle");if(OpenLayers.IS_GECKO===true){o.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[1]]||"central")}var d=a.label.split("\n");var g=d.length;while(o.childNodes.length>g){o.removeChild(o.lastChild)}for(var e=0;e<g;e++){var j=this.nodeFactory(f+this.LABEL_ID_SUFFIX+"_tspan_"+e,"tspan");if(a.labelSelect===true){j._featureId=f;j._geometry=q;j._geometryClass=q.CLASS_NAME}if(OpenLayers.IS_GECKO===false){j.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[h[1]]||"-35%")}j.setAttribute("x",p);if(e==0){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[h[1]];if(m==null){m=-0.5}j.setAttribute("dy",(m*(g-1))+"em")}else{j.setAttribute("dy","1em")}j.textContent=(d[e]==="")?" ":d[e];if(!j.parentNode){o.appendChild(j)}}if(!o.parentNode){this.textRoot.appendChild(o)}},getComponentsString:function(e,d){var g=[];var a=true;var f=e.length;var l=[];var h,j;for(var b=0;b<f;b++){j=e[b];g.push(j);h=this.getShortString(j);if(h){l.push(h)}else{if(b>0){if(this.getShortString(e[b-1])){l.push(this.clipLine(e[b],e[b-1]))}}if(b<f-1){if(this.getShortString(e[b+1])){l.push(this.clipLine(e[b],e[b+1]))}}a=false}}return{path:l.join(d||","),complete:a}},clipLine:function(f,j){if(j.equals(f)){return""}var g=this.getResolution();var b=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var e=j.x/g+this.left;var m=this.top-j.y/g;var d=f.x/g+this.left;var l=this.top-f.y/g;var h;if(d<-b||d>b){h=(l-m)/(d-e);d=d<0?-b:b;l=m+(d-e)*h}if(l<-a||l>a){h=(d-e)/(l-m);l=l<0?-a:a;d=e+(l-m)*h}return d+","+l},getShortString:function(b){var d=this.getResolution();var a=(b.x/d+this.left);var e=(this.top-b.y/d);if(this.inValidRange(a,e)){return a+","+e}else{return false}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))})},importSymbol:function(g){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+g;var d=document.getElementById(b);if(d!=null){return d}var f=OpenLayers.Renderer.symbol[g];if(!f){throw new Error(g+" is not a valid symbol name")}var j=this.nodeFactory(b,"symbol");var e=this.nodeFactory(null,"polygon");j.appendChild(e);var q=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var o=[];var m,l;for(var h=0;h<f.length;h=h+2){m=f[h];l=f[h+1];q.left=Math.min(q.left,m);q.bottom=Math.min(q.bottom,l);q.right=Math.max(q.right,m);q.top=Math.max(q.top,l);o.push(m,",",l)}e.setAttributeNS(null,"points",o.join(" "));var a=q.getWidth();var p=q.getHeight();var r=[q.left-a,q.bottom-p,a*3,p*3];j.setAttributeNS(null,"viewBox",r.join(" "));this.symbolMetrics[b]=[Math.max(a,p),q.getCenterLonLat().lon,q.getCenterLonLat().lat];this.defs.appendChild(j);return j},getFeatureIdFromEvent:function(a){var d=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!d){var b=a.target;d=b.parentNode&&b!=this.rendererRoot&&b.parentNode._featureId
}return d},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(a){a.preventDefault&&a.preventDefault()};OpenLayers.Renderer.SVG2=OpenLayers.Class(OpenLayers.Renderer.NG,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",symbolMetrics:null,labelNodeType:"g",initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.symbolMetrics={}},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")))},updateDimensions:function(a){OpenLayers.Renderer.NG.prototype.updateDimensions.apply(this,arguments);var j=this.getResolution();var d=this.extent.getWidth();var m=this.extent.getHeight();var e=[this.extent.left,-this.extent.top,d,m].join(" ");this.rendererRoot.setAttributeNS(null,"viewBox",e);this.rendererRoot.setAttributeNS(null,"width",d/j);this.rendererRoot.setAttributeNS(null,"height",m/j);if(a===true){var f,g;var b=this.vectorRoot.childNodes;for(f=0,g=b.length;f<g;++f){this.setStyle(b[f])}var h=this.textRoot.childNodes;var l;for(f=0,g=h.length;f<g;++f){l=h[f];this.drawText(l,l._style,new OpenLayers.Geometry.Point(l._x,l._y))}}},getNodeType:function(d,b){var a=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image"}else{if(this.isComplexSymbol(b.graphicName)){a="svg"}else{a="circle"}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="path";break;default:break}return a},setStyle:function(u,B,b){B=B||u._style;b=b||u._options;var z=this.getResolution();var m=u._radius;var l=z;if(u._geometryClass=="OpenLayers.Geometry.Point"&&m){u.style.visibility="";if(B.graphic===false){u.style.visibility="hidden"}else{if(B.externalGraphic){if(B.graphicTitle){u.setAttributeNS(null,"title",B.graphicTitle);var f=this.nodeFactory(null,"title");f.textContent=B.graphicTitle;u.appendChild(f)}if(B.graphicWidth&&B.graphicHeight){u.setAttributeNS(null,"preserveAspectRatio","none")}var q=B.graphicWidth||B.graphicHeight;var p=B.graphicHeight||B.graphicWidth;q=q?q:B.pointRadius*2;p=p?p:B.pointRadius*2;q*=z;p*=z;var C=(B.graphicXOffset!=undefined)?B.graphicXOffset*z:-(0.5*q);var g=(B.graphicYOffset!=undefined)?B.graphicYOffset*z:-(0.5*p);var a=B.graphicOpacity||B.fillOpacity;u.setAttributeNS(null,"x",u._x+C);u.setAttributeNS(null,"y",u._y+g);u.setAttributeNS(null,"width",q);u.setAttributeNS(null,"height",p);u.setAttributeNS(this.xlinkns,"href",B.externalGraphic);u.setAttributeNS(null,"style","opacity: "+a);u.onclick=OpenLayers.Renderer.SVG2.preventDefault}else{if(this.isComplexSymbol(B.graphicName)){var d=B.pointRadius*3*z;var o=d*2;var e=this.importSymbol(B.graphicName);l=this.symbolMetrics[e.id].size*3/o*z;var h=u.parentNode;var j=u.nextSibling;if(h){h.removeChild(u)}u.firstChild&&u.removeChild(u.firstChild);u.appendChild(e.firstChild.cloneNode(true));u.setAttributeNS(null,"viewBox",e.getAttributeNS(null,"viewBox"));u.setAttributeNS(null,"width",o);u.setAttributeNS(null,"height",o);u.setAttributeNS(null,"x",u._x-d);u.setAttributeNS(null,"y",u._y-d);if(j){h.insertBefore(u,j)}else{if(h){h.appendChild(u)}}}else{u.setAttributeNS(null,"r",B.pointRadius*z)}}}var w=B.rotation;if(w!==undefined||u._rotation!==undefined){u._rotation=w;w|=0;if(u.nodeName!=="svg"){u.setAttributeNS(null,"transform",["rotate(",w,u._x,u._y,")"].join(" "))}else{var v=this.symbolMetrics[e.id];u.firstChild.setAttributeNS(null,"transform",["rotate(",w,v.x,v.y,")"].join(" "))}}}if(b.isFilled){u.setAttributeNS(null,"fill",B.fillColor);u.setAttributeNS(null,"fill-opacity",B.fillOpacity)
}else{u.setAttributeNS(null,"fill","none")}if(b.isStroked){u.setAttributeNS(null,"stroke",B.strokeColor);u.setAttributeNS(null,"stroke-opacity",B.strokeOpacity);u.setAttributeNS(null,"stroke-width",B.strokeWidth*l);u.setAttributeNS(null,"stroke-linecap",B.strokeLinecap||"round");u.setAttributeNS(null,"stroke-linejoin","round");B.strokeDashstyle&&u.setAttributeNS(null,"stroke-dasharray",this.dashStyle(B,l))}else{u.setAttributeNS(null,"stroke","none")}if(B.pointerEvents){u.setAttributeNS(null,"pointer-events",B.pointerEvents)}if(B.cursor!=null){u.setAttributeNS(null,"cursor",B.cursor)}return u},dashStyle:function(f,e){var a=f.strokeWidth*e;var h=f.strokeDashstyle;switch(h){case"solid":return"none";case"dot":return[e,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,e,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,e,4*a].join();default:var g=OpenLayers.String.trim(h).split(/\s+/g);for(var b=0,d=g.length;b<d;b++){g[b]=g[b]*e}return g.join()}},createNode:function(a,d){var b=document.createElementNS(this.xmlns,a);if(d){b.setAttributeNS(null,"id",d)}return b},nodeTypeCompare:function(b,a){return(a==b.nodeName)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(d,e,b){var a=e.x;var f=-e.y;d.setAttributeNS(null,"cx",a);d.setAttributeNS(null,"cy",f);d._x=a;d._y=f;d._radius=b;return d},drawLineString:function(a,d){var b=this.getComponentsString(d.components);a.setAttributeNS(null,"points",b);return a},drawLinearRing:function(a,d){var b=this.getComponentsString(d.components);a.setAttributeNS(null,"points",b);return a},drawPolygon:function(b,l){var h=[];var m=true;var a=true;var e,o;for(var f=0,g=l.components.length;f<g;f++){h.push("M");o=this.getComponentsString(l.components[f].components," ");h.push(o)}h.push("z");b.setAttributeNS(null,"d",h.join(" "));b.setAttributeNS(null,"fill-rule","evenodd");return b},drawRectangle:function(a,b){a.setAttributeNS(null,"x",b.x);a.setAttributeNS(null,"y",-b.y);a.setAttributeNS(null,"width",b.width);a.setAttributeNS(null,"height",b.height);return a},drawSurface:function(g,j){var h=[];var b=true;for(var f=0,a=j.components.length;f<a;f++){if((f%3)==0&&(f/3)==0){var e=this.getShortString(j.components[f]);h.push("M",e)}else{if((f%3)==1){var e=this.getShortString(j.components[f]);h.push("C",e)}else{var e=this.getShortString(j.components[f]);h.push(e)}}}h.push("Z");g.setAttributeNS(null,"d",h.join(" "));return g},drawText:function(e,a,p){var f=OpenLayers.Renderer.NG.prototype.drawText.apply(this,arguments);var q=f.firstChild||this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_text","text");var l=this.getResolution();q.setAttributeNS(null,"x",p.x/l);q.setAttributeNS(null,"y",-p.y/l);f.setAttributeNS(null,"transform","scale("+l+")");if(a.fontColor){q.setAttributeNS(null,"fill",a.fontColor)}if(a.fontOpacity){q.setAttributeNS(null,"opacity",a.fontOpacity)}if(a.fontFamily){q.setAttributeNS(null,"font-family",a.fontFamily)}if(a.fontSize){q.setAttributeNS(null,"font-size",a.fontSize)}if(a.fontWeight){q.setAttributeNS(null,"font-weight",a.fontWeight)}if(a.fontStyle){q.setAttributeNS(null,"font-style",a.fontStyle)}if(a.labelSelect===true){q.setAttributeNS(null,"pointer-events","visible");q._featureId=e}else{q.setAttributeNS(null,"pointer-events","none")}var j=a.labelAlign||"cm";q.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG2.LABEL_ALIGN[j[0]]||"middle");if(OpenLayers.IS_GECKO===true){q.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG2.LABEL_ALIGN[j[1]]||"central")}var b=a.label.split("\n");var h=b.length;while(q.childNodes.length>h){q.removeChild(q.lastChild)}for(var d=0;d<h;d++){var m=q.childNodes[d]||this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_tspan_"+d,"tspan");if(a.labelSelect===true){m._featureId=e}if(OpenLayers.IS_GECKO===false){m.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG2.LABEL_VSHIFT[j[1]]||"-35%")
}m.setAttribute("x",p.x/l);if(d==0){var o=OpenLayers.Renderer.SVG2.LABEL_VFACTOR[j[1]];if(o==null){o=-0.5}m.setAttribute("dy",(o*(h-1))+"em")}else{m.setAttribute("dy","1em")}m.textContent=(b[d]==="")?" ":b[d];if(!m.parentNode){q.appendChild(m)}}if(!q.parentNode){f.appendChild(q)}return f},getComponentsString:function(e,f){var b=e.length;var a=new Array(b);for(var d=0;d<b;d++){a[d]=this.getShortString(e[d])}return a.join(f||",")},getShortString:function(a){return a.x+","+(-a.y)},importSymbol:function(g){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+g;var d=document.getElementById(b);if(d!=null){return d}var f=OpenLayers.Renderer.symbol[g];if(!f){throw new Error(g+" is not a valid symbol name")}var l=this.nodeFactory(b,"symbol");var e=this.nodeFactory(null,"polygon");l.appendChild(e);var r=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var p=[];var o,m;for(var h=0,j=f.length;h<j;h=h+2){o=f[h];m=f[h+1];r.left=Math.min(r.left,o);r.bottom=Math.min(r.bottom,m);r.right=Math.max(r.right,o);r.top=Math.max(r.top,m);p.push(o,",",m)}e.setAttributeNS(null,"points",p.join(" "));var a=r.getWidth();var q=r.getHeight();var u=[r.left-a,r.bottom-q,a*3,q*3];l.setAttributeNS(null,"viewBox",u.join(" "));this.symbolMetrics[b]={size:Math.max(a,q),x:r.getCenterLonLat().lon,y:r.getCenterLonLat().lat};this.defs.appendChild(l);return l},getFeatureIdFromEvent:function(a){var d=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!d){var b=a.target;d=b.parentNode&&b!=this.rendererRoot&&b.parentNode._featureId}return d},CLASS_NAME:"OpenLayers.Renderer.SVG2"});OpenLayers.Renderer.SVG2.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG2.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG2.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG2.preventDefault=function(a){a.preventDefault&&a.preventDefault()};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:true,hitOverflow:0,canvas:null,features:null,pendingRedraw:false,initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},eraseGeometry:function(b,a){this.eraseFeatures(this.features[a][0])},supported:function(){var a=document.createElement("canvas");return !!a.getContext},setSize:function(b){this.size=b.clone();var a=this.root;a.style.width=b.w+"px";a.style.height=b.h+"px";a.width=b.w;a.height=b.h;this.resolution=null;if(this.hitDetection){var d=this.hitCanvas;d.style.width=b.w+"px";d.style.height=b.h+"px";d.width=b.w;d.height=b.h}},drawFeature:function(a,b){var e;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);var d=a.geometry.getBounds();e=(b.display!=="none")&&!!d&&d.intersectsBounds(this.extent);if(e){this.features[a.id]=[a,b]}else{delete (this.features[a.id])}this.pendingRedraw=true}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=false}return e},drawGeometry:function(f,d,e){var b=f.CLASS_NAME;if((b=="OpenLayers.Geometry.Collection")||(b=="OpenLayers.Geometry.MultiPoint")||(b=="OpenLayers.Geometry.MultiLineString")||(b=="OpenLayers.Geometry.MultiPolygon")){for(var a=0;a<f.components.length;a++){this.drawGeometry(f.components[a],d,e)}return}switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(f,d,e);break;case"OpenLayers.Geometry.LineString":this.drawLineString(f,d,e);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(f,d,e);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(f,d,e);break;default:break}},drawExternalGraphic:function(l,a,e){var f=new Image();if(a.graphicTitle){f.title=a.graphicTitle}var b=a.graphicWidth||a.graphicHeight;var m=a.graphicHeight||a.graphicWidth;b=b?b:a.pointRadius*2;m=m?m:a.pointRadius*2;var h=(a.graphicXOffset!=undefined)?a.graphicXOffset:-(0.5*b);var d=(a.graphicYOffset!=undefined)?a.graphicYOffset:-(0.5*m);
var g=a.graphicOpacity||a.fillOpacity;var j=function(){if(!this.features[e]){return}var r=this.getLocalXY(l);var w=r[0];var u=r[1];if(!isNaN(w)&&!isNaN(u)){var o=(w+h)|0;var v=(u+d)|0;var p=this.canvas;p.globalAlpha=g;var q=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(f,o*q,v*q,b*q,m*q);if(this.hitDetection){this.setHitContextStyle("fill",e);this.hitContext.fillRect(o,v,b,m)}}};f.onload=OpenLayers.Function.bind(j,this);f.src=a.externalGraphic},setCanvasStyle:function(b,a){if(b==="fill"){this.canvas.globalAlpha=a.fillOpacity;this.canvas.fillStyle=a.fillColor}else{if(b==="stroke"){this.canvas.globalAlpha=a.strokeOpacity;this.canvas.strokeStyle=a.strokeColor;this.canvas.lineWidth=a.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},featureIdToHex:function(d){var e=Number(d.split("_").pop())+1;if(e>=16777216){this.hitOverflow=e-16777215;e=e%16777216+1}var b="000000"+e.toString(16);var a=b.length;b="#"+b.substring(a-6,a);return b},setHitContextStyle:function(b,e,a){var d=this.featureIdToHex(e);if(b=="fill"){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=d}else{if(b=="stroke"){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=d;this.hitContext.lineWidth=a.strokeWidth+2}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}}},drawPoint:function(h,d,g){if(d.graphic!==false){if(d.externalGraphic){this.drawExternalGraphic(h,d,g)}else{var e=this.getLocalXY(h);var j=e[0];var f=e[1];if(!isNaN(j)&&!isNaN(f)){var b=Math.PI*2;var a=d.pointRadius;if(d.fill!==false){this.setCanvasStyle("fill",d);this.canvas.beginPath();this.canvas.arc(j,f,a,0,b,true);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",g,d);this.hitContext.beginPath();this.hitContext.arc(j,f,a,0,b,true);this.hitContext.fill()}}if(d.stroke!==false){this.setCanvasStyle("stroke",d);this.canvas.beginPath();this.canvas.arc(j,f,a,0,b,true);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",g,d);this.hitContext.beginPath();this.hitContext.arc(j,f,a,0,b,true);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}}},drawLineString:function(d,a,b){a=OpenLayers.Util.applyDefaults({fill:false},a);this.drawLinearRing(d,a,b)},drawLinearRing:function(d,a,b){if(a.fill!==false){this.setCanvasStyle("fill",a);this.renderPath(this.canvas,d,a,b,"fill");if(this.hitDetection){this.setHitContextStyle("fill",b,a);this.renderPath(this.hitContext,d,a,b,"fill")}}if(a.stroke!==false){this.setCanvasStyle("stroke",a);this.renderPath(this.canvas,d,a,b,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",b,a);this.renderPath(this.hitContext,d,a,b,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(d,m,a,f,j){var g=m.components;var h=g.length;d.beginPath();var b=this.getLocalXY(g[0]);var o=b[0];var l=b[1];if(!isNaN(o)&&!isNaN(l)){d.moveTo(b[0],b[1]);for(var e=1;e<h;++e){var p=this.getLocalXY(g[e]);d.lineTo(p[0],p[1])}if(j==="fill"){d.fill()}else{d.stroke()}}},drawPolygon:function(g,d,f){var e=g.components;var a=e.length;this.drawLinearRing(e[0],d,f);for(var b=1;b<a;++b){this.canvas.globalCompositeOperation="destination-out";if(this.hitDetection){this.hitContext.globalCompositeOperation="destination-out"}this.drawLinearRing(e[b],OpenLayers.Util.applyDefaults({stroke:false,fillOpacity:1},d),f);this.canvas.globalCompositeOperation="source-over";if(this.hitDetection){this.hitContext.globalCompositeOperation="source-over"}this.drawLinearRing(e[b],OpenLayers.Util.applyDefaults({fill:false},d),f)}},drawText:function(o,a){a=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},a);var p=this.getLocalXY(o);this.setCanvasStyle("reset");this.canvas.fillStyle=a.fontColor;this.canvas.globalAlpha=a.fontOpacity||1;var e=[a.fontStyle?a.fontStyle:"normal","normal",a.fontWeight?a.fontWeight:"normal",a.fontSize?a.fontSize:"1em",a.fontFamily?a.fontFamily:"sans-serif"].join(" ");var d=a.label.split("\n");var g=d.length;if(this.canvas.fillText){this.canvas.font=e;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[a.labelAlign[0]]||"center";
this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[a.labelAlign[1]]||"middle";var l=OpenLayers.Renderer.Canvas.LABEL_FACTOR[a.labelAlign[1]];if(l==null){l=-0.5}var m=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;p[1]+=m*l*(g-1);for(var f=0;f<g;f++){this.canvas.fillText(d[f],p[0],p[1]+(m*f))}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=e;var b=OpenLayers.Renderer.Canvas.LABEL_FACTOR[a.labelAlign[0]];if(b==null){b=-0.5}var l=OpenLayers.Renderer.Canvas.LABEL_FACTOR[a.labelAlign[1]];if(l==null){l=-0.5}var m=this.canvas.mozMeasureText("xx");p[1]+=m*(1+(l*g));for(var f=0;f<g;f++){var j=p[0]+(b*this.canvas.mozMeasureText(d[f]));var h=p[1]+(f*m);this.canvas.translate(j,h);this.canvas.mozDrawText(d[f]);this.canvas.translate(-j,-h)}}}this.setCanvasStyle("reset")},getLocalXY:function(b){var d=this.getResolution();var e=this.extent;var a=(b.x/d+(-e.left/d));var f=((e.top/d)-b.y/d);return[a,f]},clear:function(){var a=this.root.height;var b=this.root.width;this.canvas.clearRect(0,0,b,a);this.features={};if(this.hitDetection){this.hitContext.clearRect(0,0,b,a)}},getFeatureIdFromEvent:function(b){var d=null;if(this.hitDetection){if(!this.map.dragging){var f=b.xy;var a=f.x|0;var h=f.y|0;var e=this.hitContext.getImageData(a,h,1,1).data;if(e[3]===255){var g=e[2]+(256*(e[1]+(256*e[0])));if(g){d=this.features["OpenLayers.Feature.Vector_"+(g-1+this.hitOverflow)][0]}}}}return d},eraseFeatures:function(b){if(!(OpenLayers.Util.isArray(b))){b=[b]}for(var a=0;a<b.length;++a){delete this.features[b[a].id]}this.redraw()},redraw:function(){if(!this.locked){var h=this.root.height;var d=this.root.width;this.canvas.clearRect(0,0,d,h);if(this.hitDetection){this.hitContext.clearRect(0,0,d,h)}var g=[];var l,a;for(var b in this.features){if(!this.features.hasOwnProperty(b)){continue}l=this.features[b][0];a=this.features[b][1];this.drawGeometry(l.geometry,a,l.id);if(a.label){g.push([l,a])}}var j;for(var e=0,f=g.length;e<f;++e){j=g[e];this.drawText(j[0].geometry.getCentroid(),j[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(b){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var f=document.createStyleSheet();var d=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var e=0,a=d.length;e<a;e++){f.addRule("olv\\:"+d[e],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(l,a){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var d=this.getResolution();var b=(l.left/d)|0;var g=(l.top/d-this.size.h)|0;if(a||!this.offset){this.offset={x:b,y:g};b=0;g=0}else{b=b-this.offset.x;g=g-this.offset.y}var o=b+" "+g;this.root.coordorigin=o;var j=[this.root,this.vectorRoot,this.textRoot];var h;for(var e=0,f=j.length;e<f;++e){h=j[e];var m=this.size.w+" "+this.size.h;h.coordsize=m}this.root.style.flip="y";return true},setSize:function(g){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var e=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var d=this.size.w+"px";var j=this.size.h+"px";var b;for(var f=0,a=e.length;f<a;++f){b=e[f];b.style.width=d;b.style.height=j}},getNodeType:function(d,b){var a=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="olv:rect"}else{if(this.isComplexSymbol(b.graphicName)){a="olv:shape"}else{a="olv:oval"}}break;case"OpenLayers.Geometry.Rectangle":a="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="olv:shape";
break;default:break}return a},setStyle:function(f,b,w,o){b=b||f._style;w=w||f._options;var d=b.fillColor;if(f._geometryClass==="OpenLayers.Geometry.Point"){if(b.externalGraphic){w.isFilled=true;if(b.graphicTitle){f.title=b.graphicTitle}var e=b.graphicWidth||b.graphicHeight;var p=b.graphicHeight||b.graphicWidth;e=e?e:b.pointRadius*2;p=p?p:b.pointRadius*2;var h=this.getResolution();var l=(b.graphicXOffset!=undefined)?b.graphicXOffset:-(0.5*e);var g=(b.graphicYOffset!=undefined)?b.graphicYOffset:-(0.5*p);f.style.left=(((o.x/h-this.offset.x)+l)|0)+"px";f.style.top=(((o.y/h-this.offset.y)-(g+p))|0)+"px";f.style.width=e+"px";f.style.height=p+"px";f.style.flip="y";d="none";w.isStroked=false}else{if(this.isComplexSymbol(b.graphicName)){var a=this.importSymbol(b.graphicName);f.path=a.path;f.coordorigin=a.left+","+a.bottom;var v=a.size;f.coordsize=v+","+v;this.drawCircle(f,o,b.pointRadius);f.style.flip="y"}else{this.drawCircle(f,o,b.pointRadius)}}}if(w.isFilled){f.fillcolor=d}else{f.filled="false"}var m=f.getElementsByTagName("fill");var u=(m.length==0)?null:m[0];if(!w.isFilled){if(u){f.removeChild(u)}}else{if(!u){u=this.createNode("olv:fill",f.id+"_fill")}u.opacity=b.fillOpacity;if(f._geometryClass==="OpenLayers.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity){u.opacity=b.graphicOpacity}u.src=b.externalGraphic;u.type="frame";if(!(b.graphicWidth&&b.graphicHeight)){u.aspect="atmost"}}if(u.parentNode!=f){f.appendChild(u)}}var r=b.rotation;if((r!==undefined||f._rotation!==undefined)){f._rotation=r;if(b.externalGraphic){this.graphicRotate(f,l,g,b);u.opacity=0}else{if(f._geometryClass==="OpenLayers.Geometry.Point"){f.style.rotation=r||0}}}var j=f.getElementsByTagName("stroke");var q=(j.length==0)?null:j[0];if(!w.isStroked){f.stroked=false;if(q){q.on=false}}else{if(!q){q=this.createNode("olv:stroke",f.id+"_stroke");f.appendChild(q)}q.on=true;q.color=b.strokeColor;q.weight=b.strokeWidth+"px";q.opacity=b.strokeOpacity;q.endcap=b.strokeLinecap=="butt"?"flat":(b.strokeLinecap||"round");if(b.strokeDashstyle){q.dashstyle=this.dashStyle(b)}}if(b.cursor!="inherit"&&b.cursor!=null){f.style.cursor=b.cursor}return f},graphicRotate:function(r,z,f,w){var w=w||r._style;var u=w.rotation||0;var a,m;if(!(w.graphicWidth&&w.graphicHeight)){var B=new Image();B.onreadystatechange=OpenLayers.Function.bind(function(){if(B.readyState=="complete"||B.readyState=="interactive"){a=B.width/B.height;m=Math.max(w.pointRadius*2,w.graphicWidth||0,w.graphicHeight||0);z=z*a;w.graphicWidth=m*a;w.graphicHeight=m;this.graphicRotate(r,z,f,w)}},this);B.src=w.externalGraphic;return}else{m=Math.max(w.graphicWidth,w.graphicHeight);a=w.graphicWidth/w.graphicHeight}var q=Math.round(w.graphicWidth||m*a);var o=Math.round(w.graphicHeight||m);r.style.width=q+"px";r.style.height=o+"px";var p=document.getElementById(r.id+"_image");if(!p){p=this.createNode("olv:imagedata",r.id+"_image");r.appendChild(p)}p.style.width=q+"px";p.style.height=o+"px";p.src=w.externalGraphic;p.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var g=u*Math.PI/180;var j=Math.sin(g);var e=Math.cos(g);var h="progid:DXImageTransform.Microsoft.Matrix(M11="+e+",M12="+(-j)+",M21="+j+",M22="+e+",SizingMethod='auto expand')\n";var b=w.graphicOpacity||w.fillOpacity;if(b&&b!=1){h+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+b+")\n"}r.style.filter=h;var v=new OpenLayers.Geometry.Point(-z,-f);var d=new OpenLayers.Bounds(0,0,q,o).toGeometry();d.rotate(w.rotation,v);var l=d.getBounds();r.style.left=Math.round(parseInt(r.style.left)+l.left)+"px";r.style.top=Math.round(parseInt(r.style.top)-l.bottom)+"px"},postDraw:function(a){a.style.visibility="visible";var d=a._style.fillColor;var b=a._style.strokeColor;if(d=="none"&&a.fillcolor!=d){a.fillcolor=d}if(b=="none"&&a.strokecolor!=b){a.strokecolor=b}},setNodeDimension:function(b,f){var e=f.getBounds();if(e){var a=this.getResolution();var d=new OpenLayers.Bounds((e.left/a-this.offset.x)|0,(e.bottom/a-this.offset.y)|0,(e.right/a-this.offset.x)|0,(e.top/a-this.offset.y)|0);b.style.left=d.left+"px";b.style.top=d.top+"px";
b.style.width=d.getWidth()+"px";b.style.height=d.getHeight()+"px";b.coordorigin=d.left+" "+d.top;b.coordsize=d.getWidth()+" "+d.getHeight()}},dashStyle:function(a){var d=a.strokeDashstyle;switch(d){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return d;default:var b=d.split(/[ ,]/);if(b.length==2){if(1*b[0]>=2*b[1]){return"longdash"}return(b[0]==1||b[1]==1)?"dot":"dash"}else{if(b.length==4){return(1*b[0]>=2*b[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(a,d){var b=document.createElement(a);if(d){b.id=d}b.unselectable="on";b.onselectstart=OpenLayers.Function.False;return b},nodeTypeCompare:function(d,b){var e=b;var a=e.indexOf(":");if(a!=-1){e=e.substr(a+1)}var f=d.nodeName;a=f.indexOf(":");if(a!=-1){f=f.substr(a+1)}return(e==f)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(e,f,a){if(!isNaN(f.x)&&!isNaN(f.y)){var b=this.getResolution();e.style.left=(((f.x/b-this.offset.x)|0)-a)+"px";e.style.top=(((f.y/b-this.offset.y)|0)-a)+"px";var d=a*2;e.style.width=d+"px";e.style.height=d+"px";return e}return false},drawLineString:function(a,b){return this.drawLine(a,b,false)},drawLinearRing:function(a,b){return this.drawLine(a,b,true)},drawLine:function(b,m,h){this.setNodeDimension(b,m);var d=this.getResolution();var a=m.components.length;var f=new Array(a);var j,o,l;for(var g=0;g<a;g++){j=m.components[g];o=(j.x/d-this.offset.x)|0;l=(j.y/d-this.offset.y)|0;f[g]=" "+o+","+l+" l "}var e=(h)?" x e":" e";b.path="m"+f.join("")+e;return b},drawPolygon:function(d,p){this.setNodeDimension(d,p);var e=this.getResolution();var w=[];var f,m,r,a,h,b,g,v,l,u,q,o;for(f=0,m=p.components.length;f<m;f++){w.push("m");r=p.components[f].components;a=(f===0);h=null;b=null;for(g=0,v=r.length;g<v;g++){l=r[g];q=(l.x/e-this.offset.x)|0;o=(l.y/e-this.offset.y)|0;u=" "+q+","+o;w.push(u);if(g==0){w.push(" l")}if(!a){if(!h){h=u}else{if(h!=u){if(!b){b=u}else{if(b!=u){a=true}}}}}}w.push(a?" x ":" ")}w.push("e");d.path=w.join("");return d},drawRectangle:function(b,d){var a=this.getResolution();b.style.left=((d.x/a-this.offset.x)|0)+"px";b.style.top=((d.y/a-this.offset.y)|0)+"px";b.style.width=((d.width/a)|0)+"px";b.style.height=((d.height/a)|0)+"px";return b},drawText:function(e,a,j){var h=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect");var g=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var d=this.getResolution();h.style.left=((j.x/d-this.offset.x)|0)+"px";h.style.top=((j.y/d-this.offset.y)|0)+"px";h.style.flip="y";g.innerText=a.label;if(a.cursor!="inherit"&&a.cursor!=null){g.style.cursor=a.cursor}if(a.fontColor){g.style.color=a.fontColor}if(a.fontOpacity){g.style.filter="alpha(opacity="+(a.fontOpacity*100)+")"}if(a.fontFamily){g.style.fontFamily=a.fontFamily}if(a.fontSize){g.style.fontSize=a.fontSize}if(a.fontWeight){g.style.fontWeight=a.fontWeight}if(a.fontStyle){g.style.fontStyle=a.fontStyle}if(a.labelSelect===true){h._featureId=e;g._featureId=e;g._geometry=j;g._geometryClass=j.CLASS_NAME}g.style.whiteSpace="nowrap";g.inset="1px,0px,0px,0px";if(!h.parentNode){h.appendChild(g);this.textRoot.appendChild(h)}var f=a.labelAlign||"cm";if(f.length==1){f+="m"}var l=g.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[f.substr(0,1)]);var b=g.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[f.substr(1,1)]);h.style.left=parseInt(h.style.left)-l-1+"px";h.style.top=parseInt(h.style.top)+b+"px"},drawSurface:function(a,h){this.setNodeDimension(a,h);var b=this.getResolution();var l=[];var e,j,g;for(var d=0,f=h.components.length;d<f;d++){e=h.components[d];j=(e.x/b-this.offset.x)|0;g=(e.y/b-this.offset.y)|0;if((d%3)==0&&(d/3)==0){l.push("m")}else{if((d%3)==1){l.push(" c")}}l.push(" "+j+","+g)}l.push(" x e");a.path=l.join("");return a},moveRoot:function(b){var a=this.map.getLayer(b.container.id);if(a instanceof OpenLayers.Layer.Vector.RootContainer){a=this.map.getLayer(this.container.id)}a&&a.renderer.clear();
OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);a&&a.redraw()},importSymbol:function(e){var b=this.container.id+"-"+e;var a=this.symbolCache[b];if(a){return a}var d=OpenLayers.Renderer.symbol[e];if(!d){throw new Error(e+" is not a valid symbol name")}var m=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var f=["m"];for(var g=0;g<d.length;g=g+2){var j=d[g];var h=d[g+1];m.left=Math.min(m.left,j);m.bottom=Math.min(m.bottom,h);m.right=Math.max(m.right,j);m.top=Math.max(m.top,h);f.push(j);f.push(h);if(g==0){f.push("l")}}f.push("x e");var o=f.join(" ");var l=(m.getWidth()-m.getHeight())/2;if(l>0){m.bottom=m.bottom-l;m.top=m.top+l}else{m.left=m.left+l;m.right=m.right-l}a={path:o,size:m.getWidth(),left:m.left,bottom:m.bottom};this.symbolCache[b]=a;return a},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","vertexremoved","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(d,b){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var e=0,a=this.strategies.length;e<a;e++){this.strategies[e].setLayer(this)}}},destroy:function(){if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoDestroy){d.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(f){if(f==null){f=new OpenLayers.Layer.Vector(this.name,this.getOptions())}f=OpenLayers.Layer.prototype.clone.apply(this,[f]);var d=this.features;var a=d.length;var e=new Array(a);for(var b=0;b<a;++b){e[b]=d[b].clone()}f.features=e;return f},refresh:function(a){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",a)}},assignRenderer:function(){for(var d=0,a=this.renderers.length;d<a;d++){var b=this.renderers[d];var e=(typeof b=="function")?b:OpenLayers.Renderer[b];if(e&&e.prototype.supported()){this.renderer=new e(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}},afterAdd:function(){if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoActivate){d.activate()}}}},removeMap:function(d){this.drawn=false;if(this.strategies){var e,b,a;for(b=0,a=this.strategies.length;b<a;b++){e=this.strategies[b];if(e.autoActivate){e.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())
},moveTo:function(a,b,h){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var e=(OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG);if(e){h||this.renderer.updateDimensions(b)}else{var d=true;if(!h){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var j=this.map.getExtent();d=this.renderer.setExtent(j,b);this.renderer.root.style.visibility="visible";if(OpenLayers.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft}if(!b&&d){for(var f in this.unrenderedFeatures){var l=this.unrenderedFeatures[f];this.drawFeature(l)}}}}if(!this.drawn||(!e&&(b||!d))){this.drawn=true;var l;for(var f=0,g=this.features.length;f<g;f++){this.renderer.locked=(f!==(g-1));l=this.features[f];this.drawFeature(l)}}},redraw:function(){if(OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG){this.drawn=false}return OpenLayers.Layer.prototype.redraw.apply(this,arguments)},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;if(b!=this.renderer.root.style.display){this.renderer.root.style.display=b}},addFeatures:function(b,m){if(!(OpenLayers.Util.isArray(b))){b=[b]}var j=!m||!m.silent;if(j){var a={features:b};var h=this.events.triggerEvent("beforefeaturesadded",a);if(h===false){return}b=a.features}var e=[];for(var d=0,g=b.length;d<g;d++){if(d!=(b.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var l=b[d];if(this.geometryType&&!(l.geometry instanceof this.geometryType)){var f=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw f}l.layer=this;if(!l.style&&this.style){l.style=OpenLayers.Util.extend({},this.style)}if(j){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===false){continue}this.preFeatureInsert(l)}e.push(l);this.features.push(l);this.drawFeature(l);if(j){this.events.triggerEvent("featureadded",{feature:l});this.onFeatureInsert(l)}}if(j){this.events.triggerEvent("featuresadded",{features:e})}},removeFeatures:function(f,a){if(!f||f.length===0){return}if(f===this.features){return this.removeAllFeatures(a)}if(!(OpenLayers.Util.isArray(f))){f=[f]}if(f===this.selectedFeatures){f=f.slice()}var e=!a||!a.silent;if(e){this.events.triggerEvent("beforefeaturesremoved",{features:f})}for(var d=f.length-1;d>=0;d--){if(d!=0&&f[d-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var b=f[d];delete this.unrenderedFeatures[b.id];if(e){this.events.triggerEvent("beforefeatureremoved",{feature:b})}this.features=OpenLayers.Util.removeItem(this.features,b);b.layer=null;if(b.geometry){this.renderer.eraseFeatures(b)}if(OpenLayers.Util.indexOf(this.selectedFeatures,b)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,b)}if(e){this.events.triggerEvent("featureremoved",{feature:b})}}if(e){this.events.triggerEvent("featuresremoved",{features:f})}},removeAllFeatures:function(a){var e=!a||!a.silent;var f=this.features;if(e){this.events.triggerEvent("beforefeaturesremoved",{features:f})}var d;for(var b=f.length-1;b>=0;b--){d=f[b];if(e){this.events.triggerEvent("beforefeatureremoved",{feature:d})}d.layer=null;if(e){this.events.triggerEvent("featureremoved",{feature:d})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(e){this.events.triggerEvent("featuresremoved",{features:f})}},destroyFeatures:function(e,a){var d=(e==undefined);if(d){e=this.features}if(e){this.removeFeatures(e,a);for(var b=e.length-1;b>=0;b--){e[b].destroy()}}},drawFeature:function(a,b){if(!this.drawn){return}if(typeof b!="object"){if(!b&&a.state===OpenLayers.State.DELETE){b="delete"}var d=b||a.renderIntent;b=a.style||this.style;if(!b){b=this.styleMap.createSymbolizer(a,d)}}var e=this.renderer.drawFeature(a,b);if(e===false||e===null){this.unrenderedFeatures[a.id]=a}else{delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));
return null}var b=null;var d=this.renderer.getFeatureIdFromEvent(a);if(d){if(typeof d==="string"){b=this.getFeatureById(d)}else{b=d}}return b},getFeatureBy:function(f,e){var d=null;for(var b=0,a=this.features.length;b<a;++b){if(this.features[b][f]==e){d=this.features[b];break}}return d},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByAttribute:function(e,f){var d,b,a=this.features.length,g=[];for(d=0;d<a;d++){b=this.features[d];if(b&&b.attributes){if(b.attributes[e]===f){g.push(b)}}}return g},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var b=null;var e=this.features;if(e&&(e.length>0)){var f=null;for(var d=0,a=e.length;d<a;d++){f=e[d].geometry;if(f){if(b===null){b=new OpenLayers.Bounds()}b.extend(f.getBounds())}}}return b},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(a){var e=this.layers;var d;for(var b=0;b<e.length;b++){d=e[b].getFeatureFromEvent(a);if(d){return d}}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var b;for(var a=0;a<this.map.layers.length;++a){b=this.map.layers[a];if(OpenLayers.Util.indexOf(this.layers,b)!=-1){b.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var b;for(var a=0;a<this.layers.length;++a){b=this.layers[a];if(this.renderer&&b.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(b.renderer)}}},handleChangeLayer:function(a){var b=a.layer;if(a.property=="order"&&OpenLayers.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(a){this.layer=a},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:false,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(a){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return a},deactivate:function(){this.cache=null;if(this.layer&&this.layer.events){this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(f){if(!this.caching&&this.filter){var e=f.features;f.features=[];var b;for(var a=0,d=e.length;a<d;++a){b=e[a];if(this.filter.evaluate(b)){f.features.push(b)}else{this.cache.push(b)}}}},handleRemove:function(a){if(!this.caching){this.cache=[]}},setFilter:function(a){this.filter=a;var d=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=true;this.layer.removeFeatures(this.cache.slice());this.caching=false}if(d.length>0){var b={features:d};this.handleAdd(b);if(b.features.length>0){this.caching=true;this.layer.addFeatures(b.features);this.caching=false}}},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});
if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return true}return false},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart");b.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,b.map.getProjectionObject()),filter:b.filter},a));b.events.un({visibilitychanged:this.load,scope:this})},merge:function(g,h){var e=this.layer;e.destroyFeatures();var f=h.features;if(f&&f.length>0){if(!g.equals(e.projection)){var d;for(var b=0,a=f.length;b<a;++b){d=f[b].geometry;if(d){d.transform(e.projection,g)}}}e.addFeatures(f)}e.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},cacheFeatures:function(b){var a=true;if(!this.clustering){this.clearCache();this.features=b.features;this.cluster();a=false}return a},clearCache:function(){this.features=null},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var d=this.layer.map.getResolution();if(d!=this.resolution||!this.clustersExist()){this.resolution=d;var l=[];var p,b,m;for(var f=0;f<this.features.length;++f){p=this.features[f];if(p.geometry){b=false;for(var e=l.length-1;e>=0;--e){m=l[e];if(this.shouldCluster(m,p)){this.addToCluster(m,p);b=true;break}}if(!b){l.push(this.createCluster(this.features[f]))}}}this.layer.removeAllFeatures();if(l.length>0){if(this.threshold>1){var h=l.slice();l=[];var o;for(var f=0,g=h.length;f<g;++f){o=h[f];if(o.attributes.count<this.threshold){Array.prototype.push.apply(l,o.cluster)}else{l.push(o)}}}this.clustering=true;this.layer.addFeatures(l);this.clustering=false}this.clusters=l}}},clustersExist:function(){var b=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){b=true;for(var a=0;a<this.clusters.length;++a){if(this.clusters[a]!=this.layer.features[a]){b=false;break}}}return b},shouldCluster:function(a,b){var f=a.geometry.getBounds().getCenterLonLat();var d=b.geometry.getBounds().getCenterLonLat();var e=(Math.sqrt(Math.pow((f.lon-d.lon),2)+Math.pow((f.lat-d.lat),2))/this.resolution);return(e<=this.distance)},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(d){var b=d.geometry.getBounds().getCenterLonLat();var a=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});a.cluster=[d];return a},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({moveend:this.update,scope:this});this.layer.events.on({refresh:this.update,scope:this});if(this.layer.visibility===true&&this.layer.inRange===true){this.update()}else{this.layer.events.on({visibilitychanged:this.update,scope:this})}}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this})}return a},update:function(b){var a=this.getMapBounds();if(a!==null&&((b&&b.force)||this.invalidBounds(a))){this.calculateBounds(a);this.resolution=this.layer.map.getResolution();this.triggerRead(b)}},getMapBounds:function(){if(this.layer.map===null){return null}var a=this.layer.map.getExtent();
if(a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())){a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return a},invalidBounds:function(a){if(!a){a=this.getMapBounds()}var d=!this.bounds||!this.bounds.containsBounds(a);if(!d&&this.resFactor){var b=this.resolution/this.layer.map.getResolution();d=(b>=this.resFactor||b<=(1/this.resFactor))}return d},calculateBounds:function(b){if(!b){b=this.getMapBounds()}var a=b.getCenterLonLat();var e=b.getWidth()*this.ratio;var d=b.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(a.lon-(e/2),a.lat-(d/2),a.lon+(e/2),a.lat+(d/2))},triggerRead:function(a){if(this.response){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadend")}this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})}return a},merge:function(h){this.layer.destroyFeatures();var f=h.features;if(f&&f.length>0){var g=this.layer.projection;var e=this.layer.map.getProjectionObject();if(!e.equals(g)){var d;for(var b=0,a=f.length;b<a;++b){d=f[b].geometry;if(d){d.transform(g,e)}}}this.layer.addFeatures(f)}this.response=null;this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return true},clone:function(){return null},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(d){for(var b=0,a=this.fids.length;b<a;b++){var e=d.fid||d.id;if(e==this.fids[b]){return true}}return false},clone:function(){var a=new OpenLayers.Filter.FeatureId();OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(d){var b,a;switch(this.type){case OpenLayers.Filter.Logical.AND:for(b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(d)==false){return false}}return true;case OpenLayers.Filter.Logical.OR:for(b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(d)==true){return true}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(d))}return undefined},clone:function(){var d=[];for(var b=0,a=this.filters.length;b<a;++b){d.push(this.filters[b].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:d})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]);if(this.type===OpenLayers.Filter.Comparison.LIKE&&a.matchCase===undefined){this.matchCase=null}},evaluate:function(d){if(d instanceof OpenLayers.Feature.Vector){d=d.attributes}var a=false;var b=d[this.property];var f;switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:f=this.value;if(!this.matchCase&&typeof b=="string"&&typeof f=="string"){a=(b.toUpperCase()==f.toUpperCase())}else{a=(b==f)}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:f=this.value;if(!this.matchCase&&typeof b=="string"&&typeof f=="string"){a=(b.toUpperCase()!=f.toUpperCase())}else{a=(b!=f)}break;case OpenLayers.Filter.Comparison.LESS_THAN:a=b<this.value;
break;case OpenLayers.Filter.Comparison.GREATER_THAN:a=b>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:a=b<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:a=b>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:a=(b>=this.lowerBoundary)&&(b<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var e=new RegExp(this.value,"gi");a=e.test(b);break}return a},value2regex:function(e,b,a){if(e=="."){var d="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(d);return null}e=e?e:"*";b=b?b:".";a=a?a:"!";this.value=this.value.replace(new RegExp("\\"+a+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+b,"g"),".");this.value=this.value.replace(new RegExp("\\"+e,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b);return this.value},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(d,b){return b?d:"!."});a=a.replace(/(\\)?\\\*/g,function(d,b){return b?d:"!*"});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(d){var a=false;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(d.geometry){var b=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){b=this.value.toGeometry()}if(d.geometry.intersects(b)){a=true}}break;default:OpenLayers.Console.error(OpenLayers.i18n("filterEvaluateNotImplemented"));break}return a},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},mergeWithDefaultFilter:function(b){var a;if(b&&this.defaultFilter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]})}else{a=b||this.defaultFilter||undefined}return a},destroy:function(){this.options=null;this.format=null},read:function(a){a=a||{};a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},createCallback:function(d,a,b){return OpenLayers.Function.bind(function(){d.apply(this,[a,b])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,srsInBBOX:false,initialize:function(a){a=a||{};
this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(d,e){return b.write(d,e)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=a||{};a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a=OpenLayers.Util.applyDefaults(a,this.options);if(a.filter&&this.filterToParams){a.params=this.filterToParams(a.filter,a.params)}var b=(a.readWithPOST!==undefined)?a.readWithPOST:this.readWithPOST;var d=new OpenLayers.Protocol.Response({requestType:"read"});if(b){d.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,d,a),data:OpenLayers.Util.getParameterString(a.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else{d.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,d,a),params:a.params,headers:a.headers})}return d},handleRead:function(b,a){this.handleResponse(b,a)},create:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:b,requestType:"create"});d.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleCreate,d,a),headers:a.headers,data:this.format.write(b)});return d},handleCreate:function(b,a){this.handleResponse(b,a)},update:function(d,b){b=b||{};var a=b.url||d.url||this.options.url+"/"+d.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var e=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"update"});e.priv=OpenLayers.Request.PUT({url:a,callback:this.createCallback(this.handleUpdate,e,b),headers:b.headers,data:this.format.write(d)});return e},handleUpdate:function(b,a){this.handleResponse(b,a)},"delete":function(d,b){b=b||{};var a=b.url||d.url||this.options.url+"/"+d.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var e=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"delete"});e.priv=OpenLayers.Request.DELETE({url:a,callback:this.createCallback(this.handleDelete,e,b),headers:b.headers});return e},handleDelete:function(b,a){this.handleResponse(b,a)},handleResponse:function(d,a){var b=d.priv;if(a.callback){if(b.status>=200&&b.status<300){if(d.requestType!="delete"){d.features=this.parseFeatures(b)}d.code=OpenLayers.Protocol.Response.SUCCESS}else{d.code=OpenLayers.Protocol.Response.FAILURE}a.callback.call(a.scope,d)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(b,v){v=OpenLayers.Util.applyDefaults(v,this.options);var e=[],p=0;var m={};m[OpenLayers.State.INSERT]=[];m[OpenLayers.State.UPDATE]=[];m[OpenLayers.State.DELETE]=[];var u,o,d=[];for(var f=0,l=b.length;f<l;++f){u=b[f];o=m[u.state];if(o){o.push(u);d.push(u)}}var h=(m[OpenLayers.State.INSERT].length>0?1:0)+m[OpenLayers.State.UPDATE].length+m[OpenLayers.State.DELETE].length;var r=true;var a=new OpenLayers.Protocol.Response({reqFeatures:d});function j(z){var w=z.features?z.features.length:0;var C=new Array(w);for(var B=0;B<w;++B){C[B]=z.features[B].fid}a.insertIds=C;q.apply(this,[z])}function q(w){this.callUserCallback(w,v);r=r&&w.success();p++;if(p>=h){if(v.callback){a.code=r?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;v.callback.apply(v.scope,[a])}}}var g=m[OpenLayers.State.INSERT];if(g.length>0){e.push(this.create(g,OpenLayers.Util.applyDefaults({callback:j,scope:this},v.create)))}g=m[OpenLayers.State.UPDATE];for(var f=g.length-1;f>=0;--f){e.push(this.update(g[f],OpenLayers.Util.applyDefaults({callback:q,scope:this},v.update)))}g=m[OpenLayers.State.DELETE];for(var f=g.length-1;f>=0;--f){e.push(this["delete"](g[f],OpenLayers.Util.applyDefaults({callback:q,scope:this},v["delete"])))}return e},abort:function(a){if(a){a.priv.abort()}},callUserCallback:function(d,a){var b=a[d.requestType];
if(b&&b.callback){b.callback.call(b.scope,d)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.rules=[];if(a&&a.rules){this.addRules(a.rules)}this.setDefaultStyle(b||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy();this.rules[b]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(m){var a=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),m);var l=this.rules;var j,b;var d=[];var g=false;for(var e=0,f=l.length;e<f;e++){j=l[e];var h=j.evaluate(m);if(h){if(j instanceof OpenLayers.Rule&&j.elseFilter){d.push(j)}else{g=true;this.applySymbolizer(j,a,m)}}}if(g==false&&d.length>0){g=true;for(var e=0,f=d.length;e<f;e++){this.applySymbolizer(d[e],a,m)}}if(l.length>0&&g==false){a.display="none"}if(a.label&&typeof a.label!=="string"){a.label=String(a.label)}return a},applySymbolizer:function(g,e,b){var a=b.geometry?this.getSymbolizerPrefix(b.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var d=g.symbolizer[a]||g.symbolizer;if(this.defaultsPerSymbolizer===true){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(d,{pointRadius:f.pointRadius});if(d.stroke===true||d.graphic===true){OpenLayers.Util.applyDefaults(d,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap})}if(d.fill===true||d.graphic===true){OpenLayers.Util.applyDefaults(d,{fillColor:f.fillColor,fillOpacity:f.fillOpacity})}if(d.graphic===true){OpenLayers.Util.applyDefaults(d,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(OpenLayers.Util.extend(e,d),b)},createLiterals:function(e,d){var b=OpenLayers.Util.extend({},d.attributes||d.data);OpenLayers.Util.extend(b,this.context);for(var a in this.propertyStyles){e[a]=OpenLayers.Style.createLiteral(e[a],b,d,a)}return e},findPropertyStyles:function(){var e={};var g=this.defaultStyle;this.addPropertyStyles(e,g);var j=this.rules;var f,h;for(var d=0,a=j.length;d<a;d++){f=j[d].symbolizer;for(var b in f){h=f[b];if(typeof h=="object"){this.addPropertyStyles(e,h)}else{this.addPropertyStyles(e,f);break}}}return e},addPropertyStyles:function(b,d){var e;for(var a in d){e=d[a];if(typeof e=="string"&&e.match(/\$\{\w+\}/)){b[a]=true}}return b},addRules:function(a){Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){var d=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var b=0,a=d.length;b<a;b++){if(e.CLASS_NAME.indexOf(d[b])!=-1){return d[b]}}},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.rules){b.rules=[];for(var d=0,a=this.rules.length;d<a;++d){b.rules.push(this.rules[d].clone())}}b.context=this.context&&OpenLayers.Util.extend({},this.context);var e=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(e,b)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,b,a,d){if(typeof e=="string"&&e.indexOf("${")!=-1){e=OpenLayers.String.format(e,b,[a,d]);e=(isNaN(e)||!e)?e:parseFloat(e)}return e};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy()}delete this.rules},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.rules){b.rules=[];for(var d=0,a=this.rules.length;d<a;++d){b.rules.push(this.rules[d].clone())}}return new OpenLayers.Style2(b)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(d,a){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(d instanceof OpenLayers.Style){this.styles["default"]=d;this.styles.select=d;this.styles.temporary=d;this.styles["delete"]=d}else{if(typeof d=="object"){for(var b in d){if(d[b] instanceof OpenLayers.Style){this.styles[b]=d[b]}else{if(typeof d[b]=="object"){this.styles[b]=new OpenLayers.Style(d[b])}else{this.styles["default"]=new OpenLayers.Style(d);this.styles.select=new OpenLayers.Style(d);this.styles.temporary=new OpenLayers.Style(d);this.styles["delete"]=new OpenLayers.Style(d);break}}}}}OpenLayers.Util.extend(this,a)},destroy:function(){for(var a in this.styles){this.styles[a].destroy()}this.styles=null},createSymbolizer:function(b,d){if(!b){b=new OpenLayers.Feature.Vector()}if(!this.styles[d]){d="default"}b.renderIntent=d;var a={};if(this.extendDefault&&d!="default"){a=this.styles["default"].createSymbolizer(b)}return OpenLayers.Util.extend(a,this.styles[d].createSymbolizer(b))},addUniqueValueRules:function(b,e,g,a){var f=[];for(var d in g){f.push(new OpenLayers.Rule({symbolizer:g[d],context:a,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:e,value:d})}))}this.styles[b].addRules(f)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);if(this.symbolizers){delete this.symbolizer}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(d){var b=this.getContext(d);var a=true;if(this.minScaleDenominator||this.maxScaleDenominator){var e=d.layer.map.getScale()}if(this.minScaleDenominator){a=e>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)}if(a&&this.maxScaleDenominator){a=e<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)}if(a&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){a=this.filter.evaluate(d)}else{a=this.filter.evaluate(b)}}return a},getContext:function(b){var a=this.context;if(!a){a=b.attributes||b.data}if(typeof this.context=="function"){a=this.context(b)}return a},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.symbolizers){var a=this.symbolizers.length;b.symbolizers=new Array(a);for(var e=0;e<a;++e){b.symbolizers[e]=this.symbolizers[e].clone()}}else{b.symbolizer={};var g,f;for(var d in this.symbolizer){g=this.symbolizer[d];f=typeof g;if(f==="object"){b.symbolizer[d]=OpenLayers.Util.extend({},g)}else{if(f==="string"){b.symbolizer[d]=g}}}}b.filter=this.filter&&this.filter.clone();b.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(b)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.QueryStringFilter=(function(){var b={};b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";
b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";b[OpenLayers.Filter.Comparison.LESS_THAN]="lt";b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";b[OpenLayers.Filter.Comparison.LIKE]="ilike";function a(d){d=d.replace(/%/g,"\\%");d=d.replace(/\\\\\.(\*)?/g,function(f,e){return e?f:"\\\\_"});d=d.replace(/\\\\\.\*/g,"\\\\%");d=d.replace(/(\\)?\.(\*)?/g,function(f,e,g){return e||g?f:"_"});d=d.replace(/(\\)?\.\*/g,function(f,e){return e?f:"%"});d=d.replace(/\\\./g,".");d=d.replace(/(\\)?\\\*/g,function(f,e){return e?f:"*"});return d}return OpenLayers.Class(OpenLayers.Format,{wildcarded:false,srsInBBOX:false,write:function(g,l){l=l||{};var f=g.CLASS_NAME;var h=f.substring(f.lastIndexOf(".")+1);switch(h){case"Spatial":switch(g.type){case OpenLayers.Filter.Spatial.BBOX:l.bbox=g.value.toArray();if(this.srsInBBOX&&g.projection){l.bbox.push(g.projection.getCode())}break;case OpenLayers.Filter.Spatial.DWITHIN:l.tolerance=g.distance;case OpenLayers.Filter.Spatial.WITHIN:l.lon=g.value.x;l.lat=g.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+g.type)}break;case"Comparison":var m=b[g.type];if(m!==undefined){var j=g.value;if(g.type==OpenLayers.Filter.Comparison.LIKE){j=a(j);if(this.wildcarded){j="%"+j+"%"}}l[g.property+"__"+m]=j;l.queryable=l.queryable||[];l.queryable.push(g.property)}else{OpenLayers.Console.warn("Unknown comparison filter type "+g.type)}break;case"Logical":if(g.type===OpenLayers.Filter.Logical.AND){for(var e=0,d=g.filters.length;e<d;e++){l=this.write(g.filters[e],l)}}else{OpenLayers.Console.warn("Unsupported logical filter type "+g.type)}break;default:OpenLayers.Console.warn("Unknown filter type "+h)}return l},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})})();OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(d){var a=d.indexOf("<");if(a>0){d=d.substring(a)}var b=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var e;if(window.ActiveXObject&&!this.xmldom){e=new ActiveXObject("Microsoft.XMLDOM")}else{e=this.xmldom}e.loadXML(d);return e}),this),function(){return new DOMParser().parseFromString(d,"text/xml")},function(){var e=new XMLHttpRequest();e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),false);if(e.overrideMimeType){e.overrideMimeType("text/xml")}e.send(null);return e.responseXML});if(this.keepData){this.data=b}return b},write:function(b){var d;if(this.xmldom){d=b.xml}else{var a=new XMLSerializer();if(b.nodeType==1){var e=document.implementation.createDocument("","",null);if(e.importNode){b=e.importNode(b,true)}e.appendChild(b);d=a.serializeToString(e)}else{d=a.serializeToString(b)}}return d},createElementNS:function(d,a){var b;if(this.xmldom){if(typeof d=="string"){b=this.xmldom.createNode(1,a,d)}else{b=this.xmldom.createNode(1,a,"")}}else{b=document.createElementNS(d,a)}return b},createTextNode:function(b){var a;if(typeof b!=="string"){b=String(b)}if(this.xmldom){a=this.xmldom.createTextNode(b)}else{a=document.createTextNode(b)}return a},getElementsByTagNameNS:function(f,e,d){var a=[];if(f.getElementsByTagNameNS){a=f.getElementsByTagNameNS(e,d)}else{var b=f.getElementsByTagName("*");var l,g;for(var h=0,j=b.length;h<j;++h){l=b[h];g=(l.prefix)?(l.prefix+":"+d):d;if((d=="*")||(g==l.nodeName)){if((e=="*")||(e==l.namespaceURI)){a.push(l)}}}}return a},getAttributeNodeNS:function(d,b,a){var l=null;if(d.getAttributeNodeNS){l=d.getAttributeNodeNS(b,a)}else{var f=d.attributes;
var j,e;for(var g=0,h=f.length;g<h;++g){j=f[g];if(j.namespaceURI==b){e=(j.prefix)?(j.prefix+":"+a):a;if(e==j.nodeName){l=j;break}}}}return l},getAttributeNS:function(f,e,a){var b="";if(f.getAttributeNS){b=f.getAttributeNS(e,a)||""}else{var d=this.getAttributeNodeNS(f,e,a);if(d){b=d.nodeValue}}return b},getChildValue:function(a,d){var b=d||"";if(a){for(var e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 3:case 4:b+=e.nodeValue}}}return b},concatChildValues:function(b,e){var d="";var f=b.firstChild;var a;while(f){a=f.nodeValue;if(a){d+=a}f=f.nextSibling}if(d==""&&e!=undefined){d=e}return d},isSimpleContent:function(a){var d=true;for(var b=a.firstChild;b;b=b.nextSibling){if(b.nodeType===1){d=false;break}}return d},contentType:function(d){var f=false,b=false;var a=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var e=d.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:b=true;break;case 8:break;default:f=true}if(b&&f){break}}if(b&&f){a=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(b){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}else{if(f){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}}return a},hasAttributeNS:function(d,b,a){var e=false;if(d.hasAttributeNS){e=d.hasAttributeNS(b,a)}else{e=!!this.getAttributeNodeNS(d,b,a)}return e},setAttributeNS:function(e,d,a,f){if(e.setAttributeNS){e.setAttributeNS(d,a,f)}else{if(this.xmldom){if(d){var b=e.ownerDocument.createNode(2,a,d);b.nodeValue=f;e.setAttributeNode(b)}else{e.setAttribute(a,f)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(b,a){a=a||{};var e=a.uri||this.namespaces[a.prefix];if(!e){var g=b.indexOf(":");e=this.namespaces[b.substring(0,g)]}if(!e){e=this.namespaces[this.defaultPrefix]}var d=this.createElementNS(e,b);if(a.attributes){this.setAttributes(d,a.attributes)}var f=a.value;if(f!=null){d.appendChild(this.createTextNode(f))}return d},setAttributes:function(d,f){var e,b;for(var a in f){if(f[a]!=null&&f[a].toString){e=f[a].toString();b=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(d,b,a,e)}}},readNode:function(d,f){if(!f){f={}}var e=this.readers[d.namespaceURI?this.namespaceAlias[d.namespaceURI]:this.defaultPrefix];if(e){var b=d.localName||d.nodeName.split(":").pop();var a=e[b]||e["*"];if(a){a.apply(this,[d,f])}}return f},readChildNodes:function(e,f){if(!f){f={}}var d=e.childNodes;var g;for(var b=0,a=d.length;b<a;++b){g=d[b];if(g.nodeType==1){this.readNode(g,f)}}return f},writeNode:function(a,g,e){var f,d;var b=a.indexOf(":");if(b>0){f=a.substring(0,b);d=a.substring(b+1)}else{if(e){f=this.namespaceAlias[e.namespaceURI]}else{f=this.defaultPrefix}d=a}var h=this.writers[f][d].apply(this,[g]);if(e){e.appendChild(h)}return h},getChildEl:function(d,a,b){return d&&this.getThisOrNextEl(d.firstChild,a,b)},getNextEl:function(d,a,b){return d&&this.getThisOrNextEl(d.nextSibling,a,b)},getThisOrNextEl:function(e,a,d){outer:for(var b=e;b;b=b.nextSibling){switch(b.nodeType){case 1:if((!a||a===(b.localName||b.nodeName.split(":").pop()))&&(!d||d===b.namespaceURI)){break outer}b=null;break outer;case 3:if(/^\s*$/.test(b.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:b=null;break outer}}return b||null},lookupNamespaceURI:function(f,g){var e=null;if(f){if(f.lookupNamespaceURI){e=f.lookupNamespaceURI(g)}else{outer:switch(f.nodeType){case 1:if(f.namespaceURI!==null&&f.prefix===g){e=f.namespaceURI;break outer}var b=f.attributes.length;if(b){var a;for(var d=0;d<b;++d){a=f.attributes[d];if(a.prefix==="xmlns"&&a.name==="xmlns:"+g){e=a.value||null;break outer}else{if(a.name==="xmlns"&&g===null){e=a.value||null;break outer}}}}e=this.lookupNamespaceURI(f.parentNode,g);break outer;case 2:e=this.lookupNamespaceURI(f.ownerElement,g);break outer;case 9:e=this.lookupNamespaceURI(f.documentElement,g);break outer;case 6:case 12:case 10:case 11:break outer;default:e=this.lookupNamespaceURI(f.parentNode,g);break outer}}}return e},getXMLDoc:function(){if(!OpenLayers.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){OpenLayers.Format.XML.document=document.implementation.createDocument("","",null)
}else{if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}}}return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:false,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);var b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(b,d){var a;if(b){a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}}else{a=(d&&d.version)||this.version||this.defaultVersion}return a},getParser:function(a){a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var d=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!d){throw"Can't find a "+this.name+" parser for version "+a+b}this.parser=new d(this.options)}return this.parser},write:function(e,d){var b=this.getVersion(null,d);this.parser=this.getParser(b);var a=this.parser.write(e,d);if(this.stringifyOutput===false){return a}else{return OpenLayers.Format.XML.prototype.write.apply(this,[a])}},read:function(e,d){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var b=e.documentElement;var a=this.getVersion(b);this.parser=this.getParser(a);var g=this.parser.read(e,d);if(this.errorProperty!==null&&g[this.errorProperty]===undefined){var f=new OpenLayers.Format.OGCExceptionReport();g.error=f.read(e)}g.version=a;return g},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var f=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName);var d=[];for(var b=0;b<f.length;b++){var a=this.parseFeature(f[b]);if(a){d.push(a)}}return d},parseFeature:function(e){var f=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var u,j,v,d;for(var o=0;o<f.length;++o){u=f[o];j=this.getElementsByTagNameNS(e,this.gmlns,u);if(j.length>0){d=this.parseGeometry[u.toLowerCase()];if(d){v=d.apply(this,[j[0]]);if(this.internalProjection&&this.externalProjection){v.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:u}))}break}}var b;var m=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(o=0;o<m.length;++o){var r=m[o];var q=this.parseGeometry.box.apply(this,[r]);var p=r.parentNode;var h=p.localName||p.nodeName.split(":").pop();if(h==="boundedBy"){b=q}else{v=q.toGeometry()}}var l;if(this.extractAttributes){l=this.parseAttributes(e)}var w=new OpenLayers.Feature.Vector(v,l);w.bounds=b;w.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};var a=e.firstChild;var g;while(a){if(a.nodeType==1){g=a.getAttribute("fid")||a.getAttribute("id");if(g){break}}a=a.nextSibling}w.fid=g;return w},parseGeometry:{point:function(e){var b,a;var f=[];var b=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");f=a.split(this.regExes.splitSpace)}if(f.length==0){b=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");
if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.removeSpace,"");f=a.split(",")}}if(f.length==0){b=this.getElementsByTagNameNS(e,this.gmlns,"coord");if(b.length>0){var g=this.getElementsByTagNameNS(b[0],this.gmlns,"X");var d=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");if(g.length>0&&d.length>0){f=[g[0].firstChild.nodeValue,d[0].firstChild.nodeValue]}}}if(f.length==2){f[2]=null}if(this.xy){return new OpenLayers.Geometry.Point(f[0],f[1],f[2])}else{return new OpenLayers.Geometry.Point(f[1],f[0],f[2])}},multipoint:function(f){var b=this.getElementsByTagNameNS(f,this.gmlns,"Point");var e=[];if(b.length>0){var a;for(var d=0;d<b.length;++d){a=this.parseGeometry.point.apply(this,[b[d]]);if(a){e.push(a)}}}return new OpenLayers.Geometry.MultiPoint(e)},linestring:function(d,f){var e,b;var q=[];var r=[];e=this.getElementsByTagNameNS(d,this.gmlns,"posList");if(e.length>0){b=this.getChildValue(e[0]);b=b.replace(this.regExes.trimSpace,"");q=b.split(this.regExes.splitSpace);var l=parseInt(e[0].getAttribute("dimension"));var g,p,o,m;for(var h=0;h<q.length/l;++h){g=h*l;p=q[g];o=q[g+1];m=(l==2)?null:q[g+2];if(this.xy){r.push(new OpenLayers.Geometry.Point(p,o,m))}else{r.push(new OpenLayers.Geometry.Point(o,p,m))}}}if(q.length==0){e=this.getElementsByTagNameNS(d,this.gmlns,"coordinates");if(e.length>0){b=this.getChildValue(e[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);for(var h=0;h<a.length;++h){q=a[h].split(",");if(q.length==2){q[2]=null}if(this.xy){r.push(new OpenLayers.Geometry.Point(q[0],q[1],q[2]))}else{r.push(new OpenLayers.Geometry.Point(q[1],q[0],q[2]))}}}}var u=null;if(r.length!=0){if(f){u=new OpenLayers.Geometry.LinearRing(r)}else{u=new OpenLayers.Geometry.LineString(r)}}return u},multilinestring:function(f){var b=this.getElementsByTagNameNS(f,this.gmlns,"LineString");var e=[];if(b.length>0){var a;for(var d=0;d<b.length;++d){a=this.parseGeometry.linestring.apply(this,[b[d]]);if(a){e.push(a)}}}return new OpenLayers.Geometry.MultiLineString(e)},polygon:function(f){var b=this.getElementsByTagNameNS(f,this.gmlns,"LinearRing");var e=[];if(b.length>0){var a;for(var d=0;d<b.length;++d){a=this.parseGeometry.linestring.apply(this,[b[d],true]);if(a){e.push(a)}}}return new OpenLayers.Geometry.Polygon(e)},multipolygon:function(f){var a=this.getElementsByTagNameNS(f,this.gmlns,"Polygon");var e=[];if(a.length>0){var d;for(var b=0;b<a.length;++b){d=this.parseGeometry.polygon.apply(this,[a[b]]);if(d){e.push(d)}}}return new OpenLayers.Geometry.MultiPolygon(e)},envelope:function(b){var f=[];var a;var g;var m=this.getElementsByTagNameNS(b,this.gmlns,"lowerCorner");if(m.length>0){var j=[];if(m.length>0){a=m[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");j=a.split(this.regExes.splitSpace)}if(j.length==2){j[2]=null}if(this.xy){var e=new OpenLayers.Geometry.Point(j[0],j[1],j[2])}else{var e=new OpenLayers.Geometry.Point(j[1],j[0],j[2])}}var h=this.getElementsByTagNameNS(b,this.gmlns,"upperCorner");if(h.length>0){var j=[];if(h.length>0){a=h[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");j=a.split(this.regExes.splitSpace)}if(j.length==2){j[2]=null}if(this.xy){var l=new OpenLayers.Geometry.Point(j[0],j[1],j[2])}else{var l=new OpenLayers.Geometry.Point(j[1],j[0],j[2])}}if(e&&l){f.push(new OpenLayers.Geometry.Point(e.x,e.y));f.push(new OpenLayers.Geometry.Point(l.x,e.y));f.push(new OpenLayers.Geometry.Point(l.x,l.y));f.push(new OpenLayers.Geometry.Point(e.x,l.y));f.push(new OpenLayers.Geometry.Point(e.x,e.y));var d=new OpenLayers.Geometry.LinearRing(f);g=new OpenLayers.Geometry.Polygon([d])}return g},box:function(f){var d=this.getElementsByTagNameNS(f,this.gmlns,"coordinates");var b;var g,a=null,e=null;if(d.length>0){b=d[0].firstChild.nodeValue;g=b.split(" ");if(g.length==2){a=g[0].split(",");e=g[1].split(",")}}if(a!==null&&e!==null){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(e[0]),parseFloat(e[1]))}}},parseAttributes:function(f){var g={};var a=f.firstChild;var e,h,d,m,l,b,j;while(a){if(a.nodeType==1){e=a.childNodes;
for(h=0;h<e.length;++h){d=e[h];if(d.nodeType==1){m=d.childNodes;if(m.length==1){l=m[0];if(l.nodeType==3||l.nodeType==4){b=(d.prefix)?d.nodeName.split(":")[1]:d.nodeName;j=l.nodeValue.replace(this.regExes.trimSpace,"");g[b]=j}}else{g[d.nodeName.split(":").pop()]=null}}}break}a=a.nextSibling}return g},write:function(d){if(!(OpenLayers.Util.isArray(d))){d=[d]}var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var a=0;a<d.length;a++){b.appendChild(this.createFeatureXML(d[a]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(m){var j=m.geometry;var f=this.buildGeometryNode(j);var l=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);l.appendChild(f);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName);var o=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var d=m.fid||m.id;o.setAttribute("fid",d);o.appendChild(l);for(var h in m.attributes){var g=this.createTextNode(m.attributes[h]);var e=h.substring(h.lastIndexOf(":")+1);var b=this.createElementNS(this.featureNS,this.featurePrefix+":"+e);b.appendChild(g);o.appendChild(b)}a.appendChild(o);return a},buildGeometryNode:function(e){if(this.externalProjection&&this.internalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var d=e.CLASS_NAME;var b=d.substring(d.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];return a.apply(this,[e])},buildGeometry:{point:function(b){var a=this.createElementNS(this.gmlns,"gml:Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(g){var e=this.createElementNS(this.gmlns,"gml:MultiPoint");var d=g.components;var b,f;for(var a=0;a<d.length;a++){b=this.createElementNS(this.gmlns,"gml:pointMember");f=this.buildGeometry.point.apply(this,[d[a]]);b.appendChild(f);e.appendChild(b)}return e},linestring:function(b){var a=this.createElementNS(this.gmlns,"gml:LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(g){var e=this.createElementNS(this.gmlns,"gml:MultiLineString");var a=g.components;var d,f;for(var b=0;b<a.length;++b){d=this.createElementNS(this.gmlns,"gml:lineStringMember");f=this.buildGeometry.linestring.apply(this,[a[b]]);d.appendChild(f);e.appendChild(d)}return e},linearring:function(b){var a=this.createElementNS(this.gmlns,"gml:LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(h){var e=this.createElementNS(this.gmlns,"gml:Polygon");var g=h.components;var d,f,b;for(var a=0;a<g.length;++a){b=(a==0)?"outerBoundaryIs":"innerBoundaryIs";d=this.createElementNS(this.gmlns,"gml:"+b);f=this.buildGeometry.linearring.apply(this,[g[a]]);d.appendChild(f);e.appendChild(d)}return e},multipolygon:function(g){var e=this.createElementNS(this.gmlns,"gml:MultiPolygon");var a=g.components;var f,b;for(var d=0;d<a.length;++d){f=this.createElementNS(this.gmlns,"gml:polygonMember");b=this.buildGeometry.polygon.apply(this,[a[d]]);f.appendChild(b);e.appendChild(f)}return e},bounds:function(b){var a=this.createElementNS(this.gmlns,"gml:Box");a.appendChild(this.buildCoordinatesNode(b));return a}},buildCoordinatesNode:function(g){var a=this.createElementNS(this.gmlns,"gml:coordinates");a.setAttribute("decimal",".");a.setAttribute("cs",",");a.setAttribute("ts"," ");var f=[];if(g instanceof OpenLayers.Bounds){f.push(g.left+","+g.bottom);f.push(g.right+","+g.top)}else{var d=(g.components)?g.components:[g];for(var b=0;b<d.length;b++){f.push(d[b].x+","+d[b].y)}}var e=this.createTextNode(f.join(" "));a.appendChild(e);return a},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),featureMember:(/^(.*:)?featureMembers?$/)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);
this.setGeometryTypes();if(a&&a.featureNS){this.setNamespace("feature",a.featureNS)}this.singleFeatureType=!a||(typeof a.featureType==="string")},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f])}if(f&&f.nodeType==9){f=f.documentElement}var d=[];this.readNode(f,{features:d},true);if(d.length==0){var e=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember");if(e.length){for(var b=0,a=e.length;b<a;++b){this.readNode(e[b],{features:d},true)}}else{var e=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMembers");if(e.length){this.readNode(e[0],{features:d},true)}}}return d},readNode:function(a,b,d){if(d===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&(!(a.prefix in this.namespaces)&&a.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(a.parentNode.nodeName))){this.featureType=a.nodeName.split(":").pop();this.setNamespace("feature",a.namespaceURI);this.featureNS=a.namespaceURI;this.autoConfig=true}return OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(b,d){var a={};this.readChildNodes(b,a);if(a.components&&a.components.length>0){d.bounds=a.components[0]}},Point:function(b,a){var d={points:[]};this.readChildNodes(b,d);if(!a.components){a.components=[]}a.components.push(d.points[0])},coordinates:function(f,h){var j=this.getChildValue(f).replace(this.regExes.trimSpace,"");j=j.replace(this.regExes.trimComma,",");var a=j.split(this.regExes.splitSpace);var g;var e=a.length;var d=new Array(e);for(var b=0;b<e;++b){g=a[b].split(",");if(this.xy){d[b]=new OpenLayers.Geometry.Point(g[0],g[1],g[2])}else{d[b]=new OpenLayers.Geometry.Point(g[1],g[0],g[2])}}h.points=d},coord:function(a,b){var d={};this.readChildNodes(a,d);if(!b.points){b.points=[]}b.points.push(new OpenLayers.Geometry.Point(d.x,d.y,d.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.MultiPoint(d.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(b,a){var d={};this.readChildNodes(b,d);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(d.points))},MultiLineString:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.MultiLineString(d.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(b,a){var d={outer:null,inner:[]};this.readChildNodes(b,d);d.inner.unshift(d.outer);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.Polygon(d.inner))},LinearRing:function(b,d){var a={};this.readChildNodes(b,a);d.components=[new OpenLayers.Geometry.LinearRing(a.points)]},MultiPolygon:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.MultiPolygon(d.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(b,a){var d={components:[]};this.readChildNodes(b,d);a.components=[new OpenLayers.Geometry.Collection(d.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(d,e){var a;var b=d.localName||d.nodeName.split(":").pop();if(e.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,b)!==-1)){a="_typeName"}else{if(b===this.featureType){a="_typeName"}}}else{if(d.childNodes.length==0||(d.childNodes.length==1&&d.firstChild.nodeType==3)){if(this.extractAttributes){a="_attribute"}}else{a="_geometry"}}if(a){this.readers.feature[a].apply(this,[d,e])}},_typeName:function(d,e){var a={components:[],attributes:{}};this.readChildNodes(d,a);if(a.name){a.attributes.name=a.name}var b=new OpenLayers.Feature.Vector(a.components[0],a.attributes);
if(!this.singleFeatureType){b.type=d.nodeName.split(":").pop();b.namespace=d.namespaceURI}var f=d.getAttribute("fid")||this.getAttributeNS(d,this.namespaces.gml,"id");if(f){b.fid=f}if(this.internalProjection&&this.externalProjection&&b.geometry){b.geometry.transform(this.externalProjection,this.internalProjection)}if(a.bounds){b.bounds=a.bounds}e.features.push(b)},_geometry:function(a,b){if(!this.geometryName){this.geometryName=a.nodeName.split(":").pop()}this.readChildNodes(a,b)},_attribute:function(b,e){var a=b.localName||b.nodeName.split(":").pop();var d=this.getChildValue(b);e.attributes[a]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(d){var b;if(OpenLayers.Util.isArray(d)){b="featureMembers"}else{b="featureMember"}var a=this.writeNode("gml:"+b,d);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b},MultiPoint:function(f){var e=this.createElementNSPlus("gml:MultiPoint");var d=f.components||[f];for(var a=0,b=d.length;a<b;++a){this.writeNode("pointMember",d[a],e)}return e},pointMember:function(b){var a=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",b,a);return a},MultiLineString:function(f){var e=this.createElementNSPlus("gml:MultiLineString");var d=f.components||[f];for(var a=0,b=d.length;a<b;++a){this.writeNode("lineStringMember",d[a],e)}return e},lineStringMember:function(b){var a=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",b,a);return a},MultiPolygon:function(f){var e=this.createElementNSPlus("gml:MultiPolygon");var d=f.components||[f];for(var a=0,b=d.length;a<b;++a){this.writeNode("polygonMember",d[a],e)}return e},polygonMember:function(b){var a=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",b,a);return a},GeometryCollection:function(e){var d=this.createElementNSPlus("gml:GeometryCollection");for(var b=0,a=e.components.length;b<a;++b){this.writeNode("geometryMember",e.components[b],d)}return d},geometryMember:function(b){var a=this.createElementNSPlus("gml:geometryMember");var d=this.writeNode("feature:_geometry",b);a.appendChild(d.firstChild);return a}},feature:{_typeName:function(b){var d=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:b.fid}});if(b.geometry){this.writeNode("feature:_geometry",b.geometry,d)}for(var a in b.attributes){var e=b.attributes[a];if(e!=null){this.writeNode("feature:_attribute",{name:a,value:e},d)}}return d},_geometry:function(d){if(this.externalProjection&&this.internalProjection){d=d.clone().transform(this.internalProjection,this.externalProjection)}var b=this.createElementNSPlus("feature:"+this.geometryName);var a=this.geometryTypes[d.CLASS_NAME];var e=this.writeNode("gml:"+a,d,b);if(this.srsName){e.setAttribute("srsName",this.srsName)}return b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(d){var e=this.createElementNSPlus("wfs:FeatureCollection");for(var b=0,a=d.length;b<a;++b){this.writeNode("gml:featureMember",d[b],e)}return e}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(b,a){var d={};this.readChildNodes(b,d);a.outer=d.components[0]},innerBoundaryIs:function(b,a){var d={};
this.readChildNodes(b,d);a.inner.push(d.components[0])},Box:function(e,b){var f={};this.readChildNodes(e,f);if(!b.components){b.components=[]}var d=f.points[0];var a=f.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(d){var b;if(OpenLayers.Util.isArray(d)){b="wfs:FeatureCollection"}else{b="gml:featureMember"}var a=this.writeNode(b,d);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[b],a);return a},coordinates:function(e){var d=e.length;var f=new Array(d);var a;for(var b=0;b<d;++b){a=e[b];if(this.xy){f[b]=a.x+","+a.y}else{f[b]=a.y+","+a.x}if(a.z!=undefined){f[b]+=","+a.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(d==1)?f[0]:f.join(" ")})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",b.components,a);return a},Polygon:function(d){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",d.components[0],b);for(var a=1;a<d.components.length;++a){this.writeNode("innerBoundaryIs",d.components[a],b)}return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b},Box:function(b){var a=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:b.left,y:b.bottom},{x:b.right,y:b.top}],a);if(this.srsName){a.setAttribute("srsName",this.srsName)}return a}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(b,a){var d={points:[]};this.readChildNodes(b,d);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(d.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(b,a){var d={};this.readChildNodes(b,d);if(d.points){Array.prototype.push.apply(a.points,d.points)}},pos:function(b,e){var f=this.getChildValue(b).replace(this.regExes.trimSpace,"");var d=f.split(this.regExes.splitSpace);var a;if(this.xy){a=new OpenLayers.Geometry.Point(d[0],d[1],d[2])}else{a=new OpenLayers.Geometry.Point(d[1],d[0],d[2])}e.points=[a]},posList:function(a,e){var l=this.getChildValue(a).replace(this.regExes.trimSpace,"");var p=l.split(this.regExes.splitSpace);var f=parseInt(a.getAttribute("dimension"))||2;var b,q,o,h;var m=p.length/f;var r=new Array(m);for(var d=0,g=p.length;d<g;d+=f){q=p[d];o=p[d+1];h=(f==2)?undefined:p[d+2];if(this.xy){r[d/f]=new OpenLayers.Geometry.Point(q,o,h)}else{r[d/f]=new OpenLayers.Geometry.Point(o,q,h)}}e.points=r},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(b,a){var d={};this.readChildNodes(b,d);a.outer=d.components[0]},interior:function(b,a){var d={};this.readChildNodes(b,d);a.inner.push(d.components[0])},MultiCurve:function(b,a){var d={components:[]};this.readChildNodes(b,d);
if(d.components.length>0){a.components=[new OpenLayers.Geometry.MultiLineString(d.components)]}},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(b,a){var d={components:[]};this.readChildNodes(b,d);if(d.components.length>0){a.components=[new OpenLayers.Geometry.MultiPolygon(d.components)]}},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(e,b){var f={points:new Array(2)};this.readChildNodes(e,f);if(!b.components){b.components=[]}var d=f.points[0];var a=f.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,a.x,a.y))},lowerCorner:function(b,a){var d={};this.readers.gml.pos.apply(this,[b,d]);a.points[0]=d.points[0]},upperCorner:function(b,a){var d={};this.readers.gml.pos.apply(this,[b,d]);a.points[1]=d.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(d){var b;if(OpenLayers.Util.isArray(d)){b="featureMembers"}else{b="featureMember"}var a=this.writeNode("gml:"+b,d);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(d){var e=this.createElementNSPlus("gml:featureMembers");for(var b=0,a=d.length;b<a;++b){this.writeNode("feature:_typeName",d[b],e)}return e},Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("pos",b,a);return a},pos:function(a){var b=(this.xy)?(a.x+" "+a.y):(a.y+" "+a.x);return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("posList",b.components,a);return a},Curve:function(b){var a=this.createElementNSPlus("gml:Curve");this.writeNode("segments",b,a);return a},segments:function(b){var a=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",b,a);return a},LineStringSegment:function(b){var a=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",b.components,a);return a},posList:function(e){var b=e.length;var f=new Array(b);var a;for(var d=0;d<b;++d){a=e[d];if(this.xy){f[d]=a.x+" "+a.y}else{f[d]=a.y+" "+a.x}}return this.createElementNSPlus("gml:posList",{value:f.join(" ")})},Surface:function(b){var a=this.createElementNSPlus("gml:Surface");this.writeNode("patches",b,a);return a},patches:function(b){var a=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",b,a);return a},PolygonPatch:function(e){var d=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],d);for(var b=1,a=e.components.length;b<a;++b){this.writeNode("interior",e.components[b],d)}return d},Polygon:function(e){var d=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],d);for(var b=1,a=e.components.length;b<a;++b){this.writeNode("interior",e.components[b],d)}return d},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b},MultiCurve:function(f){var e=this.createElementNSPlus("gml:MultiCurve");var d=f.components||[f];for(var b=0,a=d.length;b<a;++b){this.writeNode("curveMember",d[b],e)}return e},curveMember:function(b){var a=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",b,a)}else{this.writeNode("LineString",b,a)}return a},MultiSurface:function(f){var e=this.createElementNSPlus("gml:MultiSurface");var d=f.components||[f];for(var b=0,a=d.length;b<a;
++b){this.writeNode("surfaceMember",d[b],e)}return e},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",a,b)}else{this.writeNode("Polygon",a,b)}return b},Envelope:function(b){var a=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",b,a);this.writeNode("upperCorner",b,a);if(this.srsName){a.setAttribute("srsName",this.srsName)}return a},lowerCorner:function(a){var b=(this.xy)?(a.left+" "+a.bottom):(a.bottom+" "+a.left);return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=(this.xy)?(a.right+" "+a.top):(a.top+" "+a.right);return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:false,read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}return this.parseFeatures(a)},write:function(d){var e;if(OpenLayers.Util.isArray(d)){e=this.createElementNSPlus("atom:feed");e.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var a=0,b=d.length;a<b;a++){e.appendChild(this.buildEntryNode(d[a]))}}else{e=this.buildEntryNode(d)}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},buildContentNode:function(b){var a=this.createElementNSPlus("atom:content",{attributes:{type:b.type||null}});if(b.src){a.setAttribute("src",b.src)}else{if(b.type=="text"||b.type==null){a.appendChild(this.createTextNode(b.value))}else{if(b.type=="html"){if(typeof b.value!="string"){throw"HTML content must be in form of an escaped string"}a.appendChild(this.createTextNode(b.value))}else{if(b.type=="xhtml"){a.appendChild(b.value)}else{if(b.type=="xhtml"||b.type.match(/(\+|\/)xml$/)){a.appendChild(b.value)}else{a.appendChild(this.createTextNode(b.value))}}}}}return a},buildEntryNode:function(q){var d=q.attributes;var l=d.atom||{};var m=this.createElementNSPlus("atom:entry");if(l.authors){var j=OpenLayers.Util.isArray(l.authors)?l.authors:[l.authors];for(var e=0,p=j.length;e<p;e++){m.appendChild(this.buildPersonConstructNode("author",j[e]))}}if(l.categories){var f=OpenLayers.Util.isArray(l.categories)?l.categories:[l.categories];var a;for(var e=0,p=f.length;e<p;e++){a=f[e];m.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:a.term,scheme:a.scheme||null,label:a.label||null}}))}}if(l.content){m.appendChild(this.buildContentNode(l.content))}if(l.contributors){var g=OpenLayers.Util.isArray(l.contributors)?l.contributors:[l.contributors];for(var e=0,p=g.length;e<p;e++){m.appendChild(this.buildPersonConstructNode("contributor",g[e]))}}if(q.fid){m.appendChild(this.createElementNSPlus("atom:id",{value:q.fid}))}if(l.links){var o=OpenLayers.Util.isArray(l.links)?l.links:[l.links];var h;for(var e=0,p=o.length;e<p;e++){h=o[e];m.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:h.href,rel:h.rel||null,type:h.type||null,hreflang:h.hreflang||null,title:h.title||null,length:h.length||null}}))}}if(l.published){m.appendChild(this.createElementNSPlus("atom:published",{value:l.published}))}if(l.rights){m.appendChild(this.createElementNSPlus("atom:rights",{value:l.rights}))}if(l.summary||d.description){m.appendChild(this.createElementNSPlus("atom:summary",{value:l.summary||d.description}))
}m.appendChild(this.createElementNSPlus("atom:title",{value:l.title||d.title||this.defaultEntryTitle}));if(l.updated){m.appendChild(this.createElementNSPlus("atom:updated",{value:l.updated}))}if(q.geometry){var b=this.createElementNSPlus("georss:where");b.appendChild(this.buildGeometryNode(q.geometry));m.appendChild(b)}return m},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(b){if(!this.gmlParser){this.initGmlParser()}var a=this.gmlParser.writeNode("feature:_geometry",b);return a.firstChild},buildPersonConstructNode:function(b,g){var e=["uri","email"];var a=this.createElementNSPlus("atom:"+b);a.appendChild(this.createElementNSPlus("atom:name",{value:g.name}));for(var d=0,f=e.length;d<f;d++){if(g[e[d]]){a.appendChild(this.createElementNSPlus("atom:"+e[d],{value:g[e[d]]}))}}return a},getFirstChildValue:function(e,b,d,g){var f;var a=this.getElementsByTagNameNS(e,b,d);if(a&&a.length>0){f=this.getChildValue(a[0],g)}else{f=g}return f},parseFeature:function(e){var p={};var q=null;var a=null;var m=null;var b=this.namespaces.atom;this.parsePersonConstructs(e,"author",p);a=this.getElementsByTagNameNS(e,b,"category");if(a.length>0){p.categories=[]}for(var h=0,r=a.length;h<r;h++){q={};q.term=a[h].getAttribute("term");m=a[h].getAttribute("scheme");if(m){q.scheme=m}m=a[h].getAttribute("label");if(m){q.label=m}p.categories.push(q)}a=this.getElementsByTagNameNS(e,b,"content");if(a.length>0){q={};m=a[0].getAttribute("type");if(m){q.type=m}m=a[0].getAttribute("src");if(m){q.src=m}else{if(q.type=="text"||q.type=="html"||q.type==null){q.value=this.getFirstChildValue(e,b,"content",null)}else{if(q.type=="xhtml"||q.type.match(/(\+|\/)xml$/)){q.value=this.getChildEl(a[0])}else{q.value=this.getFirstChildValue(e,b,"content",null)}}p.content=q}}this.parsePersonConstructs(e,"contributor",p);p.id=this.getFirstChildValue(e,b,"id",null);a=this.getElementsByTagNameNS(e,b,"link");if(a.length>0){p.links=new Array(a.length)}var d=["rel","type","hreflang","title","length"];for(var h=0,r=a.length;h<r;h++){q={};q.href=a[h].getAttribute("href");for(var f=0,l=d.length;f<l;f++){m=a[h].getAttribute(d[f]);if(m){q[d[f]]=m}}p.links[h]=q}q=this.getFirstChildValue(e,b,"published",null);if(q){p.published=q}q=this.getFirstChildValue(e,b,"rights",null);if(q){p.rights=q}q=this.getFirstChildValue(e,b,"summary",null);if(q){p.summary=q}p.title=this.getFirstChildValue(e,b,"title",null);p.updated=this.getFirstChildValue(e,b,"updated",null);var g={title:p.title,description:p.summary,atom:p};var o=this.parseLocations(e)[0];var u=new OpenLayers.Feature.Vector(o,g);u.fid=p.id;return u},parseFeatures:function(f){var e=[];var a=this.getElementsByTagNameNS(f,this.namespaces.atom,"entry");if(a.length==0){a=[f]}for(var b=0,d=a.length;b<d;b++){e.push(this.parseFeature(a[b]))}return e},parseLocations:function(d){var a=this.namespaces.georss;var m={components:[]};var g=this.getElementsByTagNameNS(d,a,"where");if(g&&g.length>0){if(!this.gmlParser){this.initGmlParser()}for(var f=0,v=g.length;f<v;f++){this.gmlParser.readChildNodes(g[f],m)}}var l=m.components;var r=this.getElementsByTagNameNS(d,a,"point");if(r&&r.length>0){for(var f=0,v=r.length;f<v;f++){var z=OpenLayers.String.trim(r[f].firstChild.nodeValue).split(/\s+/);if(z.length!=2){z=OpenLayers.String.trim(r[f].firstChild.nodeValue).split(/\s*,\s*/)}l.push(new OpenLayers.Geometry.Point(parseFloat(z[1]),parseFloat(z[0])))}}var w=this.getElementsByTagNameNS(d,a,"line");if(w&&w.length>0){var q;var b;var u;for(var f=0,v=w.length;f<v;f++){q=OpenLayers.String.trim(w[f].firstChild.nodeValue).split(/\s+/);u=[];for(var e=0,h=q.length;e<h;e+=2){b=new OpenLayers.Geometry.Point(parseFloat(q[e+1]),parseFloat(q[e]));u.push(b)}l.push(new OpenLayers.Geometry.LineString(u))}}var o=this.getElementsByTagNameNS(d,a,"polygon");if(o&&o.length>0){var q;var b;var u;for(var f=0,v=o.length;f<v;f++){q=OpenLayers.String.trim(o[f].firstChild.nodeValue).split(/\s+/);u=[];for(var e=0,h=q.length;
e<h;e+=2){b=new OpenLayers.Geometry.Point(parseFloat(q[e+1]),parseFloat(q[e]));u.push(b)}l.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)]))}}if(this.internalProjection&&this.externalProjection){for(var f=0,v=l.length;f<v;f++){if(l[f]){l[f].transform(this.externalProjection,this.internalProjection)}}}return l},parsePersonConstructs:function(e,a,h){var p=[];var d=this.namespaces.atom;var b=this.getElementsByTagNameNS(e,d,a);var f=["uri","email"];for(var l=0,r=b.length;l<r;l++){var q={};q.name=this.getFirstChildValue(b[l],d,"name",null);for(var g=0,m=f.length;g<m;g++){var o=this.getFirstChildValue(b[l],d,f[g],null);if(o){q[f[g]]=o}}p.push(q)}if(p.length>0){h[a+"s"]=p}},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,extractStyles:false,extractTracks:false,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){this.features=[];this.styles={};this.fetched={};var a={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(b,a)},parseData:function(h,d){if(typeof h=="string"){h=OpenLayers.Format.XML.prototype.read.apply(this,[h])}var f=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var e=0,a=f.length;e<a;++e){var g=f[e];var b=this.getElementsByTagNameNS(h,"*",g);if(b.length==0){continue}switch(g.toLowerCase()){case"link":case"networklink":this.parseLinks(b,d);break;case"style":if(this.extractStyles){this.parseStyles(b,d)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(b,d)}break;case"placemark":this.parseFeatures(b,d);break}}return this.features},parseLinks:function(d,e){if(e.depth>=this.maxDepth){return false}var h=OpenLayers.Util.extend({},e);h.depth++;for(var f=0,a=d.length;f<a;f++){var b=this.parseProperty(d[f],"*","href");if(b&&!this.fetched[b]){this.fetched[b]=true;var g=this.fetchLink(b);if(g){this.parseData(g,h)}}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:false});if(b){return b.responseText}},parseStyles:function(b,d){for(var f=0,a=b.length;f<a;f++){var g=this.parseStyle(b[f]);if(g){var e=(d.styleBaseUrl||"")+"#"+g.id;this.styles[e]=g}}},parseKmlColor:function(b){var a=null;if(b){var d=b.match(this.regExes.kmlColor);if(d){a={color:"#"+d[4]+d[3]+d[2],opacity:parseInt(d[1],16)/255}}}return a},parseStyle:function(G){var O={};var z=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"];var f,o,R,j,e;for(var L=0,N=z.length;L<N;++L){f=z[L];o=this.getElementsByTagNameNS(G,"*",f)[0];if(!o){continue}switch(f.toLowerCase()){case"linestyle":var d=this.parseProperty(o,"*","color");var I=this.parseKmlColor(d);if(I){O.strokeColor=I.color;O.strokeOpacity=I.opacity}var F=this.parseProperty(o,"*","width");if(F){O.strokeWidth=F}break;case"polystyle":var d=this.parseProperty(o,"*","color");var I=this.parseKmlColor(d);if(I){O.fillOpacity=I.opacity;O.fillColor=I.color}var J=this.parseProperty(o,"*","fill");if(J=="0"){O.fillColor="none"}var l=this.parseProperty(o,"*","outline");if(l=="0"){O.strokeWidth="0"}break;case"iconstyle":var T=parseFloat(this.parseProperty(o,"*","scale")||1);var F=32*T;var D=32*T;var S=this.getElementsByTagNameNS(o,"*","Icon")[0];if(S){var K=this.parseProperty(S,"*","href");if(K){var v=this.parseProperty(S,"*","w");var M=this.parseProperty(S,"*","h");var g="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(K,g)&&!v&&!M){v=64;M=64;T=T/2}v=v||M;M=M||v;if(v){F=parseInt(v)*T
}if(M){D=parseInt(M)*T}var b=K.match(this.regExes.kmlIconPalette);if(b){var P=b[1];var C=b[2];var u=this.parseProperty(S,"*","x");var r=this.parseProperty(S,"*","y");var q=u?u/32:0;var p=r?(7-r/32):7;var m=p*8+q;K="http://maps.google.com/mapfiles/kml/pal"+P+"/icon"+m+C}O.graphicOpacity=1;O.externalGraphic=K}}var B=this.getElementsByTagNameNS(o,"*","hotSpot")[0];if(B){var u=parseFloat(B.getAttribute("x"));var r=parseFloat(B.getAttribute("y"));var H=B.getAttribute("xunits");if(H=="pixels"){O.graphicXOffset=-u*T}else{if(H=="insetPixels"){O.graphicXOffset=-F+(u*T)}else{if(H=="fraction"){O.graphicXOffset=-F*u}}}var Q=B.getAttribute("yunits");if(Q=="pixels"){O.graphicYOffset=-D+(r*T)+1}else{if(Q=="insetPixels"){O.graphicYOffset=-(r*T)+1}else{if(Q=="fraction"){O.graphicYOffset=-D*(1-r)+1}}}}O.graphicWidth=F;O.graphicHeight=D;break;case"balloonstyle":var a=OpenLayers.Util.getXmlNodeValue(o);if(a){O.balloonStyle=a.replace(this.regExes.straightBracket,"${$1}")}break;case"labelstyle":var d=this.parseProperty(o,"*","color");var I=this.parseKmlColor(d);if(I){O.fontColor=I.color;O.fontOpacity=I.opacity}break;default:}}if(!O.strokeColor&&O.fillColor){O.strokeColor=O.fillColor}var E=G.getAttribute("id");if(E&&O){O.id=E}return O},parseStyleMaps:function(a,q){for(var h=0,l=a.length;h<l;h++){var e=a[h];var d=this.getElementsByTagNameNS(e,"*","Pair");var b=e.getAttribute("id");for(var g=0,p=d.length;g<p;g++){var f=d[g];var o=this.parseProperty(f,"*","key");var m=this.parseProperty(f,"*","styleUrl");if(m&&o=="normal"){this.styles[(q.styleBaseUrl||"")+"#"+b]=this.styles[(q.styleBaseUrl||"")+m]}if(m&&o=="highlight"){}}}},parseFeatures:function(b,p){var g=[];for(var h=0,j=b.length;h<j;h++){var d=b[h];var o=this.parseFeature.apply(this,[d]);if(o){if(this.extractStyles&&o.attributes&&o.attributes.styleUrl){o.style=this.getStyle(o.attributes.styleUrl,p)}if(this.extractStyles){var m=this.getElementsByTagNameNS(d,"*","Style")[0];if(m){var f=this.parseStyle(m);if(f){o.style=OpenLayers.Util.extend(o.style,f)}}}if(this.extractTracks){var l=this.getElementsByTagNameNS(d,this.namespaces.gx,"Track");if(l&&l.length>0){var e=l[0];var a={features:[],feature:o};this.readNode(e,a);if(a.features.length>0){g.push.apply(g,a.features)}}}else{g.push(o)}}else{throw"Bad Placemark: "+h}}this.features=this.features.concat(g)},readers:{kml:{when:function(b,a){a.whens.push(OpenLayers.Date.parse(this.getChildValue(b)))},_trackPointAttribute:function(d,a){var b=d.nodeName.split(":").pop();a.attributes[b].push(this.getChildValue(d))}},gx:{Track:function(d,b){var f={whens:[],points:[],angles:[]};if(this.trackAttributes){var a;f.attributes={};for(var g=0,p=this.trackAttributes.length;g<p;++g){a=this.trackAttributes[g];f.attributes[a]=[];if(!(a in this.readers.kml)){this.readers.kml[a]=this.readers.kml._trackPointAttribute}}}this.readChildNodes(d,f);if(f.whens.length!==f.points.length){throw new Error("gx:Track with unequal number of when ("+f.whens.length+") and gx:coord ("+f.points.length+") elements.")}var m=f.angles.length>0;if(m&&f.whens.length!==f.angles.length){throw new Error("gx:Track with unequal number of when ("+f.whens.length+") and gx:angles ("+f.angles.length+") elements.")}var q,o,l;for(var g=0,p=f.whens.length;g<p;++g){q=b.feature.clone();q.fid=b.feature.fid||b.feature.id;o=f.points[g];q.geometry=o;if("z" in o){q.attributes.altitude=o.z}if(this.internalProjection&&this.externalProjection){q.geometry.transform(this.externalProjection,this.internalProjection)}if(this.trackAttributes){for(var e=0,h=this.trackAttributes.length;e<h;++e){q.attributes[a]=f.attributes[this.trackAttributes[e]][g]}}q.attributes.when=f.whens[g];q.attributes.trackId=b.feature.id;if(m){l=f.angles[g];q.attributes.heading=parseFloat(l[0]);q.attributes.tilt=parseFloat(l[1]);q.attributes.roll=parseFloat(l[2])}b.features.push(q)}},coord:function(d,b){var f=this.getChildValue(d);var e=f.replace(this.regExes.trimSpace,"").split(/\s+/);var a=new OpenLayers.Geometry.Point(e[0],e[1]);if(e.length>2){a.z=parseFloat(e[2])}b.points.push(a)},angles:function(b,a){var e=this.getChildValue(b);var d=e.replace(this.regExes.trimSpace,"").split(/\s+/);
a.angles.push(d)}}},parseFeature:function(b){var d=["MultiGeometry","Polygon","LineString","Point"];var l,f,m,a;for(var h=0,j=d.length;h<j;++h){l=d[h];this.internalns=b.namespaceURI?b.namespaceURI:this.kmlns;f=this.getElementsByTagNameNS(b,this.internalns,l);if(f.length>0){var a=this.parseGeometry[l.toLowerCase()];if(a){m=a.apply(this,[f[0]]);if(this.internalProjection&&this.externalProjection){m.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:l}))}break}}var g;if(this.extractAttributes){g=this.parseAttributes(b)}var o=new OpenLayers.Feature.Vector(m,g);var e=b.getAttribute("id")||b.getAttribute("name");if(e!=null){o.fid=e}return o},getStyle:function(b,a){var d=OpenLayers.Util.removeTail(b);var g=OpenLayers.Util.extend({},a);g.depth++;g.styleBaseUrl=d;if(!this.styles[b]&&!OpenLayers.String.startsWith(b,"#")&&g.depth<=this.maxDepth&&!this.fetched[d]){var f=this.fetchLink(d);if(f){this.parseData(f,g)}}var e=OpenLayers.Util.extend({},this.styles[b]);return e},parseGeometry:{point:function(e){var d=this.getElementsByTagNameNS(e,this.internalns,"coordinates");var f=[];if(d.length>0){var b=d[0].firstChild.nodeValue;b=b.replace(this.regExes.removeSpace,"");f=b.split(",")}var a=null;if(f.length>1){if(f.length==2){f[2]=null}a=new OpenLayers.Geometry.Point(f[0],f[1],f[2])}else{throw"Bad coordinate string: "+b}return a},linestring:function(d,f){var e=this.getElementsByTagNameNS(d,this.internalns,"coordinates");var o=null;if(e.length>0){var b=this.getChildValue(e[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);var j=a.length;var m=new Array(j);var l,h;for(var g=0;g<j;++g){l=a[g].split(",");h=l.length;if(h>1){if(l.length==2){l[2]=null}m[g]=new OpenLayers.Geometry.Point(l[0],l[1],l[2])}else{throw"Bad LineString point coordinates: "+a[g]}}if(j){if(f){o=new OpenLayers.Geometry.LinearRing(m)}else{o=new OpenLayers.Geometry.LineString(m)}}else{throw"Bad LineString coordinates: "+b}}return o},polygon:function(g){var d=this.getElementsByTagNameNS(g,this.internalns,"LinearRing");var h=d.length;var f=new Array(h);if(h>0){var b;for(var e=0,a=d.length;e<a;++e){b=this.parseGeometry.linestring.apply(this,[d[e],true]);if(b){f[e]=b}else{throw"Bad LinearRing geometry: "+e}}}return new OpenLayers.Geometry.Polygon(f)},multigeometry:function(f){var j,h;var g=[];var d=f.childNodes;for(var b=0,a=d.length;b<a;++b){j=d[b];if(j.nodeType==1){var e=(j.prefix)?j.nodeName.split(":")[1]:j.nodeName;var h=this.parseGeometry[e.toLowerCase()];if(h){g.push(h.apply(this,[j]))}}}return new OpenLayers.Geometry.Collection(g)}},parseAttributes:function(e){var g={};var j=e.getElementsByTagName("ExtendedData");if(j.length){g=this.parseExtendedData(j[0])}var b,q,p;var d=e.childNodes;for(var l=0,m=d.length;l<m;++l){b=d[l];if(b.nodeType==1){q=b.childNodes;if(q.length>=1&&q.length<=3){var p;switch(q.length){case 1:p=q[0];break;case 2:var h=q[0];var f=q[1];p=(h.nodeType==3||h.nodeType==4)?h:f;break;case 3:default:p=q[1];break}if(p.nodeType==3||p.nodeType==4){var a=(b.prefix)?b.nodeName.split(":")[1]:b.nodeName;var o=OpenLayers.Util.getXmlNodeValue(p);if(o){o=o.replace(this.regExes.trimSpace,"");g[a]=o}}}}}return g},parseExtendedData:function(b){var e={};var g,j,f,m;var d=b.getElementsByTagName("Data");for(g=0,j=d.length;g<j;g++){f=d[g];m=f.getAttribute("name");var h={};var o=f.getElementsByTagName("value");if(o.length){h.value=this.getChildValue(o[0])}var a=f.getElementsByTagName("displayName");if(a.length){h.displayName=this.getChildValue(a[0])}e[m]=h}var l=b.getElementsByTagName("SimpleData");for(g=0,j=l.length;g<j;g++){var h={};f=l[g];m=f.getAttribute("name");h.value=this.getChildValue(f);h.displayName=m;e[m]=h}return e},parseProperty:function(d,f,b){var g;var a=this.getElementsByTagNameNS(d,f,b);try{g=OpenLayers.Util.getXmlNodeValue(a[0])}catch(h){g=null}return g},write:function(e){if(!(OpenLayers.Util.isArray(e))){e=[e]}var b=this.createElementNS(this.kmlns,"kml");var f=this.createFolderXML();for(var d=0,a=e.length;
d<a;++d){f.appendChild(this.createPlacemarkXML(e[d]))}b.appendChild(f);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var d=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var f=this.createElementNS(this.kmlns,"name");var e=this.createTextNode(this.foldersName);f.appendChild(e);d.appendChild(f)}if(this.foldersDesc){var a=this.createElementNS(this.kmlns,"description");var b=this.createTextNode(this.foldersDesc);a.appendChild(b);d.appendChild(a)}return d},createPlacemarkXML:function(f){var h=this.createElementNS(this.kmlns,"name");var d=f.style&&f.style.label?f.style.label:f.attributes.name||f.id;h.appendChild(this.createTextNode(d));var e=this.createElementNS(this.kmlns,"description");var g=f.attributes.description||this.placemarksDesc;e.appendChild(this.createTextNode(g));var b=this.createElementNS(this.kmlns,"Placemark");if(f.fid!=null){b.setAttribute("id",f.fid)}b.appendChild(h);b.appendChild(e);var a=this.buildGeometryNode(f.geometry);b.appendChild(a);return b},buildGeometryNode:function(f){var d=f.CLASS_NAME;var b=d.substring(d.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];var e=null;if(a){e=a.apply(this,[f])}return e},buildGeometry:{point:function(b){var a=this.createElementNS(this.kmlns,"Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(b){var a=this.createElementNS(this.kmlns,"LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(b){var a=this.createElementNS(this.kmlns,"LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(j){var b=this.createElementNS(this.kmlns,"Polygon");var h=j.components;var f,g,e;for(var d=0,a=h.length;d<a;++d){e=(d==0)?"outerBoundaryIs":"innerBoundaryIs";f=this.createElementNS(this.kmlns,e);g=this.buildGeometry.linearring.apply(this,[h[d]]);f.appendChild(g);b.appendChild(f)}return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(e){var b=this.createElementNS(this.kmlns,"MultiGeometry");var f;for(var d=0,a=e.components.length;d<a;++d){f=this.buildGeometryNode.apply(this,[e.components[d]]);if(f){b.appendChild(f)}}return b}},buildCoordinatesNode:function(f){var a=this.createElementNS(this.kmlns,"coordinates");var l;var j=f.components;if(j){var h;var g=j.length;var d=new Array(g);for(var e=0;e<g;++e){h=j[e];d[e]=this.buildCoordinates(h)}l=d.join(" ")}else{l=this.buildCoordinates(f)}var b=this.createTextNode(l);a.appendChild(b);return a},buildCoordinates:function(a){if(this.internalProjection&&this.externalProjection){a=a.clone();a.transform(this.internalProjection,this.externalProjection)}return a.x+","+a.y},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,createGeometryFromItem:function(q){var p=this.getElementsByTagNameNS(q,this.georssns,"point");var h=this.getElementsByTagNameNS(q,this.geons,"lat");var a=this.getElementsByTagNameNS(q,this.geons,"long");var u=this.getElementsByTagNameNS(q,this.georssns,"line");var m=this.getElementsByTagNameNS(q,this.georssns,"polygon");var d=this.getElementsByTagNameNS(q,this.georssns,"where");var e=this.getElementsByTagNameNS(q,this.georssns,"box");if(p.length>0||(h.length>0&&a.length>0)){var o;if(p.length>0){o=OpenLayers.String.trim(p[0].firstChild.nodeValue).split(/\s+/);if(o.length!=2){o=OpenLayers.String.trim(p[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{o=[parseFloat(h[0].firstChild.nodeValue),parseFloat(a[0].firstChild.nodeValue)]}var j=new OpenLayers.Geometry.Point(parseFloat(o[1]),parseFloat(o[0]))}else{if(u.length>0){var l=OpenLayers.String.trim(this.concatChildValues(u[0])).split(/\s+/);
var f=[];var p;for(var b=0,g=l.length;b<g;b+=2){p=new OpenLayers.Geometry.Point(parseFloat(l[b+1]),parseFloat(l[b]));f.push(p)}j=new OpenLayers.Geometry.LineString(f)}else{if(m.length>0){var l=OpenLayers.String.trim(this.concatChildValues(m[0])).split(/\s+/);var f=[];var p;for(var b=0,g=l.length;b<g;b+=2){p=new OpenLayers.Geometry.Point(parseFloat(l[b+1]),parseFloat(l[b]));f.push(p)}j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(f)])}else{if(d.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var r=this.gmlParser.parseFeature(d[0]);j=r.geometry}else{if(e.length>0){var l=OpenLayers.String.trim(e[0].firstChild.nodeValue).split(/\s+/);var f=[];var p;if(l.length>3){p=new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[0]));f.push(p);p=new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[2]));f.push(p);p=new OpenLayers.Geometry.Point(parseFloat(l[3]),parseFloat(l[2]));f.push(p);p=new OpenLayers.Geometry.Point(parseFloat(l[3]),parseFloat(l[0]));f.push(p);p=new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[0]));f.push(p)}j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(f)])}}}}}if(j&&this.internalProjection&&this.externalProjection){j.transform(this.externalProjection,this.internalProjection)}return j},createFeatureFromItem:function(l){var f=this.createGeometryFromItem(l);var h=this.getChildValue(l,"*","title",this.featureTitle);var j=this.getChildValue(l,"*","description",this.getChildValue(l,"*","content",this.getChildValue(l,"*","summary",this.featureDescription)));var g=this.getChildValue(l,"*","link");if(!g){try{g=this.getElementsByTagNameNS(l,"*","link")[0].getAttribute("href")}catch(d){g=null}}var a=this.getChildValue(l,"*","id",null);var b={title:h,description:j,link:g};var m=new OpenLayers.Feature.Vector(f,b);m.fid=a;return m},getChildValue:function(e,b,d,g){var f;var a=this.getElementsByTagNameNS(e,b,d);if(a&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue){f=OpenLayers.Format.XML.prototype.getChildValue(a[0])}else{f=(g==undefined)?"":g}return f},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f])}var a=null;a=this.getElementsByTagNameNS(f,"*","item");if(a.length==0){a=this.getElementsByTagNameNS(f,"*","entry")}var d=a.length;var e=new Array(d);for(var b=0;b<d;b++){e[b]=this.createFeatureFromItem(a[b])}return e},write:function(d){var e;if(OpenLayers.Util.isArray(d)){e=this.createElementNS(this.rssns,"rss");for(var b=0,a=d.length;b<a;b++){e.appendChild(this.createFeatureXML(d[b]))}}else{e=this.createFeatureXML(d)}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},createFeatureXML:function(m){var g=this.buildGeometryNode(m.geometry);var a=this.createElementNS(this.rssns,"item");var e=this.createElementNS(this.rssns,"title");e.appendChild(this.createTextNode(m.attributes.title?m.attributes.title:""));var b=this.createElementNS(this.rssns,"description");b.appendChild(this.createTextNode(m.attributes.description?m.attributes.description:""));a.appendChild(e);a.appendChild(b);if(m.attributes.link){var j=this.createElementNS(this.rssns,"link");j.appendChild(this.createTextNode(m.attributes.link));a.appendChild(j)}for(var l in m.attributes){if(l=="link"||l=="title"||l=="description"){continue}var h=this.createTextNode(m.attributes[l]);var f=l;if(l.search(":")!=-1){f=l.split(":")[1]}var d=this.createElementNS(this.featureNS,"feature:"+f);d.appendChild(h);a.appendChild(d)}a.appendChild(g);return a},buildGeometryNode:function(b){if(this.internalProjection&&this.externalProjection){b=b.clone();b.transform(this.internalProjection,this.externalProjection)}var a;if(b.CLASS_NAME=="OpenLayers.Geometry.Polygon"){a=this.createElementNS(this.georssns,"georss:polygon");a.appendChild(this.buildCoordinatesNode(b.components[0]))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.LineString"){a=this.createElementNS(this.georssns,"georss:line");a.appendChild(this.buildCoordinatesNode(b))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.createElementNS(this.georssns,"georss:point");a.appendChild(this.buildCoordinatesNode(b))
}else{throw"Couldn't parse "+b.CLASS_NAME}}}return a},buildCoordinatesNode:function(g){var d=null;if(g.components){d=g.components}var f;if(d){var b=d.length;var e=new Array(b);for(var a=0;a<b;a++){e[a]=d[a].y+" "+d[a].x}f=e.join(" ")}else{f=g.y+" "+g.x}return this.createTextNode(f)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(E){if(typeof E=="string"){E=OpenLayers.Format.XML.prototype.read.apply(this,[E])}var d=[];if(this.extractTracks){var z=E.getElementsByTagName("trk");for(var w=0,B=z.length;w<B;w++){var p={};if(this.extractAttributes){p=this.parseAttributes(z[w])}var m=this.getElementsByTagNameNS(z[w],z[w].namespaceURI,"trkseg");for(var v=0,h=m.length;v<h;v++){var o=this.extractSegment(m[v],"trkpt");d.push(new OpenLayers.Feature.Vector(o,p))}}}if(this.extractRoutes){var a=E.getElementsByTagName("rte");for(var u=0,r=a.length;u<r;u++){var p={};if(this.extractAttributes){p=this.parseAttributes(a[u])}var D=this.extractSegment(a[u],"rtept");d.push(new OpenLayers.Feature.Vector(D,p))}}if(this.extractWaypoints){var b=E.getElementsByTagName("wpt");for(var q=0,B=b.length;q<B;q++){var p={};if(this.extractAttributes){p=this.parseAttributes(b[q])}var f=new OpenLayers.Geometry.Point(b[q].getAttribute("lon"),b[q].getAttribute("lat"));d.push(new OpenLayers.Feature.Vector(f,p))}}if(this.internalProjection&&this.externalProjection){for(var C=0,e=d.length;C<e;C++){d[C].geometry.transform(this.externalProjection,this.internalProjection)}}return d},extractSegment:function(f,g){var e=this.getElementsByTagNameNS(f,f.namespaceURI,g);var b=[];for(var d=0,a=e.length;d<a;d++){b.push(new OpenLayers.Geometry.Point(e[d].getAttribute("lon"),e[d].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(b)},parseAttributes:function(d){var a={};var f=d.firstChild,e,b;while(f){if(f.nodeType==1){e=f.firstChild;if(e.nodeType==3||e.nodeType==4){b=(f.prefix)?f.nodeName.split(":")[1]:f.nodeName;if(b!="trkseg"&&b!="rtept"){a[b]=e.nodeValue}}}f=f.nextSibling}return a},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter},readers:{ogc:{Filter:function(b,a){var d={fids:[],filters:[]};this.readChildNodes(b,d);if(d.fids.length>0){a.filter=new OpenLayers.Filter.FeatureId({fids:d.fids})}else{if(d.filters.length>0){a.filter=d.filters[0]}}},FeatureId:function(a,b){var d=a.getAttribute("fid");if(d){b.fids.push(d)}},And:function(b,d){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(b,a);d.filters.push(a)},Or:function(b,d){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(b,a);d.filters.push(a)},Not:function(b,d){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsLessThan:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsGreaterThan:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsLessThanOrEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a)
},PropertyIsGreaterThanOrEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsBetween:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(b,a);d.filters.push(a)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a))},PropertyName:function(b,a){a.property=this.getChildValue(b)},LowerBoundary:function(b,a){a.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b))},UpperBoundary:function(b,a){a.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b))},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units")},Function:function(a,b){return}}},readSpatial:function(d,e,b){var a=new OpenLayers.Filter.Spatial({type:b});this.readChildNodes(d,a);a.value=a.components[0];delete a.components;e.filters.push(a)},readOgcExpression:function(a){var d={};this.readChildNodes(a,d);var b=d.value;if(b===undefined){b=this.getChildValue(a)}return b},writeOgcExpression:function(b,a){if(b instanceof OpenLayers.Filter.Function){var d=this.writeNode("Function",b,a);a.appendChild(d)}else{this.writeNode("Literal",b,a)}return a},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writeFeatureIdNodes:function(d,e){for(var a=0,b=d.fids.length;a<b;++a){this.writeNode("FeatureId",d.fids[a],e)}},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");if(a.type==="FID"){this.writeFeatureIdNodes(a,b)}else{this.writeNode(this.getFilterType(a),a,b)}return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(e){var f=this.createElementNSPlus("ogc:And");var d;for(var a=0,b=e.filters.length;a<b;++a){d=e.filters[a];if(d.type==="FID"){this.writeFeatureIdNodes(d,f)}else{this.writeNode(this.getFilterType(d),d,f)}}return f},Or:function(e){var f=this.createElementNSPlus("ogc:Or");var d;for(var a=0,b=e.filters.length;a<b;++a){d=e.filters[a];if(d.type==="FID"){this.writeFeatureIdNodes(d,f)}else{this.writeNode(this.getFilterType(d),d,f)}}return f},Not:function(b){var d=this.createElementNSPlus("ogc:Not");var a=b.filters[0];if(a.type==="FID"){this.writeFeatureIdNodes(a,d)}else{this.writeNode(this.getFilterType(a),a,d)}return d},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(a.lowerBoundary,b);return b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")
},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(d){var e=this.createElementNSPlus("ogc:Function",{attributes:{name:d.name}});var f=d.params;for(var b=0,a=f.length;b<a;b++){this.writeOgcExpression(f[b],e)}return e}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b){throw"Filter writing not supported for rule type: "+a.type}return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsNotEqualTo:function(b,d){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsLike:function(e,f){var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,d);var g=e.getAttribute("wildCard");var b=e.getAttribute("singleChar");var a=e.getAttribute("escape");d.value2regex(g,b,a);f.filters.push(d)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},BBOX:function(a){var d=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,d);var b=this.writeNode("gml:Box",a.value,d);if(a.projection){b.setAttribute("srsName",a.projection)}return d}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(b,a){var d=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,d);if(b.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",b.value,d)}else{var e;if(b.value instanceof OpenLayers.Geometry){e=this.writeNode("feature:_geometry",b.value).firstChild}else{e=this.writeNode("gml:Box",b.value)}if(b.projection){e.setAttribute("srsName",b.projection)}d.appendChild(e)}return d},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,e){var d=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(d==="false"||d==="0")});
this.readChildNodes(b,a);e.filters.push(a)},PropertyIsNotEqualTo:function(b,e){var d=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(d==="false"||d==="0")});this.readChildNodes(b,a);e.filters.push(a)},PropertyIsLike:function(e,f){var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,d);var g=e.getAttribute("wildCard");var b=e.getAttribute("singleChar");var a=e.getAttribute("escapeChar");d.value2regex(g,b,a);f.filters.push(d)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},BBOX:function(a){var d=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,d);var b=this.writeNode("gml:Envelope",a.value);if(a.projection){b.setAttribute("srsName",a.projection)}d.appendChild(b);return d},SortBy:function(e){var d=this.createElementNSPlus("ogc:SortBy");for(var b=0,a=e.length;b<a;b++){this.writeNode("ogc:SortProperty",e[b],d)}return d},SortProperty:function(b){var a=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",b,a);this.writeNode("ogc:SortOrder",(b.order=="DESC")?"DESC":"ASC",a);return a},SortOrder:function(b){var a=this.createElementNSPlus("ogc:SortOrder",{value:b});return a}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(b,a){var d=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,d);if(b.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",b.value,d)}else{var e;if(b.value instanceof OpenLayers.Geometry){e=this.writeNode("feature:_geometry",b.value).firstChild}else{e=this.writeNode("gml:Envelope",b.value)}if(b.projection){e.setAttribute("srsName",b.projection)}d.appendChild(e)}return d},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",stringifyOutput:true,namedLayersAsArray:false,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a])},read:function(d,a){a=OpenLayers.Util.applyDefaults(a,this.options);var b={namedLayers:a.namedLayersAsArray===true?[]:{}};this.readChildNodes(d,b);return b},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(e,f){var d={userStyles:[],namedStyles:[]};this.readChildNodes(e,d);for(var b=0,a=d.userStyles.length;
b<a;++b){d.userStyles[b].layerName=d.name}if(OpenLayers.Util.isArray(f.namedLayers)){f.namedLayers.push(d)}else{f.namedLayers[d.name]=d}},NamedStyle:function(b,a){a.namedStyles.push(this.getChildName(b.firstChild))},UserStyle:function(d,a){var e={defaultsPerSymbolizer:true,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(d,e);var b;if(this.multipleSymbolizers){delete e.defaultsPerSymbolizer;b=new OpenLayers.Style2(e)}else{b=new OpenLayers.Style(this.defaultSymbolizer,e)}a.userStyles.push(b)},IsDefault:function(b,a){if(this.getChildValue(b)=="1"){a.isDefault=true}},FeatureTypeStyle:function(b,a){++this.featureTypeCounter;var d={rules:this.multipleSymbolizers?a.rules:[]};this.readChildNodes(b,d);if(!this.multipleSymbolizers){a.rules=d.rules}},Rule:function(b,e){var a;if(this.multipleSymbolizers){a={symbolizers:[]}}var d=new OpenLayers.Rule(a);this.readChildNodes(b,d);e.rules.push(d)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(b,d){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;d.symbolizers.push(new OpenLayers.Symbolizer.Text(a))}else{d.symbolizer.Text=OpenLayers.Util.applyDefaults(a,d.symbolizer.Text)}},Label:function(b,a){var e={};this.readChildNodes(b,e);if(e.property){a.label="${"+e.property+"}"}else{var d=this.readOgcExpression(b);if(d){a.label=d}}},Font:function(b,a){this.readChildNodes(b,a)},Halo:function(b,a){var d={};this.readChildNodes(b,d);a.haloRadius=d.haloRadius;a.haloColor=d.fillColor;a.haloOpacity=d.fillOpacity},Radius:function(d,b){var a=this.readOgcExpression(d);if(a!=null){b.haloRadius=a}},RasterSymbolizer:function(b,d){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;d.symbolizers.push(new OpenLayers.Symbolizer.Raster(a))}else{d.symbolizer.Raster=OpenLayers.Util.applyDefaults(a,d.symbolizer.Raster)}},Geometry:function(a,b){b.geometry={};this.readChildNodes(a,b.geometry)},ColorMap:function(b,a){a.colorMap=[];this.readChildNodes(b,a.colorMap)},ColorMapEntry:function(b,a){var d=b.getAttribute("quantity");var e=b.getAttribute("opacity");a.push({color:b.getAttribute("color"),quantity:d!==null?parseFloat(d):undefined,label:b.getAttribute("label")||undefined,opacity:e!==null?parseFloat(e):undefined})},LineSymbolizer:function(b,d){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;d.symbolizers.push(new OpenLayers.Symbolizer.Line(a))}else{d.symbolizer.Line=OpenLayers.Util.applyDefaults(a,d.symbolizer.Line)}},PolygonSymbolizer:function(b,d){var a={fill:false,stroke:false};if(!this.multipleSymbolizers){a=d.symbolizer.Polygon||a}this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;d.symbolizers.push(new OpenLayers.Symbolizer.Polygon(a))}else{d.symbolizer.Polygon=a}},PointSymbolizer:function(b,d){var a={fill:false,stroke:false,graphic:false};if(!this.multipleSymbolizers){a=d.symbolizer.Point||a}this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;d.symbolizers.push(new OpenLayers.Symbolizer.Point(a))}else{d.symbolizer.Point=a}},Stroke:function(b,a){a.stroke=true;this.readChildNodes(b,a)},Fill:function(b,a){a.fill=true;this.readChildNodes(b,a)},CssParameter:function(d,b){var a=d.getAttribute("name");var f=this.cssMap[a];if(f){var e=this.readOgcExpression(d);if(e){b[f]=e}}},Graphic:function(f,e){e.graphic=true;var j={};this.readChildNodes(f,j);var d=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var h,g;for(var b=0,a=d.length;b<a;++b){h=d[b];g=j[h];if(g!=undefined){e[h]=g}}if(j.opacity!=undefined){e.graphicOpacity=j.opacity}if(j.size!=undefined){e.pointRadius=j.size/2}if(j.href!=undefined){e.externalGraphic=j.href}if(j.rotation!=undefined){e.rotation=j.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)
},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(b,d){var a=this.readOgcExpression(b);if(a){d.opacity=a}},Size:function(b,d){var a=this.readOgcExpression(b);if(a){d.size=a}},Rotation:function(b,d){var a=this.readOgcExpression(b);if(a){d.rotation=a}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var d in this.cssMap){if(this.cssMap[d]==a){b=d;break}}return b},getGraphicFormat:function(a){var e,d;for(var b in this.graphicFormats){if(this.graphicFormats[b].test(a)){e=b;break}}return e||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(f){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});b.setAttribute("xmlns:ogc",this.namespaces.ogc);b.setAttribute("xmlns:gml",this.namespaces.gml);if(f.name){this.writeNode("Name",f.name,b)}if(f.title){this.writeNode("Title",f.title,b)}if(f.description){this.writeNode("Abstract",f.description,b)}if(OpenLayers.Util.isArray(f.namedLayers)){for(var e=0,a=f.namedLayers.length;e<a;++e){this.writeNode("NamedLayer",f.namedLayers[e],b)}}else{for(var d in f.namedLayers){this.writeNode("NamedLayer",f.namedLayers[d],b)}}return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(d){var e=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",d.name,e);if(d.namedStyles){for(var b=0,a=d.namedStyles.length;b<a;++b){this.writeNode("NamedStyle",d.namedStyles[b],e)}}if(d.userStyles){for(var b=0,a=d.userStyles.length;b<a;++b){this.writeNode("UserStyle",d.userStyles[b],e)}}return e},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(b){var e=this.createElementNSPlus("sld:UserStyle");if(b.name){this.writeNode("Name",b.name,e)}if(b.title){this.writeNode("Title",b.title,e)}if(b.description){this.writeNode("Abstract",b.description,e)}if(b.isDefault){this.writeNode("IsDefault",b.isDefault,e)}if(this.multipleSymbolizers&&b.rules){var p={0:[]};var d=[0];var o,a,u,m,l;for(var g=0,r=b.rules.length;g<r;++g){o=b.rules[g];if(o.symbolizers){a={};for(var f=0,h=o.symbolizers.length;f<h;++f){u=o.symbolizers[f];m=u.zIndex;if(!(m in a)){l=o.clone();l.symbolizers=[];a[m]=l}a[m].symbolizers.push(u.clone())}for(m in a){if(!(m in p)){d.push(m);p[m]=[]}p[m].push(a[m])}}else{p[0].push(o.clone())}}d.sort();var q;for(var g=0,r=d.length;g<r;++g){q=p[d[g]];if(q.length>0){l=b.clone();l.rules=p[d[g]];this.writeNode("FeatureTypeStyle",l,e)}}}else{this.writeNode("FeatureTypeStyle",b,e)}return e},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:(a)?"1":"0"})},FeatureTypeStyle:function(d){var e=this.createElementNSPlus("sld:FeatureTypeStyle");for(var b=0,a=d.rules.length;b<a;++b){this.writeNode("Rule",d.rules[b],e)}return e},Rule:function(j){var h=this.createElementNSPlus("sld:Rule");if(j.name){this.writeNode("Name",j.name,h)}if(j.title){this.writeNode("Title",j.title,h)}if(j.description){this.writeNode("Abstract",j.description,h)}if(j.elseFilter){this.writeNode("ElseFilter",null,h)}else{if(j.filter){this.writeNode("ogc:Filter",j.filter,h)
}}if(j.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",j.minScaleDenominator,h)}if(j.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",j.maxScaleDenominator,h)}var g,f;if(this.multipleSymbolizers&&j.symbolizers){var f;for(var d=0,e=j.symbolizers.length;d<e;++d){f=j.symbolizers[d];g=f.CLASS_NAME.split(".").pop();this.writeNode(g+"Symbolizer",f,h)}}else{var b=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var d=0,a=b.length;d<a;++d){g=b[d];f=j.symbolizer[g];if(f){this.writeNode(g+"Symbolizer",f,h)}}}return h},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");if(a.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b)}if(a.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b)}if(a.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b)}if(a.strokeDashstyle!=undefined&&a.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b)}if(a.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b)}return b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");if(a.label!=null){this.writeNode("Label",a.label,b)}if(a.fontFamily!=null||a.fontSize!=null||a.fontWeight!=null||a.fontStyle!=null){this.writeNode("Font",a,b)}if(a.haloRadius!=null||a.haloColor!=null||a.haloOpacity!=null){this.writeNode("Halo",a,b)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode("Fill",a,b)}return b},Font:function(a){var b=this.createElementNSPlus("sld:Font");if(a.fontFamily){this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b)}if(a.fontSize){this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b)}if(a.fontWeight){this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b)}if(a.fontStyle){this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b)}return b},Label:function(b){var g=this.createElementNSPlus("sld:Label");var h=b.split("${");g.appendChild(this.createTextNode(h[0]));var f,e;for(var d=1,a=h.length;d<a;d++){f=h[d];e=f.indexOf("}");if(e>0){this.writeNode("ogc:PropertyName",{property:f.substring(0,e)},g);g.appendChild(this.createTextNode(f.substring(++e)))}else{g.appendChild(this.createTextNode("${"+f))}}return g},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");if(a.haloRadius){this.writeNode("Radius",a.haloRadius,b)}if(a.haloColor||a.haloOpacity){this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b)}return b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");if(a.geometry){this.writeNode("Geometry",a.geometry,b)}if(a.opacity){this.writeNode("Opacity",a.opacity,b)}if(a.colorMap){this.writeNode("ColorMap",a.colorMap,b)}return b},Geometry:function(b){var a=this.createElementNSPlus("sld:Geometry");if(b.property){this.writeNode("ogc:PropertyName",b,a)}return a},ColorMap:function(b){var e=this.createElementNSPlus("sld:ColorMap");for(var d=0,a=b.length;d<a;++d){this.writeNode("ColorMapEntry",b[d],e)}return e},ColorMapEntry:function(d){var e=this.createElementNSPlus("sld:ColorMapEntry");var b=d;e.setAttribute("color",b.color);b.opacity!==undefined&&e.setAttribute("opacity",parseFloat(b.opacity));b.quantity!==undefined&&e.setAttribute("quantity",parseFloat(b.quantity));b.label!==undefined&&e.setAttribute("label",b.label);return e},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");
if(a.fill!==false){this.writeNode("Fill",a,b)}if(a.stroke!==false){this.writeNode("Stroke",a,b)}return b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");if(a.fillColor){this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b)}if(a.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b)}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");if(a.externalGraphic!=undefined){this.writeNode("ExternalGraphic",a,b)}else{this.writeNode("Mark",a,b)}if(a.graphicOpacity!=undefined){this.writeNode("Opacity",a.graphicOpacity,b)}if(a.pointRadius!=undefined){this.writeNode("Size",a.pointRadius*2,b)}if(a.rotation!=undefined){this.writeNode("Rotation",a.rotation,b)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var d=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",d,b);return b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");if(a.graphicName){this.writeNode("WellKnownName",a.graphicName,b)}if(a.fill!==false){this.writeNode("Fill",a,b)}if(a.stroke!==false){this.writeNode("Stroke",a,b)}return b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("sld:Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",initialize:function(a){OpenLayers.Format.SLD.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(b,d){var a=this.version;if(!a){var e=b.getAttribute("xmlns:ows");if(e&&e.substring(e.lastIndexOf("/")+1)==="1.1"){a="1.1.0"}if(!a){a=this.defaultVersion}}return a},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var d={};this.readChildNodes(b,d);return d},readers:{ows:{Exception:function(b,d){var a={code:b.getAttribute("exceptionCode"),locator:b.getAttribute("locator"),texts:[]};d.exceptions.push(a);this.readChildNodes(b,a)},ExceptionText:function(b,a){var d=this.getChildValue(b);a.texts.push(d)},ServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords)},Keyword:function(b,a){a[this.getChildValue(b)]=true},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact)
},IndividualName:function(b,a){a.individualName=this.getChildValue(b)},PositionName:function(b,a){a.positionName=this.getChildValue(b)},ContactInfo:function(b,a){a.contactInfo={};this.readChildNodes(b,a.contactInfo)},Phone:function(b,a){a.phone={};this.readChildNodes(b,a.phone)},Voice:function(b,a){a.voice=this.getChildValue(b)},Address:function(b,a){a.address={};this.readChildNodes(b,a.address)},DeliveryPoint:function(b,a){a.deliveryPoint=this.getChildValue(b)},City:function(b,a){a.city=this.getChildValue(b)},AdministrativeArea:function(b,a){a.administrativeArea=this.getChildValue(b)},PostalCode:function(b,a){a.postalCode=this.getChildValue(b)},Country:function(b,a){a.country=this.getChildValue(b)},ElectronicMailAddress:function(b,a){a.electronicMailAddress=this.getChildValue(b)},Role:function(b,a){a.role=this.getChildValue(b)},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata)},Operation:function(d,b){var a=d.getAttribute("name");b[a]={};this.readChildNodes(d,b[a])},DCP:function(b,a){a.dcp={};this.readChildNodes(b,a.dcp)},HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http)},Get:function(b,a){a.get=this.getAttributeNS(b,this.namespaces.xlink,"href")},Post:function(b,a){a.post=this.getAttributeNS(b,this.namespaces.xlink,"href")},Parameter:function(d,a){if(!a.parameters){a.parameters={}}var b=d.getAttribute("name");a.parameters[b]={};this.readChildNodes(d,a.parameters[b])},Value:function(a,b){b[this.getChildValue(a)]=true},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b)},WGS84BoundingBox:function(b,d){var a={};a.crs=b.getAttribute("crs");if(d.BoundingBox){d.BoundingBox.push(a)}else{d.projection=a.crs;a=d}this.readChildNodes(b,a)},BoundingBox:function(a,b){this.readers.ows["WGS84BoundingBox"].apply(this,[a,b])},LowerCorner:function(b,d){var e=this.getChildValue(b).replace(this.regExes.trimSpace,"");e=e.replace(this.regExes.trimComma,",");var a=e.split(this.regExes.splitSpace);d.left=a[0];d.bottom=a[1]},UpperCorner:function(b,d){var e=this.getChildValue(b).replace(this.regExes.trimSpace,"");e=e.replace(this.regExes.trimComma,",");var a=e.split(this.regExes.splitSpace);d.right=a[0];d.top=a[1];d.bounds=new OpenLayers.Bounds(d.left,d.bottom,d.right,d.top);delete d.left;delete d.bottom;delete d.right;delete d.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a){var b=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:a.projection}});this.writeNode("ows:LowerCorner",a,b);this.writeNode("ows:UpperCorner",a,b);return b},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b},Identifier:function(a){var b=this.createElementNSPlus("ows:Identifier",{value:a});return b},Title:function(b){var a=this.createElementNSPlus("ows:Title",{value:b});return a},Abstract:function(a){var b=this.createElementNSPlus("ows:Abstract",{value:a});return b},OutputFormat:function(b){var a=this.createElementNSPlus("ows:OutputFormat",{value:b});return a}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=false;b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]};this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]};
this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={};this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=true},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={};this.readChildNodes(a,b.range)},MinimumValue:function(b,a){a.minValue=this.getChildValue(b)},MaximumValue:function(b,a){a.maxValue=this.getChildValue(b)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":a.closure}});this.writeNode("ows:MinimumValue",a.minValue,b);this.writeNode("ows:MaximumValue",a.maxValue,b);return b},MinimumValue:function(b){var a=this.createElementNSPlus("ows:MinimumValue",{value:b});return a},MaximumValue:function(b){var a=this.createElementNSPlus("ows:MaximumValue",{value:b});return a},Value:function(b){var a=this.createElementNSPlus("ows:Value",{value:b});return a}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:true,initialize:function(a){a=a||{};if(a.extractStyles!==false){a.defaultStyle={externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}}OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(m){var a=m.split("\n");var b;var h=[];for(var C=0;C<(a.length-1);C++){var B=a[C].replace(/^\s*/,"").replace(/\s*$/,"");if(B.charAt(0)!="#"){if(!b){b=B.split("\t")}else{var p=B.split("\t");var e=new OpenLayers.Geometry.Point(0,0);var j={};var v=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null;var w,z,d,r;var o=false;for(var l=0;l<p.length;l++){if(p[l]){if(b[l]=="point"){var u=p[l].split(",");e.y=parseFloat(u[0]);e.x=parseFloat(u[1]);o=true}else{if(b[l]=="lat"){e.y=parseFloat(p[l]);o=true}else{if(b[l]=="lon"){e.x=parseFloat(p[l]);o=true}else{if(b[l]=="title"){j.title=p[l]}else{if(b[l]=="image"||b[l]=="icon"&&v){v.externalGraphic=p[l]}else{if(b[l]=="iconSize"&&v){var q=p[l].split(",");v.graphicWidth=parseFloat(q[0]);v.graphicHeight=parseFloat(q[1])}else{if(b[l]=="iconOffset"&&v){var g=p[l].split(",");v.graphicXOffset=parseFloat(g[0]);v.graphicYOffset=parseFloat(g[1])}else{if(b[l]=="description"){j.description=p[l]}else{if(b[l]=="overflow"){j.overflow=p[l]}else{j[b[l]]=p[l]}}}}}}}}}}}if(o){if(this.internalProjection&&this.externalProjection){e.transform(this.externalProjection,this.internalProjection)}var f=new OpenLayers.Feature.Vector(e,j,v);h.push(f)}}}}return h},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,nativeJSON:(function(){return !!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")})(),read:function(json,filter){var object;if(this.nativeJSON){object=JSON.parse(json,filter)}else{try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}object=walk("",object)}}}catch(e){}}if(this.keepData){this.data=object}return object},write:function(f,d){this.pretty=!!d;var a=null;var b=typeof f;if(this.serialize[b]){try{a=(!this.pretty&&this.nativeJSON)?JSON.stringify(f):this.serialize[b].apply(this,[f])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}}return a},writeIndent:function(){var b=[];if(this.pretty){for(var a=0;a<this.level;++a){b.push(this.indent)}}return b.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""
},serialize:{object:function(d){if(d==null){return"null"}if(d.constructor==Date){return this.serialize.date.apply(this,[d])}if(d.constructor==Array){return this.serialize.array.apply(this,[d])}var g=["{"];this.level+=1;var e,b,f;var a=false;for(e in d){if(d.hasOwnProperty(e)){b=OpenLayers.Format.JSON.prototype.write.apply(this,[e,this.pretty]);f=OpenLayers.Format.JSON.prototype.write.apply(this,[d[e],this.pretty]);if(b!=null&&f!=null){if(a){g.push(",")}g.push(this.writeNewline(),this.writeIndent(),b,":",this.writeSpace(),f);a=true}}}this.level-=1;g.push(this.writeNewline(),this.writeIndent(),"}");return g.join("")},array:function(f){var d;var e=["["];this.level+=1;for(var b=0,a=f.length;b<a;++b){d=OpenLayers.Format.JSON.prototype.write.apply(this,[f[b],this.pretty]);if(d!=null){if(b>0){e.push(",")}e.push(this.writeNewline(),this.writeIndent(),d)}}this.level-=1;e.push(this.writeNewline(),this.writeIndent(),"]");return e.join("")},string:function(b){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(b)){return'"'+b.replace(/([\x00-\x1f\\"])/g,function(e,d){var f=a[d];if(f){return f}f=d.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"'}return'"'+b+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(d){return(d<10)?"0"+d:d}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,read:function(l,h,a){h=(h)?h:"FeatureCollection";var e=null;var d=null;if(typeof l=="string"){d=OpenLayers.Format.JSON.prototype.read.apply(this,[l,a])}else{d=l}if(!d){OpenLayers.Console.error("Bad JSON: "+l)}else{if(typeof(d.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+l)}else{if(this.isValidType(d,h)){switch(h){case"Geometry":try{e=this.parseGeometry(d)}catch(b){OpenLayers.Console.error(b)}break;case"Feature":try{e=this.parseFeature(d);e.type="Feature"}catch(b){OpenLayers.Console.error(b)}break;case"FeatureCollection":e=[];switch(d.type){case"Feature":try{e.push(this.parseFeature(d))}catch(b){e=null;OpenLayers.Console.error(b)}break;case"FeatureCollection":for(var f=0,g=d.features.length;f<g;++f){try{e.push(this.parseFeature(d.features[f]))}catch(b){e=null;OpenLayers.Console.error(b)}}break;default:try{var j=this.parseGeometry(d);e.push(new OpenLayers.Feature.Vector(j))}catch(b){e=null;OpenLayers.Console.error(b)}}break}}}}return e},isValidType:function(d,a){var b=false;switch(a){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],d.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+d.type)}else{b=true}break;case"FeatureCollection":b=true;break;default:if(d.type==a){b=true}else{OpenLayers.Console.error("Cannot convert types from "+d.type+" to "+a)}}return b},parseFeature:function(e){var b,g,a,f;a=(e.properties)?e.properties:{};f=(e.geometry&&e.geometry.bbox)||e.bbox;try{g=this.parseGeometry(e.geometry)}catch(d){throw d}b=new OpenLayers.Feature.Vector(g,a);if(f){b.bounds=OpenLayers.Bounds.fromArray(f)}if(e.id){b.fid=e.id}return b},parseGeometry:function(f){if(f==null){return null}var h,g=false;if(f.type=="GeometryCollection"){if(!(OpenLayers.Util.isArray(f.geometries))){throw"GeometryCollection must have geometries array: "+f}var b=f.geometries.length;var e=new Array(b);for(var a=0;a<b;++a){e[a]=this.parseGeometry.apply(this,[f.geometries[a]])}h=new OpenLayers.Geometry.Collection(e);g=true}else{if(!(OpenLayers.Util.isArray(f.coordinates))){throw"Geometry must have coordinates array: "+f}if(!this.parseCoords[f.type.toLowerCase()]){throw"Unsupported geometry type: "+f.type}try{h=this.parseCoords[f.type.toLowerCase()].apply(this,[f.coordinates])}catch(d){throw d}}if(this.internalProjection&&this.externalProjection&&!g){h.transform(this.externalProjection,this.internalProjection)
}return h},parseCoords:{point:function(a){if(this.ignoreExtraDims==false&&a.length!=2){throw"Only 2D points are supported: "+a}return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(g){var d=[];var f=null;for(var b=0,a=g.length;b<a;++b){try{f=this.parseCoords.point.apply(this,[g[b]])}catch(e){throw e}d.push(f)}return new OpenLayers.Geometry.MultiPoint(d)},linestring:function(g){var d=[];var f=null;for(var b=0,a=g.length;b<a;++b){try{f=this.parseCoords.point.apply(this,[g[b]])}catch(e){throw e}d.push(f)}return new OpenLayers.Geometry.LineString(d)},multilinestring:function(g){var d=[];var b=null;for(var e=0,a=g.length;e<a;++e){try{b=this.parseCoords.linestring.apply(this,[g[e]])}catch(f){throw f}d.push(b)}return new OpenLayers.Geometry.MultiLineString(d)},polygon:function(h){var g=[];var f,b;for(var d=0,a=h.length;d<a;++d){try{b=this.parseCoords.linestring.apply(this,[h[d]])}catch(e){throw e}f=new OpenLayers.Geometry.LinearRing(b.components);g.push(f)}return new OpenLayers.Geometry.Polygon(g)},multipolygon:function(g){var b=[];var f=null;for(var d=0,a=g.length;d<a;++d){try{f=this.parseCoords.polygon.apply(this,[g[d]])}catch(e){throw e}b.push(f)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(f,e){var a={type:null};if(OpenLayers.Util.isArray(f)){a.type="FeatureCollection";var h=f.length;a.features=new Array(h);for(var d=0;d<h;++d){var b=f[d];if(!b instanceof OpenLayers.Feature.Vector){var g="FeatureCollection only supports collections of features: "+b;throw g}a.features[d]=this.extract.feature.apply(this,[b])}}else{if(f.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){a=this.extract.geometry.apply(this,[f])}else{if(f instanceof OpenLayers.Feature.Vector){a=this.extract.feature.apply(this,[f]);if(f.layer&&f.layer.projection){a.crs=this.createCRSObject(f)}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[a,e])},createCRSObject:function(b){var d=b.layer.projection.toString();var a={};if(d.match(/epsg:/i)){var e=parseInt(d.substring(d.indexOf(":")+1));if(e==4326){a={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{a={type:"name",properties:{name:"EPSG:"+e}}}}return a},extract:{feature:function(d){var b=this.extract.geometry.apply(this,[d.geometry]);var a={type:"Feature",properties:d.attributes,geometry:b};if(d.fid!=null){a.id=d.fid}return a},geometry:function(e){if(e==null){return null}if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var a=e.CLASS_NAME.split(".")[2];var d=this.extract[a.toLowerCase()].apply(this,[e]);var b;if(a=="Collection"){b={type:"GeometryCollection",geometries:d}}else{b={type:a,coordinates:d}}return b},point:function(a){return[a.x,a.y]},multipoint:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push(this.extract.point.apply(this,[d.components[b]]))}return e},linestring:function(b){var e=[];for(var d=0,a=b.components.length;d<a;++d){e.push(this.extract.point.apply(this,[b.components[d]]))}return e},multilinestring:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push(this.extract.linestring.apply(this,[d.components[b]]))}return e},polygon:function(d){var e=[];for(var b=0,a=d.components.length;b<a;++b){e.push(this.extract.linestring.apply(this,[d.components[b]]))}return e},multipolygon:function(e){var d=[];for(var b=0,a=e.components.length;b<a;++b){d.push(this.extract.polygon.apply(this,[e.components[b]]))}return d},collection:function(d){var a=d.components.length;var e=new Array(a);for(var b=0;b<a;++b){e[b]=this.extract.geometry.apply(this,[d.components[b]])}return e}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":true},createLayer:function(f,g){var m;
var o={layer:true,matrixSet:true};for(var d in o){if(!(d in g)){throw new Error("Missing property '"+d+"' in layer configuration.")}}var h=f.contents;var e=h.tileMatrixSets[g.matrixSet];var l=h.layers;var b;for(var j=0,p=h.layers.length;j<p;++j){if(h.layers[j].identifier===g.layer){b=h.layers[j];break}}if(b&&e){var a;for(var j=0,p=b.styles.length;j<p;++j){a=b.styles[j];if(a.isDefault){break}}m=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(g,{url:f.operationsMetadata.GetTile.dcp.http.get,name:b.title,style:a.identifier,matrixIds:e.matrixIds}))}return m},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;var a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);a.version=this.version;return a},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(b,d){var a={styles:[],formats:[],tileMatrixSetLinks:[]};a.layers=[];this.readChildNodes(b,a);d.layers.push(a)},Style:function(b,d){var a={};a.isDefault=(b.getAttribute("isDefault")==="true");this.readChildNodes(b,a);d.styles.push(a)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(b,d){var a={};this.readChildNodes(b,a);d.tileMatrixSetLinks.push(a)},TileMatrixSet:function(b,d){if(d.layers){var a={matrixIds:[]};this.readChildNodes(b,a);d.tileMatrixSets[a.identifier]=a}else{d.tileMatrixSet=this.getChildValue(b)}},TileMatrix:function(b,d){var a={supportedCRS:d.supportedCRS};this.readChildNodes(b,a);d.matrixIds.push(a)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(e,g){var d=this.getChildValue(e);var f=d.split(" ");var a;if(g.supportedCRS){var b=g.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");a=!!this.yx[b]}if(a){g.topLeftCorner=new OpenLayers.LonLat(f[1],f[0])}else{g.topLeftCorner=new OpenLayers.LonLat(f[0],f[1])}},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};b.resourceUrl[a.getAttribute("resourceType")]={format:a.getAttribute("format"),template:a.getAttribute("template")}},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute("xlink:href")}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,single:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,EVENT_TYPES:["featureselected","featuresselected","featureunselected","clickout","beforefeatureselected","beforefeaturesselected","hoverfeature","outfeature"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.GetFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);
this.features={};this.handlers={};if(this.click){this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})}if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))}if(this.hover){this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250}))}},activate:function(){if(!this.active){for(var a in this.handlers){this.handlers[a].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var a in this.handlers){this.handlers[a].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,{single:this.single})},selectBox:function(a){var d;if(a instanceof OpenLayers.Bounds){var e=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));d=new OpenLayers.Bounds(e.lon,e.lat,b.lon,b.lat)}else{if(this.click){return}d=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(d)},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:true,hover:true})},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);this.hoverResponse=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},request:function(e,b){b=b||{};var d=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var a=this.protocol.read({maxFeatures:b.single==true?this.maxFeatures:undefined,filter:d,callback:function(f){if(f.success()){if(f.features.length){if(b.single==true){this.selectBestFeature(f.features,e.getCenterLonLat(),b)}else{this.select(f.features)}}else{if(b.hover){this.hoverSelect()}else{this.events.triggerEvent("clickout");if(this.clickout){this.unselectAll()}}}}OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});if(b.hover==true){this.hoverResponse=a}},selectBestFeature:function(b,a,l){l=l||{};if(b.length){var h=new OpenLayers.Geometry.Point(a.lon,a.lat);var j,e,f;var g=Number.MAX_VALUE;for(var d=0;d<b.length;++d){j=b[d];if(j.geometry){f=h.distanceTo(j.geometry,{edge:false});if(f<g){g=f;e=j;if(g==0){break}}}}if(l.hover==true){this.hoverSelect(e)}else{this.select(e||b)}}},setModifiers:function(a){this.modifiers={multiple:this.multiple||(this.multipleKey&&a[this.multipleKey]),toggle:this.toggle||(this.toggleKey&&a[this.toggleKey])}},select:function(f){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()}if(!(OpenLayers.Util.isArray(f))){f=[f]}var b=this.events.triggerEvent("beforefeaturesselected",{features:f});if(b!==false){var g=[];var e;for(var d=0,a=f.length;d<a;++d){e=f[d];if(this.features[e.fid||e.id]){if(this.modifiers.toggle){this.unselect(this.features[e.fid||e.id])}}else{b=this.events.triggerEvent("beforefeatureselected",{feature:e});if(b!==false){this.features[e.fid||e.id]=e;g.push(e);this.events.triggerEvent("featureselected",{feature:e})}}}this.events.triggerEvent("featuresselected",{features:g})}},hoverSelect:function(a){var d=a?a.fid||a.id:null;var b=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;if(b&&b!=d){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});this.hoverFeature=null}if(d&&d!=b){this.events.triggerEvent("hoverfeature",{feature:a});this.hoverFeature=a}},unselect:function(a){delete this.features[a.fid||a.id];this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features){this.unselect(this.features[a])}},setMap:function(b){for(var a in this.handlers){this.handlers[a].setMap(b)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(b){var f=b.add(-this.clickTolerance/2,this.clickTolerance/2);
var a=b.add(this.clickTolerance/2,-this.clickTolerance/2);var d=this.map.getLonLatFromPixel(f);var e=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y);if(a){this.position=a}if(b){this.direction=b}this.measureDivs=[]},destroy:function(){for(var b in this.buttons){var a=this.buttons[b];a.map=null;a.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments);this.buttons={};var b=new OpenLayers.Size(28,28);var a=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",a,b,"Shift->Drag to zoom to area");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this._addButton("pan","panning-hand-off.png","panning-hand-on.png",a,b,"Drag the map to pan.");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this.switchModeTo("pan");return this.div},_addButton:function(a,f,e,l,h,j){var g=OpenLayers.Util.getImagesLocation()+f;var d=OpenLayers.Util.getImagesLocation()+e;var b=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+a,l,h,g,"absolute");this.div.appendChild(b);b.imgLocation=g;b.activeImgLocation=d;b.events=new OpenLayers.Events(this,b,null,true);b.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this});b.action=a;b.title=j;b.alt=j;b.map=this.map;this.buttons[a]=b;return b},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.buttonClicked=a.element.action;OpenLayers.Event.stop(a)},buttonUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.buttonClicked!=null){if(this.buttonClicked==a.element.action){this.switchModeTo(a.element.action)}OpenLayers.Event.stop(a);this.buttonClicked=null}},defaultDblClick:function(b){this.switchModeTo("pan");this.performedDrag=false;var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;this.startViaKeyboard=false;if(a.shiftKey&&this.mode!="zoombox"){this.switchModeTo("zoombox");this.startViaKeyboard=true}else{if(a.altKey&&this.mode!="measure"){this.switchModeTo("measure")}else{if(!this.mode){this.switchModeTo("pan")}}}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.eventsDiv.appendChild(this.zoomBox);this.performedDrag=true;break;case"measure":var d="";if(this.measureStart){var b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);d=OpenLayers.Util.distVincenty(this.measureStart,b);d=Math.round(d*100)/100;d=d+"km";this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart);this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBox.style.width="4px";this.measureBox.style.height="4px";this.measureBox.style.fontSize="1px";this.measureBox.style.backgroundColor="red";this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);
if(d){this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBoxDistance.innerHTML=d;this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBoxDistance);this.measureDivs.push(this.measureBoxDistance)}this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move";break}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(a)},switchModeTo:function(d){if(d!=this.mode){if(this.mode&&this.buttons[this.mode]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation)}if(this.mode=="measure"&&d!="measure"){for(var b=0,a=this.measureDivs.length;b<a;b++){if(this.measureDivs[b]){this.map.layerContainerDiv.removeChild(this.measureDivs[b])}}this.measureDivs=[];this.measureStart=null}this.mode=d;if(this.buttons[d]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[d],null,null,null,this.buttons[d].activeImgLocation)}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor="";break}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(f){if(this.mouseDragStart!=null){switch(this.mode){case"zoombox":var e=Math.abs(this.mouseDragStart.x-f.xy.x);var b=Math.abs(this.mouseDragStart.y-f.xy.y);this.zoomBox.style.width=Math.max(1,e)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(f.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=f.xy.x+"px"}if(f.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=f.xy.y+"px"}break;default:var e=this.mouseDragStart.x-f.xy.x;var b=this.mouseDragStart.y-f.xy.y;var g=this.map.getSize();var a=new OpenLayers.Pixel(g.w/2+e,g.h/2+b);var d=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(d,null,true);this.mouseDragStart=f.xy.clone()}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.mode){case"zoombox":this.zoomBoxEnd(a);if(this.startViaKeyboard){this.leaveMode()}break;case"pan":if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="default"},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.eventsDiv)){if(this.zoomBox){this.removeZoomBox();if(this.startViaKeyboard){this.leaveMode()}}this.mouseDragStart=null;this.map.div.style.cursor="default"}},defaultClick:function(a){if(this.performedDrag){this.performedDrag=false;return false}},CLASS_NAME:"OpenLayers.Control.MouseToolbar"});OpenLayers.Control.MouseToolbar.X=6;OpenLayers.Control.MouseToolbar.Y=300;OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation(),new OpenLayers.Control.ZoomBox()])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);if(this.defaultControl===null){this.defaultControl=this.controls[0]}return a},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);var a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(b,a){this.direction=b;this.CLASS_NAME+=this.direction;
OpenLayers.Control.prototype.initialize.apply(this,[a])},trigger:function(){var a=OpenLayers.Function.bind(function(b){return this.slideRatio?this.map.getSize()[b]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0);break}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn(),new OpenLayers.Control.ZoomToMaxExtent(),new OpenLayers.Control.ZoomOut()])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(d,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation()]);var a=[new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"})];this.addControls(a)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);if(this.defaultControl===null){this.defaultControl=this.controls[0]}return a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["locationupdated","locationfailed","locationuncapable"],geolocation:navigator.geolocation,bind:true,watch:false,geolocationOptions:null,initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.Geolocate.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);this.geolocationOptions={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(!this.geolocation){this.events.triggerEvent("locationuncapable");return false}if(OpenLayers.Control.prototype.activate.apply(this,arguments)){if(this.watch){this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions)}else{this.getCurrentLocation()}return true}return false},deactivate:function(){if(this.active&&this.watchId!==null){this.geolocation.clearWatch(this.watchId)}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(b){var a=new OpenLayers.LonLat(b.coords.longitude,b.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());if(this.bind){this.map.setCenter(a)}this.events.triggerEvent("locationupdated",{position:b,point:new OpenLayers.Geometry.Point(a.lon,a.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return false}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return true},failure:function(a){this.events.triggerEvent("locationfailed",{error:a})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))
},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(b){var e;if(!b){b=(OpenLayers.BROWSER_NAME=="msie")?navigator.userLanguage:navigator.language}var d=b.split("-");d[0]=d[0].toLowerCase();if(typeof OpenLayers.Lang[d[0]]=="object"){e=d[0]}if(d[1]){var a=d[0]+"-"+d[1].toUpperCase();if(typeof OpenLayers.Lang[a]=="object"){e=a}}if(!e){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+d.join("-")+" dictionary, falling back to default language");e=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=e},translate:function(b,a){var e=OpenLayers.Lang[OpenLayers.Lang.getCode()];var d=e&&e[b];if(!d){d=b}if(a){d=OpenLayers.String.format(d,a)}return d}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",proxyNeeded:"You probably need to set OpenLayers.ProxyHost to access ${url}.See http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost",end:""};/* This is a packed Oskari bundle (bundle script version Tue Feb 28 2012 09:33:11 GMT+0200 (Suomen normaaliaika)) */ 
/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.tools.Yui",function(){this.bundle_manager=Oskari.bundle_manager;this.excludeTags={mapframework:true},this.langs={fi:true,sv:true,en:true},this.flushPackFiles()},{flushPackFiles:function(){this.packedFiles=[];this.packedLocales={};for(l in this.langs){this.packedLocales[l]=[]}},setExcludeTags:function(a){this.excludeTags=a},getBundleTags:function(a){return this.bundle_manager.stateForBundleDefinitions[a].metadata.manifest["Bundle-Tag"]||{}},shallExclude:function(a){var b=this;var c=b.excludeTags;for(p in a){if(c[p]){return true}}return false},defaultCompressorJar:'"../tools/bundle/yui/yuicompressor-2.4.6.jar"',yui_command_line:function(j,k,g){var i=this;var c=i.bundle_manager.sources[j];var m="";m+="md build\n";var f="bundle.js";m+="java -jar "+k+" --charset UTF-8 --line-break 4096 --type js "+f+" > build/bundle-yui.js\n";m+="echo /* This is a packed Oskari bundle (bundle script version "+(new Date())+") */ > build/yui.js\n";m+="echo /* This is a unpacked Oskari bundle (bundle script version "+(new Date())+") */ > build/yui-pack.js\n";for(var d=0;d<c.scripts.length;d++){var b=c.scripts[d];var a=new String(b.src);var e="text/javascript"==b.type?"js":"css";if("css"==e){continue}while(a.indexOf("/")!=-1){a=a.replace("/","\\")}m+='type "'+a+'" >> build/yui-pack.js\n'}m+="java -jar "+k+" --charset UTF-8 --line-break 4096 --type js build/yui-pack.js >> build/yui.js\n";this.packedFiles.push(g+"/build/yui.js");for(l in this.langs){if(!this.langs[l]){continue}m+="echo /* This is a unpacked Oskari bundle (bundle script version "+(new Date())+") */ > build/yui-pack-locale-"+l+".js\n"}if(c.locales){for(var d=0;d<c.locales.length;d++){var b=c.locales[d];var h=b.lang;var a=new String(b.src);var e="text/javascript"==b.type?"js":"css";if("css"==e){continue}while(a.indexOf("/")!=-1){a=a.replace("/","\\")}m+='type "'+a+'" >> build/yui-pack-locale-'+h+".js\n"}}for(l in this.langs){if(!this.langs[l]){continue}m+="java -jar "+k+" --charset UTF-8 --line-break 4096 --type js build/yui-pack-locale-"+l+".js >> build/yui-locale-"+l+".js\n";this.packedLocales[l].push(g+"/build/yui-locale-"+l+".js")}return m},yui_command_lines:function(a){var d=this;var c={};for(bndlName in d.bundle_manager.sources){var f=d.getBundleTags(bndlName);if(d.shallExclude(f)){continue}var b=Oskari.bundle_manager.stateForBundleDefinitions[bndlName].bundlePath;var e="";e+='pushd "'+b+'"\n';e+=d.yui_command_line(bndlName,a,b);e+="popd\n";c[bndlName]=e}return c},yui_command_line_for_app:function(h){var g=this;g.flushPackFiles();var f="SET CURRENT=%CD%\n";var d="SET YUICOMPRESSOR=%CURRENT%/"+this.defaultCompressorJar+"\n";var e=g.yui_command_lines(h);var c="";for(p in e){c+=e[p]}var i="";i+="md build\n";i+="echo /* This is a packed Oskari app (bundle script version "+(new Date())+") */ > build/yui-app.js\n";for(var b=0;b<this.packedFiles.length;b++){var a=this.packedFiles[b];while(a.indexOf("/")!=-1){a=a.replace("/","\\")}i+='type "'+a+'" >> build/yui-app.js\n'}for(l in this.langs){i+="echo /* This is a packed Oskari locale for app (bundle script version "+(new Date())+") */ > build/yui-app-locale-"+l+".js\n";for(var b=0;b<this.packedLocales[l].length;b++){var a=this.packedLocales[l][b];while(a.indexOf("/")!=-1){a=a.replace("/","\\")}i+='type "'+a+'" >> build/yui-app-locale-'+l+".js\n"}}return f+d+c+i},showYuiBuildCmd:function(){var a=this.yui_command_line_for_app("%YUICOMPRESSOR%");var b=window.open();b.document.write('<body ><pre style="font: 9pt Verdana;">'+a+"</body></pre>")}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesAvailableEvent",function(a,b,d,c,e){this._creator=null;this._features=b;this._op=e;this._mapLayer=a;this._mimeType=d;this._projCode=c},{__name:"FeaturesAvailableEvent",getName:function(){return this.__name},getFeatures:function(){return this._features},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMimeType:function(){return this._mimeType},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesGetInfoEvent",function(a,b,e,d,c,f){this._creator=null;this._lon=e;this._lat=d;this._mapLayer=a;this._mapLayers=b;this._projCode=c;this._op=f},{__name:"FeaturesGetInfoEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMapLayers:function(){return this._mapLayers},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerAddEvent",function(b,a,c){this._creator=null;this._mapLayer=b;this._keepLayersOrder=a;if(c){this._isBasemap=c}else{this._isBasemap=false}},{__name:"AfterMapLayerAddEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerRemoveEvent",function(a){this._creator=null;this._mapLayer=a},{__name:"AfterMapLayerRemoveEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterGetFeatureInfoEvent",function(a,b){this._creator=null;this._response=a;this._wfsSelected=b},{__name:"AfterGetFeatureInfoEvent",getName:function(){return this.__name},getResponse:function(){return this._response},isWfsSelected:function(){return this._wfsSelected}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapMoveEvent",function(d,c,b,a,e){this._creator=null;this._centerX=d;this._centerY=c;this._zoom=b;this._marker=a;this._scale=e},{__name:"AfterMapMoveEvent",getName:function(){return this.__name},getCreator:function(){return this._creator},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getScale:function(){return this._scale}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.MapMoveStartEvent",function(a,b){this._creator=null;this._x=a;this._y=b},{__name:"MapMoveStartEvent",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterShowMapLayerInfoEvent",function(a){this._creator=null;this._mapLayer=a},{__name:"AfterShowMapLayerInfoEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterDisableMapKeyboardMovementEvent",function(){this._creator=null},{__name:"AfterDisableMapKeyboardMovementEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterEnableMapKeyboardMovementEvent",function(){this._creator=null},{__name:"AfterEnableMapKeyboardMovementEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterHideMapMarkerEvent",function(){this._creator=null},{__name:"AfterHideMapMarkerEvent",getName:function(){return this.__name
}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.MouseHoverEvent",function(b,a){this._creator=null;this._lon=b;this._lat=a},{__name:"MouseHoverEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},set:function(b,a){this._lon=b;this._lat=a}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.action.ActionStatusesChangedEvent",function(a){this._creator=null;this._currentlyRunningActionsDescriptions=a},{__name:"ActionStatusesChangedEvent",getName:function(){return this.__name},getCurrentlyRunningActionsDescriptions:function(){return this._currentlyRunningActionsDescriptions}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.MapLayerEvent",function(a,b){this._creator=null;this._layerId=a;if(!this.operations[b]){throw"Unknown operation '"+b+"'"}this._operation=b},{__name:"MapLayerEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getOperation:function(){return this._operation},operations:{add:"add",remove:"remove",update:"update"}},{protocol:["Oskari.mapframework.event.Event"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-layer-methods",{findMapLayerFromAllAvailable:function(b){var a=this._core.findMapLayerFromAllAvailable(b);return a},findBaselayerBySublayerIdFromAllAvailable:function(b){var a=this._core.findBaselayerBySublayerIdFromAllAvailable(b);return a},findAllSelectedMapLayers:function(){var a=this._core.getAllSelectedLayers();return a.slice(0)},findMapLayerFromSelectedMapLayers:function(a){var b=this._core.findMapLayerFromSelectedMapLayers(a);return b},isLayerAlreadySelected:function(a){return this._core.isLayerAlreadySelected(a)},isWfsLayersSelected:function(){return this._core.isWfsLayersSelected()},findAllSelectedWFSMapLayers:function(){var a=this._core.getAllSelectedWfsLayers();return a},findAllHighlightedLayers:function(){var a=this._core.getAllHighlightedMapLayers();return a},isMapLayerHighLighted:function(c){var b=this.findAllHighlightedLayers();for(var a=0;a<b.length;a++){if(b[a].getId()==c){return true}}return false},allowMultipleHighlightLayers:function(a){this._core.allowMultipleHighlightLayers(a)}});Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-methods",{getMap:function(){return this._core.getMap()},syncMapState:function(e,d){var b=this._core.getMap();var c=b.getZoom();var a=b.isMarkerVisible();if(e===true&&c==12){this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(b.getX(),b.getY(),0,false))}this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(b.getX(),b.getY(),c,a));if(e===true){this._core.processRequest(this._core.getRequestBuilder("ClearHistoryRequest")())}},isMapFullScreenMode:function(){return this._core.isMapFullScreenMode()},generatePublishedMapLinkToFinnishGeoportalPage:function(){return this._core.generatePublishedMapLinkToFinnishGeoportalPage()},doSniffing:function(a){if(!a){a=this._core.getAllSelectedLayers()}this._core.doSniffing(a)}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.service.UsageSnifferService",function UsageSnifferService(b,a){this._sendInterval=b;this._snifferEndpoint=a;this._currentStatistics=[]},{__qname:"Oskari.mapframework.service.UsageSnifferService",getQName:function(){return this.__qname},__name:"UsageSnifferService",getName:function(){return this.__name},startSniffing:function(){var a=this;setInterval(function(){a.sendData()},this._sendInterval*1000);delete this._currentStatistics;this._currentStatistics=new Array()},sendData:function(){var b=this._currentStatistics;for(var a=0;a<b.length;a++){jQuery.get(b[a],function(d,e,c){})}this._currentStatistics=[]},registerMapMovement:function(d,a,e,j,h,f){for(var b=0;b<d.length;b++){var c=d[b];var g=c.getId();g+="?lon="+a+"&lat="+e+"&zoom="+j+"&bbox="+h;if(f!=null&&f!=""){g+="&mapId="+f}this._currentStatistics.push(this._snifferEndpoint+g)}}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.service.GetFeatureInfoService",function(){},{__qname:"Oskari.mapframework.service.GetFeatureInfoService",getQName:function(){return this.__qname},__name:"GetFeatureInfoService",getName:function(){return this.__name},doGetFeatureInfo:function(f,d,c,i,b,h,e,g){var a="REQUEST=GetFeatureInfo&EXCEPTIONS=application/vnd.ogc.se_xml&BBOX="+bbox+"&X="+f+"&Y="+d+"&INFO_FORMAT="+c+"&QUERY_LAYERS="+i+"&WIDTH="+b+"&HEIGHT="+h+"&FEATURE_COUNT=1";jQuery.ajax({dataType:"text",type:"POST",url:e,data:a,success:g})}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.service.MapLayerServiceModelBuilder",function(){},{parseLayerData:function(c,b,a){}});Oskari.clazz.define("Oskari.mapframework.service.MapLayerService",function(b,a){this._mapLayerUrl=b;this._sandbox=a;this._loadedLayersList=new Array();this._reservedLayerIds={};this.typeMapping={wmslayer:"Oskari.mapframework.domain.WmsLayer",wmtslayer:"Oskari.mapframework.wmts.domain.WmtsLayer",wfslayer:"Oskari.mapframework.domain.WfsLayer",vectorlayer:"Oskari.mapframework.domain.VectorLayer"},this.modelBuilderMapping={}},{__qname:"Oskari.mapframework.service.MapLayerService",getQName:function(){return this.__qname},__name:"MapLayerService",getName:function(){return this.__name},addLayer:function(b,a){this.checkForDuplicateId(b.getId(),b.getName());this._reservedLayerIds[b.getId()]=true;this._loadedLayersList.push(b);if(a!==true){var c=this._sandbox.getEventBuilder("MapLayerEvent")(b.getId(),"add");this._sandbox.notifyAll(c)}},removeLayer:function(a,b){var d=null;for(var c=0;c<this._loadedLayersList.length;c++){if(this._loadedLayersList[c].getId()==a){d=this._loadedLayersList[c];this._loadedLayersList.splice(c,1);break}}if(d&&b!==true){var e=this._sandbox.getEventBuilder("MapLayerEvent")(d.getId(),"remove");this._sandbox.notifyAll(e)}this._reservedLayerIds[a]=false},updateLayer:function(a,d){var b=this.findMapLayer(a);if(b){b.setName(d.name);var c=this._sandbox.getEventBuilder("MapLayerEvent")(b.getId(),"update");this._sandbox.notifyAll(c)}},loadAllLayers:function(){throw"TBD: loading not implemented"},loadAllLayersAjax:function(b,a){var c=this;jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(d){if(d&&d.overrideMimeType){d.overrideMimeType("application/j-son;charset=UTF-8")}},url:this._mapLayerUrl,success:function(d){c._loadAllLayersAjaxCallBack(d,b)},error:function(){if(a){a()}}})},_loadAllLayersAjaxCallBack:function(f,c){var e=f.layers;for(var b=0;b<e.length;b++){var a=this.createMapLayer(e[b]);if(this._reservedLayerIds[a.getId()]!==true){this.addLayer(a,true)}}var d=this._sandbox.getEventBuilder("MapLayerEvent")(null,"add");this._sandbox.notifyAll(d);if(c){c()}},getAllLayers:function(){var a=Oskari.$().sandbox.getLanguage();return this._loadedLayersList},getAllLayersByMetaType:function(c){var d=[];for(var b=0;b<this._loadedLayersList.length;++b){var a=this._loadedLayersList[b];if(a.getMetaType&&a.getMetaType()===c){d.push(a)}}return d},registerLayerModel:function(b,a){this.typeMapping[b]=a},unregisterLayerModel:function(a){this.typeMapping[a]=undefined},registerLayerModelBuilder:function(a,b){this._sandbox.printDebug("[MapLayerService] registering handler for type "+a);
this.modelBuilderMapping[a]=b},unregisterLayerModelBuilder:function(a){this.modelBuilderMapping[a]=undefined},createMapLayer:function(b){var a=null;if(b.type=="base"){a=this._createGroupMapLayer(b,true)}else{if(b.type=="groupMap"){a=this._createGroupMapLayer(b,false)}else{a=this._createActualMapLayer(b)}}return a},_createGroupMapLayer:function(e,f){var a=Oskari.clazz.create("Oskari.mapframework.domain.WmsLayer");if(f){a.setAsBaseLayer()}else{a.setAsGroupLayer()}a.setVisible(true);a.setId(e.id);a.setName(e.name);a.setMaxScale(e.maxScale);a.setMinScale(e.minScale);a.setDataUrl(e.dataUrl);a.setOrganizationName(e.orgName);a.setInspireName(e.inspire);a.setFeatureInfoEnabled(false);if(e.permissions){for(var d in e.permissions){a.addPermission(d,e.permissions[d])}}for(var c=0;c<e.subLayer.length;c++){var b=this._createActualMapLayer(e.subLayer[c]);a.getSubLayers().push(b)}if(e.opacity!=null){a.setOpacity(e.opacity)}else{if(a.getSubLayers().length>0){a.setOpacity(a.getSubLayers()[0].getOpacity())}else{a.setOpacity(100)}}if(e.legendImage!=null&&e.legendImage!=""){a.setLegendImage(e.legendImage)}if(e.info!=null&&e.info!=""){a.setDescription(e.info)}return a},_createActualMapLayer:function(e){var c=null;var b=e.id;if(e!=null){if(!this.typeMapping[e.type]){throw"Unknown layer type '"+e.type+"'"}c=Oskari.clazz.create(this.typeMapping[e.type]);if(e.type=="wmslayer"){this._populateWmsMapLayerAdditionalData(c,e)}else{if(e.type=="wmtslayer"){this._populateWmtsMapLayerAdditionalData(c,e)}else{if(e.type=="vectorlayer"){c.setStyledLayerDescriptor(e.styledLayerDescriptor)}}}if(e.metaType&&c.setMetaType){c.setMetaType(e.metaType)}c.setAsNormalLayer();c.setId(b);c.setName(e.name);c.setOpacity(e.opacity);c.setMaxScale(e.maxScale);c.setMinScale(e.minScale);c.setDescription(e.subtitle);c.setDataUrl(e.dataUrl);c.setOrganizationName(e.orgName);c.setInspireName(e.inspire);c.setOrderNumber(e.orderNumber);c.setVisible(true);c.setGeometryWKT(e.geom);if(e.permissions){for(var d in e.permissions){c.addPermission(d,e.permissions[d])}}var a=this.modelBuilderMapping[e.type];if(a){a.parseLayerData(c,e,this)}}else{}return c},_populateWmsMapLayerAdditionalData:function(d,b){d.setWmsName(b.wmsName);if(b.wmsUrl){var a=b.wmsUrl.split(",");for(var c=0;c<a.length;c++){d.addWmsUrl(a[c])}}d.setFeatureInfoEnabled(b.gfi!=="disabled");return this._populateStyles(d,b)},_populateWmtsMapLayerAdditionalData:function(c,a){c.setWmtsName(a.wmtsName);if(a.wmtsUrl){var d=a.wmtsUrl.split(",");for(var b=0;b<d.length;b++){c.addWmtsUrl(d[b])}}return this._populateStyles(c,a)},_populateStyles:function(d,a){var g=Oskari.clazz.builder("Oskari.mapframework.domain.Style");if(a.styles){for(var c=0;c<a.styles.length;c++){var f=a.styles;var b=!(isNaN(c));if(b){f=a.styles[c]}var e=g();e.setName(f.name);e.setTitle(f.title);e.setLegend(f.legend);d.addStyle(e);if(!b){break}}d.selectStyle(a.style)}if(d.getStyles().length==0){var e=g();e.setName("");e.setTitle("");e.setLegend("");d.addStyle(e);d.selectStyle("")}d.setQueryable(a.isQueryable);d.setLegendImage(a.legendImage);d.setDataUrl(a.dataUrl);d.setQueryFormat(a.formats.value);return d},checkForDuplicateId:function(c,b){if(this._reservedLayerIds[c]===true){var a=this.findMapLayer(c);throw"Trying to add map layer with id '"+c+" ("+b+")' but that id is already reserved for '"+a.getName()+"'"}},findMapLayer:function(g,f){if(!f){f=this._loadedLayersList}for(var d=0;d<f.length;d++){var c=f[d];if(c.getId()==g){return c}}for(var d=0;d<f.length;d++){var c=f[d];var e=c.getSubLayers();for(var a=0;a<e.length;a++){var b=this.findMapLayer(g,e);if(b!=null){return b}}}return null}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.service.SearchService",function(a){this._searchUrl=a},{__qname:"Oskari.mapframework.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(a,d,b){var c=Oskari.getLang();jQuery.ajax({dataType:"json",type:"POST",url:this._searchUrl,data:"searchKey="+a+"&Language="+c,complete:b,success:d})}},{protocol:["Oskari.mapframework.service.Service"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.sandbox.Sandbox",function(a){this._core=a;this._listeners=new Array();this._modules=new Array();this._modulesByName={};this._statefuls={};this.debugRequests=true;this.debugEvents=true;this.requestEventLog=[];this.requestEventStack=[];this.gatherDebugRequests=true;this.maxGatheredRequestsAndEvents=4096;this.requestAndEventGather=[];this._user=null;this._ajaxUrl=null},{disableDebug:function(){this.debugRequests=false;this.debugEvents=false;this.gatherDebugRequests=false},printDebug:function(a){this._core.printDebug(a)},setUser:function(a){this._user=Oskari.clazz.create("Oskari.mapframework.domain.User",a)},getUser:function(){if(!this._user){this.setUser()}return this._user},setAjaxUrl:function(a){this._ajaxUrl=a},getAjaxUrl:function(){return this._ajaxUrl},printWarn:function(a){this._core.printWarn(a)},getText:function(a,b){alert("sandbox.getText() is deprecated - Use new locale system instead");return this._core.getText(a,b)},getService:function(a){return this._core.getService(a)},showPopupText:function(a,c,b){return this._core.showPopupText(a,c,b)},registerAsStateful:function(b,a){this._statefuls[b]=a},unregisterStateful:function(a){this._statefuls[a]=null;delete this._statefuls[a]},getStatefulComponents:function(){return this._statefuls},register:function(a){this._modules.push(a);this._modulesByName[a.getName()]=a;this._core.registerFrameworkComponentToRuntimeEnvironment(a,a.getName());return a.init(this)},unregister:function(c){var b=[];for(var a=0;a<this._modules.length;a++){if(c===this._modules[a]){continue}b.push(this._modules[a])}this._modules=b;this._modulesByName[c.getName()]=undefined;this._core.unregisterFrameworkComponentFromRuntimeEnvironment(c,c.getName())},registerForEvent:function(c,d){var b=d.getName();this._core.printDebug("Sandbox is registering module '"+c.getName()+"' to event '"+b+"'");var a=this._listeners[b];if(a==null){a=new Array();this._listeners[b]=a}a.push(c);this._core.printDebug("There are currently "+a.length+" listeners for event '"+b+"'");delete d},registerForEventByName:function(c,b){this._core.printDebug("#*#*#* Sandbox is registering module '"+c.getName()+"' to event '"+b+"'");var a=this._listeners[b];if(a==null){a=new Array();this._listeners[b]=a}a.push(c);this._core.printDebug("There are currently "+a.length+" listeners for event '"+b+"'")},unregisterFromEvent:function(d,e){var c=e.getName();this._core.printDebug("Sandbox is unregistering module '"+d.getName()+"' from event '"+c+"'");var a=this._listeners[c];if(a==null){}var b=a.indexOf(d);if(b>-1){a.splice(b,1);this._core.printDebug("Module unregistered successfully from event")}else{this._core.printDebug("Module does not listen to that event, skipping.")}delete e},unregisterFromEventByName:function(e,c){this._core.printDebug("Sandbox is unregistering module '"+e.getName()+"' from event '"+c+"'");var a=this._listeners[c];if(a==null){}var b=-1;for(var f=0;f<a.length;f++){if(a[f]==e){b=f;break}}if(b>-1){a.splice(b,1);this._core.printDebug("Module unregistered successfully from event")}else{this._core.printDebug("Module does not listen to that event, skipping.")}},startModules:function(){var a=this._modules.length;for(var c=0;c<a;c++){var b=this._modules[c];b.start(this)}},getRequestBuilder:function(a){return this._core.getRequestBuilder(a)},getEventBuilder:function(a){return this._core.getEventBuilder(a)},eventLoopGuard:0,debugPushRequest:function(b,c){if(!this.debugRequests){return}var a={from:b,reqName:c.getName()};this.requestEventStack.push(a);this.requestEventLog.push(a);if(this.requestEventLog.length>64){this.requestEventLog.shift()}},debugPopRequest:function(){if(!this.debugRequests){return}this.requestEventStack.pop()},debugPushEvent:function(b,c,a){if(!this.debugEvents){return}this.eventLoopGuard++;if(this.eventLoopGuard>64){throw"Events Looped?"}var d={from:b,to:c.getName(),evtName:a.getName()};this.requestEventStack.push(d);this.requestEventLog.push(d);if(this.requestEventLog.length>64){this.requestEventLog.shift()}},debugPopEvent:function(){if(!this.debugEvents){return}this.eventLoopGuard--;
this.requestEventStack.pop()},ajax:function(c,g,b,a,e){if(Ext&&Ext.Ajax&&Ext.Ajax.request){Ext.Ajax.request({url:c,success:g,failure:b})}else{if(jQuery&&jQuery.ajax){var f=function(h){var i={responseText:h};g(i)};var d="GET";if(e){d="POST"}jQuery.ajax({type:d,url:c,beforeSend:function(h){if(h&&h.overrideMimeType){h.overrideMimeType("application/j-son;charset=UTF-8")}},success:f,error:b})}else{alert("Couldn't make ajax call")}}},request:function(b,c){var a=null;if(b.getName!=null){a=this.findRegisteredModule(b.getName())}else{a=this.findRegisteredModule(b)}if(a==null){throw"Attempt to create request with unknown component '"+b+"' as creator"}this._core.setObjectCreator(c,a);this.printDebug("Module '"+a+"' is requesting for '"+this.getObjectName(c)+"'...");if(this.gatherDebugRequests){this.pushRequestAndEventGather(a+"->Sandbox: ",this.getObjectName(c))}var d=null;this.debugPushRequest(a,c);d=this._core.processRequest(c);this.debugPopRequest();return d},requestByName:function(b,g,f){this.printDebug("#!#!#! --------------> requestByName "+g);var e=this.getRequestBuilder(g);var c=e.apply(this,f);var a=null;if(b.getName!=null){a=this.findRegisteredModule(b.getName())}else{a=this.findRegisteredModule(b)}if(a==null){throw"Attempt to create request with unknown component '"+b+"' as creator"}this._core.setObjectCreator(c,a);this.printDebug("Module '"+a+"' is requesting for '"+this.getObjectName(c)+"'...");if(this.gatherDebugRequests){this.pushRequestAndEventGather(a+"->Sandbox: ",this.getObjectName(c))}var d=null;this.debugPushRequest(a,c);d=this._core.processRequest(c);this.debugPopRequest();return d},postRequestByName:function(c,b){var a=this;window.setTimeout(function(){a.printDebug("#!#!#! POSTING --------------> requestByName "+c);var g=a.getRequestBuilder(c);var e=g.apply(a,b);var d="postmaster";a._core.setObjectCreator(e,d);a.printDebug("Module '"+d+"' is POSTING a request for '"+a.getObjectName(e)+"'...");if(a.gatherDebugRequests){a.pushRequestAndEventGather(d+"->Sandbox: ",a.getObjectName(e))}var f=null;a.debugPushRequest(d,e);f=a._core.processRequest(e);a.debugPopRequest()},10)},findModulesInterestedIn:function(c){var a=c.getName();var b=this._listeners[a];return b},notifyAll:function(e,f){var a;if(!f){a=e.getName();this._core.printDebug("Sandbox received notifyall for event '"+a+"'")}var b=this.findModulesInterestedIn(e);if(b!=null){if(!f){this._core.printDebug("Found "+b.length+" interested modules")}for(var d=0;d<b.length;d++){var c=b[d];if(!f){this._core.printDebug("Notifying module '"+c.getName()+"'.");if(this.gatherDebugRequests){this.pushRequestAndEventGather("Sandbox->"+c.getName()+":",a)}}this.debugPushEvent(this.getObjectCreator(e),c,e);c.onEvent(e);this.debugPopEvent()}}else{if(!f){this._core.printDebug("No interested modules found.")}}if(!f){delete e}},findRegisteredModuleInstance:function(a){return this._modulesByName[a]},findRegisteredModule:function(a){return this._modulesByName[a]?this._modulesByName[a].getName():null},getRequestParameter:function(a){return this._core.getRequestParameter(a)},getLanguage:function(){return this._core.getLanguage()},getBrowserWindowSize:function(){return this._core.getBrowserWindowSize()},getObjectName:function(a){return this._core.getObjectName(a)},getObjectCreator:function(a){return this._core.getObjectCreator(a)},setObjectCreator:function(b,a){return this._core.setObjectCreator(b,a)},copyObjectCreatorToFrom:function(b,a){return this._core.copyObjectCreatorToFrom(b,a)},addRequestHandler:function(b,a){return this._core.addRequestHandler(b,a)},removeRequestHandler:function(b,a){return this._core.removeRequestHandler(b,a)},pushRequestAndEventGather:function(a,c){var b={};b.name=a;b.request=c;this.requestAndEventGather.push(b);if(this.requestAndEventGather.length>this.maxGatheredRequestsAndEvents){this.requestAndEventGather.shift()}},popUpSeqDiagram:function(){var b='<html><head></head><body><div class=wsd wsd_style="modern-blue" ><pre>';var a="";for(x in this.requestAndEventGather){a+=this.requestAndEventGather[x].name+this.requestAndEventGather[x].request+"\n"}if(a!=""){b+=a+'</pre></div><script type="text/javascript" src="http://www.websequencediagrams.com/service.js"><\/script></body>';
var c=window.open();c.document.write(b);this.requestAndEventGather=[]}else{alert("No requests in queue")}}});Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","key-listener-methods",{isCtrlKeyDown:function(){return this._core.isCtrlKeyDown()}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.request.common.DisableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"DisableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.EnableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"EnableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.AddMapLayerRequest",function(b,a,d,c){this._creator=null;this._mapLayerId=b;this._keepLayersOrder=(a==true);this._isExternal=(c==true);this._isBasemap=(d==true)},{__name:"AddMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap},isExternal:function(){return this._isExternal}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.RemoveMapLayerRequest",function(a){this._creator=null;this._mapLayerId=a},{__name:"RemoveMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.GetFeatureInfoRequest",function(b,a,e,i,g,c,d,f,h){this._creator=null;this._mapLayers=b;this._lon=a;this._lat=e;this._x=i;this._y=g;this._mapWidth=c;this._mapHeight=d;this._bbox=f;this._srs=h},{__name:"GetFeatureInfoRequest",getName:function(){return this.__name},getMapLayers:function(){return this._mapLayers},getLon:function(){return this._lon},getLat:function(){return this._lat},getX:function(){return this._x},getY:function(){return this._y},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getBoundingBox:function(){return this._bbox},getSRS:function(){return this._srs}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.MapMoveRequest",function(d,c,b,a){this._creator=null;this._centerX=d;this._centerY=c;this._zoom=b;this._marker=a},{__name:"MapMoveRequest",getName:function(){return this.__name},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapLayerInfoRequest",function(a){this._creator=null;this._mapLayerId=a},{__name:"ShowMapLayerInfoRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.HideMapMarkerRequest",function(){this._creator=null},{__name:"HideMapMarkerRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyDownRequest",function(){this._creator=null},{__name:"CtrlKeyDownRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyUpRequest",function(){this._creator=null},{__name:"CtrlKeyUpRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.category("Oskari.mapframework.core.Core","feature-info-methods",{handleGetFeatureInfoRequest:function(d){this.printDebug("Handling OF getFeatureInfo TB refactored...");if(this.getMap().isMoving()){return}var j=false;if(d.getMapLayers().length==1){if(d.getMapLayers()[0].isLayerOfType("WFS")){j=true}}if(d.getMapLayers().length>0&&!j){var b=this.getEventBuilder("AfterGetFeatureInfoEvent")(true,false);this.copyObjectCreatorToFrom(b,d);this.dispatch(b);for(var e=0;e<d.getMapLayers().length;e++){this.actionInProgressGetFeatureInfo();var f=d.getMapLayers()[e];var g=f.getName();var m=f.getQueryFormat();if(f.getQueryable()==true&&m!=""&&m!=null&&!(f.isLayerOfType("WFS"))){var c=f.getWmsUrls()[0];if(c.indexOf("?")<0){c=c+"?"}var l=d.getBoundingBox().left+","+d.getBoundingBox().bottom+","+d.getBoundingBox().right+","+d.getBoundingBox().top;c=c+"REQUEST=GetFeatureInfo&EXCEPTIONS=application/vnd.ogc.se_xml&SRS="+d.getSRS()+"&VERSION=1.1.1&BBOX="+l+"&X="+d.getX()+"&Y="+d.getY()+"&INFO_FORMAT="+m+"&QUERY_LAYERS="+f.getWmsName()+"&WIDTH="+d.getMapWidth()+"&HEIGHT="+d.getMapHeight()+"&FEATURE_COUNT=1&FORMAT=image/png&SERVICE=WMS&STYLES="+f.getCurrentStyle().getName()+"&LAYERS="+f.getWmsName();var k=Oskari.$().startup.useGetFeatureInfoProxy;if(k!=null&&k=="true"){c="/cgi-bin/proxy.cgi?url="+encodeURIComponent(c)}var a=function(i,o){this._name=i;this._format=o;this.parseOkMessage=function(p){var q=this.parseInfoResponse(p,this._format);var r=this.getEventBuilder("AfterAppendFeatureInfoEvent")(i,q);this.copyObjectCreatorToFrom(r,d);this.dispatch(r)};this.parseFailedMessage=function(p){var q=this.getEventBuilder("AfterAppendFeatureInfoEvent")(i,p.responseText);this.copyObjectCreatorToFrom(q,d);this.dispatch(q)}};var n=new a(g,m);Ext.Ajax.request({url:c,scope:this,success:n.parseOkMessage,failure:n.parseFailedMessage})}else{var h="";h=this.getText("rightpanel_wms_getfeatureinfo_not_supported_txt")+": "+g+".";var b=this.getEventBuilder("AfterAppendFeatureInfoEvent")(g,h);this.copyObjectCreatorToFrom(b,d);this.dispatch(b)}}this.parseInfoResponse=function(o,p){var i;if(p=="application/vnd.ogc.gml"||p=="application/vnd.ogc.se_xml"){i=this.renderInfoGML(o)}else{if(p=="application/vnd.ogc.wms_xml"||p=="text/xml"){i=this.renderInfoXML(o)}else{i='<div style="font: 11px Tahoma, Arial, Helvetica, sans-serif;">'+o.responseText+"</div>";if(o.responseText==""){i=this.getText("mapcontrolsservice_not_found_wms_feature_info")}}}if(i==""||i=="<table></table>"){i=this.getText("mapcontrolsservice_not_found_wms_feature_info")}return i};this.renderInfoGML=function(i){return i.responseText.replace(/</g,"&lt;").replace(/>/g,"&gt;")};this.renderInfoXML=function(i){return i.responseText.replace(/</g,"&lt;").replace(/>/g,"&gt;")}}else{var b=this.getEventBuilder("AfterGetFeatureInfoEvent")(false,j);this.copyObjectCreatorToFrom(b,d);this.dispatch(b)}}});Oskari.clazz.category("Oskari.mapframework.core.Core","map-layer-methods",{findMapLayer:function(f,e){if(!e){return null}for(var c=0;c<e.length;c++){var b=e[c];if(b.getId()==f){return b}var d=b.getSubLayers();var a=this.findMapLayer(f,d);if(a!=null){return a}}return null},isLayerAlreadySelected:function(b){var a=this.findMapLayer(b,this._selectedLayers);return(a!=null)},findMapLayerFromSelectedMapLayers:function(a){return this.findMapLayer(a,this._selectedLayers)},isMapLayerAlreadyHighlighted:function(b){var a=this.findMapLayer(b,this._mapLayersHighlighted);if(a==null){this.printDebug("[core-map-layer-methods] "+b+" is not yet highlighted.")}return(a!=null)},handleAddMapLayerRequest:function(g){var d=g.getMapLayerId();var e=g.getKeepLayersOrder();var b=g.isBasemap();this.printDebug("Trying to add map layer with id '"+d+"' AS "+(b?" BASE ":" NORMAL "));if(this.isLayerAlreadySelected(d)){this.printDebug("Attempt to select already selected layer '"+d+"'");return}var k=this.findMapLayerFromAllAvailable(d);if(!k){return}this.printDebug("MAPLAYER isBaseLayer WAS "+k.isBaseLayer());if(b==true){k.setType("BASE_LAYER")}this.printDebug("MAPLAYER isBaseLayer IS "+k.isBaseLayer());if(e!=null&&e){this._selectedLayers.push(k)
}else{if(k.isBaseLayer()||b==true){var j=this._selectedLayers;var c=new Array();c.push(k);for(var h=0;h<j.length;h++){c.push(j[h])}delete this._selectedLayers;this._selectedLayers=c}else{this._selectedLayers.push(k)}}var a=this.getEventBuilder("AfterMapLayerAddEvent")(k,e,b);this.copyObjectCreatorToFrom(a,g);this.dispatch(a);var f=new Array();f.push(k);this.doSniffing(f)},handleRemoveMapLayerRequest:function(d){var g=d.getMapLayerId();this.printDebug("Trying to remove map layer with id '"+g+"'");if(!this.isLayerAlreadySelected(g)){this.printDebug("Attempt to remove layer '"+g+"' that is not selected.");return}var a=this.findMapLayerFromAllAvailable(g);var b=-1;for(var f=0;f<this._selectedLayers.length;f++){if(this._selectedLayers[f]===a){b=f}}this._selectedLayers.splice(b,1);if(this.isMapLayerAlreadyHighlighted(g)){this.printDebug("Maplayer is also highlighted, removing it from highlight list.");if(this._allowMultipleHighlightLayers==true){this.destroyOneHighLightedMapLayers(g)}else{this.destroyAllHighLightedMapLayers()}}if(a.isLayerOfType("WFS")){var e=this.getService("Oskari.mapframework.service.OgcSearchService");e.removeWFsLayerRequests(a);e.removeWFSLayerGridRequests(a)}var c=this.getEventBuilder("AfterMapLayerRemoveEvent")(a);this.copyObjectCreatorToFrom(c,d);this.dispatch(c)},findMapLayerFromAllAvailable:function(c){var a=this.getService("Oskari.mapframework.service.MapLayerService");var b=a.findMapLayer(c);if(b==null){this.printDebug("Cannot find map layer with id '"+c+"' from all available. Check that current user has VIEW permissions to that layer.")}return b},findBaselayerBySublayerIdFromAllAvailable:function(g){var e=null;var a=this.getService("Oskari.mapframework.service.MapLayerService");var c=a.getAllLayers();for(var d=0;d<c.length;d++){if(c[d].isBaseLayer()){for(var b=0;b<c[d].getSubLayers().length;b++){var f=c[d].getSubLayers()[b];if(f.getId()==g){e=c[d];break}}}if(e!=null){break}}return e},findMapLayerFromSelected:function(b){var a=this.findMapLayer(b,this._selectedLayers);if(a==null){this.printDebug("Cannot find map layer with id '"+b+"' from selected layers")}return a},handleShowMapLayerInfoRequest:function(c){var a=this.findMapLayerFromAllAvailable(c.getMapLayerId());var b=this.getEventBuilder("AfterShowMapLayerInfoEvent")(a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)},handleRearrangeSelectedMapLayerRequest:function(f){var d=f.getToPosition();var e=f.getMapLayerId();var g=null;var l=0;if(e!=null&&d!=null){g=this.findMapLayerFromSelected(e);var b=new Array();var c=0;var k=0;for(var h=0;c<d;h++){k++;var j=this._selectedLayers[h];if(j.getId()==e){l=h;continue}b.push(j);c++}b.push(g);for(var h=k;h<this._selectedLayers.length;h++){var j=this._selectedLayers[h];if(j.getId()==e){l=h;continue}b.push(j)}delete this._selectedLayers;this._selectedLayers=b}var a=this.getEventBuilder("AfterRearrangeSelectedMapLayerEvent")(g,l,d);this.copyObjectCreatorToFrom(a,f);this.dispatch(a)},handleChangeMapLayerOpacityRequest:function(c){var a=this.findMapLayerFromSelected(c.getMapLayerId());if(!a){return}a.setOpacity(c.getOpacity());var b=this.getEventBuilder("AfterChangeMapLayerOpacityEvent")(a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)},handleChangeMapLayerStyleRequest:function(c){var a=this.findMapLayerFromSelected(c.getMapLayerId());if(!a){return}if(c.getStyle()!="!default!"){a.selectStyle(c.getStyle());var b=this.getEventBuilder("AfterChangeMapLayerStyleEvent")(a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)}},getAllSelectedLayers:function(){return this._selectedLayers},getAllSelectedWfsLayers:function(){var a=[];if(this._selectedLayers!=null){for(var b=0;b<this._selectedLayers.length;b++){if(this._selectedLayers[b].isLayerOfType("WFS")){a.push(this._selectedLayers[b])}}}return a},isWfsLayersSelected:function(){var a=this.getAllSelectedWfsLayers();return a.length>0},getAllHighlightedMapLayers:function(){return this._mapLayersHighlighted},destroyAllHighLightedMapLayers:function(){var b=this.getAllHighlightedMapLayers();for(var c=0;c<b.length;c++){var a=b[c];var d=this.getEventBuilder("AfterDimMapLayerEvent")(a);
this.dispatch(d)}this._mapLayersHighlighted=[]},destroyOneHighLightedMapLayers:function(d){var b=this.getAllHighlightedMapLayers();for(var c=0;c<b.length;c++){var a=b[c];if(a.getId()==d){b.splice(c);return}}},handleHighlightMapLayerRequest:function(g){var d=this.getObjectCreator(g);var a=this.getRequestBuilder("ToolSelectionRequest");var f=a("map_control_select_tool");this._sandbox.request(d,f);var h=g.getMapLayerId();this.printDebug("[core-map-layer-methods] Trying to highlight map layer with id '"+h+"'");if(this.isMapLayerAlreadyHighlighted(h)){this.printWarn("[core-map-layer-methods] Attempt to highlight already highlighted wms feature info map layer '"+h+"'");return}if(this._allowMultipleHighlightLayers==true){this.destroyOneHighLightedMapLayers(h)}else{this.destroyAllHighLightedMapLayers()}var c=this.findMapLayerFromSelected(h);if(!c){return}this._mapLayersHighlighted.push(c);this.printDebug("[core-map-layer-methods] Adding "+c+" ("+c.getId()+") to highlighted list.");var e=this.getEventBuilder("AfterHighlightMapLayerEvent")(c);this.copyObjectCreatorToFrom(e,g);this.dispatch(e)},handleDimMapLayerRequest:function(d){var a=d.getMapLayerId();if(this._allowMultipleHighlightLayers==true){this.destroyOneHighLightedMapLayers(a)}else{this.destroyAllHighLightedMapLayers()}var b=this.findMapLayerFromAllAvailable(a);if(!b){return}var c=this.getEventBuilder("AfterDimMapLayerEvent")(b);this.copyObjectCreatorToFrom(c,d);this.dispatch(c)},allowMultipleHighlightLayers:function(a){this._allowMultipleHighlightLayers=a}});Oskari.clazz.category("Oskari.mapframework.core.Core","map-methods",{updateMousePositionOnMap:function(a,c){var b=this._map;b.updateMousePosition(a,c)},handleEnableMapKeyboardMovementRequest:function(b){var c=this._map;c.setMapKeyboardMovementsEnabled(true);var a=this.getEventBuilder("AfterEnableMapKeyboardMovementEvent")();this.copyObjectCreatorToFrom(a,b);this.dispatch(a)},handleDisableMapKeyboardMovementRequest:function(b){var c=this._map;c.setMapKeyboardMovementsEnabled(false);var a=this.getEventBuilder("AfterDisableMapKeyboardMovementEvent")();this.copyObjectCreatorToFrom(a,b);this.dispatch(a)},doSniffing:function(f){if(this._doSniffing){var a=this.getService("Oskari.mapframework.service.UsageSnifferService");var h=new Array();var g=this._map.getScale();for(var e=0;e<f.length;e++){var d=f[e];for(var b=0;b<d.getSubLayers().length;b++){var c=d.getSubLayers()[b];if(c.isVisible()&&c.getMinScale()>=g&&c.getMaxScale()<=g){h.push(c)}}if(!d.isBaseLayer()&&d.isVisible()&&d.getMinScale()>=g&&d.getMaxScale()<=g){h.push(d)}}if(h.length>0){a.registerMapMovement(h,this._map.getX(),this._map.getY(),this._map.getZoom(),this._map.getBbox().toBBOX(),this._mapIdFromUrl)}}},handleStartMapPublisherRequest:function(b){if(this._mapPublisherWizardUrl==null){throw"User cannot move to wizard!"}var a=this.getEventBuilder("AfterStartMapPublisherEvent")(this._mapPublisherWizardUrl);this.copyObjectCreatorToFrom(a,b);this.dispatch(a)},handleGenerateHtmlLinkToMapRequest:function(b){var a=this.getEventBuilder("AfterGenerateHtmlLinkToMapEvent")(this.generateUrlToCurrentPage()+this.generateHtmlLinkParameters(this._map,this._selectedLayers,null));this.copyObjectCreatorToFrom(a,b);this.dispatch(a)},handleGenerateHtmlPrintToMapRequest:function(b){var a=this.getEventBuilder("AfterGenerateHtmlPrintToMapEvent")(this.generateUrlToPrintPage()+this.generateHtmlLinkParameters(this._map,this._selectedLayers,"print=true"));this.copyObjectCreatorToFrom(a,b);this.dispatch(a)},generateUrlToPrintPage:function(){var a=Oskari.$().startup.printUrl;if(a==null){throw"Print url is not set. Cannot print."}return a},generateUrlToCurrentPage:function(){var b=window.location.pathname;if(b.match(";")){b=b.substring(0,b.indexOf(";"))}var a=window.location.protocol+"//"+window.location.host+b;return a},generatePublishedMapLinkToFinnishGeoportalPage:function(){var b=new Array();for(var a=0;a<this._selectedLayers.length;a++){if(this._selectedLayers[a].isBaseLayer()){b.push(this._selectedLayers[a])}}for(var a=0;a<this._selectedLayers.length;a++){if(!this._selectedLayers[a].isBaseLayer()){b.push(this._selectedLayers[a])
}}return Oskari.$().startup.finnishGeoportalMapUrl+this.generateHtmlLinkParameters(this._map,b,"keepLayersOrder=false")},generateHtmlLinkParameters:function(c,f,d){var o=",";var e="+";var p=c.getZoom();var n=c.getX();var b=c.getY();var h="";for(var g=0;g<f.length;g++){var k=f[g];if(h.length>0){h+=o}var m=k.getOpacity();var a;if(k.isBaseLayer()||typeof k.getCurrentStyle!="function"||k.getCurrentStyle()==null||k.getCurrentStyle().getName()==null){a="!default!"}else{a=k.getCurrentStyle().getName()}h+=k.getId()+e+m+e+a}var l="false";if(c.isMarkerVisible()){l="true"}if(d!=null){d="&"+d}else{d=""}var j="?zoomLevel="+p+"&coord="+n+"_"+b+"&mapLayers="+h+"&showMarker="+l+"&forceCache=true"+d;return j},handleDrawPolygonRequest:function(c){var a=c.getPolygon();var b=this.getEventBuilder("AfterDrawPolygonEvent")(a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)},handleDrawSelectedPolygonRequest:function(c){var a=c.getPolygon();var b=this.getEventBuilder("AfterDrawSelectedPolygonEvent")(a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)},handleSelectPolygonRequest:function(c){var d=c.getId();var a=c.getGroupId();var b=this.getEventBuilder("AfterSelectPolygonEvent")(d,a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)},handleUpdateHiddenValueRequest:function(c){var a=c.getPolygon();var b=this.getEventBuilder("AfterUpdateHiddenValueEvent")(a);this.copyObjectCreatorToFrom(b,c);this.dispatch(b)},handleErasePolygonRequest:function(b){var c=b.getId();var a=this.getEventBuilder("AfterErasePolygonEvent")(c);this.copyObjectCreatorToFrom(a,b);this.dispatch(a)},handleRemovePolygonRequest:function(d){var e=d.getId();var a=d.getGroupId();var b=d.getShowPol();var c=this.getEventBuilder("AfterRemovePolygonEvent")(e,a,b);this.copyObjectCreatorToFrom(c,d);this.dispatch(c)},handleHideMapMarkerRequest:function(b){this._map.setMarkerVisible(false);var a=this.getEventBuilder("AfterHideMapMarkerEvent")();this.copyObjectCreatorToFrom(a,b);this.dispatch(a)}});Oskari.clazz.category("Oskari.mapframework.core.Core","status-methods",{handleActionReadyRequest:function(a){var b=a.getId();this._ongoingActions[b]=null;this.notifyModulesThatActionsHaveChanged(a);if(a.isWfsPngAction()){this._currentlyFetchingWfsTiles--}},handleActionStartRequest:function(a){var b=a.getId();this._ongoingActions[b]=a.getActionDescription();this.notifyModulesThatActionsHaveChanged(a);if(a.isWfsPngAction()){this._currentlyFetchingWfsTiles++}},notifyModulesThatActionsHaveChanged:function(e){var a={};for(var b in this._ongoingActions){var g=this._ongoingActions[b];if(g!=null){a[g]=g}}var f=new Array();for(var c in a){if(c!=null&&c!=undefined){f.push(c)}}var d=this.getEventBuilder("ActionStatusesChangedEvent")(f);this.copyObjectCreatorToFrom(d,e);this.dispatch(d)},actionInProgressWfsGrid:function(){var b=this.getText("status_wfs_update_grid");var a=this.getRequestBuilder("ActionStartRequest")("WFS_GRID",b,false);this.handleActionStartRequest(a)},actionInProgressSearch:function(){var b=this.getText("status_search");var a=this.getRequestBuilder("ActionStartRequest")("SEARCH",b,false);this.handleActionStartRequest(a)},actionInProgressGetFeatureInfo:function(){var b=this.getText("status_get_feature_info");var a=this.getRequestBuilder("ActionStartRequest")("GET_FEATURE_INFO",b,false);this.handleActionStartRequest(a)}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.domain.WmsLayer",function(){this._id=null;this._name=null;this._wmsLayerName=null;this._inspireName=null;this._organizationName=null;this._dataUrl=null;this._type=null;this._metaType=null;this._opacity=null;this._featureInfoEnabled=null;this._subLayers=[];this._styles=[];this._description=null;this._wmsUrls=[];this._dataUrl=null;this._legendImage=null;this._maxScale=null;this._minScale=null;this._queryable=null;this._currentStyle=null;this._visible=null;this._queryFormat=null;this._orderNumber=null;this._permissions={};this._geometry=[];this._geometryWKT=null},{setGeometryWKT:function(a){this._geometryWKT=a},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(a){this._geometry=a},getGeometry:function(){return this._geometry},addPermission:function(b,a){this._permissions[b]=a},removePermission:function(a){this._permissions[a]=null},getPermission:function(a){return this._permissions[a]},setId:function(a){this._id=a},getId:function(){return this._id},setQueryFormat:function(a){this._queryFormat=a},getQueryFormat:function(){return this._queryFormat},setName:function(a){this._name=a},getName:function(){return this._name},setType:function(a){this._type=a},getType:function(){return this._type},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},setDataUrl:function(a){this._dataUrl=a},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(a){this._organizationName=a},getOrganizationName:function(){return this._organizationName},setInspireName:function(a){this._inspireName=a},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(a){this._featureInfoEnabled=a},isFeatureInfoEnabled:function(){if(this._featureInfoEnabled===true){return true}return false},setDescription:function(a){this._description=a},getDescription:function(){return this._description},addSubLayer:function(a){this._subLayers.push(a)},getSubLayers:function(){return this._subLayers},setMaxScale:function(a){this._maxScale=a},getMaxScale:function(){return this._maxScale},setMinScale:function(a){this._minScale=a},getMinScale:function(){return this._minScale},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(a){this._orderNumber=a},getOrderNumber:function(){return this._orderNumber},setLegendImage:function(a){this._legendImage=a},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){if(this._legendImage){return true}else{for(var a=0;a<this._styles.length;++a){if(this._styles[a].getLegend()){return true}}}return false},setQueryable:function(a){this._queryable=a},getQueryable:function(){return this._queryable},addWmsUrl:function(a){this._wmsUrls.push(a)},getWmsUrls:function(){return this._wmsUrls},addStyle:function(a){this._styles.push(a)},getStyles:function(){return this._styles},selectStyle:function(b){var c=null;if(this._styles.length>0){if(b!==""){for(var a=0;a<this._styles.length;a++){c=this._styles[a];if(c.getName()==b){this._currentStyle=c;return}}}else{if(this._styles.length>1){this._currentStyle=this._styles[0]}else{c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c}return}}else{c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c;return}c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c},getCurrentStyle:function(){return this._currentStyle},setWmsName:function(a){this._wmsName=a},getWmsName:function(){return this._wmsName},setMetaType:function(a){this._metaType=a},getMetaType:function(){return this._metaType},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return this._type==="GROUP_LAYER"},isBaseLayer:function(){return this._type==="BASE_LAYER"},isVisible:function(){return this._visible===true},setVisible:function(a){this._visible=a},isInScale:function(c){var b=this.isBaseLayer();if(!c){var a=Oskari.$().sandbox;
c=a.getMap().getScale()}if(!this.isBaseLayer()){if(c>this.getMaxScale()&&c<this.getMinScale()){b=true}}return b},isLayerOfType:function(a){return a==="WMS"||a==="wms"}});Oskari.clazz.define("Oskari.mapframework.domain.WfsLayer",function(){this._id=null;this._type=null;this._opacity=null;this._inspireName=null;this._organizationName=null;this._dataUrl=null;this._subLayers=[];this._description=null;this._name=null;this._visible=null;this._maxScale=null;this._minScale=null;this._orderNumber=null;this._featureInfoEnabled=true;this._permissions={};this._geometry=[];this._geometryWKT=null},{setGeometryWKT:function(a){this._geometryWKT=a},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(a){this._geometry=a},getGeometry:function(){return this._geometry},addPermission:function(b,a){this._permissions[b]=a},removePermission:function(a){this._permissions[a]=null},getPermission:function(a){return this._permissions[a]},setId:function(a){this._id=a},getId:function(){return this._id},setName:function(a){this._name=a},getName:function(){return this._name},setType:function(a){this._type=a},getType:function(){return this._type},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},setDataUrl:function(a){this._dataUrl=a},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(a){this._organizationName=a},getOrganizationName:function(){return this._organizationName},setInspireName:function(a){this._inspireName=a},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(a){this._featureInfoEnabled=a},isFeatureInfoEnabled:function(){if(this._featureInfoEnabled===true){return true}return false},setDescription:function(a){this._description=a},getDescription:function(){return this._description},addSubLayer:function(a){this._subLayers.push(a)},getSubLayers:function(){return this._subLayers},setMaxScale:function(a){this._maxScale=a},getMaxScale:function(){return this._maxScale},setMinScale:function(a){this._minScale=a},getMinScale:function(){return this._minScale},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(a){this._orderNumber=a},getOrderNumber:function(){return this._orderNumber},isBaseLayer:function(){return this._type==="BASE_LAYER"},isInScale:function(c){var b=this.isBaseLayer();if(!c){var a=Oskari.$().sandbox;c=a.getMap().getScale()}if(!this.isBaseLayer()){if(c>this.getMaxScale()&&c<this.getMinScale()){b=true}}return b},isVisible:function(){return this._visible===true},setVisible:function(a){this._visible=a},isLayerOfType:function(a){return a=="WFS"||a=="wfs"}});Oskari.clazz.define("Oskari.mapframework.domain.VectorLayer",function(){this._id=null;this._type=null;this._opacity=null;this._inspireName=null;this._organizationName=null;this._dataUrl=null;this._subLayers=[];this._description=null;this._name=null;this._maxScale=null;this._minScale=null;this._sldspec=null;this._orderNumber=null;this._featureInfoEnabled=true;this._metaType=null;this._permissions={};this._geometry=[];this._geometryWKT=null;this._visible=true},{setGeometryWKT:function(a){this._geometryWKT=a},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(a){this._geometry=a},getGeometry:function(){return this._geometry},addPermission:function(b,a){this._permissions[b]=a},removePermission:function(a){this._permissions[a]=null},getPermission:function(a){return this._permissions[a]},setId:function(a){this._id=a},getId:function(){return this._id},setName:function(a){this._name=a},getName:function(){return this._name},setType:function(a){this._type=a},getType:function(){return this._type},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},setDataUrl:function(a){this._dataUrl=a},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(a){this._organizationName=a},getOrganizationName:function(){return this._organizationName},setInspireName:function(a){this._inspireName=a},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(a){this._featureInfoEnabled=a
},isFeatureInfoEnabled:function(){if(this._featureInfoEnabled===true){return true}return false},setDescription:function(a){this._description=a},getDescription:function(){return this._description},addSubLayer:function(a){this._subLayers.push(a)},getSubLayers:function(){return this._subLayers},setMaxScale:function(a){this._maxScale=a},getMaxScale:function(){return this._maxScale},setMinScale:function(a){this._minScale=a},getMinScale:function(){return this._minScale},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(a){this._orderNumber=a},getOrderNumber:function(){return this._orderNumber},setStyledLayerDescriptor:function(a){this._sldspec=a},getStyledLayerDescriptor:function(){return this._sldspec},isBaseLayer:function(){if(this._type=="BASE_LAYER"){return true}else{if(this._type=="NORMAL_LAYER"){return false}else{throw"We found a layer that is not a NORMAL_LAYER or a BASE_LAYER. Type '"+this._type+"' is not correct!"}}},isInScale:function(c){var b=this.isBaseLayer();if(!c){var a=Oskari.$().sandbox;c=a.getMap().getScale()}if(!this.isBaseLayer()){if(c>this.getMaxScale()&&c<this.getMinScale()){b=true}}return b},isVisible:function(){return this._visible},setVisible:function(a){this._visible=a},isLayerOfType:function(a){return a=="VECTOR"||a=="vector"},setMetaType:function(a){this._metaType=a},getMetaType:function(){return this._metaType},getStyles:function(){return[]}});Oskari.clazz.define("Oskari.mapframework.domain.Map",function(){this._centerX=null;this._centerY=null;this._zoom=null;this._mousePositionX=null;this._mousePositionY=null;this._mapKeyboardMovementsEnabled=null;this._scale=null;this._bbox=null;this._markerVisible=null;this.width=null;this.height=null;this.resolution=null;this.extent=null;this.maxExtent=null;this._isMoving=false;this.tileQueue=null},{moveTo:function(a,c,b){this._centerX=a;this._centerY=c;this._zoom=b},setMoving:function(a){this._isMoving=a},isMoving:function(){return this._isMoving},getX:function(){return this._centerX},getY:function(){return this._centerY},getZoom:function(){return this._zoom},updateMousePosition:function(a,b){this._mousePositionX=a;this._mousePositionY=b},getMousePositionX:function(){return this._mousePositionX},getMousePositionY:function(){return this._mousePositionY},setMapKeyboardMovementsEnabled:function(a){this._mapKeyboardMovementsEnabled=a},getMapKeyboardMovementsEnabled:function(){return this._mapKeyboardMovementsEnabled},setScale:function(a){this._scale=a},getScale:function(){return this._scale},setBbox:function(a){this._bbox=a},getBbox:function(){return this._bbox},setMarkerVisible:function(a){this._markerVisible=a},isMarkerVisible:function(){if(this._markerVisible==true){return true}return false},setWidth:function(a){this.width=a},getWidth:function(){return this.width},setHeight:function(a){this.height=a},getHeight:function(){return this.height},setResolution:function(a){this.resolution=a},getResolution:function(){return this.resolution},setExtent:function(a){this.extent=a},getExtent:function(){return this.extent},setMaxExtent:function(a){this.maxExtent=a},getMaxExtent:function(){return this.maxExtent},getTileQueue:function(){return this.tileQueue},setTileQueue:function(a){this.tileQueue=a}});Oskari.clazz.define("Oskari.mapframework.domain.Style",function(){this._name=null;this._title=null;this._legend=null},{setName:function(a){this._name=a},getName:function(){return this._name},setTitle:function(a){this._title=a},getTitle:function(){return this._title},setLegend:function(a){this._legend=a},getLegend:function(){return this._legend}});Oskari.clazz.define("Oskari.mapframework.domain.Polygon",function(){this._id=null;this._description=null;this._top=null;this._left=null;this._right=null;this._bottom=null;this._link=null;this._color="#684781";this._display="";this._zoomToExtent=false},{setId:function(a){this._id=a},getId:function(){return this._id},setDescription:function(a){this._description=a},getDescription:function(){return this._description},setTop:function(a){this._top=a},getTop:function(){return this._top
},setLeft:function(a){this._left=a},getLeft:function(){return this._left},setBottom:function(a){this._bottom=a},getBottom:function(){return this._bottom},setRight:function(a){this._right=a},getRight:function(){return this._right},setLink:function(a){this._link=a},getLink:function(){return this._link},setColor:function(a){this._color=a},getColor:function(){return this._color},setDisplay:function(a){this._display=a},getDisplay:function(){return this._display},setZoomToExtent:function(a){this._zoomToExtent=a},getZoomToExtent:function(){return this._zoomToExtent}});Oskari.clazz.define("Oskari.mapframework.domain.Tooltip",function(a,b){this._component=a;this._tooltip=b},{setComponent:function(a){this._component=a},setTooltip:function(a){this._tooltip=a},getComponent:function(){return this._component},getTooltip:function(){return this._tooltip}});Oskari.clazz.define("Oskari.mapframework.domain.WizardOptions",function(){this._wizardName=null;this._wizardId=null;this._wizardHeight=600;this._wizardWidth=800;this._wizardSteps=new Array();this._wizardTooltips=new Array();this._wizardShowProgressBar=true;this._wizardShowCloseConfirm=true;this._wizardCloseConfirmTitleKey="wizard_service_module_confirm_message_title";this._wizardCloseConfirmMessageKey="wizard_service_module_confirm_message"},{getWizardName:function(){return this._wizardName},getWizardId:function(){return this._wizardId},getWizardHeight:function(){return this._wizardHeight},getWizardWidth:function(){return this._wizardWidth},getWizardSteps:function(){return this._wizardSteps},getWizardStep:function(a){return this._wizardSteps[a]},getWizardStepsAmount:function(){return this._wizardSteps.length},getWizardTooltips:function(){return this._wizardTooltips},getWizardShowProgressBar:function(){return this._wizardShowProgressBar},getWizardShowCloseConfirm:function(){return this._wizardShowCloseConfirm},getWizardCloseConfirmMessageKey:function(){return this._wizardCloseConfirmMessageKey},getWizardCloseConfirmTitleKey:function(){return this._wizardCloseConfirmTitleKey},setWizardName:function(a){this._wizardName=a},setWizardId:function(a){this._wizardId=a},setWizardHeight:function(a){this._wizardHeight=a},setWizardWidth:function(a){this._wizardWidth=a},setWizardSteps:function(a){this._wizardSteps=a},addWizardStep:function(a){this._wizardSteps.push(a)},setWizardTooltips:function(a){this._wizardTooltips=a},setWizardShowProgressBar:function(a){this._wizardShowProgressBar=a},setWizardShowCloseConfirm:function(a){this._wizardShowCloseConfirm=a},setWizardCloseConfirmTitleKey:function(a){this._wizardCloseConfirmTitleKey=a},setWizardCloseConfirmMessageKey:function(a){this._wizardCloseConfirmMessageKey=a}});Oskari.clazz.define("Oskari.mapframework.domain.WizardStep",function(f,c,a,g,b,e,d){this.CONTENT_TYPE_HTML="html";this.CONTENT_TYPE_URL="url";this.CONTENT_TYPE_PANEL="panel";this.CONTENT_TYPE_DYNAMIC_PANEL="dynpanel";this._stepTitle=f;this._contentTitle=c;this._contentPage=a;this._contentType=g;this._beforeNextStepFunction=e;this._beforePreviousStepFunction=d;this._actionKeys=b;if(this._beforeNextStepFunction==null||typeof this._beforeNextStepFunction!="function"){this._beforeNextStepFunction=function(){return true}}if(this._beforePreviousStepFunction==null||typeof this._beforePreviousStepFunction!="function"){this._beforePreviousStepFunction=function(){return true}}},{getActionKeys:function(){return this._actionKeys},getStepTitle:function(){return this._stepTitle},getContentTitle:function(){return this._contentTitle},getContentPage:function(){return this._contentPage},getContentType:function(){return this._contentType},getBeforeNextStepFunction:function(){return this._beforeNextStepFunction},getBeforePreviousStepFunction:function(){return this._beforePreviousStepFunction},setStepTitle:function(a){this._stepTitle=a},setContentTitle:function(a){this._contentTitle=a},setContentPage:function(a){this._contentPage=a},setContentType:function(a){this._contentType=a},setBeforeNextStepFunction:function(a){this._beforeNextStepFunction=a},setBeforePreviousStepFunction:function(a){this._beforePreviousStepFunction=a
}});Oskari.clazz.define("Oskari.mapframework.domain.WfsTileRequest",function(b,f,c,e,d,a){this._bbox=f;this._mapWidth=c;this._mapHeight=e;this._mapLayer=b;this._creator=d;this._sequenceNumber=a},{getMapLayer:function(){return this._mapLayer},getBbox:function(){return this._bbox},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getSequenceNumber:function(){return this._sequenceNumber}});Oskari.clazz.define("Oskari.mapframework.domain.WfsGridScheduledRequest",function(a,e,b,d,c){this._bbox=e;this._mapWidth=b;this._mapHeight=d;this._mapLayer=a;this._creator=c},{getMapLayer:function(){return this._mapLayer},getBbox:function(){return this._bbox},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight}});Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTile",function(a){for(p in a){this[p]=a[p]}},{getBounds:function(){return this.bounds}});Oskari.clazz.define("Oskari.mapframework.gridcalc.TileQueue",function(){this.queue=[]},{getQueue:function(){return this.queue},getLength:function(){return this.queue.length},popJob:function(){var c=this.queue;var b=c.length;if(b===0){return null}if(b<4){return c.shift(-1)}var a=null;var d=Math.floor(b/2);a=c[d];this.queue=c.slice(0,d).concat(c.slice(d+1));return a},pushJob:function(a){this.queue.push(a)},flushQueue:function(){this.queue=[]}});Oskari.clazz.define("Oskari.mapframework.domain.User",function(a){this._loggedIn=false;if(a){this._firstName=a.firstName;this._lastName=a.lastName;this._nickName=a.nickName;this._loginName=a.loginName;this._uuid=a.userUUID;if(a.userUUID){this._loggedIn=true}}},{getName:function(){return this._firstName+" "+this._lastName},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getNickName:function(){return this._nickName},getLoginName:function(){return this._loginName},getUuid:function(){return this._uuid},isLoggedIn:function(){return this._loggedIn}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.request.Request",function(){this._creator=null;throw"mapframework.request.Request should not be used"},{getName:function(){throw"Running default implementation of Request.getName(). implement your own!"},setCreator:function(a){this._creator=a},getCreator:function(){return this._creator}});Oskari.clazz.define("Oskari.mapframework.request.action.ActionReadyRequest",function(b,a){this._creator=null;this._id=b;this._wfsPngAction=a},{__name:"ActionReadyRequest",getName:function(){return this.__name},getId:function(){return this._id},isWfsPngAction:function(){return this._wfsPngAction}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.action.ActionStartRequest",function(c,b,a){this._creator=null;this._id=c;this._actionName=b;this._wfsPngAction=a},{__name:"ActionStartRequest",getName:function(){return this.__name},getId:function(){return this._id},getActionDescription:function(){return this._actionName},isWfsPngAction:function(){return this._wfsPngAction}},{protocol:["Oskari.mapframework.request.Request"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.core.RequestHandler",function(){},{handleRequest:function(a,b){throw"Implement your own"}});Oskari.clazz.define("Oskari.mapframework.core.Core",function(){this._selectedLayers=new Array();this._mapLayersHighlighted=new Array();this._map;this._uiManager;this._sandbox=Oskari.clazz.create("Oskari.mapframework.sandbox.Sandbox",this);Oskari.$("sandbox",this._sandbox);this._services;this._servicesByQName={};this._debug=true;this._mapPublisherWizardUrl;this._doSniffing=false;this._wfsRequestTiler;this._ctrlKeyDown=false;this._ongoingActions={};this._allowMultipleHighlightLayers=false;this._wfsTableQueryId=0;this._currentlyFetchingWfsTiles=0;this._mapIdFromUrl;this._availableRequestsByName={};this._availableEventsByName={}},{init:function(c,f){this.printDebug("Initializing core...");var a=this._sandbox;Oskari.$().mapframework.runtime.components=new Array();this._services=c;if(c){for(var d=0;d<c.length;d++){this._servicesByQName[c[d].getQName()]=c[d]}}this.registerFrameworkComponentToRuntimeEnvironment(this,"core");this.registerFrameworkComponentToRuntimeEnvironment(this._sandbox,"sandbox");this.registerFrameworkComponentToRuntimeEnvironment(this._uiManager,"uiManager");for(var b=0;b<c.length;b++){this.registerFrameworkComponentToRuntimeEnvironment(c[b],c[b].getName())}this.printDebug("Sandbox ready, building up domain...");this.createMapDomain();this.printDebug("Domain ready, creating UI...");this.enhancements=f;var e=this;e.start();this.dispatch(this.getEventBuilder("CoreInitFinishedEvent")())},start:function(){var b=this.enhancements;this.printDebug("UI ready, running enhancements...");this.doEnhancements(b);this.printDebug("Enhancements ready, starting modules...");if(this._doSniffing){this._mapIdFromUrl=this.getRequestParameter("id");this.printDebug("Application configured for sniffing. Starting sniffer.");var a=this.getService("Oskari.mapframework.service.UsageSnifferService");if(a){a.startSniffing()}}if(this._wfsRequestTiler!=null){this._wfsRequestTiler.init()}this.printDebug("Modules started. Core ready.");this.dispatch(this.getEventBuilder("CoreReadyEvent")())},dispatch:function(a){this._sandbox.notifyAll(a)},defaultRequestHandlers:{AddMapLayerRequest:function(a){this.handleAddMapLayerRequest(a);return true},ManageFeaturesRequest:function(a){this.handleManageFeaturesRequest(a);return true},RemoveMapLayerRequest:function(a){this.handleRemoveMapLayerRequest(a);return true},SearchRequest:function(a){this.handleSearchRequest(a);return true},ShowMapLayerInfoRequest:function(a){this.handleShowMapLayerInfoRequest(a);return true},RearrangeSelectedMapLayerRequest:function(a){this.handleRearrangeSelectedMapLayerRequest(a);return true},DisableMapKeyboardMovementRequest:function(a){this.handleDisableMapKeyboardMovementRequest(a);return true},EnableMapKeyboardMovementRequest:function(a){this.handleEnableMapKeyboardMovementRequest(a);return true},ChangeMapLayerOpacityRequest:function(a){this.handleChangeMapLayerOpacityRequest(a);return true},StartMapPublisherRequest:function(a){this.handleStartMapPublisherRequest(a);return true},GenerateHtmlLinkToMapRequest:function(a){this.handleGenerateHtmlLinkToMapRequest(a);return true},GenerateHtmlPrintToMapRequest:function(a){this.handleGenerateHtmlPrintToMapRequest(a);return true},ChangeMapLayerStyleRequest:function(a){this.handleChangeMapLayerStyleRequest(a);return true},DrawPolygonRequest:function(a){this.handleDrawPolygonRequest(a);return true},DrawSelectedPolygonRequest:function(a){this.handleDrawSelectedPolygonRequest(a);return true},SelectPolygonRequest:function(a){this.handleSelectPolygonRequest(a);return true},ErasePolygonRequest:function(a){this.handleErasePolygonRequest(a);return true},UpdateHiddenValueRequest:function(a){this.handleUpdateHiddenValueRequest(a);return true},DeactivateAllOpenlayersMapControlsButNotMeasureToolsRequest:function(a){this.handleDeactivateAllOpenlayersMapControlsButNotMeasureToolsRequest(a);return true},DeactivateAllOpenlayersMapControlsRequest:function(a){this.handleDeactivateAllOpenlayersMapControlsRequest(a);return true
},HighlightMapLayerRequest:function(a){this.handleHighlightMapLayerRequest(a);return true},HighlightWFSFeatureRequest:function(a){this.handleHighlightWFSFeatureRequest(a);return true},HighlightWFSFeatureRequestByGeoPoint:function(a){this.handleHighlightWFSFeatureRequestByGeoPoint(a);return true},RemovePolygonRequest:function(a){this.handleRemovePolygonRequest(a);return true},HideWizardRequest:function(a){this.handleHideWizardRequest(a);return true},ShowWizardRequest:function(a){this.handleShowWizardRequest(a);return true},ShowNetServiceCentreRequest:function(a){this.handleShowNetServiceCentreRequest(a);return true},HideNetServiceCentreRequest:function(a){this.handleHideNetServiceCentreRequest(a);return true},NetServiceCenterRequest:function(a){this.handleNetServiceCenterRequest(a);return true},HideMapMarkerRequest:function(a){this.handleHideMapMarkerRequest(a);return true},UpdateNetServiceCentreRequest:function(a){this.handleUpdateNetServiceCentreRequest(a);return true},ActionStartRequest:function(a){this.handleActionStartRequest(a);return true},ActionReadyRequest:function(a){this.handleActionReadyRequest(a);return true},DimMapLayerRequest:function(a){this.handleDimMapLayerRequest(a);return true},CtrlKeyDownRequest:function(a){this.handleCtrlKeyDownRequest(a);return true},CtrlKeyUpRequest:function(a){this.handleCtrlKeyUpRequest(a);return true},__default:function(a){this.printWarn("!!!");this.printWarn("  There is no handler for");this.printWarn("  '"+a.getName()+"'");return false}},processRequest:function(c){var d=c.getName();var b=this.defaultRequestHandlers[d];if(b){rv=b.apply(this,[c])}else{var a=this.externalHandlerCls[d];if(a){rv=a.handleRequest(this,c)}else{b=this.defaultRequestHandlers.__default;rv=b.apply(this,[c])}}delete c;return rv},externalHandlerCls:{},addRequestHandler:function(b,a){this.externalHandlerCls[b]=a},removeRequestHandler:function(b,a){if(this.externalHandlerCls[b]===a){this.externalHandlerCls[b]=null}},getQNameForRequest:function(b){var e=this._availableRequestsByName[b];if(!e){this.printDebug("#!#!# ! Updating request metadata...");var d=Oskari.clazz.protocol("Oskari.mapframework.request.Request");for(p in d){var c=d[p];var a=c._class.prototype.getName();this._availableRequestsByName[a]=p}this.printDebug("#!#!# ! Finished Updating request metadata...");e=this._availableRequestsByName[b]}return e},createRequest:function(){arguments[0]=this.getQNameForRequest(arguments[0]);var a=Oskari.clazz.createArrArgs(arguments);return a},getRequestBuilder:function(){var a=this.getQNameForRequest(arguments[0]);return Oskari.clazz.builder(a)},getQNameForEvent:function(b){var e=this._availableEventsByName[b];if(!e){this.printDebug("#!#!# ! Updating event metadata...");var d=Oskari.clazz.protocol("Oskari.mapframework.event.Event");for(p in d){var c=d[p];var a=c._class.prototype.getName();this._availableEventsByName[a]=p}this.printDebug("#!#!# ! Finished Updating event metadata...");e=this._availableEventsByName[b]}return e},createEvent:function(){arguments[0]=this.getQNameForEvent(arguments[0]);var a=Oskari.clazz.createArrArgs(arguments);return a},getEventBuilder:function(){var a=this.getQNameForEvent(arguments[0]);return Oskari.clazz.builder(a)},disableDebug:function(){this._debug=false},enableMapMovementLogging:function(){this._doSniffing=true},printDebug:function(a){if(this._debug&&window.console!=null){if(window.console.debug!=null){console.debug(a)}else{if(window.console.log!=null){console.log(a)}}}},printWarn:function(a){if(window.console!=null){console.warn(a)}},getService:function(a){var b=this._servicesByQName[a];if(b){return b}throw"Cannot find service with type '"+a+"'"},findRegisteredModule:function(a){return this._sandbox.findRegisteredModule},getMap:function(){return this._map},registerFrameworkComponentToRuntimeEnvironment:function(b,a){this.printDebug("registering framework component '"+a+"' to runtime");Oskari.$().mapframework.runtime.components[a]=b},unregisterFrameworkComponentFromRuntimeEnvironment:function(b,a){this.printDebug("unregistering framework component '"+a+"' from runtime");Oskari.$().mapframework.runtime.components[a]=null
},getSandbox:function(){return this._sandbox},getCountOfWfsTilesBeingFetched:function(){return this._currentlyFetchingWfsTiles},checkArrayIfTheseAreSame:function(b){if(b.length>1){var c=b[0];for(var a=1;a<b.length;a++){if(b[a]!=c&&b[a]!=null){return false}}return true}else{return false}},scheduleMapLayerRearrangeAfterWfsMapTilesAreReady:function(){},getLanguage:function(){return Oskari.getLang()},getBrowserWindowSize:function(){if(jQuery.browser.opera&&window.innerHeight!=null){var a=window.innerHeight}var c=jQuery(window).width();var b={};b.height=jQuery(window).height();b.width=c;this.printDebug("Got browser window size is: width: "+b.width+" px, height:"+b.height+" px.");return b},getRequestParameter:function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)";var d=new RegExp(a);var c=d.exec(window.location.href);if(c==null){return null}else{return c[1]}},domSelector:function(a){return jQuery(a)},getObjectName:function(a){return a.__name},getObjectCreator:function(a){return a._creator},setObjectCreator:function(b,a){b._creator=a},copyObjectCreatorToFrom:function(b,a){b._creator=a._creator}});Oskari.clazz.category("Oskari.mapframework.core.Core","build-domain-methods",{createMapLayerDomain:function(d){if(!d||!d.layers){return}var a=this.getService("Oskari.mapframework.service.MapLayerService");var e=d.layers;for(var c=0;c<e.length;c++){var b=a.createMapLayer(e[c]);a.addLayer(b,true)}},createMapDomain:function(){this._map=Oskari.clazz.create("Oskari.mapframework.domain.Map");return this._map}});Oskari.clazz.category("Oskari.mapframework.core.Core","enhancement-methods",{doEnhancements:function(b){for(var a=0;a<b.length;a++){b[a].enhance(this)}}});Oskari.clazz.category("Oskari.mapframework.core.Core","language-methods",{getText:function(a,b){},showPopupText:function(b,d,c){var a=this.getService("Oskari.mapframework.service.LanguageService");return a.showPopup(b,d,c)}});Oskari.clazz.category("Oskari.mapframework.core.Core","feature-key-listener-methods",{handleCtrlKeyDownRequest:function(a){this._ctrlKeyDown=true},handleCtrlKeyUpRequest:function(a){this._ctrlKeyDown=false},isCtrlKeyDown:function(){return this._ctrlKeyDown}});Oskari.clazz.define("Oskari.mapframework.event.CoreInitFinishedEvent",function(c,b,a){},{__name:"CoreInitFinishedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.CoreReadyEvent",function(c,b,a){},{__name:"CoreReadyEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.ToolSelectedEvent",function(a){this._toolId=a;this._origin=null},{__name:"ToolSelectedEvent",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(a){this._toolId=a},getOrigin:function(){return this._origin},setOrigin:function(a){this._origin=a},getNamespace:function(){if(this._toolId.indexOf(".")==-1){return""}return this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){if(this._toolId.indexOf(".")==-1){return this._toolId}return this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.event.Event"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.mapDivId="mapdiv"},{getMapModule:function(){return this.mapmodule},getSandbox:function(){return this.sandbox},createUi:function(){var e=this;if(this.conf.size){jQuery("#"+this.mapDivId).width(this.conf.size.width);jQuery("#"+this.mapDivId).height(this.conf.size.height)}else{function f(){jQuery("#"+e.mapDivId).height(jQuery(window).height())}var a;jQuery(window).resize(function(){clearTimeout(a);a=setTimeout(f,100)});f()}var d=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main");this.mapmodule=d;var g=this.sandbox.register(d);d.start(this.sandbox);g.render(this.mapDivId);if(this.conf.plugins){var b=this.conf.plugins;for(var c=0;c<b.length;c++){b[c].instance=Oskari.clazz.create(b[c].id,b[c].config);d.registerPlugin(b[c].instance);d.startPlugin(b[c].instance)}}this.map=g},start:function(){var h=this;var g=h.conf;var d=Oskari.getLang();var b=h;var c=Oskari.clazz.create("Oskari.mapframework.core.Core");this.core=c;var l=c.getSandbox();this.sandbox=l;var k=this.createServices(g);var m=[];m.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement"));l.setUser(g.user);l.setAjaxUrl(g.globalMapAjaxUrl);c.init(k,m);var f=l.getService("Oskari.mapframework.service.MapLayerService");var a=g.layers;if(a){for(var e=0;e<a.length;e++){var j=f.createMapLayer(a[e]);f.addLayer(j,true)}}this.createUi();l.registerAsStateful(this.mediator.bundleId,this);this.setState(this.state)},_teardownState:function(c){var d=this.sandbox.findAllSelectedMapLayers();var a=this.sandbox.getRequestBuilder("RemoveMapLayerRequest");for(var b=0;b<d.length;b++){this.sandbox.request(c.getName(),a(d[b].getId()))}},setState:function(a){var h=this.sandbox.findRegisteredModuleInstance("MainMapModule");this._teardownState(h);if(a.selectedLayers){var f=this.sandbox.getRequestBuilder("AddMapLayerRequest");var j=this.sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest");var c=this.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest");var d=this.sandbox.getRequestBuilder("ChangeMapLayerStyleRequest");var g=a.selectedLayers.length;for(var b=0;b<g;++b){var e=a.selectedLayers[b];this.sandbox.request(h.getName(),f(e.id,true));if(e.hidden){this.sandbox.request(h.getName(),c(e.id,false))}if(e.style){this.sandbox.request(h.getName(),d(e.id,e.style))}if(e.opacity){this.sandbox.request(h.getName(),j(e.id,e.opacity))}}}if(a.east){this.sandbox.getMap().moveTo(a.east,a.north,a.zoom)}this.sandbox.syncMapState(true)},createServices:function(b){var e=this;var c=[];var a=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",b.globalMapAjaxUrl+"action_route=GetMapLayers",this.core.getSandbox());c.push(a);a.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var d=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");a.registerLayerModelBuilder("wmtslayer",d);c.push(Oskari.clazz.create("Oskari.mapframework.service.OgcSearchService",b.ogcSearchServiceEndpoint,this.core));if(b.disableDevelopmentMode=="true"){core.disableDebug();c.push(Oskari.clazz.create("Oskari.mapframework.service.UsageSnifferService",2,"/log/"));core.enableMapMovementLogging()}return c},update:function(){},stop:function(){this.sandbox.unregisterStateful(this.mediator.bundleId);alert("Stopped!")},getState:function(){var b=this.sandbox.getMap();var d=this.sandbox.findAllSelectedMapLayers();var j=b.getZoom();var h=b.getX();var a=b.getY();var c={north:a,east:h,zoom:b.getZoom(),selectedLayers:[]};for(var f=0;f<d.length;f++){var g=d[f];var e={id:g.getId(),opacity:g.getOpacity()};if(!g.isVisible()){e.hidden=true}if(g.getCurrentStyle&&g.getCurrentStyle()&&g.getCurrentStyle().getName()&&g.getCurrentStyle().getName()!="!default!"){e.style=g.getCurrentStyle().getName()}c.selectedLayers.push(e)}return c}},{protocol:["Oskari.bundle.BundleInstance","Oskari.userinterface.Stateful"]});Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithConfigurationsEnhancement",function(a,b){this._preSelectedJson=a;
this._mapConfigurations=b},{enhance:function(b){var f=b.getRequestParameter("coord");var c=b.getRequestParameter("zoomLevel");var a=b.getRequestParameter("mapLayers");if(f!=null&&c!=null&&a!=null){b.printDebug("Ahem, we found 'mapLayers, coord and zoomLevel' parameters from url. This is probably a link startup. Skipping preselection.");return}b.printDebug("Enhancing application by setting position.");var h=this._mapConfigurations.east;var g=this._mapConfigurations.north;var k=this._mapConfigurations.scale;var e=false;b.getMap().moveTo(h,g,k);b.printDebug("Enhancing application by preselecting layers.");if(!this._preSelectedJson||!this._preSelectedJson.preSelectedLayers){return}for(var d=0;d<this._preSelectedJson.preSelectedLayers.length;d++){var j=this._preSelectedJson.preSelectedLayers[d];b.processRequest(b.getRequestBuilder("AddMapLayerRequest")(j.id,false))}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement",function(){},{enhance:function(u){u.printDebug("Checking if map is started with link...");var o=u.getRequestParameter("coord");var n=u.getRequestParameter("zoomLevel");var h=u.getRequestParameter("mapLayers");var f=u.getRequestParameter("showMarker");var k=u.getRequestParameter("keepLayersOrder");if(k===null){k=true}u.getMap().setMarkerVisible(f=="true");if(o===null||n===null){return}var p;if(o.indexOf("_")>=0){p=o.split("_")}else{p=o.split("%20")}var j=p[0];var m=p[1];if(j===null||m===null){u.printDebug("Could not parse link location. Skipping.");return}u.getMap().moveTo(j,m,n);u.printDebug("This is startup by link, moving map...");if(h!==null&&h!==""){u.printDebug("Continuing by adding layers...");var a=h.split(",");for(var s=0;s<a.length;s++){var g=a[s].split("+");var e=g[0];var b=g[1];var t=g[2];if((e.indexOf("_")!=-1)&&(e.indexOf("base_")==-1)&&(e.indexOf("BASE_")==-1)){var v=e.split("_");e=null;var c=null;for(var d in v){if(d){c=u.findBaselayerBySublayerIdFromAllAvailable(v[d]);if(c){e=c.getId();break}}}}if(e!==null){var q=null;var l=null;q=u.getRequestBuilder("AddMapLayerRequest");l=q(e,k);u.processRequest(l);q=u.getRequestBuilder("ChangeMapLayerOpacityRequest");l=q(e,b);u.processRequest(l);q=u.getRequestBuilder("ChangeMapLayerStyleRequest");l=q(e,t);u.processRequest(l)}else{u.printWarn("[StartMapWithLinkEnhancement] Could not find baselayer for "+e)}}}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithSearchResultEnhancement",function(){},{enhance:function(b){b.printDebug("Checking if map is started with search result...");var g=b.getRequestParameter("coord");var e=b.getRequestParameter("zoomLevel");if(g==null||e==null){return}var c=b.getRequestParameter("mapLayers");if(c!=null){b.printDebug("This is probably startup by link, not by search result. Skipping.");return}var a;if(g.indexOf("_")>=0){a=g.split("_")}else{a=g.split("%20")}var d=a[0];var f=a[1];if(d==null||f==null){b.printDebug("Could not parse link location. Skipping.")}b.printDebug("This is startup by search result, moving map.");b.getMap().moveTo(d,f,e);b.getMap().setMarkerVisible(true)}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.event.Event",function(){throw"mapframework.event.Event should not be used";this._name=null;this._creator=null},{getName:function(){throw"Running default implementation of Event.getName(). implement your own!"},setCreator:function(a){this._creator=a},getCreator:function(){return this._creator}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.ui.module.common.MapModule",function(a){this._id=a;this._controls={};this._layerPlugins={};this._projectionCode="EPSG:3067";this._supportedFormats={};this._map=null;this._mapScales=[];this._mapResolutions=[2000,1000,500,200,100,50,20,10,4,2,1,0.5,0.25];this._navigationHistoryTool=null;this._sandbox=null;this._stealth=false;this._pluginInstances={};this._navigationHistoryTool=new OpenLayers.Control.NavigationHistory();this._navigationHistoryTool.id="navigationhistory";this._localization=null},{getControls:function(){return this._controls},addMapControl:function(b,a){this._controls[b]=a;this._map.addControl(a)},getMapControl:function(a){return this._controls[a]},removeMapControl:function(a){this._map.removeControl(this._controls[a]);this._controls[a]=null;delete this._controls[a]},setLayerPlugin:function(b,a){this._layerPlugins[b]=a},getLayerPlugin:function(a){return this._layerPlugins[a]},getLayerPlugins:function(){return this._layerPlugins},clearNavigationHistory:function(){this._navigationHistoryTool.clear()},attachLoadingStatusToLayer:function(b,c){var a=this._sandbox;var e=this;var d=this.getLocalization("status_update_map")+" '"+c.getName()+"'...";b.events.register("loadstart",b,function(){a.request(e,a.getRequestBuilder("ActionStartRequest")(b.id,d,true))});b.events.register("loadend",b,function(){a.request(e,a.getRequestBuilder("ActionReadyRequest")(b.id,true))});b.events.register("loadcancel",b,function(){a.request(e,a.getRequestBuilder("ActionReadyRequest")(b.id,true))})},getName:function(){return this._id+"MapModule"},getSandbox:function(){return this._sandbox},getLocalization:function(a){if(!this._localization){this._localization=Oskari.getLocalization("MapModule")}if(a){return this._localization[a]}return this._localization},init:function(a){a.printDebug("Initializing map module...#############################################");this._sandbox=a;for(p in this.eventHandlers){a.registerForEventByName(this,p)}this.requestHandlers={mapLayerUpdateHandler:Oskari.clazz.create("Oskari.mapframework.mapmodule-plugin.request.MapLayerUpdateRequestHandler",a,this),mapMoveRequestHandler:Oskari.clazz.create("Oskari.mapframework.mapmodule-plugin.request.MapMoveRequestHandler",a,this),clearHistoryHandler:Oskari.clazz.create("Oskari.mapframework.mapmodule-plugin.controls.ClearHistoryHandler",a,this)};a.addRequestHandler("MapModulePlugin.MapLayerUpdateRequest",this.requestHandlers.mapLayerUpdateHandler);a.addRequestHandler("MapMoveRequest",this.requestHandlers.mapMoveRequestHandler);a.addRequestHandler("ClearHistoryRequest",this.requestHandlers.clearHistoryHandler);this.createMap();for(var c=0;c<this._mapResolutions.length;++c){var b=OpenLayers.Util.getScaleFromResolution(this._mapResolutions[c],"m");b=b*10000;b=Math.round(b);b=b/10000;this._mapScales.push(b)}this.createBaseLayer();this.addMapControl("navigationHistoryTool",this._navigationHistoryTool);this.getMapControl("navigationHistoryTool").activate();return this._map},getPluginInstances:function(){return this._pluginInstances},isPluginActivated:function(b){var a=this._pluginInstances[this.getName()+b];if(a){return true}return false},registerPlugin:function(b){var a=this._sandbox;b.setMapModule(this);var c=b.getName();a.printDebug("["+this.getName()+"] Registering "+c);b.register();this._pluginInstances[c]=b},unregisterPlugin:function(b){var a=this._sandbox;var c=b.getName();a.printDebug("["+this.getName()+"] Unregistering "+c);b.unregister();this._pluginInstances[c]=undefined;b.setMapModule(null)},startPlugin:function(b){var a=this._sandbox;var c=b.getName();a.printDebug("["+this.getName()+"] Starting "+c);b.startPlugin(a)},stopPlugin:function(b){var a=this._sandbox;var c=b.getName();a.printDebug("["+this.getName()+"] Starting "+c);b.stopPlugin(a)},startPlugins:function(a){for(var b in this._pluginInstances){a.printDebug("["+this.getName()+"] Starting "+b);this._pluginInstances[b].startPlugin(a)}},stopPlugins:function(a){for(var b in this._pluginInstances){a.printDebug("["+this.getName()+"] Starting "+b);this._pluginInstances[b].stopPlugin(a)
}},getStealth:function(){return this._stealth},setStealth:function(a){this._stealth=a},notifyAll:function(a,b){if(this._stealth){return}this._sandbox.notifyAll(a,b)},getMap:function(){return this._map},getMapImpl:function(){return this._panel},createMap:function(){var a=this._sandbox;var b=new OpenLayers.LonLat(0,0);this._map=new OpenLayers.Map({controls:[],units:"m",maxExtent:new OpenLayers.Bounds(0,0,10000000,10000000),resolutions:this._mapResolutions,projection:this._projectionCode,isBaseLayer:true,center:b,theme:null,zoom:0});return this._map},createBaseLayer:function(){var a=new OpenLayers.Layer("BaseLayer",{layerId:0,isBaseLayer:true,displayInLayerSwitcher:false});this._map.addLayer(a)},notifyStartMove:function(){if(this.getStealth()){return}this._sandbox.getMap().setMoving(true);var c=this._map.getCenter().lon;var b=this._map.getCenter().lat;var a=this._sandbox.getEventBuilder("MapMoveStartEvent")(c,b);this._sandbox.notifyAll(a)},moveMapToLanLot:function(b,d,c){if(d){this.adjustZoomLevel(d,true)}var a=(c===true);this._map.setCenter(b,this._map.getZoom(),a);this._updateDomain()},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(a){this.setZoomLevel(a,false)},panMapEast:function(){var a=this._map.getSize();this.panMapByPixels(0.75*a.w,0)},panMapWest:function(){var a=this._map.getSize();this.panMapByPixels(-0.75*a.w,0)},panMapNorth:function(){var a=this._map.getSize();this.panMapByPixels(0,-0.75*a.h)},panMapSouth:function(){var a=this._map.getSize();this.panMapByPixels(0,0.75*a.h)},panMapByPixels:function(e,d,g,c){var f=this._map.getViewPortPxFromLonLat(this._map.getCenter());var a=new OpenLayers.Pixel(f.x+e,f.y+d);var b=this._map.getLonLatFromViewPortPx(a);if(!this.isValidLonLat(b.lon,b.lat)){return}this._map.pan(e,d);this._updateDomain();if(g!==true){this.notifyStartMove()}if(c!==true){this.notifyMoveEnd()}},moveMapByPixels:function(c,b,d,a){this._map.moveByPx(c,b);this._updateDomain();if(d!==true){this.notifyStartMove()}if(a!==true){this.notifyMoveEnd()}},centerMapByPixels:function(e,d,f,c){var a=new OpenLayers.Pixel(e,d);var b=this._map.getLonLatFromViewPortPx(a);if(!this.isValidLonLat(b.lon,b.lat)){return}this.moveMapToLanLot(b);if(f!==true){this.notifyStartMove()}if(c!==true){this.notifyMoveEnd()}},isValidLonLat:function(c,b){var a=true;if(b<6250000||b>8200000){a=false;return a}if(c<0||c>1350000){a=false}return a},zoomToExtent:function(c,b,a){this._map.zoomToExtent(c);this._updateDomain();if(b!==true){this.notifyStartMove()}if(a!==true){this.notifyMoveEnd()}},adjustZoomLevel:function(c,b){var a=this._getNewZoomLevel(c);this._map.zoomTo(a);this._updateDomain();if(b!==true){this.notifyMoveEnd()}},setZoomLevel:function(b,a){if(b<0||b>this._map.getNumZoomLevels){b=this._map.getZoom()}this._map.zoomTo(b);this._updateDomain();if(a!==true){this.notifyMoveEnd()}},_getNewZoomLevel:function(b){var a=this._map.getZoom()+b;if(a>=0&&a<=this._map.getNumZoomLevels()){return a}return this._map.getZoom()},notifyMoveEnd:function(){if(this.getStealth()){return}var a=this._sandbox;a.getMap().setMoving(false);var c=this._map.getCenter();this._updateDomain();var b=a.getEventBuilder("AfterMapMoveEvent")(c.lon,c.lat,this._map.getZoom(),false,this._map.getScale());a.notifyAll(b);a.doSniffing()},_updateDomain:function(){if(this.getStealth()){return}var a=this._sandbox;var d=a.getMap();var c=this._map.getCenter();d.moveTo(c.lon,c.lat,this._map.getZoom());d.setScale(this._map.getScale());var b=this._map.getCurrentSize();d.setWidth(b.w);d.setHeight(b.h);d.setResolution(this._map.getResolution());d.setExtent(this._map.getExtent());d.setMaxExtent(this._map.getMaxExtent());d.setBbox(this._map.calculateBounds());d.setMarkerVisible(this._hasMarkers())},calculateLayerScales:function(d,b){var c=new Array();if(b&&d){this.layerScales=[];for(var a=0;a<this._mapScales.length;a++){if(b>=this._mapScales[a]&&d<=this._mapScales[a]){c.push(this._mapScales[a])}}}return c},getClosestZoomLevel:function(e,d){var c=this._map.getZoom();if(!d||!e){return c}var b=this._map.getScale();if(b<d){for(var a=c;a>0;a--){if(this._mapScales[a]>=d){return a
}}}else{if(b>e){for(var a=c;a<this._mapScales.length;a++){if(this._mapScales[a]<=e){return a}}}}return c},start:function(a){if(this.started){return}a.printDebug("Starting "+this.getName());this.startPlugins(a);this.updateCurrentState();this.started=true},stop:function(a){if(!this.started){return}this.stopPlugins(a);this.started=false},_drawMarker:function(){this._removeMarkers();var e=this._map.getCenter();var b=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(b);var c=new OpenLayers.Size(32,32);var f=new OpenLayers.Pixel(0,-c.h);var d=new OpenLayers.Icon(Oskari.$().startup.imageLocation+"/resource/icons/paikkamerkinta.png",c,f);var a=new OpenLayers.Marker(e,d);b.addMarker(a)},_removeMarkers:function(){var a=this._map.getLayersByName("Markers");if(a){for(var b=0;b<a.length;b++){if(a[b]){this._map.removeLayer(a[b],false)}}}},_hasMarkers:function(){var a=this._map.getLayersByName("Markers");if(a){for(var b=0;b<a.length;b++){if(a[b]&&a[b].markers&&a[b].markers.length>0){return true}}}return false},eventHandlers:{AfterMapMoveEvent:function(a){},SearchClearedEvent:function(a){this._removeMarkers()}},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},getOLMapLayers:function(b){var f=this;var a=f._sandbox;var c=a.findMapLayerFromSelectedMapLayers(b);if(!c){return null}var e=this.getLayerPlugins();for(p in e){var d=e[p];var g=d.getOLMapLayers(c);if(g){return g}}return null},updateCurrentState:function(){var d=this;var a=d._sandbox;var e=a.findAllSelectedMapLayers();var c=this.getLayerPlugins();for(p in c){var b=c[p];a.printDebug("preselecting "+p);b.preselectLayers(e)}}},{protocol:["Oskari.mapframework.module.Module"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.Plugin",function(){throw"Oskari.mapframework.ui.module.common.mapmodule.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setMapModule:function(a){throw"Implement your own"},register:function(){throw"Implement your own"},unregister:function(){throw"Implement your own"},startPlugin:function(a){throw"Implement your own"},stopPlugin:function(a){throw"Implement your own"},eventHandlers:{},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])}});Oskari.clazz.define("Oskari.mapframework.mapmodule.ControlsPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"ControlsPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){},unregister:function(){},init:function(a){var b=this;this.requestHandlers={toolSelectionHandler:Oskari.clazz.create("Oskari.mapframework.mapmodule.ToolSelectionHandler",a,b)}},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);a.addRequestHandler("ToolSelectionRequest",this.requestHandlers.toolSelectionHandler);for(var b in this.eventHandlers){a.registerForEventByName(this,b)}this.addMapControls()},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterDisableMapKeyboardMovementEvent:function(a){this._keyboardControls.deactivate()},AfterEnableMapKeyboardMovementEvent:function(a){this._keyboardControls.activate()},ToolSelectedEvent:function(b){var a=this.requestHandlers.toolSelectionHandler.getName();this._sandbox.printDebug("[ControlsPlugin] Get ToolSelectedEvent from '"+b.getOrigin()+"':");this._sandbox.printDebug("                 "+b.getToolId());if(b.getOrigin()!=a){this._zoomBoxTool.deactivate();this._measureControls.line.deactivate();this._measureControls.area.deactivate()}}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},addMapControls:function(a){var f=this;OpenLayers.Control.ZoomBox.prototype.draw=function(){this.handler=new OpenLayers.Handler.Box(this,{done:function(h){this.zoomBox(h);f.getMapModule().notifyMoveEnd()
}},{keyMask:this.keyMask})};this._zoomBoxTool=new OpenLayers.Control.ZoomBox({alwaysZoom:true});this.getMapModule().addMapControl("zoomBoxTool",this._zoomBoxTool);this._zoomBoxTool.deactivate();this._keyboardControls=new OpenLayers.Control.PorttiKeyboard({core:this._sandbox._core,mapmodule:this.getMapModule()});this.getMapModule().addMapControl("keyboardControls",this._keyboardControls);this.getMapModule().getMapControl("keyboardControls").activate();var b={handlerOptions:{persist:true},immediate:true};var e={handlerOptions:{persist:true},immediate:true};this._measureControls={line:(new OpenLayers.Control.Measure(OpenLayers.Handler.Path,b)),area:(new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,e))};var f=this;function d(m,n){var i=f._sandbox;var j=m.units;var h=m.order;var l=m.measure;var k=l.toFixed(3)+" "+j;i.printDebug(k+" "+(n?"FINISHED":"CONTINUES"));i.request(f,i.getRequestBuilder("ShowMapMeasurementRequest")(k))}for(var c in this._measureControls){var g=this._measureControls[c];g.events.on({measure:function(h){d(h,true)},measurepartial:function(h){d(h,false)}})}this.getMapModule().addMapControl("measureControls_line",this._measureControls.line);this._measureControls.line.deactivate();this.getMapModule().addMapControl("measureControls_area",this._measureControls.area);this._measureControls.area.deactivate();this._mouseControls=new OpenLayers.Control.PorttiMouse({sandbox:this._sandbox,mapmodule:this.getMapModule()});this.getMapModule().addMapControl("mouseControls",this._mouseControls)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});OpenLayers.Control.PorttiKeyboard=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,slideFactor:50,core:null,constructor:function(a){this.core=a.core;this.mapmodule=a.mapmodule},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyDown,keyup:this.defaultKeyUp})},defaultKeyDown:function(a){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.mapmodule.panMapByPixels(-this.slideFactor,0,false,true);break;case OpenLayers.Event.KEY_RIGHT:this.mapmodule.panMapByPixels(this.slideFactor,0,false,true);break;case OpenLayers.Event.KEY_UP:this.mapmodule.panMapByPixels(0,-this.slideFactor,false,true);break;case OpenLayers.Event.KEY_DOWN:this.mapmodule.panMapByPixels(0,this.slideFactor,false,true);break;case 17:this.core.processRequest(this.core.getRequestBuilder("CtrlKeyDownRequest")());break;case 27:this.core.dispatch(this.core.getEventBuilder("EscPressedEvent")());break;case 33:this.mapmodule.notifyStartMove();this.mapmodule.panMapNorth();break;case 34:this.mapmodule.notifyStartMove();this.mapmodule.panMapSouth();break;case 35:this.mapmodule.notifyStartMove();this.mapmodule.panMapEast();break;case 36:this.mapmodule.notifyStartMove();this.mapmodule.panMapWest();break;case 43:case 61:case 187:case 107:this.mapmodule.zoomIn();break;case 45:case 109:case 189:case 95:this.mapmodule.zoomOut();break}},defaultKeyUp:function(a){switch(a.keyCode){case 17:this.core.processRequest(this.core.getRequestBuilder("CtrlKeyUpRequest")());break;case 37:case 38:case 39:case 40:case 33:case 34:case 35:case 36:case 43:case 61:case 187:case 107:case 45:case 109:case 189:case 95:this.mapmodule.notifyMoveEnd();break}},CLASS_NAME:"OpenLayers.Control.PorttiKeyboard"});OpenLayers.Control.PorttiZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,panIcons:false,forceFixedZoomLevel:false,mouseDragStart:null,deltaY:null,zoomStart:null,constructor:function(a){this.sandbox=a.sandbox;this.mapModule=a.mapModule},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.removeButtons();
this._removeZoomBar()}this.draw()},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position.clone();this.buttons=[];var d=new OpenLayers.Size(18,18);if(this.panIcons){var a=new OpenLayers.Pixel(b.x+d.w/2,b.y);var c=d.w;if(this.zoomWorldIcon){a=new OpenLayers.Pixel(b.x+d.w,b.y)}this._addButton("panup","north-mini.png",a,d);b.y=a.y+d.h;this._addButton("panleft","west-mini.png",b,d);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",b.add(d.w,0),d);c*=2}this._addButton("panright","east-mini.png",b.add(c,0),d);this._addButton("pandown","south-mini.png",a.add(0,d.h*2),d);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,d.h*3+5),d);a=this._addZoomBar(a.add(0,d.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",a,d)}else{this._addButton("zoomin","zoom-plus-mini.png",b,d);a=this._addZoomBar(b.add(0,d.h));this._addButton("zoomout","zoom-minus-mini.png",a,d);if(this.zoomWorldIcon){a=a.add(0,d.h+3);this._addButton("zoomworld","zoom-world-mini.png",a,d)}}return this.div},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.action){case"zoomin":Oskari.$().sandbox.findRegisteredModuleInstance("MainMapModule").zoomIn();break;case"zoomout":Oskari.$().sandbox.findRegisteredModuleInstance("MainMapModule").zoomOut();break}},_addZoomBar:function(a){var e=OpenLayers.Util.getImagesLocation();var g=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var c=OpenLayers.Util.createAlphaImageDiv(g,a.add(-1,b*this.zoomStopHeight),new OpenLayers.Size(20,9),e+"slider.png","absolute");c.style.cursor="move";this.slider=c;this.sliderEvents=new OpenLayers.Events(this,c,null,true,{includeXY:true});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var d=new OpenLayers.Size();d.h=this.zoomStopHeight*this.map.getNumZoomLevels();d.w=this.zoomStopWidth;var f=null;if(OpenLayers.Util.alphaHack()){var g=this.id+"_"+this.map.id;f=OpenLayers.Util.createAlphaImageDiv(g,a,new OpenLayers.Size(d.w,this.zoomStopHeight),e+"zoombar.png","absolute",null,"crop");f.style.height=d.h+"px"}else{f=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,d,e+"zoombar.png")}f.style.cursor="pointer";this.zoombarDiv=f;this.divEvents=new OpenLayers.Events(this,f,null,true,{includeXY:true});this.divEvents.on({touchmove:this.passEventToSlider,mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(f);this.startTop=parseInt(f.style.top);this.div.appendChild(c);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a},_removeZoomBar:function(){this.sliderEvents.un({touchmove:this.zoomBarDrag,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({touchmove:this.passEventToSlider,mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}var c=a.xy.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){c=Math.floor(c)}var b=(this.map.getNumZoomLevels()-1)-c;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.mapModule.zoomTo(b);OpenLayers.Event.stop(a)},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)&&!OpenLayers.Event.isSingleTouch(a)){return}this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();
this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a)},zoomBarDrag:function(b){if(this.mouseDragStart!=null){var a=this.mouseDragStart.y-b.xy.y;var d=OpenLayers.Util.pagePosition(this.zoombarDiv);if((b.clientY-d[1])>0&&(b.clientY-d[1])<parseInt(this.zoombarDiv.style.height)-2){var c=parseInt(this.slider.style.top)-a;this.slider.style.top=c+"px";this.mouseDragStart=b.xy.clone()}this.deltaY=this.zoomStart.y-b.xy.y;OpenLayers.Event.stop(b)}},zoomBarUp:function(a){if(!OpenLayers.Event.isLeftClick(a)&&a.type!=="touchend"){return}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){b+=this.deltaY/this.zoomStopHeight;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)}else{b+=this.deltaY/this.zoomStopHeight;b=Math.max(Math.round(b),0)}this.mapModule.zoomTo(b);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PorttiZoomBar"});OpenLayers.Control.PorttiDragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:1,documentDrag:false,kinetic:null,enableKinetic:false,kineticInterval:10,draw:function(){if(this.enableKinetic){var a={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){a=OpenLayers.Util.extend(a,this.enableKinetic)}this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.PorttiDrag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){if(this.kinetic){this.kinetic.begin()}},panMap:function(a){if(this.kinetic){this.kinetic.update(a)}this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:true,animate:false})},panMapDone:function(c){if(this.panned){var b=null;if(this.kinetic){b=this.kinetic.end(c)}this.map.pan(this.handler.last.x-c.x,this.handler.last.y-c.y,{dragging:!!b,animate:false});if(b){var a=this;this.kinetic.move(b,function(d,f,e){a.map.pan(d,f,{dragging:!e,animate:false})})}this.panned=false}},CLASS_NAME:"OpenLayers.Control.PorttiDragPan"});OpenLayers.Handler.PorttiDrag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,touch:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(d,c,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===true){var b=this;this._docMove=function(e){b.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})};this._docUp=function(e){b.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b))){this.started=true;this.start=b.xy;this.last=b.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(b);this.callback("down",[b.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True}document.onselectstart=OpenLayers.Function.False;a=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return a},dragmove:function(a){this.lastMoveEvt=a;if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(a.element===document){this.adjustXY(a);this.setEvent(a)}else{this.removeDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=a.xy}return true
},dragend:function(b){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(b);this.removeDocumentEvents()}var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy])}document.onselectstart=this.oldOnselectstart}return true},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})}return this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null;if(this.dragging){this.mousemove(this.lastMoveEvt)}},mouseup:function(a){return this.dragend(a)},touchend:function(a){a.xy=this.last;return this.dragend(a)},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.eventsDiv)){if(this.documentDrag===true){this.addDocumentEvents()}else{var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(a){return(this.start==this.last)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.touch=false;this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0];a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=true;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.PorttiDrag"});OpenLayers.Control.PorttiMouse=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,_hoverEvent:null,name:"PorttiMouse",events:new OpenLayers.Events(),constructor:function(a){this.sandbox=a.sandbox;this.mapmodule=a.mapmodule},isReallyLeftClick:function(b){var a=OpenLayers.Event.isLeftClick(b);if(a===false){return false}if(a===true){return true}if(a!=0){return false}return true},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);
OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(b){if(!this.isReallyLeftClick(b)){return}var a=!this.performedDrag;this.performedDrag=false;if(a){}return a},defaultDblClick:function(a){this.mapmodule.centerMapByPixels(a.xy.x,a.xy.y,true,true);this.mapmodule.zoomIn();return false},defaultMouseDown:function(a){if(!this.isReallyLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.eventsDiv.appendChild(this.zoomBox)}document.onselectstart=OpenLayers.Function.False},defaultMouseMove:function(c){this.mousePosition=c.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var b=Math.abs(this.mouseDragStart.x-c.xy.x);var a=Math.abs(this.mouseDragStart.y-c.xy.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,a)+"px";if(c.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=c.xy.x+"px"}if(c.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=c.xy.y+"px"}}else{if(this.performedDrag===false){this.mapmodule.notifyStartMove()}var b=this.mouseDragStart.x-c.xy.x;var a=this.mouseDragStart.y-c.xy.y;this.mapmodule.moveMapByPixels(b,a,true,true);this.mouseDragStart=c.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}else{this.notifyHover(c)}},defaultMouseUp:function(a){if(!this.isReallyLeftClick(a)){return}if(this.zoomBox){this.zoomBoxEnd(a)}else{if(this.performedDrag){var c=this.mapmodule._navigationHistoryTool;var e=c.getState();c.previousStack.unshift(e);if(c.previousStack.length>1){c.onPreviousChange(c.previousStack[1],c.previousStack.length-1)}if(c.previousStack.length>(c.limit+1)){c.previousStack.pop()}if(c.nextStack.length>0){c.nextStack=[];c.onNextChange(null,0)}this.mapmodule.notifyMoveEnd()}else{var d=this.map.getLonLatFromViewPortPx(a.xy);var b=this.sandbox.getEventBuilder("MapClickedEvent");var a=b(d,a.xy.x,a.xy.y);this.sandbox.notifyAll(a,true)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor=""},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.eventsDiv)){if(this.zoomBox){this.removeZoomBox()}this.mapmodule.notifyMoveEnd();this.mouseDragStart=null;this.map.div.style.cursor=""}},defaultWheelUp:function(a){this.mapmodule.centerMapByPixels(a.xy.x,a.xy.y,true,true);this.mapmodule.zoomIn()},defaultWheelDown:function(a){this.mapmodule.centerMapByPixels(a.xy.x,a.xy.y,true,true);this.mapmodule.zoomOut()},zoomBoxEnd:function(b){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-b.xy.x)>5||Math.abs(this.mouseDragStart.y-b.xy.y)>5){var h=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var a=this.map.getLonLatFromViewPortPx(b.xy);var g=Math.max(h.lat,a.lat);var c=Math.min(h.lat,a.lat);var f=Math.min(h.lon,a.lon);var d=Math.max(h.lon,a.lon);var e=new OpenLayers.Bounds(f,c,d,g);this.mapmodule.zoomToExtent(e,true)}else{this.mapmodule.centerMapByPixels(b.xy.x,b.xy.y,true,true);this.mapmodule.zoomIn()}this.removeZoomBox()}},removeZoomBox:function(){this.map.eventsDiv.removeChild(this.zoomBox);this.zoomBox=null},notifyHover:function(a){if(this.mapmodule.getStealth()){return}if(!this._hoverEvent){this._hoverEvent=this.sandbox.getEventBuilder("MouseHoverEvent")()}var b=this.map.getLonLatFromViewPortPx(a.xy);this._hoverEvent.set(b.lon,b.lat);this.sandbox.notifyAll(this._hoverEvent,true)},onWheelEvent:function(c){var b=false;var a=OpenLayers.Event.element(c);while(a!=null){if(this.map&&a==this.map.div){b=true;break}if(a.className=="olPopup"){b=false;break}a=a.parentNode}if(b){var d=0;if(!c){c=window.event}if(c.wheelDelta){d=c.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){d=-d}}else{if(c.detail){d=-c.detail/3}}if(d){c.xy=this.mousePosition;if(d<0){this.defaultWheelDown(c)
}else{this.defaultWheelUp(c)}}OpenLayers.Event.stop(c)}},CLASS_NAME:"OpenLayers.Control.PorttiMouse"});Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapMeasurementRequest",function(a){this._creator=null;this._value=a},{__name:"ShowMapMeasurementRequest",getName:function(){return this.__name},getValue:function(){return this._value}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.$("OpenLayers.Control.GetInfoAdapter",OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",handlerOptions:null,handler:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.prototype.EVENT_TYPES;a=a||{};this.callback=a.callback;this.hoverCallback=a.hoverCallback;a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},activate:function(){if(!this.active){this.handler.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});this.request(a.xy,{hover:true})},cancelHover:function(){},request:function(b,a){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");var c=this.map.getLonLatFromViewPortPx(b);if(a.hover&&this.hoverCallback){this.hoverCallback(c,b,a)}else{if(this.callback){this.callback(c,b,a)}}},CLASS_NAME:"OpenLayers.Control.GetInfoAdapter"}));Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.getinfo.GetFeatureInfoHandler",function(a,b){this.getInfoPlugin=b;this.sandbox=a},{__name:"GetFeatureInfoHandler",getName:function(){return this.__name},init:function(a){},_getWmsReqParams:function(d,b){var e=this.sandbox.getMap();var c=d.getMapWidth();if(!c){c=e.getWidth()}var a=d.getMapHeight();if(!a){a=e.getHeight()}return;"REQUEST=GetFeatureInfo&EXCEPTIONS=application/vnd.ogc.se_xml&SRS="+this._getSRS(d)+"&VERSION=1.1.1&BBOX="+this._getBBString(d)+"&X="+d.getX()+"&Y="+d.getY()+"&INFO_FORMAT="+b.getQueryFormat()+"&QUERY_LAYERS="+b.getWmsName()+"&WIDTH="+c+"&HEIGHT="+a+"&FEATURE_COUNT=1&FORMAT=image/png&SERVICE=WMS&STYLES="+b.getCurrentStyle().getName()+"&LAYERS="+b.getWmsName()},_getWmtsReqParams:function(d,c){var b=this.getInfoPlugin._map.getLayersByName("layer_"+c.getId());var e=new OpenLayers.LonLat(d.getLon(),d.getLat());var a=b[0].getTileInfo(e);var f=b[0].url+"?service=WMTS&request=GetFeatureInfo&version="+b[0].version+"&layer="+b[0].layer+"&style="+b[0].style+"&format=text/xml&TileMatrixSet="+b[0].matrixSet+"&TileMatrix="+b[0].getMatrix().identifier+"&TileCol="+a.col+"&TileRow="+a.row+"&I="+a.i+"&J="+a.j+"&InfoFormat=text/xml";return f},_getBBString:function(b){var a=b.getBoundingBox();if(!a){a=this.getInfoPlugin.getMapModule().getMap().getExtent()}return a.left+","+a.bottom+","+a.right+","+a.top},_getSRS:function(b){var a=b.getSRS();if(!a){a="EPSG:3067"}return a},_notifyNotSupported:function(a,c){var g="rightpanel_wms_getfeatureinfo_not_supported_txt";var f=this.sandbox.getText(g)+": "+a+".";var b=this.sandbox.getEventBuilder("AfterAppendFeatureInfoEvent");var d=b(a,f);this.sandbox.copyObjectCreatorToFrom(d,c);this.sandbox.notifyAll(d)},handleRequest:function(r,b){var n=b.getMapLayers();var c=n.length;var j=(c>0)&&n[0].isLayerOfType("WFS");var a=!j&&(c>0);var m=this.sandbox.getEventBuilder("AfterGetFeatureInfoEvent");var s=m(a,j);this.sandbox.copyObjectCreatorToFrom(s,b);this.sandbox.notifyAll(s,true);if(!a){return
}var u=this;var d=function(e,i){this.name=e;this.format=i;this.success=function(x){var A="";if(this.format==="application/vnd.ogc.gml"||this.format==="application/gnd_ogc.se_xml"||this.format==="application/vnd.ogc.wms_xml"||this.format==="text/xml"){A=x.responseText.replace(/</g,"&lt;").replace(/>/g,"&gt;")}else{if(x.responseText===""){A=u.sandbox.getText("mapcontrolsservice_not_found_wms_feature_info")}else{A=x.responseText}}var y=u.sandbox.getEventBuilder("AfterAppendFeatureInfoEvent");var z=y(e,A);u.sandbox.copyObjectCreatorToFrom(z,b);u.sandbox.notifyAll(z,true)};this.failure=function(x){var y=u.sandbox.getEventBuilder("AfterAppendFeatureInfoEvent");var z=y(e,x.responseText);u.sandbox.copyObjectCreatorToFrom(z,b);u.sandbox.notifyAll(z,true)}};var t=this.sandbox.getMap();for(var o=0;o<c;o++){this.sandbox._core.actionInProgressGetFeatureInfo();var v=b.getMapLayers()[o];var w=v.getName();var q=v.getQueryFormat();var h=((q!==null)&&(q!==""));if(!v.getQueryable()||v.isLayerOfType("WFS")||!h){this._notifyNotSupported(w,b);continue}var f="";if(f.indexOf("?")<0){f=f+"?"}if(v.isLayerOfType("WMTS")){f=this._getWmtsReqParams(b,v)}else{if(v.isLayerOfType("WMS")){var l=b.getMapWidth();if(!l){l=t.getWidth()}var k=b.getMapHeight();if(!k){k=t.getHeight()}f=startup.globalMapAjaxUrl+"&action_route=GetFeatureInfoWMS&REQUEST=GetFeatureInfo&layerId="+v.getId()+"&EXCEPTIONS=application/vnd.ogc.se_xml&SRS="+this._getSRS(b)+"&VERSION=1.1.1&BBOX="+t.getExtent()+"&X="+b.getX()+"&Y="+b.getY()+"&INFO_FORMAT="+v.getQueryFormat()+"&QUERY_LAYERS="+v.getWmsName()+"&WIDTH="+l+"&HEIGHT="+k+"&FEATURE_COUNT=1&FORMAT=image/png&SERVICE=WMS&STYLES="+v.getCurrentStyle().getName()+"&LAYERS="+v.getWmsName()}}var g=new d(w,q);this.sandbox.ajax(f,function(e){g.success(e)},function(e){g.failure(e)})}}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.GetInfoPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"GetInfoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){},unregister:function(){},init:function(a){a.printDebug("[GetInfoPlugin] init");var c=this;var b="Oskari.mapframework.mapmodule-plugin.getinfo.GetFeatureInfoHandler";this.requestHandlers={getFeatureInfoHandler:Oskari.clazz.create(b,a,c)};this._sandbox.addRequestHandler("GetFeatureInfoRequest",this.requestHandlers.getFeatureInfoHandler)},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();var b=this;this._getinfoTool=new (Oskari.$("OpenLayers.Control.GetInfoAdapter"))({callback:function(e,d,c){b.handleGetInfo(e,d,c)},hoverCallback:function(e,d,c){b.handleGetInfoHover(e,d,c)}});this.getMapModule().addMapControl("getinfo",this._getinfoTool);a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{ToolSelectedEvent:function(a){if(a.getToolName=="map_control_select_tool"){this._getinfoTool.activate()}else{this._getinfoTool.deactivate()}},AfterDeactivateAllOpenlayersMapControlsButNotMeasureToolsEvent:function(a){this.afterDeactivateAllOpenlayersMapControlsButNotMeasureToolsEvent()},AfterDeactivateAllOpenlayersMapControlsEvent:function(a){this.afterDeactivateAllOpenlayersMapControlsEvent(a)},MapClickedEvent:function(a){var d=a.getLonLat();var c=a.getMouseX();var b=a.getMouseY();if(this._activated){this.buildWMSQueryOrWFSFeatureInfoRequest(d,c,b)}},AfterHighlightMapLayerEvent:function(a){this._handleHighlightLayer(a)},AfterDimMapLayerEvent:function(a){this._handleDimLayer()}},_handleHighlightLayer:function(a){this._activated=true},_handleDimLayer:function(){this._activated=false},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},handleGetInfo:function(c,b,a){this._sandbox.printDebug("GETINFO "+c.lat+","+c.lon);
this.buildWMSQueryOrWFSFeatureInfoRequest(c,b.x,b.y)},handleGetInfoHover:function(c,b,a){this._sandbox.printDebug("GETINFO HOVER "+c.lat+","+c.lon)},arrayToCSV:function(c){var b="";for(var a=0;a<c.length;a++){b+=c[a];if(a<c.length-1){b+=","}}return b},buildWMSQueryOrWFSFeatureInfoRequest:function(g,c,b){var k=this._sandbox;var e=k.findAllHighlightedLayers();this._projectionCode="EPSG:3067";if(e[0]&&e[0]!=null&&(e[0].isLayerOfType("WMS")||e[0].isLayerOfType("WMTS"))){var f=k.getMap().getWidth();var j=k.getMap().getHeight();var l=k.getMap().getBbox();var a=k.findAllHighlightedLayers();k.request(this,k.getRequestBuilder("GetFeatureInfoRequest")(a,g.lon,g.lat,c,b,f,j,l,this._projectionCode))}else{if(e[0]&&e[0]!=null&&e[0].isLayerOfType("VECTOR")){this.getMapModule().notifyAll(k.getEventBuilder("FeaturesGetInfoEvent")(e[0],null,g.lon,g.lat,this._map.getProjection,"GetFeatureInfo"))}else{if(e[0]&&e[0]!=null&&e[0].isLayerOfType("WFS")){var i=e[0];if(i!=null&&i.getId()!=null){this._selectedCoordinatesLon=[];this._selectedCoordinatesLat=[];this._selectedCoordinatesLon.push(g.lon);this._selectedCoordinatesLat.push(g.lat);var h=this._map.getExtent();var d="&flow_pm_wfsLayerId="+i.getId()+"&flow_pm_point_x="+this.arrayToCSV(this._selectedCoordinatesLon)+"&flow_pm_point_y="+this.arrayToCSV(this._selectedCoordinatesLat)+"&flow_pm_bbox_min_x="+h.left+"&flow_pm_bbox_min_y="+h.bottom+"&flow_pm_bbox_max_x="+h.right+"&flow_pm_bbox_max_y="+h.top+"&flow_pm_zoom_level="+this._map.getZoom();k.request(this,k.getRequestBuilder("HighlightWFSFeatureRequestByGeoPoint")(d))}}}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.SketchLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{getName:function(){return this.pluginName},__name:"SketchLayerPlugin",setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},getMapModule:function(){return this.mapModule},register:function(){},unregister:function(){},init:function(a){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();this.createMapSketchLayer();this.createMapVectorLayer();var c={graphicOpacity:"1",fillOpacity:"0.95",strokeColor:"#000000",fillColor:"#ff00ff",strokeOpacity:"1",strokeWidth:1,pointRadius:1,cursor:"pointer"};var b=OpenLayers.Util.applyDefaults(c,OpenLayers.Feature.Vector.style["default"]);this._drawArea=new OpenLayers.Control.DrawFeature(this._polygonLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:true,style:b}});this._drawArea.id="drawarea";this.getMapModule().addMapControl("drawarea",this._drawArea);this._vectorSelector=new OpenLayers.Control.SelectFeature(this._vectorLayer,{clickout:false,toggle:false,multiple:false,hover:false,box:false});this._vectorSelector.id="vectorselector";this.getMapModule().addMapControl("vectorselector",this._vectorSelector);a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterDrawPolygonEvent:function(a){this.afterDrawPolygonEvent(a)},AfterDrawSelectedPolygonEvent:function(a){this.afterDrawSelectedPolygonEvent(a)},AfterErasePolygonEvent:function(a){this.afterErasePolygonEvent(a)},AfterSelectPolygonEvent:function(a){this.afterSelectPolygonEvent(a)},AfterRemovePolygonEvent:function(a){this.afterRemovePolygonEvent(a)},ToolSelectedEvent:function(a){if(a.getToolName()=="map_control_draw_area_tool"){this._drawArea.activate()}else{this._drawArea.deactivate();if(a.getToolName()=="map_control_select_tool"){this.clearBbox()}}}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},createMapVectorLayer:function(){var b=this.getName();var d=this;var c=new function(e){this.handle=function(f){d.setSelectMetadata(f.feature.id,f.feature.attributes.groupId)}}(b);var a=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);
a.fillOpacity=0.2;a.graphicOpacity=1;a.strokeColor="blue";a.fillColor="blue";this._vectorLayer=new OpenLayers.Layer.Vector("Vector Layer",{style:a});this._vectorLayer.events.on({featureselected:c.handle});this._map.addLayer(this._vectorLayer)},createMapSketchLayer:function(){var a=this.getName();var c=this;var e=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);e.fillOpacity=0.95;e.graphicOpacity=1;e.strokeColor="#000000";e.fillColor="#ff00ff";this._polygonLayer=new OpenLayers.Layer.Vector("Polygon Layer",{style:e});var b=new function(f){this.handle=function(g){c.clearBbox()}}(a);var d=new function(f){this.handle=function(g){c.setBbox()}}(a);this._polygonLayer.events.on({sketchstarted:b.handle,featureadded:d.handle});this.getMapModule()._map.addLayer(this._polygonLayer)},clearBbox:function(){var a=this._map.getLayersByName("Polygon Layer");if(a[0]!=null){a[0].destroyFeatures()}},setBbox:function(){var b=this._map.getLayersByName("Polygon Layer");var a=Oskari.clazz.create("Oskari.mapframework.domain.Polygon");if(b[0]!=undefined){a.setTop(b[0].getDataExtent().top);a.setLeft(b[0].getDataExtent().left);a.setBottom(b[0].getDataExtent().bottom);a.setRight(b[0].getDataExtent().right);a.setDescription("Valittu alue");a.setColor("#ff00ff");a.setId(-1)}else{a.setId(-2)}this._sandbox.request(this,this._sandbox.getRequestBuilder("UpdateHiddenValueRequest")(a))},setSelectMetadata:function(b,a){this._sandbox.request(this,this._sandbox.getRequestBuilder("SelectPolygonRequest")(b,a))},afterDrawPolygonEvent:function(d){var b=[];var g=""+d.getPolygon().getTop()+"";g=g.replace(".","-");var m=""+d.getPolygon().getLeft()+"";m=m.replace(".","-");var h=""+d.getPolygon().getBottom()+"";h=h.replace(".","-");var n=""+d.getPolygon().getRight()+"";n=n.replace(".","-");var a=new OpenLayers.Bounds(d.getPolygon().getLeft(),d.getPolygon().getBottom(),d.getPolygon().getRight(),d.getPolygon().getTop());var i=new OpenLayers.Projection("EPSG:4326");var k=new OpenLayers.Projection("EPSG:3067");var f=a.transform(i,k);var e=new OpenLayers.Geometry.Point(m,g);b.push(e);e=new OpenLayers.Geometry.Point(m,h);b.push(e);e=new OpenLayers.Geometry.Point(n,h);b.push(e);e=new OpenLayers.Geometry.Point(n,g);b.push(e);b.push(b[0]);var l=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);l.fillOpacity=0.2;l.graphicOpacity=1;l.display=d.getPolygon().getDisplay();l.strokeColor=d.getPolygon().getColor();l.fillColor=d.getPolygon().getColor();var j=f.toGeometry();var c=new OpenLayers.Feature.Vector(j,{id:d.getPolygon().getId(),groupId:g+"_"+m+"_"+h+"_"+n});c.id=d.getPolygon().getId();c.style=l;this._vectorLayer.addFeatures(c);this._vectorSelector.activate();if(d.getPolygon().getZoomToExtent()){this._map.zoomToExtent(f,true)}},afterDrawSelectedPolygonEvent:function(c){var e=""+c.getPolygon().getTop()+"";e=e.replace(".","-");var k=""+c.getPolygon().getLeft()+"";k=k.replace(".","-");var f=""+c.getPolygon().getBottom()+"";f=f.replace(".","-");var l=""+c.getPolygon().getRight()+"";l=l.replace(".","-");var a=new OpenLayers.Bounds(c.getPolygon().getLeft(),c.getPolygon().getBottom(),c.getPolygon().getRight(),c.getPolygon().getTop());var g=new OpenLayers.Projection("EPSG:4326");var i=new OpenLayers.Projection("EPSG:3067");var d=a.transform(g,i);var j=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);j.fillOpacity=0.95;j.graphicOpacity=1;j.display=c.getPolygon().getDisplay();j.strokeColor=c.getPolygon().getColor();j.fillColor=c.getPolygon().getColor();var h=d.toGeometry();var b=new OpenLayers.Feature.Vector(h,{id:c.getPolygon().getId(),groupId:e+"_"+k+"_"+f+"_"+l});b.id=c.getPolygon().getId();b.style=j;this._polygonLayer.addFeatures(b)},afterErasePolygonEvent:function(b){var c=this._vectorLayer.getFeatureById(b.getId());this._vectorLayer.removeFeatures(c);var a=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);a.fillOpacity=0.3;a.graphicOpacity=1;a.strokeColor="blue";a.fillColor="blue";if(c.style.display!="undefined"&&c.style.display!="none"){a.display="none"}else{a.display=""}c.style=a;this._vectorLayer.addFeatures(c);
this._vectorLayer.redraw()},afterSelectPolygonEvent:function(c){var a=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);a.strokeColor="blue";a.fillColor="blue";a.fillOpacity=0.3;a.graphicOpacity=1;var b=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);b.strokeColor="#CC2388";b.fillColor="#CC2388";b.fillOpacity=0.2;b.graphicOpacity=1;this._vectorLayer.redraw();var d=this._vectorLayer.getFeatureById(c.getId());this._vectorLayer.drawFeature(d,b)},afterRemovePolygonEvent:function(c){var b=c.getShowPol();if(b){var d=this._vectorLayer.getFeatureById(c.getId());var a=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);a.strokeColor="blue";a.fillColor="blue";a.fillOpacity=0.2;a.graphicOpacity=1;this._vectorLayer.redraw();this._vectorLayer.drawFeature(d,a)}else{var d=this._vectorLayer.getFeatureById(c.getId());var a=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);this._vectorLayer.removeFeatures(d);a.fillOpacity=0.2;a.graphicOpacity=1;a.strokeColor="blue";a.fillColor="blue";a.display="none";d.style=a;this._vectorLayer.addFeatures(d);this._vectorLayer.redraw()}}},{protocol:["Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesGrid",function(a){this.grid=[];this.map=null;this.tileSize=null;this.maxExtent=null;this.buffer=0;this.numLoadingTiles=0;for(p in a){this[p]=a[p]}},{destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null},clearGrid:function(){if(this.grid){for(var f=0,b=this.grid.length;f<b;f++){var e=this.grid[f];for(var c=0,a=e.length;c<a;c++){var d=e[c];d.destroy()}}this.grid=[]}},moveTo:function(d,a){d=d||this.map.getExtent();if(d!=null){var c=!this.grid.length||a;var b=this.getTilesBounds();if(c||!b.containsBounds(d,true)){this.initGriddedTiles(d)}else{this.moveGriddedTiles(d)}}},setTileSize:function(a){},getTilesBounds:function(){var e=null;if(this.grid.length){var a=this.grid.length-1;var d=this.grid[a][0];var b=this.grid[0].length-1;var c=this.grid[0][b];e=new OpenLayers.Bounds(d.bounds.left,d.bounds.bottom,c.bounds.right,c.bounds.top)}return e},calculateGridLayout:function(a,o,e){var k=e*this.tileSize.w;var c=e*this.tileSize.h;var i=a.left-o.left;var l=Math.floor(i/k)-this.buffer;var j=i/k-l;var f=-j*this.tileSize.w;var m=o.left+l*k;var b=a.top-(o.bottom+c);var h=Math.ceil(b/c)+this.buffer;var n=h-b/c;var d=-n*this.tileSize.h;var g=o.bottom+h*c;return{tilelon:k,tilelat:c,tileoffsetlon:m,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},initGriddedTiles:function(i){var g=this.map.getSize();var w=Math.ceil(g.h/this.tileSize.h)+Math.max(1,2*this.buffer);var A=Math.ceil(g.w/this.tileSize.w)+Math.max(1,2*this.buffer);var o=this.maxExtent;var s=this.map.getResolution();var r=this.calculateGridLayout(i,o,s);var f=Math.round(r.tileoffsetx);var c=Math.round(r.tileoffsety);var k=r.tileoffsetlon;var n=r.tileoffsetlat;var e=r.tilelon;var j=r.tilelat;this.origin=new OpenLayers.Pixel(f,c);var v=f;var z=k;var u=0;var a=parseInt(this.map.layerContainerDiv.style.left);var t=parseInt(this.map.layerContainerDiv.style.top);do{var h=this.grid[u++];if(!h){h=[];this.grid.push(h)}k=z;f=v;var d=0;do{var b=new OpenLayers.Bounds(k,n,k+e,n+j);var m=f;m-=a;var l=c;l-=t;var q=new OpenLayers.Pixel(m,l);var B=h[d++];if(!B){B=this.addTile(b,q);h.push(B)}else{B.moveTo(b,q,false)}k+=e;f+=this.tileSize.w}while((k<=i.right+e*this.buffer)||d<A);n-=j;c+=this.tileSize.h}while((n>=i.bottom-j*this.buffer)||u<w);this.removeExcessTiles(u,d)},addTile:function(b,a){return new OpenLayers.Tile(this.layer,b,a,"",this.tileSize)},moveGriddedTiles:function(c){var b=this.buffer||1;while(true){var a=this.grid[0][0].position;var d=this.map.getViewPortPxFromLayerPx(a);if(d.x>-this.tileSize.w*(b-1)){this.shiftColumn(true)}else{if(d.x<-this.tileSize.w*b){this.shiftColumn(false)}else{if(d.y>-this.tileSize.h*(b-1)){this.shiftRow(true)}else{if(d.y<-this.tileSize.h*b){this.shiftRow(false)}else{break}}}}}},shiftRow:function(n){var c=(n)?0:(this.grid.length-1);var b=this.grid;var f=b[c];var e=this.map.getResolution();var h=(n)?-this.tileSize.h:this.tileSize.h;
var g=e*-h;var m=(n)?b.pop():b.shift();for(var j=0,l=f.length;j<l;j++){var d=f[j];var a=d.bounds.clone();var k=d.position.clone();a.bottom=a.bottom+g;a.top=a.top+g;k.y=k.y+h;m[j].moveTo(a,k)}if(n){b.unshift(m)}else{b.push(m)}},shiftColumn:function(m){var d=(m)?-this.tileSize.w:this.tileSize.w;var c=this.map.getResolution();var k=c*d;for(var e=0,g=this.grid.length;e<g;e++){var l=this.grid[e];var j=(m)?0:(l.length-1);var b=l[j];var a=b.bounds.clone();var f=b.position.clone();a.left=a.left+k;a.right=a.right+k;f.x=f.x+d;var h=m?this.grid[e].pop():this.grid[e].shift();h.moveTo(a,f);if(m){l.unshift(h)}else{l.push(h)}}},removeExcessTiles:function(e,c){while(this.grid.length>e){var f=this.grid.pop();for(var b=0,a=f.length;b<a;b++){var d=f[b];d.destroy()}}while(this.grid[0].length>c){for(var b=0,a=this.grid.length;b<a;b++){var f=this.grid[b];var d=f.pop();d.destroy()}}},onMapResize:function(){},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesGrid"});Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesStrategy",function(a){this.debugGridFeatures=true;this.options=a;this.tileQueue=a.tileQueue;this.autoActivate=true;this.autoDestroy=false;this.grid=null;this.bounds=null;for(p in a){this[p]=a[p]}this.active=false},{setLayer:function(a){this.layer=a},flushTileQueue:function(){var b=this.tileQueue.queue;var a=[];for(var c=0;c<b.length;c++){if(b[c].tileFeature!=null){a.push(b[c].tileFeature);b[c].tileFeature=null}}if(a.length>0){this.layer.destroyFeatures(a)}this.tileQueue.flushQueue()},unloadOutOfViewFeatures:function(){},ratio:1,activate:function(){if(this.active){return false}this.active=true;this.grid=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesGrid",{map:this.layer.map,layer:this.layer,maxExtent:this.layer.map.getMaxExtent(),tileSize:this.layer.map.getTileSize()});this.layer.events.on({refresh:this.updateRefresh,scope:this});return true},deactivate:function(){if(!this.active){return false}this.layer.events.un({refresh:this.update,scope:this});this.grid.destroy();this.grid=null;return true},updateRefresh:function(a){this.update()},updateMoveEnd:function(a){this.update()},update:function(b){var a=this.layer.map.getExtent();this.grid.moveTo(a,true);this.flushTileQueue();var c=this.layer.map.getZoom();if(c<this.minZoom){return}this.triggerRead()},invalidBounds:function(a){if(!a){a=this.layer.map.getExtent()}return !this.bounds||!this.bounds.containsBounds(a)},triggerUnload:function(a){this.layer.destroyFeatures()},triggerRead:function(){var b=this.grid.grid;var f=[];var e=this.debugGridFeatures;for(var a=0;a<b.length;a++){for(var h=0;h<b[a].length;h++){var n=b[a][h].bounds.clone();var i={left:n.left,top:n.top,right:n.right,bottom:n.bottom};var d=null;if(e){var m=new OpenLayers.Geometry.Point(n.left,n.bottom);var l=new OpenLayers.Geometry.Point(n.right,n.top);var k=new OpenLayers.Geometry.Point(n.left,n.top);var j=new OpenLayers.Geometry.Point(n.right,n.bottom);var g=new OpenLayers.Geometry.LineString([m,j,l,k,m]);var d=new OpenLayers.Feature.Vector(g,{featureClassName:this.CLASS_NAME,description:""});d.renderIntent="tile";f.push(d)}var o=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTile",{bounds:i,tileFeature:d});this.tileQueue.pushJob(o)}}if(e){this.layer.addFeatures(f)}},merge:function(b){var a=b.features;if(a&&a.length>0){this.layer.addFeatures(a)}},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesStrategy"});Oskari.clazz.define("Oskari.mapframework.mapmodule.TilesGridPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"TilesGridPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},init:function(a){},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();this.createTilesGrid();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}this.afterMapMoveEvent()},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)
}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},createTilesGrid:function(){var d=this;var a=d._sandbox;var b=Oskari.clazz.create("Oskari.mapframework.gridcalc.TileQueue");a.getMap().setTileQueue(b);var e=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesStrategy",{tileQueue:b});e.debugGridFeatures=false;this.tileQueue=b;this.tileStrategy=e;var c=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:3,strokeColor:"red",strokeWidth:2,fillColor:"#800000"}),tile:new OpenLayers.Style({strokeColor:"#008080",strokeWidth:5,fillColor:"#ffcc66",fillOpacity:0.5}),select:new OpenLayers.Style({fillColor:"#66ccff",strokeColor:"#3399ff"})});this._tilesLayer=new OpenLayers.Layer.Vector("Tiles Layer",{strategies:[e],styleMap:c,visibility:true});this._map.addLayer(this._tilesLayer);this._tilesLayer.setOpacity(0.3)},getTileQueue:function(){return this.tileQueue},afterMapMoveEvent:function(a){this.tileStrategy.update();this._tilesLayer.redraw()},eventHandlers:{AfterMapMoveEvent:function(a){this.afterMapMoveEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.MarkersPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"MarkersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},init:function(a){},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();this.createMapMarkersLayer();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterHideMapMarkerEvent:function(a){this.afterHideMapMarkerEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},createMapMarkersLayer:function(){var b=this._sandbox;var a=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(a)},afterHideMapMarkerEvent:function(b){var a=this._map.getLayersByName("Markers");if(a!=null&&a[0]!=null){a[0].setVisibility(false)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",function(a){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._conf=a;this.container=null},{__name:"SearchPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},init:function(a){var e="Etsi...";var b="Hae";var d="Sulje";this.template=jQuery('<div class="mapplugin search-div"><div class="search-textarea-and-button"><input placeholder="'+e+'" type="text" /><input type="button" value="'+b+'" name="search" /></div><div class="results"><div class="header"><div class="close" title="'+d+'"></div></div><div class="content">&nbsp;</div></div></div>');this.templateResultsTable=jQuery("<table><thead><tr><th>Nimi</th><th>Kunta</th><th>Tyyppi</th></tr></thead><tbody></tbody></table>");this.templateResultsRow=jQuery("<tr><td nowrap='nowrap'></td><td nowrap='nowrap'></td><td nowrap='nowrap'></td></tr>");var c=null;if(this.conf&&this.conf.url){c=this.conf.url}else{c=a.getAjaxUrl()+"action_route=GetSearchResult"}this.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",c)},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}this._createUI()},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)
}a.unregister(this);this._map=null;this._sandbox=null;this.container.remove()},start:function(a){},stop:function(a){},eventHandlers:{},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},_createUI:function(){var b=this._sandbox;var d=this;var e=jQuery(this._map.div);var c=this.template.clone();this.container=c;var d=this;var a=c.find("input[type=text]");a.focus(function(){b.request(d.getName(),b.getRequestBuilder("DisableMapKeyboardMovementRequest")())});a.blur(function(){b.request(d.getName(),b.getRequestBuilder("EnableMapKeyboardMovementRequest")())});a.keypress(function(f){d._checkForEnter(f)});c.find("input[type=button]").click(function(f){d._doSearch()});c.find("div.close").click(function(f){d._hideSearch()});c.find("div.results").hide();e.append(c);if(this._conf&&this._conf.location){if(this._conf.location.top){c.css("top",this._conf.location.top)}if(this._conf.location.left){c.css("left",this._conf.location.left)}if(this._conf.location.right){c.css("right",this._conf.location.right)}if(this._conf.location.bottom){c.css("bottom",this._conf.location.bottom)}}},_checkForEnter:function(b){var a;if(window.event){a=window.event.keyCode}else{if(b){a=b.which}}if(b.keyCode==13){this._doSearch()}},_doSearch:function(){if(this._searchInProgess==true){return}var d=this;this._hideSearch();this._searchInProgess=true;var a=this.container.find("input[type=text]");a.addClass("search-loading");var e=a.val();var c=function(f){d._showResults(f);d._enableSearch()};var b=function(){d._enableSearch()};this.service.doSearch(e,c,b)},_showResults:function(g){var b=g.error;var s=this;var c=this.container.find("div.results");var m=c.find("div.header");var l=c.find("div.content");if(b!=null){l.html(b);c.show();return}var o=g.totalCount;if(o==0){l.html("search_published_map_no_results");c.show()}else{if(o==1){var f=g.locations[0].lon;var h=g.locations[0].lat;var a=g.locations[0].zoomLevel;this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(f,h,a,true))}else{var q=this.templateResultsTable.clone();var k=q.find("tbody");for(var n=0;n<o;n++){if(n>=100){k.append("<tr><td class='search-result-too-many' colspan='3'>search_published_map_too_many_results</td></tr>");break}var f=g.locations[n].lon;var h=g.locations[n].lat;var a=g.locations[n].zoomLevel;var j=this.templateResultsRow.clone();j.attr("data-location",f+"---"+h+"---"+a);var t=g.locations[n].name;var r=g.locations[n].village;var e=g.locations[n].type;var d=j.find("td");jQuery(d[0]).append(t);jQuery(d[1]).append(r);jQuery(d[2]).append(e);k.append(j)}l.html(q);c.show();k.find("tr[data-location]").addClass("clickable").click(function(){s._resultClicked(jQuery(this).attr("data-location"))}).find("a").hover(function(){jQuery(this).parents("tr").unbind("click")},function(){jQuery(this).parents("tr").click(function(){s._resultClicked(jQuery(this).attr("data-location"))})})}}},_resultClicked:function(c){var a=c.split("---");var e=a[0];var d=a[1];var b=a[2];this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(e,d,b,true))},_enableSearch:function(){this._searchInProgess=false;jQuery("#search-string").removeClass("search-loading")},_hideSearch:function(){this.container.find("div.results").hide();this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("HideMapMarkerRequest")())}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",function(a){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._conf=a;this._indexMap=null;this._indexMapUrl="/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/suomi25m_tm35fin.png"},{__name:"IndexMapPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},init:function(a){var c=new OpenLayers.Layer.Image("Overview map image",this._indexMapUrl,new OpenLayers.Bounds(26783,6608595,852783,7787250),new OpenLayers.Size(120,173));
var b={mapOptions:{maxExtent:new OpenLayers.Bounds(26783,6608595,852783,7787250),units:"m",projection:this._map.getProjection(),numZoomLevels:1},layers:[c],size:new OpenLayers.Size(120,173),autoPan:false};this._indexMap=new OpenLayers.Control.OverviewMap(b)},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}this.getMapModule().addMapControl("overviewMap",this._indexMap)},stopPlugin:function(a){this.getMapModule().removeMapControl("overviewMap");for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapMoveEvent:function(a){if(this._indexMap){this._indexMap.update()}}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",function(a){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._conf=a;this._scalebar=null},{__name:"ScaleBarPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},init:function(a){this._scalebar=new OpenLayers.Control.ScaleLine()},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}this.getMapModule().addMapControl("scaleBar",this._scalebar)},stopPlugin:function(a){this.getMapModule().removeMapControl("scaleBar");for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapMoveEvent:function(a){if(this._scalebar){this._scalebar.update()}}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this._visibilityPollingInterval=1500;this._visibilityCheckOrder=0;this._previousTimer=null},{__name:"LayersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(a){this.requestHandlers={layerVisibilityHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",a,this),layerContentHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",a,this)}},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}a.addRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler);a.addRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler)},stopPlugin:function(a){a.removeRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler);a.removeRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler);for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(a){this._afterRearrangeSelectedMapLayerEvent(a)},MapMoveStartEvent:function(){this._visibilityCheckOrder++;if(this._previousTimer){clearTimeout(this._previousTimer);
this._previousTimer=null}},AfterMapMoveEvent:function(){var a=this;if(this._previousTimer){clearTimeout(this._previousTimer);this._previousTimer=null}this._visibilityCheckOrder++;this._previousTimer=setTimeout(function(){a._checkLayersVisibility(a._visibilityCheckOrder)},this._visibilityPollingInterval)},AfterMapLayerAddEvent:function(a){this._parseGeometryForLayer(a.getMapLayer())}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(a){},_parseGeometryForLayer:function(c){if(c.getGeometry().length==0){var a=c.getGeometryWKT();if(!a){return}var f=new OpenLayers.Format.WKT();var e=f.read(a);if(e){if(e.constructor!=Array){e=[e]}var d=[];for(var b=0;b<e.length;++b){d.push(e[b].geometry)}c.setGeometry(d)}else{}}},_checkLayersVisibility:function(a){if(a!=this._visibilityCheckOrder){return}var d=this._sandbox.findAllSelectedMapLayers();for(var c=0;c<d.length;++c){var b=d[c];if(!b.isVisible()){continue}this.notifyLayerVisibilityChanged(b)}this._visibilityCheckScheduled=false},_isInScale:function(a){var b=this._sandbox.getMap().getScale();return a.isInScale(b)},isInGeometry:function(b){var c=b.getGeometry();var d=null;for(var a=0;a<c.length;++a){if(!d){d=c[a].getBounds()}else{d.extend(c[a].getBounds())}}if(d){return this.getMap().getExtent().intersectsBounds(d)}return true},notifyLayerVisibilityChanged:function(b){var f=b.isVisible();var d=b.isVisible();if(b.isVisible()){f=this._isInScale(b);d=this.isInGeometry(b)}var e=this.getMap();if(f&&d&&b.isVisible()){var a=e.getLayersByName("layer_"+b.getId());if(a&&a.setVisibility){a.setVisibility(true);a.display(true)}}else{var a=e.getLayersByName("layer_"+b.getId());if(a&&a.setVisibility){a.setVisibility(false);a.display(false)}}var c=this._sandbox.getEventBuilder("MapLayerVisibilityChangedEvent")(b,f,d);this._sandbox.notifyAll(c)},_afterRearrangeSelectedMapLayerEvent:function(b){var g=this._sandbox.findAllSelectedMapLayers();var j=0;var a=this._map.layers.length;var e=this._map.getLayersByName("Markers");if(e.length>0){this._map.setLayerIndex(e[0],a);a--}for(var h=0;h<g.length;h++){if(g[h].isBaseLayer()){for(var d=0;d<g[h].getSubLayers().length;d++){var e=this._map.getLayersByName("basemap_"+g[h].getSubLayers()[d].getId());this._map.setLayerIndex(e[0],j);j++}}else{if(g[h].isLayerOfType("WFS")){var l=new RegExp("wfs_layer_"+g[h].getId()+"_WFS_LAYER_IMAGE*","i");var c=this._map.getLayersByName(l);for(var f=0;f<c.length;f++){this._map.setLayerIndex(c[f],j);j++}var l=new RegExp("wfs_layer_"+g[h].getId()+"_HIGHLIGHTED_FEATURE*","i");var e=this._map.getLayersByName(l);if(e.length>0){this._map.setLayerIndex(e[0],j);j++}}else{var e=this._map.getLayersByName("layer_"+g[h].getId());this._map.setLayerIndex(e[0],j);j++}}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequest",function(a,b){this._creator=null;this._mapLayerId=a;this._visible=b},{__name:"MapModulePlugin.MapLayerVisibilityRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",function(a,b){this.sandbox=a;this.layersPlugin=b},{handleRequest:function(b,e){var a=e.getMapLayerId();var d=this.sandbox.findMapLayerFromSelectedMapLayers(a);if(!d){return}d.setVisible(e.getVisible());var f=this.layersPlugin.getMap();if(d.isBaseLayer()){for(var g=0;g<d.getSubLayers().length;g++){var c=f.getLayersByName("basemap_"+d.getSubLayers()[g].getId());c[0].setVisibility(d.isVisible());c[0].display(d.isVisible())}}else{var c=f.getLayersByName("layer_"+d.getId());c[0].setVisibility(d.isVisible());c[0].display(d.isVisible())}this.layersPlugin.notifyLayerVisibilityChanged(d)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequest",function(a){this._creator=null;
this._mapLayerId=a},{__name:"MapModulePlugin.MapMoveByLayerContentRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",function(a,b){this.sandbox=a;this.layersPlugin=b},{handleRequest:function(c,f){var b=f.getMapLayerId();var e=this.sandbox.findMapLayerFromSelectedMapLayers(b);if(!e){return}var d=this.layersPlugin.getMapModule().getClosestZoomLevel(e.getMinScale(),e.getMaxScale());this.layersPlugin.getMapModule().setZoomLevel(d,true);if(e.getGeometry().length>0){var g=this.layersPlugin.isInGeometry(e);if(!g){var a=e.getGeometry()[0].getCentroid();this.layersPlugin.getMapModule().moveMapToLanLot(new OpenLayers.LonLat(a.x,a.y))}}this.layersPlugin.getMapModule().notifyMoveEnd();this.layersPlugin._checkLayersVisibility(this.layersPlugin._visibilityCheckOrder)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapLayerVisibilityChangedEvent",function(a,b,c){this._mapLayer=a;this._inScale=(b==true);this._geomMatch=(c!=false)},{__name:"MapLayerVisibilityChangedEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},isInScale:function(){return this._inScale},isGeometryMatch:function(){return this._geomMatch}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.WmsLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={}},{__name:"WmsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("wmslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wmslayer",null)},init:function(a){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapLayerAddEvent:function(a){this.afterMapLayerAddEvent(a)},AfterMapLayerRemoveEvent:function(a){this.afterMapLayerRemoveEvent(a)},AfterChangeMapLayerOpacityEvent:function(a){this.afterChangeMapLayerOpacityEvent(a)},AfterChangeMapLayerStyleEvent:function(a){this.afterChangeMapLayerStyleEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(e){var b=this._sandbox;for(var d=0;d<e.length;d++){var c=e[d];var a=c.getId();if(!c.isLayerOfType("WMS")){continue}b.printDebug("preselecting "+a);this.addMapLayerToMap(c,true,c.isBaseLayer())}},afterMapLayerAddEvent:function(a){this.addMapLayerToMap(a.getMapLayer(),a.getKeepLayersOrder(),a.isBasemap())},addMapLayerToMap:function(h,f,a){if(!h.isLayerOfType("WMS")){return}this._sandbox.printDebug(" [SnappyWMSLayer]  Creating "+h.getId()+" KEEP ON TOP ? "+f+" BASE? "+a);var l=this._map.getLayersByName("Markers");if(l){for(var c=0;c<l.length;c++){if(l[c]){this._map.removeLayer(l[c],false)}}}if(h.isGroupLayer()||h.isBaseLayer()||a==true){if(h.getSubLayers().length>0){for(var e=0;e<h.getSubLayers().length;e++){var b="";for(var d=0;d<h.getSubLayers()[e].getWmsUrls().length;d++){b+=h.getSubLayers()[e].getWmsUrls()[d]}var k=this.getMapModule().calculateLayerScales(h.getSubLayers()[e].getMaxScale(),h.getSubLayers()[e].getMinScale());var g=Oskari.$("SnappyWMSLayer");var m=new g("basemap_"+h.getSubLayers()[e].getId(),h.getSubLayers()[e].getWmsUrls(),{layers:h.getSubLayers()[e].getWmsName(),transparent:true,id:h.getSubLayers()[e].getId(),styles:h.getSubLayers()[e].getCurrentStyle().getName(),format:"image/png"},{layerId:h.getSubLayers()[e].getWmsName(),scales:k,isBaseLayer:false,displayInLayerSwitcher:true,visibility:true,buffer:0});
m.opacity=h.getOpacity()/100;this.attachLoadingStatusToLayer(m,true,h);this._map.addLayer(m);this._sandbox.printDebug(" [SnappyWMSLayer]  Created SnappyGrid for WMS WITH SUBLAYERS for "+h.getId());if(!f){this._map.setLayerIndex(m,0)}}}else{var k=this.getMapModule().calculateLayerScales(h.getMaxScale(),h.getMinScale());var g=Oskari.$("SnappyWMSLayer");var m=new g("layer_"+h.getId(),h.getWmsUrls(),{layers:h.getWmsName(),transparent:true,id:h.getId(),styles:h.getCurrentStyle().getName(),format:"image/png"},{layerId:h.getWmsName(),scales:k,isBaseLayer:false,displayInLayerSwitcher:true,visibility:true,buffer:0});m.opacity=h.getOpacity()/100;this.attachLoadingStatusToLayer(m,true,h);this._map.addLayer(m);this._sandbox.printDebug(" [SnappyWMSLayer]  Created SnappyGrid for WMS WITH SUBLAYERS for "+h.getId());if(f){this._map.setLayerIndex(m,this._map.layers.length)}else{this._map.setLayerIndex(m,0)}}}else{var k=this.getMapModule().calculateLayerScales(h.getMaxScale(),h.getMinScale());var g=Oskari.$("SnappyWMSLayer");var m=new g("layer_"+h.getId(),h.getWmsUrls(),{layers:h.getWmsName(),transparent:true,id:h.getId(),styles:h.getCurrentStyle().getName(),format:"image/png"},{layerId:h.getWmsName(),scales:k,isBaseLayer:false,displayInLayerSwitcher:true,visibility:true,buffer:0});this.attachLoadingStatusToLayer(m,true,h);m.opacity=h.getOpacity()/100;this._map.addLayer(m);this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for "+h.getId());if(f){this._map.setLayerIndex(m,this._map.layers.length)}else{this._map.setLayerIndex(m,0)}}if(l){for(var c=0;c<l.length;c++){if(l[c]){this._map.addLayer(l[c])}}}},afterMapLayerRemoveEvent:function(b){var a=b.getMapLayer();this.removeMapLayerFromMap(a)},removeMapLayerFromMap:function(d){if(!d.isLayerOfType("WMS")){return}if(d.isBaseLayer()){var b="";if(d.getSubLayers().length>0){for(var c=0;c<d.getSubLayers().length;c++){var a=this._map.getLayersByName("basemap_"+d.getSubLayers()[c].getId());a[0].destroy()}}else{var a=this._map.getLayersByName("layer_"+d.getId());a[0].destroy()}}else{var a=this._map.getLayersByName("layer_"+d.getId());a[0].destroy()}},getOLMapLayers:function(c){if(!c.isLayerOfType("WMS")){return null}if(c.isBaseLayer()){var a="";if(c.getSubLayers().length>0){for(var b=0;b<c.getSubLayers().length;b++){return this._map.getLayersByName("basemap_"+c.getSubLayers()[b].getId())}}else{return this._map.getLayersByName("layer_"+c.getId())}}else{return this._map.getLayersByName("layer_"+c.getId())}return null},afterChangeMapLayerOpacityEvent:function(c){var b=c.getMapLayer();if(!b.isLayerOfType("WMS")){return}if(b.isBaseLayer()||b.isGroupLayer()){if(b.getSubLayers().length>0){for(var d=0;d<b.getSubLayers().length;d++){var a=this._map.getLayersByName("basemap_"+b.getSubLayers()[d].getId());a[0].setOpacity(b.getOpacity()/100)}}else{var a=this._map.getLayersByName("layer_"+b.getId());if(a[0]!=null){a[0].setOpacity(b.getOpacity()/100)}}}else{this._sandbox.printDebug("Setting Layer Opacity for "+b.getId()+" to "+b.getOpacity());var a=this._map.getLayersByName("layer_"+b.getId());if(a[0]!=null){a[0].setOpacity(b.getOpacity()/100)}}},afterChangeMapLayerStyleEvent:function(c){var b=c.getMapLayer();if(!b.isBaseLayer()){var a=this._map.getLayersByName("layer_"+b.getId());if(a!=null){a[0].mergeNewParams({styles:b.getCurrentStyle().getName()})}}},attachLoadingStatusToLayer:function(b,e,c){var a=this._sandbox;var d=this;var f=this.getMapModule().getLocalization("status_update_map")+" '"+c.getName()+"'...";b.events.register("loadstart",b,function(){a.request(d,a.getRequestBuilder("ActionStartRequest")(b.id,f,true))});b.events.register("loadend",b,function(){a.request(d,a.getRequestBuilder("ActionReadyRequest")(b.id,true))});b.events.register("loadcancel",b,function(){a.request(d,a.getRequestBuilder("ActionReadyRequest")(b.id,true))})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.$("SnappyGrid",OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(c,b,d,a){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);
this.events.addEventType("tileloaded");this.grid=[]},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var f=0,b=this.grid.length;f<b;f++){var e=this.grid[f];for(var c=0,a=e.length;c<a;c++){var d=e[c];this.removeTileMonitoringHooks(d);d.destroy()}}this.grid=[]}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},moveTo:function(d,a,e){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);d=d||this.map.getExtent();if(d!=null){var c=!this.grid.length||a;var b=this.getTilesBounds();if(this.singleTile){if(c||(!e&&!b.containsBounds(d))){this.initSingleTile(d)}}else{if(c||!b.containsBounds(d,true)){this.initGriddedTiles(d)}else{this.moveGriddedTiles(d)}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds()},getTilesBounds:function(){var e=null;if(this.grid.length){var a=this.grid.length-1;var d=this.grid[a][0];var b=this.grid[0].length-1;var c=this.grid[0][b];e=new OpenLayers.Bounds(d.bounds.left,d.bounds.bottom,c.bounds.right,c.bounds.top)}return e},initSingleTile:function(f){var a=f.getCenterLonLat();var h=f.getWidth()*this.ratio;var b=f.getHeight()*this.ratio;var g=new OpenLayers.Bounds(a.lon-(h/2),a.lat-(b/2),a.lon+(h/2),a.lat+(b/2));var d=new OpenLayers.LonLat(g.left,g.top);var c=this.map.getLayerPxFromLonLat(d);if(!this.grid.length){this.grid[0]=[]}var e=this.grid[0][0];if(!e){e=this.addTile(g,c);this.addTileMonitoringHooks(e);e.draw();this.grid[0][0]=e}else{e.moveTo(g,c)}this.removeExcessTiles(1,1)},calculateGridLayout:function(a,o,e){var k=e*this.tileSize.w;var c=e*this.tileSize.h;var i=a.left-o.left;var l=Math.floor(i/k)-this.buffer;var j=i/k-l;var f=-j*this.tileSize.w;var m=o.left+l*k;var b=a.top-(o.bottom+c);var h=Math.ceil(b/c)+this.buffer;var n=h-b/c;var d=-n*this.tileSize.h;var g=o.bottom+h*c;return{tilelon:k,tilelat:c,tileoffsetlon:m,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},initGriddedTiles:function(i){var g=this.map.getSize();var w=Math.ceil(g.h/this.tileSize.h)+Math.max(1,2*this.buffer);var A=Math.ceil(g.w/this.tileSize.w)+Math.max(1,2*this.buffer);var o=this.getMaxExtent();var s=this.map.getResolution();var r=this.calculateGridLayout(i,o,s);var f=Math.round(r.tileoffsetx);var c=Math.round(r.tileoffsety);var k=r.tileoffsetlon;var n=r.tileoffsetlat;var e=r.tilelon;var j=r.tilelat;this.origin=new OpenLayers.Pixel(f,c);var v=f;var z=k;var u=0;var a=parseInt(this.map.layerContainerDiv.style.left);var t=parseInt(this.map.layerContainerDiv.style.top);do{var h=this.grid[u++];if(!h){h=[];this.grid.push(h)}k=z;f=v;var d=0;do{var b=new OpenLayers.Bounds(k,n,k+e,n+j);var m=f;m-=a;var l=c;l-=t;var q=new OpenLayers.Pixel(m,l);var B=h[d++];if(!B){B=this.addTile(b,q);this.addTileMonitoringHooks(B);h.push(B)}else{B.moveTo(b,q,false)}k+=e;f+=this.tileSize.w}while((k<=i.right+e*this.buffer)||d<A);n-=j;c+=this.tileSize.h}while((n>=i.bottom-j*this.buffer)||u<w);this.removeExcessTiles(u,d);this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){var b=[];var h=["right","down","left","up"];var g=0;var a=-1;var k=OpenLayers.Util.indexOf(h,"right");var l=0;while(l<h.length){var j=g;var c=a;switch(h[k]){case"right":c++;break;case"down":j++;break;case"left":c--;break;case"up":j--;break}var f=null;if((j<this.grid.length)&&(j>=0)&&(c<this.grid[0].length)&&(c>=0)){f=this.grid[j][c]}if((f!=null)&&(!f.queued)){b.unshift(f);f.queued=true;l=0;g=j;a=c}else{k=(k+1)%4;l++}}for(var d=0,e=b.length;d<e;d++){var f=b[d];f.draw();f.queued=false}},addTile:function(b,a){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")
}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(c){var b=this.buffer||1;while(true){var a=this.grid[0][0].position;var d=this.map.getViewPortPxFromLayerPx(a);if(d.x>-this.tileSize.w*(b-1)){this.shiftColumn(true)}else{if(d.x<-this.tileSize.w*b){this.shiftColumn(false)}else{if(d.y>-this.tileSize.h*(b-1)){this.shiftRow(true)}else{if(d.y<-this.tileSize.h*b){this.shiftRow(false)}else{break}}}}}},shiftRow:function(n){var c=(n)?0:(this.grid.length-1);var b=this.grid;var f=b[c];var e=this.map.getResolution();var h=(n)?-this.tileSize.h:this.tileSize.h;var g=e*-h;var m=(n)?b.pop():b.shift();for(var j=0,l=f.length;j<l;j++){var d=f[j];var a=d.bounds.clone();var k=d.position.clone();a.bottom=a.bottom+g;a.top=a.top+g;k.y=k.y+h;m[j].moveTo(a,k)}if(n){b.unshift(m)}else{b.push(m)}},shiftColumn:function(m){var d=(m)?-this.tileSize.w:this.tileSize.w;var c=this.map.getResolution();var k=c*d;for(var e=0,g=this.grid.length;e<g;e++){var l=this.grid[e];var j=(m)?0:(l.length-1);var b=l[j];var a=b.bounds.clone();var f=b.position.clone();a.left=a.left+k;a.right=a.right+k;f.x=f.x+d;var h=m?this.grid[e].pop():this.grid[e].shift();h.moveTo(a,f);if(m){l.unshift(h)}else{l.push(h)}}},removeExcessTiles:function(e,c){while(this.grid.length>e){var f=this.grid.pop();for(var b=0,a=f.length;b<a;b++){var d=f[b];this.removeTileMonitoringHooks(d);d.destroy()}}while(this.grid[0].length>c){for(var b=0,a=this.grid.length;b<a;b++){var f=this.grid[b];var d=f.pop();this.removeTileMonitoringHooks(d);d.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(d){var c=this.maxExtent;var f=this.getResolution();var e=f*this.tileSize.w;var b=f*this.tileSize.h;var h=this.getLonLatFromViewPortPx(d);var a=c.left+(e*Math.floor((h.lon-c.left)/e));var g=c.bottom+(b*Math.floor((h.lat-c.bottom)/b));return new OpenLayers.Bounds(a,g,a+e,g+b)},CLASS_NAME:"OpenLayers.Layer.SnappyGrid"}));Oskari.$("SnappyWMSLayer",OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(d,c,e,b){var a=[];e=OpenLayers.Util.upperCaseObject(e);if(parseFloat(e.VERSION)>=1.3&&!e.EXCEPTIONS){e.EXCEPTIONS="INIMAGE"}a.push(d,c,e,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()])},getURL:function(c){c=this.adjustBounds(c);var d=this.getImageSize();var e={};var b=this.reverseAxisOrder();e.BBOX=this.encodeBBOX?c.toBBOX(null,b):c.toArray(b);e.WIDTH=d.w;e.HEIGHT=d.h;var a=this.getFullRequestString(e);return a},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(e,c){var b=this.map.getProjectionObject();var a=this.projection&&this.projection.equals(b)?this.projection.getCode():b.getCode();var d=(a=="none")?null:a;
if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=d}else{this.params.SRS=d}if(typeof this.params.TRANSPARENT=="boolean"){e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.SnappyWMS"}));Oskari.clazz.define("Oskari.mapframework.mapmodule.WfsLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={}},{__name:"WfsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},init:function(a){},register:function(){this.getMapModule().setLayerPlugin("wfslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wfslayer",null)},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapMoveEvent:function(b){var a=this._sandbox.getObjectCreator(b);this._sandbox.printDebug("[WfsLayerPlugin] got AfterMapMoveEvent from "+a);this.afterAfterMapMoveEvent(b)},AfterMapLayerAddEvent:function(a){this.afterMapLayerAddEvent(a)},AfterMapLayerRemoveEvent:function(a){this.afterMapLayerRemoveEvent(a)},AfterWfsGetFeaturesPngImageForMapEvent:function(a){this.afterWfsGetFeaturesPngImageForMapEvent(a)},AfterHighlightWFSFeatureRowEvent:function(a){this.handleAfterHighlightWFSFeatureRowEvent(a)},AfterChangeMapLayerOpacityEvent:function(a){this.afterChangeMapLayerOpacityEvent(a)},AfterDimMapLayerEvent:function(a){this.handleAfterDimMapLayerEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(e){var b=this._sandbox;for(var d=0;d<e.length;d++){var c=e[d];var a=c.getId();if(!c.isLayerOfType("WFS")){continue}b.printDebug("[WfsLayerPlugin] preselecting "+a);this.addMapLayerToMap(c,true,c.isBaseLayer())}},afterChangeMapLayerOpacityEvent:function(c){var b=c.getMapLayer();if(!b.isLayerOfType("WFS")){return}var d=this.getOLMapLayers(b);for(var a=0;a<d.length;a++){d[a].setOpacity(b.getOpacity()/100)}},handleAfterDimMapLayerEvent:function(d){var c=d.getMapLayer();if(c.isLayerOfType("WFS")){var a=new RegExp("wfs_layer_"+c.getId()+"_HIGHLIGHTED_FEATURE*","i");var e=this._map.getLayersByName(a);for(var b=0;b<e.length;b++){e[b].destroy()}}},afterMapLayerAddEvent:function(a){this.addMapLayerToMap(a.getMapLayer(),a.getKeepLayersOrder(),a.isBasemap())},addMapLayerToMap:function(b,c,a){},afterMapLayerRemoveEvent:function(b){var a=b.getMapLayer();this.removeMapLayerFromMap(a)},removeMapLayerFromMap:function(b){if(!b.isLayerOfType("WFS")){return}var c=this.getOLMapLayers(b);for(var a=0;a<c.length;a++){c[a].destroy()}},getOLMapLayers:function(c){if(c&&!c.isLayerOfType("WFS")){return}var b="";if(c){b="_"+c.getId()}var a=new RegExp("wfs_layer"+b+"_*","i");return this._map.getLayersByName(a)},afterWfsGetFeaturesPngImageForMapEvent:function(m){var q=m.getImageUrl();var r=m.getBbox();var t=m.getMapLayer();var k=null;if(r.bounds&&r.bounds.left&&r.bounds.right&&r.bounds.top&&r.bounds.bottom){k=new OpenLayers.Bounds(r.bounds.left,r.bounds.bottom,r.bounds.right,r.bounds.top)}else{if(r.left&&r.right&&r.top&&r.bottom){k=new OpenLayers.Bounds(r.left,r.bottom,r.right,r.top)}}if(!(q&&t&&k)){return}var s=this.mapModule.calculateLayerScales(t.getMaxScale(),t.getMinScale());var g=null;var c=this._map.getLayersByName(m.getRequestedLayerName());for(var n=0;n<c.length;n++){g=this._map.getLayerIndex(c[0]);c[0].destroy()}if(this._sandbox.isLayerAlreadySelected(t.getId())){var u=m.getRequestedLayerName();var l=new OpenLayers.Size(256,256);var a=new OpenLayers.Layer.Image(u,q,k,l,{scales:s,transparent:true,format:"image/png",isBaseLayer:false,displayInLayerSwitcher:true,visibility:true,buffer:0});this.mapModule.attachLoadingStatusToLayer(a,t);
a.opacity=t.getOpacity()/100;this._map.addLayer(a);a.setVisibility(true);a.redraw(true)}var h=Oskari.$().sandbox.findAllSelectedMapLayers();var f=this._map.layers.length;var b=this._map.getLayersByName("Markers");if(b.length>0){this._map.setLayerIndex(b[0],f);f--}if(g!==null&&a!==null){this._map.setLayerIndex(a,g)}var d=new RegExp("wfs_layer_"+t.getId()+"_WFS_LAYER_IMAGE*","i");var o=this._map.getLayersByName(d);if(o.length>0){var j=this._map.getLayerIndex(o[o.length-1]);var e=this._map.getLayersByName("wfs_layer_"+t.getId()+"_HIGHLIGHTED_FEATURE");if(e.length>0){this._map.setLayerIndex(e[0],j)}}},handleAfterHighlightWFSFeatureRowEvent:function(e){var b=e.getWfsFeatureIds();if(b.length==0){if(!this._sandbox.isCtrlKeyDown()){var d=e.getMapLayer();if(d.isLayerOfType("WFS")){var a=new RegExp("wfs_layer_"+d.getId()+"_HIGHLIGHTED_FEATURE*","i");var f=this._map.getLayersByName(a);for(var c=0;c<f.length;c++){f[c].destroy()}}}}},removeHighlightOnMapLayer:function(){var a=new RegExp("_HIGHLIGHTED_FEATURE*","i");var c=this._map.getLayersByName(a);for(var b=0;b<c.length;b++){c[b].destroy()}},updateWfsImages:function(b){var c=Oskari.$().sandbox.findAllSelectedMapLayers();for(var a=0;a<c.length;a++){if(c[a].isInScale()&&c[a].isLayerOfType("WFS")){this.doWfsLayerRelatedQueries(c[a])}}},doWfsLayerRelatedQueries:function(a){if(!a.isInScale()){return}var e=this._sandbox.getMap();var f=e.getBbox();var d=this._sandbox.getService("Oskari.mapframework.service.OgcSearchService");var b=e.getWidth();var c=e.getHeight();d.scheduleWFSMapLayerUpdate(a,f,b,c,this.getName());d.startPollers()},afterAfterMapMoveEvent:function(a){this.updateWfsImages(this.getName());this.removeHighlightOnMapLayer()}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.VectorLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:false,namedLayersAsArray:true})},{__name:"VectorLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("vectorlayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("vectorlayer",null)},init:function(a){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();this.registerVectorFormats();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapLayerAddEvent:function(a){this.afterMapLayerAddEvent(a)},AfterMapLayerRemoveEvent:function(a){this.afterMapLayerRemoveEvent(a)},FeaturesAvailableEvent:function(a){this.handleFeaturesAvailableEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(e){var b=this._sandbox;for(var d=0;d<e.length;d++){var c=e[d];var a=c.getId();if(!c.isLayerOfType("VECTOR")){continue}b.printDebug("preselecting "+a);this.addMapLayerToMap(c,true,c.isBaseLayer())}},afterMapLayerAddEvent:function(a){this.addMapLayerToMap(a.getMapLayer(),a.getKeepLayersOrder(),a.isBasemap())},registerVectorFormat:function(b,a){this._supportedFormats[b]=a},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({}));this.registerVectorFormat("application/nlsfi-x-openlayers-feature",new function(){this.read=function(a){return a}})},addMapLayerToMap:function(g,e,b){if(!g.isLayerOfType("VECTOR")){return}var h=this._map.getLayersByName("Markers");this._map.removeLayer(h[0],false);var j=new OpenLayers.StyleMap();var f={styleMap:j};var c=g.getStyledLayerDescriptor();if(c){this._sandbox.printDebug(c);var d=this._sldFormat.read(c);window.styleInfo=d;var k=d.namedLayers[0].userStyles;
var a=k[0];j.styles["default"]=a}var i=new OpenLayers.Layer.Vector("layer_"+g.getId(),f);i.opacity=g.getOpacity()/100;this._map.addLayer(i);this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+g.getId());if(e){this._map.setLayerIndex(i,this._map.layers.length)}else{this._map.setLayerIndex(i,0)}this._map.addLayer(h[0])},afterMapLayerRemoveEvent:function(b){var a=b.getMapLayer();this.removeMapLayerFromMap(a)},removeMapLayerFromMap:function(b){if(!b.isLayerOfType("VECTOR")){return}var a=this._map.getLayersByName("layer_"+b.getId());a[0].destroy()},getOLMapLayers:function(a){if(!a.isLayerOfType("VECTOR")){return}return this._map.getLayersByName("layer_"+a.getId())},handleFeaturesAvailableEvent:function(e){var b=e.getMapLayer();var g=e.getMimeType();var d=e.getFeatures();var h=e.getOp();var a=this._map.getLayersByName("layer_"+b.getId())[0];if(!a){return}if(h&&h=="replace"){a.removeFeatures(a.features)}var f=this._supportedFormats[g];if(!f){return}var c=f.read(d);a.addFeatures(c)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.request.ToolSelectionRequest",function(a){this._toolId=a;this._creator=null},{tools:{navigate:"map_control_navigate_tool",previous:"map_control_tool_prev",next:"map_control_tool_prev",select:"map_control_select_tool",zoom:"map_control_zoom_tool",draw_area:"map_control_draw_area_tool",measure:"map_control_measure_tool",measure_area:"map_control_measure_area_tool",info:"map_control_show_info_tool"},__name:"ToolSelectionRequest",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(a){this._toolId=a},getNamespace:function(){if(this._toolId.indexOf(".")==-1){return""}return this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){if(this._toolId.indexOf(".")==-1){return this._toolId}return this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.ToolSelectionHandler",function(a,b){this.sandbox=a;this.controlsPlugin=b},{__name:"ToolSelectionHandler",getName:function(){return this.__name},init:function(a){},handleRequest:function(a,f){var h=f.getToolId();var b=f.getNamespace();var d=f.getToolName();if(d!="map_control_zoom_tool"){this.controlsPlugin._zoomBoxTool.deactivate()}if(d!="map_control_measure_tool"){this.controlsPlugin._measureControls.line.deactivate()}if(d!="map_control_measure_area_tool"){this.controlsPlugin._measureControls.area.deactivate()}if(d=="map_control_tool_prev"){var i=this.sandbox.findRegisteredModuleInstance("StateHandler");if(i){i.historyMovePrevious()}}else{if(d=="map_control_tool_next"){var i=this.sandbox.findRegisteredModuleInstance("StateHandler");if(i){i.historyMoveNext()}}else{if(d=="map_control_select_tool"){var c=this.sandbox.findRegisteredModuleInstance("SketchLayerPlugin");if(c){c.clearBbox()}}else{if(d=="map_control_zoom_tool"){this.controlsPlugin._zoomBoxTool.activate()}else{if(d=="map_control_measure_tool"){this.controlsPlugin._measureControls.line.activate()}else{if(d=="map_control_measure_area_tool"){this.controlsPlugin._measureControls.area.activate()}}}}}}var g=this.sandbox.getEventBuilder("ToolSelectedEvent")(h);g.setOrigin(this.getName());this.sandbox.notifyAll(g)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.request.MapLayerUpdateRequest",function(a,b){this._layerId=a;this._forced=b},{__name:"MapModulePlugin.MapLayerUpdateRequest",getName:function(){return this.__name},getLayerId:function(){return this._layerId},isForced:function(){if(this._forced){return this._forced}return false}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.request.MapLayerUpdateRequestHandler",function(a,b){this.sandbox=a;this.mapModule=b},{handleRequest:function(b,g){var a=g.getLayerId();var f=g.isForced();var c=this.mapModule.getOLMapLayers(a);var e=0;if(c){e=c.length;
for(var d=0;d<c.length;++d){c[d].redraw(f)}}this.sandbox.printDebug("[MapLayerUpdateRequestHandler] update layer "+a+", found "+e)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.request.MapMoveRequestHandler",function(a,b){this.sandbox=a;this.mapModule=b},{handleRequest:function(b,d){var f=d.getCenterX();var g=d.getCenterY();var a=d.getMarker();var c=d.getZoom();var e=new OpenLayers.LonLat(f,g);this.mapModule.moveMapToLanLot(e);if(c||c===0){if(c.CLASS_NAME==="OpenLayers.Bounds"){this.mapModule._map.zoomToExtent(c)}else{this.mapModule._map.zoomTo(c)}}this.mapModule._updateDomain();if(a){this.mapModule._drawMarker()}this.mapModule.notifyMoveEnd();this.sandbox.printDebug("[MapMoveRequestHandler] map moved")}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.event.MapClickedEvent",function(c,b,a){this._lonlat=c;this._mouseX=b;this._mouseY=a},{__name:"MapClickedEvent",getName:function(){return this.__name},getLonLat:function(){return this._lonlat},getMouseX:function(){return this._mouseX},getMouseY:function(){return this._mouseY}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.event.EscPressedEvent",function(){},{__name:"EscPressedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.request.ClearHistoryRequest",function(){this._creator=null},{__name:"ClearHistoryRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.mapmodule-plugin.controls.ClearHistoryHandler",function(a,b){this.mapModule=b;this.sandbox=a},{__name:"ClearHistoryHandler",getName:function(){return this.__name},init:function(a){},handleRequest:function(a,b){this.mapModule.clearNavigationHistory()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",function(a){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.__templates={};this.__elements={};this.__parent=null;this._slider;this._zoombar_messages={};this._suppressEvents=false;this._conf=a},{__name:"Portti2Zoombar",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this._map=a.getMap();this.pluginName=a.getName()+this.__name},init:function(){var a=this;this.__templates.zoombar=jQuery('<div class="mapplugin pzbDiv" title="Koko Suomi"><div class="pzbDiv-plus"></div><input type=\'hidden\' /><div class="slider"></div><div class="pzbDiv-minus"></div></div>')},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}this.draw();this.setZoombarValue(this._map.getZoom())},draw:function(){var e=this;if(!e.__parent){e.__parent=this._map.div}if(!e.__elements.zoombarSlider){e.__elements.zoombarSlider=e.__templates.zoombar.clone()}var b="pzb-input-"+this.getName();var a="pzb-slider-"+this.getName();e.__elements.zoombarSlider.find("input").attr("id",b);e.__elements.zoombarSlider.find("div.slider").attr("id",a);jQuery(e.__parent).append(e.__elements.zoombarSlider);e._slider=new Slider({min:0,max:12,value:0,direction:"y"}).insertTo(a).assignTo(b);e._slider.level.hide();var d=e.getMapModule().getLocalization("zoombar_tooltip");e._slider.on("change",function(g){var h=d["zoomLvl-"+g.value];if(h){e.__elements.zoombarSlider.attr("title",h)}if(!this._suppressEvents){e.getMapModule().zoomTo(g.value)}});var f=e.__elements.zoombarSlider.find(".pzbDiv-plus");f.bind("click",function(g){if(e._slider.getValue()<12){e.getMapModule().zoomTo(e._slider.getValue()+1)}});var c=e.__elements.zoombarSlider.find(".pzbDiv-minus");c.bind("click",function(g){if(e._slider.getValue()>0){e.getMapModule().zoomTo(e._slider.getValue()-1)}});if(this._conf&&this._conf.location){if(this._conf.location.top){e.__elements.zoombarSlider.css("bottom","auto");
e.__elements.zoombarSlider.css("top",this._conf.location.top)}if(this._conf.location.left){e.__elements.zoombarSlider.css("right","auto");e.__elements.zoombarSlider.css("left",this._conf.location.left)}if(this._conf.location.right){e.__elements.zoombarSlider.css("left","auto");e.__elements.zoombarSlider.css("right",this._conf.location.right)}if(this._conf.location.bottom){e.__elements.zoombarSlider.css("top","auto");e.__elements.zoombarSlider.css("bottom",this._conf.location.bottom)}}},setZoombarValue:function(b){var a=this;if(a._slider){this._suppressEvents=true;a._slider.setValue(b);this._suppressEvents=false}},stopPlugin:function(a){if(this.__elements.zoombarSlider){this.__elements.zoombarSlider.remove();this._slider.remove()}a.unregister(this);this._sandbox=null},eventHandlers:{AfterMapMoveEvent:function(b){var a=this;a.setZoombarValue(b.getZoom())}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},start:function(a){},stop:function(a){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.__templates={};this.__elements={};this.__parent=null},{__name:"PanButtons",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this._map=a.getMap();this.pluginName=a.getName()+this.__name},init:function(){var a=this;this.__templates.pan=jQuery('<div class="panbuttonDiv"><div>  <img class="panbuttonDivImg" src="../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png" usemap="#panbuttons">    <map name="panbuttons">      <area shape="circle" class="panbuttons_center" coords="45,45,20" href="#">      <area shape="polygon" class="panbuttons_left" coords="13,20,25,30,20,45,27,65,13,70,5,45" href="#">      <area shape="polygon" class="panbuttons_up" coords="30,8,45,4,60,8,60,23,45,20,30,23" href="#">      <area shape="polygon" class="panbuttons_right" coords="79,20,67,30,72,45,65,65,79,70,87,45" href="#">      <area shape="polygon" class="panbuttons_down" coords="30,82,45,86,60,82,60,68,45,70,30,68" href="#">    </map>  </img></div></div>')},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}this.draw()},draw:function(){var e=this;if(!e.__parent){e.__parent=this._map.div}if(!e.__elements.panbuttons){e.__elements.panbuttons=e.__templates.pan.clone()}jQuery(e.__parent).append(e.__elements.panbuttons);var c=e.__elements.panbuttons.find(".panbuttonDivImg");var a=e.__elements.panbuttons.find(".panbuttons_center");a.bind("mouseover",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/root.png")});a.bind("mouseout",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png")});a.bind("click",function(h){var i=e.getMapModule().getSandbox().getRequestBuilder("StateHandler.SetStateRequest");if(i){e.getMapModule().getSandbox().request(e,i())}});var g=e.__elements.panbuttons.find(".panbuttons_left");g.bind("mouseover",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/left.png")});g.bind("mouseout",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png")});g.bind("click",function(h){e.getMapModule().panMapByPixels(-100,0,false,true)});var d=e.__elements.panbuttons.find(".panbuttons_right");d.bind("mouseover",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/right.png")});d.bind("mouseout",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png")});d.bind("click",function(h){e.getMapModule().panMapByPixels(100,0,false,true)});var f=e.__elements.panbuttons.find(".panbuttons_up");
f.bind("mouseover",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/up.png")});f.bind("mouseout",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png")});f.bind("click",function(h){e.getMapModule().panMapByPixels(0,-100,false,true)});var b=e.__elements.panbuttons.find(".panbuttons_down");b.bind("mouseover",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/down.png")});b.bind("mouseout",function(h){c.attr("src","../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/default.png")});b.bind("click",function(h){e.getMapModule().panMapByPixels(0,100,false,true)})},stopPlugin:function(a){a.unregister(this);this._map=null;this._sandbox=null},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},start:function(a){},stop:function(a){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.PluginMapModuleBundleInstance",function(a){this.name="mapmodule";this.mediator=null;this.sandbox=null;this.conf=null;this.impl=null;this.facade=null;this.ui=null},{start:function(){if(this.mediator.getState()=="started"){return}this.libs={ext:Oskari.$("Ext")};var o=Oskari.$("UI.facade");this.facade=o;var m=o.getSandbox();this.sandbox=m;var j=Oskari.$("startup");this.conf=j;var n=j.mapConfigurations.index_map;var l=j.mapConfigurations.zoom_bar;var b=j.mapConfigurations.scala_bar;var d=j.mapConfigurations.pan;var k=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",n,l,b,d);this.impl=k;var f=this.createMapPanel();this._panel=f;var a=this.facade.appendExtensionModule(this.impl,this.name,{},this,"Center",{fi:{title:""},sv:{title:"?"},en:{title:""}},f);this.def=a;var e=[];e.push("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin");e.push("Oskari.mapframework.mapmodule.WmsLayerPlugin");e.push("Oskari.mapframework.mapmodule.MarkersPlugin");e.push("Oskari.mapframework.mapmodule.VectorLayerPlugin");e.push("Oskari.mapframework.mapmodule.TilesGridPlugin");e.push("Oskari.mapframework.mapmodule.ControlsPlugin");e.push("Oskari.mapframework.mapmodule.WfsLayerPlugin");e.push("Oskari.mapframework.mapmodule.GetInfoPlugin");for(var g=0;g<e.length;g++){var h=Oskari.clazz.create(e[g]);k.registerPlugin(h)}var c=this.createMapContainer(this.impl.getMap());this._mapster=c;f.add(c);o.registerPart("Mapster",this._mapster);this.impl.start(m);this.mediator.setState("started");return this},createMapPanel:function(){var a=this.libs.ext;var b=a.create("Ext.Panel",{region:"center",layout:"fit",items:[]});return b},createMapContainer:function(b){var a=this.libs.ext;var c=a.createWidget("nlsfimappanel",{olmap:b,layout:"absolute"});return c},update:function(d,a,c,e){d.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+e)},stop:function(){this.impl.stop();this.facade.removeExtensionModule(this.impl,this.name,this.impl.eventHandlers,this,this.def);this.def=null;this.mediator.setState("stopped");return this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.PluginMapModuleBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.request.common.RearrangeSelectedMapLayerRequest",function(a,b){this._creator=null;this._mapLayerId=a;this._toPosition=b},{__name:"RearrangeSelectedMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerOpacityRequest",function(b,a){this._creator=null;this._mapLayerId=b;this._opacity=a},{__name:"ChangeMapLayerOpacityRequest",getName:function(){return this.__name},getOpacity:function(){return this._opacity},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerStyleRequest",function(a,b){this._creator=null;this._mapLayerId=a;this._style=b},{__name:"ChangeMapLayerStyleRequest",getName:function(){return this.__name},getStyle:function(){return this._style},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.HighlightMapLayerRequest",function(a){this._creator=null;this._mapLayerId=a},{__name:"HighlightMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.DimMapLayerRequest",function(a){this._creator=null;this._mapLayerId=a},{__name:"DimMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.$("mapframework",{});Oskari.$().mapframework.runtime={};Oskari.$().mapframework.runtime.findSandbox=function(){return Oskari.$().mapframework.runtime.components.sandbox};Oskari.$().mapframework.runtime.findComponent=function(a){return Oskari.$().mapframework.runtime.components[a]};Oskari.$().mapframework.runtime.isComponentPresent=function(a){if(Oskari.$().mapframework.runtime.components!=null&&Oskari.$().mapframework.runtime.components[a]!=null){return true}else{return false}};/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.event.common.AfterRearrangeSelectedMapLayerEvent",function(b,a,c){this._creator=null;this._movedMapLayer=b;this._fromPosition=a;this._toPosition=c},{__name:"AfterRearrangeSelectedMapLayerEvent",getName:function(){return this.__name},getMovedMapLayer:function(){return this._movedMapLayer},getFromPosition:function(){return this._fromPosition},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerOpacityEvent",function(a){this._creator=null;this._mapLayer=a},{__name:"AfterChangeMapLayerOpacityEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerStyleEvent",function(a){this._creator=null;this._mapLayer=a},{__name:"AfterChangeMapLayerStyleEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterHighlightMapLayerEvent",function(a){this._creator=null;this._mapLayer=a},{__name:"AfterHighlightMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterDimMapLayerEvent",function(a){this._creator=null;this._mapLayer=a},{__name:"AfterDimMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.enhancement.common.DisableDevelopmentModeEnhancement",function(a){this._enableMapMovementLogging=a},{enhance:function(a){a.disableDebug();if(this._enableMapMovementLogging){a.enableMapMovementLogging()}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});Oskari.clazz.define("Oskari.mapframework.enhancement.common.SetDefaultMapControlActiveEnhancement",function(a){this._controlId=a},{enhance:function(c){c.printDebug("[SetDefaultMapControlActiveEnhancement] Requesting '"+this._controlId+"' ");var a=c.getRequestBuilder("ToolSelectionRequest");var d=a(this._controlId);c.processRequest(d)},setControl:function(a){this._controlId=a},CONTROL_NAME_NAVIGATE:"map_control_select_tool"},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});Oskari.clazz.define("Oskari.mapframework.enhancement.common.OpenLayersImagePathEnhancement",function(){},{getName:function(){return"OpenLayersImagePathEnhancement"},enhance:function(a){OpenLayers.ImgPath=Oskari.$().startup.imageLocation+"/lib/openlayers/img/"}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.service.Service",function(){throw"mapframework.service.Service should not be used"},{getName:function(){throw"Running default implementation of Service.getName(). implement your own!"}});Oskari.clazz.define("Oskari.mapframework.service.LanguageService",function(a){this.currentLanguage=Oskari.getLang()},{__qname:"Oskari.mapframework.service.LanguageService",getQName:function(){return this.__qname},__name:"LanguageService",getName:function(){return this.__name},languageProperties:{fi:{launcher_failed_to_initialize_map_messagebox_title:"Kartan alustaminen ep\u00E4onnistui",launcher_failed_to_initialize_map_messagebox_message:"Linkki, jolla yritit alustaa kartan on virheellinen. Tarkista, ett\u00E4 linkki on luotu karttaikkunan linkkity\u00F6kalulla ja ett\u00E4 linkin osoite on kopioitu kokonaisuudessaan selaimen osoitteeksi. Jos toistuvista yrityksist\u00E4 huolimatta linkki ei toimi, ole hyv\u00E4 ja ota yhteytt\u00E4 palvelun yll\u00E4pitoon.",mapapplication_show_or_hide_menu_bar:"Piilota/N\u00E4yt\u00E4 valikko",mapapplication_show_or_hide_table_bar:"Piilota/N\u00E4yt\u00E4 taulukko",mapapplication_hide_menu_bar:"Piilota valikko",search_cannot_be_empty:"Sy\u00F6t\u00E4 hakukentt\u00E4\u00E4n hakusana",search_failure_messagebox_title:"Hakuvirhe",search_failure_messagebox_message:"Haku ei nyt onnistunut. Kokeile hakua my\u00F6hemmin uudelleen.",search_published_map_no_results:"Haulla ei l\u00F6ytynyt tuloksia",search_published_map_too_many_results:"L\u00F6ytyi yli 100 tulosta, tarkenna hakua.",leftpanel_maplevels_title:"KARTTATASOT",leftpanel_organisation_title:"Organisaatio",leftpanel_thema_title:"Teema",leftpanel_own_maps_title:"Omat kartat",leftpanel_selected_layers_title:"Valitut karttatasot",leftpanel_new_window_title:"Uusi ikkuna",leftpanel_empty_own_maps_content:"Ei omia karttoja",leftpanel_find_maplayers_value:"Hae karttatasoja",leftpanel_tree_menu_tooltip:"Valitse karttatasojen lajittelutapa",leftpanel_filter_button_tooltip:"Palaa alkuper\u00E4iseen karttatasolistaukseen",leftpanel_add_layer:"Lis\u00E4\u00E4 karttataso kartalle",leftpanel_style:"Tyyli:",rightpanel_search_find_places_textbox_value:"Hae paikkoja/osoitteita",rightpanel_search_find_places_button_value:"Hae","rightpanel-searchresults-close_button_value":"Sulje hakutulokset",rightpanel_wms_getfeatureinfo_button_value:"Sulje",rightpanel_material_description_title:"Aineistokuvaus",rightpanel_material_schema_title:"Tietotuotteen skeema",rightpanel_material_legend_title:"Selite",rightpanel_wms_getfeatureinfo_title:"Kohteen tiedot",rightpanel_map_layer_have_not_description:"Kartan selitett\u00E4 ei l\u00F6ytynyt",rightpanel_map_layer_have_not_schema:"Tietotuotteen skeemaa ei l\u00F6ydy.",rightpanel_info_panel_close_button_title:"Sulje info",rightpanel_wms_getfeatureinfo_not_supported_txt:"Ominaisuustietojen kysely ei ole tuettu valitsemallesi kartalle",mapservice_basemap_show_info_title:"N\u00E4yt\u00E4 taustakartan tiedot",mapservice_basemap_delete_title:"Poista taustakartta kartalta",mapservice_layer_show_info_title:"N\u00E4yt\u00E4 karttatason tiedot",mapservice_layer_delete_title:"Poista karttataso kartalta",mapservice_layer_is_not_visible_in_this_scale_zoomin_map_title:"Karttataso ei ole k\u00E4ytett\u00E4viss\u00E4 t\u00E4ss\u00E4 mittakaavassa. L\u00E4henn\u00E4 (+) karttaa.",mapservice_layer_is_not_visible_in_this_scale_zoomout_map_title:"Karttataso ei ole k\u00E4ytett\u00E4viss\u00E4 t\u00E4ss\u00E4 mittakaavassa. Loitonna (-) karttaa.",mapservice_not_found_legend_image:"Ei l\u00F6ytynyt kartan selitteit\u00E4",mapservice_change_layer_opacity_tooltip:"S\u00E4\u00E4d\u00E4 karttatason l\u00E4pin\u00E4kyvyytt\u00E4",mapservice_basemap_image_tooltip:"Taustakartta",mapservice_maplayer_image_tooltip:"Karttataso",mapservice_published_error_params:"Virhe irrotetun kartan parametreissa, ole hyv\u00E4 ja ota yhteytt\u00E4 t\u00E4m\u00E4n sivuston yll\u00E4pit\u00E4j\u00E4\u00E4n.",mapservice_select_layer_style:"Valitse tyyli",map_control_tool_prev_tooltip:"Palaa navigointihistoriassa taaksep\u00E4in",map_control_tool_next_tooltip:"Siirry navigointihistoriassa eteenp\u00E4in",map_control_navigate_tool_tooltip:"Raahaa karttaa pit\u00E4en hiiren vasenta painiketta pohjassa tai l\u00E4henn\u00E4 tuplaklikkaamalla",map_control_zoom_tool_tooltip:"L\u00E4henn\u00E4 haluamallesi alueelle rajaamalla alue pit\u00E4en hiiren vasenta painiketta pohjassa",map_control_measure_menu_tooltip:"Valitse mittausty\u00F6kalu",map_control_measure_tool_tooltip:"Mittaa et\u00E4isyytt\u00E4",map_control_measure_area_tool_tooltip:"Mittaa pinta-alaa",mapcontrolsservice_info_group_title:"Valitse ty\u00F6kalu tietojen n\u00E4ytt\u00E4miseksi",mapcontrolsservice_show_info_tool_title:"N\u00E4yt\u00E4 kohteen tiedot",mapcontrolsservice_show_coordinates_tool_title:"N\u00E4yt\u00E4 koordinaatit",mapcontrolsservice_add_group_title:"Valitse merkint\u00E4ty\u00F6kalu",mapcontrolsservice_add_point_tool_title:"Lis\u00E4\u00E4 piste",mapcontrolsservice_add_line_tool_title:"Lis\u00E4\u00E4 reitti",mapcontrolsservice_add_area_tool_title:"Lis\u00E4\u00E4 alue",map_control_map_link_tool_tooltip:"Luo linkki kartalle",mapcontrolsservice_save_and_print_group_title:"Valitse Tallenna- tai Tulosta-ty\u00F6kalu",mapcontrolsservice_save_tool_title:"Tallenna",map_control_print_tool_tooltip:"Tulosta",mapcontrolsservice_mappublisher_tool_title:"Siirry kartan julkaisuun",mapcontrolsservice_zoomlevel_street_title:"Katu",mapcontrolsservice_zoomlevel_part_of_a_town_title:"Kunnan osa",mapcontrolsservice_zoomlevel_town_title:"Kunta",mapcontrolsservice_zoomlevel_province_title:"Maakunta",mapcontrolsservice_zoomlevel_country_title:"Koko maa",map_control_full_screen_tool_tooltip:"Suurenna/pienenn\u00E4 kartta koko n\u00E4yt\u00F6lle",mapcontrolsservice_measure_length_title:"Et\u00E4isyys",mapcontrolsservice_measure_area_title:"Pinta-ala",mapcontrolsservice_layer_info_layer_not_selected_messagebox_title:"Karttatasoa ei ole valittu",mapcontrolsservice_layer_info_layer_not_selected_messagebox_message:'Valitse haluamasi karttataso "Valitut karttatasot" -valikosta klikkaamalla karttatason nime\u00E4.',mapcontrolsservice_not_found_wms_feature_info:"Kohteelle ei l\u00F6ytynyt tietoa",mapcontrolsservice_maplink_tool_title:"Tee linkki n\u00E4kyviss\u00E4 olevaan karttaan",mapcontrolsservice_getting_WMS_info_title:"Haetaan kohteen tietoja...",mapcontrolsservice_indexmap_title:"N\u00E4yt\u00E4/piilota l\u00E4hestymiskartta",mapcontrolsservice_start_network_service_tool_title:"Avaa yll\u00E4pitopalvelu",mapcontrolsservice_problem_with_safari_printing_title:"Tulostus ei onnistu",mapcontrolsservice_problem_with_safari_printing_message:"Paikkatietoikkuna ei tue l\u00E4pin\u00E4kyvien karttojen tulostamista Safari-selaimella. L\u00E4pin\u00E4kyvien karttojen tulostus on tuettu Internet Explorer-, Firefox-, Opera-, ja Chrome-selaimilla. Voit s\u00E4\u00E4t\u00E4\u00E4 kaikkien karttojen l\u00E4pin\u00E4kyvyyden arvoon 100% ja tulostaa uudelleen tai vaihtoehtoisesti luoda linkin nykyiseen n\u00E4kym\u00E4\u00E4n ja avata sen tulostusl\u00E4pin\u00E4kyvyytt\u00E4 tukevalla selaimella.",searchservice_search_cannot_be_empty:"Sy\u00F6t\u00E4 hakukentt\u00E4\u00E4n hakusana.",searchservice_search_alert_title:"Haku",searchservice_search_not_found_anything_text:"Antamallasi hakusanalla ei l\u00F6ytynyt tuloksia. Tarkista, ett\u00E4 kirjoitit hakusanan varmasti oikein.",searchservice_search_result_column_name:"Nimi",searchservice_search_result_column_village:"Kunta",searchservice_search_result_column_type:"Tyyppi",searchservice_searching_title:"Etsit\u00E4\u00E4n...",maplinkservice_link_generated_messagebox_title:"Suora karttalinkki",maplinkservice_link_generated_messagebox_message:'T\u00E4ll\u00E4 linkill\u00E4 p\u00E4\u00E4set palaamaan suoraan luomaasi n\u00E4kym\u00E4\u00E4n. Linkkiin on tallennettu sijainti, mittakaava, valitut karttatasot, niiden l\u00E4pin\u00E4kyvyysasetukset sek\u00E4 valitut tyylit.<br/><br/><textarea id="mapLinkTextarea" rows="2" cols="100">##0##</textarea>',maplinkservice_link_generation_failed_messagebox_title:"Linkin muodostaminen ep\u00E4onnistui",maplinkservice_link_generation_failed_messagebox_message:"Linkin muodostamisessa tapahtui virhe. Kokeile sen muodostamista uudelleen hetken kuluttua. Jos ongelma ei korjaannu, ole hyv\u00E4 ja ota yhteytt\u00E4 yll\u00E4pitoon.",published_map_search_textbox_value:"Hae paikkoja/osoitteita",published_map_search_button_value:"Hae",published_map_is_empty:"<p>Julkaisemassasi kartassa ei ole viel\u00E4 valittuna yht\u00E4\u00E4n taustakarttaa tai karttaa.</p><p>Aloita valitsemalla vasemmalta kartta.</p>",published_map_exceeded_limit:"Sallittu palvelupyynt√∂jen m\u00E4\u00E4r\u00E4 on ylittynyt. Voit kuitenkin avata",published_map_exceeded_limit_link_text:"kartan Paikkatietoikkunassa",published_map_terms_of_use:"K\u00E4ytt\u00F6ehdot",map_move_and_draw_module_select_searc_area_title:"Rajaa hakualue",wizard_module_confirm_close_button_value:"Sulje",wizard_module_confirm_cancel_button_value:"Peruuta",wizard_service_module_confirm_message_title:"Suljetaanko m\u00E4\u00E4rittely?",wizard_service_module_confirm_message:"<br>Olet sulkemassa m\u00E4\u00E4rittely\u00E4 tallentamatta tekemi\u00E4si muutoksia.<br>Haluatko sulkea m\u00E4\u00E4rittelyn?<br><br>",wizard_module_previous_button_value:"Edellinen",wizard_module_next_button_value:"Seuraava",wizard_module_progressbar_start_value:"Vaiheen",wizard_module_progressbar_end_value:"m\u00E4\u00E4ritys",wizard_module_save_button_value:"Tallenna",status_wfs_update_grid:"P\u00E4ivitet\u00E4\u00E4n taulukkoa...",status_update_map:"P\u00E4ivitet\u00E4\u00E4n karttaa",status_search:"Suoritetaan hakua...",status_get_feature_info:"Haetaan ominaisuustietoja...",status_multiple_tasks_running:"teht\u00E4v\u00E4\u00E4 jonossa",status_tooltip_header:"Tila",search_module_popup_layer_is_wfs_title:"Valittu karttataso on tietotuote",selected_layers_module_highlight_wms_layer:"Aktivoi kohdetietojen n\u00E4ytt\u00F6",selected_layers_module_highlight_wfs_layer:"Avaa kohdetietotaulukko",selected_layers_module_dim_wms_layer:"Lopeta kohdetietojen n\u00E4ytt\u00F6",selected_layers_module_dim_wfs_layer:"Sulje kohdetietotaulukko",selected_layers_module_wfs_icon_tooltip:"Tietotuote",selected_layers_module_collapse_panel_tooltip:"Piilota l\u00E4pin\u00E4kyvyyden ja tyylin s\u00E4\u00E4t\u00F6",selected_layers_module_expand_panel_tooltip:"N\u00E4yt\u00E4 l\u00E4pin\u00E4kyvyyden ja tyylin s\u00E4\u00E4t\u00F6",grid_module_not_found_info_for_selected_area:"Kartan alueelta ei l\u00F6ydy tietoja.",grid_module_loading_info:"Ladataan...",grid_module_wfs_maplayer_not_visible_this_scale:"Tietotuote ei ole k\u00E4ytett\u00E4viss\u00E4 t\u00E4ss\u00E4 mittakaavassa. L\u00E4henn\u00E4 (+) tai loitonna (-) karttaa.",grid_module_gridpanel_title:"{0} -tietotuotteen kohdetyypit",grid_module_gridpanel_no_title:"Ei tietotuotetta",grid_module_feature_type_title:"Kohdetyyppi",grid_module_all_tab_title:"Kaikki",grid_module_featuretype_tab_tooltip:"Kohdetyypin tiedot",grid_module_all_tab_tooltip:"Kaikkien tietotuotteen kohdetyyppien tiedot",grid_module_column_header_tooltip:"Lajittele ominaisuustiedon arvon perusteella",overlay_popup_module_close_button_text:"Sulje",selected_layers_module_published_basemaps_title:"Julkaistavat taustakartat",selected_layers_module_published_maps_title:"Julkaistavat kartat"},en:{launcher_failed_to_initialize_map_messagebox_title:"Initialization of the map failed",launcher_failed_to_initialize_map_messagebox_message:"The link used for initializing the map is incorrect. Make sure that the link is created using the map window's link tool and that the whole link address is copied as the browser address. If the link cannot be opened despite of several.",mapapplication_show_or_hide_menu_bar:"Show/hide menu",mapapplication_show_or_hide_table_bar:"Hide/Show table",mapapplication_hide_menu_bar:"Hide menu",search_cannot_be_empty:"Search cannot be empty.",search_failure_messagebox_title:"Search error",search_failure_messagebox_message:"Unable to search at this time. Please try again later.",search_published_map_no_results:"No results found",search_published_map_too_many_results:"Over 100 results found. Please define your search.",leftpanel_maplevels_title:"MAP LAYERS",leftpanel_organisation_title:"Organisation",leftpanel_thema_title:"Theme",leftpanel_own_maps_title:"My maps",leftpanel_selected_layers_title:"Selected map layers",leftpanel_new_window_title:"New window",leftpanel_empty_own_maps_content:"My maps is empty",leftpanel_find_maplayers_value:"Find map layers",leftpanel_tree_menu_tooltip:"Sort map layers by",leftpanel_filter_button_tooltip:"Return to default map layer listing",leftpanel_add_layer:"Add maplayer",leftpanel_style:"Style:",rightpanel_search_find_places_textbox_value:"Find places",rightpanel_search_find_places_button_value:"Find","rightpanel-searchresults-close_button_value":"Close search results",rightpanel_wms_getfeatureinfo_button_value:"Close",rightpanel_material_description_title:"Map layer description",rightpanel_material_schema_title:"Data product schema",rightpanel_material_legend_title:"Legend",rightpanel_wms_getfeatureinfo_title:"Feature information",rightpanel_map_layer_have_not_description:"Map legend not found.",rightpanel_map_layer_have_not_schema:"Data product schema is not available.",rightpanel_info_panel_close_button_title:"Close info",rightpanel_wms_getfeatureinfo_not_supported_txt:"Enquiry of feature information is not supported on selected map layer ",mapservice_basemap_show_info_title:"Show background map info",mapservice_basemap_delete_title:"Delete background map",mapservice_layer_show_info_title:"Show map layer info",mapservice_layer_delete_title:"Delete map layer",mapservice_layer_is_not_visible_in_this_scale_zoomin_map_title:"Map layer is not visible in current map scale. Zoom in (+) the map.",mapservice_layer_is_not_visible_in_this_scale_zoomout_map_title:"Map layer is not visible in current map scale. Zoom out (-) the map.",mapservice_not_found_legend_image:"Map legends not found",mapservice_change_layer_opacity_tooltip:"Adjust transparency of map layer",mapservice_basemap_image_tooltip:"Background map",mapservice_maplayer_image_tooltip:"Map layer",mapservice_published_error_params:"Error in the parametres of the published map. Please contact the website support.",mapservice_select_layer_style:"Choose style",map_control_tool_prev_tooltip:"Go to previous view",map_control_tool_next_tooltip:"Go to next view in on navigation history",map_control_navigate_tool_tooltip:"Navigate",map_control_zoom_tool_tooltip:"Zoom In",map_control_measure_menu_tooltip:"Select measure tool",map_control_measure_tool_tooltip:"Measure length",map_control_measure_area_tool_tooltip:"Measure area",mapcontrolsservice_info_group_title:"Select info tool",mapcontrolsservice_show_info_tool_title:"Show info",mapcontrolsservice_show_coordinates_tool_title:"Show coordinates",mapcontrolsservice_add_group_title:"Select add tool",mapcontrolsservice_add_point_tool_title:"Add point",mapcontrolsservice_add_line_tool_title:"Add route",mapcontrolsservice_add_area_tool_title:"Add area",map_control_map_link_tool_tooltip:"Establish a link to the map",mapcontrolsservice_save_and_print_group_title:"Select save or print tool",mapcontrolsservice_save_tool_title:"Save",map_control_print_tool_tooltip:"Print",mapcontrolsservice_mappublisher_tool_title:"Start map publisher",mapcontrolsservice_zoomlevel_street_title:"Street",mapcontrolsservice_zoomlevel_part_of_a_town_title:"Part of town",mapcontrolsservice_zoomlevel_town_title:"Town",mapcontrolsservice_zoomlevel_province_title:"Province",mapcontrolsservice_zoomlevel_country_title:"Country",map_control_full_screen_tool_tooltip:"Maximize/minimize map",mapcontrolsservice_measure_length_title:"Distance",mapcontrolsservice_measure_area_title:"Area",mapcontrolsservice_layer_info_layer_not_selected_messagebox_title:"No map layer selected",mapcontrolsservice_layer_info_layer_not_selected_messagebox_message:"Choose one map layer among those added to the map by clicking it.",mapcontrolsservice_not_found_wms_feature_info:"No info found",mapcontrolsservice_maplink_tool_title:"Establish a link to the visible map",mapcontrolsservice_getting_WMS_info_title:"Searching feature information...",mapcontrolsservice_indexmap_title:"Show/hide index map",mapcontrolsservice_start_network_service_tool_title:"Open maintenance service",mapcontrolsservice_problem_with_safari_printing_title:"Problem with printing",mapcontrolsservice_problem_with_safari_printing_message:"Paikkatietoikkuna doesn't support the printing of transparent maps on web browser Safari. Printing transparent maps is supported on the following browsers: Internet Explorer, Firefox, Opera and Chrome. You can adjust the transparency value in all maps up to 100% and reprint or alternatively create a new link in the current view and open the link with a browser that enables the printing of transparent maps.",searchservice_search_cannot_be_empty:"Search cannot be empty.",searchservice_search_alert_title:"Search",searchservice_search_not_found_anything_text:"Your search did not provide any results. Please check your spelling.",searchservice_search_result_column_name:"Name",searchservice_search_result_column_village:"Municipality",searchservice_search_result_column_type:"Type",searchservice_searching_title:"Searching...",maplinkservice_link_generated_messagebox_title:"Direct map link",maplinkservice_link_generated_messagebox_message:'Use this link to return directly to the view created. Location, scale, selected map layers, their transparency settings and selected styles are stored in the link.<br/><br/><textarea id="mapLinkTextarea" rows="2" cols="100">##0##</textarea>',maplinkservice_link_generation_failed_messagebox_title:"The link could not be established",maplinkservice_link_generation_failed_messagebox_message:"An error occurred when establishing the link. Try again. If the problem cannot be solved, please contact the service support.",published_map_search_textbox_value:"Find places",published_map_search_button_value:"Find",published_map_is_empty:"<p>No maps or background maps are selected for the published map.</p><p>Start by selecting a map on the left.</p>",published_map_exceeded_limit:"You have exceeded the allowed amount of service requests. It is still possible to open",published_map_exceeded_limit_link_text:"the map at Paikkatietoikkuna",published_map_terms_of_use:"Terms of Use",map_move_and_draw_module_select_searc_area_title:"Define search area",wizard_module_confirm_close_button_value:"Close",wizard_module_confirm_cancel_button_value:"Cancel",wizard_service_module_confirm_message_title:"Close the definition?",wizard_service_module_confirm_message:"<br>You are about to close the definition without saving your changes.<br>Do you want to close the definition?<br><br>",wizard_module_previous_button_value:"Previous",wizard_module_next_button_value:"Next",wizard_module_progressbar_start_value:"Phase",wizard_module_progressbar_end_value:"definition",wizard_module_save_button_value:"Save",status_wfs_update_grid:"Updating table...",status_update_map:"Updating map",status_search:"Searching...",status_get_feature_info:"Searching feature attributes...",status_multiple_tasks_running:"tasks in queue",status_tooltip_header:"Mode",search_module_popup_layer_is_wfs_title:"Selected map layer is data product",selected_layers_module_highlight_wms_layer:"Activate to view feature information",selected_layers_module_highlight_wfs_layer:"Open attribute table",selected_layers_module_dim_wms_layer:"Stop viewing feature information",selected_layers_module_dim_wfs_layer:"Close feature attribute table",selected_layers_module_wfs_icon_tooltip:"Data product",selected_layers_module_collapse_panel_tooltip:"Hide transparency and style adjustment",selected_layers_module_expand_panel_tooltip:"Show transparency and style adjustment",grid_module_not_found_info_for_selected_area:"No information found on the map area.",grid_module_loading_info:"Loading...",grid_module_wfs_maplayer_not_visible_this_scale:"Data product is not available in this scale. Zoom in (+) or zoom out (-) the map.",grid_module_gridpanel_title:"Feature types for data product {0}",grid_module_gridpanel_no_title:"No data product",grid_module_feature_type_title:"Feature type",grid_module_all_tab_title:"All",grid_module_featuretype_tab_tooltip:"Feature type information",grid_module_all_tab_tooltip:"Information about all feature types of data product",grid_module_column_header_tooltip:"Sort according to attribute value",overlay_popup_module_close_button_text:"Close",selected_layers_module_published_basemaps_title:"Julkaistavat taustakartat",selected_layers_module_published_maps_title:"Julkaistavat kartat"},sv:{launcher_failed_to_initialize_map_messagebox_title:"Initieringen av kartan misslyckades",launcher_failed_to_initialize_map_messagebox_message:"L\u00E4nken du anv\u00E4nde f\u00F6r att initiera kartan \u00E4r felaktig. Kontrollera att l\u00E4nken har bildats med l\u00E4nkverktyget i kartf\u00F6nstret och att l\u00E4nkens adress \u00E4r kopierad i sin helhet som",mapapplication_show_or_hide_menu_bar:"D\u00F6lj/Visa menyn",mapapplication_show_or_hide_table_bar:"D\u00F6lj/Visa tabellen",mapapplication_hide_menu_bar:"D\u00F6lj menyn",search_cannot_be_empty:"Mata in s\u00F6kordet i s\u00F6kf\u00E4ltet",search_failure_messagebox_title:"S\u00F6kfel",search_failure_messagebox_message:"S\u00F6kningen lyckas inte f\u00F6r tillf\u00E4llet. F\u00F6rs\u00F6k igen senare.",search_published_map_no_results:"Inga tr\u00E4ff",search_published_map_too_many_results:"\u00F6ver 100 tr\u00E4ffar, avgr\u00E4nsa s\u00F6kningen.",leftpanel_maplevels_title:"KARTLAGER",leftpanel_organisation_title:"Organisation",leftpanel_thema_title:"Tema",leftpanel_own_maps_title:"Mina kartor",leftpanel_selected_layers_title:"Valda kartlager",leftpanel_new_window_title:"Nytt f\u00F6nster",leftpanel_empty_own_maps_content:"Inga egna kartor",leftpanel_find_maplayers_value:"S\u00F6k kartlager",leftpanel_tree_menu_tooltip:"V\u00E4lj sorteringss\u00E4tt f\u00F6r kartlagren.",leftpanel_filter_button_tooltip:"Tillbaka till den f\u00F6rvalda f\u00F6rteckningen \u00F6ver kartlager.",leftpanel_add_layer:"Tills\u00E4tt kartlager",leftpanel_style:"Stil:",rightpanel_search_find_places_textbox_value:"S\u00F6k plats/adress",rightpanel_search_find_places_button_value:"S\u00F6k","rightpanel-searchresults-close_button_value":"St\u00E4ng s\u00F6kresultat",rightpanel_wms_getfeatureinfo_button_value:"St\u00E4ng",rightpanel_material_description_title:"Materialbeskrivning",rightpanel_material_schema_title:"Dataproduktens schema",rightpanel_material_legend_title:"F\u00F6rklaringen",rightpanel_wms_getfeatureinfo_title:"Egenskapsuppgifter",rightpanel_map_layer_have_not_description:"F\u00F6rklaringen f\u00F6r kartan hittas inte.",rightpanel_map_layer_have_not_schema:"Dataproduktens schemauppgifter hittas inte.",rightpanel_info_panel_close_button_title:"St\u00E4ng info",rightpanel_wms_getfeatureinfo_not_supported_txt:"F\u00F6rfr\u00E5gan om egenskapsuppgifter st\u00F6ds inte f\u00F6r den valda kartan",mapservice_basemap_show_info_title:"Visa information om bakgrundskartan",mapservice_basemap_delete_title:"Radera bakgrundskartan",mapservice_layer_show_info_title:"Visa information om kartlager",mapservice_layer_delete_title:"Radera kartlager",mapservice_layer_is_not_visible_in_this_scale_zoomin_map_title:"Kartlagret kan inte visas i denna skala. Zooma in (+) kartan.",mapservice_layer_is_not_visible_in_this_scale_zoomout_map_title:"Kartlagret kan inte visas i denna skala. Zooma ut (-) kartan.",mapservice_not_found_legend_image:"F\u00F6rklaringar f\u00F6r kartan hittas inte",mapservice_change_layer_opacity_tooltip:"Justera kartlagrets genomsynlighet",mapservice_basemap_image_tooltip:"Bakgrundskarta",mapservice_maplayer_image_tooltip:"Kartlager",mapservice_published_error_params:"Fel i den avskiljda kartans parametrar, var god och kontakta denna webbplats underh\u00E5ll.",mapservice_select_layer_style:"V\u00E4lj stil",map_control_tool_prev_tooltip:"G\u00E5 tillbaka i navigeringshistorien",map_control_tool_next_tooltip:"G\u00E5 fram\u00E5t i navigeringshistorien",map_control_navigate_tool_tooltip:"Navigera eller v\u00E4lj",map_control_zoom_tool_tooltip:"Zooma in p\u00E5 det \u00F6nskade omr\u00E5det genom att gr\u00E4nsa omr\u00E5det med att h\u00E5lla musens v\u00E4nstra knapp nedtryckt",map_control_measure_menu_tooltip:"V\u00E4lj m\u00E4tverktyg",map_control_measure_tool_tooltip:"M\u00E4t avst\u00E5nd",map_control_measure_area_tool_tooltip:"M\u00E4t areal",mapcontrolsservice_info_group_title:"V\u00E4lj verktyg f\u00F6r att visa uppgifter",mapcontrolsservice_show_info_tool_title:"Visa objektets uppgifter",map_control_map_link_tool_tooltip:"Bilda l\u00E4nk p\u00E5 kartan",mapcontrolsservice_show_coordinates_tool_title:"Visa koordinaterna",mapcontrolsservice_add_group_title:"V\u00E4lj anteckningsverktyg",mapcontrolsservice_add_point_tool_title:"Tills\u00E4tt punkt",mapcontrolsservice_add_line_tool_title:"Tills\u00E4tt rutt",mapcontrolsservice_add_area_tool_title:"Tills\u00E4tt omr\u00E5de",mapcontrolsservice_save_and_print_group_title:"V\u00E4lj verktyget Spara eller Skriv ut",mapcontrolsservice_save_tool_title:"Spara",map_control_print_tool_tooltip:"Skriv ut",mapcontrolsservice_mappublisher_tool_title:"Till publicering av kartan",mapcontrolsservice_zoomlevel_street_title:"Gata",mapcontrolsservice_zoomlevel_part_of_a_town_title:"Stadsdel",mapcontrolsservice_zoomlevel_town_title:"Kommun",mapcontrolsservice_zoomlevel_province_title:"Landskap",mapcontrolsservice_zoomlevel_country_title:"Hela landet",map_control_full_screen_tool_tooltip:"F\u00F6rstora/f\u00F6rminska kartan p\u00E5 hela bildsk\u00E4rmen",mapcontrolsservice_measure_length_title:"Avst\u00E5nd",mapcontrolsservice_measure_area_title:"Areal",mapcontrolsservice_layer_info_layer_not_selected_messagebox_title:"Du har inte valt kartlager",mapcontrolsservice_layer_info_layer_not_selected_messagebox_message:"V\u00E4lj ett av kartlagren som tillagts p\u00E5 kartan genom att klicka det.",mapcontrolsservice_not_found_wms_feature_info:"Info hittas inte",mapcontrolsservice_maplink_tool_title:"Skapa l\u00E4nk till synliga kartan",mapcontrolsservice_getting_WMS_info_title:"S\u00F6ker egenskapsuppgifter...",mapcontrolsservice_indexmap_title:"Visa/d\u00F6lj positioneringskarta",mapcontrolsservice_start_network_service_tool_title:"\u00D6ppna underh\u00E5llstj\u00E4nst",mapcontrolsservice_problem_with_safari_printing_title:"Problem med utskrivningen",mapcontrolsservice_problem_with_safari_printing_message:"Paikkatietoikkuna st\u00F6der inte utskrivningen av genomskinliga kartor p\u00E5 webbl\u00E4saren Safari. Utskrivningen av genomskinliga kartor st\u00F6ds p\u00E5 webbl\u00E4sarna Internet Explorer, Firefox, Opera och Chrome. Du kan justera alla kartornas genomskinlighetsv\u00E4rde upp till 100 % och skriva ut p\u00E5 nytt eller alternativt skapa en ny l\u00E4nk i den nuvarande vyn och \u00F6ppna l\u00E4nken med en webbl\u00E4sare som m\u00F6jligg\u00F6r utskrivningen av genomskinliga kartor.",searchservice_search_cannot_be_empty:"Mata in s\u00F6kordet i s\u00F6kf\u00E4ltet.",searchservice_search_alert_title:"S\u00F6k",searchservice_search_not_found_anything_text:"Ditt s\u00F6kord gav inga resultat. Kontrollera att du s\u00E4kert skrev s\u00F6kordet p\u00E5 r\u00E4tt s\u00E4tt.",searchservice_search_result_column_name:"Namn",searchservice_search_result_column_village:"Kommun",searchservice_search_result_column_type:"Typ",searchservice_searching_title:"S\u00F6ker...",maplinkservice_link_generated_messagebox_title:"Direkt kartl\u00E4nk",maplinkservice_link_generated_messagebox_message:'Med l\u00E4nken kommer du direkt tillbaka till den vy du skapat. L\u00E4nken omfattar l\u00E4get, skalan, valda kartlager, deras inst\u00E4llningar f\u00F6r genomsynlighet samt valda stilar.<br/><br/><textarea id="mapLinkTextarea" rows="2" cols="100">##0##</textarea>',maplinkservice_link_generation_failed_messagebox_title:"L\u00E4nkskapandet misslyckades",maplinkservice_link_generation_failed_messagebox_message:"Ett fel intr\u00E4ffade i samband med l\u00E4nkskapandet. F\u00F6rs\u00F6k skapa l\u00E4nken p\u00E5 nytt om en stund. Om problemet upprepas, var god och kontakta underh\u00E5llet.",published_map_search_textbox_value:"S\u00F6k plats/adress",published_map_search_button_value:"S\u00F6k",published_map_is_empty:"<p>Du har inte valt karta eller bakgrundskarta f\u00F6r kartan som du publicerat.</p><p>B\u00F6rja med att v\u00E4lja en karta till v\u00E4nster.</p>",published_map_exceeded_limit:"Det till\u00E5tna antalet framst\u00E4llningar har \u00F6verskridits. Du kan \u00E4nd\u00E5 \u00F6ppna",published_map_exceeded_limit_link_text:"kartan p\u00E5 Paikkatietoikkuna",published_map_terms_of_use:"Anv\u00E4ndningsvillkor",map_move_and_draw_module_select_searc_area_title:"Begr\u00E4nsa s\u00F6komr\u00E5det",wizard_module_confirm_close_button_value:"St\u00E4ng",wizard_module_confirm_cancel_button_value:"Annullera",wizard_service_module_confirm_message_title:"St\u00E4ng definitionen?",wizard_service_module_confirm_message:"<br>Du h\u00E5ller p\u00E5 att st\u00E4nga definitionen utan att spara dina \u00E4ndringar.<br>Vill du st\u00E4nga definitionen?<br><br>",wizard_module_previous_button_value:"F\u00F6reg\u00E5ende",wizard_module_next_button_value:"N\u00E4sta",wizard_module_progressbar_start_value:"Fas",wizard_module_progressbar_end_value:"definition",wizard_module_save_button_value:"Spara",status_wfs_update_grid:"Uppdaterar tabellen...",status_update_map:"Uppdaterar kartan",status_search:"S\u00F6ker...",status_get_feature_info:"S\u00F6ker egenskapsuppgifter...",status_multiple_tasks_running:"uppdrag i k\u00F6",status_tooltip_header:"L\u00E4ge",search_module_popup_layer_is_wfs_title:"Valda kartlagret \u00E4r dataprodukt",selected_layers_module_highlight_wms_layer:"Aktivera f\u00F6r att l\u00E4sa objektuppgifter",selected_layers_module_highlight_wfs_layer:"\u00D6ppna objektuppgiftstabellen",selected_layers_module_dim_wms_layer:"Avbryt att visa objektuppgifter",selected_layers_module_dim_wfs_layer:"St\u00E4ng objektuppgiftstabellen",selected_layers_module_wfs_icon_tooltip:"Dataprodukt",selected_layers_module_collapse_panel_tooltip:"D\u00F6lj justering av stil och genomsynlighet",selected_layers_module_expand_panel_tooltip:"Vis justering av stil och genomsynlighet",grid_module_not_found_info_for_selected_area:"Information p\u00E5 kartomr\u00E5det hittas inte.",grid_module_loading_info:"Laddar...",grid_module_wfs_maplayer_not_visible_this_scale:"Dataprodukten \u00E4r inte tillg\u00E4nglig i denna skala. Zooma in (+) eller zooma ut (-) kartan.",grid_module_gridpanel_title:"Objekttyperna f\u00F6r dataprodukten {0}",grid_module_gridpanel_no_title:"Ingen dataprodukt",grid_module_feature_type_title:"Objekttyp",grid_module_all_tab_title:"Alla",grid_module_featuretype_tab_tooltip:"Uppgifter om objekttyp",grid_module_all_tab_tooltip:"Uppgifter om dataproduktens alla objekttyper",grid_module_column_header_tooltip:"Sortera enligt v\u00E4rdet p\u00E5 egenskapsuppgift",overlay_popup_module_close_button_text:"St\u00E4ng",selected_layers_module_published_basemaps_title:"Julkaistavat taustakartat",selected_layers_module_published_maps_title:"Julkaistavat kartat"}},get:function(a,d){var b=this.currentLanguage;
var c=this.languageProperties[b][a];if(c===null){return"undefined key '"+a+"' for language '"+b+"'"}else{if(d){c=this.formatMessage(c,d)}return c}},formatMessage:function(d,c){var b=d;for(var a in c){b=b.replace("{"+a+"}",c[a])}return b},showPopup:function(a,f,b){var g=this.get(a);var e=this.get(f);if(b!=null){for(var d=0;d<b.length;d++){var c="##"+d+"##";e=e.replace(c,b[d])}}Ext.Msg.show({title:g,msg:e,buttons:Ext.Msg.OK})},isFiCurrentLanguage:function(){return(this.currentLanguage=="fi")},isSvCurrentLanguage:function(){return(this.currentLanguage=="sv")},isEnCurrentLanguage:function(){return(this.currentLanguage=="en")},getLanguage:function(){return this.currentLanguage}},{protocol:["Oskari.mapframework.service.Service"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this._wmtsLayerClazz=Oskari.clazz.create("Oskari.openlayers.Patch.layer.WMTS")},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(a){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapLayerAddEvent:function(a){this.afterMapLayerAddEvent(a)},AfterMapLayerRemoveEvent:function(a){this.afterMapLayerRemoveEvent(a)},AfterChangeMapLayerOpacityEvent:function(a){this.afterChangeMapLayerOpacityEvent(a)},AfterChangeMapLayerStyleEvent:function(a){this.afterChangeMapLayerStyleEvent(a)}},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(e){var b=this._sandbox;for(var d=0;d<e.length;d++){var c=e[d];var a=c.getId();if(!c.isLayerOfType("WMTS")){continue}b.printDebug("preselecting "+a);this.addMapLayerToMap(c,true,c.isBaseLayer())}},afterMapLayerAddEvent:function(a){this.addMapLayerToMap(a.getMapLayer(),a.getKeepLayersOrder(),a.isBasemap())},addMapLayerToMap:function(i,h,d){if(!i.isLayerOfType("WMTS")){return}var m=this;var b=m.getMap();var e=i.getWmtsMatrixSet().matrixIds;var c=i.getWmtsLayerDef();var j=null;if(i.isBaseLayer()){j="basemap_"+i.getId()}else{j="layer_"+i.getId()}var n=this._sandbox;var o=i.getWmtsUrls()[0];var a=i.getWmtsMatrixSet();var k={visibility:true,transparent:true,format:"image/png",url:o,layer:i.getWmtsName(),style:i.getCurrentStyle().getName(),matrixIds:a.matrixIds,matrixSet:a.identifier,isBaseLayer:i.isBaseLayer(),buffer:0,minScale:i.getMinScale(),maxScale:i.getMaxScale()};n.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+a.identifier+" / "+k.id+"/"+k.layer+"/"+k.url);var g=OpenLayers.Util.applyDefaults(k,{url:o,name:j,style:i.getCurrentStyle().getName(),matrixIds:a.matrixIds,layerDef:c});var l=this._wmtsLayerClazz.getPatch();var f=new l(g);f.opacity=i.getOpacity()/100;n.printDebug("[WmtsLayerPlugin] created WMTS layer "+f);b.addLayers([f])},afterMapLayerRemoveEvent:function(b){var a=b.getMapLayer();this.removeMapLayerFromMap(a)},removeMapLayerFromMap:function(d){if(!d.isLayerOfType("WMTS")){return}if(d.isBaseLayer()){var b="";if(d.getSubLayers().length>0){for(var c=0;c<d.getSubLayers().length;c++){var a=this._map.getLayersByName("basemap_"+d.getSubLayers()[c].getId());a[0].destroy()}}else{var a=this._map.getLayersByName("layer_"+d.getId());a[0].destroy()}}else{var a=this._map.getLayersByName("layer_"+d.getId());a[0].destroy()}},getOLMapLayers:function(c){if(!c.isLayerOfType("WMTS")){return null}if(c.isBaseLayer()){var a="";if(c.getSubLayers().length>0){for(var b=0;b<c.getSubLayers().length;b++){return this._map.getLayersByName("basemap_"+c.getSubLayers()[b].getId())}}else{return this._map.getLayersByName("layer_"+c.getId())}}else{return this._map.getLayersByName("layer_"+c.getId())}return null},afterChangeMapLayerOpacityEvent:function(c){var b=c.getMapLayer();if(!b.isLayerOfType("WMTS")){return}if(b.isBaseLayer()){if(b.getSubLayers().length>0){for(var d=0;d<b.getSubLayers().length;d++){var a=this._map.getLayersByName("basemap_"+b.getSubLayers()[d].getId());a[0].setOpacity(b.getOpacity()/100)}}else{var a=this._map.getLayersByName("layer_"+b.getId());if(a[0]!=null){a[0].setOpacity(b.getOpacity()/100)}}}else{this._sandbox.printDebug("Setting Layer Opacity for "+b.getId()+" to "+b.getOpacity());var a=this._map.getLayersByName("layer_"+b.getId());
if(a[0]!=null){a[0].setOpacity(b.getOpacity()/100)}}},afterChangeMapLayerStyleEvent:function(c){var b=c.getMapLayer();if(!b.isLayerOfType("WMTS")){return}if(!b.isBaseLayer()){var a=this._map.getLayersByName("layer_"+b.getId());if(a!=null){a[0].mergeNewParams({styles:b.getCurrentStyle().getName()})}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._id=null;this._name=null;this._WmtsLayerName=null;this._WmtsMatrixSet=null;this._inspireName=null;this._organizationName=null;this._dataUrl=null;this._type=null;this._opacity=null;this._featureInfoEnabled=null;this._subLayers=[];this._styles=[];this._description=null;this._WmtsUrls=[];this._dataUrl=null;this._legendImage=null;this._maxScale=null;this._minScale=null;this._queryable=null;this._currentStyle=null;this._visible=null;this._queryFormat=null;this._orderNumber=null;this._permissions={};this._geometry=[];this._geometryWKT=null},{setGeometryWKT:function(a){this._geometryWKT=a},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(a){this._geometry=a},getGeometry:function(){return this._geometry},addPermission:function(b,a){this._permissions[b]=a},removePermission:function(a){this._permissions[a]=null},getPermission:function(a){return this._permissions[a]},setId:function(a){this._id=a},getId:function(){return this._id},setQueryFormat:function(a){this._queryFormat=a},getQueryFormat:function(){return this._queryFormat},setName:function(a){this._name=a},getName:function(){return this._name},setWmtsName:function(a){this._WmtsName=a},getWmtsName:function(){return this._WmtsName},setWmtsMatrixSet:function(a){this._WmtsMatrixSet=a},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},setWmtsLayerDef:function(a){this._WmtsLayerDef=a},getWmtsLayerDef:function(){return this._WmtsLayerDef},setType:function(a){this._type=a},getType:function(){return this._type},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},setDataUrl:function(a){this._dataUrl=a},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(a){this._organizationName=a},getOrganizationName:function(){return this._organizationName},setInspireName:function(a){this._inspireName=a},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(a){this._featureInfoEnabled=a},isFeatureInfoEnabled:function(){if(this._featureInfoEnabled===true){return true}return false},setDescription:function(a){this._description=a},getDescription:function(){return this._description},addWmtsUrl:function(a){this._WmtsUrls.push(a)},getWmtsUrls:function(){return this._WmtsUrls},addStyle:function(a){this._styles.push(a)},getStyles:function(){return this._styles},addSubLayer:function(a){this._subLayers.push(a)},getSubLayers:function(){return this._subLayers},setLegendImage:function(a){this._legendImage=a},getLegendImage:function(){return this._legendImage},setMaxScale:function(a){this._maxScale=a},getMaxScale:function(){return this._maxScale},setMinScale:function(a){this._minScale=a},getMinScale:function(){return this._minScale},setQueryable:function(a){this._queryable=a},getQueryable:function(){return this._queryable},setAsGroupLayer:function(){this._type="GROUP_LAYER"},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(a){this._orderNumber=a},getOrderNumber:function(){return this._orderNumber},isBaseLayer:function(){if(this._type=="BASE_LAYER"){return true}else{return false}},selectStyle:function(b){var c=null;if(this._styles.length>0){if(b!==""){for(var a=0;a<this._styles.length;a++){c=this._styles[a];if(c.getName()==b){this._currentStyle=c;return}}}else{if(this._styles.length>1){this._currentStyle=this._styles[0]}else{c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c}return}}else{c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");
this._currentStyle=c;return}c=Oskari.clazz.create("Oskari.mapframework.domain.Style");c.setName("");c.setTitle("");c.setLegend("");this._currentStyle=c},getCurrentStyle:function(){return this._currentStyle},isVisible:function(){return this._visible},setVisible:function(a){this._visible=a},isInScale:function(c){var b=this.isBaseLayer();if(!c){var a=Oskari.$().sandbox;c=a.getMap().getScale()}if(!this.isBaseLayer()){if(c>this.getMaxScale()&&c<this.getMinScale()){b=true}}return b},isLayerOfType:function(a){return a=="WMTS"||a=="wmtslayer"},isGroupLayer:function(){if(this._type=="GROUP_LAYER"){return true}else{return false}}});Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(a){this.mapLayerService=a;this.capabilities={};this.capabilitiesClazz=Oskari.clazz.create("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0")},{setCapabilities:function(a,b){this.capabilities[a]=b},getCapabilities:function(a){return this.capabilities[a]},readWMTSCapabilites:function(a,e,d){var b=this;var c=this.capabilitiesClazz.getPatch();var f=new c();OpenLayers.Request.GET({url:e,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(h){var i=h.responseXML;if(!i||!i.documentElement){i=h.responseText}var g=f.read(i);b.setCapabilities(a,g);b.parseCapabilitiesToLayers(a,g,d)},failure:function(){alert("Trouble getting capabilities doc");OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}})},parseCapabilitiesToLayers:function(b,a,d){var t=this;var e=this.mapLayerService;var r=null;if(a.operationsMetadata.GetTile.dcp.http.getArray){r=a.operationsMetadata.GetTile.dcp.http.getArray}else{r=a.operationsMetadata.GetTile.dcp.http.get}var u=a.contents.layers;var q=a.contents;var d=q.tileMatrixSets[d];for(var k=0;k<u.length;k++){var c=u[k];var g=c.identifier;var s=c.identifier;var l={name:g,minScale:10000000,maxScale:1,opacity:100,wmtsName:g,descriptionLink:"",orgName:"WMTS",type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:true,minScale:4*4*4*4*40000,style:"",dataUrl:"",name:g,opacity:100,inspire:"WMTS",maxScale:1};var v=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer");v.setAsNormalLayer();v.setId(g);v.setName(l.name);v.setWmtsName(l.wmtsName);v.setOpacity(l.opacity);v.setMaxScale(l.maxScale);v.setMinScale(l.minScale);v.setDescription(l.info);v.setDataUrl(l.dataUrl);v.setOrganizationName(l.orgName);v.setInspireName(l.inspire);v.setWmtsMatrixSet(d);v.setWmtsLayerDef(c);v.addWmtsUrl(r);var h=Oskari.clazz.builder("Oskari.mapframework.domain.Style");var j;for(var m=0,f=c.styles.length;m<f;++m){j=c.styles[m];var o=h();o.setName(j.identifier);o.setTitle(j.identifier);v.addStyle(o);if(j.isDefault){v.selectStyle(j.identifier);break}}e.addLayer(v,false)}}});Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(d,e,g){d.setWmtsName(e.wmsName);if(e.wmsUrl){var j=e.wmsUrl.split(",");for(var c=0;c<j.length;c++){d.addWmtsUrl(j[c])}}var f=Oskari.clazz.builder("Oskari.mapframework.domain.Style");var b;for(var c=0,h=e.styles.length;c<h;++c){b=e.styles[c];var a=f();a.setName(b.identifier);a.setTitle(b.identifier);d.addStyle(a);if(b.isDefault){d.selectStyle(b.identifier);break}}d.setFeatureInfoEnabled(true);if(e.tileMatrixSetData){d.setWmtsMatrixSet(e.tileMatrixSetData);d.setWmtsLayerDef(e.tileLayerData)}}});Oskari.clazz.define("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0",function(){},{getPatch:function(){if(this.patch){return this.patch}return this.buildPatch()},buildPatch:function(){this.patch=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;var a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])
}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);a.version=this.version;return a},props:{wmts:{TileMatrixLimits:{MinTileRow:["minTileRow",parseInt],MaxTileRow:["maxTileRow",parseInt],MinTileCol:["minTileCol",parseInt],MaxTileCol:["maxTileCol",parseInt],TileMatrix:["tileMatrix",null]}}},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(b,c){var a={styles:[],formats:[],tileMatrixSetLinks:[],tileMatrixSetLinksMap:{}};a.layers=[];this.readChildNodes(b,a);c.layers.push(a)},Style:function(b,c){var a={};a.isDefault=(b.getAttribute("isDefault")==="true");this.readChildNodes(b,a);c.styles.push(a)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(b,c){var a={};this.readChildNodes(b,a);c.tileMatrixSetLinks.push(a);c.tileMatrixSetLinksMap[a.tileMatrixSet]=a},TileMatrixSet:function(b,c){if(c.layers){var a={matrixIds:[]};this.readChildNodes(b,a);c.tileMatrixSets[a.identifier]=a}else{c.tileMatrixSet=this.getChildValue(b)}},TileMatrix:function(b,c){var a={supportedCRS:c.supportedCRS};this.readChildNodes(b,a);c.matrixIds.push(a)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(d,f){var c=this.getChildValue(d);var e=c.split(" ");var a;if(f.supportedCRS){var b=f.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");a=!!this.yx[b]}if(a){f.topLeftCorner=new OpenLayers.LonLat(e[1],e[0])}else{f.topLeftCorner=new OpenLayers.LonLat(e[0],e[1])}},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};b.resourceUrl[a.getAttribute("resourceType")]={format:a.getAttribute("format"),template:a.getAttribute("template")}},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},TileMatrixSetLimits:function(d,e){var b={tileMatrixLimits:[]};e.tileMatrixSetLimits=b;this.readChildNodes(d,b);var c={};for(var f=0;f<b.tileMatrixLimits.length;f++){var a=b.tileMatrixLimits[f];c[a.tileMatrix]=a}e.tileMatrixSetLimitsMap=c},TileMatrixLimits:function(f,h){var b=this.getElementsByTagNameNS(f,this.namespaces.wmts,"*");var j=this.props.wmts.TileMatrixLimits;var c={};for(var d=0;d<b.length;d++){var g=b[d];var e=this.getChildValue(g);var k=g.localName||g.nodeName.split(":").pop();var a=j[k][0];var i=j[k][1];c[a]=i?i(e):e}h.tileMatrixLimits.push(c)}},ows:OpenLayers.Util.applyDefaults({HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http)},Get:function(c,b){var a=this.getAttributeNS(c,this.namespaces.xlink,"href");if(!b.get){b.get=a}if(!b.getArray){b.getArray=[]}b.getArray.push(a)}},OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows)},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});return this.patch}},{protocol:["Oskari.openlayers.Patch"]});Oskari.clazz.define("Oskari.openlayers.Patch.layer.WMTS",function(){},{getPatch:function(){if(this.patch){return this.patch}return this.buildPatch()},buildPatch:function(){this.patch=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,layerDef:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(c){var f={url:true,layer:true,style:true,matrixSet:true};for(var g in f){if(!(g in c)){throw new Error("Missing property '"+g+"' in layer configuration.")}}c.params=OpenLayers.Util.upperCaseObject(c.params);
var b=[c.name,c.url,c.params,c];OpenLayers.Layer.Grid.prototype.initialize.apply(this,b);if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()}if(this.matrixIds){var a=this.matrixIds.length;if(a&&typeof this.matrixIds[0]==="string"){var e=this.matrixIds;this.matrixIds=new Array(a);for(var d=0;d<a;++d){this.matrixIds[d]={identifier:e[d]}}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)}if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(b,a,c){if(a||!this.matrix){this.updateMatrixProperties()}return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMTS(this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getMatrix:function(){var b;if(!this.matrixIds||this.matrixIds.length===0){b={identifier:this.map.getZoom()+this.zoomOffset}}else{if("scaleDenominator" in this.matrixIds[0]){var a=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/0.00028;var e=Number.POSITIVE_INFINITY;var f;for(var c=0,d=this.matrixIds.length;c<d;++c){f=Math.abs(1-(this.matrixIds[c].scaleDenominator/a));if(f<e){e=f;b=this.matrixIds[c]}}}else{b=this.matrixIds[this.map.getZoom()+this.zoomOffset]}}return b},getTileInfo:function(f){var b=this.map.getResolution();var d=(f.lon-this.tileOrigin.lon)/(b*this.tileSize.w);var c=(this.tileOrigin.lat-f.lat)/(b*this.tileSize.h);var a=Math.floor(d);var e=Math.floor(c);return{col:a,row:e,i:Math.floor((d-a)*this.tileSize.w),j:Math.floor((c-e)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var c="";if(!(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a))){return c}var b=a.getCenterLonLat();var d=this.getTileInfo(b);var j=this.matrix.identifier;if(this.layerDef&&this.layerDef.tileMatrixSetLinksMap){var k=this.layerDef.tileMatrixSetLinksMap[this.matrixSet];var h=k?k.tileMatrixSetLimitsMap[this.matrix.identifier]:null;var l=h?(d.row>=h.minTileRow&&d.row<=h.maxTileRow):false;var e=h?(d.col>=h.minTileCol&&d.col<=h.maxTileCol):false;if(!(l&&e)){return OpenLayers.Util.getImagesLocation()+"blank.gif"}}if(this.requestEncoding.toUpperCase()==="REST"){var m=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions){for(var g=0;g<this.dimensions.length;g++){if(this.params[this.dimensions[g]]){m=m+this.params[this.dimensions[g]]+"/"}}}m=m+this.matrixSet+"/"+this.matrix.identifier+"/"+d.row+"/"+d.col+"."+this.formatSuffix;if(OpenLayers.Util.isArray(this.url)){c=this.selectUrl(m,this.url)}else{c=this.url}if(!c.match(/\/$/)){c=c+"/"}c=c+m}else{if(this.requestEncoding.toUpperCase()==="KVP"){var f={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:d.row,TILECOL:d.col,FORMAT:this.format};c=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[f])}}return c},mergeNewParams:function(a){if(this.requestEncoding.toUpperCase()==="KVP"){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});return this.patch}},{protocol:["Oskari.openlayers.Patch"]});Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(a){this.name="MapWmts";this.mediator=null;this.sandbox=null;this.service=null;this.ui=null},{start:function(){if(this.mediator.getState()=="started"){return}var c=Oskari.$("sandbox");this.sandbox=c;var b=c.getService("Oskari.mapframework.service.MapLayerService");b.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var d=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");
b.registerLayerModelBuilder("wmtslayer",d);var a=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",b);this.service=a;this.mediator.setState("started");return this},update:function(d,a,c,e){d.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+e)},stop:function(){this.mediator.setState("stopped");return this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.service.OgcSearchService",function(b,a){this._TILE_SIZE_IN_PIXELS=256;this._componentName="WfsRequestTiler";this._mapPollingInterval=100;this._gridPollingInterval=200;this._simultaneousPngRequest=4;this._wfsMapUpdateRequests={};this._wfsMapHighlightRequest=null;this._gridQuery=null;this._wfsGridUpdateRequest=null;this._tileCount=16;this._core=a;this._doMapLayerReArrange=false;this.endpointUrl=b},{__qname:"Oskari.mapframework.service.OgcSearchService",getQName:function(){return this.__qname},__name:"OgcSearchService",getName:function(){return this.__name},processGetFeaturesJsonFlowForTableFormat:function(k,h,e,d,c,a,f,j,g){var l=k.getId();var b="&flow_pm_wfsLayerId="+l+"&flow_pm_bbox_min_x="+e+"&flow_pm_bbox_min_y="+d+"&flow_pm_bbox_max_x="+c+"&flow_pm_bbox_max_y="+a+"&flow_pm_map_width="+f+"&flow_pm_map_heigh="+j+"&flow_pm_map_wfs_query_id="+g+"&actionKey=QUERY_FIND_RAW_DATA_TO_TABLE";this._gridQuery=jQuery.ajax({dataType:"json",type:"POST",url:this.endpointUrl+b,data:b,success:h})},processGetFeatureTypeIdsJsonForTableFormat:function(d,e,b,c){var a=d+"&flow_pm_map_width="+b+"&flow_pm_map_heigh="+c+"&actionKey=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT";jQuery.ajax({dataType:"json",type:"POST",url:this.endpointUrl+a,data:a,success:e})},processGetFeaturesPngImageForMapFormat:function(k,h,e,d,c,a,f,j,g){var l=k.getId();var b=Oskari.$().startup.globalMapPngUrl+"&flow_pm_wfsLayerId="+l+"&flow_pm_bbox_min_x="+e+"&flow_pm_bbox_min_y="+d+"&flow_pm_bbox_max_x="+c+"&flow_pm_bbox_max_y="+a+"&flow_pm_map_width="+f+"&flow_pm_map_heigh="+j+"&flow_pm_zoom_level="+g+"&actionKey=GET_PNG_MAP";h(b)},processGetHighlightWFSFeatureImageUrl:function(g,j,e,d,c,a,f,h){if(g!==null&&j!==null){var b=Oskari.$().startup.globalMapPngUrl+"&flow_pm_wfsLayerId="+g+"&wfsFeatureId="+j+"&flow_pm_bbox_min_x="+e+"&flow_pm_bbox_min_y="+d+"&flow_pm_bbox_max_x="+c+"&flow_pm_bbox_max_y="+a+"&flow_pm_map_width="+f+"&flow_pm_map_heigh="+h+"&actionKey=GET_HIGHLIGHT_WFS_FEATURE_IMAGE";return b}else{throw"Cannot do processGetHighlightWFSFeatureImageUrl because wfsLayerId or wfsFeatureId is null."}},scheduleMapLayerRearrangeAfterWfsMapTilesAreReady:function(){this._doMapLayerReArrange=true},removeWFsLayerRequests:function(a){var c=a.getId();if(this._wfsMapUpdateRequests[c]!==null){var b=this._wfsMapUpdateRequests[c];this._wfsMapUpdateRequests[c]=null;delete b}},removeWFSLayerGridRequests:function(a){if(this._gridQuery){this._gridQuery.abort()}this._wfsGridUpdateRequest=null},removeWFSMapHighlightRequest:function(){this._wfsMapHighlightRequest=null},scheduleWFSMapLayerUpdate:function(g,l,e,h,b){var a=g.getId();var k=this._wfsMapUpdateRequests[a];if(k!==null){this._wfsMapUpdateRequests[a]=null;delete k}this._wfsMapUpdateRequests[a]=[];var c=this.splitBbox(l,e,h,this._TILE_SIZE_IN_PIXELS);this._tileCount=c.length;var j=Oskari.clazz.builder("Oskari.mapframework.domain.WfsTileRequest");for(var d=0;d<c.length;d++){var f=j(g,c[d],e,h,b,d);this._wfsMapUpdateRequests[a].push(f)}this._doMapLayerReArrange=true},scheduleWFSGridUpdate:function(f,e,a,d,b){this._wfsGridUpdateRequest=Oskari.clazz.create("Oskari.mapframework.domain.WfsGridScheduledRequest",f,e,a,d,b);var c=this;setTimeout(function(){c.processGridQueue()},this._gridPollingInterval)},scheduleWFSMapHighlightUpdate:function(a){this._wfsMapHighlightRequest=a;this.processHighlightQueue()},splitBbox:function(f,c,b,a){var e=this._core.getMap();var g=[];if(e){var d=e.getTileQueue();if(d){g=d.getQueue()}else{}}else{}return g},processMapQueue:function(){var j=function(b){var l="WFS_LAYER_IMAGE_"+e.getMapLayer().getId()+"_"+e.getSequenceNumber();var m=d.getEventBuilder("AfterWfsGetFeaturesPngImageForMapEvent")(e.getMapLayer(),b,e.getBbox(),l);d.copyObjectCreatorToFrom(m,e);d.dispatch(m)};this._core.printDebug("[OGCSearchService.processMapQueue] Looping this._wfsMapUpdateRequests...");for(var c in this._wfsMapUpdateRequests){var g=this._wfsMapUpdateRequests[c];if(g!==null&&g.length>0){this._core.printDebug("[OGCSearchService.processMapQueue] Got requestArray of size "+g.length+" for id "+c);var e=g[0];
this._core.printDebug("[OGCSearchService.processMapQueue] Creating request for '"+e.getMapLayer().getName()+"'");var d=this._core;var k=e.getBbox();var f=d._map._zoom;this._core.printDebug("[OGCSearchService.processMapQueue] Calling processGetFeaturesPngImageForMapFormat with");this._core.printDebug("     request.getMapLayer() : "+e.getMapLayer().getName());this._core.printDebug("          bbox.bounds.left : "+k.bounds.left);this._core.printDebug("        bbox.bounds.bottom : "+k.bounds.bottom);this._core.printDebug("         bbox.bounds.right : "+k.bounds.right);this._core.printDebug("           bbox.bounds.top : "+k.bounds.top);this._core.printDebug("      _TILE_SIZE_IN_PIXELS : "+this._TILE_SIZE_IN_PIXELS);this._core.printDebug("                   mapZoom : "+f);this.processGetFeaturesPngImageForMapFormat(e.getMapLayer(),j,k.bounds.left,k.bounds.bottom,k.bounds.right,k.bounds.top,this._TILE_SIZE_IN_PIXELS,this._TILE_SIZE_IN_PIXELS,f);this._core.printDebug("[OGCSearchService.processMapQueue] removing handled element");g.splice(0,1);if(g.length===0){delete g;this._core.printDebug("[OGCSearchService.processMapQueue] deleting empty requestArray")}return}}this._core.printDebug("[OGCSearchService.processMapQueue] _doMapLayerReArrange is "+this._doMapLayerReArrange);if(this._doMapLayerReArrange){var h=this._core.getRequestBuilder("RearrangeSelectedMapLayerRequest");var a=h();this._core.processRequest(a);this._doMapLayerReArrange=false}},processGridQueue:function(){var b=this._wfsGridUpdateRequest;var a=this._core;if(b==null){return}if(this._gridQuery){this._gridQuery.abort()}try{a.actionInProgressWfsGrid();var c=function(d){if(d.error=="true"){a.printWarn("Error while querying data to table.")}if(a.getLatestWfsTableQueryId()==parseInt(d.wfsQueryId)||d.error=="true"){if(a.isMapLayerAlreadyHighlighted(b.getMapLayer().getId())){var e=a.getEventBuilder("AfterWfsGetFeaturesJsonFlowForTableFormatEvent")(b.getMapLayer(),d,b.getBbox());a.copyObjectCreatorToFrom(e,b);a.dispatch(e)}else{a.printWarn("WFS feature response json layer ("+b.getMapLayer().getName()+") not match of highlighted layer --> Skipping response.");a.processRequest(a.getRequestBuilder("ActionReadyRequest")("WFS_GRID",false))}}else{a.printWarn("WFS GetFeaturesJsonFlowForTableFormat response id not match to latest wfs query id --> Skipping response.")}};this.processGetFeaturesJsonFlowForTableFormat(b.getMapLayer(),c,b.getBbox().left,b.getBbox().bottom,b.getBbox().right,b.getBbox().top,b.getMapWidth(),b.getMapHeight(),a.generateWfsTableQueryId())}finally{this._wfsGridUpdateRequest=null}},processHighlightQueue:function(){var d=this._wfsMapHighlightRequest;if(d===null){return}try{var e=d.getWFSFeatureId();var g=this._core.findMapLayerFromAllAvailable(d.getMapLayerId());if(!g.isLayerOfType("WFS")){throw"Trying to highlight feature from layer that is not WFS layer!"}var c=Oskari.$().sandbox._core;var j=c._map.getBbox();var f=c._map.getWidth();var h=c._map.getHeight();var b=this.processGetHighlightWFSFeatureImageUrl(g.getId(),e,j.left,j.bottom,j.right,j.top,f,h);var a=this._core.getEventBuilder("AfterWfsGetFeaturesPngImageForMapEvent")(g,b,this._core._map.getBbox(),"HIGHLIGHTED_FEATURE");this._core.copyObjectCreatorToFrom(a,d);this._core.dispatch(a)}finally{this._wfsMapHighlightRequest=null}},startPollers:function(){for(i=0;i<this._tileCount;i++){this.processMapQueue()}}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.service.NetServiceCenterService",function(a){this._endpoint=a},{__qname:"Oskari.mapframework.service.NetServiceCenterService",getQName:function(){return this.__qname},__name:"NetServiceCenterService",getName:function(){return this.__name},doRequest:function(c,b,d){var e="";if(b!=null){for(var a in b){e+="&"+a+"="+encodeURIComponent(b[a])}}jQuery.ajax({dataType:"json",type:"POST",url:this._endpoint+"&actionKey="+c+e,data:"actionKey="+c+e,complete:d})}},{protocol:["Oskari.mapframework.service.Service"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null;this.requestHandlers={};this.extensions=[];this.extensionsByName={};this.compiledTemplates={};this.flyoutContainer=null;this.tileContainer=null},{getName:function(){return"userinterface.DivManazer"},init:function(a){},getSandbox:function(){return this.sandbox},start:function(){this.compileTemplates();this.flyoutContainer=jQuery(document.body);this.tileContainer=jQuery("#menubar");var a=Oskari.$("sandbox");this.sandbox=a;this.sandbox.register(this);this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this);this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this);this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this);a.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add);a.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);a.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update);this.requestHandlers.modal=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",this);a.addRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal)},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update);sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add);sandbox.removeRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal);this.sandbox.unregister(this);this.started=false},templates:{"Oskari.userinterface.Tile":'<div class="oskari-tile oskari-tile-closed"><div class="oskari-tile-title"></div><div class="oskari-tile-status"></div><div class="oskari-tile-close"></div></div>',"Oskari.userinterface.Flyout":'<div class="oskari-flyout oskari-closed"><div class="oskari-flyoutheading"></div><div class="oskari-flyouttoolbar"><div class="oskari-flyout-title"><p></p></div><div class="oskari-flyouttools"><div class="oskari-flyouttool-help"></div><div class="oskari-flyouttool-attach"></div><div class="oskari-flyouttool-detach"></div><div class="oskari-flyouttool-minimize"></div><div class="oskari-flyouttool-restore"></div><div class="oskari-flyouttool-close"></div></div></div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"></div></div></div>'},compileTemplates:function(){this.compiledTemplates["Oskari.userinterface.Tile"]=jQuery(this.templates["Oskari.userinterface.Tile"]);var a=jQuery(this.templates["Oskari.userinterface.Flyout"]);a.css("left","-3195px");a.css("top","-3100px");this.compiledTemplates["Oskari.userinterface.Flyout"]=a},addExtension:function(n){n.startExtension();var e=n.getPlugins();var i=null;var l=this.extensions;var f=this.extensionsByName;var o={state:"close",extension:n,draggable:null,draggableTarget:null,draggableHandle:null,viewState:{},extensionUpdatedEvent:null};o.extensionUpdatedEvent=this.sandbox.getEventBuilder("userinterface.ExtensionUpdatedEvent")(n,o.state);var j=l.length;var b=n.getName();var h=e["Oskari.userinterface.Flyout"];var m=null;if(h!=null){m=this.createFlyout(n,h,j,o);o.draggableHandle=m.children(".oskari-flyoutheading").get()[0];var g=m.children(".oskari-flyoutcontentcontainer");var a=g.children(".oskari-flyoutcontent");var d=g.children(".oskari-flyoutcontent");h.setEl(d.get());this.flyoutContainer.append(m);h.startPlugin()}var c=e["Oskari.userinterface.Tile"];var k=null;if(c!=null){k=this.createTile(n,c,j,o);c.startPlugin();k.fadeIn(200);this.tileContainer.append(k)}o.plugins={};if(c){o.plugins["Oskari.userinterface.Tile"]={plugin:c,el:k}}if(h){o.plugins["Oskari.userinterface.Flyout"]={plugin:h,el:m}}l.push(o);f[b]=o;return o},createTile:function(h,c,d,j){var f=this;var a=jQuery("#menubar");var e=this.compiledTemplates["Oskari.userinterface.Tile"].clone(true,true);
var g=e.children(".oskari-tile-title");g.append(c.getTitle());var b=e.children(".oskari-tile-status");g.click(function(){f.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"toggle"])});b.click(function(){f.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"toggle"])});var i=e.children(".oskari-tile-close");i.hide();c.setEl(e.get());return e},createFlyout:function(h,f,e,a){var d=this;var b=this.compiledTemplates["Oskari.userinterface.Flyout"].clone(true,true);b.find(".oskari-flyout-title p").append(h.getTitle());var g=b.children(".oskari-flyouttoolbar").children(".oskari-flyouttools");var c={attach:g.children(".oskari-flyouttool-attach"),detach:g.children(".oskari-flyouttool-detach"),minimize:g.children(".oskari-flyouttool-minimize"),restore:g.children(".oskari-flyouttool-restore"),close:g.children(".oskari-flyouttool-close"),help:g.children(".oskari-flyouttool-help")};c.detach.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"detach"])});c.attach.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"attach"])});c.minimize.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"minimize"])});c.restore.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"restore"])});c.close.click(function(){d.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[h,"close"])});c.help.click(function(){d.getSandbox().postRequestByName("userguide.ShowUserGuideRequest",[{placement:"bottom",el:c.help,extension:h.getName(),toggle:true}])});return b},removeExtension:function(q){var l=this;var m=l.extensions;var g=this.extensionsByName;var r=g[q.getName()];var f=r.state;var i=r.plugins["Oskari.userinterface.Flyout"];if(i){var h=i.plugin;var o=i.el;var d=this.flyoutOps;var p=d.close;p.apply(this,[o,h,r]);o.remove()}var c=r.plugins["Oskari.userinterface.Tile"];if(c){var b=c.plugin;var k=c.el;k.remove()}g[q.getName()]=null;var a=[];for(var e=0,j=m.length;e<j;e++){if(m[e]===r){continue}a.push(m[e])}l.extensions=a;q.stopExtension()},updateExtension:function(j,d){var z=this;var x=z.extensions;var a=this.extensionsByName;var m=a[j.getName()];var h=m.state;var e=d.getState();if(e=="toggle"){if(h=="close"){e="attach"}else{if(h=="attach"){e="close"}else{if(h=="detach"){e="minimize"}else{if(h=="minimize"){e="restore"}else{if(h=="restore"){e="minimize"}}}}}}var k=m.plugins["Oskari.userinterface.Flyout"];if(e=="attach"&&k){var b=z.flyoutOps;var g=b.close;for(var p=0,u=x.length;p<u;p++){var q=x[p];if(q===m){continue}if(q.state!="attach"){continue}var c="close";var y=q.plugins;var s=y["Oskari.userinterface.Flyout"];if(s){var w=s.plugin;var o=s.el;q.state=c;g.apply(this,[o,w,q]);z.notifyExtensionViewStateChange(q)}else{continue}var l=y["Oskari.userinterface.Tile"];if(l){var f=l.plugin;var B=l.el;z.applyTransition(B,c,z.tileTransitions)}}}if(k){var r=k.plugin;var v=k.el;var b=z.flyoutOps;var i=b[e];i.apply(this,[v,r,m,x])}var t=m.plugins["Oskari.userinterface.Tile"];if(t){var C=t.plugin;var A=t.el;z.applyTransition(A,e,z.tileTransitions)}m.state=e;z.notifyExtensionViewStateChange(m)},notifyExtensionViewStateChange:function(a){var b=a.extensionUpdatedEvent;b.setViewState(a.state);b.setViewInfo(a.viewState);this.sandbox.notifyAll(b,true)},defaults:{detach:{left:"245px",top:"100px"},attach:{left:"214px",top:"100px"}},tileTransitions:{attach:{"oskari-tile-attached":true,"oskari-tile-detached":false,"oskari-tile-closed":false},detach:{"oskari-tile-attached":false,"oskari-tile-detached":true,"oskari-tile-minimized":false,"oskari-tile-closed":false},minimize:{"oskari-tile-minimized":true,"oskari-tile-closed":false,"oskari-tile-detached":false},restore:{"oskari-tile-minimized":false,"oskari-tile-detached":true},close:{"oskari-tile-closed":true,"oskari-tile-attached":false,"oskari-tile-detached":false}},flyoutTransitions:{attach:{"oskari-attached":true,"oskari-detached":false,"oskari-closed":false},detach:{"oskari-attached":false,"oskari-detached":true,"oskari-closed":false},minimize:{"oskari-minimized":true,"oskari-closed":false,"oskari-detached":false},restore:{"oskari-minimized":false,"oskari-closed":false,"oskari-detached":true,"oskari-attached":false},close:{"oskari-closed":true,"oskari-minimized":false,"oskari-detached":false,"oskari-attached":false}},applyTransition:function(d,b,c){var c=c[b];
if(!c){return}for(var a in c){if(c[a]){d.addClass(a)}else{d.removeClass(a)}}},getFlyoutViewState:function(a,c){var b={left:a.css("left"),top:a.css("top"),width:a.width(),height:a.height(),"z-index":a.css("z-index"),viewState:c};return b},flyoutOps:{detach:function(c,d,a,f){var g=this;if((!a.viewState.left||!a.viewState.top)||(a.viewState.left==g.defaults.attach.left&&a.viewState.top==g.defaults.attach.top)){a.viewState.left=g.defaults.detach.left;a.viewState.top=g.defaults.detach.top}var b={left:a.viewState.left,top:a.viewState.top};c.animate(b,200,"cubicIn",function(){var i=g.getFlyoutViewState(c,"detach");a.viewState=i});g.applyTransition(c,"detach",g.flyoutTransitions);var e=c.get()[0];var h=a.draggableHandle;a.draggableTarget=e;a.draggable=new Draggable(e,{handle:h,scroll:false,onStop:function(i,j){g.shuffleZIndices(c);var k=g.getFlyoutViewState(c,"detach");a.viewState=k;g.notifyExtensionViewStateChange(a)}})},attach:function(b,c,a,d){var e=this;b.removeAttr("style");e.applyTransition(b,"attach",e.flyoutTransitions);b.css("left",e.defaults.attach.left);b.css("top",e.defaults.attach.top);var f=e.getFlyoutViewState(b,"attach");a.viewState=f;if(a.draggable){a.draggable.destroy();a.draggable=null}},minimize:function(b,c,a){var d=this;var e=d.getFlyoutViewState(b,"minimize");d.applyTransition(b,"minimize",d.flyoutTransitions);a.viewState=e},restore:function(b,c,a){var d=this;d.applyTransition(b,"restore",d.flyoutTransitions);var e=a.viewState},close:function(b,c,a){var d=this;a.viewState={viewState:"close"};d.applyTransition(b,"close",d.flyoutTransitions);if(a.draggable){a.draggable.destroy();a.draggable=null}}},setState:function(f){var d=this;var b=f;if(!b){return}for(var g in d.extensionsByName){var a=d.extensionsByName[g];var c=b.extensionStatesByName[g];if(!c){continue}a.state=c.state;a.viewState=c.viewState||{}}},getState:function(){var c=this;c.refreshExtensionViewStates();var b={extensionStatesByName:{}};for(var d in c.extensionsByName){var a=c.extensionsByName[d];b.extensionStatesByName[d]={state:a.state,viewState:a.viewState}}return b},applyState:function(){var a=this;a.restoreExtensionViewStates()},refreshExtensionViewStates:function(){var f=this;for(var h in f.extensionsByName){var a=f.extensionsByName[h];var d=a.plugins["Oskari.userinterface.Flyout"];if(d){var c=d.plugin;var b=d.el;var g=f.getFlyoutViewState(b,a.state);a.viewState=g}}},restoreExtensionViewStates:function(){var k=this;var c=k.flyoutOps;var l=k.extensions;for(var j in k.extensionsByName){var o=k.extensionsByName[j];var n=o.extension;var h=o.plugins["Oskari.userinterface.Flyout"];if(h){var f=h.plugin;var m=h.el;var d=o.viewState;m.removeAttr("style");m.css("left",d.left),m.css("top",d.top);m.width(d.width);m.height(d.height);m.css("z-index",d["z-index"]);var g=c[o.state];g.apply(k,[m,f,o,l])}var b=o.plugins["Oskari.userinterface.Tile"];if(b){var a=b.plugin;var i=b.el;k.applyTransition(i,o.state,k.tileTransitions)}}},shuffleZIndices:function(m){var i=this;var j=i.extensions;var s=[];var a={};var c={};var p={};var d=1100;for(var h in i.extensionsByName){var r=i.extensionsByName[h];var q=r.extension;var g=r.plugins["Oskari.userinterface.Flyout"];if(g){var f=g.plugin;var l=g.el;var k=l.css("z-index");s.push(k);var o=""+k;a[o]=k;p[o]=l;c[o]=r}}s.sort();for(var b=0;b<s.length;b++){var o=s[b];a[o]=d+b;if(c[o].state!="detach"){continue}p[o].css("z-index",a[s[b]])}m.css("z-index",d+s.length+2)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Stateful"]});Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(a){this._extension=a},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.addExtension(c)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(a){this._extension=a
},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.removeExtension(c)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(b,a){this._extension=b;this._state=a},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(a){this.ui=a},{handleRequest:function(a,b){var c=b.getExtension();this.ui.updateExtension(c,b)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.ModalDialogRequest",function(d,c,b,a){this._title=d?d:"Untitled";this._message=c?c:"Lorem ipsum";this._buttons=b?b:{};this._parent=parent?parent:jQuery("#mapdiv");this._onshow=a?a:null},{__name:"userinterface.ModalDialogRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getMessage:function(){return this._message},getButtons:function(){return this._buttons},getGeom:function(){return this._geom},getParent:function(){return this._parent},getOnShow:function(){return this._onshow}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",function(a){this._ui=a;this._tpl={};this._tpl.modal=jQuery('<div id="modaldialog" class="modaldialog">  <div class="modaltitle"></div>  <div class="modalmessage"></div>  <div class="modalbuttons"></div> </div>');this._tpl.button=jQuery('<div class="modalbutton"><input type="button" /></input></div>');this._buttons={};this._args={closeClass:"modalclose",overlayId:"modaloverlay",overlayCss:{"background-color":"lightgrey",cursor:"wait"},containerId:"modalcontainer",containerCss:{"background-color":"white"},onClose:function(){this.close()},zIndex:80130}},{handleRequest:function(c,d){var h=this._tpl.modal.clone();h.find(".modaltitle").append(d.getTitle());h.find(".modalmessage").append(d.getMessage());var e=d.getButtons();var i=h.find(".modalbuttons");for(var b in e){if(!e[b].name){continue}var a=e[b];var g=this._tpl.button.clone();var f=g.find("input");f.attr("name",a.name);f.attr("text",a.text);f.attr("value",a.text);f.bind("click",a.onclick);if(a.close!==false){f.addClass(this._args.closeClass)}i.append(g)}if(d.onshow){this._args.onShow=onshow}$.modal=h.modal(this._args)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.event.ExtensionUpdatedEvent",function(c,a,b){this._creator=null;this._extension=c;this.viewstate=a;this.viewinfo=b},{__name:"userinterface.ExtensionUpdatedEvent",getName:function(){return this.__name},getExtension:function(){return this._extension},getViewState:function(){return this.viewstate},setViewState:function(a){this.viewstate=a},getViewInfo:function(){return this.viewinfo},setViewInfo:function(a){this.viewinfo=a}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.userinterface.component.Accordion",function(){this.template=jQuery('<div class="accordion"></div>');this.panels=[];this.ui=this.template.clone()},{addPanel:function(a){this.panels.push(a);a.insertTo(this.ui)},removePanel:function(c){var a=null;for(var b=0;b<this.panels.length;b++){if(this.panels[b]===c){a=this.panels[b];this.panels.splice(b,1);break}}if(a){a.destroy();return true}return false},insertTo:function(a){a.append(this.ui)}});Oskari.clazz.define("Oskari.userinterface.component.AccordionPanel",function(){this.template=jQuery('<div class="accordion_panel"><div class="header"></div><div class="content"></div></div>');this.title=null;this.content=null;
this.html=this.template.clone();var a=this.html.find("div.header");a.click(function(){var c=jQuery(this).parent();var b=c.hasClass("open");if(b){c.removeClass("open");c.find("div.content").hide()}else{c.addClass("open");c.find("div.content").show()}});this.html.find("div.content").hide()},{setTitle:function(a){this.title=a;var b=this.html.find("div.header");b.append(this.title)},setContent:function(b){this.content=b;var a=this.html.find("div.content");a.append(this.content)},destroy:function(){this.html.remove()},getContainer:function(){return this.html.find("div.content")},insertTo:function(a){a.append(this.html)}});Oskari.clazz.define("Oskari.userinterface.component.Badge",function(){this.compiledTemplates={};this.compileTemplates();this.ui=null;this.container=null},{templates:{"default":'<span class="oskari-badge"></span>',success:'<span class="oskari-badge oskari-badge-success"></span>',warning:'<span class="oskari-badge oskari-badge-warning"></span>',important:'<span class="oskari-badge oskari-badge-important"></span>',info:'<span class="oskari-badge oskari-badge-info"></span>',success:'<span class="oskari-badge oskari-badge-inverse"></span>'},compileTemplates:function(){for(var a in this.templates){this.compiledTemplates[a]=jQuery(this.templates[a])}},insertTo:function(a){this.container=a},setContent:function(b,a){if(this.ui){this.ui.remove();this.ui=null}var c=this.compiledTemplates[a||"default"].clone();c.append(b);this.container.append(c);this.ui=c},hide:function(){if(this.ui){this.ui.remove();this.ui=null}}});Oskari.clazz.define("Oskari.userinterface.component.Alert",function(){this.compiledTemplates={};this.compileTemplates();this.ui=null;this.container=null},{templates:{"default":'<div class="oskari-alert"><div class="oskari-alert-icon-close"></div></div>',success:'<div class="oskari-alert oskari-alert-success"><div class="oskari-alert-icon-close"></div></div>',error:'<div class="oskari-alert oskari-alert-error"><div class="oskari-alert-icon-close"></div></div>',info:'<div class="oskari-alert oskari-alert-info"><div class="oskari-alert-icon-close"></div></div>'},compileTemplates:function(){for(var a in this.templates){this.compiledTemplates[a]=jQuery(this.templates[a])}},insertTo:function(a){this.container=a},setContent:function(d,a){if(this.ui){this.ui.remove();this.ui=null}var b=this.compiledTemplates[a||"default"].clone();b.append(d);this.container.prepend(b);this.ui=b;var c=this;b.children(".oskari-alert-icon-close").click(function(){c.hide()})},hide:function(){if(this.ui){this.ui.remove();this.ui=null}}});!function(c){var b=function(e,d){this.init("oskariTooltip",e,d)};b.prototype={constructor:b,init:function(g,f,e){var h,d;this.type=g;this.$element=c(f);this.options=this.getOptions(e);this.enabled=true;if(this.options.trigger!="manual"){h=this.options.trigger=="hover"?"mouseenter":"focus";d=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(h,this.options.selector,c.proxy(this.enter,this));this.$element.on(d,this.options.selector,c.proxy(this.leave,this))}this.options.selector?(this._options=c.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(d){d=c.extend({},c.fn[this.type].defaults,d,this.$element.data());if(d.delay&&typeof d.delay=="number"){d.delay={show:d.delay,hide:d.delay}}return d},enter:function(f){var d=c(f.currentTarget)[this.type](this._options).data(this.type);if(!d.options.delay||!d.options.delay.show){return d.show()}clearTimeout(this.timeout);d.hoverState="in";this.timeout=setTimeout(function(){if(d.hoverState=="in"){d.show()}},d.options.delay.show)},leave:function(f){var d=c(f.currentTarget)[this.type](this._options).data(this.type);if(!d.options.delay||!d.options.delay.hide){return d.hide()}clearTimeout(this.timeout);d.hoverState="out";this.timeout=setTimeout(function(){if(d.hoverState=="out"){d.hide()}},d.options.delay.hide)},show:function(){var h,d,j,f,i,e,g;if(this.hasContent()&&this.enabled){h=this.tip();this.setContent();if(this.options.animation){h.addClass("fade")}e=this.options.placement.apply(this.options.scope);d=/in/.test(e);
h.remove().css({top:0,left:0,display:"block"}).appendTo(d?this.$element:document.body);j=this.getPosition(d);f=h[0].offsetWidth;i=h[0].offsetHeight;switch(d?e.split(" ")[1]:e){case"bottom":g={top:j.top+j.height,left:j.left+j.width/2-f/2};break;case"top":g={top:j.top-i,left:j.left+j.width/2-f/2};break;case"left":g={top:j.top+j.height/2-i/2,left:j.left-f};break;case"right":g={top:j.top+j.height/2-i/2,left:j.left+j.width};break}h.css(g).addClass(e).addClass("in")}},isHTML:function(d){return typeof d!="string"||(d.charAt(0)==="<"&&d.charAt(d.length-1)===">"&&d.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(d)},setContent:function(){var e=this.tip(),d=this.getTitle();e.find(".oskari-tooltip-inner")[this.isHTML(d)?"html":"text"](d);e.removeClass("fade in top bottom left right")},hide:function(){var d=this,e=this.tip();e.removeClass("in");function f(){var g=setTimeout(function(){e.off(c.support.transition.end).remove()},500);e.one(c.support.transition.end,function(){clearTimeout(g);e.remove()})}c.support.transition&&this.$tip.hasClass("fade")?f():e.remove()},fixTitle:function(){var d=this.$element;if(d.attr("title")||typeof(d.attr("data-original-title"))!="string"){d.attr("data-original-title",d.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(d){return c.extend({},(d?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){return this.options.title.apply(this.options.scope)},tip:function(){return this.$tip=this.$tip||c(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},attach:function(d){this.$element=d}};c.fn.oskariTooltip=function(d){return this.each(function(){var g=c(this),f=g.data("oskariTooltip"),e=typeof d=="object"&&d;if(!f){g.data("oskariTooltip",(f=new b(this,e)))}if(typeof d=="string"){f[d]()}})};c.fn.oskariTooltip.Constructor=b;c.fn.oskariTooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="oskari-tooltip"><div class="oskari-tooltip-arrow"></div><div class="oskari-tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0};var a=function(e,d){this.init("oskariPopover",e,d)};a.prototype=c.extend({},c.fn.oskariTooltip.Constructor.prototype,{constructor:a,setContent:function(){var f=this.tip(),e=this.getTitle(),d=this.getContent();f.find(".oskari-popover-title")[this.isHTML(e)?"html":"text"](e);f.find(".oskari-popover-content > *")[this.isHTML(d)?"html":"text"](d);f.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){return this.options.content.apply(this.options.scope)},tip:function(){if(!this.$tip){this.$tip=c(this.options.template)}return this.$tip}});c.fn.oskariPopover=function(d){return this.each(function(){var g=c(this),f=g.data("oskariPopover"),e=typeof d=="object"&&d;if(!f){g.data("oskariPopover",(f=new a(this,e)))}if(typeof d=="string"){f[d]()}})};c.fn.oskariPopover.Constructor=a;c.fn.oskariPopover.defaults=c.extend({},c.fn.oskariTooltip.defaults,{placement:"right",content:"",template:'<div class="oskari-popover"><div class="oskari-arrow"></div><div class="oskari-popover-inner"><h3 class="oskari-popover-title"></h3><div class="oskari-popover-content"><p></p></div></div></div>'});Oskari.clazz.define("Oskari.userinterface.component.Popover",function(e,d){this.title=e;this.content=d;this.$container=null;this.data=null;this.shown=false;this.placement="bottom"},{templates:{container:'<div class="oskari-popover-container"/>'},hide:function(){if(!this.shown){return}this.shown=false;if(!this.data){return}this.data.hide()},show:function(){if(this.shown){return}if(!this.data){return}this.data.show();this.shown=true},attachTo:function(d){var e=this;this.$container=c(d);if(!this.data){this.data=new a(d,{scope:e,title:e.getTitle,content:e.getContent,trigger:"manual",placement:e.getPlacement,})
}else{this.data.attach(this.$container)}this.$container.data("oskariPopover",this.data)},getTitle:function(){return this.title},getContent:function(){return this.content},setContent:function(d,e){this.hide();this.content=d;if(e){this.title=e}this.show()},setTitle:function(e,d){this.hide();this.title=e;if(d){this.content=d}this.show()},setPlacement:function(d){this.placement=d},getPlacement:function(){return this.placement}})}(window.jQuery);/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance",function(){this.sandbox=null;this.started=false;this.buttons={};this.selectedButton=null;this.container=null},{__name:"Toolbar",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var b=this;if(b.started){return}b.started=true;var a=Oskari.$("sandbox");a.register(b);b.setSandbox(a);this.container=jQuery("#toolbar");for(var c in b.eventHandlers){if(c){a.registerForEventByName(b,c)}}a.addRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);a.addRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);a.addRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler);a.registerAsStateful(this.mediator.bundleId,this);if(this._addDefaultButtons){this._addDefaultButtons()}},init:function(){var a=this;this.templateGroup=jQuery('<div class="toolrow"></div>');this.templateTool=jQuery('<div class="tool"></div>');this.requestHandlers={toolButtonRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",a)}},getToolbarContainer:function(){return this.container},onEvent:function(c){var b=this;var a=b.eventHandlers[c.getName()];if(!a){return}return a.apply(this,[c])},eventHandlers:{},stop:function(){var b=this;var a=b.sandbox();for(var c in b.eventHandlers){if(c){a.unregisterFromEventByName(b,c)}}this.sandbox.unregisterStateful(this.mediator.bundleId);b.sandbox.unregister(b);b.started=false},setState:function(d){if(!d){return}if(d.selected){this.selectedButton=d.selected;var a=d.selected.id;var f=d.selected.group;var c=this.getToolbarContainer();this._removeToolSelections();var e=c.find("div.toolrow[tbgroup="+f+"]");if(e.length>0){var b=e.find("div.tool[tool="+a+"]");if(b.length>0){b.addClass("selected");this.buttons[f][a].callback()}}}else{this.selectedButton=null}},getState:function(){var a={};if(this.selectedButton){a.selected=this.selectedButton}return a}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","button-methods",{addToolButton:function(c,a,g){if(!c||!a||!g||!g.callback){return}var e=this;var d=this.getToolbarContainer();var f=null;if(!this.buttons[a]){this.buttons[a]={};f=this.templateGroup.clone();f.attr("tbgroup",a);d.append(f)}else{f=d.find("div.toolrow[tbgroup="+a+"]")}if(this.buttons[a][c]){return}this.buttons[a][c]=g;var b=this.templateTool.clone();b.attr("tool",c);b.attr("title",g.tooltip);b.addClass(g.iconCls);if(this.selectedButton){if(this.selectedButton.id==c&&this.selectedButton.group==a){b.addClass("selected");g.callback()}}else{if(g.selected){b.addClass("selected");e.selectedButton={id:c,group:a}}}b.bind("click",function(h){if(e.buttons[a][c].enabled==false){return}if(g.sticky==true){e._removeToolSelections();b.addClass("selected");e.selectedButton={id:c,group:a}}g.callback()});f.append(b)},_removeToolSelections:function(){var a=this.getToolbarContainer();var b=a.find("div.tool");b.removeClass("selected")},removeToolButton:function(c,a){if(!a){return}if(this.buttons[a]){var d=this.getToolbarContainer();var e=d.find("div.toolrow[tbgroup="+a+"]");if(c){var b=e.find("div.tool[tool="+c+"]");b.remove();this.buttons[a][c]=null;delete this.buttons[a][c]}else{e.remove();this.buttons[a]=null;delete this.buttons[a]}}},changeToolButtonState:function(f,d,c){if(!d){return}if(this.buttons[d]){var g=this.getToolbarContainer();var i=g.find("div.toolrow[tbgroup="+d+"]");if(f){var e=i.find("div.tool[tool="+f+"]");this.buttons[d][f].enabled=c;if(c){e.removeClass("disabled")}else{e.addClass("disabled")}}else{var h=i.find("div.tool");if(c){h.removeClass("disabled")}else{h.addClass("disabled")}for(var a in this.buttons[d]){this.buttons[d][a].enabled=c}}}}});Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","default-buttons",{_addDefaultButtons:function(){var b=this;
var a=this.getSandbox().getRequestBuilder("ToolSelectionRequest");this.addToolButton("reset","history",{iconCls:"tool-reset",tooltip:"Paluu aloitusn√§kym√§√§n",sticky:false,callback:function(){var d=b.getSandbox().getRequestBuilder("StateHandler.SetStateRequest");if(d){b.getSandbox().request(b,d())}var c=b.getSandbox().getRequestBuilder("ClearHistoryRequest")();b.getSandbox().request(b,c)}});this.addToolButton("history_back","history",{iconCls:"tool-history-back",tooltip:"Taaksep√§in historiassa",sticky:false,callback:function(){b.getSandbox().request(b,a("map_control_tool_prev"))}});this.addToolButton("history_forward","history",{iconCls:"tool-history-forward",tooltip:"Eteenp√§in historiassa",sticky:false,callback:function(){b.getSandbox().request(b,a("map_control_tool_next"))}});this.addToolButton("zoombox","basictools",{iconCls:"tool-zoombox",tooltip:"Zoom",sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_zoom_tool"))}});this.addToolButton("select","basictools",{iconCls:"tool-pan",tooltip:"Pan",selected:true,sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_navigate_tool"))}});this.addToolButton("measureline","measuretools",{iconCls:"tool-measure-line",tooltip:"Measure line",sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_measure_tool"))}});this.addToolButton("measurearea","measuretools",{iconCls:"tool-measure-area",tooltip:"Measure area",sticky:true,callback:function(){b.getSandbox().request(b,a("map_control_measure_area_tool"))}})}});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.AddToolButtonRequest",function(c,b,a){this._id=c;this._group=b;this._config=a},{__name:"Toolbar.AddToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getConfig:function(){return this._config}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.RemoveToolButtonRequest",function(b,a){this._id=b;this._group=a},{__name:"Toolbar.RemoveToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonStateRequest",function(c,b,a){this._id=c;this._group=b;this._state=(a==true)},{__name:"Toolbar.ToolButtonStateRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",function(a){this._toolbar=a},{handleRequest:function(b,c){var a=b.getSandbox();if(c.getName()=="Toolbar.AddToolButtonRequest"){this._handleAdd(a,c)}else{if(c.getName()=="Toolbar.RemoveToolButtonRequest"){this._handleRemove(a,c)}else{if(c.getName()=="Toolbar.ToolButtonStateRequest"){this._handleState(a,c)}}}},_handleAdd:function(a,b){this._toolbar.addToolButton(b.getId(),b.getGroup(),b.getConfig())},_handleRemove:function(a,b){this._toolbar.removeToolButton(b.getId(),b.getGroup())},_handleState:function(a,b){this._toolbar.changeToolButtonState(b.getId(),b.getGroup(),b.getState())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(e){var i=[],f=e(document),c=e.browser.msie&&parseInt(e.browser.version)===6&&typeof window.XMLHttpRequest!=="object",b=e.browser.msie&&parseInt(e.browser.version)===7,h=null,g=e(window),a=[];e.modal=function(j,d){return e.modal.impl.init(j,d)};e.modal.close=function(){e.modal.impl.close()};e.modal.focus=function(d){e.modal.impl.focus(d)};e.modal.setContainerDimensions=function(){e.modal.impl.setContainerDimensions()};e.modal.setPosition=function(){e.modal.impl.setPosition()};e.modal.update=function(d,j){e.modal.impl.update(d,j)};e.fn.modal=function(d){return e.modal.impl.init(this,d)};e.modal.defaults={appendTo:"body",focus:true,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:false,autoPosition:true,zIndex:1000,close:true,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:true,overlayClose:false,fixed:true,position:null,persist:false,modal:true,onOpen:null,onShow:null,onClose:null};e.modal.impl={d:{},init:function(k,d){var j=this;if(j.d.data){return false}h=e.browser.msie&&!e.boxModel;j.o=e.extend({},e.modal.defaults,d);j.zIndex=j.o.zIndex;j.occb=false;if(typeof k==="object"){k=k instanceof jQuery?k:e(k);j.d.placeholder=false;if(k.parent().parent().size()>0){k.before(e("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"}));j.d.placeholder=true;j.display=k.css("display");if(!j.o.persist){j.d.orig=k.clone(true)}}}else{if(typeof k==="string"||typeof k==="number"){k=e("<div></div>").html(k)}else{alert("SimpleModal Error: Unsupported data type: "+typeof k);return j}}j.create(k);k=null;j.open();if(e.isFunction(j.o.onShow)){j.o.onShow.apply(j,[j.d])}return j},create:function(j){var d=this;d.getDimensions();if(d.o.modal&&c){d.d.iframe=e('<iframe src="javascript:false;"></iframe>').css(e.extend(d.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:a[0],width:a[1],zIndex:d.o.zIndex,top:0,left:0})).appendTo(d.o.appendTo)}d.d.overlay=e("<div></div>").attr("id",d.o.overlayId).addClass("simplemodal-overlay").css(e.extend(d.o.overlayCss,{display:"none",opacity:d.o.opacity/100,height:d.o.modal?i[0]:0,width:d.o.modal?i[1]:0,position:"fixed",left:0,top:0,zIndex:d.o.zIndex+1})).appendTo(d.o.appendTo);d.d.container=e("<div></div>").attr("id",d.o.containerId).addClass("simplemodal-container").css(e.extend({position:d.o.fixed?"fixed":"absolute"},d.o.containerCss,{display:"none",zIndex:d.o.zIndex+2})).append(d.o.close&&d.o.closeHTML?e(d.o.closeHTML).addClass(d.o.closeClass):"").appendTo(d.o.appendTo);d.d.wrap=e("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(d.d.container);d.d.data=j.attr("id",j.attr("id")||d.o.dataId).addClass("simplemodal-data").css(e.extend(d.o.dataCss,{display:"none"})).appendTo("body");j=null;d.setContainerDimensions();d.d.data.appendTo(d.d.wrap);if(c||h){d.fixIE()}},bindEvents:function(){var d=this;e("."+d.o.closeClass).bind("click.simplemodal",function(j){j.preventDefault();d.close()});if(d.o.modal&&d.o.close&&d.o.overlayClose){d.d.overlay.bind("click.simplemodal",function(j){j.preventDefault();d.close()})}f.bind("keydown.simplemodal",function(j){if(d.o.modal&&j.keyCode===9){d.watchTab(j)}else{if((d.o.close&&d.o.escClose)&&j.keyCode===27){j.preventDefault();d.close()}}});g.bind("resize.simplemodal orientationchange.simplemodal",function(){d.getDimensions();d.o.autoResize?d.setContainerDimensions():d.o.autoPosition&&d.setPosition();if(c||h){d.fixIE()}else{if(d.o.modal){d.d.iframe&&d.d.iframe.css({height:a[0],width:a[1]});d.d.overlay.css({height:i[0],width:i[1]})}}})},unbindEvents:function(){e("."+this.o.closeClass).unbind("click.simplemodal");f.unbind("keydown.simplemodal");g.unbind(".simplemodal");this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var d=this,j=d.o.position;e.each([d.d.iframe||null,!d.o.modal?null:d.d.overlay,d.d.container.css("position")==="fixed"?d.d.container:null],function(w,n){if(n){var u="document.body.clientHeight",y="document.body.clientWidth",A="document.body.scrollHeight",x="document.body.scrollLeft",r="document.body.scrollTop",m="document.body.scrollWidth",l="document.documentElement.clientHeight",v="document.documentElement.clientWidth",t="document.documentElement.scrollLeft",B="document.documentElement.scrollTop",C=n[0].style;
C.position="absolute";if(w<2){C.removeExpression("height");C.removeExpression("width");C.setExpression("height",""+A+" > "+u+" ? "+A+" : "+u+' + "px"');C.setExpression("width",""+m+" > "+y+" ? "+m+" : "+y+' + "px"')}else{var q,k;if(j&&j.constructor===Array){var z=j[0]?typeof j[0]==="number"?j[0].toString():j[0].replace(/px/,""):n.css("top").replace(/px/,"");q=z.indexOf("%")===-1?z+" + (t = "+B+" ? "+B+" : "+r+') + "px"':parseInt(z.replace(/%/,""))+" * (("+l+" || "+u+") / 100) + (t = "+B+" ? "+B+" : "+r+') + "px"';if(j[1]){var o=typeof j[1]==="number"?j[1].toString():j[1].replace(/px/,"");k=o.indexOf("%")===-1?o+" + (t = "+t+" ? "+t+" : "+x+') + "px"':parseInt(o.replace(/%/,""))+" * (("+v+" || "+y+") / 100) + (t = "+t+" ? "+t+" : "+x+') + "px"'}}else{q="("+l+" || "+u+") / 2 - (this.offsetHeight / 2) + (t = "+B+" ? "+B+" : "+r+') + "px"';k="("+v+" || "+y+") / 2 - (this.offsetWidth / 2) + (t = "+t+" ? "+t+" : "+x+') + "px"'}C.removeExpression("top");C.removeExpression("left");C.setExpression("top",q);C.setExpression("left",k)}}})},focus:function(l){var j=this,k=l&&e.inArray(l,["first","last"])!==-1?l:"first";var d=e(":input:enabled:visible:"+k,j.d.wrap);setTimeout(function(){d.length>0?d.focus():j.d.wrap.focus()},10)},getDimensions:function(){var j=this,d=e.browser.opera&&e.browser.version>"9.5"&&e.fn.jquery<"1.3"||e.browser.opera&&e.browser.version<"9.5"&&e.fn.jquery>"1.2.6"?g[0].innerHeight:g.height();i=[f.height(),f.width()];a=[d,g.width()]},getVal:function(j,k){return j?(typeof j==="number"?j:j==="auto"?0:j.indexOf("%")>0?((parseInt(j.replace(/%/,""))/100)*(k==="h"?a[0]:a[1])):parseInt(j.replace(/px/,""))):null},update:function(d,k){var j=this;if(!j.d.data){return false}j.d.origHeight=j.getVal(d,"h");j.d.origWidth=j.getVal(k,"w");j.d.data.hide();d&&j.d.container.css("height",d);k&&j.d.container.css("width",k);j.setContainerDimensions();j.d.data.show();j.o.focus&&j.focus();j.unbindEvents();j.bindEvents()},setContainerDimensions:function(){var v=this,l=c||b;var d=v.d.origHeight?v.d.origHeight:e.browser.opera?v.d.container.height():v.getVal(l?v.d.container[0].currentStyle.height:v.d.container.css("height"),"h"),k=v.d.origWidth?v.d.origWidth:e.browser.opera?v.d.container.width():v.getVal(l?v.d.container[0].currentStyle.width:v.d.container.css("width"),"w"),q=v.d.data.outerHeight(true),j=v.d.data.outerWidth(true);v.d.origHeight=v.d.origHeight||d;v.d.origWidth=v.d.origWidth||k;var m=v.o.maxHeight?v.getVal(v.o.maxHeight,"h"):null,r=v.o.maxWidth?v.getVal(v.o.maxWidth,"w"):null,o=m&&m<a[0]?m:a[0],u=r&&r<a[1]?r:a[1];var n=v.o.minHeight?v.getVal(v.o.minHeight,"h"):"auto";if(!d){if(!q){d=n}else{if(q>o){d=o}else{if(v.o.minHeight&&n!=="auto"&&q<n){d=n}else{d=q}}}}else{d=v.o.autoResize&&d>o?o:d<n?n:d}var t=v.o.minWidth?v.getVal(v.o.minWidth,"w"):"auto";if(!k){if(!j){k=t}else{if(j>u){k=u}else{if(v.o.minWidth&&t!=="auto"&&j<t){k=t}else{k=j}}}}else{k=v.o.autoResize&&k>u?u:k<t?t:k}v.d.container.css({height:d,width:k});v.d.wrap.css({overflow:(q>d||j>k)?"auto":"visible"});v.o.autoPosition&&v.setPosition()},setPosition:function(){var k=this,m,l,n=(a[0]/2)-(k.d.container.outerHeight(true)/2),j=(a[1]/2)-(k.d.container.outerWidth(true)/2),d=k.d.container.css("position")!=="fixed"?g.scrollTop():0;if(k.o.position&&Object.prototype.toString.call(k.o.position)==="[object Array]"){m=d+(k.o.position[0]||n);l=k.o.position[1]||j}else{m=d+n;l=j}k.d.container.css({left:l,top:m})},watchTab:function(j){var d=this;if(e(j.target).parents(".simplemodal-container").length>0){d.inputs=e(":input:enabled:visible:first, :input:enabled:visible:last",d.d.data[0]);if((!j.shiftKey&&j.target===d.inputs[d.inputs.length-1])||(j.shiftKey&&j.target===d.inputs[0])||d.inputs.length===0){j.preventDefault();var k=j.shiftKey?"last":"first";d.focus(k)}}else{j.preventDefault();d.focus()}},open:function(){var d=this;d.d.iframe&&d.d.iframe.show();if(e.isFunction(d.o.onOpen)){d.o.onOpen.apply(d,[d.d])}else{d.d.overlay.show();d.d.container.show();d.d.data.show()}d.o.focus&&d.focus();d.bindEvents()},close:function(){var d=this;if(!d.d.data){return false}d.unbindEvents();if(e.isFunction(d.o.onClose)&&!d.occb){d.occb=true;
d.o.onClose.apply(d,[d.d])}else{if(d.d.placeholder){var j=e("#simplemodal-placeholder");if(d.o.persist){j.replaceWith(d.d.data.removeClass("simplemodal-data").css("display",d.display))}else{d.d.data.hide().remove();j.replaceWith(d.d.orig)}}else{d.d.data.hide().remove()}d.d.container.hide().remove();d.d.overlay.hide();d.d.iframe&&d.d.iframe.hide().remove();d.d.overlay.remove();d.d={}}}}}));Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance",function(){this._localization=null;this._pluginInstances={};this._startupState=null;this._historyPollingInterval=1500;this._historyTimer=null;this._historyPrevious=[];this._historyEnabled=true;this._historyNext=[];this._currentViewId=1},{__name:"StateHandler",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}var b="/web/fi/kartta?p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=1&p_p_state=exclusive&p_p_mode=view&p_p_col_id=column-1&p_p_col_count=1&_Portti2Map_WAR_portti2mapportlet_fi.mml.baseportlet.CMD=ajax.jsp&";var d=Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",b);this.registerPlugin(d);this.startPlugin(d);a.addRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler);a.addRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler)},update:function(){},stop:function(){var a=this.sandbox();a.removeRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler);a.removeRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler);var b=a.getRequestBuilder("MapControls.ToolButtonRequest");if(b){a.request(this,b(this.toolbar.config,"remove"))}for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}this.sandbox.unregister(this);this.started=false},init:function(){var b=this;this.toolbar={config:{group:this.getName(),toolId:"statehandler.reset",iconCls:"statehandler_reset_tool",tooltip:this.getLocalization("reset"),callback:function(){b.resetState()}}};var a=Oskari.$("sandbox");this.requestHandlers={setStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",a,this),saveStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",a,this)};return null},getLocalization:function(a){if(!this._localization){this._localization=Oskari.getLocalization(this.getName())}if(a){return this._localization[a]}return this._localization},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapMoveEvent:function(b){var a=this;if(this._historyEnabled===true){if(this._historyTimer){clearTimeout(this._historyTimer);this._historyTimer=null}this._historyTimer=setTimeout(function(){var d=a.sandbox.getStatefulComponents()["mapfull"];if(d){var c=d.getState();a._historyPrevious.push(c)}},this._historyPollingInterval)}}},historyMoveNext:function(){if(this._historyNext.length>0){var a=this._historyNext.pop();this._historyPrevious.push(a);var b=this.sandbox.getStatefulComponents()["mapfull"];if(b){this._historyEnabled=false;b.setState(a);this._historyEnabled=true}}},historyMovePrevious:function(){if(this._historyPrevious.length>0){var a=this._historyPrevious.pop();this._historyNext.push(a);var b=this.sandbox.getStatefulComponents()["mapfull"];if(b){this._historyEnabled=false;b.setState(a);this._historyEnabled=true}}},registerPlugin:function(a){a.setHandler(this);var b=a.getName();this.sandbox.printDebug("["+this.getName()+"] Registering "+b);this._pluginInstances[b]=a},unregisterPlugin:function(a){var b=a.getName();this.sandbox.printDebug("["+this.getName()+"] Unregistering "+b);this._pluginInstances[b]=undefined;a.setHandler(null)},startPlugin:function(a){var b=a.getName();this.sandbox.printDebug("["+this.getName()+"] Starting "+b);a.startPlugin(this.sandbox)
},stopPlugin:function(a){var b=a.getName();this.sandbox.printDebug("["+this.getName()+"] Starting "+b);a.stopPlugin(this.sandbox)},setCurrentViewId:function(a){this._currentViewId=a},getCurrentViewId:function(){return this._currentViewId}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});Oskari.clazz.category("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance","state-methods",{useState:function(c){if(!c){return}var b=this.sandbox.getStatefulComponents();var a=[];for(var d in c){if(b[d]){b[d].setState(c[d].state)}a.push(d)}return a},resetState:function(){for(var b in this._pluginInstances){this.sandbox.printDebug("["+this.getName()+"] resetting state on "+b);this._pluginInstances[b].resetState()}var a=this;if(this._startupState){a._resetComponentsWithNoStateData(a.useState(this._startupState))}else{jQuery.ajax({dataType:"json",type:"GET",url:a.sandbox.getAjaxUrl()+"action_route=GetMapConfiguration&noSavedState=true",success:function(c){a._startupState=c;a._resetComponentsWithNoStateData(a.useState(c))},error:function(){alert("error loading conf")}})}},_resetComponentsWithNoStateData:function(a){var c=this.sandbox.getStatefulComponents();for(var e in c){var d=false;for(var b=0;b<a.length;++b){if(e==a[b]){d=true;break}}if(!d){c[e].setState()}}},saveState:function(a){if(!a){for(var a in this._pluginInstances){this.saveState(a)}return}this.sandbox.printDebug("["+this.getName()+"] saving state with "+a);this._pluginInstances[a].saveState()},getCurrentState:function(){var b={};var a=this.sandbox.getStatefulComponents();for(var c in a){b[c]={state:a[c].getState()}}return b},getSavedState:function(a){return this._pluginInstances[a].getState()}});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.Plugin",function(){throw"Oskari.mapframework.bundle.statehandler.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setHandler:function(a){throw"Implement your own"},startPlugin:function(a){throw"Implement your own"},stopPlugin:function(a){throw"Implement your own"},getState:function(){throw"Implement your own"},resetState:function(){throw"Implement your own"},saveState:function(a){throw"Implement your own"}});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",function(a){this.handler=null;this.pluginName=null;this._sandbox=null;this._ajaxUrl=a},{__name:"statehandler.SaveViewPlugin",getName:function(){return this.pluginName},getHandler:function(){return this.handler},setHandler:function(a){this.handler=a;this.pluginName=a.getName()+this.__name},getState:function(){},resetState:function(){},saveState:function(){var a=this.handler.getCurrentState();var g=this;var e=this.handler.getLocalization("save");var i=e.title?e.title.save_view:"N√§kym√§n tallennus";var b=e.msg?e.msg.view_name:"N√§kym√§n nimi";var b='<div class="e_noname" style="display: inline-block; color: red; display: none;"><br />'+(e.error_noname?e.error_noname:"Nimi ei voi olla tyhj√§!")+'<br /></div><div class="e_illegal" style="display: inline-block; color: red; display: none;"><br />'+(e.error_illegalchars?e.error_illegalchars:"Nimess√§ on virheellisi√§ merkkej√§")+"<br /></div>"+b+': <input name="viewName" type="text" class="viewName" />';var f={name:"button_save",text:e.button?e.button.save:"Tallenna",close:false,onclick:function(k){var l=jQuery("div.modalmessage input.viewName").val();if(l){if(l.indexOf("<")>=0){jQuery("div.modalmessage div.e_illegal").show()}else{g._saveState(l);$.modal.close()}}else{jQuery("div.modalmessage div.e_noname").show()}}};var j={name:"button_cancel",text:e.button?e.button.cancel:"Peruuta",close:true};var d="userinterface.ModalDialogRequest";var c=g._sandbox.getRequestBuilder(d);var h=c(i,b,[f,j]);g._sandbox.request(g.handler,h)},_saveState:function(e){var c=this.handler.getCurrentState();var a="";if(e){a="myViewName="+e+"&"}var b=this;var d=this.handler.getLocalization("save");jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(f){if(f&&f.overrideMimeType){f.overrideMimeType("application/j-son;charset=UTF-8")}},url:this._ajaxUrl+"action_route=AddView",data:a+"myViewState="+b.serializeJSON(c)+"currentViewId="+b.handler.getCurrentViewId(),success:function(h){alert(d.success);
var f=b._sandbox.getEventBuilder("StateSavedEvent");var g=f(e,c);b._sandbox.notifyAll(g);b.handler.setCurrentViewId(h.id)},error:function(){if(e){alert(d.error);var f=b._sandbox.getEventBuilder("StateSavedEvent");var g=f(e,c);b._sandbox.notifyAll(g)}}})},serializeJSON:function(e){var d=this;var c=typeof(e);if(c!="object"||e===null){if(c=="string"){e='"'+e+'"'}return String(e)}else{var b=[],a=(e&&e.constructor==Array);jQuery.each(e,function(g,f){c=typeof(f);if(c=="string"){f='"'+f+'"'}else{if(c=="object"&f!==null){f=d.serializeJSON(f)}}b.push((a?"":'"'+g+'":')+String(f))});return(a?"[":"{")+String(b)+(a?"]":"}")}},startPlugin:function(a){this._sandbox=a;var b=this;jQuery(document).ready(function(){window.onbeforeunload=function(){b._saveState()}})},stopPlugin:function(a){this._sandbox=null}},{protocol:["Oskari.mapframework.bundle.statehandler.plugin.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequest",function(a){this._creator=null;this._state=a;this._currentViewId=1},{__name:"StateHandler.SetStateRequest",getName:function(){return this.__name},getState:function(){return this._state},getCurrentViewId:function(){return this._currentViewId},setCurrentViewId:function(a){this.currentViewId=a}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",function(b,a){this.sandbox=b;this.statehandler=a},{handleRequest:function(a,b){if(b.getState()){this.statehandler.setCurrentViewId(b.getCurrentViewId());this.statehandler.useState(b.getState())}else{this.statehandler.resetState()}}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.event.StateSavedEvent",function(a,b){this._name=a;this._state=b},{__name:"StateSavedEvent",getName:function(){return this.__name},getViewName:function(){return this._name},getState:function(){return this._state}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequest",function(){this._creator=null},{__name:"StateHandler.SaveStateRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",function(b,a){this.sandbox=b;this.statehandler=a},{handleRequest:function(a,b){this.statehandler.saveState()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.framework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance",function(){this.sandbox=null;this.started=false;this.plugins={};this.yuilibrary=null;this.mediator=null},{__name:"coordinatedisplay",getName:function(){var a=this;return a.__name},__title:"Coordinate Display",getTitle:function(){var a=this;return a.__title},__description:"Coordinate Display",getDescription:function(){var a=this;return a.__description},setSandbox:function(a){var b=this;b.sandbox=a},getSandbox:function(){var a=this;return a.sandbox},update:function(){var a=this},startExtension:function(){var b=this;var a=Oskari.clazz.create("Oskari.framework.bundle.coordinatedisplay.CoordinateDisplayDiv",b);a.setParent(jQuery("#mapdiv"));b.plugins["Oskari.userinterface.SimpleDiv"]=a},stopExtension:function(){var a=this;for(var b in a.plugins){if(b){a.plugins[b]=null}}},getPlugins:function(){var a=this;return a.plugins},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");a.register(c);c.setSandbox(a);for(var d in c.eventHandlers){if(d){a.registerForEventByName(c,d)}}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.mediator.bundle.require(function(){c.draw()})},init:function(){var a=this;return null},onEvent:function(c){var b=this;var a=b.eventHandlers[c.getName()];if(!a){return}return a.apply(this,[c])},eventHandlers:{MouseHoverEvent:function(b){var a=this;a.plugins["Oskari.userinterface.SimpleDiv"].refresh({latlon:{lat:Math.floor(b.getLat()),lon:Math.floor(b.getLon())}})}},stop:function(){var c=this;var a=c.sandbox();for(var d in c.eventHandlers){if(d){a.unregisterFromEventByName(c,d)}}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(c);a.request(c,b);c.sandbox.unregister(c);c.started=false},draw:function(){var a=this;for(var b in a.plugins){if(b){a.plugins[b].draw()}}}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.framework.bundle.coordinatedisplay.CoordinateDisplayDiv",function(){this.__parent=null;this.__elements={};this.__templates={};this.__templates.latlondiv=jQuery('<div class="cbDiv"> <div class="cbSpansWrapper"> <div class="cbRow">  <span class="cbLabel" axis="lat">N: </span>  <span class="cbValue" axis="lat"></span> </div> <div class="cbRow">  <span class="cbLabel" axis="lon">E: </span>  <span class="cbValue" axis="lon"></span> </div> </div> <div class="cbSelection">  <div style="float:left">ETRS89</div>  <div class="cbArrowDown"></div>  <br clear="both"> </div></div>')},{__name:"Oskari.framework.bundle.coordinatedisplay.CoordinateDisplayDiv",getName:function(){var a=this;return a.__name},setParent:function(b){var a=this;if(a.__parent){a.__parent.detach(a.__elements.etrs89)}if(b){a.__parent=b;if(a.__elements.etrs89){a.__parent.append(a.__elements.etrs89)}}},getParent:function(){var a=this;return a.__parent},getElement:function(){var a=this;return a.__elements.etrs89},startPlugin:function(){var a=this},stopPlugin:function(){var a=this;a.setParent(null);a.__elements.etrs89=null},draw:function(){var a=this;if(!a.__parent){a.__parent=document}if(!a.__elements.etrs89){a.__elements.etrs89=a.__templates.latlondiv.clone()}jQuery(a.__parent).append(a.__elements.etrs89);jQuery(a.__elements.etrs89).show()},refresh:function(d){if(!(d.type==b)){throw ("CoordinateDisplay.refresh() can not find 'latlon' in args!")}var c=this;var b=d.latlon;var e=c.__elements.etrs89.find('.cbValue[axis="lat"]');var a=c.__elements.etrs89.find('.cbValue[axis="lon"]');if(e&&a){e.text(b.lat);a.text(b.lon)}else{throw ("CoordinateDisplay.refresh() could not find spans!")}}},{protocol:["Oskari.userinterface.SimpleDiv"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(a){this._searchUrl=a},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(a,d,b){var c=Oskari.getLang();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){if(e&&e.overrideMimeType){e.overrideMimeType("application/json")}},url:this._searchUrl,data:"searchKey="+a+"&Language="+c,error:b,success:d})}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.bundle.search.SearchBundleInstance",function(){this.sandbox=null;this.started=false;this.plugins={};this.localization=null;this.service=null},{__name:"Search",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},getLocalization:function(a){if(!this._localization){this._localization=Oskari.getLocalization(this.getName())}if(a){return this._localization[a]}return this._localization},start:function(){var d=this;if(d.started){return}d.started=true;var a=Oskari.$("sandbox");d.sandbox=a;this.localization=Oskari.getLocalization(this.getName());var c=null;if(this.conf&&this.conf.url){c=this.conf.url}else{c=a.getAjaxUrl()+"action_route=GetSearchResult"}this.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",c);a.register(d);for(p in d.eventHandlers){a.registerForEventByName(d,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);d.createUi()},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var a=this;this.plugins["Oskari.userinterface.Flyout"].createUi();this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.search.Flyout",function(a){this.instance=a;this.container=null;this.state=null;this.template=null;this.templateResultTable=null;this.templateResultTableHeader=null;this.templateResultTableRow=null;this.resultHeaders=[];this.lastResult=null;this.lastSort=null},{getName:function(){return"Oskari.mapframework.bundle.search.Flyout"},setEl:function(c,b,a){this.container=c[0];if(!jQuery(this.container).hasClass("search")){jQuery(this.container).addClass("search")}},startPlugin:function(){this.template=jQuery('<div class="searchContainer"><div class="controls"><input class="search_field" type="text" name="search" /><input class="search_button" type="button" name="btn_find" /></div><div><br></div><div class="info"></div><div><br></div><div class="resultList"></div></div>');this.templateResultTable=jQuery('<table class="search_result"><thead><tr></tr></thead><tbody></tbody></table>');this.templateResultTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>');this.templateResultTableRow=jQuery('<tr><td><a href="JavaScript:void(0);"></a></td><td></td><td></td></tr>');this.resultHeaders=[{title:"Nimi",prop:"name"},{title:"Kyl√§",prop:"village"},{title:"Tyyppi",prop:"type"}]},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")
},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},createUi:function(){var e=this;var b=e.instance.getSandbox();var a=jQuery(this.container);a.empty();var h=this.template.clone();var f=h.find("input[name=search]");this._bindClearButton(f);var d=function(){f.attr("disabled","disabled");c.attr("disabled","disabled");var i=h.find("div.resultList");i.empty();e.instance.service.doSearch(f.val(),function(j){f.removeAttr("disabled");c.removeAttr("disabled");e._renderResults(j,f.val())},function(j){f.removeAttr("disabled");c.removeAttr("disabled");alert("vihre!")})};var c=h.find("input[name=btn_find]");var g=this.instance.getLocalization("searchButton");c.val(g);c.bind("click",d);f.keypress(function(i){if(i.which==13){d()}});a.append(h)},_bindClearButton:function(a){var b=jQuery('<div style="margin-left: 0px; position: relative; display: inline-block; left: -20px; top: 3px;"><img src="/Oskari/applications/paikkatietoikkuna.fi/full-map/icons/icon-close.png"/></div>');b.bind("click",function(){a.val("");a.trigger("keyup")});a.after(b)},_renderResults:function(m,c){if(!m||!m.totalCount){return}var d=jQuery(this.container).find("div.resultList");this.lastResult=m;var j=this;var a=jQuery(this.container).find("div.info");a.empty();if(m.totalCount==-1){d.append("searchservice_search_alert_title: "+m.errorText);return}else{if(m.totalCount==0){d.append(this.instance.getLocalization("searchservice_search_alert_title")+":"+this.instance.getLocalization("searchservice_search_not_found_anything_text"));return}else{a.append(this.instance.getLocalization("searchResultCount")+m.totalCount+this.instance.getLocalization("searchResultDescription"))}}if(m.totalCount==1){j._resultClicked(m.locations[0]);this.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[j.instance,"close"])}var l=this.templateResultTable.clone();var e=l.find("thead tr");var b=l.find("tbody");var h=function(i){return function(){b.empty();var o=false;if(j.lastSort&&j.lastSort.attr==i.prop){o=!j.lastSort.descending}j._sortResults(i.prop,o);j._populateResultTable(b);var n=e.find("a:contains("+i.title+")");e.find("th").removeClass("asc");e.find("th").removeClass("desc");if(o){n.parent().addClass("desc")}else{n.parent().addClass("asc")}}};for(var f=0;f<this.resultHeaders.length;++f){var g=this.templateResultTableHeader.clone();var k=g.find("a");k.append(this.resultHeaders[f].title);k.bind("click",h(this.resultHeaders[f]));e.append(g)}this._populateResultTable(b);d.append("<div><h3>Tulokset:"+m.totalCount+" hakutulosta haulla "+c+"</h3></div>");d.append(l)},_populateResultTable:function(b){var e=this;var a=function(i){return function(){e._resultClicked(i)}};var d=this.lastResult.locations;for(var c=0;c<d.length;++c){var k=d[c];var g=this.templateResultTableRow.clone();var j=g.find("td");var h=jQuery(j[0]);var f=h.find("a");f.append(k.name);f.bind("click",a(k));jQuery(j[1]).append(k.village);jQuery(j[2]).append(k.type);b.append(g)}},_resultClicked:function(a){var f=this;var c="searchResultPopup";var b=this.instance.sandbox;var g=this.instance.sandbox.getRequestBuilder("MapMoveRequest");b.request(f.instance.getName(),g(a.lon,a.lat,a.zoomLevel,false));var e=[{html:"<h3>"+a.name+"</h3><p>"+a.village+"<br/>"+a.type+"</p>",actions:{Sulje:function(){var h=b.getRequestBuilder("InfoBox.HideInfoBoxRequest")(c);b.request(f.instance.getName(),h)}}}];var d=b.getRequestBuilder("InfoBox.ShowInfoBoxRequest")(c,"Hakutulos",e,new OpenLayers.LonLat(a.lon,a.lat),true);b.request(this.instance.getName(),d)},_sortResults:function(c,a){var b=this;if(!this.lastResult){return}this.lastSort={attr:c,descending:a};this.lastResult.locations.sort(function(e,d){return b._searchResultComparator(e,d,c,a)})},_searchResultComparator:function(d,c,i,f){var g=d[i].toLowerCase();var e=c[i].toLowerCase();var h=0;if(g==e||"name"==i){g=d.id;e=c.id}if(g<e){h=-1}else{if(g>e){h=1}}if(f){h=h*-1}return h}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.mapframework.bundle.search.Tile",function(a){this.instance=a;
this.container=null;this.template=null},{getName:function(){return"Oskari.mapframework.bundle.search.Tile"},setEl:function(c,b,a){this.container=jQuery(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var b=e.children(".oskari-tile-status")}},{protocol:["Oskari.userinterface.Tile"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance",function(){this.sandbox=null;this.started=false;this.plugins={};this.localization=null},{__name:"LayerSelection",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},getLocalization:function(a){if(!this._localization){this._localization=Oskari.getLocalization(this.getName())}if(a){return this._localization[a]}return this._localization},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;this.localization=Oskari.getLocalization(this.getName());a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.createUi()},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerRemoveEvent:function(a){this.plugins["Oskari.userinterface.Tile"].refresh();this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(a.getMapLayer(),false)},AfterMapLayerAddEvent:function(a){this.plugins["Oskari.userinterface.Tile"].refresh();this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(a.getMapLayer(),true,a.getKeepLayersOrder())},MapLayerEvent:function(d){var b=this.sandbox.getService("Oskari.mapframework.service.MapLayerService");var a=d.getLayerId();if(d.getOperation()==="update"){var c=b.findMapLayer(a);this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(c)}},MapLayerVisibilityChangedEvent:function(a){this.plugins["Oskari.userinterface.Flyout"].handleLayerVisibilityChanged(a.getMapLayer(),a.isInScale(),a.isGeometryMatch())},AfterChangeMapLayerOpacityEvent:function(a){if(a._creator!=this.getName()){this.plugins["Oskari.userinterface.Flyout"].handleLayerOpacityChanged(a.getMapLayer())}},AfterChangeMapLayerStyleEvent:function(a){if(a._creator!=this.getName()){this.plugins["Oskari.userinterface.Flyout"].handleLayerStyleChanged(a.getMapLayer())}}},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var a=this;this.plugins["Oskari.userinterface.Flyout"].createUi();this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Flyout",function(a){this.instance=a;this.container=null;this.state=null;this.template=null;this.templateLayer=null;this.templateLayerTools=null;this.templateLayerOutOfScale=null;this.templateLayerOutOfContentArea=null;this.sortableBinded=false;this._sliders={}},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Flyout"},setEl:function(c,b,a){this.container=c[0];if(!jQuery(this.container).hasClass("layerselection2")){jQuery(this.container).addClass("layerselection2")}},startPlugin:function(){var a=this.instance.getLocalization("layer");this.template=jQuery('<ul class="selectedLayersList sortable" data-sortable=\'{itemCss: "li.layer.selected", handleCss: "div.layer-title" }\'></ul>');this.templateLayer=jQuery('<li class="layer selected"><div class="layer-info"><div class="layer-icon"></div><div class="layer-tool-remove"></div><div class="layer-title"><h4></h4></div></div><div class="stylesel"><label for="style">'+a.style+'</label><select name="style"></select></div><div class="layer-tools volatile"></div></li>');
this.templateLayerFooterTools=jQuery('<div class="left-tools"><div class="layer-visibility"><a href="JavaScript:void(0);">'+a.hide+'</a>&nbsp;<span class="temphidden" style="display: none;">'+a.hidden+'</span></div><div class="layer-opacity"><div class="layout-slider" id="layout-slider"></div> <div class="opacity-slider" style="display:inline-block"><input type="text" name="opacity-slider" class="opacity-slider opacity" id="opacity-slider" />%</div></div></div><div class="right-tools"><div class="layer-description"><div class="wrapper"></div></div><div class="layer-rights"></div><a href="JavaScript:void(0);"><div class="icon-info"></div></a></div>');this.templateLayerFooterHidden=jQuery('<p class="layer-msg"><a href="JavaScript:void(0);">'+a.show+"</a> "+a.hidden+"</p>");this.templateLayerFooterOutOfScale=jQuery('<p class="layer-msg">'+a["out-of-scale"]+' <a href="JavaScript:void(0);">'+a["move-to-scale"]+"</a></p>");this.templateLayerFooterOutOfContentArea=jQuery('<p class="layer-msg">'+a["out-of-content-area"]+' <a href="JavaScript:void(0);">'+a["move-to-content-area"]+"</a></p>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},createUi:function(){var h=this;var b=jQuery(this.container);b.empty();var f=this.template.clone();b.append(f);var i=h.instance.getSandbox();var d=i.findAllSelectedMapLayers();var c=i.getMap().getScale();for(var a=d.length-1;a>=0;--a){var e=d[a];var g=this._createLayerContainer(e);f.append(g);this._appendLayerFooter(g,e,e.isInScale(c),true)}if(!this.sortableBinded){this.sortableBinded=true;".selectedLayersList".on("finish",function(j){h._layerOrderChanged(j.index)})}},_appendLayerFooter:function(a,b,d,c){var e=a.find("div.layer-tools");if(!b.isVisible()){a.addClass("hidden");e.append(this._createLayerFooterHidden(b))}else{if(!d){a.addClass("out-of-scale");e.append(this._createLayerFooterOutOfScale(b))}else{if(!c){a.addClass("out-of-content");e.append(this._createLayerFooterOutOfContentArea(b))}else{e.append(this._createLayerFooter(b,a));this._addSlider(b)}}}},_addSlider:function(a){var c=this;var b=c._sliders[a.getId()];if(!b){var b=new Slider({min:0,max:100});b.setStyle({"background-color":"transparent","background-image":'url("../../resources/framework/bundle/layerselection2/images/opacity_slider.png")',height:"5px",width:"150px",border:"0",margin:0});b.level.hide();b.handle.setStyle({"background-color":"transparent","background-image":'url("../../resources/framework/bundle/layerselection2/images/opacity_index.png")',width:"15px",height:"15px",border:"0","margin-left":0});b.on("change",function(d){c._layerOpacityChanged(a,d.value)});c._sliders[a.getId()]=b}b.setValue(a.getOpacity());if(jQuery("#layout-slider-"+a.getId()).length>0){b.insertTo("layout-slider-"+a.getId());b.assignTo("opacity-slider-"+a.getId())}},_layerOrderChanged:function(c){var d=jQuery(this.container).find(".selectedLayersList li");var f=jQuery(d[c]).attr("layer_id");if(c>-1){c=(d.length-1)-c;var a=this.instance.getSandbox();var b=a.getRequestBuilder("RearrangeSelectedMapLayerRequest");var e=b(f,c);a.request(this.instance.getName(),e)}},_createLayerContainer:function(f){var j=this;var n=j.instance.getSandbox();var a=n.getRequestBuilder("ChangeMapLayerOpacityRequest");var d=f.getId();var m=f.getOpacity();var q=this.templateLayer.clone();q.attr("layer_id",d);q.find("div.layer-title h4").append(f.getName());q.find("div.layer-title").append(f.getDescription());var l=q.find("div.stylesel");l.hide();if(f.getStyles&&f.getStyles().size>1){var g=false;var o=f.getStyles();var c=l.find("select");for(var e=0;e<o.size();e++){if(o[e].getName()){var b=jQuery('<option value="'+o[e].getName()+'">'+o[e].getTitle()+"</option>");c.append(b);g=true}}c.change(function(s){var t=c.find("option:selected").val();f.selectStyle(t);var i=n.getRequestBuilder("ChangeMapLayerStyleRequest");var r=i(f.getId(),t);n.request(j.instance.getName(),r)});if(g){c.val(f.getCurrentStyle().getName());
l.show()}}var h=this.instance.getLocalization("layer").tooltip;var k=q.find("div.layer-icon");if(f.isBaseLayer()){k.addClass("layer-base");k.attr("title",h["type-base"])}else{if(f.isLayerOfType("WMS")){if(f.isGroupLayer()){k.addClass("layer-group")}else{k.addClass("layer-wms")}k.attr("title",h["type-wms"])}else{if(f.isLayerOfType("WMTS")){k.addClass("layer-wmts");k.attr("title",h["type-wms"])}else{if(f.isLayerOfType("WFS")){k.addClass("layer-wfs");k.attr("title",h["type-wfs"])}else{if(f.isLayerOfType("VECTOR")){k.addClass("layer-vector");k.attr("title",h["type-wms"])}}}}}q.find("div.layer-tool-remove").addClass("icon-close");q.find("div.layer-tool-remove").bind("click",function(){var i=n.getRequestBuilder("RemoveMapLayerRequest");var r=i(f.getId());n.request(j.instance.getName(),r)});return q},handleLayerVisibilityChanged:function(c,g,f){var d=this;var b=d.instance.getSandbox();var a=jQuery(this.container).find("li.layer.selected[layer_id="+c.getId()+"]");var e=this.instance.getLocalization("layer");var h=a.find("div.layer-tools");h.empty();a.removeClass("hidden");a.removeClass("out-of-scale");a.removeClass("out-of-content");this._appendLayerFooter(a,c,g,f)},_layerOpacityChanged:function(c,e){var b=this.instance.getSandbox();var f=b.getRequestBuilder("ChangeMapLayerOpacityRequest");var d=f(c.getId(),e);b.request(this.instance.getName(),d);var a=jQuery(this.container).find("li.layer.selected[layer_id="+c.getId()+"]");a.find("div.layer-opacity input.opacity").attr("value",c.getOpacity())},handleLayerOpacityChanged:function(a){this._addSlider(a)},handleLayerStyleChanged:function(c){var a=jQuery(this.container).find("li.layer.selected[layer_id="+c.getId()+"]");var b=a.find("div.stylesel select");b.val(c.getCurrentStyle().getName())},_createLayerFooterOutOfScale:function(b){var c=this;var a=c.instance.getSandbox();var d=this.templateLayerFooterOutOfScale.clone();var e=a.getRequestBuilder("MapModulePlugin.MapMoveByLayerContentRequest");d.find("a").bind("click",function(){var f=e(b.getId());a.request(c.instance.getName(),f)});return d},_createLayerFooterHidden:function(c){var d=this;var a=d.instance.getSandbox();var e=this.templateLayerFooterHidden.clone();var b=a.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest");e.find("a").bind("click",function(){var f=b(c.getId(),true);a.request(d.instance.getName(),f)});return e},_createLayerFooterOutOfContentArea:function(b){var c=this;var a=c.instance.getSandbox();var d=this.templateLayerFooterOutOfContentArea.clone();var e=a.getRequestBuilder("MapModulePlugin.MapMoveByLayerContentRequest");d.find("a").bind("click",function(){var f=e(b.getId());a.request(c.instance.getName(),f)});return d},_createLayerFooter:function(f,j){var h=this;var i=h.instance.getSandbox();var e=this.templateLayerFooterTools.clone();var g=this.instance.getLocalization("layer");var d=i.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest");e.find("div.layer-visibility a").bind("click",function(){var k=d(f.getId(),false);i.request(h.instance.getName(),k)});var c=f.getPermission("publish");if(!i.getUser().isLoggedIn()){if(c=="can_be_published"){e.find("div.layer-rights").html(g.rights["login-url"]);e.find("div.layer-rights").attr("title",g.rights["need-login"])}else{e.find("div.layer-rights").html(g.rights.no_publication_permission.label);e.find("div.layer-rights").attr("title",g.rights.no_publication_permission.tooltip)}}else{e.find("div.layer-rights").html(g.rights[c].label);e.find("div.layer-rights").attr("title",g.rights[c].tooltip)}if(!f.getDataUrl()){e.find("div.layer-description").hide()}else{e.find("div.layer-description a").attr("href",f.getDataUrl());e.find("div.layer-description a").attr("target","_blank")}var a=e.find("div.layout-slider");a.attr("id","layout-slider-"+f.getId());var b=e.find("input.opacity-slider");b.attr("id","opacity-slider-"+f.getId());return e},handleLayerSelectionChanged:function(d,a,b){if(a==true){var f=this;var j=f.instance.getSandbox();var c=j.getMap().getScale();var e=jQuery("ul.selectedLayersList");var g=this._createLayerContainer(d);var i=g.find("div.layer-tools");
if(!d.isVisible()){g.addClass("hidden");i.append(this._createLayerFooterHidden(d))}else{if(!d.isInScale(c)){g.addClass("out-of-scale");i.append(this._createLayerFooterOutOfScale(d))}else{i.append(this._createLayerFooter(d,g))}}var h=[];if(d.isBaseLayer()&&b!=true){h=e.find("li[layer_id^=base_]")}else{h=e.find(".layer.selected")}if(h.length>0){h.first().before(g)}else{e.append(g)}}else{var k=jQuery(this.container).find("li[layer_id="+d.getId()+"]");if(k){k.remove()}}},handleLayerModified:function(b){var c=this;var a=jQuery(this.container).find("li[layer_id="+b.getId()+"]");jQuery(a).find(".layer-title h4").html(b.getName())}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Tile",function(a){this.instance=a;this.container=null;this.template=null;this.badge=Oskari.clazz.create("Oskari.userinterface.component.Badge");this.shownLayerCount=null},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Tile"},setEl:function(d,c,a){this.container=jQuery(d);var b=this.container.children(".oskari-tile-status");this.badge.insertTo(b)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},refresh:function(){var e=this;var a=e.instance;var d=this.container;var c=this.template;var b=a.getSandbox();var g=b.findAllSelectedMapLayers();var f=g.length;if(this.shownLayerCount&&this.shownLayerCount){this.badge.setContent(""+f,"important")}else{this.badge.setContent(""+f)}this.shownLayerCount=f}},{protocol:["Oskari.userinterface.Tile"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
var Tooltip=RightJS.Tooltip=function(w,v){function u(b,h){h||(h=b,b="DIV");var g=new v.Class(v.Element.Wrappers[b]||v.Element,{initialize:function(j,i){this.key=j;var a=[{"class":"rui-"+j}];this instanceof v.Input||this instanceof v.Form||a.unshift(b),this.$super.apply(this,a),v.isString(i)&&(i=v.$(i)),i instanceof v.Element&&(this._=i._,"$listeners" in i&&(i.$listeners=i.$listeners),i={}),this.setOptions(i,this);return v.Wrapper.Cache[v.$uid(this._)]=this},setOptions:function(d,e){e&&(d=v.Object.merge(d,(new Function("return "+(e.get("data-"+this.key)||"{}")))())),d&&v.Options.setOptions.call(this,v.Object.merge(this.options,d));return this}}),f=new v.Class(g,h);v.Observer.createShortcuts(f.prototype,f.EVENTS||v([]));return f}var t=v,s=v.$,r=v.$w,q=v.$uid,o=v.Element,n=new u({extend:{version:"2.2.1",EVENTS:r("show hide"),Options:{cssRule:"[data-tooltip]",fxName:"fade",fxDuration:400,delay:400,move:!0,idSuffix:"-tooltip"},current:null,instances:t([]),find:function(e){var d=e.target;if(d.match(n.Options.cssRule)){var f=q(d);return n.instances[f]||(n.instances[f]=new n(d))}}},initialize:function(a,d){this.associate=a=s(a),this.$super("tooltip").setOptions(d,a).insert('<div class="rui-tooltip-arrow"></div><div class="rui-tooltip-container">'+(a.get("title")||a.get("alt"))+"</div>").on({mouseout:this._mouseOut,mouseover:this._cancelTimer}).insertTo(w.body),a.has("id")&&this.set("id",a.get("id")+this.options.idSuffix),a.set({title:"",alt:""})},hide:function(){this._cancelTimer(),this._timer=t(function(){o.prototype.hide.call(this,this.options.fxName,{engine:"javascript",duration:this.options.fxDuration}),n.current=null,this.fire("hide")}).bind(this).delay(100);return this},show:function(b){n.instances.each(function(c){c&&c!==this&&c.hide()},this),this._timer=t(function(){o.prototype.show.call(this.stop(),this.options.fxName,{engine:"javascript",duration:this.options.fxDuration}),n.current=this.fire("show")}).bind(this).delay(this.options.delay);return n.current=this},moveToEvent:function(b){this.options.move&&(this._.style.left=b.pageX+"px",this._.style.top=b.pageY+"px");return this},_cancelTimer:function(){this._timer&&(this._timer.cancel(),this._timer=null);return !1},_mouseOut:function(b){b.stop(),b.relatedTarget!==this.associate&&this.hide()}});s(w).on({mouseenter:function(d){var c=n.find(d);c&&c.show().moveToEvent(d)},mouseleave:function(d){var c=n.find(d);c&&c.hide()},mousemove:function(d){var c=n.current;c!==null&&c.options.move&&c.moveToEvent(d)}});var m=w.createElement("style"),l=w.createTextNode("div.rui-tooltip{display:none;position:absolute;z-index:99999;font-size:90%;margin-top:16pt;margin-left:5pt;color:#FFF;text-shadow:0 0 .2em #000;border:.3em solid rgba(255,255,255,0.2);background-color:rgba(25,25,25,0.92);background-color:#000 \\9;border:.3em solid #444 \\9;background-image:-webkit-gradient(linear,0% 0%,0% 100%,from(transparent) ,to(#000) );border-radius:.4em;-moz-border-radius:.4em;-webkit-border-radius:.4em;box-shadow:0 0 .4em #555;-moz-box-shadow:0 0 .4em #555;-webkit-box-shadow:0 0 .4em #555}div.rui-tooltip-container{margin:.4em .6em}");m.type="text/css",w.getElementsByTagName("head")[0].appendChild(m),m.styleSheet?m.styleSheet.cssText=l.nodeValue:m.appendChild(l);return n}(document,RightJS);Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance",function(){this.sandbox=null;this.started=false;this.plugins={};this.localization=null},{__name:"LayerSelector",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},getLocalization:function(a){if(!this._localization){this._localization=Oskari.getLocalization(this.getName())}if(a){return this._localization[a]}return this._localization},start:function(){var e=this;if(e.started){return}e.started=true;var b=Oskari.$("sandbox");e.sandbox=b;b.register(e);for(p in e.eventHandlers){b.registerForEventByName(e,p)}var d=b.getRequestBuilder("userinterface.AddExtensionRequest")(this);b.request(this,d);e.createUi();var a=this.sandbox.getService("Oskari.mapframework.service.MapLayerService");
b.registerAsStateful(this.mediator.bundleId,this);var c=function(){e.createUi()};var f=function(){alert(e.getLocalization("errors").loadFailed)};a.loadAllLayersAjax(c,f)},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerRemoveEvent:function(a){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(a.getMapLayer(),false)},AfterMapLayerAddEvent:function(a){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(a.getMapLayer(),true)},MapLayerEvent:function(d){var b=this.sandbox.getService("Oskari.mapframework.service.MapLayerService");var a=d.getLayerId();if(d.getOperation()==="update"){var c=b.findMapLayer(a);this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(c)}else{if(d.getOperation()==="add"){var c=b.findMapLayer(a);this.plugins["Oskari.userinterface.Flyout"].handleLayerAdded(c);this.plugins["Oskari.userinterface.Tile"].refresh()}else{if(d.getOperation()==="remove"){this.plugins["Oskari.userinterface.Flyout"].handleLayerRemoved(a);this.plugins["Oskari.userinterface.Tile"].refresh()}}}}},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregisterStateful(this.mediator.bundleId);this.sandbox.unregister(this);this.started=false},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var a=this;this.plugins["Oskari.userinterface.Flyout"].createUi();this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(a){this.plugins["Oskari.userinterface.Flyout"].setContentState(a)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Flyout",function(a){this.instance=a;this.container=null;this.template=null;this.templateLayer=null;this.templateLayerGroup=null;this.templateGroupingTool=null;this.state=null;this.grouping="getInspireName";this.groupingTools=[]},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Flyout"},setEl:function(c,b,a){this.container=c[0];if(!jQuery(this.container).hasClass("layerselector2")){jQuery(this.container).addClass("layerselector2")}},startPlugin:function(){var a=this;this.template=jQuery('<div class="groupingTabs"><ul></ul></div><br clear="all"/><div class="allLayersTabContent"><div class="filter"><input name="text-filter" type="text" /></div><div class="layerList volatile"></div></div>');this.templateLayer=jQuery('<div class="layer"><input type="checkbox" /> <div class="layer-tools"><div class="layer-icon"></div><div class="layer-info"></div></div><div class="layer-title"></div><div class="layer-keywords"></div></div>');this.templateLayerGroup=jQuery('<div class="layerGroup"><div class="groupHeader"><span class="groupName"></span><span class="layerCount"></span></div></div>');this.groupingTools=[{title:this.instance.getLocalization("filter").inspire,callback:function(){a.doGrouping("getInspireName")}},{title:this.instance.getLocalization("filter").organization,callback:function(){a.doGrouping("getOrganizationName")}}];this.templateGroupingTool=jQuery('<li><a href="JavaScript:void(0);"></a></li>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")
},getOptions:function(){},setState:function(a){this.state=a;console.log("Flyout.setState",this,a)},_teardownContentState:function(){jQuery(this.container).find("div.groupingTabs li").removeClass("active");var a=jQuery(this.container).find("div.layerList div.layerGroup");a.removeClass("open");jQuery(this.container).find("input[name=text-filter]").val("")},setContentState:function(e){this._teardownContentState();if(!e){e={}}if(!e.tab){e.tab=this.groupingTools[0].title}var a=jQuery(this.container).find("div.groupingTabs li:contains("+e.tab+")");a.addClass("active");for(var b=0;b<this.groupingTools.length;++b){var g=this.groupingTools[b];if(g.title==e.tab){g.callback()}}var c=e.filter;if(!c){c=""}jQuery(this.container).find("input[name=text-filter]").val(c);this._filterLayers(e.filter);if(!e.filter&&e.groups){var h=jQuery(this.container).find("div.layerList div.layerGroup");for(var b=0;b<e.groups.length;++b){var g=e.groups[b];var d=h.find("span.groupName:contains("+g+")");if(d){var f=d.parent().parent();f.addClass("open");f.find("div.layer").show()}}}},getContentState:function(){var f=jQuery(this.container).find("input[name=text-filter]").val();var b=[];var e=jQuery(this.container).find("div.layerList div.layerGroup.open");for(var c=0;c<e.length;++c){var d=e[c];b.push(jQuery(d).find(".groupName").text())}var a=jQuery(this.container).find("div.groupingTabs li.active").text();return{tab:a,filter:f,groups:b}},createUi:function(){var e=this;var j=e.instance.getSandbox();var f=jQuery(this.container);f.empty();var d=this.template.clone();f.append(d);var c=f.find("div.groupingTabs ul");this._populateGroupingTools(c);var h=f.find("input[name=text-filter]");h.attr("placeholder",this.instance.getLocalization("filter").text);h.keyup(function(){var k=jQuery(this);var i=k.val();e._filterLayers(i)});var g=f.find("div.layerList");this._populateLayerList(g);var a=j.findAllSelectedMapLayers();for(var b=0;b<a.length;++b){this.handleLayerSelectionChanged(a[b],true)}},_filterLayers:function(a){var b=jQuery("div.layerList div.layerGroup");if(a&&a.length>0){b.show();b.find("div.layer").hide();b.find("div.layer div.layer-keywords:contains("+a.toLowerCase()+")").parent().show();b.each(function(c){var d=jQuery(this);var e=d.find("div.layer").filter(":visible");if(e.length==0){d.removeClass("open");d.hide()}else{if(!d.hasClass("open")){d.addClass("open")}e.removeClass("odd");e.filter(":odd").addClass("odd")}})}else{b.show();b.removeClass("open");b.find("div.layer").hide()}},_layerListComparator:function(d,c){var f=d[this.grouping]().toLowerCase();var e=c[this.grouping]().toLowerCase();if(f==e){f=d.getName().toLowerCase();e=c.getName().toLowerCase()}if(f<e){return -1}if(f>e){return 1}return 0},_populateLayerList:function(k){var j=this;var l=this.instance.getSandbox();k.empty();var e=l.getService("Oskari.mapframework.service.MapLayerService");var c=e.getAllLayers();c.sort(function(q,n){return j._layerListComparator(q,n)});var b=null;var m=null;var h=0;var o=true;for(var a=0;a<c.length;++a){var f=c[a];var i=this._createLayerContainer(f);var d=f[this.grouping]();if(m!=d){if(b){b.find("span.layerCount").html(" ("+h+")")}b=this._createLayerGroupContainer(d);k.append(b);m=d;h=0;o=true}if(o){i.addClass("odd")}o=!o;b.append(i);h++}if(b){b.find("span.layerCount").html(" ("+h+")");var g=jQuery(this.container).find("input[name=text-filter]").val();j._filterLayers(g)}},doGrouping:function(a){this.grouping=a;var b=jQuery(this.container).find("div.layerList");this._populateLayerList(b)},_populateGroupingTools:function(e){var d=this;for(var c=0;c<this.groupingTools.length;++c){var b=this.groupingTools[c];var a=this.templateGroupingTool.clone();if(c==0){a.addClass("active")}a.find("a").html(b.title);e.append(a);a.bind("click",function(){var f=jQuery(this);var g=f.index();d.groupingTools[g].callback();f.closest("ul").find("li").removeClass("active");f.addClass("active")})}},_createLayerGroupContainer:function(e){var d=this;var b=d.instance.getSandbox();var a=this.templateLayerGroup.clone();var c=jQuery(a).find("div.groupHeader");c.find("span.groupName").append(e);c.click(function(){var h=jQuery(this).parent();
var f=h.hasClass("open");if(f){h.removeClass("open");h.find("div.layer").hide()}else{h.addClass("open");var g=jQuery(d.container).find("input[name=text-filter]").val();if(g){h.find("div.layer div.layer-keywords:contains("+g.toLowerCase()+")").parent().show()}else{var i=h.find("div.layer");i.removeClass("odd");i.filter(":odd").addClass("odd");i.show()}}});return a},_createLayerContainer:function(e){var g=this;var i=g.instance.getSandbox();var a=i.getRequestBuilder("AddMapLayerRequest");var b=i.getRequestBuilder("RemoveMapLayerRequest");var j=this.templateLayer.clone();var c=jQuery(j).find(".layer-keywords");c.append(e.getName().toLowerCase());c.append(" "+e.getInspireName().toLowerCase());c.append(" "+e.getOrganizationName().toLowerCase());c.hide();var f=this.instance.getLocalization("tooltip");var d=jQuery(j).find("div.layer-tools");var h=d.find("div.layer-icon");if(e.isBaseLayer()){h.addClass("layer-base");h.attr("title",f["type-base"])}else{if(e.isLayerOfType("WMS")){if(e.isGroupLayer()){h.addClass("layer-group")}else{h.addClass("layer-wms")}h.attr("title",f["type-wms"])}else{if(e.isLayerOfType("WMTS")){h.addClass("layer-wmts");h.attr("title",f["type-wms"])}else{if(e.isLayerOfType("WFS")){h.addClass("layer-wfs");h.attr("title",f["type-wfs"])}else{if(e.isLayerOfType("VECTOR")){h.addClass("layer-vector");h.attr("title",f["type-wms"])}}}}}if(e.getDataUrl()){d.find("div.layer-info").addClass("icon-info");d.find("div.layer-info").click(function(){alert("TODO: send ShowOverlayPopupRequest with "+e.getDataUrl())})}jQuery(j).attr("layer_id",e.getId());jQuery(j).find(".layer-title").append(e.getName());jQuery(j).find("input").change(function(){var l=jQuery(this);var k=null;if(l.is(":checked")){k=a(e.getId(),true)}else{k=b(e.getId())}i.request(g.instance.getName(),k)});return j},handleLayerSelectionChanged:function(c,b){var a=jQuery(this.container).find("div[layer_id="+c.getId()+"]");a.find("input").attr("checked",(b==true))},handleLayerModified:function(b){var c=this;var a=jQuery(this.container).find("div[layer_id="+b.getId()+"]");jQuery(a).find(".layer-title").html(b.getName())},handleLayerAdded:function(a){var c=this;var b=jQuery(this.container).find("div.layerList");this._populateLayerList(b)},handleLayerRemoved:function(a){var c=this;var b=jQuery(this.container).find("div.layerList");this._populateLayerList(b)}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Tile",function(a){this.instance=a;this.container=null;this.template=null;this.badge=Oskari.clazz.create("Oskari.userinterface.component.Badge")},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Tile"},setEl:function(d,c,a){this.container=jQuery(d);var b=this.container.children(".oskari-tile-status");this.badge.insertTo(b)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(a){console.log("Tile.setState",this,a)},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var b=c.getService("Oskari.mapframework.service.MapLayerService");var g=b.getAllLayers();this.badge.setContent(""+g.length)}},{protocol:["Oskari.userinterface.Tile"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance",function(){this.sandbox=null;this.started=false;this.mediator=null},{__name:"Infobox",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var b=this;if(b.started){return}b.started=true;var a=Oskari.$("sandbox");a.register(b);b.setSandbox(a);for(var c in b.eventHandlers){if(c){a.registerForEventByName(b,c)}}var d=a.findRegisteredModuleInstance("MainMapModule");d.registerPlugin(this.popupPlugin);d.startPlugin(this.popupPlugin);a.addRequestHandler("InfoBox.ShowInfoBoxRequest",this.requestHandlers.showInfoHandler);a.addRequestHandler("InfoBox.HideInfoBoxRequest",this.requestHandlers.hideInfoHandler)},init:function(){var a=this;this.popupPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin");this.requestHandlers={showInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",this.popupPlugin),hideInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",this.popupPlugin)};return null},onEvent:function(c){var b=this;var a=b.eventHandlers[c.getName()];if(!a){return}return a.apply(this,[c])},eventHandlers:{},stop:function(){var b=this;var a=b.sandbox();for(var c in b.eventHandlers){if(c){a.unregisterFromEventByName(b,c)}}b.sandbox.unregister(b);b.started=false}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});jQuery.fn.outerHTML=function(a){var b;if(!this.length){return typeof val=="undefined"?this:null}if(!a){return this[0].outerHTML||(b=this.wrap("<div>").parent().html(),this.unwrap(),b)}jQuery.each(this,function(d,e){var g,f=e,c=e.outerHTML?"outerHTML":"innerHTML";if(!e.outerHTML){e=jQuery(e).wrap("<div>").parent()[0]}if(jQuery.isFunction(a)){if((g=a.call(f,d,e[c]))!==false){e[c]=g}}else{e[c]=a}if(!e.outerHTML){jQuery(e).children().unwrap()}});return this};Oskari.clazz.define("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._popups={}},{__name:"OpenLayersPopupPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this._map=a.getMap();this.pluginName=a.getName()+this.__name},init:function(){var a=this;this._arrow=jQuery('<div class="popupHeaderArrow"></div>');this._header=jQuery('<div class="popupHeader"></div>');this._contentDiv=jQuery('<div class="popupContent"></div>');this._contentWrapper=jQuery('<div class="contentWrapper"></div>');this._actionLink=jQuery('<span class="infoboxActionLinks"><a href="#"></a></span>');this._contentSeparator=jQuery('<hr class="infoboxLine">')},popup:function(k,t,j,d){var q=this;var b=this._arrow.clone();var o=this._header.clone();var l=this._contentDiv.clone();o.append(t);for(var p=0;p<j.length;p++){if(p!=0){l.append(this._contentSeparator.clone())}var e=j[p].html;var f=this._contentWrapper.clone();f.append(e);var m=j[p].actions;for(var s in m){var n=s;var h=m[s];var g=this._actionLink.clone();var c=g.find("a");c.attr("contentdata",p);c.append(n);f.append(g)}l.append(f)}var r=this.getMapModule().getMap();var a=new OpenLayers.Popup(k,new OpenLayers.LonLat(d.lon,d.lat),new OpenLayers.Size(400,200),b.outerHTML()+o.outerHTML()+l.outerHTML(),false);a.setBackgroundColor("transparent");this._popups[k]=a;jQuery(a.div).css("overflow","");jQuery(a.groupDiv).css("overflow","");a.events.un({click:a.onclick,scope:a});a.events.on({click:function(u){var w=jQuery(u.originalTarget);var v=w.attr("contentdata");var x=w.html();if(j[v]&&j[v].actions&&j[v].actions[x]){j[v].actions[x]()}},scope:a});r.addPopup(a)},close:function(b){if(!b){for(var a in this._popups){this._popups[a].destroy();delete this._popups[a]}return}this._popups[b].destroy();delete this._popups[b]},register:function(){},unregister:function(){},startPlugin:function(a){this._sandbox=a;a.register(this)
},stopPlugin:function(a){a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequest",function(e,d,c,a,b){this._creator=null;this._id=e;this._title=d;this._content=c;this._position=a;this._hidePrevious=(b==true)},{__name:"InfoBox.ShowInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getTitle:function(){return this._title},getContent:function(){return this._content},getPosition:function(){return this._position},getHidePrevious:function(){return this._hidePrevious}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",function(a){this.popupPlugin=a},{handleRequest:function(a,b){if(b.getHidePrevious()){this.popupPlugin.close()}this.popupPlugin.popup(b.getId(),b.getTitle(),b.getContent(),b.getPosition())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequest",function(a){this._creator=null;this._id=a},{__name:"InfoBox.HideInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",function(a){this.popupPlugin=a},{handleRequest:function(a,b){this.popupPlugin.close(b.getId())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.started=false;this.plugins={};this._locale=null;this._requestHandlers={};this.loader=null;this.layerPlugin=null;this.layer=null},{__name:"catalogue.bundle.metadataflyout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocale:function(){return this._locale},getLoader:function(){return this.loader},layerSpec:{text:"",name:"Metadata",wmsName:"1",type:"vectorlayer",styles:{title:"Trains",legend:"",name:"1"},descriptionLink:"http://www.paikkatietohakemisto.fi/",orgName:"Metadata",inspire:"Metadata",legendImage:"",info:"",isQueryable:true,formats:{value:"text/html"},id:"catalogue_metadataflyout_layer",minScale:36000000,maxScale:1,style:"",dataUrl:"",wmsUrl:"x",opacity:60,checked:"false",styledLayerDescriptor:'<StyledLayerDescriptor version="1.0.0" xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"     xmlns="http://www.opengis.net/sld"     xmlns:ogc="http://www.opengis.net/ogc"     xmlns:xlink="http://www.w3.org/1999/xlink"     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">   <NamedLayer>     <Name>Simple point with stroke</Name>    <UserStyle><Title>GeoServer SLD Cook Book: Simple point with stroke</Title>     <FeatureTypeStyle><Rule><PolygonSymbolizer> <Graphic><Mark><WellKnownName>circle</WellKnownName><Fill>        <CssParameter name="fill">#000040</CssParameter>       </Fill><Stroke>          <CssParameter name="stroke">#000040</CssParameter>           <CssParameter name="stroke-width">2</CssParameter>          </Stroke></Mark><Size>12</Size></Graphic>     </PolygonSymbolizer><TextSymbolizer><Label><ogc:PropertyName>title</ogc:PropertyName></Label><Fill><CssParameter name="fill">#000000</CssParameter></Fill></TextSymbolizer></Rule></FeatureTypeStyle></UserStyle></NamedLayer></StyledLayerDescriptor>'},start:function(){if(this.started){return}this.started=true;this._locale=Oskari.getLocalization(this.getName());var i=Oskari.$("sandbox");this.sandbox=i;this.loader=Oskari.clazz.create("Oskari.catalogue.metadataflyout.bundle.service.MetadataLoader",this.getLocale()["loader"],i);i.register(this);for(a in this.eventHandlers){i.registerForEventByName(this,a)}this._requestHandlers["catalogue.ShowMetadataRequest"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",i,this);i.addRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);var b={};for(var a in this.layerSpec){b[a]=this.layerSpec[a]}var f=this.getLocale()["layer"];for(var a in f){b[a]=f[a]}var e=i.getService("Oskari.mapframework.service.MapLayerService");var g=e.createMapLayer(b);e.addLayer(g,true);this.layer=g;var h=i.findRegisteredModuleInstance("MainMapModule");var d=Oskari.clazz.create("Oskari.mapframework.mapmodule.MetadataLayerPlugin");d.setMapLayer(g);h.registerPlugin(d);h.startPlugin(d);this.layerPlugin=d;var c=i.getRequestBuilder("userinterface.AddExtensionRequest")(this);i.request(this,c);i.registerAsStateful(this.mediator.bundleId,this)},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{AfterMapLayerAddEvent:function(a){},AfterMapLayerRemoveEvent:function(a){},AfterMapMoveEvent:function(a){}},stop:function(){var a=this.sandbox;a.removeRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregisterStateful(this.mediator.bundleId);this.sandbox.unregister(this);this.started=false},setSandbox:function(a){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.Flyout",this,this.getLocale()["flyout"],this.getLoader());this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.Tile",this,this.getLocale()["tile"])
},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getTitle:function(){return this.getLocale()["title"]},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},scheduleShowMetadata:function(a,b,c){this.plugins["Oskari.userinterface.Flyout"].scheduleShowMetadata(a,b,c);this.getSandbox().requestByName(this,"userinterface.UpdateExtensionRequest",[this,"detach"])},showExtentOnMap:function(a,h,g){var j=this;if(!h){return}var f=[];for(var c=0;c<h.length;c++){var k=h[c];var i=new OpenLayers.Bounds(k.westBoundLongitude,k.southBoundLatitude,k.eastBoundLongitude,k.northBoundLatitude);var l=i.toGeometry();var d=new OpenLayers.Feature.Vector(l);d.attributes=g||d.attributes;f.push(d)}var b=j.getSandbox().getEventBuilder("FeaturesAvailableEvent")(this.layer,f,"application/nlsfi-x-openlayers-feature","EPSG:3067","replace");j.sandbox.notifyAll(b)},setState:function(a){this.plugins["Oskari.userinterface.Flyout"].setContentState(a)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.catalogue.metadataflyout.bundle.service.MetadataLoader",function(b,a){this.urls=b;this.sandbox=a;this.dev=false},{getURLForView:function(c,a,e,i,f,h){var b=this.urls[c];var d=b+"uuid="+a;if(this.dev){var g={"abstract":"abstract",jhs:"jhs158",inspire:"inspire",json:"json"}[c];if(g!=null){d=g}}return d},loadMetadata:function(e,c,f,g,a,b){var d=this.getURLForView(e,c,f,g);this.sandbox.printDebug("loadMetadata "+d);if(d==null){return}jQuery.ajax({url:d,dataType:b,success:function(h,i){a(h)}})},openMetadata:function(b,a,d,i,e,h,g){var c=this.getURLForView(b,a,d,i);this.sandbox.printDebug("openMetadata "+c);var f=window.open(c,g,"resizable=yes,scrollbars=yes,status=yes")}});Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Flyout",function(c,b,a){this.instance=c;this.locale=b;this.container=null;this.views={};this.titles={};this.tabs={};this.browseGraphic=null;this.compileTemplates();this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert");this.showQueue=[];this.state=null;this.contentState={metadata:{uuid:null,RS_Identifier_Code:null,RS_Identifier_CodeSpace:null},view:"abstract"}},{compileTemplates:function(){},templates:{content:"<div class='metadataflyout_content'></div>",browseGraphic:"<div class='metadataflyout_content_browseGraphic'><img /></div>",viewTabs:"<div class='metadataflyout_content_tabs'></div>",viewTab:"<div class='metadataflyout_content_tab'></div>",titles:{"abstract":"<div class='metadataflyout_content_abstract_title'></div>",jhs:"<div class='metadataflyout_content_jhs_title'></div>",inspire:"<div class='metadataflyout_content_inspire_title'></div>"},views:{"abstract":"<div class='metadataflyout_content_abstract'></div>",jhs:"<div class='metadataflyout_content_jhs'></div>",inspire:"<div class='metadataflyout_content_inspire'></div>"}},getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Flyout"},setEl:function(c,b,a){this.container=jQuery(c)},startPlugin:function(){var i=this.locale;var e=jQuery(this.templates.content);var f=this;var c=jQuery(this.templates.viewTabs);var g=jQuery(this.templates.viewTab);for(var j in this.templates.views){var h=c.clone();var l=i.tabs[j];for(var m in l){var a=g.clone();if(typeof l[m]==="string"){a.append(l[m]);h.append(a);if(m!=j){a.click({viewId:m},function(n){var o=n.data;f.showMetadataView(o.viewId)})}}else{var k=l[m].text;var d=l[m].target;a.append(k);h.append(a);a.click({viewId:m,target:d},function(n){var o=n.data;f.openMetadataView(o.viewId,o.target)})}}h.hide();this.tabs[j]=h;e.append(h)}var b=jQuery(this.templates.browseGraphic);this.browseGraphic=b;e.append(b);for(var j in this.templates.views){this.titles[j]=jQuery(this.templates.titles[j]);this.titles[j].append(this.locale[j]);this.views[j]=jQuery(this.templates.views[j]);e.append(this.titles[j]);e.append(this.views[j])}e.append(c);this.alert.insertTo(this.container);
this.container.append(e)},stopPlugin:function(){this.container.empty()},getTitle:function(){return"Metadata"},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a},openMetadataView:function(a,d){var c=this;var b=this.contentState.metadata;this.instance.getLoader().openMetadata(a,b.uuid,b.RS_Identifier_Code,b.RS_Identifier_CodeSpace,function(e){},null,d)},showMetadataView:function(a,e){this.instance.getSandbox().printDebug("ShowMetadataView "+a);var d=this.tabs;var b=this.views;var f=this.titles;for(var c in b){if(c!=a){d[c].hide();f[c].hide();b[c].hide()}else{d[c].show();f[c].show();b[c].hide()}}this.contentState.view=a;this.loadMetadataForState()},loadMetadataForState:function(){var d=this;var b=this.views;var a=this.contentState.view;var c=this.contentState.metadata;d.instance.getLoader().loadMetadata(a,c.uuid,c.RS_Identifier_Code,c.RS_Identifier_CodeSpace,function(i){var f=b[a];f.empty();if(d.instance.getLoader().dev){d.alert.setContent("Development Mode!","error")}var h=jQuery(i);var g=$(h[0].documentElement);window.junkster=h;var e=g.find("a[href]");jQuery.each(e,function(l,j){var m=jQuery(j);var k=m.attr("href");if(!k){return}if(!k[0]=="?"){return}var n=k.split("&");var o={};jQuery.each(n,function(s,r){var q=r.split("=");o[q[0]]=q[1]});m.attr("href",null);m.click({viewId:a,uuid:o.uuid},function(q){var s=q.data;var r=s.uuid;d.showMetadata(r)})});f.append(g);f.fadeIn()})},loadMetadataJSONForState:function(){var b=this;var a=this.contentState.metadata;this.instance.getLoader().loadMetadata("json",a.uuid,a.RS_Identifier_Code,a.RS_Identifier_CodeSpace,function(d){var c=d.mdcs[0];b.processJSON(c)},"json")},processJSON:function(a){var d=a.browseGraphic;var c=a.env;if(d){var b=this.browseGraphic.children("img");if(this.instance.getLoader().dev){b.attr("src","espoo_johtokartta_s.png")}else{b.attr("src",d)}}if(c){this.instance.showExtentOnMap(this.contentState.metadata.uuid,c,a)}},showMetadata:function(a,b,c){this.contentState.metadata.uuid=a;this.contentState.metadata.RS_Identifier_Code=b;this.contentState.metadata.RS_Identifier_CodeSpace=c;this.instance.getSandbox().printDebug("showMetadata { uuid="+a+", view="+this.contentState.view+"}");this.loadMetadataJSONForState();this.showMetadataView(this.contentState.view)},scheduleShowMetadata:function(a,b,c){this.showMetadata(a,b,c)},setContentState:function(a){this.contentState=a;this.loadMetadataJSONForState();this.showMetadataView(this.contentState.view)},getContentState:function(){return this.contentState}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Tile",function(b,a){this.instance=b;this.locale=a;this.container=null;this.template=null},{getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Tile"},setEl:function(c,b,a){this.container=$(c)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(a){this.state=a},refresh:function(){var f=this;var a=f.instance;var e=this.container;var d=this.template;var c=a.getSandbox();var b=e.children(".oskari-tile-status")}},{protocol:["Oskari.userinterface.Tile"]});Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequest",function(a){this._creator=null;this._uuid=a.uuid;this._RS_Identifier_Code=a._RS_Identifier_Code;this._RS_Identifier_CodeSpace=a._RS_Identifier_CodeSpace},{__name:"catalogue.ShowMetadataRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getRS_Identifier_Code:function(){return this._RS_Identifier_Code},getRS_Identifier_CodeSpace:function(){return this._RS_Identifier_CodeSpace}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",function(b,a){this.sandbox=b;this.instance=a},{handleRequest:function(a,b){this.sandbox.printDebug("[Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler] Show Metadata: "+b.getUuid());
this.instance.scheduleShowMetadata(b.getUuid(),b.getRS_Identifier_Code(),b.getRS_Identifier_CodeSpace())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.MetadataLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._layer=null;this._supportedFormats={};this._features=null;this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:false,namedLayersAsArray:true})},{__name:"MetadataLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(a){this.mapModule=a;this.pluginName=a.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("metadatalayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("metadatalayer",null)},init:function(a){},startPlugin:function(a){this._sandbox=a;this._map=this.getMapModule().getMap();this.registerVectorFormats();a.register(this);for(p in this.eventHandlers){a.registerForEventByName(this,p)}},stopPlugin:function(a){for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.unregister(this);this._map=null;this._sandbox=null},start:function(a){},stop:function(a){},eventHandlers:{AfterMapLayerAddEvent:function(a){this.afterMapLayerAddEvent(a)},AfterMapLayerRemoveEvent:function(a){this.afterMapLayerRemoveEvent(a)},FeaturesAvailableEvent:function(a){this.handleFeaturesAvailableEvent(a)},AfterChangeMapLayerOpacityEvent:function(a){this.afterChangeMapLayerOpacityEvent(a)},},onEvent:function(a){return this.eventHandlers[a.getName()].apply(this,[a])},preselectLayers:function(f){var c=this.getMapLayer();var b=this._sandbox;for(var e=0;e<f.length;e++){var d=f[e];var a=d.getId();if(!d.isLayerOfType("VECTOR")){continue}if(c.getId()!=d.getId()){continue}b.printDebug("preselecting "+a);this.addMapLayerToMap(d,true,d.isBaseLayer())}},setMapLayer:function(a){this._layer=a},getMapLayer:function(){return this._layer},registerVectorFormat:function(b,a){this._supportedFormats[b]=a},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({}));this.registerVectorFormat("application/nlsfi-x-openlayers-feature",new function(){this.read=function(a){return a}})},afterMapLayerAddEvent:function(a){this.addMapLayerToMap(a.getMapLayer(),a.getKeepLayersOrder(),a.isBasemap())},afterMapLayerRemoveEvent:function(b){var a=b.getMapLayer();this.removeMapLayerFromMap(a)},afterChangeMapLayerOpacityEvent:function(d){var c=d.getMapLayer();var a=this.getMapLayer();if(!c.isLayerOfType("VECTOR")){return}if(c.getId()!=a.getId()){return}this._sandbox.printDebug("Setting Layer Opacity for "+c.getId()+" to "+c.getOpacity());var b=this._map.getLayersByName("layer_"+c.getId());if(b[0]!=null){b[0].setOpacity(c.getOpacity()/100)}},addMapLayerToMap:function(h,f,b){var d=this.getMapLayer();if(!h.isLayerOfType("VECTOR")){return}if(h.getId()!=d.getId()){return}var i=this._map.getLayersByName("Markers");this._map.removeLayer(i[0],false);var k=new OpenLayers.StyleMap();var g={styleMap:k};var c=h.getStyledLayerDescriptor();if(c){this._sandbox.printDebug(c);var e=this._sldFormat.read(c);window.styleInfo=e;var l=e.namedLayers[0].userStyles;var a=l[0];k.styles["default"]=a}else{this._sandbox.printDebug("NO SLD FOUND")}var j=new OpenLayers.Layer.Vector("layer_"+h.getId(),g);j.opacity=h.getOpacity()/100;this._map.addLayer(j);if(this._features){j.addFeatures(this._features)}this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+h.getId());if(f){this._map.setLayerIndex(j,this._map.layers.length)}else{this._map.setLayerIndex(j,0)}this._map.addLayer(i[0])},removeMapLayerFromMap:function(c){var a=this.getMapLayer();if(!c.isLayerOfType("VECTOR")){return}if(c.getId()!=a.getId()){return}var b=this._map.getLayersByName("layer_"+c.getId());b[0].destroy()},getOLMapLayers:function(b){if(!b.isLayerOfType("VECTOR")){return}var a=this.getMapLayer();if(b.getId()!=a.getId()){return}return this._map.getLayersByName("layer_"+b.getId())},handleFeaturesAvailableEvent:function(a){var g=a.getMapLayer();
if(g==null){return}var e=this.getMapLayer();if(g.getId()!=e.getId()){return}var b=a.getMimeType();var c=a.getFeatures();var f=a.getOp();var i=this._supportedFormats[b];if(!i){return}var d=i.read(c);this._features=d;var h=this._map.getLayersByName("layer_"+g.getId())[0];if(!h){return}if(f&&f=="replace"){h.removeFeatures(h.features)}h.addFeatures(d)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.registerLocalization({lang:"fi",key:"catalogue.bundle.metadataflyout",value:{title:"Metatieto",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/fi/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/fi/metadata.show.portti?",jhs:"/geonetwork/srv/fi/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=fi&title=METATIETOTULOSTE&metadataresource",xml:"/geonetwork/srv/fi/iso19139.xml?",schemas:"/geonetwork/srv/fi/metadata.show.portti.skeemat?","abstract":"/geonetwork/srv/fi/metadata.show.portti.abstract?",},layer:{name:"Metatieto",description:"",orgName:"Paikkatietohakemisto",inspire:"Metatieto"},flyout:{title:"Metatieto","abstract":"Perustiedot",inspire:"INSPIRE",jhs:"JHS",xml:"XML",map:"Kattavuus",pdf:"Tuloste",select_metadata_prompt:"Valitse metatieto kuvakkeista painamalla.",metadata_printout_title:"METATIETOTULOSTE",linkto:"Metatietolinkki",tabs:{"abstract":{"abstract":"",jhs:"N√§yt√§ JHS",inspire:"N√§yt√§ INSPIRE",xml:{text:"Avaa ISO 19139 XML",target:"_blank"},pdf:{text:"Avaa PDF -tuloste",target:"_blank"}},jhs:{"abstract":"N√§yt√§ perustiedot",jhs:"",inspire:"N√§yt√§ INSPIRE",xml:{text:"Avaa ISO 19139 XML",target:"_blank"},pdf:{text:"Avaa PDF -tuloste",target:"_blank"}},inspire:{"abstract":"N√§yt√§ perustiedot",jhs:"N√§yt√§ JHS",inspire:"",xml:{text:"Avaa ISO 19139 XML",target:"_blank"},pdf:{text:"Avaa PDF -tuloste",target:"_blank"}}}},tile:{title:"Metatieto",tooltip:"?"}}});Oskari.registerLocalization({lang:"en",key:"catalogue.bundle.metadataflyout",value:{title:"Metadata",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/en/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/en/metadata.show.portti?",jhs:"/geonetwork/srv/en/metadata.show.portti.jhs158?",xml:"/geonetwork/srv/en/iso19139.xml?",schemas:"/geonetwork/srv/en/metadata.show.portti.skeemat?","abstract":"/geonetwork/srv/en/metadata.show.portti.abstract?",},layer:{name:"Metadata",description:"",orgName:"Metadata",inspire:"Metadata"},flyout:{title:"Metadata","abstract":"Abstract",inspire:"INSPIRE",jhs:"JHS",xml:"XML",map:"Geographic Extent",pdf:"Printout",select_metadata_prompt:"Select metadata by clicking one of the icons.",metadata_printout_title:"METADATA PRINTOUT",linkto:"Link to this Metadata",tabs:{"abstract":{"abstract":"",jhs:"Show JHS metadata",inspire:"Show INSPIRE metadata",xml:{text:"N√§yt√§ ISO 19139 XML",target:"_blank"}},jhs:{"abstract":"Show Abstract",jhs:"",inspire:"Show INSPIRE metadata",xml:{text:"Show ISO 19139 XML",target:"_blank"}},inspire:{"abstract":"Show Abstract",jhs:"Show JHS metadata",inspire:"",xml:{text:"Show ISO 19139 XML",target:"_blank"}}}},tile:{title:"Metadata",tooltip:"?"}}});Oskari.registerLocalization({lang:"sv",key:"catalogue.bundle.metadataflyout",value:{title:"Metadata",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/sv/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/sv/metadata.show.portti?",jhs:"/geonetwork/srv/sv/metadata.show.portti.jhs158?",xml:"/geonetwork/srv/sv/iso19139.xml?",schemas:"/geonetwork/srv/sv/metadata.show.portti.skeemat?","abstract":"/geonetwork/srv/sv/metadata.show.portti.abstract?",},layer:{name:"Metadata",description:"",orgName:"Metadata",inspire:"Metadata"},flyout:{title:"Metadata","abstract":"Abstrakt",inspire:"INSPIRE",jhs:"JHS",xml:"XML",map:"Omfattning",pdf:"Utskrift",select_metadata_prompt:"V√É¬§lj metadata...",metadata_printout_title:"METATIETOTULOSTE",linkto:"Anv√É¬§nd denna l√É¬§nk f√É¬∂r att l√É¬§nka till den h√É¬§r metadatan",tabs:{"abstract":{"abstract":"",jhs:"N√§yt√§ JHS metatieto",inspire:"N√§yt√§ INSPIRE metatieto",xml:"N√§yt√§ ISO 19139 XML"},jhs:{"abstract":"N√§yt√§ vain perustiedot",jhs:"",inspire:"N√§yt√§ INSPIRE metatieto",xml:"N√§yt√§ ISO 19139 XML"},inspire:{"abstract":"N√§yt√§ vain perustiedot",jhs:"N√§yt√§ JHS metatieto",inspire:"",xml:"N√§yt√§ ISO 19139 XML"},xml:{"abstract":"N√§yt√§ vain perustiedot",jhs:"N√§yt√§ JHS metatieto",inspire:"N√§yt√§ INSPIRE metatieto",xml:""},pdf:{"abstract":"N√§yt√§ vain perustiedot",jhs:"N√§yt√§ JHS metatieto",inspire:"N√§yt√§ INSPIRE metatieto",xml:"N√§yt√§ ISO 19139 XML"}}},tile:{title:"Metadata",tooltip:"?"}}});/* This is a packed Oskari bundle (bundle script version Thu May 31 2012 09:56:06 GMT+0300 (Suomen kes√§aika)) */ 
Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance",function(){this.sandbox=null;this.started=false;this.plugins={};this.localization=null;this.ui=null;this._requestHandlers={};this.attachedToDefault=false},{templates:{userguide:'<div class="oskari-userguide"><span class="oskari-prompt"></span><br /><a target="_blank" href="http://www.google.fi/">Google</a></div>'},__name:"userinterface.UserGuide",getName:function(){return this.__name},setSandbox:function(a){this.sandbox=a},getSandbox:function(){return this.sandbox},getLocalization:function(a){if(a){return this._localization[a]}return this._localization},start:function(){var c=this;if(c.started){return}c.started=true;var a=Oskari.$("sandbox");c.sandbox=a;this._localization=Oskari.getLocalization(this.getName());var e=this.getLocalization("title");var d=Oskari.clazz.create("Oskari.userinterface.component.Popover",e,"");this.ui=d;d.setContent($(this.templates.userguide));a.register(c);for(p in c.eventHandlers){a.registerForEventByName(c,p)}this._requestHandlers["userguide.ShowUserGuideRequest"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",a,this);a.addRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var b=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,b);c.createUi()},init:function(){return null},update:function(){},onEvent:function(b){var a=this.eventHandlers[b.getName()];if(!a){return}return a.apply(this,[b])},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(b){var a=this;if(b.getExtension().getName()!=a.getName()){return}var c=b.getViewState()!="close";a.toggleUserInterface(c)}},toggleUserInterface:function(d,a){var b=this;var c=this.ui;if(!d){c.hide()}else{if(!b.attachedToDefault){var a=b.plugins["Oskari.userinterface.Tile"].getEl();c.setPlacement("right");c.attachTo(a);b.attachedToDefault=true}c.show()}},scheduleShowUserGuide:function(h){var k=this;var i=k.ui;var a=h.isToggle();if(a&&i.shown){k.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"close"]);return}k.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"attach"]);var b=jQuery(this.templates.userguide);var f=jQuery("<div />");var e=Oskari.getLang();var j=f.clone();j.append("Lang: "+e);b.append(j);var j=f.clone();j.append("Extension: "+h.getExtension());b.append(j);var j=f.clone();j.append("Context: "+h.getContext());b.append(j);var j=f.clone();j.append("Element: "+(h.getEl()?"YES":"NO"));b.append(j);var c=h.getEl();var g=h.getPlacement();if(g){i.setPlacement(g)}if(!c){if(!k.attachedToDefault){c=k.plugins["Oskari.userinterface.Tile"].getEl();i.attachTo(c);k.attachedToDefault=true}}else{i.hide();k.attachedToDefault=false;i.attachTo(c)}i.setContent(b)},stop:function(){var a=this.sandbox();for(p in this.eventHandlers){a.unregisterFromEventByName(this,p)}a.removeRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var b=a.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);a.request(this,b);this.sandbox.unregister(this);this.started=false},startExtension:function(){this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Tile",this,this.getLocalization("tile"))},stopExtension:function(){this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var a=this;this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequest",function(b){var a=b||{};this._creator=null;this._el=a.el;this._context=a.context;this._extension=a.extension;this._toggle=a.toggle;this._placement=a.placement},{__name:"userguide.ShowUserGuideRequest",getName:function(){return this.__name
},getUuid:function(){return this._uuid},getContext:function(){return this._context},getExtension:function(){return this._extension},getEl:function(){return this._el},isToggle:function(){return this._toggle},getPlacement:function(){return this._placement}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",function(b,a){this.sandbox=b;this.instance=a},{handleRequest:function(a,b){this.sandbox.printDebug("[Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler] Show UserGuide: "+b.getUuid());this.instance.scheduleShowUserGuide(b)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Tile",function(b,a){this.instance=b;this.locale=a;this.container=null;this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Tile"},setEl:function(d,c,a){this.container=jQuery(d);var b=this.container.children(".oskari-tile-status")},getEl:function(){return this.container},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.desciption},getOptions:function(){},refresh:function(){var e=this;var a=e.instance;var d=this.container;var c=this.template;var b=a.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]});Oskari.registerLocalization({lang:"fi",key:"userinterface.UserGuide",value:{title:"Ohje",desc:"",flyout:{title:"Ohje"},tile:{title:"Ohje",}}});Oskari.registerLocalization({lang:"sv",key:"userinterface.UserGuide",value:{title:"Guide",desc:"",flyout:{title:"Guide"},tile:{title:"Guide",}}});Oskari.registerLocalization({lang:"en",key:"userinterface.UserGuide",value:{title:"Guide",desc:"",flyout:{title:"Guide"},tile:{title:"Guide",}}});