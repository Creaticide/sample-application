/**
 * @license
 * Lo-Dash 2.3.0 (Custom Build) <http://lodash.com/>
 * Build: `lodash modern -o ./dist/lodash.js`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

/*!
     * jQuery Migrate - v1.2.1 - 2013-05-08
     * https://github.com/jquery/jquery-migrate
     * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors; Licensed MIT
     */

/*! jQuery UI - v1.9.2 - 2014-06-02
    * http://jqueryui.com
    * Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.slider.js, jquery.ui.tooltip.js
    * Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

/*
   * Original code (c) 2010 Nick Galbreath
   * http://code.google.com/p/stringencoders/source/browse/#svn/trunk/javascript
   *
   * jQuery port (c) 2010 Carlo Zottmann
   * http://github.com/carlo/jquery-base64
   *
   * Permission is hereby granted, free of charge, to any person
   * obtaining a copy of this software and associated documentation
   * files (the "Software"), to deal in the Software without
   * restriction, including without limitation the rights to use,
   * copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the
   * Software is furnished to do so, subject to the following
   * conditions:
   *
   * The above copyright notice and this permission notice shall be
   * included in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
   * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
   * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
   * OTHER DEALINGS IN THE SOFTWARE.
   */

/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

/**
 * Function: pagePosition
 * Calculates the position of an element on the page (see
 * http://code.google.com/p/doctype/wiki/ArticlePageOffset)
 *
 * OpenLayers.Util.pagePosition is based on Yahoo's getXY method, which is
 * Copyright (c) 2006, Yahoo! Inc.
 * All rights reserved.
 * 
 * Redistribution and use of this software in source and binary forms, with or
 * without modification, are permitted provided that the following conditions
 * are met:
 * 
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * 
 * * Neither the name of Yahoo! Inc. nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission of Yahoo! Inc.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 *
 * Parameters:
 * forElement - {DOMElement}
 * 
 * Returns:
 * {Array} two item array, Left value then Top value.
 */

/**
 * APIFunction: getScrollbarWidth
 * This function has been modified by the OpenLayers from the original version,
 *     written by Matthew Eernisse and released under the Apache 2 
 *     license here:
 * 
 *     http://www.fleegix.org/articles/2006/05/30/getting-the-scrollbar-width-in-pixels
 * 
 *     It has been modified simply to cache its value, since it is physically 
 *     impossible that this code could ever run in more than one browser at 
 *     once. 
 * 
 * Returns:
 * {Integer}
 */

// XMLHttpRequest.js Copyright (C) 2010 Sergey Ilinsky (http://www.ilinsky.com)

//   http://www.apache.org/licenses/LICENSE-2.0

/*! jQuery UI - v1.9.2 - 2014-06-02
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.slider.js, jquery.ui.tooltip.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

/* Copyright (c) 2006-2011 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the Clear BSD license.
 * See http://svn.openlayers.org/trunk/openlayers/license.txt for the
 * full text of the license. */

/**
 * Copyright (c) 2011 National Land Survey of Finland.
 */

/*
 * Copyright (c) 2010 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
* jQuery Cookie Plugin v1.2
* https://github.com/carhartl/jquery-cookie
*
* Copyright 2011, Klaus Hartl
* Dual licensed under the MIT or GPL Version 2 licenses.
* http://www.opensource.org/licenses/mit-license.php
* http://www.opensource.org/licenses/GPL-2.0
*/

/** modifications free software  (c) 2009-IV maanmittauslaitos.fi **/

/* Copyright (c) 2006-2008 MetaCarta, Inc., published under the Clear BSD
 * license.  See http://svn.openlayers.org/trunk/openlayers/license.txt for the
 * full text of the license. */

/*
/* Copyright (c) 2006-2008 MetaCarta, Inc., published under the Clear BSD
 * license.  See http://svn.openlayers.org/trunk/openlayers/license.txt for the
 * full text of the license.
 */

/* ===========================================================
 * bootstrap-tooltip.js v2.0.3 (with popover)
 * http://twitter.github.com/bootstrap/javascript.html#tooltips
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ===========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/**
 * @class Oskari.userinterface.component.ProgressSpinner
 *
 * Adaptation of MIT licensed Spinner
 *
 *  http://fgnass.github.com/spin.js/
 *
 */

/**
             * Copyright (c) 2011 Felix Gnass [fgnass at neteye dot de]
             * Licensed under the MIT license
             */

/*! http://mths.be/placeholder v2.0.7 by @mathias */

/**
 * @license RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */

/*! 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */

/**
 * @license
 * (c) 2009-2012 Michael Leibman
 * michael{dot}leibman{at}gmail{dot}com
 * http://github.com/mleibman/slickgrid
 *
 * Distributed under MIT license.
 * All rights reserved.
 *
 * SlickGrid v2.1
 *
 * NOTES:
 *     Cell/row DOM manipulations are done directly bypassing jQuery's DOM manipulation methods.
 *     This increases the speed dramatically, but can only be done safely because there are no event handlers
 *     or data associated with any cell/row DOM nodes.  Cell editors must make sure they implement .destroy()
 *     and do proper cleanup.
 */

// Copyright (c) 2011 Harvest http://getharvest.com

/*
Chosen source: generate output using 'cake build'
Copyright (c) 2011 by Harvest
*/

/*!
 * jQuery imagesLoaded plugin v2.1.1
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

function phi4z(e,t,i,n,a,r,s,o,l){var u,c,d,h,p,f,m,g,v;for(l=r,v=1;15>=v;v++)if(u=Math.sin(l),tanphi=Math.tan(l),o=tanphi*Math.sqrt(1-e*u*u),c=Math.sin(2*l),d=t*l-i*c+n*Math.sin(4*l)-a*Math.sin(6*l),h=t-2*i*Math.cos(2*l)+4*n*Math.cos(4*l)-6*a*Math.cos(6*l),p=2*d+o*(d*d+s)-2*r*(o*d+1),f=e*c*(d*d+s-2*r*d)/(2*o),m=2*(r-d)*(o*h-2/c)-2*h,g=p/(f+m),l+=g,Math.abs(g)<=1e-10)return l;return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(e){var t,i;return t=1+e,i=1-e,Math.sqrt(Math.pow(t,t)*Math.pow(i,i))}(function(){function e(e,t,i){for(var n=(i||0)-1,a=e?e.length:0;++n<a;)if(e[n]===t)return n;return-1}function t(t,i){var n=typeof i;if(t=t.cache,"boolean"==n||null==i)return t[i]?0:-1;"number"!=n&&"string"!=n&&(n="object");var a="number"==n?i:v+i;return t=(t=t[n])&&t[a],"object"==n?t&&e(t,i)>-1?0:-1:t?0:-1}function i(e){var t=this.cache,i=typeof e;if("boolean"==i||null==e)t[e]=!0;else{"number"!=i&&"string"!=i&&(i="object");var n="number"==i?e:v+e,a=t[i]||(t[i]={});"object"==i?(a[n]||(a[n]=[])).push(e):a[n]=!0}}function n(e){return e.charCodeAt(0)}function a(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||"undefined"==typeof i)return 1;if(n>i||"undefined"==typeof n)return-1}return e.index-t.index}function r(e){var t=-1,n=e.length,a=e[0],r=e[n/2|0],s=e[n-1];if(a&&"object"==typeof a&&r&&"object"==typeof r&&s&&"object"==typeof s)return!1;var o=l();o["false"]=o["null"]=o["true"]=o.undefined=!1;var u=l();for(u.array=e,u.cache=o,u.push=i;++t<n;)u.push(e[t]);return u}function s(e){return"\\"+Q[e]}function o(){return f.pop()||[]}function l(){return m.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function u(e){e.length=0,f.length<b&&f.push(e)}function c(e){var t=e.cache;t&&c(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,m.length<b&&m.push(e)}function d(e,t,i){t||(t=0),"undefined"==typeof i&&(i=e?e.length:0);for(var n=-1,a=i-t||0,r=Array(0>a?0:a);++n<a;)r[n]=e[t+n];return r}function h(i){function f(e){return e&&"object"==typeof e&&!Yn(e)&&zn.call(e,"__wrapped__")?e:new m(e)}function m(e,t){this.__chain__=!!t,this.__wrapped__=e}function b(e){function t(){if(n){var e=n.slice();An.apply(e,arguments)}if(this instanceof t){var r=X(i.prototype),s=i.apply(r,e||arguments);return Et(s)?s:r}return i.apply(a,e||arguments)}var i=e[0],n=e[2],a=e[4];return $n(t,e),t}function Q(e,t,i,n,a){if(i){var r=i(e);if("undefined"!=typeof r)return r}var s=Et(e);if(!s)return e;var l=Sn.call(e);if(!U[l])return e;var c=Kn[l];switch(l){case I:case D:return new c(+e);case F:case H:return new c(e);case B:return r=c(e.source,S.exec(e)),r.lastIndex=e.lastIndex,r}var h=Yn(e);if(t){var p=!n;n||(n=o()),a||(a=o());for(var f=n.length;f--;)if(n[f]==e)return a[f];r=h?c(e.length):{}}else r=h?d(e):aa({},e);return h&&(zn.call(e,"index")&&(r.index=e.index),zn.call(e,"input")&&(r.input=e.input)),t?(n.push(e),a.push(r),(h?$t:oa)(e,function(e,s){r[s]=Q(e,t,i,n,a)}),p&&(u(n),u(a)),r):r}function X(e){return Et(e)?Fn(e):{}}function $(e,t,i){if("function"!=typeof e)return $i;if("undefined"==typeof t||!("prototype"in e))return e;var n=e.__bindData__;if("undefined"==typeof n&&(Xn.funcNames&&(n=!e.name),n=n||!Xn.funcDecomp,!n)){var a=Nn.call(e);Xn.funcNames||(n=!O.test(a)),n||(n=N.test(a),$n(e,n))}if(n===!1||n!==!0&&1&n[1])return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,a){return e.call(t,i,n,a)};case 4:return function(i,n,a,r){return e.call(t,i,n,a,r)}}return Ai(e,t)}function et(e){function t(){var e=l?s:this;if(a){var f=a.slice();An.apply(f,arguments)}if((r||c)&&(f||(f=d(arguments)),r&&An.apply(f,r),c&&f.length<o))return n|=16,et([i,h?n:-4&n,f,null,s,o]);if(f||(f=arguments),u&&(i=e[p]),this instanceof t){e=X(i.prototype);var m=i.apply(e,f);return Et(m)?m:e}return i.apply(e,f)}var i=e[0],n=e[1],a=e[2],r=e[3],s=e[4],o=e[5],l=1&n,u=2&n,c=4&n,h=8&n,p=i;return $n(t,e),t}function tt(i,n){var a=-1,s=ct(),o=i?i.length:0,l=o>=y&&s===e,u=[];if(l){var d=r(n);d?(s=t,n=d):l=!1}for(;++a<o;){var h=i[a];s(n,h)<0&&u.push(h)}return l&&c(n),u}function it(e,t,i,n){for(var a=(n||0)-1,r=e?e.length:0,s=[];++a<r;){var o=e[a];if(o&&"object"==typeof o&&"number"==typeof o.length&&(Yn(o)||pt(o))){t||(o=it(o,t,i));var l=-1,u=o.length,c=s.length;for(s.length+=u;++l<u;)s[c++]=o[l]}else i||s.push(o)}return s}function nt(e,t,i,n,a,r){if(i){var s=i(e,t);if("undefined"!=typeof s)return!!s}if(e===t)return 0!==e||1/e==1/t;var l=typeof e,c=typeof t;if(!(e!==e||e&&W[l]||t&&W[c]))return!1;if(null==e||null==t)return e===t;var d=Sn.call(e),h=Sn.call(t);if(d==A&&(d=q),h==A&&(h=q),d!=h)return!1;switch(d){case I:case D:return+e==+t;case F:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case B:case H:return e==kn(t)}var p=d==R;if(!p){var f=zn.call(e,"__wrapped__"),m=zn.call(t,"__wrapped__");if(f||m)return nt(f?e.__wrapped__:e,m?t.__wrapped__:t,i,n,a,r);if(d!=q)return!1;var g=e.constructor,v=t.constructor;if(g!=v&&!(Nt(g)&&g instanceof g&&Nt(v)&&v instanceof v)&&"constructor"in e&&"constructor"in t)return!1}var y=!a;a||(a=o()),r||(r=o());for(var b=a.length;b--;)if(a[b]==e)return r[b]==t;var k=0;if(s=!0,a.push(e),r.push(t),p){if(b=e.length,k=t.length,s=k==e.length,!s&&!n)return s;for(;k--;){var _=b,w=t[k];if(n)for(;_--&&!(s=nt(e[_],w,i,n,a,r)););else if(!(s=nt(e[k],w,i,n,a,r)))break}return s}return sa(t,function(t,o,l){return zn.call(l,o)?(k++,s=zn.call(e,o)&&nt(e[o],t,i,n,a,r)):void 0}),s&&!n&&sa(e,function(e,t,i){return zn.call(i,t)?s=--k>-1:void 0}),y&&(u(a),u(r)),s}function at(e,t,i,n,a){(Yn(t)?$t:oa)(t,function(t,r){var s,o,l=t,u=e[r];if(t&&((o=Yn(t))||la(t))){for(var c=n.length;c--;)if(s=n[c]==t){u=a[c];break}if(!s){var d;i&&(l=i(u,t),(d="undefined"!=typeof l)&&(u=l)),d||(u=o?Yn(u)?u:[]:la(u)?u:{}),n.push(t),a.push(u),d||at(u,t,i,n,a)}}else i&&(l=i(u,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(u=l);e[r]=u})}function rt(e,t){return e+Mn(Qn()*(t-e+1))}function st(i,n,a){var s=-1,l=ct(),d=i?i.length:0,h=[],p=!n&&d>=y&&l===e,f=a||p?o():h;if(p){var m=r(f);m?(l=t,f=m):(p=!1,f=a?f:(u(f),h))}for(;++s<d;){var g=i[s],v=a?a(g,s,i):g;(n?!s||f[f.length-1]!==v:l(f,v)<0)&&((a||p)&&f.push(v),h.push(g))}return p?(u(f.array),c(f)):a&&u(f),h}function ot(e){return function(t,i,n){var a={};i=f.createCallback(i,n,3);var r=-1,s=t?t.length:0;if("number"==typeof s)for(;++r<s;){var o=t[r];e(a,o,i(o,r,t),t)}else oa(t,function(t,n,r){e(a,t,i(t,n,r),r)});return a}}function lt(e,t,i,n,a,r){var s=1&t,o=2&t,l=4&t,u=16&t,c=32&t;if(!o&&!Nt(e))throw new _n;u&&!i.length&&(t&=-17,u=i=!1),c&&!n.length&&(t&=-33,c=n=!1);var d=e&&e.__bindData__;if(d&&d!==!0)return d=d.slice(),!s||1&d[1]||(d[4]=a),!s&&1&d[1]&&(t|=8),!l||4&d[1]||(d[5]=r),u&&An.apply(d[2]||(d[2]=[]),i),c&&An.apply(d[3]||(d[3]=[]),n),d[1]|=t,lt.apply(null,d);var h=1==t||17===t?b:et;return h([e,t,i,n,a,r])}function ut(e){return ea[e]}function ct(){var t=(t=f.indexOf)===yi?e:t;return t}function dt(e){var t,i;return e&&Sn.call(e)==q&&(t=e.constructor,!Nt(t)||t instanceof t)?(sa(e,function(e,t){i=t}),"undefined"==typeof i||zn.call(e,i)):!1}function ht(e){return ta[e]}function pt(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Sn.call(e)==A||!1}function ft(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i=t,t=!1),Q(e,t,"function"==typeof i&&$(i,n,1))}function mt(e,t,i){return Q(e,!0,"function"==typeof t&&$(t,i,1))}function gt(e,t){var i=X(e);return t?aa(i,t):i}function vt(e,t,i){var n;return t=f.createCallback(t,i,3),oa(e,function(e,i,a){return t(e,i,a)?(n=i,!1):void 0}),n}function yt(e,t,i){var n;return t=f.createCallback(t,i,3),kt(e,function(e,i,a){return t(e,i,a)?(n=i,!1):void 0}),n}function bt(e,t,i){var n=[];sa(e,function(e,t){n.push(t,e)});var a=n.length;for(t=$(t,i,3);a--&&t(n[a--],n[a],e)!==!1;);return e}function kt(e,t,i){var n=Jn(e),a=n.length;for(t=$(t,i,3);a--;){var r=n[a];if(t(e[r],r,e)===!1)break}return e}function _t(e){var t=[];return sa(e,function(e,i){Nt(e)&&t.push(i)}),t.sort()}function wt(e,t){return e?zn.call(e,t):!1}function Lt(e){for(var t=-1,i=Jn(e),n=i.length,a={};++t<n;){var r=i[t];a[e[r]]=r}return a}function xt(e){return e===!0||e===!1||e&&"object"==typeof e&&Sn.call(e)==I||!1}function St(e){return e&&"object"==typeof e&&Sn.call(e)==D||!1}function Ot(e){return e&&1===e.nodeType||!1}function Tt(e){var t=!0;if(!e)return t;var i=Sn.call(e),n=e.length;return i==R||i==H||i==A||i==q&&"number"==typeof n&&Nt(e.splice)?!n:(oa(e,function(){return t=!1}),t)}function Ct(e,t,i,n){return nt(e,t,"function"==typeof i&&$(i,n,2))}function Mt(e){return Bn(e)&&!Hn(parseFloat(e))}function Nt(e){return"function"==typeof e}function Et(e){return!(!e||!W[typeof e])}function zt(e){return At(e)&&e!=+e}function Pt(e){return null===e}function At(e){return"number"==typeof e||e&&"object"==typeof e&&Sn.call(e)==F||!1}function Rt(e){return e&&"object"==typeof e&&Sn.call(e)==B||!1}function It(e){return"string"==typeof e||e&&"object"==typeof e&&Sn.call(e)==H||!1}function Dt(e){return"undefined"==typeof e}function jt(e){var t=arguments,i=2;if(!Et(e))return e;if("number"!=typeof t[2]&&(i=t.length),i>3&&"function"==typeof t[i-2])var n=$(t[--i-1],t[i--],2);else i>2&&"function"==typeof t[i-1]&&(n=t[--i]);for(var a=d(arguments,1,i),r=-1,s=o(),l=o();++r<i;)at(e,a[r],n,s,l);return u(s),u(l),e}function Ft(e,t,i){var n={};if("function"!=typeof t){var a=[];sa(e,function(e,t){a.push(t)}),a=tt(a,it(arguments,!0,!1,1));for(var r=-1,s=a.length;++r<s;){var o=a[r];n[o]=e[o]}}else t=f.createCallback(t,i,3),sa(e,function(e,i,a){t(e,i,a)||(n[i]=e)});return n}function qt(e){for(var t=-1,i=Jn(e),n=i.length,a=hn(n);++t<n;){var r=i[t];a[t]=[r,e[r]]}return a}function Bt(e,t,i){var n={};if("function"!=typeof t)for(var a=-1,r=it(arguments,!0,!1,1),s=Et(e)?r.length:0;++a<s;){var o=r[a];o in e&&(n[o]=e[o])}else t=f.createCallback(t,i,3),sa(e,function(e,i,a){t(e,i,a)&&(n[i]=e)});return n}function Ht(e,t,i,n){var a=Yn(e);if(null==i)if(a)i=[];else{var r=e&&e.constructor,s=r&&r.prototype;i=X(s)}return t&&(t=f.createCallback(t,n,4),(a?$t:oa)(e,function(e,n,a){return t(i,e,n,a)})),i}function Ut(e){for(var t=-1,i=Jn(e),n=i.length,a=hn(n);++t<n;)a[t]=e[i[t]];return a}function Gt(e){for(var t=arguments,i=-1,n=it(t,!0,!1,1),a=t[2]&&t[2][t[1]]===e?1:n.length,r=hn(a);++i<a;)r[i]=e[n[i]];return r}function Vt(e,t,i){var n=-1,a=ct(),r=e?e.length:0,s=!1;return i=(0>i?Gn(0,r+i):i)||0,Yn(e)?s=a(e,t,i)>-1:"number"==typeof r?s=(It(e)?e.indexOf(t,i):a(e,t,i))>-1:oa(e,function(e){return++n>=i?!(s=e===t):void 0}),s}function Wt(e,t,i){var n=!0;t=f.createCallback(t,i,3);var a=-1,r=e?e.length:0;if("number"==typeof r)for(;++a<r&&(n=!!t(e[a],a,e)););else oa(e,function(e,i,a){return n=!!t(e,i,a)});return n}function Qt(e,t,i){var n=[];t=f.createCallback(t,i,3);var a=-1,r=e?e.length:0;if("number"==typeof r)for(;++a<r;){var s=e[a];t(s,a,e)&&n.push(s)}else oa(e,function(e,i,a){t(e,i,a)&&n.push(e)});return n}function Kt(e,t,i){t=f.createCallback(t,i,3);var n=-1,a=e?e.length:0;if("number"!=typeof a){var r;return oa(e,function(e,i,n){return t(e,i,n)?(r=e,!1):void 0}),r}for(;++n<a;){var s=e[n];if(t(s,n,e))return s}}function Xt(e,t,i){var n;return t=f.createCallback(t,i,3),Yt(e,function(e,i,a){return t(e,i,a)?(n=e,!1):void 0}),n}function $t(e,t,i){var n=-1,a=e?e.length:0;if(t=t&&"undefined"==typeof i?t:$(t,i,3),"number"==typeof a)for(;++n<a&&t(e[n],n,e)!==!1;);else oa(e,t);return e}function Yt(e,t,i){var n=e?e.length:0;if(t=t&&"undefined"==typeof i?t:$(t,i,3),"number"==typeof n)for(;n--&&t(e[n],n,e)!==!1;);else{var a=Jn(e);n=a.length,oa(e,function(e,i,r){return i=a?a[--n]:--n,t(r[i],i,r)})}return e}function Zt(e,t){var i=d(arguments,2),n=-1,a="function"==typeof t,r=e?e.length:0,s=hn("number"==typeof r?r:0);return $t(e,function(e){s[++n]=(a?t:e[t]).apply(e,i)}),s}function Jt(e,t,i){var n=-1,a=e?e.length:0;if(t=f.createCallback(t,i,3),"number"==typeof a)for(var r=hn(a);++n<a;)r[n]=t(e[n],n,e);else r=[],oa(e,function(e,i,a){r[++n]=t(e,i,a)});return r}function ei(e,t,i){var a=-1/0,r=a;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Yn(e))for(var s=-1,o=e.length;++s<o;){var l=e[s];l>r&&(r=l)}else t=null==t&&It(e)?n:f.createCallback(t,i,3),$t(e,function(e,i,n){var s=t(e,i,n);s>a&&(a=s,r=e)});return r}function ti(e,t,i){var a=1/0,r=a;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Yn(e))for(var s=-1,o=e.length;++s<o;){var l=e[s];r>l&&(r=l)}else t=null==t&&It(e)?n:f.createCallback(t,i,3),$t(e,function(e,i,n){var s=t(e,i,n);a>s&&(a=s,r=e)});return r}function ii(e,t){var i=-1,n=e?e.length:0;if("number"==typeof n)for(var a=hn(n);++i<n;)a[i]=e[i][t];return a||Jt(e,t)}function ni(e,t,i,n){if(!e)return i;var a=arguments.length<3;t=f.createCallback(t,n,4);var r=-1,s=e.length;if("number"==typeof s)for(a&&(i=e[++r]);++r<s;)i=t(i,e[r],r,e);else oa(e,function(e,n,r){i=a?(a=!1,e):t(i,e,n,r)});return i}function ai(e,t,i,n){var a=arguments.length<3;return t=f.createCallback(t,n,4),Yt(e,function(e,n,r){i=a?(a=!1,e):t(i,e,n,r)}),i}function ri(e,t,i){return t=f.createCallback(t,i,3),Qt(e,function(e,i,n){return!t(e,i,n)})}function si(e,t,i){if(e&&"number"!=typeof e.length&&(e=Ut(e)),null==t||i)return e?e[rt(0,e.length-1)]:p;var n=oi(e);return n.length=Vn(Gn(0,t),n.length),n}function oi(e){var t=-1,i=e?e.length:0,n=hn("number"==typeof i?i:0);return $t(e,function(e){var i=rt(0,++t);n[t]=n[i],n[i]=e}),n}function li(e){var t=e?e.length:0;return"number"==typeof t?t:Jn(e).length}function ui(e,t,i){var n;t=f.createCallback(t,i,3);var a=-1,r=e?e.length:0;if("number"==typeof r)for(;++a<r&&!(n=t(e[a],a,e)););else oa(e,function(e,i,a){return!(n=t(e,i,a))});return!!n}function ci(e,t,i){var n=-1,r=e?e.length:0,s=hn("number"==typeof r?r:0);for(t=f.createCallback(t,i,3),$t(e,function(e,i,a){var r=s[++n]=l();r.criteria=t(e,i,a),r.index=n,r.value=e}),r=s.length,s.sort(a);r--;){var o=s[r];s[r]=o.value,c(o)}return s}function di(e){return e&&"number"==typeof e.length?d(e):Ut(e)}function hi(e){for(var t=-1,i=e?e.length:0,n=[];++t<i;){var a=e[t];a&&n.push(a)}return n}function pi(e){return tt(e,it(arguments,!0,!0,1))}function fi(e,t,i){var n=-1,a=e?e.length:0;for(t=f.createCallback(t,i,3);++n<a;)if(t(e[n],n,e))return n;return-1}function mi(e,t,i){var n=e?e.length:0;for(t=f.createCallback(t,i,3);n--;)if(t(e[n],n,e))return n;return-1}function gi(e,t,i){var n=0,a=e?e.length:0;if("number"!=typeof t&&null!=t){var r=-1;for(t=f.createCallback(t,i,3);++r<a&&t(e[r],r,e);)n++}else if(n=t,null==n||i)return e?e[0]:p;return d(e,0,Vn(Gn(0,n),a))}function vi(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(e=Jt(e,i,n)),it(e,t)}function yi(t,i,n){if("number"==typeof n){var a=t?t.length:0;n=0>n?Gn(0,a+n):n||0}else if(n){var r=Ti(t,i);return t[r]===i?r:-1}return e(t,i,n)}function bi(e,t,i){var n=0,a=e?e.length:0;if("number"!=typeof t&&null!=t){var r=a;for(t=f.createCallback(t,i,3);r--&&t(e[r],r,e);)n++}else n=null==t||i?1:t||n;return d(e,0,Vn(Gn(0,a-n),a))}function ki(i){for(var n=arguments,a=n.length,s=-1,l=o(),d=-1,h=ct(),p=i?i.length:0,f=[],m=o();++s<a;){var g=n[s];l[s]=h===e&&(g?g.length:0)>=y&&r(s?n[s]:m)}e:for(;++d<p;){var v=l[0];if(g=i[d],(v?t(v,g):h(m,g))<0){for(s=a,(v||m).push(g);--s;)if(v=l[s],(v?t(v,g):h(n[s],g))<0)continue e;f.push(g)}}for(;a--;)v=l[a],v&&c(v);return u(l),u(m),f}function _i(e,t,i){var n=0,a=e?e.length:0;if("number"!=typeof t&&null!=t){var r=a;for(t=f.createCallback(t,i,3);r--&&t(e[r],r,e);)n++}else if(n=t,null==n||i)return e?e[a-1]:p;return d(e,Gn(0,a-n))}function wi(e,t,i){var n=e?e.length:0;for("number"==typeof i&&(n=(0>i?Gn(0,n+i):Vn(i,n-1))+1);n--;)if(e[n]===t)return n;return-1}function Li(e){for(var t=arguments,i=0,n=t.length,a=e?e.length:0;++i<n;)for(var r=-1,s=t[i];++r<a;)e[r]===s&&(In.call(e,r--,1),a--);return e}function xi(e,t,i){e=+e||0,i="number"==typeof i?i:+i||1,null==t&&(t=e,e=0);for(var n=-1,a=Gn(0,Tn((t-e)/(i||1))),r=hn(a);++n<a;)r[n]=e,e+=i;return r}function Si(e,t,i){var n=-1,a=e?e.length:0,r=[];for(t=f.createCallback(t,i,3);++n<a;){var s=e[n];t(s,n,e)&&(r.push(s),In.call(e,n--,1),a--)}return r}function Oi(e,t,i){if("number"!=typeof t&&null!=t){var n=0,a=-1,r=e?e.length:0;for(t=f.createCallback(t,i,3);++a<r&&t(e[a],a,e);)n++}else n=null==t||i?1:Gn(0,t);return d(e,n)}function Ti(e,t,i,n){var a=0,r=e?e.length:a;for(i=i?f.createCallback(i,n,1):$i,t=i(t);r>a;){var s=a+r>>>1;i(e[s])<t?a=s+1:r=s}return a}function Ci(){return st(it(arguments,!0,!0))}function Mi(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(i=f.createCallback(i,n,3)),st(e,t,i)}function Ni(e){return tt(e,d(arguments,1))}function Ei(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,i=e?ei(ii(e,"length")):0,n=hn(0>i?0:i);++t<i;)n[t]=ii(e,t);return n}function zi(e,t){for(var i=-1,n=e?e.length:0,a={};++i<n;){var r=e[i];t?a[r]=t[i]:r&&(a[r[0]]=r[1])}return a}function Pi(e,t){if(!Nt(t))throw new _n;return function(){return--e<1?t.apply(this,arguments):void 0}}function Ai(e,t){return arguments.length>2?lt(e,17,d(arguments,2),null,t):lt(e,1,null,null,t)}function Ri(e){for(var t=arguments.length>1?it(arguments,!0,!1,1):_t(e),i=-1,n=t.length;++i<n;){var a=t[i];e[a]=lt(e[a],1,null,null,e)}return e}function Ii(e,t){return arguments.length>2?lt(t,19,d(arguments,2),null,e):lt(t,3,null,null,e)}function Di(){for(var e=arguments,t=e.length;t--;)if(!Nt(e[t]))throw new _n;return function(){for(var t=arguments,i=e.length;i--;)t=[e[i].apply(this,t)];return t[0]}}function ji(e,t,i){var n=typeof e;if(null==e||"function"==n)return $(e,t,i);if("object"!=n)return function(t){return t[e]};var a=Jn(e),r=a[0],s=e[r];return 1!=a.length||s!==s||Et(s)?function(t){for(var i=a.length,n=!1;i--&&(n=nt(t[a[i]],e[a[i]],null,!0)););return n}:function(e){var t=e[r];return s===t&&(0!==s||1/s==1/t)}}function Fi(e,t){return t="number"==typeof t?t:+t||e.length,lt(e,4,null,null,null,t)}function qi(e,t,i){var n,a,r,s,o,l,u,c=0,d=!1,h=!0;if(!Nt(e))throw new _n;if(t=Gn(0,t)||0,i===!0){var f=!0;h=!1}else Et(i)&&(f=i.leading,d="maxWait"in i&&(Gn(t,i.maxWait)||0),h="trailing"in i?i.trailing:h);var m=function(){var i=t-(Pn()-s);if(0>=i){a&&Cn(a);var d=u;a=l=u=p,d&&(c=Pn(),r=e.apply(o,n),l||a||(n=o=null))}else l=Rn(m,i)},g=function(){l&&Cn(l),a=l=u=p,(h||d!==t)&&(c=Pn(),r=e.apply(o,n),l||a||(n=o=null))};return function(){if(n=arguments,s=Pn(),o=this,u=h&&(l||!f),d===!1)var i=f&&!l;else{a||f||(c=s);var p=d-(s-c),v=0>=p;v?(a&&(a=Cn(a)),c=s,r=e.apply(o,n)):a||(a=Rn(g,p))}return v&&l?l=Cn(l):l||t===d||(l=Rn(m,t)),i&&(v=!0,r=e.apply(o,n)),!v||l||a||(n=o=null),r}}function Bi(e){if(!Nt(e))throw new _n;var t=d(arguments,1);return Rn(function(){e.apply(p,t)},1)}function Hi(e,t){if(!Nt(e))throw new _n;var i=d(arguments,2);return Rn(function(){e.apply(p,i)},t)}function Ui(e,t){if(!Nt(e))throw new _n;var i=function(){var n=i.cache,a=t?t.apply(this,arguments):v+arguments[0];return zn.call(n,a)?n[a]:n[a]=e.apply(this,arguments)};return i.cache={},i}function Gi(e){var t,i;if(!Nt(e))throw new _n;return function(){return t?i:(t=!0,i=e.apply(this,arguments),e=null,i)}}function Vi(e){return lt(e,16,d(arguments,1))}function Wi(e){return lt(e,32,null,d(arguments,1))}function Qi(e,t,i){var n=!0,a=!0;if(!Nt(e))throw new _n;return i===!1?n=!1:Et(i)&&(n="leading"in i?i.leading:n,a="trailing"in i?i.trailing:a),G.leading=n,G.maxWait=t,G.trailing=a,qi(e,t,G)}function Ki(e,t){return lt(t,16,[e])}function Xi(e){return null==e?"":kn(e).replace(na,ut)}function $i(e){return e}function Yi(e,t){var i=e,n=!t||Nt(i);t||(i=m,t=e,e=f),$t(_t(t),function(a){var r=e[a]=t[a];n&&(i.prototype[a]=function(){var t=this.__wrapped__,n=[t];An.apply(n,arguments);var a=r.apply(e,n);return t&&"object"==typeof t&&t===a?this:(a=new i(a),a.__chain__=this.__chain__,a)})})}function Zi(){return i._=xn,this}function Ji(){}function en(e,t,i){var n=null==e,a=null==t;if(null==i&&("boolean"==typeof e&&a?(i=e,e=1):a||"boolean"!=typeof t||(i=t,a=!0)),n&&a&&(t=1),e=+e||0,a?(t=e,e=0):t=+t||0,i||e%1||t%1){var r=Qn();return Vn(e+r*(t-e+parseFloat("1e-"+((r+"").length-1))),t)}return rt(e,t)}function tn(e,t){if(e){var i=e[t];return Nt(i)?e[t]():i}}function nn(e,t,i){var n=f.templateSettings;e=kn(e||""),i=ra({},i,n);var a,r=ra({},i.imports,n.imports),o=Jn(r),l=Ut(r),u=0,c=i.interpolate||M,d="__p += '",h=bn((i.escape||M).source+"|"+c.source+"|"+(c===T?x:M).source+"|"+(i.evaluate||M).source+"|$","g");e.replace(h,function(t,i,n,r,o,l){return n||(n=r),d+=e.slice(u,l).replace(E,s),i&&(d+="' +\n__e("+i+") +\n'"),o&&(a=!0,d+="';\n"+o+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=l+t.length,t}),d+="';\n";var m=i.variable,g=m;g||(m="obj",d="with ("+m+") {\n"+d+"\n}\n"),d=(a?d.replace(_,""):d).replace(w,"$1").replace(L,"$1;"),d="function("+m+") {\n"+(g?"":m+" || ("+m+" = {});\n")+"var __t, __p = '', __e = _.escape"+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var v="\n/*\n//# sourceURL="+(i.sourceURL||"/lodash/template/source["+P++ +"]")+"\n*/";try{var y=mn(o,"return "+d+v).apply(p,l)}catch(b){throw b.source=d,b}return t?y(t):(y.source=d,y)}function an(e,t,i){e=(e=+e)>-1?e:0;var n=-1,a=hn(e);for(t=$(t,i,1);++n<e;)a[n]=t(n);return a}function rn(e){return null==e?"":kn(e).replace(ia,ht)}function sn(e){var t=++g;return kn(null==e?"":e)+t}function on(e){return e=new m(e),e.__chain__=!0,e}function ln(e,t){return t(e),e}function un(){return this.__chain__=!0,this}function cn(){return kn(this.__wrapped__)}function dn(){return this.__wrapped__}i=i?J.defaults(K.Object(),i,J.pick(K,z)):K;var hn=i.Array,pn=i.Boolean,fn=i.Date,mn=i.Function,gn=i.Math,vn=i.Number,yn=i.Object,bn=i.RegExp,kn=i.String,_n=i.TypeError,wn=[],Ln=yn.prototype,xn=i._,Sn=Ln.toString,On=bn("^"+kn(Sn).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Tn=gn.ceil,Cn=i.clearTimeout,Mn=gn.floor,Nn=mn.prototype.toString,En=On.test(En=yn.getPrototypeOf)&&En,zn=Ln.hasOwnProperty,Pn=On.test(Pn=fn.now)&&Pn||function(){return+new fn},An=wn.push,Rn=i.setTimeout,In=wn.splice,Dn="function"==typeof(Dn=Z&&Y&&Z.setImmediate)&&!On.test(Dn)&&Dn,jn=function(){try{var e={},t=On.test(t=yn.defineProperty)&&t,i=t(e,e,e)&&t}catch(n){}return i}(),Fn=On.test(Fn=yn.create)&&Fn,qn=On.test(qn=hn.isArray)&&qn,Bn=i.isFinite,Hn=i.isNaN,Un=On.test(Un=yn.keys)&&Un,Gn=gn.max,Vn=gn.min,Wn=i.parseInt,Qn=gn.random,Kn={};Kn[R]=hn,Kn[I]=pn,Kn[D]=fn,Kn[j]=mn,Kn[q]=yn,Kn[F]=vn,Kn[B]=bn,Kn[H]=kn,m.prototype=f.prototype;var Xn=f.support={};Xn.funcDecomp=!On.test(i.WinRTError)&&N.test(h),Xn.funcNames="string"==typeof mn.name,f.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:T,variable:"",imports:{_:f}},Fn||(X=function(){function e(){}return function(t){if(Et(t)){e.prototype=t;var n=new e;e.prototype=null}return n||i.Object()}}());var $n=jn?function(e,t){V.value=t,jn(e,"__bindData__",V)}:Ji,Yn=qn||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Sn.call(e)==R||!1},Zn=function(e){var t,i=e,n=[];if(!i)return n;if(!W[typeof e])return n;for(t in i)zn.call(i,t)&&n.push(t);return n},Jn=Un?function(e){return Et(e)?Un(e):[]}:Zn,ea={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ta=Lt(ea),ia=bn("("+Jn(ta).join("|")+")","g"),na=bn("["+Jn(ea).join("")+"]","g"),aa=function(e,t,i){var n,a=e,r=a;if(!a)return r;var s=arguments,o=0,l="number"==typeof i?2:s.length;if(l>3&&"function"==typeof s[l-2])var u=$(s[--l-1],s[l--],2);else l>2&&"function"==typeof s[l-1]&&(u=s[--l]);for(;++o<l;)if(a=s[o],a&&W[typeof a])for(var c=-1,d=W[typeof a]&&Jn(a),h=d?d.length:0;++c<h;)n=d[c],r[n]=u?u(r[n],a[n]):a[n];return r},ra=function(e,t,i){var n,a=e,r=a;if(!a)return r;for(var s=arguments,o=0,l="number"==typeof i?2:s.length;++o<l;)if(a=s[o],a&&W[typeof a])for(var u=-1,c=W[typeof a]&&Jn(a),d=c?c.length:0;++u<d;)n=c[u],"undefined"==typeof r[n]&&(r[n]=a[n]);return r},sa=function(e,t,i){var n,a=e,r=a;if(!a)return r;if(!W[typeof a])return r;t=t&&"undefined"==typeof i?t:$(t,i,3);for(n in a)if(t(a[n],n,e)===!1)return r;return r},oa=function(e,t,i){var n,a=e,r=a;if(!a)return r;if(!W[typeof a])return r;t=t&&"undefined"==typeof i?t:$(t,i,3);for(var s=-1,o=W[typeof a]&&Jn(a),l=o?o.length:0;++s<l;)if(n=o[s],t(a[n],n,e)===!1)return r;return r},la=function(e){if(!e||Sn.call(e)!=q)return!1;var t=e.valueOf,i="function"==typeof t&&(i=En(t))&&En(i);return i?e==i||En(e)==i:dt(e)},ua=ot(function(e,t,i){zn.call(e,i)?e[i]++:e[i]=1}),ca=ot(function(e,t,i){(zn.call(e,i)?e[i]:e[i]=[]).push(t)}),da=ot(function(e,t,i){e[i]=t}),ha=Qt;Dn&&(Bi=function(e){if(!Nt(e))throw new _n;return Dn.apply(i,arguments)});var pa=8==Wn(k+"08")?Wn:function(e,t){return Wn(It(e)?e.replace(C,""):e,t||0)};return f.after=Pi,f.assign=aa,f.at=Gt,f.bind=Ai,f.bindAll=Ri,f.bindKey=Ii,f.chain=on,f.compact=hi,f.compose=Di,f.countBy=ua,f.create=gt,f.createCallback=ji,f.curry=Fi,f.debounce=qi,f.defaults=ra,f.defer=Bi,f.delay=Hi,f.difference=pi,f.filter=Qt,f.flatten=vi,f.forEach=$t,f.forEachRight=Yt,f.forIn=sa,f.forInRight=bt,f.forOwn=oa,f.forOwnRight=kt,f.functions=_t,f.groupBy=ca,f.indexBy=da,f.initial=bi,f.intersection=ki,f.invert=Lt,f.invoke=Zt,f.keys=Jn,f.map=Jt,f.max=ei,f.memoize=Ui,f.merge=jt,f.min=ti,f.omit=Ft,f.once=Gi,f.pairs=qt,f.partial=Vi,f.partialRight=Wi,f.pick=Bt,f.pluck=ii,f.pull=Li,f.range=xi,f.reject=ri,f.remove=Si,f.rest=Oi,f.shuffle=oi,f.sortBy=ci,f.tap=ln,f.throttle=Qi,f.times=an,f.toArray=di,f.transform=Ht,f.union=Ci,f.uniq=Mi,f.values=Ut,f.where=ha,f.without=Ni,f.wrap=Ki,f.zip=Ei,f.zipObject=zi,f.collect=Jt,f.drop=Oi,f.each=$t,f.eachRight=Yt,f.extend=aa,f.methods=_t,f.object=zi,f.select=Qt,f.tail=Oi,f.unique=Mi,f.unzip=Ei,Yi(f),f.clone=ft,f.cloneDeep=mt,f.contains=Vt,f.escape=Xi,f.every=Wt,f.find=Kt,f.findIndex=fi,f.findKey=vt,f.findLast=Xt,f.findLastIndex=mi,f.findLastKey=yt,f.has=wt,f.identity=$i,f.indexOf=yi,f.isArguments=pt,f.isArray=Yn,f.isBoolean=xt,f.isDate=St,f.isElement=Ot,f.isEmpty=Tt,f.isEqual=Ct,f.isFinite=Mt,f.isFunction=Nt,f.isNaN=zt,f.isNull=Pt,f.isNumber=At,f.isObject=Et,f.isPlainObject=la,f.isRegExp=Rt,f.isString=It,f.isUndefined=Dt,f.lastIndexOf=wi,f.mixin=Yi,f.noConflict=Zi,f.noop=Ji,f.parseInt=pa,f.random=en,f.reduce=ni,f.reduceRight=ai,f.result=tn,f.runInContext=h,f.size=li,f.some=ui,f.sortedIndex=Ti,f.template=nn,f.unescape=rn,f.uniqueId=sn,f.all=Wt,f.any=ui,f.detect=Kt,f.findWhere=Kt,f.foldl=ni,f.foldr=ai,f.include=Vt,f.inject=ni,oa(f,function(e,t){f.prototype[t]||(f.prototype[t]=function(){var t=[this.__wrapped__],i=this.__chain__;An.apply(t,arguments);var n=e.apply(f,t);return i?new m(n,i):n})}),f.first=gi,f.last=_i,f.sample=si,f.take=gi,f.head=gi,oa(f,function(e,t){var i="sample"!==t;f.prototype[t]||(f.prototype[t]=function(t,n){var a=this.__chain__,r=e(this.__wrapped__,t,n);return a||null!=t&&(!n||i&&"function"==typeof t)?new m(r,a):r})}),f.VERSION="2.3.0",f.prototype.chain=un,f.prototype.toString=cn,f.prototype.value=dn,f.prototype.valueOf=dn,$t(["join","pop","shift"],function(e){var t=wn[e];f.prototype[e]=function(){var e=this.__chain__,i=t.apply(this.__wrapped__,arguments);return e?new m(i,e):i}}),$t(["push","reverse","sort","unshift"],function(e){var t=wn[e];f.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),$t(["concat","slice","splice"],function(e){var t=wn[e];f.prototype[e]=function(){return new m(t.apply(this.__wrapped__,arguments),this.__chain__)}}),f}var p,f=[],m=[],g=0,v=+new Date+"",y=75,b=40,k=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",_=/\b__p \+= '';/g,w=/\b(__p \+=) '' \+/g,L=/(__e\(.*?\)|\b__t\)) \+\n'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,S=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,T=/<%=([\s\S]+?)%>/g,C=RegExp("^["+k+"]*0+(?=.$)"),M=/($^)/,N=/\bthis\b/,E=/['\n\r\t\u2028\u2029\\]/g,z=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],P=0,A="[object Arguments]",R="[object Array]",I="[object Boolean]",D="[object Date]",j="[object Function]",F="[object Number]",q="[object Object]",B="[object RegExp]",H="[object String]",U={};U[j]=!1,U[A]=U[R]=U[I]=U[D]=U[F]=U[q]=U[B]=U[H]=!0;var G={leading:!1,maxWait:0,trailing:!1},V={configurable:!1,enumerable:!1,value:null,writable:!1},W={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Q={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},K=W[typeof window]&&window||this,X=W[typeof exports]&&exports&&!exports.nodeType&&exports,$=W[typeof module]&&module&&!module.nodeType&&module,Y=$&&$.exports===X&&X,Z=W[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(K=Z);var J=h();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(K._=J,define("lodash",[],function(){return J})):X&&$?Y?($.exports=J)._=J:X._=J:K._=J}).call(this),function(){var e=this,t=!1,n=null!=window.console&&window.console.debug,a=function(e){t&&n&&window.console.debug(e)},s=function(){this.lang=null,this.localizations={},this.supportedLocales=null};s.prototype={setLocalization:function(e,t,i){this.localizations[e]||(this.localizations[e]={}),this.localizations[e][t]=i},setLang:function(e){this.lang=e},setSupportedLocales:function(e){this.supportedLocales=e},getLang:function(){return this.lang},getLocalization:function(e){return this.localizations[this.lang][e]},getSupportedLocales:function(){return this.supportedLocales?this.supportedLocales:[]},getDefaultLanguage:function(){var e=this.supportedLocales[0];return e.substring(0,e.indexOf("_"))},getSupportedLanguages:function(){var e,t,i=[];for(t=0;t<this.supportedLocales.length;t+=1)e=this.supportedLocales[t],i.push(e.substring(0,e.indexOf("_")));return i}};var o=new s,l=!1,u="default",c=!0,d=function(){this.packages={},this.protocols={},this.inheritance={},this.aspects={},this.clazzcache={},this.globals={}};d.prototype={purge:function(){},protocol:function(){var e=arguments;if(0==e.length)throw"missing arguments";return this.protocols[e[0]]},pdefsp:function(e){var t=this.clazzcache[e],i=null,n=null;if(!t){var a=e.split("."),i=(a[0],a[1]),n=a.slice(2).join("."),r=this.packages[i];r||(r={},this.packages[i]=r),t=r[n],this.clazzcache[e]=t}return t},metadata:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=e[0],i=this.pdefsp(t);if(!i)throw"clazz "+t+" does not exist";return i._metadata},updateMetadata:function(e,t,i,n,a){n._metadata||(n._metadata={}),n._metadata.meta=a;var r=a.protocol;if(r)for(var s=0;s<r.length;s++){var o=r[s];this.protocols[o]||(this.protocols[o]={});var l=e+"."+t+"."+i;this.protocols[o][l]=n}},_super:function(){var e=arguments[0],t=arguments[1],i=this;return function(){return i._._superCategory[e][t].apply(i,arguments)}},define:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=e[0],i=t.split("."),n=i[0],a=i[1],r=i.slice(2).join("."),s=this.packages[a];s||(s={},this.packages[a]=s);var o=s[r];if(o){e[1]&&(o._constructor=e[1]);var l=e[2],u=o._class.prototype;for(p in l){var c=l[p];u[p]=c}var d=t;if(l&&(o._category[d]=l),e.length>3){for(var h=e[3].extend,f=0;h&&f<h.length;f++){var m=this.lookup(h[f]);m._composition.subClazz||(m._composition.subClazz={}),m._composition.subClazz[h[f]]=o,o._composition.superClazz=m}this.updateMetadata(n,a,r,o,e[3])}return this.pullDown(o),this.pushDown(o),o}var g=function(){},v={clazzName:t,superClazz:null,subClazz:null};g.prototype={},o={_class:g,_constructor:e[1],_category:{},_composition:v},g.prototype._=o,g.prototype._super=this._super;var l=e[2],u=g.prototype;for(p in l){var c=l[p];u[p]=c}var d=t;if(l&&(o._category[d]=l),this.inheritance[t]=v,s[r]=o,e.length>3){for(var h=e[3].extend,f=0;h&&f<h.length;f++){var m=this.lookup(h[f]);m._composition.subClazz||(m._composition.subClazz={}),m._composition.subClazz[t]=o,o._composition.superClazz=m}this.updateMetadata(n,a,r,o,e[3])}return this.pullDown(o),this.pushDown(o),o},category:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=e[0],i=t.split("."),n=(i[0],i[1]),a=i.slice(2).join("."),r=this.packages[n];r||(r={},this.packages[n]=r);var s=r[a];if(!s){var o=function(){},l={clazzName:t,superClazz:null,subClazz:null};
o.prototype={},s={_class:o,_constructor:e[1],_category:{},_composition:l},o.prototype._=s,o.prototype._super=this._super,this.inheritance[t]=l,r[a]=s}var u=e[1],c=e[2],d=s._class.prototype;for(p in c){var h=c[p];d[p]=h}return c&&(s._category[u]=c),this.pullDown(s),this.pushDown(s),s},lookup:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=e[0],i=t.split("."),n=(i[0],i[1]),a=i.slice(2).join("."),r=this.packages[n];r||(r={},this.packages[n]=r);var s=r[a];if(!s){var o=function(){};o.prototype={};var l={clazzName:t,superClazz:null,subClazz:null};s={_class:o,_constructor:e[1],_category:{},_composition:l},this.inheritance[t]=l,r[a]=s}return s},extend:function(){var e=arguments,t=this.lookup(e[1]),i=this.lookup(e[0]);return t._composition.subClazz||(t._composition.subClazz={}),t._composition.subClazz[e[0]]=i,i._composition.superClazz=t,this.pullDown(i),i},composition:function(){var e=arguments[0],t=this.pdefsp(e);return t},pushDown:function(e){if(e._composition.subClazz){for(var t in e._composition.subClazz){var i=e._composition.subClazz[t];this.pullDown(i),this.pushDown(i)}return e}},pullDown:function(e){if(e._composition.superClazz){var t=[];t.push(e);for(var i=e;;){if(i=i._composition.superClazz,!i)break;t.push(i)}for(var n=e._class.prototype,a=[],r={},s=t.length-1;s>=0;s--){var o=t[s]._composition.clazzName,l=t[s]._constructor;a.push(l);var u={};for(var c in t[s]._category){var d=t[s]._category[c];for(p in d){var h=d[p];n[p]=h,u[p]=h}}r[o]=u}return e._constructors=a,e._superCategory=r,e}},slicer:Array.prototype.slice,create:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=this.slicer.apply(arguments,[1]),i=e[0],n=this.pdefsp(i);if(!n)throw"clazz "+i+" does not exist";var a=new n._class,r=n._constructors;if(r)for(var s=0;s<r.length;s++)r[s].apply(a,t);else n._constructor.apply(a,t);return a},createWithPdefsp:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=arguments[1],i=e[0];if(!i)throw"clazz does not exist";var n=new i._class,a=i._constructors;if(a)for(var r=0;r<a.length;r++)a[r].apply(n,t);else i._constructor.apply(n,t);return n},construct:function(){var e=arguments;if(2!=e.length)throw"missing arguments";var t=e[0],i=(e[1],this.pdefsp(t));if(!i)throw"clazz "+t+" does not exist";var n=new i._class,a=i._constructors;if(a)for(var r=0;r<a.length;r++)a[r].apply(n,instargs);else i._constructor.apply(n,instargs);return n},builder:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=e[0],i=this.pdefsp(t);if(!i)throw"clazz "+t+" does not exist";return i._builder?i._builder:(i._builder=function(){var e=arguments,t=new i._class,n=i._constructors;if(n)for(var a=0;a<n.length;a++)n[a].apply(t,e);else i._constructor.apply(t,e);return t},i._builder)},builderFromPdefsp:function(){var e=arguments;if(0==e.length)throw"missing arguments";var t=e[0];if(!t)throw"clazz does not exist";return t._builder?t._builder:(t._builder=function(){var e=arguments,i=new t._class,n=t._constructors;if(n)for(var a=0;a<n.length;a++)n[a].apply(i,e);else t._constructor.apply(i,e);return i},t._builder)},global:function(){if(0==arguments.length)return this.globals;var e=arguments[0];return 2==arguments.length&&(this.globals[e]=arguments[1]),this.globals[e]}};var h=new d,f=h,m=function(e){this.manager=null;for(p in e)this[p]=e[p]};m.prototype={setState:function(e){return this.state=e,this.manager.postChange(this.bundle,this.instance,this.state),this.state},getState:function(){return this.state}};var g=function(e,t,i){this.config=e,this.callback=t,this.fired=!1,this.info=i};g.prototype={execute:function(e,t,i,n){var a=this;if(!a.fired){for(p in a.config["Import-Bundle"]){var r=e.stateForBundleSources[p];if(!r||1!=r.state)return void e.log("trigger not fired due "+p+" for "+n||this.info)}a.fired=!0,e.log("posting trigger");var s=this.callback;window.setTimeout(function(){s(e)},0)}}},f.define("Oskari.BundleManager",function(){this.serial=0,this.impls={},this.sources={},this.instances={},this.bundles={},this.stateForBundleDefinitions={},this.stateForBundleSources={},this.stateForBundles={},this.stateForBundleInstances={},this.triggers=[],this.loaderStateListeners=[]},{purge:function(){for(var e in this.sources)delete this.sources[e];for(var e in this.stateForBundleDefinitions)delete this.stateForBundleDefinitions[e].loader;for(var e in this.stateForBundleSources)delete this.stateForBundleSources[e].loader},notifyLoaderStateChanged:function(e,t){if(0!=this.loaderStateListeners.length)for(var i=0;i<this.loaderStateListeners.length;i++){var n=this.loaderStateListeners[i];n(e,t)}},registerLoaderStateListener:function(e){this.loaderStateListeners.push(e)},alert:function(e){a(e)},log:function(e){a(e)},self:function(){return this},install:function(e,t,i,n){var a=this,r=e,s=a.stateForBundleDefinitions[r];s?(s.state=1,a.log("SETTING STATE FOR BUNDLEDEF "+r+" existing state to "+s.state)):(s={state:1},a.stateForBundleDefinitions[r]=s,a.log("SETTING STATE FOR BUNDLEDEF "+r+" NEW state to "+s.state)),s.metadata=n,a.impls[r]=t,a.sources[r]=i;var o=a.stateForBundleSources[r];o&&(-1==o.state?(a.log("triggering loadBundleSources for "+r+" at loadBundleDefinition"),window.setTimeout(function(){a.loadBundleSources(r)},0)):a.log("source state for "+r+" at loadBundleDefinition is "+o.state)),a.postChange(null,null,"bundle_definition_loaded")},installBundleClass:function(e,t){var i=f.metadata(t),n=f.builder(t),a=i.meta.source,r=i.meta.bundle;this.install(e,n,a,r)},installBundlePdefsp:function(e,t){var i=f.builderFromPdefsp(t),n=t._metadata,a={};this.install(e,i,a,n)},impl:function(e){return this.impls[e]},postChange:function(e,t,n){var a=this;a.update(e,t,n);for(bid in a.bundles){var r=a.bundles[bid];r.update(a,e,t,n)}for(i in a.instances){var r=a.instances[i];r&&r.update(a,e,t,n)}},createBundle:function(e,t){var i=e,n=this,a=n.stateForBundleDefinitions[i];if(!a)throw"INVALID_STATE: for createBundle / definition not loaded "+e+"/"+t;var r=this.impls[e];if(!r)return void alert("this.impls["+e+"] is null!");var s=r(a);return this.bundles[t]=s,this.stateForBundles[t]={state:!0,bundlImpl:i},this.postChange(s,null,"bundle_created"),s},update:function(e,t,i){var n=this;n.log("update called with info "+i);for(var a=0;a<n.triggers.length;a++){var r=n.triggers[a];r.execute(n)}},bundle:function(e){return this.bundles[e]},destroyBundle:function(){},uninstall:function(e){var t=this.impls[e];return t},createInstance:function(e){var t=this;if(!t.stateForBundles[e]||!t.stateForBundles[e].state)throw"INVALID_STATE: for createInstance / definition not loaded "+e;var i=""+ ++this.serial,n=this.bundles[e],a=n.create();return a.mediator=new m({bundleId:e,instanceid:i,state:"initial",bundle:n,instance:a,manager:this,clazz:f,requestMediator:{}}),this.instances[i]=a,this.stateForBundleInstances[i]={state:!0,bundleid:e},this.postChange(n,a,"instance_created"),a},instance:function(e){return this.instances[e]},destroyInstance:function(e){var t=this.instances[e],i=t.mediator;return i.bundle=null,i.manager=null,i.clazz=null,t.mediator=null,this.instances[e]=null,t=null},on:function(e,t,i){this.triggers.push(new g(e,t,i))}}),f.define("Oskari.BundleFacade",function(e){this.manager=e,this.bundles={},this.bundleInstances={},this.appSetup=null,this.bundlePath="",this.appConfig={}},{getBundleInstanceByName:function(e){var t=this;return t.bundleInstances[e]},getBundleInstanceConfigurationByName:function(e){var t=this;return t.appConfig[e]},setConfiguration:function(e){this.appConfig=e},getConfiguration:function(){return this.appConfig}});var v=f.create("Oskari.BundleManager");v.clazz=f;var y=f.create("Oskari.BundleFacade",v),b=f.global;f.define("Oskari.DomManager",function(e){this.$=e},{getEl:function(e){return this.$(e)},getElForPart:function(){throw"N/A"},setElForPart:function(){throw"N/A"},setElParts:function(){throw"N/A"},getElParts:function(){throw"N/A"},pushLayout:function(){throw"N/A"},popLayout:function(){throw"N/A"},getLayout:function(){throw"N/A"}});var k=f.create("Oskari.DomManager"),_=0,w=0,L=0;f.define("Oskari.ClazzWrapper",function(e,t){this.cs=f,this.clazzInfo=e,this.clazzName=t},{slicer:Array.prototype.slice,category:function(e,t){var i=f.category(this.clazzName,t||["__",++w].join("_"),e);return this.clazzInfo=i,this},methods:function(e,t){var i=f.category(this.clazzName,t||["__",++w].join("_"),e);return this.clazzInfo=i,this},extend:function(e){var t=typeof e;if("string"===t){var i=f.extend(this.clazzName,e.length?e:[e]);this.clazzInfo=i}else{if("object"!==t||!e.length){var n=Oskari.cls();return n.extend(this.clazzName),e&&n.category(e),n}var i=f.extend(this.clazzName,e.length?e:[e]);this.clazzInfo=i}return this},create:function(){return f.createWithPdefsp(this.clazzInfo,arguments)},name:function(){return this.clazzName},metadata:function(){return f.metadata(this.clazzName)},events:function(e){var t=this;return t.category({eventHandlers:e,onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])}},"___events"),t},requests:function(e){var t=this;return t.category({requestHandlers:e,onRequest:function(e){var t=this.requestHandlers[e.getName()];if(t)return t.apply(this,[e])}},"___requests"),t},builder:function(){return f.builderFromPdefsp(this.clazzInfo)}});var x={VERSION:"2.0.0",bundle_manager:v,bundle_facade:y,bundle_locale:o,app:y,clazz:f,$:function(){return b.apply(f,arguments)},run:function(e){e()},setLoaderMode:function(e){u=e},getLoaderMode:function(){return u},setDebugMode:function(e){t=e},setSupportBundleAsync:function(e){l=e},getSupportBundleAsync:function(){return l},setBundleBasePath:function(e){basePathForBundles=e},getBundleBasePath:function(){return basePathForBundles},setPreloaded:function(e){c=e},getPreloaded:function(){return c},registerLocalization:function(e){if(!e.length)return o.setLocalization(e.lang,e.key,e.value);for(var t=0;t<e.length;t++){var i=e[t];o.setLocalization(i.lang,i.key,i.value)}},getLocalization:function(e){return o.getLocalization(e)},getLang:function(){return o.getLang()},setLang:function(e){return o.setLang(e)},setSupportedLocales:function(e){return o.setSupportedLocales(e)},getSupportedLocales:function(){return o.getSupportedLocales()},getDefaultLanguage:function(){return o.getDefaultLanguage()},getSupportedLanguages:function(){return o.getSupportedLanguages()},purge:function(){v.purge(),f.purge("Oskari")},getDomManager:function(){return k},setDomManager:function(e){k=e},getSandbox:function(e){return b.apply(f,[e||"sandbox"])},setSandbox:function(e,t){return b.apply(f,[e||"sandbox",t])},registerMimeTypeToPlugin:function(e,t){blMimeTypeToPlugin[e]=t},cls:function(e,t,i,n){var a=void 0;return void 0==e?e=["Oskari","_",++_].join("."):a=f.lookup(e),a&&a._constructor&&!t||(a=f.define(e,t||function(){},i,n||{})),f.create("Oskari.ClazzWrapper",a,e)},sandbox:function(e){var t={sandbox:b.apply(f,[e||"sandbox"])};return t.on=function(e){var t=this;if(e.eventHandlers)for(p in e.eventHandlers)t.sandbox.registerForEventByName(e,p);if(e.requestHandlers)for(r in e.requestHandlers)t.sandbox.addRequestHandler(r,reqHandlers[r])},t.off=function(e){if(e.eventHandlers)for(p in e.eventHandlers)me.sandbox.unregisterFromEventByName(e,p);if(e.requestHandlers)for(r in e.requestHandlers)me.sandbox.removeRequestHandler(r,reqHandlers[r])},t.slicer=Array.prototype.slice,t.notify=function(e){var t=this,i=t.sandbox,n=(t.sandbox.getEventBuilder(e),t.slicer.apply(arguments,[1])),a=eventBuilder.apply(eventBuilder,n);return i.notifyAll(a)},t},loc:function(){return x.registerLocalization.apply(x,arguments)},setConfiguration:function(e){return y.setConfiguration(e)},getConfiguration:function(){return y.getConfiguration()}};x.eventCls=function(e,t,i){var n=["Oskari","event","registry",e].join("."),a=x.cls(n,t,i,{protocol:["Oskari.mapframework.event.Event"]});return a.category({getName:function(){return e}},"___event"),a.eventName=e,a},x.requestCls=function(e,t,i){var n=["Oskari","request","registry",e].join("."),a=x.cls(n,t,i,{protocol:["Oskari.mapframework.request.Request"]});return a.category({getName:function(){return e}},"___request"),a.requestName=e,a},x._baseClassFor={bundle:"Oskari.mapframework.bundle.extension.ExtensionBundle"},x.bundleCls=function(e,t){e||(e=["__",++L].join("_"));var i=x.cls(t,function(){},{update:function(){}},{protocol:["Oskari.bundle.Bundle",this._baseClassFor.bundle],manifest:{"Bundle-Identifier":e}});return v.installBundlePdefsp(e,i.clazzInfo),i.___bundleIdentifier=e,i.loc=function(e){return e.key=this.___bundleIdentifier,x.registerLocalization(e),i},i.start=function(e){var t=this.___bundleIdentifier;if(!y.bundles[t]){var i=v.createBundle(t,t);y.bundles[t]=i}var n=v.createInstance(t);y.bundleInstances[t]=n;var a=y.getBundleInstanceConfigurationByName(e||t);if(a)for(ip in a)n[ip]=a[ip];return n.start(),n},i.stop=function(){var e=this.___bundleIdentifier,t=y.bundleInstances[e];return t.stop()},i},b.apply(f,["Oskari",x]),e.Oskari=x,define("src/oskari/oskari",["exports"],function(e){return e.Oskari=x,x})}(),Oskari.clazz.define("Oskari.mapframework.core.Core",function(){this._selectedLayers=new Array,this._mapLayersHighlighted=new Array,this._map=null,this._sandbox=Oskari.clazz.create("Oskari.mapframework.sandbox.Sandbox",this),Oskari.$("sandbox")||Oskari.$("sandbox",this._sandbox),this._services=[],this._servicesByQName={},this._debug=!1,this._ctrlKeyDown=!1,this._allowMultipleHighlightLayers=!1,this._availableRequestsByName={},this._availableEventsByName={},this.externalHandlerCls={}},{init:function(e,t){this.printDebug("Initializing core...");this._sandbox;if(this._services=e,e)for(var i=0;i<e.length;i++)this.registerService(e[i]);this.printDebug("Sandbox ready, building up domain..."),this._map=Oskari.clazz.create("Oskari.mapframework.domain.Map"),this.enhancements=t,this._doEnhancements(this.enhancements),this.printDebug("Modules started. Core ready.")},dispatch:function(e){this._sandbox.notifyAll(e)},defaultRequestHandlers:{AddMapLayerRequest:function(e){return this._handleAddMapLayerRequest(e),!0},RemoveMapLayerRequest:function(e){return this._handleRemoveMapLayerRequest(e),!0},ShowMapLayerInfoRequest:function(e){return this._handleShowMapLayerInfoRequest(e),!0},RearrangeSelectedMapLayerRequest:function(e){return this._handleRearrangeSelectedMapLayerRequest(e),!0},ChangeMapLayerOpacityRequest:function(e){return this._handleChangeMapLayerOpacityRequest(e),!0},ChangeMapLayerStyleRequest:function(e){return this._handleChangeMapLayerStyleRequest(e),!0},HighlightMapLayerRequest:function(e){return this._handleHighlightMapLayerRequest(e),!0},HighlightWFSFeatureRequest:function(e){return this.handleHighlightWFSFeatureRequest(e),!0},HideMapMarkerRequest:function(e){return this._handleHideMapMarkerRequest(e),!0},DimMapLayerRequest:function(e){return this._handleDimMapLayerRequest(e.getMapLayerId()),!0},CtrlKeyDownRequest:function(){return this._handleCtrlKeyDownRequest(),!0},CtrlKeyUpRequest:function(){return this._handleCtrlKeyUpRequest(),!0},__default:function(e){return this.printWarn("!!!"),this.printWarn("  There is no handler for"),this.printWarn("  '"+e.getName()+"'"),!1}},processRequest:function(e){var t=e.getName(),i=this.defaultRequestHandlers[t];if(i)rv=i.apply(this,[e]);else{var n=this.externalHandlerCls[t];n?rv=n.handleRequest(this,e):(i=this.defaultRequestHandlers.__default,rv=i.apply(this,[e]))}return delete e,rv},addRequestHandler:function(e,t){this.externalHandlerCls[e]=t},removeRequestHandler:function(e,t){this.externalHandlerCls[e]===t&&(this.externalHandlerCls[e]=null)},_getQNameForRequest:function(e){var t=this._availableRequestsByName[e];if(!t){this.printDebug("#!#!# ! Updating request metadata...");var i=Oskari.clazz.protocol("Oskari.mapframework.request.Request");for(p in i){var n=i[p],a=n._class.prototype.getName();this._availableRequestsByName[a]=p}this.printDebug("#!#!# ! Finished Updating request metadata..."),t=this._availableRequestsByName[e]}return t},getRequestBuilder:function(e){var t=this._getQNameForRequest(e);return t?Oskari.clazz.builder(t):void 0},_getQNameForEvent:function(e){var t=this._availableEventsByName[e];if(!t){this.printDebug("#!#!# ! Updating event metadata...");var i=Oskari.clazz.protocol("Oskari.mapframework.event.Event");for(p in i){var n=i[p],a=n._class.prototype.getName();this._availableEventsByName[a]=p}this.printDebug("#!#!# ! Finished Updating event metadata..."),t=this._availableEventsByName[e]}return t},getEventBuilder:function(e){var t=this._getQNameForEvent(e);return t?Oskari.clazz.builder(t):void 0},disableDebug:function(){this._debug=!1},enableDebug:function(){this._debug=!0},printDebug:function(e){this._debug&&null!=window.console&&(null!=window.console.debug?console.debug(e):null!=window.console.log&&console.log(e))},printWarn:function(e){null!=window.console&&console.warn(e)},registerService:function(e){this._servicesByQName[e.getQName()]=e},getService:function(e){return this._servicesByQName[e]},getMap:function(){return this._map},getSandbox:function(){return this._sandbox},getRequestParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",i=new RegExp(t),n=i.exec(window.location.href);return null==n?null:n[1]},getObjectName:function(e){return e.__name},getObjectCreator:function(e){return e._creator},setObjectCreator:function(e,t){e._creator=t},copyObjectCreatorToFrom:function(e,t){e._creator=t._creator}}),define("src/oskari/base/core/core",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","enhancement-methods",{_doEnhancements:function(e){for(var t=0;t<e.length;t++)e[t].enhance(this)}}),define("src/oskari/base/core/core-enhancement-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","feature-key-listener-methods",{_handleCtrlKeyDownRequest:function(){this._ctrlKeyDown=!0},_handleCtrlKeyUpRequest:function(){this._ctrlKeyDown=!1},isCtrlKeyDown:function(){return this._ctrlKeyDown}}),define("src/oskari/base/core/core-key-listener-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","map-layer-methods",{isLayerAlreadySelected:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._selectedLayers);return null!=i},findMapLayerFromSelectedMapLayers:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._selectedLayers);return i},isMapLayerAlreadyHighlighted:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._mapLayersHighlighted);return null==i&&this.printDebug("[core-map-layer-methods] "+e+" is not yet highlighted."),null!=i},findMapLayerFromAllAvailable:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e);return null==i&&this.printDebug("Cannot find map layer with id '"+e+"' from all available. Check that current user has VIEW permissions to that layer."),i},getAllSelectedLayers:function(){return this._selectedLayers},getAllHighlightedMapLayers:function(){return this._mapLayersHighlighted},allowMultipleHighlightLayers:function(e){this._allowMultipleHighlightLayers=e},_handleAddMapLayerRequest:function(e){var t=e.getMapLayerId(),i=e.getKeepLayersOrder(),n=e.isBasemap();if(this.printDebug("Trying to add map layer with id '"+t+"' AS "+(n?" BASE ":" NORMAL ")),this.isLayerAlreadySelected(t))return void this.printDebug("Attempt to select already selected layer '"+t+"'");var a=this.findMapLayerFromAllAvailable(t);if(!a)return void this.printDebug("Attempt to select layer that is not available '"+t+"'");if(1==n&&a.setType("BASE_LAYER"),null!=i&&i)this._selectedLayers.push(a);else if(a.isBaseLayer()||1==n){var r=this._selectedLayers,s=new Array;s.push(a);for(var o=0;o<r.length;o++)s.push(r[o]);delete this._selectedLayers,this._selectedLayers=s}else this._selectedLayers.push(a);var l=this.getEventBuilder("AfterMapLayerAddEvent")(a,i,n);this.copyObjectCreatorToFrom(l,e),this.dispatch(l)},_handleRemoveMapLayerRequest:function(e){var t=e.getMapLayerId();if(this.printDebug("Trying to remove map layer with id '"+t+"'"),!this.isLayerAlreadySelected(t))return void this.printDebug("Attempt to remove layer '"+t+"' that is not selected.");for(var i=this.findMapLayerFromAllAvailable(t),n=-1,a=0;a<this._selectedLayers.length;a++)if(this._selectedLayers[a]===i){n=a;break}this._selectedLayers.splice(n,1),this.isMapLayerAlreadyHighlighted(t)&&(this.printDebug("Maplayer is also highlighted, removing it from highlight list."),this._handleDimMapLayerRequest(t));var r=this.getEventBuilder("AfterMapLayerRemoveEvent")(i);this.copyObjectCreatorToFrom(r,e),this.dispatch(r)},_handleShowMapLayerInfoRequest:function(e){var t=this.findMapLayerFromAllAvailable(e.getMapLayerId()),i=this.getEventBuilder("AfterShowMapLayerInfoEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)},_handleRearrangeSelectedMapLayerRequest:function(e){var t=e.getToPosition(),i=e.getMapLayerId(),n=null,a=0;if(null!=i&&null!=t){n=this.findMapLayerFromSelectedMapLayers(i);for(var r=new Array,s=0,o=0,l=0;t>s;l++){o++;var u=this._selectedLayers[l];u.getId()!=i?(r.push(u),s++):a=l}r.push(n);for(var l=o;l<this._selectedLayers.length;l++){var u=this._selectedLayers[l];u.getId()!=i?r.push(u):a=l}delete this._selectedLayers,this._selectedLayers=r}var c=this.getEventBuilder("AfterRearrangeSelectedMapLayerEvent")(n,a,t);this.copyObjectCreatorToFrom(c,e),this.dispatch(c)},_handleChangeMapLayerOpacityRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(!t)return void this.sandbox.printDebug("DeveloperError: You must specify mapLayerId!");t.setOpacity(e.getOpacity());var i=this.getEventBuilder("AfterChangeMapLayerOpacityEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)},_handleChangeMapLayerStyleRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(t&&"!default!"!=e.getStyle()){t.selectStyle(e.getStyle());var i=this.getEventBuilder("AfterChangeMapLayerStyleEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)}},_removeHighLightedMapLayer:function(e){for(var t=this.getAllHighlightedMapLayers(),i=0;i<t.length;i++){var n=t[i];if(!e||n.getId()==e){t.splice(i);var a=this.getEventBuilder("AfterDimMapLayerEvent")(n);return void this.dispatch(a)}}},_handleHighlightMapLayerRequest:function(e){var t=(this.getObjectCreator(e),e.getMapLayerId());if(this.printDebug("[core-map-layer-methods] Trying to highlight map layer with id '"+t+"'"),this.isMapLayerAlreadyHighlighted(t))return void this.printWarn("[core-map-layer-methods] Attempt to highlight already highlighted wms feature info map layer '"+t+"'");1==this._allowMultipleHighlightLayers?this._removeHighLightedMapLayer(t):this._removeHighLightedMapLayer();var i=this.findMapLayerFromSelectedMapLayers(t);if(i){this._mapLayersHighlighted.push(i),this.printDebug("[core-map-layer-methods] Adding "+i+" ("+i.getId()+") to highlighted list.");var n=this.getEventBuilder("AfterHighlightMapLayerEvent")(i);this.copyObjectCreatorToFrom(n,e),this.dispatch(n)}},_handleDimMapLayerRequest:function(e){1==this._allowMultipleHighlightLayers?this._removeHighLightedMapLayer(e):this._removeHighLightedMapLayer();var t=this.findMapLayerFromAllAvailable(e);if(t){var i=this.getEventBuilder("AfterDimMapLayerEvent")(t);this.dispatch(i)}}}),define("src/oskari/base/core/core-map-layer-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.core.Core","map-methods",{_handleHideMapMarkerRequest:function(e){this._map.setMarkerVisible(!1);var t=this.getEventBuilder("AfterHideMapMarkerEvent")();this.copyObjectCreatorToFrom(t,e),this.dispatch(t)}}),define("src/oskari/base/core/core-map-methods",function(){}),define("src/oskari/base/core/module",["src/oskari/oskari","./core","./core-enhancement-methods","./core-key-listener-methods","./core-map-layer-methods","./core-map-methods"],function(e){e.bundleCls("core-base"),e.bundleCls("core-map")}),Oskari.clazz.define("Oskari.mapframework.event.Event",function(){throw"mapframework.event.Event should not be used"},{getName:function(){throw"Running default implementation of Event.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),define("src/oskari/base/event/event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesAvailableEvent",function(e,t,i,n,a){this._creator=null,this._features=t,this._op=a,this._mapLayer=e,this._mimeType=i,this._projCode=n},{__name:"FeaturesAvailableEvent",getName:function(){return this.__name},getFeatures:function(){return this._features},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMimeType:function(){return this._mimeType},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/features-available-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerAddEvent",function(e,t,i){this._creator=null,this._mapLayer=e,this._keepLayersOrder=t,this._isBasemap=i?i:!1},{__name:"AfterMapLayerAddEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-map-layer-add-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerRemoveEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterMapLayerRemoveEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-map-layer-remove-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapMoveEvent",function(e,t,i,n,a){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=i,this._marker=n,this._scale=a},{__name:"AfterMapMoveEvent",getName:function(){return this.__name},getCreator:function(){return this._creator},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getScale:function(){return this._scale}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-map-move-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.MapMoveStartEvent",function(e,t){this._creator=null,this._x=e,this._y=t},{__name:"MapMoveStartEvent",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-map-move-start-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterShowMapLayerInfoEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterShowMapLayerInfoEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-show-map-layer-info-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHideMapMarkerEvent",function(){},{__name:"AfterHideMapMarkerEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-hide-map-marker-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.MouseHoverEvent",function(e,t,i){this._creator=null,this._lon=e,this._lat=t,this._paused=i},{__name:"MouseHoverEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},set:function(e,t,i,n,a,i){this._lon=e,this._lat=t,this._paused=i,this._pageX=n,this._pageY=a,this._paused=i},isPaused:function(){return this._paused},getPageX:function(){return this._pageX},getPageY:function(){return this._pageY}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/mouse-hover-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.MapLayerEvent",function(e,t){if(this._creator=null,this._layerId=e,!this.operations[t])throw"Unknown operation '"+t+"'";this._operation=t},{__name:"MapLayerEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getOperation:function(){return this._operation},operations:{add:"add",remove:"remove",sticky:"sticky",update:"update"}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/MapLayerEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterRearrangeSelectedMapLayerEvent",function(e,t,i){this._creator=null,this._movedMapLayer=e,this._fromPosition=t,this._toPosition=i},{__name:"AfterRearrangeSelectedMapLayerEvent",getName:function(){return this.__name},getMovedMapLayer:function(){return this._movedMapLayer},getFromPosition:function(){return this._fromPosition},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-rearrange-selected-map-layer-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerOpacityEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerOpacityEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-change-map-layer-opacity-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerStyleEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerStyleEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-change-map-layer-style-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHighlightMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterHighlightMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-highlight-map-layer-event",function(){}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterDimMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterDimMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("src/oskari/base/event/common/after-dim-map-layer-event",function(){}),define("src/oskari/base/event/module",["src/oskari/oskari","./event","./common/features-available-event","./common/after-map-layer-add-event","./common/after-map-layer-remove-event","./common/after-map-move-event","./common/after-map-move-start-event","./common/after-show-map-layer-info-event","./common/after-hide-map-marker-event","./common/mouse-hover-event","./common/MapLayerEvent","./common/after-rearrange-selected-map-layer-event","./common/after-change-map-layer-opacity-event","./common/after-change-map-layer-style-event","./common/after-highlight-map-layer-event","./common/after-dim-map-layer-event"],function(e){e.bundleCls("event-base"),e.bundleCls("event-map"),e.bundleCls("event-map-layer")}),Oskari.clazz.define("Oskari.mapframework.domain.AbstractMapLayerModel",function(e,t){this._id=null,this._name=null,this._description=null,this._type=null,this._layerType="",this._params=e||{},this._options=t||{},this._metaType=null,this._maxScale=null,this._minScale=null,this._visible=null,this._opacity=null,this._isSticky=null,this._inspireName=null,this._organizationName=null,this._dataUrl=null,this._orderNumber=null,this._subLayers=[],this._styles=[],this._currentStyle=null,this._legendImage=null,this._featureInfoEnabled=null,this._queryable=null,this._queryFormat=null,this._permissions={},this._geometry=[],this._geometryWKT=null,this._tools=[],this._metadataIdentifier=null,this._backendStatus=null
},{setId:function(e){this._id=e},getId:function(){return this._id},setQueryFormat:function(e){this._queryFormat=e},getQueryFormat:function(){return this._queryFormat},setName:function(e){this._name=e},getName:function(){return this._name},setType:function(e){this._type=e},getType:function(){return this._type},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(){return this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(){return this._description},addSubLayer:function(e){this._subLayers.push(e)},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},isVisible:function(){return this._visible===!0},setVisible:function(e){this._visible=e},setOpacity:function(e){this._opacity=e},getOpacity:function(){return this._opacity},setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null,delete this._permissions[e]},getPermission:function(e){return this._permissions[e]},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e},setMetaType:function(e){this._metaType=e},getMetaType:function(){return this._metaType},addStyle:function(e){this._styles.push(e)},getStyles:function(){return this._styles},selectStyle:function(e){var t,i=null;if(!(this._styles.length>0))return i=Oskari.clazz.create("Oskari.mapframework.domain.Style"),i.setName(""),i.setTitle(""),i.setLegend(""),void(this._currentStyle=i);if(""===e)return void(this._styles.length>1?this._currentStyle=this._styles[0]:(i=Oskari.clazz.create("Oskari.mapframework.domain.Style"),i.setName(""),i.setTitle(""),i.setLegend(""),this._currentStyle=i));for(t=0;t<this._styles.length;t+=1)if(i=this._styles[t],i.getName()===e)return this._currentStyle=i,void(""!==i.getLegend()&&(this._legendImage=i.getLegend()))},getCurrentStyle:function(){return this._currentStyle},getTools:function(){return this._tools},setTools:function(e){this._tools=e},addTool:function(e){this._tools.push(e)},getTool:function(e){var t,i=null;if(this._tools.length>0&&""!==e)for(t=0;t<this._tools.length;t+=1)if(i=this._tools[t],i.getName()===e)return i;return i},setLegendImage:function(e){this._legendImage=e},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){var e;if(this._legendImage)return!0;for(e=0;e<this._styles.length;e+=1)if(this._styles[e].getLegend())return!0;return!1},setSticky:function(e){this._isSticky=e},isSticky:function(){return this._isSticky},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return"GROUP_LAYER"===this._type},isBaseLayer:function(){return"BASE_LAYER"===this._type},isInScale:function(e){var t=this.isBaseLayer();if(!e){var i=Oskari.$().sandbox;e=i.getMap().getScale()}return this.isBaseLayer()||((e>this.getMaxScale()||!this.getMaxScale())&&e<this.getMinScale()||!this.getMinScale())&&(t=!0),t},getLayerType:function(){return this._layerType.toLowerCase()},isLayerOfType:function(e){return e&&e.toLowerCase()===this.getLayerType()},getIconClassname:function(){return this.isBaseLayer()?"layer-base":this.isGroupLayer()?"layer-group":"layer-"+this.getLayerType()},getParams:function(){return this._params},getOptions:function(){return this._options}}),define("src/mapping/model/AbstractMapLayerModel",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.VectorLayer",function(){this._sldspec=null,this._layerType="VECTOR"},{setStyledLayerDescriptor:function(e){this._sldspec=e},getStyledLayerDescriptor:function(){return this._sldspec}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("src/mapping/model/VectorLayerModel",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.WmsLayer",function(){this._availableQueryFormats=[],this._layerType="WMS"},{addWmsUrl:function(e){this.addLayerUrl(e)},getWmsUrls:function(){return this.getLayerUrls()},setWmsUrls:function(e){this.setLayerUrls(e)},setWmsName:function(e){this.setLayerName(e)},getWmsName:function(){return this.getLayerName()},setVersion:function(e){this._version=e},getVersion:function(){return this._version},setAvailableQueryFormats:function(e){this._availableQueryFormats=e||[]},getAvailableQueryFormats:function(){return this._availableQueryFormats||[]}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("sources/framework/domain/wmslayer",function(){}),define("src/mapping/model/WMSLayerModel",["./AbstractMapLayerModel","sources/framework/domain/wmslayer"],function(){}),Oskari.clazz.define("Oskari.mapframework.domain.Map",function(){this._centerX=null,this._centerY=null,this._zoom=null,this._scale=null,this._bbox=null,this._markerVisible=null,this.width=null,this.height=null,this.resolution=null,this.extent=null,this.maxExtent=null,this._isMoving=!1,this._projectionCode="EPSG:3067"},{moveTo:function(e,t,i){this._centerX=Math.floor(e),this._centerY=Math.floor(t),this._zoom=i},setMoving:function(e){this._isMoving=e},isMoving:function(){return this._isMoving},getX:function(){return this._centerX},getY:function(){return this._centerY},getZoom:function(){return this._zoom},setScale:function(e){this._scale=e},getScale:function(){return this._scale},setBbox:function(e){this._bbox=e},getBbox:function(){return this._bbox},setMarkerVisible:function(e){this._markerVisible=e},isMarkerVisible:function(){return 1==this._markerVisible?!0:!1},setWidth:function(e){this.width=e},getWidth:function(){return this.width},setHeight:function(e){this.height=e},getHeight:function(){return this.height},setResolution:function(e){this.resolution=e},getResolution:function(){return this.resolution},setExtent:function(e){this.extent=e},getExtent:function(){return this.extent},setMaxExtent:function(e){this.maxExtent=e},getMaxExtent:function(){return this.maxExtent},setSrsName:function(e){this._projectionCode=e},getSrsName:function(){return this._projectionCode}}),define("src/mapping/model/map",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.Style",function(){this._name=null,this._title=null,this._legend=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setLegend:function(e){this._legend=e},getLegend:function(){return this._legend}}),define("src/oskari/base/domain/style",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.Tool",function(){this._name=null,this._title=null,this._tooltip=null,this._iconCls=null,this._callback=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setTooltip:function(e){this._tooltip=e},getTooltip:function(){return this._tooltip},setIconCls:function(e){this._iconCls=e},getIconCls:function(){return this._iconCls},setCallback:function(e){this._callback=e},getCallback:function(){return this._callback}}),define("src/oskari/base/domain/tool",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.User",function(e){this._loggedIn=!1,e&&(this._firstName=e.firstName,this._lastName=e.lastName,this._nickName=e.nickName,this._loginName=e.loginName,this._uuid=e.userUUID,e.userUUID&&(this._loggedIn=!0))},{getName:function(){return this._firstName+" "+this._lastName},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getNickName:function(){return this._nickName},getLoginName:function(){return this._loginName},getUuid:function(){return this._uuid},isLoggedIn:function(){return this._loggedIn}}),define("src/oskari/base/domain/user",function(){}),define("src/oskari/base/domain/module",["src/oskari/oskari","src/mapping/model/AbstractMapLayerModel","src/mapping/model/VectorLayerModel","src/mapping/model/WMSLayerModel","src/mapping/model/map","./style","./tool","./user"],function(e){e.bundleCls("domain")}),Oskari.clazz.define("Oskari.mapframework.request.Request",function(){throw this._creator=null,"mapframework.request.Request should not be used"},{getName:function(){throw"Running default implementation of Request.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),define("src/oskari/base/request/request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.AddMapLayerRequest",function(e,t,i,n){this._creator=null,this._mapLayerId=e,this._keepLayersOrder=1==t,this._isExternal=1==n,this._isBasemap=1==i},{__name:"AddMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap},isExternal:function(){return this._isExternal}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/add-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.RemoveMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"RemoveMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/remove-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.MapMoveRequest",function(e,t,i,n,a){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=i,this._marker=n,this._projectionCode=a},{__name:"MapMoveRequest",getName:function(){return this.__name},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getSrsName:function(){return this._projectionCode}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/map-move-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapLayerInfoRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"ShowMapLayerInfoRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/show-map-layer-info-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.HideMapMarkerRequest",function(){this._creator=null},{__name:"HideMapMarkerRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/hide-map-marker-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyDownRequest",function(){},{__name:"CtrlKeyDownRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/ctrl-key-down-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyUpRequest",function(){},{__name:"CtrlKeyUpRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/ctrl-key-up-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.RearrangeSelectedMapLayerRequest",function(e,t){this._mapLayerId=e,this._toPosition=t},{__name:"RearrangeSelectedMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/rearrange-selected-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerOpacityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._opacity=t},{__name:"ChangeMapLayerOpacityRequest",getName:function(){return this.__name},getOpacity:function(){return this._opacity},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/change-map-layer-opacity-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerStyleRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._style=t},{__name:"ChangeMapLayerStyleRequest",getName:function(){return this.__name},getStyle:function(){return this._style},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/change-map-layer-style-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.HighlightMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"HighlightMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/highlight-map-layer-request",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.DimMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"DimMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/dim-map-layer-request",function(){}),define("src/oskari/base/request/module",["src/oskari/oskari","./request","./common/add-map-layer-request","./common/remove-map-layer-request","./common/map-move-request","./common/show-map-layer-info-request","./common/hide-map-marker-request","./common/ctrl-key-down-request","./common/ctrl-key-up-request","./common/rearrange-selected-map-layer-request","./common/change-map-layer-opacity-request","./common/change-map-layer-style-request","./common/highlight-map-layer-request","./common/dim-map-layer-request"],function(e){e.bundleCls("request-base"),e.bundleCls("request-map"),e.bundleCls("request-map-layer")}),Oskari.clazz.define("Oskari.mapframework.sandbox.Sandbox",function(e){this._core=e,this._listeners=new Array,this._modules=new Array,this._modulesByName={},this._statefuls={},this.debugRequests=!1,this.debugEvents=!1,this.requestEventLog=[],this.requestEventStack=[],this.gatherDebugRequests=!1,this.maxGatheredRequestsAndEvents=4096,this.requestAndEventGather=[],this._eventLoopGuard=0,this._user=null,this._ajaxUrl=null},{disableDebug:function(){this.debugRequests=!1,this.debugEvents=!1,this.gatherDebugRequests=!1,this._core&&this._core.disableDebug()},enableDebug:function(){this.debugRequests=!0,this.debugEvents=!0,this.gatherDebugRequests=!0,this._core&&this._core.enableDebug()},printDebug:function(e){this._core.printDebug(e)},printWarn:function(e){this._core.printWarn(e)},setUser:function(e){this._user=Oskari.clazz.create("Oskari.mapframework.domain.User",e)},getUser:function(){return this._user||this.setUser(),this._user},setAjaxUrl:function(e){this._ajaxUrl=e},getAjaxUrl:function(){return this._ajaxUrl},registerService:function(e){this._core.registerService(e)},getService:function(e){return this._core.getService(e)},registerAsStateful:function(e,t){this._statefuls[e]=t},unregisterStateful:function(e){this._statefuls[e]=null,delete this._statefuls[e]},getStatefulComponents:function(){return this._statefuls},register:function(e){return this._modules.push(e),this._modulesByName[e.getName()]=e,e.init(this)},unregister:function(e){var t,i=this,n=[];for(t=0;t<i._modules.length;t++)e!==i._modules[t]&&n.push(i._modules[t]);i._modules=n,i._modulesByName[e.getName()]=void 0,delete i._modulesByName[e.getName()]},registerForEventByName:function(e,t){this._core.printDebug("#*#*#* Sandbox is registering module '"+e.getName()+"' to event '"+t+"'");var i=this._listeners[t];null==i&&(i=new Array,this._listeners[t]=i),i.push(e),this._core.printDebug("There are currently "+i.length+" listeners for event '"+t+"'")},unregisterFromEventByName:function(e,t){this._core.printDebug("Sandbox is unregistering module '"+e.getName()+"' from event '"+t+"'");var i,n=this._listeners[t],a=-1;if(null===n||void 0===n)return void this._core.printDebug("Module does not listen to that event, skipping.");for(i=0;i<n.length;i++)if(n[i]===e){a=i;break}a>-1?(n.splice(a,1),this._core.printDebug("Module unregistered successfully from event")):this._core.printDebug("Module does not listen to that event, skipping.")},getRequestBuilder:function(e){return this._core.getRequestBuilder(e)},getEventBuilder:function(e){return this._core.getEventBuilder(e)},request:function(e,t){var i,n=null,a=null;if(n=null!=e.getName?e.getName():e,i=this.findRegisteredModuleInstance(n),null==i)throw"Attempt to create request with unknown component '"+e+"' as creator";return this._core.setObjectCreator(t,n),this.printDebug("Module '"+n+"' is requesting for '"+this.getObjectName(t)+"'..."),this.gatherDebugRequests&&this._pushRequestAndEventGather(n+"->Sandbox: ",this.getObjectName(t)),this._debugPushRequest(n,t),a=this._core.processRequest(t),this._debugPopRequest(),a},requestByName:function(e,t,i){this.printDebug("#!#!#! --------------> requestByName "+t);var n=this.getRequestBuilder(t),a=n.apply(this,i||[]);return this.request(e,a)},postMasterComponent:"postmaster",postRequestByName:function(e,t){var i=this,n=i.getRequestBuilder(e);n&&window.setTimeout(function(){var e=n.apply(i,t||[]),a=this.postMasterComponent,r=null;i._core.setObjectCreator(e,a),i.gatherDebugRequests&&i._pushRequestAndEventGather(a+"->Sandbox: ",i.getObjectName(e)),this.debugRequests&&i._debugPushRequest(a,e),r=i._core.processRequest(e),this.debugRequests&&i._debugPopRequest()},0)},_findModulesInterestedIn:function(e){var t=e.getName(),i=this._listeners[t];return i?i:[]},notifyAll:function(e,t){var i;t||(i=e.getName(),this._core.printDebug("Sandbox received notifyall for event '"+i+"'"));var n=this._findModulesInterestedIn(e);t||this._core.printDebug("Found "+n.length+" interested modules");for(var a=0;a<n.length;a++){var r=n[a];t||(this._core.printDebug("Notifying module '"+r.getName()+"'."),this.gatherDebugRequests&&this._pushRequestAndEventGather("Sandbox->"+r.getName()+":",i)),this._debugPushEvent(this.getObjectCreator(e),r,e),r.onEvent(e),this._debugPopEvent()}t||delete e},findRegisteredModuleInstance:function(e){return this._modulesByName[e]},getRequestParameter:function(e){return this._core.getRequestParameter(e)},getBrowserWindowSize:function(){if(jQuery.browser.opera&&null!=window.innerHeight){window.innerHeight}var e=jQuery(window).width(),t={};return t.height=jQuery(window).height(),t.width=e,this.printDebug("Got browser window size is: width: "+t.width+" px, height:"+t.height+" px."),t},getObjectName:function(e){return this._core.getObjectName(e)},getObjectCreator:function(e){return this._core.getObjectCreator(e)},setObjectCreator:function(e,t){return this._core.setObjectCreator(e,t)},copyObjectCreatorToFrom:function(e,t){return this._core.copyObjectCreatorToFrom(e,t)},addRequestHandler:function(e,t){return this._core.addRequestHandler(e,t)},removeRequestHandler:function(e,t){return this._core.removeRequestHandler(e,t)},_debugPushRequest:function(e,t){if(this.debugRequests){var i={from:e,reqName:t.getName()};this.requestEventStack.push(i),this.requestEventLog.push(i),this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopRequest:function(){this.debugRequests&&this.requestEventStack.pop()},_debugPushEvent:function(e,t,i){if(this.debugEvents){if(this._eventLoopGuard++,this._eventLoopGuard>64)throw"Events Looped?";var n={from:e,to:t.getName(),evtName:i.getName()};this.requestEventStack.push(n),this.requestEventLog.push(n),this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopEvent:function(){this.debugEvents&&(this._eventLoopGuard--,this.requestEventStack.pop())},_pushRequestAndEventGather:function(e,t){var i={};i.name=e,i.request=t,this.requestAndEventGather.push(i),this.requestAndEventGather.length>this.maxGatheredRequestsAndEvents&&this.requestAndEventGather.shift()},popUpSeqDiagram:function(){var e,t='<html><head></head><body><div class="wsd" wsd_style="modern-blue"><pre>',i="";for(x in this.requestAndEventGather)i+=this.requestAndEventGather[x].name+this.requestAndEventGather[x].request+"\n";""!=i?(t+=i+'</pre></div><script type="text/javascript" src="http://www.websequencediagrams.com/service.js"></script></body></html>',e=window.open(),e.document.write(t),this.requestAndEventGather=[]):alert("No requests in queue")},getLocalizedProperty:function(e){var t;return null===e||"undefined"==typeof e?null:"object"==typeof e?t=e[Oskari.getLang()]:e}}),define("src/oskari/base/sandbox/sandbox",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","key-listener-methods",{isCtrlKeyDown:function(){return this._core.isCtrlKeyDown()}}),define("src/oskari/base/sandbox/sandbox-key-listener-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-layer-methods",{findMapLayerFromAllAvailable:function(e){var t=this._core.findMapLayerFromAllAvailable(e);return t},findAllSelectedMapLayers:function(){var e=this._core.getAllSelectedLayers();return e.slice(0)},findMapLayerFromSelectedMapLayers:function(e){var t=this._core.findMapLayerFromSelectedMapLayers(e);return t},isLayerAlreadySelected:function(e){return this._core.isLayerAlreadySelected(e)},findAllHighlightedLayers:function(){var e=this._core.getAllHighlightedMapLayers();return e},isMapLayerHighLighted:function(e){for(var t=this.findAllHighlightedLayers(),i=0;i<t.length;i++)if(t[i].getId()==e)return!0;return!1},allowMultipleHighlightLayers:function(e){this._core.allowMultipleHighlightLayers(e)}}),define("src/oskari/base/sandbox/sandbox-map-layer-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-methods",{getMap:function(){return this._core.getMap()},syncMapState:function(e){var t=this._core.getMap(),i=t.getZoom(),n=t.isMarkerVisible();e===!0&&12==i&&this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(t.getX(),t.getY(),0,!1)),this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(t.getX(),t.getY(),i,n))},generateMapLinkParameters:function(e){var t=this.getStatefulComponents().mapfull;if(t){for(var i=t.getState(),n="zoomLevel="+i.zoom+"&coord="+i.east+"_"+i.north+"&mapLayers=",a="",r=0;r<i.selectedLayers.length;r++)i.selectedLayers[r].hidden||(""!=a&&(a+=","),a+=i.selectedLayers[r].id+"+"+i.selectedLayers[r].opacity,a+=i.selectedLayers[r].style?"+"+i.selectedLayers[r].style:"+");return n+=a,e?(n+=1==e.marker?"&showMarker=true":"&showMarker=false",n+=0==e.forceCache?"&forceCache=false":"&forceCache=true",n+=0==e.noSavedState?"&noSavedState=false":"&noSavedState=true"):n+="&showMarker=false&forceCache=true&noSavedState=true",n}}}),define("src/oskari/base/sandbox/sandbox-map-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","abstraction-methods",{domSelector:function(e){return jQuery(e)},ajax:function(e,t,i,n){if(jQuery&&jQuery.ajax){var a="GET";n&&(a="POST"),jQuery.ajax({type:a,url:e,beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:n,success:t,error:i})}else i()},getDefer:function(){return window.Q&&window.Q.defer?window.Q.defer():void 0}}),define("src/oskari/base/sandbox/sandbox-abstraction-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","state-methods",{registerAsStateful:function(e,t){this._statefuls[e]=t},unregisterStateful:function(e){this._statefuls[e]=null,delete this._statefuls[e]},getStatefulComponents:function(){return this._statefuls},resetState:function(){var e,t,i,n=Oskari.app.getConfiguration(),a=this.getStatefulComponents();for(i in a)a.hasOwnProperty(i)&&(t=a[i],e=n[i].state,t.setState&&(jQuery.isEmptyObject(e)?t.setState():t.setState(e)))},setSessionExpiring:function(e,t){{var i=6e4*e;setTimeout(function(){t()},i)}},extendSession:function(e){var t=this.getAjaxUrl()+"action_route=GetCurrentUser",i=this.getUser().getUuid(),n=function(t,n,a){var r=a.getResponseHeader("currentUserUid");r!==i&&e()};this.ajax(t,n,e)}}),define("sources/framework/sandbox/sandbox-state-methods",function(){}),define("src/oskari/base/sandbox/module",["src/oskari/oskari","./sandbox","./sandbox-key-listener-methods","./sandbox-map-layer-methods","./sandbox-map-methods","./sandbox-abstraction-methods","sources/framework/sandbox/sandbox-state-methods"],function(e){e.bundleCls("sandbox-base"),e.bundleCls("sandbox-map")}),Oskari.clazz.define("Oskari.mapframework.service.Service",function(){throw"mapframework.service.Service should not be used"},{getName:function(){throw"Running default implementation of Service.getName(). implement your own!"}}),define("src/oskari/base/service/service",function(){}),Oskari.clazz.define("Oskari.mapframework.service.MapLayerService",function(e,t){this._mapLayerUrl=e,this._sandbox=t,this._allLayersAjaxLoaded=!1,this._loadedLayersList=[],this._reservedLayerIds={},this._stickyLayerIds={},this.typeMapping={wmslayer:"Oskari.mapframework.domain.WmsLayer",vectorlayer:"Oskari.mapframework.domain.VectorLayer"},this.modelBuilderMapping={},this._localization=Oskari.getLocalization("Generic")},{__qname:"Oskari.mapframework.service.MapLayerService",getQName:function(){return this.__qname},__name:"MapLayerService",getName:function(){return this.__name},addLayer:function(e,t){if(-1!=e.getParentId())return void this.addSubLayer(e.getParentId(),e,t);if(this.checkForDuplicateId(e.getId(),e.getName()),this._reservedLayerIds[e.getId()]=!0,this._loadedLayersList.push(e),t!==!0){var i=this._sandbox.getEventBuilder("MapLayerEvent")(e.getId(),"add");this._sandbox.notifyAll(i)}},addSubLayer:function(e,t,i){var n,a=this.findMapLayer(e);if(a&&(a.isBaseLayer()||a.isGroupLayer())){if(t.setParentId(e),n=a.getSubLayers(),!a.addSubLayer(t))return;if(i!==!0){var r=this._sandbox.getEventBuilder("MapLayerEvent")(a.getId(),"update");this._sandbox.notifyAll(r)}}},removeLayer:function(e,t){var i=this.findMapLayer(e),n=null,a=null;if(i){this._sandbox.removeMapLayer(e);var r=this._loadedLayersList;if(-1!=i.getParentId()){if(n=this.findMapLayer(i.getParentId()),!n)return;r=n.getSubLayers()}for(var s=0;s<r.length;s++)if(r[s].getId()+""==e+""){r.splice(s,1);break}i&&t!==!0&&(n?a=this._sandbox.getEventBuilder("MapLayerEvent")(n.getId(),"update"):(a=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"remove"),this._reservedLayerIds[e]=!1),this._sandbox.notifyAll(a))}},updateLayer:function(e,t){var i=this.findMapLayer(e);if(i){t.dataUrl&&i.setDataUrl(t.dataUrl),t.legendImage&&i.setLegendImage(t.legendImage),t.minScale&&i.setMinScale(t.minScale),t.maxScale&&i.setMaxScale(t.maxScale),t.name&&i.setName(t.name),t.layerName&&i.setLayerName(t.layerName),t.subtitle&&i.setDescription(t.subtitle),t.orgName&&i.setOrganizationName(t.orgName),t.inspire&&i.setInspireName(t.inspire),t.realtime&&i.setRealtime(t.realtime),t.refreshRate&&i.setRefreshRate(t.refreshRate),t.admin&&i.setAdmin(t.admin),"wmslayer"===t.type&&this._populateWmsMapLayerAdditionalData(i,t);var n=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"update");this._sandbox.notifyAll(n)}},makeLayerSticky:function(e,t){var i=this.findMapLayer(e);if(this._stickyLayerIds[e]=t===!0,i){i.setSticky(t);var n=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"sticky");this._sandbox.notifyAll(n)}},loadAllLayersAjax:function(e,t){var i=this,n=(new Date).getTime();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this._mapLayerUrl+"&timestamp="+n+"&",success:function(t){i._loadAllLayersAjaxCallBack(t,e)},error:function(e){t&&0!==e.status&&t()}})},_loadAllLayersAjaxCallBack:function(e,t){var i,n,a,r,s,o,l,u=e.layers;for(i=0;i<u.length;i++)if(n=this.createMapLayer(u[i]))if(this._reservedLayerIds[n.getId()]!==!0)this.addLayer(n,!0);else if(a=this.findMapLayer(n.getId()),null!==u[i].admin&&void 0!==u[i].admin&&(a.admin=u[i].admin),u[i].names&&(a.names=u[i].names),null!==a.getSubLayers()&&void 0!==a.getSubLayers())for(r=a.getSubLayers(),s=n.getSubLayers(),o=0;o<r.length;o++)l=r[o],null!==r[o].admin&&void 0!==r[o].admin&&(l.admin=s[o].admin),r[o].names&&(l.names=s[o].names);this._allLayersAjaxLoaded=!0;var c=this._sandbox.getEventBuilder("MapLayerEvent")(null,"add");this._sandbox.notifyAll(c),t&&t()},isAllLayersLoaded:function(){return this._allLayersAjaxLoaded},getAllLayers:function(){return this._loadedLayersList},getAllLayersByMetaType:function(e){var t,i,n=[];for(t=0;t<this._loadedLayersList.length;++t)i=this._loadedLayersList[t],i.getMetaType&&i.getMetaType()===e&&n.push(i);return n},getLayersOfType:function(e){var t,i,n=[];for(t=0;t<this._loadedLayersList.length;++t)i=this._loadedLayersList[t],i.isLayerOfType(e)&&n.push(i);return n},getLayersByMetadataId:function(e){var t,i,n=[];for(t=0;t<this._loadedLayersList.length;++t)i=this._loadedLayersList[t],i.getMetadataIdentifier()===e&&n.push(i);return n},registerLayerModel:function(e,t){this.typeMapping[e]=t},unregisterLayerModel:function(e){this.typeMapping[e]=void 0,delete this.typeMapping[e]},registerLayerModelBuilder:function(e,t){this._sandbox.printDebug("[MapLayerService] registering handler for type "+e),this.modelBuilderMapping[e]=t},unregisterLayerModelBuilder:function(e){this.modelBuilderMapping[e]=void 0,delete this.modelBuilderMapping[e]},hasSupportForLayerType:function(e){return this.typeMapping[e]?!0:"base"===e||"groupMap"===e},createMapLayer:function(e){var t=null;return t="base"===e.type?this._createGroupMapLayer(e,!0):"groupMap"===e.type?this._createGroupMapLayer(e,!1):this._createActualMapLayer(e),t&&null!==e.admin&&void 0!==e.admin&&(t.admin=e.admin),t&&null!==e.names&&void 0!==e.names&&(t.names=e.names),t&&this._stickyLayerIds[t.getId()]&&t.setSticky(!0),t},_createGroupMapLayer:function(e,t){var i,n,a,r,s,o=this.createLayerTypeInstance("wmslayer");if(t?o.setAsBaseLayer():o.setAsGroupLayer(),o.setVisible(!0),o.setId(e.id),o.setName(e.name),o.setMaxScale(e.maxScale),o.setMinScale(e.minScale),o.setRealtime(e.realtime),o.setRefreshRate(e.refreshRate),o.setAdmin(e.admin),o.setDataUrl(e.dataUrl),o.setMetadataIdentifier(e.dataUrl_uuid),!o.getMetadataIdentifier()&&o.getDataUrl()&&(i=o.getDataUrl().split("uuid="),2===i.length&&o.setMetadataIdentifier(i[1])),o.setOrganizationName(e.orgName?e.orgName:""),o.setInspireName(e.inspire?e.inspire:""),o.setLegendImage(e.legendImage),o.setDescription(e.info),o.setQueryable(!1),e.permissions)for(n in e.permissions)e.permissions.hasOwnProperty(n)&&o.addPermission(n,e.permissions[n]);if(e.subLayer)for(a=0;a<e.subLayer.length;a++)r=this._createActualMapLayer(e.subLayer[a]),r.setParentId(e.id),r.admin=e.subLayer[a].admin||{},o.getSubLayers().push(r);return null!==e.opacity&&void 0!==e.opacity?o.setOpacity(e.opacity):o.getSubLayers().length>0?(s=o.getSubLayers()[0].getOpacity(),o.setOpacity(null!==s&&void 0!==s?s:100)):o.setOpacity(100),o},createLayerTypeInstance:function(e,t,i){var n=this.typeMapping[e];
return n?Oskari.clazz.create(n,t,i):null},_createActualMapLayer:function(e){if(!e)return null;var t=this.createLayerTypeInstance(e.type,e.params,e.options);if(!t)return this._sandbox.printDebug("[MapLayerService] Unknown layer type: "+e.type),null;if("wmslayer"===e.type?this._populateWmsMapLayerAdditionalData(t,e):"vectorlayer"===e.type&&t.setStyledLayerDescriptor(e.styledLayerDescriptor),e.metaType&&t.setMetaType&&t.setMetaType(e.metaType),t.setAsNormalLayer(),t.setId(e.id),t.setName(e.name),e.layerName&&t.setLayerName(e.layerName),t.setOpacity(null!==e.opacity&&void 0!==e.opacity?e.opacity:100),t.setMaxScale(e.maxScale),t.setMinScale(e.minScale),t.setDescription(e.subtitle),t.setQueryable("true"===e.isQueryable||e.isQueryable===!0),t.setRealtime(e.realtime),t.setRefreshRate(e.refreshRate),t.setAdmin(e.admin),t.setDataUrl(e.dataUrl),t.setMetadataIdentifier(e.dataUrl_uuid),!t.getMetadataIdentifier()&&t.getDataUrl()){var i=t.getDataUrl().split("uuid=");2===i.length&&t.setMetadataIdentifier(i[1])}if(e.backendStatus&&t.setBackendStatus&&t.setBackendStatus(e.backendStatus),t.setOrganizationName(e.orgName?e.orgName:""),t.setInspireName(e.inspire?e.inspire:""),t.setVisible(!0),e.geom&&t.setGeometryWKT&&t.setGeometryWKT(e.geom),e.permissions)for(var n in e.permissions)e.permissions.hasOwnProperty(n)&&t.addPermission(n,e.permissions[n]);e.url&&t.setLayerUrls(this.parseUrls(e.url)),t.setLegendImage(e.legendImage),e.localization&&t.setLocalization(e.localization);var a=this.modelBuilderMapping[e.type];return a&&a.parseLayerData(t,e,this),t},parseUrls:function(e){return e?e.split(","):[]},_populateWmsMapLayerAdditionalData:function(e,t){t.wmsName&&e.setWmsName(t.wmsName),e.setGfiContent(t.gfiContent),t.wmsUrl&&e.setLayerUrls(this.parseUrls(t.wmsUrl)),e.setFeatureInfoEnabled("disabled"!==t.gfi),e.setVersion(t.version),t.formats&&(e.setQueryFormat(t.formats.value),e.setAvailableQueryFormats(t.formats.available));var i=this._localization["default-style"],n=Oskari.clazz.create("Oskari.mapframework.domain.Style");return n.setName(""),n.setTitle(i),n.setLegend(""),this.populateStyles(e,t,n)},populateStyles:function(e,t,i){var n,a,r,s,o=Oskari.clazz.builder("Oskari.mapframework.domain.Style");if(t.styles){for(n=0;n<t.styles.length&&(a=t.styles,r=!isNaN(n),r&&(a=t.styles[n]),a.identifier&&(a.name||(a.name=a.identifier),a.title||(a.title=a.identifier),a.isDefault&&!t.style&&(t.style=a.identifier)),s=o(),s.setName(a.name),s.setTitle(a.title),s.setLegend(a.legend),e.addStyle(s),r);n++);e.selectStyle(t.style)}return i&&(e.addStyle(i),e.selectStyle(i.getName())),e},checkForDuplicateId:function(e,t){if(this._reservedLayerIds[e]===!0){var i=this.findMapLayer(e);throw"Trying to add map layer with id '"+e+" ("+t+")' but that id is already reserved for '"+i.getName()+"'"}},findMapLayer:function(e,t){var i,n,a=[];for(t||(t=this._loadedLayersList),i=0;i<t.length;i++){if(n=t[i],n.getId()+""==e+"")return n;a=a.concat(n.getSubLayers())}return a.length>0?this.findMapLayer(e,a):null}},{protocol:["Oskari.mapframework.service.Service"]}),define("sources/framework/service/map-layer-service",function(){}),require(["sources/framework/service/map-layer-service"],function(){}),define("src/mapping/service/MapLayerService",function(){}),define("src/oskari/base/service/module",["src/oskari/oskari","./service","src/mapping/service/MapLayerService"],function(e){e.bundleCls("service-base"),e.bundleCls("service-map")}),define("src/oskari/base/module",["src/oskari/oskari","./core/module","./event/module","./domain/module","./request/module","./sandbox/module","./service/module"],function(){}),define("jquery-migrate",["jquery"],function(e){return function(e,t,i){function n(i){var n=t.console;r[i]||(r[i]=!0,e.migrateWarnings.push(i),n&&n.warn&&!e.migrateMute&&(n.warn("JQMIGRATE: "+i),e.migrateTrace&&n.trace&&n.trace()))}function a(t,i,a,r){if(Object.defineProperty)try{return void Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get:function(){return n(r),a},set:function(e){n(r),a=e}})}catch(s){}e._definePropertyBroken=!0,t[i]=a}var r={};e.migrateWarnings=[],!e.migrateMute&&t.console&&t.console.log&&t.console.log("JQMIGRATE: Logging is active"),e.migrateTrace===i&&(e.migrateTrace=!0),e.migrateReset=function(){r={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&n("jQuery is not compatible with Quirks Mode");var s=e("<input/>",{size:1}).attr("size")&&e.attrFn,o=e.attr,l=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},u=e.attrHooks.value&&e.attrHooks.value.set||function(){return i},c=/^(?:input|button)$/i,d=/^[238]$/,h=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;a(e,"attrFn",s||{},"jQuery.attrFn is deprecated"),e.attr=function(t,a,r,l){var u=a.toLowerCase(),f=t&&t.nodeType;return l&&(o.length<4&&n("jQuery.fn.attr( props, pass ) is deprecated"),t&&!d.test(f)&&(s?a in s:e.isFunction(e.fn[a])))?e(t)[a](r):("type"===a&&r!==i&&c.test(t.nodeName)&&t.parentNode&&n("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[u]&&h.test(u)&&(e.attrHooks[u]={get:function(t,n){var a,r=e.prop(t,n);return r===!0||"boolean"!=typeof r&&(a=t.getAttributeNode(n))&&a.nodeValue!==!1?n.toLowerCase():i},set:function(t,i,n){var a;return i===!1?e.removeAttr(t,n):(a=e.propFix[n]||n,a in t&&(t[a]=!0),t.setAttribute(n,n.toLowerCase())),n}},p.test(u)&&n("jQuery.fn.attr('"+u+"') may use property instead of attribute")),o.call(e,t,a,r))},e.attrHooks.value={get:function(e,t){var i=(e.nodeName||"").toLowerCase();return"button"===i?l.apply(this,arguments):("input"!==i&&"option"!==i&&n("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var i=(e.nodeName||"").toLowerCase();return"button"===i?u.apply(this,arguments):("input"!==i&&"option"!==i&&n("jQuery.fn.attr('value', val) no longer sets properties"),void(e.value=t))}};var f,m,g=e.fn.init,v=e.parseJSON,y=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,i,a){var r;return t&&"string"==typeof t&&!e.isPlainObject(i)&&(r=y.exec(e.trim(t)))&&r[0]&&("<"!==t.charAt(0)&&n("$(html) HTML strings must start with '<' character"),r[3]&&n("$(html) HTML text after last tag is ignored"),"#"===r[0].charAt(0)&&(n("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),i&&i.context&&(i=i.context),e.parseHTML)?g.call(this,e.parseHTML(r[2],i,!0),i,a):g.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return e||null===e?v.apply(this,arguments):(n("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(f=e.uaMatch(navigator.userAgent),m={},f.browser&&(m[f.browser]=!0,m.version=f.version),m.chrome?m.webkit=!0:m.webkit&&(m.safari=!0),e.browser=m),a(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,i){return new t.fn.init(e,i)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(n,a){return a&&a instanceof e&&!(a instanceof t)&&(a=t(a)),e.fn.init.call(this,n,a,i)},t.fn.init.prototype=t.fn;var i=t(document);return n("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var b=e.fn.data;e.fn.data=function(t){var a,r,s=this[0];return!s||"events"!==t||1!==arguments.length||(a=e.data(s,t),r=e._data(s,t),a!==i&&a!==r||r===i)?b.apply(this,arguments):(n("Use of jQuery.fn.data('events') is deprecated"),r)};var k=/\/(java|ecma)script/i,_=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return n("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),_.apply(this,arguments)},e.clean||(e.clean=function(t,i,a,r){i=i||document,i=!i.nodeType&&i[0]||i,i=i.ownerDocument||i,n("jQuery.clean() is deprecated");var s,o,l,u,c=[];if(e.merge(c,e.buildFragment(t,i).childNodes),a)for(l=function(e){return!e.type||k.test(e.type)?r?r.push(e.parentNode?e.parentNode.removeChild(e):e):a.appendChild(e):void 0},s=0;null!=(o=c[s]);s++)e.nodeName(o,"script")&&l(o)||(a.appendChild(o),"undefined"!=typeof o.getElementsByTagName&&(u=e.grep(e.merge([],o.getElementsByTagName("script")),l),c.splice.apply(c,[s+1,0].concat(u)),s+=u.length));return c});var w=e.event.add,L=e.event.remove,x=e.event.trigger,S=e.fn.toggle,O=e.fn.live,T=e.fn.die,C="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",M=new RegExp("\\b(?:"+C+")\\b"),N=/(?:^|\s)hover(\.\S+|)\b/,E=function(t){return"string"!=typeof t||e.event.special.hover?t:(N.test(t)&&n("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(N,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&a(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,i,a,r){e!==document&&M.test(t)&&n("AJAX events should be attached to document: "+t),w.call(this,e,E(t||""),i,a,r)},e.event.remove=function(e,t,i,n,a){L.call(this,e,E(t)||"",i,n,a)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return n("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,i){if(!e.isFunction(t)||!e.isFunction(i))return S.apply(this,arguments);n("jQuery.fn.toggle(handler, handler...) is deprecated");var a=arguments,r=t.guid||e.guid++,s=0,o=function(i){var n=(e._data(this,"lastToggle"+t.guid)||0)%s;return e._data(this,"lastToggle"+t.guid,n+1),i.preventDefault(),a[n].apply(this,arguments)||!1};for(o.guid=r;s<a.length;)a[s++].guid=r;return this.click(o)},e.fn.live=function(t,i,a){return n("jQuery.fn.live() is deprecated"),O?O.apply(this,arguments):(e(this.context).on(t,this.selector,i,a),this)},e.fn.die=function(t,i){return n("jQuery.fn.die() is deprecated"),T?T.apply(this,arguments):(e(this.context).off(t,this.selector||"**",i),this)},e.event.trigger=function(e,t,i,a){return i||M.test(e)||n("Global events are undocumented and deprecated"),x.call(this,e,t,i||document,a)},e.each(C.split("|"),function(t,i){e.event.special[i]={setup:function(){var t=this;return t!==document&&(e.event.add(document,i+"."+e.guid,function(){e.event.trigger(i,null,t,!0)}),e._data(this,i,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,i+"."+e._data(this,i)),!1}}})}(e,window),e.noConflict(!0)}),define("libraries/jquery/jquery-ui-1.9.2.custom-modified",["jquery"],function(e){!function(e,t){function i(t,i){var a,r,s,o=t.nodeName.toLowerCase();return"area"===o?(a=t.parentNode,r=a.name,t.href&&r&&"map"===a.nodeName.toLowerCase()?(s=e("img[usemap=#"+r+"]")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var a=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var n=this;setTimeout(function(){e(n).focus(),i&&i.call(n)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,a,r=e(this[0]);r.length&&r[0]!==document;){if(n=r.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(a=parseInt(r.css("zIndex"),10),!isNaN(a)&&0!==a))return a;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),a=isNaN(n);return(a||n>=0)&&i(t,!a)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));i.offsetHeight,e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function a(t,i,n,a){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?o["inner"+n].call(this):this.each(function(){e(this).css(s,a(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?o["outer"+n].call(this,t):this.each(function(){e(this).css(s,a(this,t,!0,i)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var a,r=e.ui[t].prototype;for(a in n)r.plugins[a]=r.plugins[a]||[],r.plugins[a].push([i,n[a]])},call:function(e,t,i){var n,a=e.plugins[t];if(a&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<a.length;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}},contains:e.contains,hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return t[n]>0?!0:(t[n]=1,a=t[n]>0,t[n]=0,a)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,n,a,r,s){return e.ui.isOverAxis(t,n,r)&&e.ui.isOverAxis(i,a,s)}}))}(e),function(e,t){var i=0,n=Array.prototype.slice,a=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(r){}a(t)},e.widget=function(t,i,n){var a,r,s,o,l=t.split(".")[0];t=t.split(".")[1],a=l+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[l]=e[l]||{},r=e[l][t],s=e[l][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),o=new i,o.options=e.widget.extend({},o.options),e.each(n,function(t,a){e.isFunction(a)&&(n[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=n,t=a.apply(this,arguments),this._super=i,this._superApply=r,t}}())}),s.prototype=e.widget.extend(o,{widgetEventPrefix:r?o.widgetEventPrefix:t},n,{constructor:s,namespace:l,widgetName:t,widgetBaseClass:a,widgetFullName:a}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete r._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var a,r,s=n.call(arguments,1),o=0,l=s.length;l>o;o++)for(a in s[o])r=s[o][a],s[o].hasOwnProperty(a)&&r!==t&&(i[a]=e.isPlainObject(r)?e.isPlainObject(i[a])?e.widget.extend({},i[a],r):e.widget.extend({},r):r);return i},e.widget.bridge=function(i,a){var r=a.prototype.widgetFullName||i;e.fn[i]=function(s){var o="string"==typeof s,l=n.call(arguments,1),u=this;return s=!o&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,this.each(o?function(){var n,a=e.data(this,r);return a?e.isFunction(a[s])&&"_"!==s.charAt(0)?(n=a[s].apply(a,l),n!==a&&n!==t?(u=n&&n.jquery?u.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")}:function(){var t=e.data(this,r);t?t.option(s||{})._init():e.data(this,r,new a(s,this))}),u}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetName,this),e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var a,r,s,o=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(o={},a=i.split("."),i=a.shift(),a.length){for(r=o[i]=e.widget.extend({},this.options[i]),s=0;s<a.length-1;s++)r[a[s]]=r[a[s]]||{},r=r[a[s]];if(i=a.pop(),n===t)return r[i]===t?null:r[i];r[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];o[i]=n}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var a,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=a=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,a=this.widget()),e.each(n,function(n,s){function o(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(o.guid=s.guid=s.guid||o.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),u=l[1]+r.eventNamespace,c=l[2];c?a.delegate(c,u,o):i.bind(u,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var a,r,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(a in r)a in i||(i[a]=r[a]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,a,r){"string"==typeof a&&(a={effect:a});var s,o=a?a===!0||"number"==typeof a?i:a.effect||i:t;a=a||{},"number"==typeof a&&(a={duration:a}),s=!e.isEmptyObject(a),a.complete=r,a.delay&&n.delay(a.delay),s&&e.effects&&(e.effects.effect[o]||e.uiBackCompat!==!1&&e.effects[o])?n[t](a):o!==t&&n[o]?n[o](a.duration,a.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(e),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,a=1===i.which,r="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return a&&!r&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(e),function(t,i){function n(e,t,i){return[parseInt(e[0],10)*(p.test(e[0])?t/100:1),parseInt(e[1],10)*(p.test(e[1])?i/100:1)]}function a(e,i){return parseInt(t.css(e,i),10)||0}t.ui=t.ui||{};var r,s=Math.max,o=Math.abs,l=Math.round,u=/left|center|right/,c=/top|center|bottom/,d=/[\+\-]\d+%?/,h=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(r!==i)return r;var e,n,a=t("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=a.children()[0];return t("body").append(a),e=s.offsetWidth,a.css("overflow","scroll"),n=s.offsetWidth,e===n&&(n=a[0].clientWidth),a.remove(),r=e-n},getScrollInfo:function(e){var i=e.isWindow?"":e.element.css("overflow-x"),n=e.isWindow?"":e.element.css("overflow-y"),a="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,r="scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight;return{width:a?t.position.scrollbarWidth():0,height:r?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var i,r,p,m,g,v=t(e.of),y=t.position.getWithinInfo(e.within),b=t.position.getScrollInfo(y),k=v[0],_=(e.collision||"flip").split(" "),w={};return 9===k.nodeType?(r=v.width(),p=v.height(),m={top:0,left:0}):t.isWindow(k)?(r=v.width(),p=v.height(),m={top:v.scrollTop(),left:v.scrollLeft()}):k.preventDefault?(e.at="left top",r=p=0,m={top:k.pageY,left:k.pageX}):(r=v.outerWidth(),p=v.outerHeight(),m=v.offset()),g=t.extend({},m),t.each(["my","at"],function(){var t,i,n=(e[this]||"").split(" ");1===n.length&&(n=u.test(n[0])?n.concat(["center"]):c.test(n[0])?["center"].concat(n):["center","center"]),n[0]=u.test(n[0])?n[0]:"center",n[1]=c.test(n[1])?n[1]:"center",t=d.exec(n[0]),i=d.exec(n[1]),w[this]=[t?t[0]:0,i?i[0]:0],e[this]=[h.exec(n[0])[0],h.exec(n[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===e.at[0]?g.left+=r:"center"===e.at[0]&&(g.left+=r/2),"bottom"===e.at[1]?g.top+=p:"center"===e.at[1]&&(g.top+=p/2),i=n(w.at,r,p),g.left+=i[0],g.top+=i[1],this.each(function(){var u,c,d=t(this),h=d.outerWidth(),f=d.outerHeight(),k=a(this,"marginLeft"),L=a(this,"marginTop"),x=h+k+a(this,"marginRight")+b.width,S=f+L+a(this,"marginBottom")+b.height,O=t.extend({},g),T=n(w.my,d.outerWidth(),d.outerHeight());"right"===e.my[0]?O.left-=h:"center"===e.my[0]&&(O.left-=h/2),"bottom"===e.my[1]?O.top-=f:"center"===e.my[1]&&(O.top-=f/2),O.left+=T[0],O.top+=T[1],t.support.offsetFractions||(O.left=l(O.left),O.top=l(O.top)),u={marginLeft:k,marginTop:L},t.each(["left","top"],function(n,a){t.ui.position[_[n]]&&t.ui.position[_[n]][a](O,{targetWidth:r,targetHeight:p,elemWidth:h,elemHeight:f,collisionPosition:u,collisionWidth:x,collisionHeight:S,offset:[i[0]+T[0],i[1]+T[1]],my:e.my,at:e.at,within:y,elem:d})}),t.fn.bgiframe&&d.bgiframe(),e.using&&(c=function(t){var i=m.left-O.left,n=i+r-h,a=m.top-O.top,l=a+p-f,u={target:{element:v,left:m.left,top:m.top,width:r,height:p},element:{element:d,left:O.left,top:O.top,width:h,height:f},horizontal:0>n?"left":i>0?"right":"center",vertical:0>l?"top":a>0?"bottom":"middle"};h>r&&o(i+n)<r&&(u.horizontal="center"),f>p&&o(a+l)<p&&(u.vertical="middle"),u.important=s(o(i),o(n))>s(o(a),o(l))?"horizontal":"vertical",e.using.call(this,t,u)}),d.offset(t.extend(O,{using:c}))})},t.ui.position={fit:{left:function(e,t){var i,n=t.within,a=n.isWindow?n.scrollLeft:n.offset.left,r=n.width,o=e.left-t.collisionPosition.marginLeft,l=a-o,u=o+t.collisionWidth-r-a;t.collisionWidth>r?l>0&&0>=u?(i=e.left+l+t.collisionWidth-r-a,e.left+=l-i):e.left=u>0&&0>=l?a:l>u?a+r-t.collisionWidth:a:l>0?e.left+=l:u>0?e.left-=u:e.left=s(e.left-o,e.left)},top:function(e,t){var i,n=t.within,a=n.isWindow?n.scrollTop:n.offset.top,r=t.within.height,o=e.top-t.collisionPosition.marginTop,l=a-o,u=o+t.collisionHeight-r-a;t.collisionHeight>r?l>0&&0>=u?(i=e.top+l+t.collisionHeight-r-a,e.top+=l-i):e.top=u>0&&0>=l?a:l>u?a+r-t.collisionHeight:a:l>0?e.top+=l:u>0?e.top-=u:e.top=s(e.top-o,e.top)}},flip:{left:function(e,t){var i,n,a=t.within,r=a.offset.left+a.scrollLeft,s=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,u=e.left-t.collisionPosition.marginLeft,c=u-l,d=u+t.collisionWidth-s-l,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>c?(i=e.left+h+p+f+t.collisionWidth-s-r,(0>i||i<o(c))&&(e.left+=h+p+f)):d>0&&(n=e.left-t.collisionPosition.marginLeft+h+p+f-l,(n>0||o(n)<d)&&(e.left+=h+p+f))},top:function(e,t){var i,n,a=t.within,r=a.offset.top+a.scrollTop,s=a.height,l=a.isWindow?a.scrollTop:a.offset.top,u=e.top-t.collisionPosition.marginTop,c=u-l,d=u+t.collisionHeight-s-l,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>c?(n=e.top+p+f+m+t.collisionHeight-s-r,e.top+p+f+m>c&&(0>n||n<o(c))&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-l,e.top+p+f+m>d&&(i>0||o(i)<d)&&(e.top+=p+f+m))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,a,r,s=document.getElementsByTagName("body")[0],o=document.createElement("div");e=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in n)e.style[r]=n[r];e.appendChild(o),i=s||document.documentElement,i.insertBefore(e,i.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",a=t(o).offset().left,t.support.offsetFractions=a>10&&11>a,e.innerHTML="",i.removeChild(e)}(),t.uiBackCompat!==!1&&!function(e){var t=e.fn.position;e.fn.position=function(n){if(!n||!n.offset)return t.call(this,n);var a=n.offset.split(" "),r=n.at.split(" ");return 1===a.length&&(a[1]=a[0]),/^\d/.test(a[0])&&(a[0]="+"+a[0]),/^\d/.test(a[1])&&(a[1]="+"+a[1]),1===r.length&&(/left|center|right/.test(r[0])?r[1]="center":(r[1]=r[0],r[0]="center")),t.call(this,e.extend(n,{at:r[0]+a[0]+" "+r[1]+a[1],offset:i}))}}(e)}(e),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")
}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var n=this.element[0],a=!1;n&&(n=n.parentNode);)n==document&&(a=!0);if(!a&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]==this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var i=e(t.containment),n=i[0];if(!n)return;var a=(i.offset(),"hidden"!=e(n).css("overflow"));this.containment=[(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0),(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0),(a?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(a?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*n}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName),r=t.pageX,s=t.pageY;if(this.originalPosition){var o;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();o=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else o=this.containment;t.pageX-this.offset.click.left<o[0]&&(r=o[0]+this.offset.click.left),t.pageY-this.offset.click.top<o[1]&&(s=o[1]+this.offset.click.top),t.pageX-this.offset.click.left>o[2]&&(r=o[2]+this.offset.click.left),t.pageY-this.offset.click.top>o[3]&&(s=o[3]+this.offset.click.top)}if(i.grid){var u=i.grid[1]?this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;s=o?u-this.offset.click.top<o[1]||u-this.offset.click.top>o[3]?u-this.offset.click.top<o[1]?u+i.grid[1]:u-i.grid[1]:u:u;var c=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=o?c-this.offset.click.left<o[0]||c-this.offset.click.left>o[2]?c-this.offset.click.left<o[0]?c+i.grid[0]:c-i.grid[0]:c:c}}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("draggable"),a=n.options,r=e.extend({},i,{item:n.element});n.sortables=[],e(a.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i){var n=e(this).data("draggable"),a=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,a))})},drag:function(t,i){var n=e(this).data("draggable"),a=this;e.each(n.sortables,function(){var r=!1,s=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!=s&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(s.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(a).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),a=e(this).data("draggable").options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i){var n=e(this).data("draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),n=i.options,a=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){for(var n=e(this).data("draggable"),a=n.options,r=a.snapTolerance,s=i.offset.left,o=s+n.helperProportions.width,l=i.offset.top,u=l+n.helperProportions.height,c=n.snapElements.length-1;c>=0;c--){var d=n.snapElements[c].left,h=d+n.snapElements[c].width,p=n.snapElements[c].top,f=p+n.snapElements[c].height;if(s>d-r&&h+r>s&&l>p-r&&f+r>l||s>d-r&&h+r>s&&u>p-r&&f+r>u||o>d-r&&h+r>o&&l>p-r&&f+r>l||o>d-r&&h+r>o&&u>p-r&&f+r>u){if("inner"!=a.snapMode){var m=Math.abs(p-u)<=r,g=Math.abs(f-l)<=r,v=Math.abs(d-o)<=r,y=Math.abs(h-s)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d-n.helperProportions.width}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left)}var b=m||g||v||y;if("outer"!=a.snapMode){var m=Math.abs(p-l)<=r,g=Math.abs(f-u)<=r,v=Math.abs(d-s)<=r,y=Math.abs(h-o)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f-n.helperProportions.height,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[c].snapping&&(m||g||v||y||b)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=m||g||v||y||b}else n.snapElements[c].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});if(i.length){var n=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=n+e}),this[0].style.zIndex=n+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),a=e(this).data("draggable").options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i){var n=e(this).data("draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(e),function(e){e.widget("ui.droppable",{version:"1.9.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;i<t.length;i++)t[i]==this&&t.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return!1;var a=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope==n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(a=!0,!1):void 0}),a?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,i,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left,r=a+t.helperProportions.width,s=(t.positionAbs||t.position.absolute).top,o=s+t.helperProportions.height,l=i.offset.left,u=l+i.proportions.width,c=i.offset.top,d=c+i.proportions.height;switch(n){case"fit":return a>=l&&u>=r&&s>=c&&d>=o;case"intersect":return l<a+t.helperProportions.width/2&&r-t.helperProportions.width/2<u&&c<s+t.helperProportions.height/2&&o-t.helperProportions.height/2<d;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,f=e.ui.isOver(p,h,c,l,i.proportions.height,i.proportions.width);return f;case"touch":return(s>=c&&d>=s||o>=c&&d>=o||c>s&&o>d)&&(a>=l&&u>=a||r>=l&&u>=r||l>a&&r>u);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n=e.ui.ddmanager.droppables[t.options.scope]||[],a=i?i.type:null,r=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var s=0;s<n.length;s++)if(!(n[s].options.disabled||t&&!n[s].accept.call(n[s].element[0],t.currentItem||t.element))){for(var o=0;o<r.length;o++)if(r[o]==n[s].element[0]){n[s].proportions.height=0;continue e}n[s].visible="none"!=n[s].element.css("display"),n[s].visible&&("mousedown"==a&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions={width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n=e.ui.intersect(t,this,this.options.tolerance),a=n||1!=this.isover?n&&0==this.isover?"isover":null:"isout";if(a){var r;if(this.options.greedy){var s=this.options.scope,o=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===s});o.length&&(r=e.data(o[0],"droppable"),r.greedyChild="isover"==a?1:0)}r&&"isover"==a&&(r.isover=0,r.isout=1,r._out.call(r,i)),this[a]=1,this["isout"==a?"isover":"isout"]=0,this["isover"==a?"_over":"_out"].call(this,i),r&&"isout"==a&&(r.isout=0,r.isover=1,r._over.call(r,i))}}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(e),function(e){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var n=this.handles.split(",");this.handles={};for(var a=0;a<n.length;a++){var r=e.trim(n[a]),s="ui-resizable-"+r,o=e('<div class="ui-resizable-handle '+s+'"></div>');o.css({zIndex:i.zIndex}),"se"==r&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(o)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var n=e(this.handles[i],this.element),a=0;a=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth();var r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");t.css(r,a),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){i.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())}).mouseleave(function(){i.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")}).insertAfter(i),i.remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var n in this.handles)e(this.handles[n])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var n=this.options,a=this.element.position(),r=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(r.is(".ui-draggable")||/absolute/.test(r.css("position")))&&r.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy();var s=t(this.helper.css("left")),o=t(this.helper.css("top"));n.containment&&(s+=e(n.containment).scrollLeft()||0,o+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:s,top:o},this.size=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalPosition={left:s,top:o},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1;var l=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor","auto"==l?this.axis+"-resize":l),r.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var t=this.helper,i=(this.options,this.originalMousePosition),n=this.axis,a=e.pageX-i.left||0,r=e.pageY-i.top||0,s=this._change[n];if(!s)return!1;var o=s.apply(this,[e,a,r]);return this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(o=this._updateRatio(o,e)),o=this._respectSize(o,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(o),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,n=this;if(this._helper){var a=this._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),s=r&&e.ui.hasScroll(a[0],"left")?0:n.sizeDiff.height,o=r?0:n.sizeDiff.width,l={width:n.helper.width()-o,height:n.helper.height()-s},u=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,c=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;i.animate||this.element.css(e.extend(l,{top:c,left:u})),n.helper.height(n.size.height),n.helper.width(n.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,a,r,s,o=this.options;s={minWidth:i(o.minWidth)?o.minWidth:0,maxWidth:i(o.maxWidth)?o.maxWidth:1/0,minHeight:i(o.minHeight)?o.minHeight:0,maxHeight:i(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,a=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),a>s.minHeight&&(s.minHeight=a),n<s.maxWidth&&(s.maxWidth=n),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.options;this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),n=this.size,a=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"==a&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"==a&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e,t){var n=(this.helper,this._vBoundaries),a=(this._aspectRatio||t.shiftKey,this.axis),r=i(e.width)&&n.maxWidth&&n.maxWidth<e.width,s=i(e.height)&&n.maxHeight&&n.maxHeight<e.height,o=i(e.width)&&n.minWidth&&n.minWidth>e.width,l=i(e.height)&&n.minHeight&&n.minHeight>e.height;o&&(e.width=n.minWidth),l&&(e.height=n.minHeight),r&&(e.width=n.maxWidth),s&&(e.height=n.maxHeight);var u=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,d=/sw|nw|w/.test(a),h=/nw|ne|n/.test(a);o&&d&&(e.left=u-n.minWidth),r&&d&&(e.left=u-n.maxWidth),l&&h&&(e.top=c-n.minHeight),s&&h&&(e.top=c-n.maxHeight);var p=!e.width&&!e.height;return p&&!e.left&&e.top?e.top=null:p&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){this.options;if(this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;i<this._proportionallyResizeElements.length;i++){var n=this._proportionallyResizeElements[i];if(!this.borderDif){var a=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],r=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];this.borderDif=e.map(a,function(e,t){var i=parseInt(e,10)||0,n=parseInt(r[t],10)||0;return i+n})}n.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.ui.ie6?1:0,a=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+a,height:this.element.outerHeight()+a,position:"absolute",left:this.elementOffset.left-n+"px",top:this.elementOffset.top-n+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()
}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=(this.options,this.originalSize),a=this.originalPosition;return{top:a.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("resizable"),a=n.options,r=n.originalSize,s=n.originalPosition,o={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,n){e(t).each(function(){var t=e(this),a=e(this).data("resizable-alsoresize"),r={},s=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(a[t]||0)+(o[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})};"object"!=typeof a.alsoResize||a.alsoResize.nodeType?l(a.alsoResize):e.each(a.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("resizable"),n=i.options,a=i._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),s=r&&e.ui.hasScroll(a[0],"left")?0:i.sizeDiff.height,o=r?0:i.sizeDiff.width,l={width:i.size.width-o,height:i.size.height-s},u=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&u?{top:c,left:u}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};a&&a.length&&e(a[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),n=i.options,a=i.element,r=n.containment,s=r instanceof e?r.get(0):/parent/.test(r)?a.parent().get(0):r;if(s)if(i.containerElement=e(s),/document/.test(r)||r==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var o=e(s),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,i){l[e]=t(o.css("padding"+i))}),i.containerOffset=o.offset(),i.containerPosition=o.position(),i.containerSize={height:o.innerHeight()-l[3],width:o.innerWidth()-l[1]};var u=i.containerOffset,c=i.containerSize.height,d=i.containerSize.width,h=e.ui.hasScroll(s,"left")?s.scrollWidth:d,p=e.ui.hasScroll(s)?s.scrollHeight:c;i.parentData={element:s,left:u.left,top:u.top,width:h,height:p}}},resize:function(t){var i=e(this).data("resizable"),n=i.options,a=(i.containerSize,i.containerOffset),r=(i.size,i.position),s=i._aspectRatio||t.shiftKey,o={top:0,left:0},l=i.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(o=a),r.left<(i._helper?a.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-a.left:i.position.left-o.left),s&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=n.helper?a.left:0),r.top<(i._helper?a.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-a.top:i.position.top),s&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?a.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var u=Math.abs((i._helper?i.offset.left-o.left:i.offset.left-o.left)+i.sizeDiff.width),c=Math.abs((i._helper?i.offset.top-o.top:i.offset.top-a.top)+i.sizeDiff.height),d=i.containerElement.get(0)==i.element.parent().get(0),h=/relative|absolute/.test(i.containerElement.css("position"));d&&h&&(u-=i.parentData.left),u+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-u,s&&(i.size.height=i.size.width/i.aspectRatio)),c+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-c,s&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data("resizable"),i=t.options,n=(t.position,t.containerOffset),a=t.containerPosition,r=t.containerElement,s=e(t.helper),o=s.offset(),l=s.outerWidth()-t.sizeDiff.width,u=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:o.left-a.left-n.left,width:l,height:u}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:o.left-a.left-n.left,width:l,height:u})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){{var t=e(this).data("resizable");t.options}t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){{var t=e(this).data("resizable");t.options}t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t){{var i=e(this).data("resizable"),n=i.options,a=i.size,r=i.originalSize,s=i.originalPosition,o=i.axis;n._aspectRatio||t.shiftKey}n.grid="number"==typeof n.grid?[n.grid,n.grid]:n.grid;var l=Math.round((a.width-r.width)/(n.grid[0]||1))*(n.grid[0]||1),u=Math.round((a.height-r.height)/(n.grid[1]||1))*(n.grid[1]||1);/^(se|s|e)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u):/^(ne)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u,i.position.top=s.top-u):/^(sw)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u,i.position.left=s.left-l):(i.size.width=r.width+l,i.size.height=r.height+u,i.position.top=s.top-u,i.position.left=s.left-l)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}}(e),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass("ui-selectee"),i.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var n=this.options;this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,t.metaKey||t.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().andSelf().each(function(){var n=e.data(this,"selectable-item");if(n){var a=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected");return n.$element.removeClass(a?"ui-unselecting":"ui-selected").addClass(a?"ui-selecting":"ui-unselecting"),n.unselecting=!a,n.selecting=a,n.selected=a,a?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var n=this.options,a=this.opos[0],r=this.opos[1],s=t.pageX,o=t.pageY;if(a>s){var l=s;s=a,a=l}if(r>o){var l=o;o=r,r=l}return this.helper.css({left:a,top:r,width:s-a,height:o-r}),this.selectees.each(function(){var l=e.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var u=!1;"touch"==n.tolerance?u=!(l.left>s||l.right<a||l.top>o||l.bottom<r):"fit"==n.tolerance&&(u=l.left>a&&l.right<s&&l.top>r&&l.bottom<o),u?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",t,{selecting:l.element}))):(l.selecting&&((t.metaKey||t.ctrlKey)&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",t,{unselecting:l.element}))),l.selected&&(t.metaKey||t.ctrlKey||l.startselected||(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",t,{unselecting:l.element}))))}}),!1}},_mouseStop:function(t){var i=this;this.dragged=!1;this.options;return e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(e),function(e){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);{var a=null;e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")==n?(a=e(this),!1):void 0})}if(e.data(t.target,n.widgetName+"-item")==n&&(a=e(t.target)),!a)return!1;if(this.options.handle&&!i){var r=!1;if(e(this.options.handle,a).find("*").andSelf().each(function(){this==t.target&&(r=!0)}),!r)return!1}return this.currentItem=a,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,n){var a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",a.cursor)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var a=this.items.length-1;a>=0;a--){var r=this.items[a],s=r.item[0],o=this._intersectsWithPointer(r);if(o&&r.instance===this.currentContainer&&s!=this.currentItem[0]&&this.placeholder[1==o?"next":"prev"]()[0]!=s&&!e.contains(this.placeholder[0],s)&&("semi-dynamic"==this.options.type?!e.contains(this.element[0],s):!0)){if(this.direction=1==o?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,a=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,a=n+this.helperProportions.height,r=e.left,s=r+e.width,o=e.top,l=o+e.height,u=this.offset.click.top,c=this.offset.click.left,d=n+u>o&&l>n+u&&t+c>r&&s>t+c;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?d:r<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&o<n+this.helperProportions.height/2&&a-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),a=i&&n,r=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return a?this.floating?s&&"right"==s||"down"==r?2:1:r&&("down"==r?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),a=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&n||"left"==r&&!n:a&&("down"==a&&i||"up"==a&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],n=[],a=this._connectWith();if(a&&t)for(var r=a.length-1;r>=0;r--)for(var s=e(a[r]),o=s.length-1;o>=0;o--){var l=e.data(s[o],this.widgetName);l&&l!=this&&!l.options.disabled&&n.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var r=n.length-1;r>=0;r--)n[r][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,n=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],a=this._connectWith();if(a&&this.ready)for(var r=a.length-1;r>=0;r--)for(var s=e(a[r]),o=s.length-1;o>=0;o--){var l=e.data(s[o],this.widgetName);l&&l!=this&&!l.options.disabled&&(n.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var r=n.length-1;r>=0;r--)for(var u=n[r][1],c=n[r][0],o=0,d=c.length;d>o;o++){var h=e(c[o]);h.data(this.widgetName+"-item",u),i.push({item:h,instance:u,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var a=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item;t||(n.width=a.outerWidth(),n.height=a.outerHeight());var r=a.offset();n.left=r.left,n.top=r.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var r=this.containers[i].element.offset();this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var i=t.options;if(!i.placeholder||i.placeholder.constructor==String){var n=i.placeholder;i.placeholder={element:function(){var i=e(document.createElement(t.currentItem[0].nodeName)).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return n||(i.style.visibility="hidden"),i},update:function(e,a){(!n||i.forcePlaceholderSize)&&(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}}t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var i=null,n=null,a=this.containers.length-1;a>=0;a--)if(!e.contains(this.currentItem[0],this.containers[a].element[0]))if(this._intersectsWith(this.containers[a].containerCache)){if(i&&e.contains(this.containers[a].element[0],i.element[0]))continue;i=this.containers[a],n=a}else this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",t,this._uiHash(this)),this.containers[a].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1;else{for(var r=1e4,s=null,o=this.containers[n].floating?"left":"top",l=this.containers[n].floating?"width":"height",u=this.positionAbs[o]+this.offset.click[o],c=this.items.length-1;c>=0;c--)if(e.contains(this.containers[n].element[0],this.items[c].item[0])&&this.items[c].item[0]!=this.currentItem[0]){var d=this.items[c].item.offset()[o],h=!1;Math.abs(d-u)>Math.abs(d+this.items[c][l]-u)&&(h=!0,d+=this.items[c][l]),Math.abs(d-u)<r&&(r=Math.abs(d-u),s=this.items[c],this.direction=h?"up":"down")}if(!s&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],s?this._rearrange(t,s,null,!0):this._rearrange(t,null,this.containers[n].element,!0),this._trigger("change",t,this._uiHash()),this.containers[n]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],n=e(t.containment).offset(),a="hidden"!=e(i).css("overflow");this.containment=[n.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(a?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(a?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*n}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var r=t.pageX,s=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),i.grid)){var o=this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1];s=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+i.grid[1]:o-i.grid[1]:o:o;var l=this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0];r=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay(function(){a==this.counter&&this.refreshPositions(!n)
})},_clear:function(t,i){this.reverting=!1;var n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var a in this._storedCSS)("auto"==this._storedCSS[a]||"static"==this._storedCSS[a])&&(this._storedCSS[a]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!i&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||i||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(i||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var a=this.containers.length-1;a>=0;a--)i||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[a])),this.containers[a].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[a])),this.containers[a].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var a=0;a<n.length;a++)n[a].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var a=0;a<n.length;a++)n[a].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(e),function(e){var t=0;e.widget("ui.autocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,i,n;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(a){if(this.element.prop("readOnly"))return t=!0,n=!0,void(i=!0);t=!1,n=!1,i=!1;var r=e.ui.keyCode;switch(a.keyCode){case r.PAGE_UP:t=!0,this._move("previousPage",a);break;case r.PAGE_DOWN:t=!0,this._move("nextPage",a);break;case r.UP:t=!0,this._keyEvent("previous",a);break;case r.DOWN:t=!0,this._keyEvent("next",a);break;case r.ENTER:case r.NUMPAD_ENTER:this.menu.active&&(t=!0,a.preventDefault(),this.menu.select(a));break;case r.TAB:this.menu.active&&this.menu.select(a);break;case r.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(a),a.preventDefault());break;default:i=!0,this._searchTimeout(a)}},keypress:function(n){if(t)return t=!1,void n.preventDefault();if(!i){var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:this._move("previousPage",n);break;case a.PAGE_DOWN:this._move("nextPage",n);break;case a.UP:this._keyEvent("previous",n);break;case a.DOWN:this._keyEvent("next",n)}}},input:function(e){return n?(n=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:e(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(n){n.target===t.element[0]||n.target===i||e.contains(i,n.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});var n=i.item.data("ui-autocomplete-item")||i.item.data("item.autocomplete");!1!==this._trigger("focus",t,{item:n})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value):this.liveRegion.text(n.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),e.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this.document.find(t||"body")[0]),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var t,i,n=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,n){n(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,a){n.xhr&&n.xhr.abort(),n.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){a(e)},error:function(){a([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,i=++t;return function(n){i===t&&e.__response(n),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(i,t),this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(e),function(e){var t=!1;e.widget("ui.menu",{version:"1.9.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(i){var n=e(i.target).closest(".ui-menu-item");!t&&n.not(".ui-state-disabled").length&&(t=!0,this.select(i),n.has(".ui-menu").length?this.expand(i):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(i){e(i.target).closest(".ui-menu").length||this.collapseAll(i),t=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,a,r,s,o,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,a=this.previousFilter||"",r=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),r===a?s=!0:r=a+r,o=new RegExp("^"+i(r),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())}),n=s&&-1!==n.index(this.active.next())?this.active.nextAll(".ui-menu-item"):n,n.length||(r=String.fromCharCode(t.keyCode),o=new RegExp("^"+i(r),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i=this.options.icons.submenu,n=this.element.find(this.options.menus);n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),n=t.prev("a"),a=e("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);n.attr("aria-haspopup","true").prepend(a),t.attr("aria-labelledby",n.attr("id"))}),t=n.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-—–\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var i,n;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),n=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,n,a,r,s,o;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,a=t.offset().top-this.activeMenu.offset().top-i-n,r=this.activeMenu.scrollTop(),s=this.activeMenu.height(),o=t.height(),0>a?this.activeMenu.scrollTop(r+a):a+o>s&&this.activeMenu.scrollTop(r+a-s+o))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(t),this.activeMenu=n},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;this.active&&(n="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,n)},nextPage:function(t){var i,n,a;return this.active?void(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,a=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n-a<0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var i,n,a;return this.active?void(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,a=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n+a>0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(e),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var i,n,a=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(a.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),a.range&&(a.range===!0&&(a.values||(a.values=[this._valueMin(),this._valueMin()]),a.values.length&&2!==a.values.length&&(a.values=[a.values[0],a.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===a.range||"max"===a.range?" ui-slider-range-"+a.range:""))),n=a.values&&a.values.length||1,i=r.length;n>i;i++)o.push(s);this.handles=r.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){a.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){a.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(i){var n,a,r,s,o=e(i.target).data("ui-slider-handle-index");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass("ui-state-active"),n=this._start(i,o),n===!1))return}switch(s=this.options.step,a=r=this.options.values&&this.options.values.length?this.values(o):this.value(),i.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(a+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(a-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(a===this._valueMax())return;r=this._trimAlignValue(a+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(a===this._valueMin())return;r=this._trimAlignValue(a-s)}this._slide(i,o,r)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,n,a,r,s,o,l,u,c=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),a=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(n-c.values(t));a>i&&(a=i,r=e(this),s=t)}),d.range===!0&&this.values(1)===d.min&&(s+=1,r=e(this.handles[s])),o=this._start(t,s),o===!1?!1:(this._mouseSliding=!0,this._handleIndex=s,r.addClass("ui-state-active").focus(),l=r.offset(),u=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=u?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,a,r;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),a=this._valueMax()-this._valueMin(),r=this._valueMin()+n*a,this._trimAlignValue(r)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,a,r;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&n>i)&&(i=n),i!==this.values(t)&&(a=this.values(),a[t]=i,r=this._trigger("slide",e,{handle:this.handles[t],value:i,values:a}),n=this.values(t?0:1),r!==!1&&this.values(t,i,!0))):i!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:i}),r!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var n,a,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,a=arguments[0],r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(a[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,i){var n,a=0;switch(e.isArray(this.options.values)&&(a=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;a>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,a,r,s=this.options.range,o=this.options,l=this,u=this._animateOff?!1:o.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[u?"animate":"css"](c,o.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[u?"animate":"css"]({left:i+"%"},o.animate),1===n&&l.range[u?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:o.animate})):(0===n&&l.range.stop(1,1)[u?"animate":"css"]({bottom:i+"%"},o.animate),1===n&&l.range[u?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:o.animate}))),t=i}):(n=this.value(),a=this._valueMin(),r=this._valueMax(),i=r!==a?(n-a)/(r-a)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[u?"animate":"css"](c,o.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:i+"%"},o.animate),"max"===s&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:i+"%"},o.animate),"max"===s&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))}})}(e),function(e){function t(t,i){var n=(t.attr("aria-describedby")||"").split(/\s+/);n.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(n.join(" ")))}function i(t){var i=t.data("ui-tooltip-id"),n=(t.attr("aria-describedby")||"").split(/\s+/),a=e.inArray(i,n);-1!==a&&n.splice(a,1),t.removeData("ui-tooltip-id"),n=e.trim(n.join(" ")),n?t.attr("aria-describedby",n):t.removeAttr("aria-describedby")}var n=0;e.widget("ui.tooltip",{version:"1.9.2",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var n=this;return"disabled"===t?(this[i?"_disable":"_enable"](),void(this.options[t]=i)):(this._super(t,i),void("content"===t&&e.each(this.tooltips,function(e,t){n._updateContent(t)})))},_disable:function(){var t=this;e.each(this.tooltips,function(i,n){var a=e.Event("blur");a.target=a.currentTarget=n[0],t.close(a,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,n=e(t?t.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&n.parents().each(function(){var t,n=e(this);n.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._updateContent(n,t))},_updateContent:function(e,t){var i,n=this.options.content,a=this,r=t?t.type:null;return"string"==typeof n?this._open(t,e,n):(i=n.call(e[0],function(i){e.data("ui-tooltip-open")&&a._delay(function(){t&&(t.type=r),this._open(t,e,i)})}),void(i&&this._open(t,e,i)))},_open:function(i,n,a){function r(e){u.of=e,s.is(":hidden")||s.position(u)}var s,o,l,u=e.extend({},this.options.position);if(a){if(s=this._find(n),s.length)return void s.find(".ui-tooltip-content").html(a);n.is("[title]")&&(i&&"mouseover"===i.type?n.attr("title",""):n.removeAttr("title")),s=this._tooltip(n),t(n,s.attr("id")),s.find(".ui-tooltip-content").html(a),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:r}),r(i)):s.position(e.extend({of:n},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(l=setInterval(function(){s.is(":visible")&&(r(u.of),clearInterval(l))},e.fx.interval)),this._trigger("open",i,{tooltip:s}),o={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=n[0],this.close(i,!0)}},remove:function(){this._removeTooltip(s)}},i&&"mouseover"!==i.type||(o.mouseleave="close"),i&&"focusin"!==i.type||(o.focusout="close"),this._on(!0,n,o)
}},close:function(t){var n=this,a=e(t?t.currentTarget:this.element),r=this._find(a);this.closing||(a.data("ui-tooltip-title")&&a.attr("title",a.data("ui-tooltip-title")),i(a),r.stop(!0),this._hide(r,this.options.hide,function(){n._removeTooltip(e(this))}),a.removeData("ui-tooltip-open"),this._off(a,"mouseleave focusout keyup"),a[0]!==this.element[0]&&this._off(a,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete n.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:r}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+n++,a=e("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(a),a.appendTo(this.document[0].body),e.fn.bgiframe&&a.bgiframe(),this.tooltips[i]=t,a},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,n){var a=e.Event("blur");a.target=a.currentTarget=n[0],t.close(a,!0),e("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))})}})}(e)}),define("libraries/jquery/plugins/jquery.base64-modified",["jquery"],function(e){e.base64=function(){function e(e,t){var i=r.indexOf(e.charAt(t));if(-1===i)throw"Cannot decode base64";return i}function t(t){var i,n,r=0,s=t.length,o=[];if(t=String(t),0===s)return t;if(s%4!==0)throw"Cannot decode base64";for(t.charAt(s-1)===a&&(r=1,t.charAt(s-2)===a&&(r=2),s-=4),i=0;s>i;i+=4)n=e(t,i)<<18|e(t,i+1)<<12|e(t,i+2)<<6|e(t,i+3),o.push(String.fromCharCode(n>>16,n>>8&255,255&n));switch(r){case 1:n=e(t,i)<<18|e(t,i+1)<<12|e(t,i+2)<<6,o.push(String.fromCharCode(n>>16,n>>8&255));break;case 2:n=e(t,i)<<18|e(t,i+1)<<12,o.push(String.fromCharCode(n>>16))}return o.join("")}function i(e,t){var i=e.charCodeAt(t);if(i>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return i}function n(e){if(1!==arguments.length)throw"SyntaxError: exactly one argument required";e=String(e);var t,n,s=[],o=e.length-e.length%3;if(0===e.length)return e;for(t=0;o>t;t+=3)n=i(e,t)<<16|i(e,t+1)<<8|i(e,t+2),s.push(r.charAt(n>>18)),s.push(r.charAt(n>>12&63)),s.push(r.charAt(n>>6&63)),s.push(r.charAt(63&n));switch(e.length-o){case 1:n=i(e,t)<<16,s.push(r.charAt(n>>18)+r.charAt(n>>12&63)+a+a);break;case 2:n=i(e,t)<<16|i(e,t+1)<<8,s.push(r.charAt(n>>18)+r.charAt(n>>12&63)+r.charAt(n>>6&63)+a)}return s.join("")}var a="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="1.0";return{decode:t,encode:n,VERSION:s}}(e)}),define("normalize",["require","module"],function(){function e(e,i,a){if(0===e.indexOf("data:"))return e;if(e=r(e),e.match(/^\//)||e.match(s))return e;var o=a.match(s),l=i.match(s);return!l||o&&o[1]==l[1]&&o[2]==l[2]?n(t(e,i),a):t(e,i)}function t(e,t){"./"==e.substr(0,2)&&(e=e.substr(2));var i=t.split("/"),n=e.split("/");for(i.pop();curPart=n.shift();)".."==curPart?i.pop():i.push(curPart);return i.join("/")}function n(e,t){var n=t.split("/");for(n.pop(),t=n.join("/")+"/",i=0;t.substr(i,1)==e.substr(i,1);)i++;for(;"/"!=t.substr(i,1);)i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var a=e.split("/");for(out="";n.shift();)out+="../";for(;curPart=a.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var a=/([^:])\/+/g,r=function(e){return e.replace(a,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,o=function(t,i,n,a){i=r(i),n=r(n);for(var s,o,t,l=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;s=l.exec(t);){o=s[3]||s[2]||s[5]||s[6]||s[4];var u;u=a&&"/"==o.substr(0,1)?a+o:e(o,i,n);var c=s[5]||s[6]?1:0;t=t.substr(0,l.lastIndex-o.length-c-1)+u+t.substr(l.lastIndex-c-1),l.lastIndex=l.lastIndex+(u.length-o.length)}return t};return o.convertURIBase=e,o}),define("css",["./normalize"],function(e){function t(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1}if("undefined"==typeof window)return{load:function(e,t,i){i()}};var i=!1,n=document.getElementsByTagName("head")[0],a=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),r=!1;a&&(a[1]||a[7]?(r=parseInt(a[1])<6||parseInt(a[7])<=9,a="trident"):a[2]?(r=!0,a="webkit"):a[3]||(a[4]?(r=parseInt(a[4])<18,a="gecko"):i&&alert("Engine detection failed")));var s={},o=/^\/|([^\:\/]*:)/;s.pluginBuilder="./css-builder";var l=[],u={},c=[];s.addBuffer=function(e){-1==t(l,e)&&-1==t(c,e)&&(l.push(e),c.push(e))},s.setBuffer=function(t,i){var n=window.location.pathname.split("/");n.pop(),n=n.join("/")+"/";var a=require.toUrl("base_url").split("/");a.pop();var r=a.join("/")+"/";r=e.convertURIBase(r,n,"/"),r.match(o)||(r="/"+r),"/"!=r.substr(r.length-1,1)&&(r+="/"),s.inject(e(t,r,n));for(var c=0;c<l.length;c++)(i&&".less"==l[c].substr(l[c].length-5,5)||!i&&".css"==l[c].substr(l[c].length-4,4))&&(!function(e){u[e]=u[e]||!0,setTimeout(function(){"function"==typeof u[e]&&u[e](),delete u[e]},7)}(l[c]),l.splice(c--,1))},s.attachBuffer=function(e,i){for(var n=0;n<l.length;n++)if(l[n]==e)return u[e]=i,!0;return u[e]===!0?(u[e]=i,!0):-1!=t(c,e)?(i(),!0):void 0};var d=function(e,t){setTimeout(function(){for(var i=0;i<document.styleSheets.length;i++){var n=document.styleSheets[i];if(n.href==e.href)return t()}d(e,t)},10)},h=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(i){}h(e,t)},10)};if("trident"==a&&r)var p=[],f=[],m=0,g=function(e,t){var i;f.push({url:e,cb:t}),i=p.shift(),!i&&m++<31&&(i=document.createElement("style"),n.appendChild(i)),i&&v(i)},v=function(e){var t=f.shift();if(!t)return e.onload=b,void p.push(e);e.onload=function(){t.cb(t.ss),v(e)};try{var i=e.styleSheet;t.ss=i.imports[i.addImport(t.url)]}catch(n){alert("Got Error:"+n)}};var y=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},b=function(){};s.linkLoad=function(e,t){var s=setTimeout(function(){i&&alert("timeout"),t()},1e3*C-100),o=function(){clearTimeout(s),l&&(l.onload=b),setTimeout(t,7)};if(r)if("webkit"==a){var l=y(e);d(l,o),n.appendChild(l)}else if("gecko"==a){var u=document.createElement("style");u.textContent='@import "'+e+'"',h(u,o),n.appendChild(u)}else"trident"==a&&g(e,o);else{var l=y(e);l.onload=o,n.appendChild(l)}};var k,_=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],w={},L=function(e,t,i){if(w[e])return void t(w[e]);var n,a,r;if("undefined"!=typeof XMLHttpRequest)n=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(a=0;3>a;a+=1){r=_[a];try{n=new ActiveXObject(r)}catch(s){}if(n){_=[r];break}}n.open("GET",e,requirejs.inlineRequire?!1:!0),n.onreadystatechange=function(){var a,r;4===n.readyState&&(a=n.status,a>399&&600>a?(r=new Error(e+" HTTP status: "+a),r.xhr=n,i(r)):(w[e]=n.responseText,t(n.responseText)))},n.send(null)},x=0;s.inject=function(e){31>x&&(k=document.createElement("style"),k.type="text/css",n.appendChild(k),x++),k.styleSheet?k.styleSheet.cssText+=e:k.appendChild(document.createTextNode(e))};var S=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,O=window.location.pathname.split("/");O.pop(),O=O.join("/")+"/";var T=function(t,i,n){t.match(o)||(t="/"+e.convertURIBase(t,O,"/")),L(t,function(a){a=e(a,t,O);for(var r,s=[],o=[],l=[];r=S.exec(a);){var u=r[4]||r[5]||r[7]||r[8]||r[9];s.push(u),o.push(S.lastIndex-r[0].length),l.push(r[0].length)}for(var c=0,d=0;d<s.length;d++)(function(e){T(s[e],function(t){a=a.substr(0,o[e])+t+a.substr(o[e]+l[e]);for(var n=t.length-l[e],r=e+1;r<s.length;r++)o[r]+=n;c++,c==s.length&&i(a)},n)})(d);0==s.length&&i(a)},n)};s.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)};var C,M=!1;return s.load=function(e,t,n,a,o){C=C||a.waitSeconds||7;var l=e+(o?".less":".css");if(!s.attachBuffer(l,n)){var u=t.toUrl(l);!M&&i&&(alert(r?"hacking links":"not hacking"),M=!0),o?T(u,function(e){o&&(e=o(e,function(e){s.inject(e),setTimeout(n,7)}))}):s.linkLoad(u,n)}},i&&(s.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0}),s}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/oskariui/css/jquery-ui-1.9.2.custom.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/oskariui/bootstrap-grid.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.framework.bundle.oskariui.DomManager",function(e,t){this.$=e,this.partsMap=t||{},this.layout=null,this.layouts=[]},{getEl:function(e){return this.$(e)},getElForPart:function(e){return this.$(this.partsMap[e])},setElForPart:function(e,t){this.partsMap[e]=this.$(t)},setElParts:function(e){this.partsMap=e},getElParts:function(){return this.partsMap},pushLayout:function(e){this.layout&&this.layout.removeLayout(this),this.layout=e,this.layouts.push(e),e.applyLayout(this)},popLayout:function(){var e=this.layouts.pop();return e&&e.removeLayout(this),0===this.layouts.length?void(this.layout=null):(e=this.layouts[this.layouts.length-1],this.layout=e,void e.applyLayout(this))},getLayout:function(){return this.layout}},{protocol:["Oskari.dom.DomManager"]}),define("bundles/framework/bundle/oskariui/DomManager",function(){}),Oskari.clazz.define("Oskari.framework.bundle.oskariui.Layout",function(){},{applyLayout:function(){},removeLayout:function(){}},{protocol:["Oskari.dom.Layout"]}),define("bundles/framework/bundle/oskariui/Layout",function(){}),define("src/framework/oskariui/module",["src/oskari/oskari","jquery","libraries/jquery/jquery-ui-1.9.2.custom-modified","libraries/jquery/plugins/jquery.base64-modified","css!resources/framework/bundle/oskariui/css/jquery-ui-1.9.2.custom","css!resources/framework/bundle/oskariui/bootstrap-grid","bundles/framework/bundle/oskariui/DomManager","bundles/framework/bundle/oskariui/Layout"],function(e,t){return e.bundleCls("oskariui").category({create:function(){return this},update:function(){},start:function(){var i=this.conf.partsMap||{},n=e.clazz.create("Oskari.framework.bundle.oskariui.DomManager",t,i);e.setDomManager(n)},stop:function(){}})}),define("oskari-with-app",["lodash","src/oskari/oskari","src/oskari/base/module","src/framework/oskariui/module"],function(e,t){t.VERSION="2.1.0";var i=(t.clazz,t.cls(void 0,function(){this.instances={},this.startupSeq=[],this.config=t.appConfig}).methods({setConfiguration:function(e){return t.setConfiguration(e),this},setStartupSequence:function(e){return this.startupSeq=e,this},success:function(e){return this.result?e(this.result):this.successFunc=e,this},_startApplication:function(e){var t=this,i=t.startupSeq,n=(i.length,function(e,i){if(0===e.length)return i&&i(),t;var a=e.shift(),r=a.bundlename,s=null,o=a.bundleinstancename;require([r],function(a){s=a.start(o),name=s.getName(),t.instances[name]=s,n(e,i)})});n(i,e)},start:function(){{var e=this;t.app}return e._startApplication(function(t){e.successFunc?e.successFunc(e):e.result=t}),this},stopApplication:function(){return this},getModuleInstances:function(){return this.instances}}));t.Application=i;var n=0,a=t.cls("Oskari.Module",function(){console.log("CREATED CONFIGURABLE MODULE as BASE for MODULES")},{extend:function(e){var i=t.bundleCls(e.identifier);return i.category(e),i.category({create:function(){console.log("CREATING MODULE INSTANCE ",this.extension,this.identifier,this.locale,this.configuration);var e=this.extension.create(this.identifier||"_"+ ++n,this.locale),t=this.configuration||{};for(ip in t)t.hasOwnProperty(ip)&&(e.conf[ip]=t[ip]);return console.log("- INSTANCE",e,"post conf"),e}}),console.log("DECLARED MODULE CLASS",i),i}});t.Module=a.create();var r=t.cls("Oskari.Event",function(){console.log("CREATED EXTENDABLE EVENT as BASE for EVENTS")},{extend:function(e){return t.cls(e.name?"Oskari.event._."+e.name:void 0,function(e){for(ip in e)e.hasOwnProperty(ip)&&(this[ip]=e[ip])},{getName:function(){return this.name}},{protocol:["Oskari.mapframework.event.Event"]}).category(e)}});t.Event=r.create();var s=t.cls("Oskari.Request",function(){console.log("CREATED EXTENDABLE REQUEST as BASE for REQUESTS")},{extend:function(e){return t.cls(e.name?"Oskari.request._."+e.name:void 0,function(e){for(ip in e)e.hasOwnProperty(ip)&&(this[ip]=e[ip])},{getName:function(){return this.name}},{protocol:["Oskari.mapframework.request.Request"]}).category(e)}});return t.Request=s.create(),t.Object=t.cls("Oskari.Object",function(e){for(ip in e)e.hasOwnProperty(ip)&&(this[ip]=e[ip])}),t}),Proj4js={defaultDatum:"WGS84",transform:function(e,t,i){if(!e.readyToUse||!t.readyToUse)return this.reportError("Proj4js initialization for "+e.srsCode+" not yet complete"),i;if("900913"==e.srsProjNumber&&"WGS84"!=t.datumCode||"900913"==t.srsProjNumber&&"WGS84"!=e.datumCode){var n=Proj4js.WGS84;this.transform(e,n,i),e=n}return"longlat"==e.projName?(i.x*=Proj4js.common.D2R,i.y*=Proj4js.common.D2R):(e.to_meter&&(i.x*=e.to_meter,i.y*=e.to_meter),e.inverse(i)),e.from_greenwich&&(i.x+=e.from_greenwich),i=this.datum_transform(e.datum,t.datum,i),t.from_greenwich&&(i.x-=t.from_greenwich),"longlat"==t.projName?(i.x*=Proj4js.common.R2D,i.y*=Proj4js.common.R2D):(t.forward(i),t.to_meter&&(i.x/=t.to_meter,i.y/=t.to_meter)),i},datum_transform:function(e,t,i){return e.compare_datums(t)?i:e.datum_type==Proj4js.common.PJD_NODATUM||t.datum_type==Proj4js.common.PJD_NODATUM?i:(e.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),t.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),(e.es!=t.es||e.a!=t.a||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM||t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&(e.geodetic_to_geocentric(i),(e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM)&&e.geocentric_to_wgs84(i),(t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&t.geocentric_from_wgs84(i),t.geocentric_to_geodetic(i)),t.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),i)},reportError:function(){},extend:function(e,t){if(e=e||{},t)for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}return e},Class:function(){for(var e,t=function(){this.initialize.apply(this,arguments)},i={},n=0;n<arguments.length;++n)e="function"==typeof arguments[n]?arguments[n].prototype:arguments[n],Proj4js.extend(i,e);return t.prototype=i,t},bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},scriptName:"proj4js-compressed.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var e=this.scriptName,t=e.length,i=document.getElementsByTagName("script"),n=0;n<i.length;n++){var a=i[n].getAttribute("src");if(a){var r=a.lastIndexOf(e);if(r>-1&&r+t==a.length){this.libPath=a.slice(0,-t);break}}}return this.libPath||""},loadScript:function(e,t,i,n){var a=document.createElement("script");a.defer=!1,a.type="text/javascript",a.id=e,a.src=e,a.onload=t,a.onerror=i,a.loadCheck=n,/MSIE/.test(navigator.userAgent)&&(a.onreadystatechange=this.checkReadyState),document.getElementsByTagName("head")[0].appendChild(a)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}},Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,initialize:function(e){if(this.srsCodeInput=e,0==e.indexOf("urn:")){var t=e.split(":");"ogc"!=t[1]&&"x-ogc"!=t[1]||"def"!=t[2]||"crs"!=t[3]||(e=t[4]+":"+t[t.length-1])}else if(0==e.indexOf("http://")){var i=e.split("#");i[0].match(/epsg.org/)?e="EPSG:"+i[1]:i[0].match(/RIG.xml/)&&(e="IGNF:"+i[1])}this.srsCode=e.toUpperCase(),0==this.srsCode.indexOf("EPSG")?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("IGNF")?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("CRS")?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode),this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])return void this.defsLoaded();var e=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var e=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs(),this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode),Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84,this.defsLoaded()},loadProjCode:function(e){if(Proj4js.Proj[e])return void this.initTransforms();var t=Proj4js.getScriptLocation()+"projCode/"+e+".js";Proj4js.loadScript(t,Proj4js.bind(this.loadProjCodeSuccess,this,e),Proj4js.bind(this.loadProjCodeFailure,this,e),Proj4js.bind(this.checkCodeLoaded,this,e))},loadProjCodeSuccess:function(e){Proj4js.Proj[e].dependsOn?this.loadProjCode(Proj4js.Proj[e].dependsOn):this.initTransforms()},loadProjCodeFailure:function(e){Proj4js.reportError("failed to find projection file for: "+e)},checkCodeLoaded:function(e){return Proj4js.Proj[e]?!0:!1},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]),this.init(),this.readyToUse=!0},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,t;if(this.defData){for(var i=this.defData.split("+"),n=0;n<i.length;n++){var a=i[n].split("=");switch(e=a[0].toLowerCase(),t=a[1],e.replace(/\s/gi,"")){case"":break;case"title":this.title=t;break;case"proj":this.projName=t.replace(/\s/gi,"");break;case"units":this.units=t.replace(/\s/gi,"");break;case"datum":this.datumCode=t.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=t.replace(/\s/gi,"");break;case"ellps":this.ellps=t.replace(/\s/gi,"");break;case"a":this.a=parseFloat(t);break;case"b":this.b=parseFloat(t);break;case"rf":this.rf=parseFloat(t);break;case"lat_0":this.lat0=t*Proj4js.common.D2R;break;case"lat_1":this.lat1=t*Proj4js.common.D2R;break;case"lat_2":this.lat2=t*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=t*Proj4js.common.D2R;break;case"lon_0":this.long0=t*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(t)*Proj4js.common.D2R;break;case"lonc":this.longc=t*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(t);break;case"y_0":this.y0=parseFloat(t);break;case"k_0":this.k0=parseFloat(t);break;case"k":this.k0=parseFloat(t);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(t);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=t.split(",");break;case"to_meter":this.to_meter=parseFloat(t);break;case"from_greenwich":this.from_greenwich=t*Proj4js.common.D2R;break;case"pm":t=t.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[t]?Proj4js.PrimeMeridian[t]:parseFloat(t),this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":}}this.deriveConstants()}},deriveConstants:function(){if("@null"==this.nagrids&&(this.datumCode="none"),this.datumCode&&"none"!=this.datumCode){var e=Proj4js.Datum[this.datumCode];e&&(this.datum_params=e.towgs84?e.towgs84.split(","):null,this.ellps=e.ellipse,this.datumName=e.datumName?e.datumName:this.datumCode)}if(!this.a){var t=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,t)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0,this.b=this.a),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.datum=new Proj4js.datum(this)}}),Proj4js.Proj.longlat={init:function(){},forward:function(e){return e},inverse:function(e){return e}},Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"],Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(e,t,i){var n=e*t;return i/Math.sqrt(1-n*n)},tsfnz:function(e,t,i){var n=e*i,a=.5*e;return n=Math.pow((1-n)/(1+n),a),Math.tan(.5*(this.HALF_PI-t))/n},phi2z:function(e,t){var n,a,r=.5*e,s=this.HALF_PI-2*Math.atan(t);for(i=0;15>=i;i++)if(n=e*Math.sin(s),a=this.HALF_PI-2*Math.atan(t*Math.pow((1-n)/(1+n),r))-s,s+=a,Math.abs(a)<=1e-10)return s;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t},asinz:function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},e0fn:function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},e1fn:function(e){return.375*e*(1+.25*e*(1+.46875*e))},e2fn:function(e){return.05859375*e*e*(1+.75*e)},e3fn:function(e){return e*e*e*(35/3072)},mlfn:function(e,t,i,n,a){return e*a-t*Math.sin(2*a)+i*Math.sin(4*a)-n*Math.sin(6*a)},srat:function(e,t){return Math.pow((1-e)/(1+e),t)},sign:function(e){return 0>e?-1:1},adjust_lon:function(e){return e=Math.abs(e)<this.PI?e:e-this.sign(e)*this.TWO_PI},adjust_lat:function(e){return e=Math.abs(e)<this.HALF_PI?e:e-this.sign(e)*this.PI},latiso:function(e,t,i){if(Math.abs(t)>this.HALF_PI)return+Number.NaN;if(t==this.HALF_PI)return Number.POSITIVE_INFINITY;if(t==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var n=e*i;return Math.log(Math.tan((this.HALF_PI+t)/2))+e*Math.log((1-n)/(1+n))/2},fL:function(e,t){return 2*Math.atan(e*Math.exp(t))-this.HALF_PI},invlatiso:function(e,t){var i=this.fL(1,t),n=0,a=0;do n=i,a=e*Math.sin(n),i=this.fL(Math.exp(e*Math.log((1+a)/(1-a))/2),t);while(Math.abs(i-n)>1e-12);return i},sinh:function(e){var t=Math.exp(e);return t=(t-1/t)/2},cosh:function(e){var t=Math.exp(e);return t=(t+1/t)/2},tanh:function(e){var t=Math.exp(e);return t=(t-1/t)/(t+1/t)},asinh:function(e){var t=e>=0?1:-1;return t*Math.log(Math.abs(e)+Math.sqrt(e*e+1))},acosh:function(e){return 2*Math.log(Math.sqrt((e+1)/2)+Math.sqrt((e-1)/2))},atanh:function(e){return Math.log((e-1)/(e+1))/2},gN:function(e,t,i){var n=t*i;return e/Math.sqrt(1-n*n)}},Proj4js.datum=Proj4js.Class({initialize:function(e){if(this.datum_type=Proj4js.common.PJD_WGS84,e.datumCode&&"none"==e.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM),e&&e.datum_params){for(var t=0;t<e.datum_params.length;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);(0!=e.datum_params[0]||0!=e.datum_params[1]||0!=e.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM),e.datum_params.length>3&&(0!=e.datum_params[3]||0!=e.datum_params[4]||0!=e.datum_params[5]||0!=e.datum_params[6])&&(this.datum_type=Proj4js.common.PJD_7PARAM,e.datum_params[3]*=Proj4js.common.SEC_TO_RAD,e.datum_params[4]*=Proj4js.common.SEC_TO_RAD,e.datum_params[5]*=Proj4js.common.SEC_TO_RAD,e.datum_params[6]=e.datum_params[6]/1e6+1)}e&&(this.a=e.a,this.b=e.b,this.es=e.es,this.ep2=e.ep2,this.datum_params=e.datum_params)},compare_datums:function(e){return this.datum_type!=e.datum_type?!1:this.a!=e.a||Math.abs(this.es-e.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]&&this.datum_params[3]==e.datum_params[3]&&this.datum_params[4]==e.datum_params[4]&&this.datum_params[5]==e.datum_params[5]&&this.datum_params[6]==e.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?0==strcmp(pj_param(this.params,"snadgrids").s,pj_param(e.params,"snadgrids").s):!0},geodetic_to_geocentric:function(e){var t,i,n,a,r,s,o,l=e.x,u=e.y,c=e.z?e.z:0,d=0;if(u<-Proj4js.common.HALF_PI&&u>-1.001*Proj4js.common.HALF_PI)u=-Proj4js.common.HALF_PI;else if(u>Proj4js.common.HALF_PI&&u<1.001*Proj4js.common.HALF_PI)u=Proj4js.common.HALF_PI;else if(u<-Proj4js.common.HALF_PI||u>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+u),null;return l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI),r=Math.sin(u),o=Math.cos(u),s=r*r,a=this.a/Math.sqrt(1-this.es*s),t=(a+c)*o*Math.cos(l),i=(a+c)*o*Math.sin(l),n=(a*(1-this.es)+c)*r,e.x=t,e.y=i,e.z=n,d},geocentric_to_geodetic:function(e){var t,i,n,a,r,s,o,l,u,c,d,h,p,f,m,g,v,y=1e-12,b=y*y,k=30,_=e.x,w=e.y,L=e.z?e.z:0;if(p=!1,t=Math.sqrt(_*_+w*w),i=Math.sqrt(_*_+w*w+L*L),t/this.a<y){if(p=!0,m=0,i/this.a<y)return g=Proj4js.common.HALF_PI,void(v=-this.b)}else m=Math.atan2(w,_);n=L/i,a=t/i,r=1/Math.sqrt(1-this.es*(2-this.es)*a*a),l=a*(1-this.es)*r,u=n*r,f=0;do f++,o=this.a/Math.sqrt(1-this.es*u*u),v=t*l+L*u-o*(1-this.es*u*u),s=this.es*o/(o+v),r=1/Math.sqrt(1-s*(2-s)*a*a),c=a*(1-s)*r,d=n*r,h=d*l-c*u,l=c,u=d;while(h*h>b&&k>f);return g=Math.atan(d/Math.abs(c)),e.x=m,e.y=g,e.z=v,e},geocentric_to_geodetic_noniter:function(e){var t,i,n,a,r,s,o,l,u,c,d,h,p,f,m,g,v,y=e.x,b=e.y,k=e.z?e.z:0;if(y=parseFloat(y),b=parseFloat(b),k=parseFloat(k),v=!1,0!=y)t=Math.atan2(b,y);else if(b>0)t=Proj4js.common.HALF_PI;else if(0>b)t=-Proj4js.common.HALF_PI;else if(v=!0,t=0,k>0)i=Proj4js.common.HALF_PI;else{if(!(0>k))return i=Proj4js.common.HALF_PI,void(n=-this.b);i=-Proj4js.common.HALF_PI}return r=y*y+b*b,a=Math.sqrt(r),s=k*Proj4js.common.AD_C,l=Math.sqrt(s*s+r),c=s/l,h=a/l,d=c*c*c,o=k+this.b*this.ep2*d,g=a-this.a*this.es*h*h*h,u=Math.sqrt(o*o+g*g),p=o/u,f=g/u,m=this.a/Math.sqrt(1-this.es*p*p),n=f>=Proj4js.common.COS_67P5?a/f-m:f<=-Proj4js.common.COS_67P5?a/-f-m:k/p+m*(this.es-1),0==v&&(i=Math.atan(p/f)),e.x=t,e.y=i,e.z=n,e},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM)e.x+=this.datum_params[0],e.y+=this.datum_params[1],e.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],i=this.datum_params[1],n=this.datum_params[2],a=this.datum_params[3],r=this.datum_params[4],s=this.datum_params[5],o=this.datum_params[6],l=o*(e.x-s*e.y+r*e.z)+t,u=o*(s*e.x+e.y-a*e.z)+i,c=o*(-r*e.x+a*e.y+e.z)+n;e.x=l,e.y=u,e.z=c}},geocentric_from_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM)e.x-=this.datum_params[0],e.y-=this.datum_params[1],e.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],i=this.datum_params[1],n=this.datum_params[2],a=this.datum_params[3],r=this.datum_params[4],s=this.datum_params[5],o=this.datum_params[6],l=(e.x-t)/o,u=(e.y-i)/o,c=(e.z-n)/o;e.x=l+s*u-r*c,e.y=-s*l+u+a*c,e.z=r*l-a*u+c}}}),Proj4js.Point=Proj4js.Class({initialize:function(e,t,i){if("object"==typeof e)this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("string"==typeof e){var n=e.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=e,this.y=t,this.z=i||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.Proj.aea={init:function(){return Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN?void Proj4js.reportError("aeaInitEqualLatitudes"):(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,void(this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0))
},forward:function(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),a=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*Proj4js.common.adjust_lon(t-this.long0),s=a*Math.sin(r)+this.x0,o=this.rh-a*Math.cos(r)+this.y0;return e.x=s,e.y=o,e},inverse:function(e){var t,i,n,a,r,s;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),a=0,0!=t&&(a=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,i=(this.c-n*n)/this.ns0,this.e3>=1e-10?(n=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,s=Math.abs(Math.abs(n)-Math.abs(i))>1e-10?this.phi1z(this.e3,i):i>=0?.5*PI:-.5*PI):s=this.phi1z(e3,i),r=Proj4js.common.adjust_lon(a/this.ns0+this.long0),e.x=r,e.y=s,e},phi1z:function(e,t){var i,n,a,r=Proj4js.common.asinz(.5*t);if(e<Proj4js.common.EPSLN)return r;for(var s=e*e,o=1;25>=o;o++)if(sinphi=Math.sin(r),cosphi=Math.cos(r),i=e*sinphi,n=1-i*i,a=.5*n*n/cosphi*(t/(1-s)-sinphi/n+.5/e*Math.log((1-i)/(1+i))),r+=a,Math.abs(a)<=1e-7)return r;return Proj4js.reportError("aea:phi1z:Convergence error"),null}},Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){return Proj4js.Proj.gauss.init.apply(this),this.rc?(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,void(this.title||(this.title="Oblique Stereographic Alternative"))):void Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(e){return e.x=Proj4js.common.adjust_lon(e.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[e]),sinc=Math.sin(e.y),cosc=Math.cos(e.y),cosl=Math.cos(e.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),e.x=k*cosc*Math.sin(e.x),e.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,i;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(rho=Math.sqrt(e.x*e.x+e.y*e.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),i=Math.asin(cosc*this.sinc0+e.y*sinc*this.cosc0/rho),t=Math.atan2(e.x*sinc,rho*this.cosc0*cosc-e.y*this.sinc0*sinc)):(i=this.phic0,t=0),e.x=t,e.y=i,Proj4js.Proj.gauss.inverse.apply(this,[e]),e.x=Proj4js.common.adjust_lon(e.x+this.long0),e}},Proj4js.Proj.poly={init:function(){(this.lat0=0)&&(this.lat0=90),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,n,a,r,s,o,l=e.x,u=e.y;return n=Proj4js.common.adjust_lon(l-this.long0),Math.abs(u)<=1e-7?(s=this.x0+this.a*n,o=this.y0-this.a*this.ml0):(t=Math.sin(u),i=Math.cos(u),a=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,u),r=Proj4js.common.msfnz(this.e,t,i),n=t,s=this.x0+this.a*r*Math.sin(n)/t,o=this.y0+this.a*(a-this.ml0+r*(1-Math.cos(n))/t)),e.x=s,e.y=o,e},inverse:function(e){var t,i,n,a,r,s;if(e.x-=this.x0,e.y-=this.y0,t=this.ml0+e.y/this.a,a=0,Math.abs(t)<=1e-7)r=e.x/this.a+this.long0,s=0;else{if(i=t*t+e.x/this.a*(e.x/this.a),a=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,i,n,s),1!=a)return a;r=Proj4js.common.adjust_lon(Proj4js.common.asinz(e.x*n/this.a)/Math.sin(s)+this.long0)}return e.x=r,e.y=s,e}},Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0)},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),a=this.x0+this.a*n*Math.cos(this.lat0),r=this.y0+this.a*i;return this.t1=a,this.t2=Math.cos(this.lat0),e.x=a,e.y=r,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.y/this.a;Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var i=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=i,e.y=t}},Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t=e.x,i=e.y;if(i*Proj4js.common.R2D>90&&i*Proj4js.common.R2D<-90&&t*Proj4js.common.R2D>180&&t*Proj4js.common.R2D<-180)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+t+" : "+i),null;var n,a;if(Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js.reportError("merc:forward: ll2mAtPoles"),null;if(this.sphere)n=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0),a=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*i));else{var r=Math.sin(i),s=Proj4js.common.tsfnz(this.e,i,r);n=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0),a=this.y0-this.a*this.k0*Math.log(s)}return e.x=n,e.y=a,e},inverse:function(e){var t,i,n=e.x-this.x0,a=e.y-this.y0;if(this.sphere)i=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-a/this.a*this.k0));else{var r=Math.exp(-a/(this.a*this.k0));if(i=Proj4js.common.phi2z(this.e,r),-9999==i)return Proj4js.reportError("merc:inverse: lat = -9999"),null}return t=Proj4js.common.adjust_lon(this.long0+n/(this.a*this.k0)),e.x=t,e.y=i,e}},Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){return this.zone?(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,void(this.inverse=Proj4js.Proj.tmerc.inverse)):void Proj4js.reportError("utm:init: zone must be specified for UTM")}},Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),0!=this.mode?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi,this.g=this.ml1+this.ms1/this.ns,this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,i),a=this.a*(this.g-n),r=this.ns*Proj4js.common.adjust_lon(t-this.long0),s=this.x0+a*Math.sin(r),o=this.y0+this.rh-a*Math.cos(r);return e.x=s,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i;if(this.ns>=0)var i=Math.sqrt(e.x*e.x+e.y*e.y),t=1;else i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1;var n=0;0!=i&&(n=Math.atan2(t*e.x,t*e.y));var a=(this.g-i/this.a,this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3)),r=Proj4js.common.adjust_lon(this.long0+n/this.ns);return e.x=r,e.y=a,e},phi3z:function(e,t,i,n,a){var r,s;r=e;for(var o=0;15>o;o++)if(s=(e+i*Math.sin(2*r)-n*Math.sin(4*r)+a*Math.sin(6*r))/t-r,r+=s,Math.abs(s)<=1e-10)return r;return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,n,a=e.x,r=e.y,s=Proj4js.common.adjust_lon(a-this.long0),o=Math.sin(r),l=Math.cos(r);if(this.sphere){var u=l*Math.sin(s);if(Math.abs(Math.abs(u)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;i=.5*this.a*this.k0*Math.log((1+u)/(1-u)),t=Math.acos(l*Math.cos(s)/Math.sqrt(1-u*u)),0>r&&(t=-t),n=this.a*this.k0*(t-this.lat0)}else{var c=l*s,d=Math.pow(c,2),h=this.ep2*Math.pow(l,2),p=Math.tan(r),f=Math.pow(p,2);t=1-this.es*Math.pow(o,2);var m=this.a/Math.sqrt(t),g=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,r);i=this.k0*m*c*(1+d/6*(1-f+h+d/20*(5-18*f+Math.pow(f,2)+72*h-58*this.ep2)))+this.x0,n=this.k0*(g-this.ml0+m*p*d*(.5+d/24*(5-f+9*h+4*Math.pow(h,2)+d/30*(61-58*f+Math.pow(f,2)+600*h-330*this.ep2))))+this.y0}return e.x=i,e.y=n,e},inverse:function(e){var t,i,n,a,r,s,o=6;if(this.sphere){var l=Math.exp(e.x/(this.a*this.k0)),u=.5*(l-1/l),c=this.lat0+e.y/(this.a*this.k0),d=Math.cos(c);t=Math.sqrt((1-d*d)/(1+u*u)),r=Proj4js.common.asinz(t),0>c&&(r=-r),s=0==u&&0==d?this.long0:Proj4js.common.adjust_lon(Math.atan2(u,d)+this.long0)}else{var h=e.x-this.x0,p=e.y-this.y0;for(t=(this.ml0+p/this.k0)/this.a,i=t,a=0;!0&&(n=(t+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=n,!(Math.abs(n)<=Proj4js.common.EPSLN));a++)if(a>=o)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95;if(Math.abs(i)<Proj4js.common.HALF_PI){var f=Math.sin(i),m=Math.cos(i),g=Math.tan(i),v=this.ep2*Math.pow(m,2),y=Math.pow(v,2),b=Math.pow(g,2),k=Math.pow(b,2);t=1-this.es*Math.pow(f,2);var _=this.a/Math.sqrt(t),w=_*(1-this.es)/t,L=h/(_*this.k0),x=Math.pow(L,2);r=i-_*g*x/w*(.5-x/24*(5+3*b+10*v-4*y-9*this.ep2-x/30*(61+90*b+298*v+45*k-252*this.ep2-3*y))),s=Proj4js.common.adjust_lon(this.long0+L*(1-x/6*(1+2*b+v-x/20*(5-2*v+28*b-3*y+8*this.ep2+24*k)))/m)}else r=Proj4js.common.HALF_PI*Proj4js.common.sign(p),s=this.long0}return e.x=s,e.y=r,e}},Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE,Proj4js.Proj.gstmerc={init:function(){var e=this.b/this.a;this.e=Math.sqrt(1-e*e),this.lc=this.long0,this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var t=Math.sin(this.lat0),i=Math.asin(t/this.rs),n=Math.sin(i);this.cp=Proj4js.common.latiso(0,i,n)-this.rs*Proj4js.common.latiso(this.e,this.lat0,t),this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*t*t),this.xs=this.x0,this.ys=this.y0-this.n2*i,this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(e){var t=e.x,i=e.y,n=this.rs*(t-this.lc),a=this.cp+this.rs*Proj4js.common.latiso(this.e,i,Math.sin(i)),r=Math.asin(Math.sin(n)/Proj4js.common.cosh(a)),s=Proj4js.common.latiso(0,r,Math.sin(r));return e.x=this.xs+this.n2*s,e.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(a)/Math.cos(n)),e},inverse:function(e){var t=e.x,i=e.y,n=Math.atan(Proj4js.common.sinh((t-this.xs)/this.n2)/Math.cos((i-this.ys)/this.n2)),a=Math.asin(Math.sin((i-this.ys)/this.n2)/Proj4js.common.cosh((t-this.xs)/this.n2)),r=Proj4js.common.latiso(0,a,Math.sin(a));return e.x=this.lc+n/this.rs,e.y=Proj4js.common.invlatiso(this.e,(r-this.cp)/this.rs),e}},Proj4js.Proj.ortho={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,i,n,a,r,s,o=e.x,l=e.y;if(n=Proj4js.common.adjust_lon(o-this.long0),t=Math.sin(l),i=Math.cos(l),a=Math.cos(n),s=this.sin_p14*t+this.cos_p14*i*a,r=1,s>0||Math.abs(s)<=Proj4js.common.EPSLN)var u=this.a*r*i*Math.sin(n),c=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*a);else Proj4js.reportError("orthoFwdPointError");return e.x=u,e.y=c,e},inverse:function(e){var t,i,n,a,r,s,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),t>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),i=Proj4js.common.asinz(t/this.a),n=Math.sin(i),a=Math.cos(i),s=this.long0,Math.abs(t)<=Proj4js.common.EPSLN&&(o=this.lat0),o=Proj4js.common.asinz(a*this.sin_p14+e.y*n*this.cos_p14/t),r=Math.abs(lat0)-Proj4js.common.HALF_PI,Math.abs(r)<=Proj4js.common.EPSLN&&(s=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y))),r=a-this.sin_p14*Math.sin(o),(Math.abs(r)>=Proj4js.common.EPSLN||Math.abs(x)>=Proj4js.common.EPSLN)&&(s=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*n*this.cos_p14,r*t))),e.x=s,e.y=o,e}},Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,n=this.rf,a=1/n,r=2*a-Math.pow(a,2),s=this.e=Math.sqrt(r);this.R=i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha),this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*s/2*Math.log((1+s*t)/(1-s*t))},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+i)+this.K,a=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(e.x-this.lambda0),s=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(r))),o=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(r));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*s+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,i=e.y-this.y0,n=t/this.R,a=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(a)+Math.sin(this.b0)*Math.cos(a)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(a))),o=this.lambda0+s/this.alpha,l=0,u=r,c=-1e3,d=0;Math.abs(u-c)>1e-7;){if(++d>20)return void Proj4js.reportError("omercFwdInfinity");l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),c=u,u=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=o,e.y=u,e}},Proj4js.Proj.stere={ssfn_:function(e,t,i){return t*=i,Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*i)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);if(this.mode=Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(e=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e),e*=this.e,this.akm1/=Math.sqrt(1-e*e));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0),t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI,e*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e),this.sinX1=Math.sin(t),this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var i,n,a=e.y;if(this.sphere){var r,s,o,l;switch(r=Math.sin(a),s=Math.cos(a),o=Math.cos(t),l=Math.sin(t),this.mode){case this.EQUIT:n=1+s*o,n<=Proj4js.common.EPSLN,n=this.akm1/n,i=n*s*l,n*=r;break;case this.OBLIQ:n=1+this.sinph0*r+this.cosph0*s*o,n<=Proj4js.common.EPSLN,n=this.akm1/n,i=n*s*l,n*=this.cosph0*r-this.sinph0*s*o;break;case this.N_POLE:o=-o,a=-a;case this.S_POLE:Math.abs(a-Proj4js.common.HALF_PI)<this.TOL,n=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*a),i=l*n,n*=o}}else{switch(o=Math.cos(t),l=Math.sin(t),r=Math.sin(a),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(X=2*Math.atan(this.ssfn_(a,r,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X)),this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*o)),n=A*(this.cosX1*sinX-this.sinX1*cosX*o),i=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*o),n=A*sinX,i=A*cosX;break;case this.S_POLE:a=-a,o=-o,r=-r;case this.N_POLE:i=this.akm1*Proj4js.common.tsfnz(this.e,a,r),n=-i*o}i*=l}return e.x=i*this.a+this.x0,e.y=n*this.a+this.y0,e},inverse:function(e){var t,i,n,a,r,s,o=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,u=0,c=0,d=0,h=0;if(this.sphere){var p,f,m,g;switch(f=Math.sqrt(o*o+l*l),p=2*Math.atan(f/this.akm1),m=Math.sin(p),g=Math.cos(p),t=0,this.mode){case this.EQUIT:i=Math.abs(f)<=Proj4js.common.EPSLN?0:Math.asin(l*m/f),(0!=g||0!=o)&&(t=Math.atan2(o*m,g*f));break;case this.OBLIQ:i=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(g*sinph0+l*m*cosph0/f),p=g-sinph0*Math.sin(i),(0!=p||0!=o)&&(t=Math.atan2(o*m*cosph0,p*f));break;case this.N_POLE:l=-l;case this.S_POLE:i=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-g:g),t=0==o&&0==l?0:Math.atan2(o,l)}}else{switch(r=Math.sqrt(o*o+l*l),this.mode){case this.OBLIQ:case this.EQUIT:u=2*Math.atan2(r*this.cosX1,this.akm1),n=Math.cos(u),a=Math.sin(u),c=Math.asin(0==r?n*this.sinX1:n*this.sinX1+l*a*this.cosX1/r),u=Math.tan(.5*(Proj4js.common.HALF_PI+c)),o*=a,l=r*this.cosX1*n-l*this.sinX1*a,h=Proj4js.common.HALF_PI,d=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:u=-r/this.akm1,c=Proj4js.common.HALF_PI-2*Math.atan(u),h=-Proj4js.common.HALF_PI,d=-.5*this.e}for(s=this.NITER;s--;c=i)if(a=this.e*Math.sin(c),i=2*Math.atan(u*Math.pow((1+a)/(1-a),d))-h,Math.abs(c-i)<this.CONV)return this.mode==this.S_POLE&&(i=-i),t=0==o&&0==l?0:Math.atan2(o,l),e.x=Proj4js.common.adjust_lon(t+this.long0),e.y=i,e}}},Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array,this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=new Array,this.B_im=new Array,this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=new Array,this.C_im=new Array,this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=new Array,this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t=e.x,i=e.y,a=i-this.lat0,r=t-this.long0,s=a/Proj4js.common.SEC_TO_RAD*1e-5,o=r,l=1,u=0;for(n=1;10>=n;n++)l*=s,u+=this.A[n]*l;var c,d,h=u,p=o,f=1,m=0,g=0,v=0;for(n=1;6>=n;n++)c=f*h-m*p,d=m*h+f*p,f=c,m=d,g=g+this.B_re[n]*f-this.B_im[n]*m,v=v+this.B_im[n]*f+this.B_re[n]*m;return x=v*this.a+this.x0,y=g*this.a+this.y0,e.x=x,e.y=y,e},inverse:function(e){var t,a,r=e.x,s=e.y,o=r-this.x0,l=s-this.y0,u=l/this.a,c=o/this.a,d=1,h=0,p=0,f=0;for(n=1;6>=n;n++)t=d*u-h*c,a=h*u+d*c,d=t,h=a,p=p+this.C_re[n]*d-this.C_im[n]*h,f=f+this.C_im[n]*d+this.C_re[n]*h;for(i=0;i<this.iterations;i++){var m,g,v=p,y=f,b=u,k=c;for(n=2;6>=n;n++)m=v*p-y*f,g=y*p+v*f,v=m,y=g,b+=(n-1)*(this.B_re[n]*v-this.B_im[n]*y),k+=(n-1)*(this.B_im[n]*v+this.B_re[n]*y);v=1,y=0;var _=this.B_re[1],w=this.B_im[1];for(n=2;6>=n;n++)m=v*p-y*f,g=y*p+v*f,v=m,y=g,_+=n*(this.B_re[n]*v-this.B_im[n]*y),w+=n*(this.B_im[n]*v+this.B_re[n]*y);var L=_*_+w*w;p=(b*_+k*w)/L,f=(k*_-b*w)/L}var x=p,S=f,O=1,T=0;for(n=1;9>=n;n++)O*=x,T+=this.D[n]*O;var C=this.lat0+T*Proj4js.common.SEC_TO_RAD*1e5,M=this.long0+S;return e.x=M,e.y=C,e}},Proj4js.Proj.mill={init:function(){},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),a=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+i/2.5))*1.25;return e.x=a,e.y=r,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Proj4js.common.PI/4);return e.x=t,e.y=i,e}},Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a},forward:function(e){var t,i,n,a,r,s,o=e.x,l=e.y;return n=Proj4js.common.adjust_lon(o-this.long0),t=Math.sin(l),i=Math.cos(l),a=Math.cos(n),s=this.sin_p14*t+this.cos_p14*i*a,r=1,s>0||Math.abs(s)<=Proj4js.common.EPSLN?(x=this.x0+this.a*r*i*Math.sin(n)/s,y=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*a)/s):(Proj4js.reportError("orthoFwdPointError"),x=this.x0+this.infinity_dist*i*Math.sin(n),y=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*a)),e.x=x,e.y=y,e},inverse:function(e){var t,i,n,a,r,s;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(a=Math.atan2(t,this.rc),i=Math.sin(a),n=Math.cos(a),s=Proj4js.common.asinz(n*this.sin_p14+e.y*i*this.cos_p14/t),r=Math.atan2(e.x*i,t*this.cos_p14*n-e.y*this.sin_p14*i),r=Proj4js.common.adjust_lon(this.long0+r)):(s=this.phic0,r=0),e.x=r,e.y=s,e}},Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(e){var t,i,n,a=e.x,r=e.y;return n=Proj4js.common.adjust_lon(a-this.long0),t=this.R*n*Math.cos(r)+this.x0,i=this.R*r+this.y0,e.x=t,e.y=i,e},inverse:function(e){var t,i,n;return e.x-=this.x0,e.y-=this.y0,t=e.y/this.R,Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),i=Math.abs(t)-Proj4js.common.HALF_PI,Math.abs(i)>Proj4js.common.EPSLN?(i=this.long0+e.x/(this.R*Math.cos(t)),n=Proj4js.common.adjust_lon(i)):n=this.long0,e.x=n,e.y=t,e}},Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(e){var t,i,n=e.x,a=e.y,r=Proj4js.common.adjust_lon(n-this.long0);Math.abs(a)<=Proj4js.common.EPSLN&&(t=this.x0+this.R*r,i=this.y0);var s=Proj4js.common.asinz(2*Math.abs(a/Proj4js.common.PI));(Math.abs(r)<=Proj4js.common.EPSLN||Math.abs(Math.abs(a)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)&&(t=this.x0,i=a>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*s):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*s));var o=.5*Math.abs(Proj4js.common.PI/r-r/Proj4js.common.PI),l=o*o,u=Math.sin(s),c=Math.cos(s),d=c/(u+c-1),h=d*d,p=d*(2/u-1),f=p*p,m=Proj4js.common.PI*this.R*(o*(d-f)+Math.sqrt(l*(d-f)*(d-f)-(f+l)*(h-f)))/(f+l);return 0>r&&(m=-m),t=this.x0+m,m=Math.abs(m/(Proj4js.common.PI*this.R)),i=a>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-m*m-2*o*m):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-m*m-2*o*m),e.x=t,e.y=i,e},inverse:function(e){var t,i,n,a,r,s,o,l,u,c,d;return e.x-=this.x0,e.y-=this.y0,u=Proj4js.common.PI*this.R,t=e.x/u,i=e.y/u,n=t*t+i*i,a=-Math.abs(i)*(1+n),r=a-2*i*i+t*t,s=-2*a+1+2*i*i+n*n,d=i*i/s+(2*r*r*r/s/s/s-9*a*r/s/s)/27,o=(a-r*r/3/s)/s,l=2*Math.sqrt(-o/3),u=3*d/o/l,Math.abs(u)>1&&(u=u>=0?1:-1),c=Math.acos(u)/3,lat=e.y>=0?(-l*Math.cos(c+Proj4js.common.PI/3)-r/3/s)*Proj4js.common.PI:-(-l*Math.cos(c+PI/3)-r/3/s)*Proj4js.common.PI,Math.abs(t)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(n-1+Math.sqrt(1+2*(t*t-i*i)+n*n))/2/t),e.x=lon,e.y=lat,e}},Proj4js.Proj.cea={init:function(){},forward:function(e){var t=e.x,i=e.y;dlon=Proj4js.common.adjust_lon(t-this.long0);var n=this.x0+this.a*dlon*Math.cos(this.lat_ts),a=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);return e.x=n,e.y=a,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts));return e.x=t,e.y=i,e}},Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0),this.lat_ts||(this.lat_ts=0),this.title||(this.title="Equidistant Cylindrical (Plate Carre)"),this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),a=Proj4js.common.adjust_lat(i-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*a,e},inverse:function(e){var t=e.x,i=e.y;return e.x=Proj4js.common.adjust_lon(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Proj4js.common.adjust_lat(this.lat0+(i-this.y0)/this.a),e}},Proj4js.Proj.cass={init:function(){this.sphere||(this.en=this.pj_enfn(this.es),this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(e){var t,i,n=e.x,a=e.y;return n=Proj4js.common.adjust_lon(n-this.long0),this.sphere?(t=Math.asin(Math.cos(a)*Math.sin(n)),i=Math.atan2(Math.tan(a),Math.cos(n))-this.phi0):(this.n=Math.sin(a),this.c=Math.cos(a),i=this.pj_mlfn(a,this.n,this.c,this.en),this.n=1/Math.sqrt(1-this.es*this.n*this.n),this.tn=Math.tan(a),this.t=this.tn*this.tn,this.a1=n*this.c,this.c*=this.es*this.c/(1-this.es),this.a2=this.a1*this.a1,t=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2)),i-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)),e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;return this.sphere?(this.dd=i+this.lat0,phi=Math.asin(Math.sin(this.dd)*Math.cos(t)),lam=Math.atan2(Math.tan(t),Math.cos(this.dd))):(ph1=this.pj_inv_mlfn(this.m0+i,this.es,this.en),this.tn=Math.tan(ph1),this.t=this.tn*this.tn,this.n=Math.sin(ph1),this.r=1/(1-this.es*this.n*this.n),this.n=Math.sqrt(this.r),this.r*=(1-this.es)*this.n,this.dd=t/this.n,this.d2=this.dd*this.dd,phi=ph1-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3),lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)),e.x=Proj4js.common.adjust_lon(this.long0+lam),e.y=phi,e},pj_enfn:function(e){en=new Array,en[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08))),en[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var t=e*e;return en[2]=t*(this.C44-e*(this.C46+e*this.C48)),t*=e,en[3]=t*(this.C66-e*this.C68),en[4]=t*e*this.C88,en},pj_mlfn:function(e,t,i,n){return i*=t,t*=t,n[0]*e-i*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))},pj_inv_mlfn:function(e,n,a){for(k=1/(1-n),phi=e,i=Proj4js.common.MAX_ITER;i;--i)if(s=Math.sin(phi),t=1-n*s*s,t=(this.pj_mlfn(phi,s,Math.cos(phi),a)-e)*t*Math.sqrt(t)*k,phi-=t,Math.abs(t)<Proj4js.common.EPSLN)return phi;return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),phi},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875},Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0),cphi=Math.cos(this.lat0),cphi*=cphi,this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi),this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es)),this.phic0=Math.asin(sphi/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(i),this.ratexp))-Proj4js.common.HALF_PI,e.x=this.C*t,e},inverse:function(e){var t=1e-14,i=e.x/this.C,n=e.y;num=Math.pow(Math.tan(.5*n+Proj4js.common.FORTPI)/this.K,1/this.C);for(var a=Proj4js.common.MAX_ITER;a>0&&(n=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(e.y),-.5*this.e))-Proj4js.common.HALF_PI,!(Math.abs(n-e.y)<t));--a)e.y=n;return a?(e.x=i,e.y=n,e):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}},Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0),this.lon1||(this.lon1=0,this.mode=1),this.lon2||(this.lon2=0),this.lat2||(this.lat2=0);{var e=this.b/this.a,t=1-Math.pow(e,2);Math.sqrt(t)}this.sin_p20=Math.sin(this.lat0),this.cos_p20=Math.cos(this.lat0),this.con=1-this.es*this.sin_p20*this.sin_p20,this.com=Math.sqrt(1-t),this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-t)),this.al=this.a*this.bl*this.k0*this.com/this.con,Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d,this.el=this.f*Math.pow(this.ts,this.bl)),0!=this.mode?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(e){var t,i,n,a,r,s,o,l,u,c,d,h=e.x,p=e.y;t=Math.sin(p),c=Proj4js.common.adjust_lon(h-this.longc),s=Math.sin(this.bl*c),Math.abs(Math.abs(p)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(d=Proj4js.common.tsfnz(this.e,p,t),a=this.el/Math.pow(d,this.bl),u=.5*(a-1/a),i=.5*(a+1/a),o=(u*this.singam-s*this.cosgam)/i,n=Math.cos(this.bl*c),Math.abs(n)<1e-7?r=this.al*this.bl*c:(r=this.al*Math.atan((u*this.cosgam+s*this.singam)/n)/this.bl,0>n&&(r+=Proj4js.common.PI*this.al/this.bl))):(o=p>=0?this.singam:-this.singam,r=this.al*p/this.bl),Math.abs(Math.abs(o)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),l=.5*this.al*Math.log((1-o)/(1+o))/this.bl,r-=this.u;var f=this.x0+l*this.cosaz+r*this.sinaz,m=this.y0+r*this.cosaz-l*this.sinaz;return e.x=f,e.y=m,e},inverse:function(e){var t,i,n,a,r,s,o,l,u,c,d;return e.x-=this.x0,e.y-=this.y0,d=0,a=e.x*this.cosaz-e.y*this.sinaz,r=e.y*this.cosaz+e.x*this.sinaz,r+=this.u,s=Math.exp(-this.bl*a/this.al),o=.5*(s-1/s),i=.5*(s+1/s),u=Math.sin(this.bl*r/this.al),c=(u*this.cosgam+o*this.singam)/i,Math.abs(Math.abs(c)-1)<=Proj4js.common.EPSLN?(lon=this.longc,lat=c>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI):(n=1/this.bl,l=Math.pow(this.el/Math.sqrt((1+c)/(1-c)),n),lat=Proj4js.common.phi2z(this.e,l),t=this.longc-Math.atan2(o*this.cosgam-u*this.singam,n)/this.bl,lon=Proj4js.common.adjust_lon(t)),e.x=lon,e.y=lat,e
}},Proj4js.Proj.lcc={init:function(){if(this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1),Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)return void Proj4js.reportError("lcc:init: Equal Latitudes");var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),n=Proj4js.common.msfnz(this.e,t,i),a=Proj4js.common.tsfnz(this.e,this.lat1,t),r=Math.sin(this.lat2),s=Math.cos(this.lat2),o=Proj4js.common.msfnz(this.e,r,s),l=Proj4js.common.tsfnz(this.e,this.lat2,r),u=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(n/o)/Math.log(a/l):t,this.f0=n/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")},forward:function(e){var t=e.x,i=e.y;if(!(90>=i&&i>=-90&&180>=t&&t>=-180))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+t+" : "+i),null;var n,a,r=Math.abs(Math.abs(i)-Proj4js.common.HALF_PI);if(r>Proj4js.common.EPSLN)n=Proj4js.common.tsfnz(this.e,i,Math.sin(i)),a=this.a*this.f0*Math.pow(n,this.ns);else{if(r=i*this.ns,0>=r)return Proj4js.reportError("lcc:forward: No Projection"),null;a=0}var s=this.ns*Proj4js.common.adjust_lon(t-this.long0);return e.x=this.k0*a*Math.sin(s)+this.x0,e.y=this.k0*(this.rh-a*Math.cos(s))+this.y0,e},inverse:function(e){var t,i,n,a,r;x=(e.x-this.x0)/this.k0,y=this.rh-(e.y-this.y0)/this.k0,this.ns>0?(t=Math.sqrt(x*x+y*y),i=1):(t=-Math.sqrt(x*x+y*y),i=-1);var s=0;if(0!=t&&(s=Math.atan2(i*x,i*y)),0!=t||this.ns>0){if(i=1/this.ns,n=Math.pow(t/(this.a*this.f0),i),a=Proj4js.common.phi2z(this.e,n),-9999==a)return null}else a=-Proj4js.common.HALF_PI;return r=Proj4js.common.adjust_lon(s/this.ns+this.long0),e.x=r,e.y=a,e}},Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var e=Math.abs(this.lat0);if(this.mode=Math.abs(e-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ,this.es>0){var t;switch(this.qp=Proj4js.common.qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Proj4js.common.qsfnz(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode==this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,i,n=e.x,a=e.y;if(n=Proj4js.common.adjust_lon(n-this.long0),this.sphere){var r,s,o;switch(o=Math.sin(a),s=Math.cos(a),r=Math.cos(n),this.mode){case this.EQUIT:if(i=this.mode==this.EQUIT?1+s*r:1+this.sinph0*o+this.cosph0*s*r,i<=Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:y less than eps"),null;i=Math.sqrt(2/i),t=i*s*Math.sin(n),i*=this.mode==this.EQUIT?o:this.cosph0*o-this.sinph0*s*r;break;case this.N_POLE:r=-r;case this.S_POLE:if(Math.abs(a+this.phi0)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:phi < eps"),null;i=Proj4js.common.FORTPI-.5*a,i=2*(this.mode==this.S_POLE?Math.cos(i):Math.sin(i)),t=i*Math.sin(n),i*=r}}else{var r,l,o,u,c=0,d=0,h=0;switch(r=Math.cos(n),l=Math.sin(n),o=Math.sin(a),u=Proj4js.common.qsfnz(this.e,o),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(c=u/this.qp,d=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:h=1+this.sinb1*c+this.cosb1*d*r;break;case this.EQUIT:h=1+d*r;break;case this.N_POLE:h=Proj4js.common.HALF_PI+a,u=this.qp-u;break;case this.S_POLE:h=a-Proj4js.common.HALF_PI,u=this.qp+u}if(Math.abs(h)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:b < eps"),null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),i=this.mode==this.OBLIQ?this.ymf*h*(this.cosb1*c-this.sinb1*d*r):(h=Math.sqrt(2/(1+d*r)))*c*this.ymf,t=this.xmf*h*d*l;break;case this.N_POLE:case this.S_POLE:u>=0?(t=(h=Math.sqrt(u))*l,i=r*(this.mode==this.S_POLE?h:-h)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;if(this.sphere){var n,a=0,r=0;n=Math.sqrt(t*t+i*i);var s=.5*n;if(s>1)return Proj4js.reportError("laea:Inv:DataError"),null;switch(s=2*Math.asin(s),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(r=Math.sin(s),a=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(n)<=Proj4js.common.EPSLN?0:Math.asin(i*r/n),t*=r,i=a*n;break;case this.OBLIQ:s=Math.abs(n)<=Proj4js.common.EPSLN?this.phi0:Math.asin(a*sinph0+i*r*cosph0/n),t*=r*cosph0,i=(a-Math.sin(s)*sinph0)*n;break;case this.N_POLE:i=-i,s=Proj4js.common.HALF_PI-s;break;case this.S_POLE:s-=Proj4js.common.HALF_PI}lam=0!=i||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(t,i):0}else{var o,l,u,c,d=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:if(t/=this.dd,i*=this.dd,c=Math.sqrt(t*t+i*i),c<Proj4js.common.EPSLN)return e.x=0,e.y=this.phi0,e;l=2*Math.asin(.5*c/this.rq),o=Math.cos(l),t*=l=Math.sin(l),this.mode==this.OBLIQ?(d=o*this.sinb1+i*l*this.cosb1/c,u=this.qp*d,i=c*this.cosb1*o-i*this.sinb1*l):(d=i*l/c,u=this.qp*d,i=c*o);break;case this.N_POLE:i=-i;case this.S_POLE:if(u=t*t+i*i,!u)return e.x=0,e.y=this.phi0,e;d=1-u/this.qp,this.mode==this.S_POLE&&(d=-d)}lam=Math.atan2(t,i),s=this.authlat(Math.asin(d),this.apa)}return e.x=Proj4js.common.adjust_lon(this.long0+lam),e.y=s,e},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(e){var t,i=new Array;return i[0]=e*this.P00,t=e*e,i[0]+=t*this.P01,i[1]=t*this.P10,t*=e,i[0]+=t*this.P02,i[1]+=t*this.P11,i[2]=t*this.P20,i},authlat:function(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}},Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,i=e.x,n=(e.y,Math.sin(e.y)),a=Math.cos(e.y),r=Proj4js.common.adjust_lon(i-this.long0),s=Math.cos(r),o=this.sin_p12*n+this.cos_p12*a*s;if(Math.abs(Math.abs(o)-1)<Proj4js.common.EPSLN){if(t=1,0>o)return void Proj4js.reportError("aeqd:Fwd:PointError")}else{var l=Math.acos(o);t=l/Math.sin(l)}return e.x=this.x0+this.a*t*a*Math.sin(r),e.y=this.y0+this.a*t*(this.cos_p12*n-this.sin_p12*a*s),e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Math.sqrt(e.x*e.x+e.y*e.y);if(t>2*Proj4js.common.HALF_PI*this.a)return void Proj4js.reportError("aeqdInvDataError");var i,n=t/this.a,a=Math.sin(n),r=Math.cos(n),s=this.long0;if(Math.abs(t)<=Proj4js.common.EPSLN)i=this.lat0;else{i=Proj4js.common.asinz(r*this.sin_p12+e.y*a*this.cos_p12/t);var o=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(o)<=Proj4js.common.EPSLN)s=Proj4js.common.adjust_lon(lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y));else if(o=r-this.sin_p12*Math.sin(i),Math.abs(o)<Proj4js.common.EPSLN&&Math.abs(e.x)<Proj4js.common.EPSLN);else{{Math.atan2(e.x*a*this.cos_p12,o*t)}s=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*a*this.cos_p12,o*t))}}return e.x=s,e.y=i,e}},Proj4js.Proj.moll={init:function(){},forward:function(e){for(var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),a=i,r=Proj4js.common.PI*Math.sin(i),s=0;!0;s++){var o=-(a+Math.sin(a)-r)/(1+Math.cos(a));if(a+=o,Math.abs(o)<Proj4js.common.EPSLN)break;s>=50&&Proj4js.reportError("moll:Fwd:IterationError")}a/=2,Proj4js.common.PI/2-Math.abs(i)<Proj4js.common.EPSLN&&(n=0);var l=.900316316158*this.a*n*Math.cos(a)+this.x0,u=1.4142135623731*this.a*Math.sin(a)+this.y0;return e.x=l,e.y=u,e},inverse:function(e){var t,i;e.x-=this.x0;var i=e.y/(1.4142135623731*this.a);Math.abs(i)>.999999999999&&(i=.999999999999);var t=Math.asin(i),n=Proj4js.common.adjust_lon(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Proj4js.common.PI&&(n=-Proj4js.common.PI),n>Proj4js.common.PI&&(n=Proj4js.common.PI),i=(2*t+Math.sin(2*t))/Proj4js.common.PI,Math.abs(i)>1&&(i=1);var a=Math.asin(i);return e.x=n,e.y=a,e}},define("libraries/proj4js-1.0.1/proj4js-compressed",function(){});var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var e,t,i=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),n=document.getElementsByTagName("script"),a="",r=0,s=n.length;s>r;r++)if(e=n[r].getAttribute("src"),e&&(t=e.match(i))){a=t[1];break}return function(){return a}}(),ImgPath:""};if(OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],n="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var a=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,a)}else n.prototype=i;return n},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var n,a,r;for(n=2,a=arguments.length;a>n;n++)r=arguments[n],"function"==typeof r&&(r=r.prototype),OpenLayers.Util.extend(e.prototype,r)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}var a="function"==typeof window.Event&&t instanceof window.Event;!a&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;i>t;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(e,t,i,n,a,r,s,o){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_")),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),n&&(e.style.width=n.w+"px",e.style.height=n.h+"px"),a&&(e.style.position=a),r&&(e.style.border=r),s&&(e.style.overflow=s),parseFloat(o)>=0&&parseFloat(o)<1?(e.style.filter="alpha(opacity="+100*o+")",e.style.opacity=o):1==parseFloat(o)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,n,a,r,s,o){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),a||(a="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,a,r,s,o),l},OpenLayers.Util.createImage=function(e,t,i,n,a,r,s,o){function l(){u.style.display="",OpenLayers.Event.stopObservingElement(u)}var u=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),a||(a="relative"),OpenLayers.Util.modifyDOMElement(u,e,t,i,a,r,null,s),o&&(u.style.display="none",OpenLayers.Event.observe(u,"load",l),OpenLayers.Event.observe(u,"error",l)),u.style.alt=e,u.galleryImg="no",n&&(u.src=n),u},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),i=!1;try{i=!!document.body.filters}catch(n){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&7>t}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,n,a,r,s,o,l){OpenLayers.Util.modifyDOMElement(e,t,i,n,r,null,null,l);var u=e.childNodes[0];a&&(u.src=a),OpenLayers.Util.modifyDOMElement(u,e.id+"_innerImage",null,n,"relative",s),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==o&&(o="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+u.src+"', sizingMethod='"+o+"')",parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),u.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,n,a,r,s,o,l){var u=OpenLayers.Util.createDiv(),c=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);return c.className="olAlphaImg",u.appendChild(c),OpenLayers.Util.modifyAlphaImageDiv(u,e,t,i,n,a,r,s,o),u},OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var n in t)(void 0===e[n]||!i&&t.hasOwnProperty&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n))&&(e[n]=t[n]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var n=e[i];if(null!=n&&"function"!=typeof n){var a;if("object"==typeof n&&n.constructor==Array){for(var r,s=[],o=0,l=n.length;l>o;o++)r=n[o],s.push(encodeURIComponent(null===r||void 0===r?"":r));a=s.join(",")}else a=encodeURIComponent(n);t.push(encodeURIComponent(i)+"="+a)}}return t.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var n=(e+" ").split(/[?&]/);i+=" "===n.pop()?t:n.length?"&"+t:"?"+t}return i},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;i>t;t++){var n=arguments[t];try{e=n();break}catch(a){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,n=i.a,a=i.b,r=i.f,s=OpenLayers.Util.rad(t.lon-e.lon),o=Math.atan((1-r)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-r)*Math.tan(OpenLayers.Util.rad(t.lat))),u=Math.sin(o),c=Math.cos(o),d=Math.sin(l),h=Math.cos(l),p=s,f=2*Math.PI,m=20;Math.abs(p-f)>1e-12&&--m>0;){var g=Math.sin(p),v=Math.cos(p),y=Math.sqrt(h*g*h*g+(c*d-u*h*v)*(c*d-u*h*v));if(0==y)return 0;var b=u*d+c*h*v,k=Math.atan2(y,b),_=Math.asin(c*h*g/y),w=Math.cos(_)*Math.cos(_),L=b-2*u*d/w,x=r/16*w*(4+r*(4-3*w));f=p,p=s+(1-x)*r*Math.sin(_)*(k+x*y*(L+x*b*(-1+2*L*L)))}if(0==m)return 0/0;var S=w*(n*n-a*a)/(a*a),O=1+S/16384*(4096+S*(-768+S*(320-175*S))),T=S/1024*(256+S*(-128+S*(74-47*S))),C=T*y*(L+T/4*(b*(-1+2*L*L)-T/6*L*(-3+4*y*y)*(-3+4*L*L))),M=a*O*(k-C),N=M.toFixed(3)/1e3;return N},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var n=OpenLayers.Util,a=n.VincentyConstants,r=a.a,s=a.b,o=a.f,l=e.lon,u=e.lat,c=i,d=n.rad(t),h=Math.sin(d),p=Math.cos(d),f=(1-o)*Math.tan(n.rad(u)),m=1/Math.sqrt(1+f*f),g=f*m,v=Math.atan2(f,p),y=m*h,b=1-y*y,k=b*(r*r-s*s)/(s*s),_=1+k/16384*(4096+k*(-768+k*(320-175*k))),w=k/1024*(256+k*(-128+k*(74-47*k))),L=c/(s*_),x=2*Math.PI;Math.abs(L-x)>1e-12;){var S=Math.cos(2*v+L),O=Math.sin(L),T=Math.cos(L),C=w*O*(S+w/4*(T*(-1+2*S*S)-w/6*S*(-3+4*O*O)*(-3+4*S*S)));x=L,L=c/(s*_)+C}{var M=g*O-m*T*p,N=Math.atan2(g*T+m*O*p,(1-o)*Math.sqrt(y*y+M*M)),E=Math.atan2(O*h,m*T-g*O*p),z=o/16*b*(4+o*(4-3*b)),P=E-(1-z)*o*y*(L+z*O*(S+z*T*(-1+2*S*S)));Math.atan2(y,-M)}return new OpenLayers.LonLat(l+n.deg(P),n.deg(N))},OpenLayers.Util.getParameters=function(e,t){t=t||{},e=null===e||void 0===e?window.location.href:e;var i="";if(OpenLayers.String.contains(e,"?")){var n=e.indexOf("?")+1,a=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;i=e.substring(n,a)}for(var r={},s=i.split(/[&;]/),o=0,l=s.length;l>o;++o){var u=s[o].split("=");if(u[0]){var c=u[0];try{c=decodeURIComponent(c)}catch(d){c=unescape(c)}var h=(u[1]||"").replace(/\+/g," ");try{h=decodeURIComponent(h)}catch(d){h=unescape(h)}t.splitArgs!==!1&&(h=h.split(",")),1==h.length&&(h=h[0]),r[c]=h}}return r},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){null==t&&(t="degrees");var n=OpenLayers.Util.normalizeScale(e);i=1/(n*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i},OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n,a=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),r=null;if(e.getBoundingClientRect){n=e.getBoundingClientRect();var s=window.pageYOffset||i.scrollTop,o=window.pageXOffset||i.scrollLeft;t[0]=n.left+o,t[1]=n.top+s}else if(document.getBoxObjectFor&&!a){n=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=n.screenX-l.screenX,t[1]=n.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,r=e.offsetParent,r!=e)for(;r;)t[0]+=r.offsetLeft,t[1]+=r.offsetTop,r=r.offsetParent;var u=OpenLayers.BROWSER_NAME;for(("opera"==u||"safari"==u&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),r=e.offsetParent;r&&r!=document.body;)t[0]-=r.scrollLeft,("opera"!=u||"TR"!=r.tagName)&&(t[1]-=r.scrollTop),r=r.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var n=OpenLayers.Util.createUrlObject(e,i),a=OpenLayers.Util.createUrlObject(t,i);for(var r in n)if("args"!==r&&n[r]!=a[r])return!1;for(var r in n.args){if(n.args[r]!=a.args[r])return!1;delete a.args[r]}for(var r in a.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,n=i.port?":"+i.port:"",a=i.protocol+"//"+i.host.split(":").shift()+n;if(0===e.indexOf("/"))e=a+e;else{var r=i.pathname.split("/");r.pop(),e=a+r.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var s=document.createElement("a");s.href=e;var o={};o.host=s.host.split(":").shift(),o.protocol=s.protocol,o.port=t.ignorePort80?"80"==s.port||"0"==s.port?"":s.port:""==s.port||"0"==s.port?"80":s.port,o.hash=t.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var u=e.indexOf("?");l=-1!=u?e.substr(u):""}return o.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs}),o.pathname="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname,o},OpenLayers.Util.removeTail=function(e){var t=null,i=e.indexOf("?"),n=e.indexOf("#");return t=-1==i?-1!=n?e.substr(0,n):e:-1!=n?e.substr(0,Math.min(i,n)):e.substr(0,i)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var n,a,r=document.createElement("div");r.style.visibility="hidden";for(var s=i&&i.containerElement?i.containerElement:document.body,o=!1,l=null,u=s;u&&"body"!=u.tagName.toLowerCase();){var c=OpenLayers.Element.getStyle(u,"position");if("absolute"==c){o=!0;break}if(c&&"static"!=c)break;u=u.parentNode}!o||0!==s.clientHeight&&0!==s.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(r)),r.style.position="absolute",t&&(t.w?(n=t.w,r.style.width=n+"px"):t.h&&(a=t.h,r.style.height=a+"px")),i&&i.displayClass&&(r.className=i.displayClass);var d=document.createElement("div");if(d.innerHTML=e,d.style.overflow="visible",d.childNodes)for(var h=0,p=d.childNodes.length;p>h;h++)d.childNodes[h].style&&(d.childNodes[h].style.overflow="visible");return r.appendChild(d),s.appendChild(l?l:r),n||(n=parseInt(d.scrollWidth),r.style.width=n+"px"),a||(a=parseInt(d.scrollHeight)),r.removeChild(d),l?(l.removeChild(r),s.removeChild(l)):s.removeChild(r),new OpenLayers.Size(n,a)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,n=0,a=0;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),n=i.offsetWidth,t.style.overflow="scroll",a=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=n-a,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),e=(e+540)%360-180;var n=Math.abs(e),a=Math.floor(n),r=(n-a)/(1/60),s=r;r=Math.floor(r);var o=(s-r)/(1/60);o=Math.round(10*o),o/=10,o>=60&&(o-=60,r+=1,r>=60&&(r-=60,a+=1)),10>a&&(a="0"+a);var l=a+"°";return i.indexOf("dm")>=0&&(10>r&&(r="0"+r),l+=r+"'",i.indexOf("dms")>=0&&(10>o&&(o="0"+o),l+=o+'"')),l+=OpenLayers.i18n("lon"==t?0>e?"W":"E":0>e?"S":"N")},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(t){if(void 0===s[t]){var i=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),a=n(i);s[t]=e(a)}return s[t]}function i(e,t){if(void 0===o[t]){var i,n,r=0,s=a.length,l="undefined"!=typeof e.cssText;for(o[t]=null;s>r;r++)if(n=a[r],n?(l||(n=n.toLowerCase()),i=n+t.charAt(0).toUpperCase()+t.slice(1)):i=t,void 0!==e[i]){o[t]=i;break}}return o[t]}function n(e){return i(r,e)}var a=["","O","ms","Moz","Webkit"],r=document.createElement("div").style,s={},o={};return{css:t,js:i,style:n,cssCache:s,jsCache:o}}(),OpenLayers.Animation=function(e){function t(e,t,i){t=t>0?t:Number.POSITIVE_INFINITY;var n=++s,a=+new Date;return o[n]=function(){o[n]&&+new Date-a<=t?(e(),o[n]&&r(o[n],i)):delete o[n]},r(o[n],i),n}function i(e){delete o[e]}var n=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),a=!!n,r=function(){var t=e[n]||function(t){e.setTimeout(t,16)};return function(i,n){t.apply(e,[i,n])}}(),s=0,o={};return{isNative:a,requestFrame:r,start:t,stop:i}}(window),OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],n=1,a=t.length;a>n;n++){var r=t[n];i+=r.charAt(0).toUpperCase()+r.substring(1)}return i},format:function(e,t,i){t||(t=window);var n=function(e,n){for(var a,r=n.split(/\.+/),s=0;s<r.length&&(0==s&&(a=t),void 0!==a);s++)a=a[r[s]];return"function"==typeof a&&(a=i?a.apply(null,i):a()),"undefined"==typeof a?"undefined":a};return e.replace(OpenLayers.String.tokenRegEx,n)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return t===!0&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(e)?parseFloat(e):i}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,n){t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator,n="undefined"!=typeof n?n:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var a=e.toString().split(".");1==a.length&&null==t&&(t=0);var r=a[0];if(i)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(r);)r=r.replace(s,"$1"+i+"$2");var o;if(0==t)o=r;else{var l=a.length>1?a[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0")),o=r+n+l}return o},zeroPad:function(e,t,i){for(var n=e.toString(i||10);n.length<t;)n="0"+n;return n}},OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(e,t,i){var n=[];if(Array.prototype.filter)n=e.filter(t,i);else{var a=e.length;if("function"!=typeof t)throw new TypeError;for(var r=0;a>r;r++)if(r in e){var s=e[r];t.call(i,s,r,e)&&n.push(s)}}return n}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,n){OpenLayers.Util.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),n=Math.round(this.left*i)/i,a=Math.round(this.bottom*i)/i,r=Math.round(this.right*i)/i,s=Math.round(this.top*i)/i;return t===!0?a+","+n+","+s+","+r:n+","+a+","+r+","+s},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,n;"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,n=t.lat):(i=t.x,n=t.y);var a=(this.left-i)*e+i,r=(this.bottom-n)*e+n,s=(this.right-i)*e+i,o=(this.top-n)*e+n;return new OpenLayers.Bounds(a,r,s,o)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);
break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null,(null==this.left||e<this.left)&&(this.left=e),(null==this.bottom||t<this.bottom)&&(this.bottom=t),(null==this.right||e>this.right)&&(this.right=e),(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lon,e.lat,t.inclusive),n=t.worldBounds;if(n&&!i){var a=n.getWidth(),r=(n.left+n.right)/2,s=Math.round((e.lon-r)/a);i=this.containsLonLat({lon:e.lon-s*a,lat:e.lat},{inclusive:t.inclusive})}return i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t);var n=!1;return n=i?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else i=this;null==t.inclusive&&(t.inclusive=!0);var n=!1,a=i.left==e.right||i.right==e.left||i.top==e.bottom||i.bottom==e.top;if(t.inclusive||!a){var r=e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top,s=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,o=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,l=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right;n=(r||s)&&(o||l)}if(t.worldBounds&&!n){var u=t.worldBounds,c=u.getWidth(),d=!u.containsBounds(i),h=!u.containsBounds(e);d&&!h?(e=e.add(-c,0),n=i.intersectsBounds(e,{inclusive:t.inclusive})):h&&!d&&(i=i.add(-c,0),n=e.intersectsBounds(i,{inclusive:t.inclusive}))}return n},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.left,e.bottom,i),a=this.contains(e.right,e.bottom,i),r=this.contains(e.left,e.top,i),s=this.contains(e.right,e.top,i);return t?n||a||r||s:n&&a&&r&&s},determineQuadrant:function(e){var t="",i=this.getCenterLonLat();return t+=e.lat<i.lat?"b":"t",t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),a=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,a.x),this.bottom=Math.min(i.y,n.y),this.right=Math.max(n.x,r.x),this.top=Math.max(a.y,r.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,n=t.rightTolerance||0,a=this.clone();if(e){for(var r=e.getWidth();a.left<e.left&&a.right-n<=e.left;)a=a.add(r,0);for(;a.left+i>=e.right&&a.right>e.right;)a=a.add(-r,0);var s=a.left+i;s<e.right&&s>e.left&&a.right-n>e.right&&(a=a.add(-r,0))}return a},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";return t+="t"==e.charAt(0)?"b":"t",t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;t>e;e++){var i=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(i)?"none":"";i.style.display=n}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){if(i=e.style[OpenLayers.String.camelize(t)],!i)if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(e,null);i=n?n.getPropertyValue(t):null}else e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]);var a=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(a,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],n=t&&e[1];return new OpenLayers.LonLat(i,n)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;i>t;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,n){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=n.callbacks,this.minFrameRate=n.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e={};for(var t in this.begin){var i=this.begin[t],n=this.finish[t];if(null==i||null==n||isNaN(i)||isNaN(n))throw new TypeError("invalid value for Tween");var a=n-i;e[t]=this.easing.apply(this,[this.time,i,a,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,e),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,n){return i*e/n+t},easeOut:function(e,t,i,n){return i*e/n+t},easeInOut:function(e,t,i,n){return i*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,n=(new Date).getTime(),a=0,r=this.points.length;r>a&&(i=this.points[a],!(n-i.tick>this.delay));a++)t=i;if(t){var s=(new Date).getTime()-t.tick,o=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=o/s;if(!(0==l||l<this.threshold)){var u=Math.asin((e.y-t.xy.y)/o);return t.xy.x<=e.x&&(u=Math.PI-u),{speed:l,theta:u}}}},move:function(e,t){var i=e.speed,n=Math.cos(e.theta),a=-Math.sin(e.theta),r=(new Date).getTime(),s=0,o=0,l=function(){if(null!=this.timerId){var e=(new Date).getTime()-r,l=-this.deceleration*Math.pow(e,2)/2+i*e,u=l*n,c=l*a,d={};d.end=!1;var h=-this.deceleration*e+i;0>=h&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,d.end=!0),d.x=u-s,d.y=c-o,s=u,o=c,t(d.x,d.y,d.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(l,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,n){var a=OpenLayers.Util.getElement(e);if(n=n||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!a._eventCacheID){var r="eventCacheID_";a.id&&(r=a.id+"_"+r),a._eventCacheID=OpenLayers.Util.createUniqueID(r)}var s=a._eventCacheID;this.observers[s]||(this.observers[s]=[]),this.observers[s].push({element:a,name:t,observer:i,useCapture:n}),a.addEventListener?a.addEventListener(t,i,n):a.attachEvent&&a.attachEvent("on"+t,i)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}},stopObserving:function(e,t,i,n){n=n||!1;var a=OpenLayers.Util.getElement(e),r=a._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(t="keydown");var s=!1,o=OpenLayers.Event.observers[r];if(o)for(var l=0;!s&&l<o.length;){var u=o[l];if(u.name==t&&u.observer==i&&u.useCapture==n){o.splice(l,1),0==o.length&&delete OpenLayers.Event.observers[r],s=!0;break}l++}return s&&(a.removeEventListener?a.removeEventListener(t,i,n):a&&a.detachEvent&&a.detachEvent("on"+t,i)),s},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,n,a){OpenLayers.Util.extend(this,a),this.object=e,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t,i=!!window.navigator.msMaxTouchPoints,n=0,a=this.BROWSER_EVENTS.length;a>n;n++)t=this.BROWSER_EVENTS[n],OpenLayers.Event.observe(e,t,this.eventHandler),i&&0===t.indexOf("touch")&&this.addMsTouchListener(e,t,this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,i,n){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=i){null==t&&(t=this.object);var a=this.listeners[e];a||(a=[],this.listeners[e]=a,this.extensionCount[e]=0);var r={obj:t,func:i};n?(a.splice(this.extensionCount[e],0,r),"object"==typeof n&&n.extension&&this.extensionCount[e]++):a.push(r)}},registerPriority:function(e,t,i){this.register(e,t,i,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){null==t&&(t=this.object);var n=this.listeners[e];if(null!=n)for(var a=0,r=n.length;r>a;a++)if(n[a].obj==t&&n[a].func==i){n.splice(a,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(!i||0==i.length)return void 0;null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),i=i.slice();for(var n,a=0,r=i.length;r>a;a++){var s=i[a];if(n=s.func.apply(s.obj,[t]),void 0!=n&&0==n)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),n},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){var n=e.touches;if(n&&n[0]){for(var a,r=0,s=0,o=n.length,l=0;o>l;++l)a=this.getTouchClientXY(n[l]),r+=a.clientX,s+=a.clientY;e.clientX=r/o,e.clientY=s/o}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,i=t.pageXOffset,n=t.pageYOffset,a=e.clientX,r=e.clientY;return 0===e.pageY&&Math.floor(r)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(a)>Math.floor(e.pageX)?(a-=i,r-=n):(r<e.pageY-n||a<e.pageX-i)&&(a=e.pageX-i,r=e.pageY-n),e.olClientX=a,e.olClientY=r,{clientX:a,clientY:r}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(e,t,i){function n(e){i(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=a.length-1;e>=0;--e)a[e].stopPropagation()},preventDefault:function(){for(var e=a.length-1;e>=0;--e)a[e].preventDefault()},type:t},e))}var a=(this.eventHandler,this._msTouches);switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,n);case"touchend":return this.addMsTouchListenerEnd(e,t,n);case"touchmove":return this.addMsTouchListenerMove(e,t,n);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,t,i){var n=this._msTouches,a=function(e){for(var t=!1,a=0,r=n.length;r>a;++a)if(n[a].pointerId==e.pointerId){t=!0;break}t||n.push(e),e.touches=n.slice(),i(e)};OpenLayers.Event.observe(e,"MSPointerDown",a);var r=function(e){for(var t=0,i=n.length;i>t;++t)if(n[t].pointerId==e.pointerId){n.splice(t,1);break}};OpenLayers.Event.observe(e,"MSPointerUp",r)},addMsTouchListenerMove:function(e,t,i){var n=this._msTouches,a=function(e){if(!(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&0==e.buttons||1==n.length&&n[0].pageX==e.pageX&&n[0].pageY==e.pageY)){for(var t=0,a=n.length;a>t;++t)if(n[t].pointerId==e.pointerId){n[t]=e;break}e.touches=n.slice(),i(e)}};OpenLayers.Event.observe(e,"MSPointerMove",a)},addMsTouchListenerEnd:function(e,t,i){var n=this._msTouches,a=function(e){for(var t=0,a=n.length;a>t;++t)if(n[t].pointerId==e.pointerId){n.splice(t,1);break}e.touches=n.slice(),i(e)};OpenLayers.Event.observe(e,"MSPointerUp",a)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,i=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--i>0&&e);return t},ignore:function(e){var t=3,i=!1;do{if("a"===e.nodeName.toLowerCase()){i=!0;break}e=e.parentNode}while(--t>0&&e);return i},buttonClick:function(e){var t=!0,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var n=this.getPressedButton(i);if(n){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:n}),OpenLayers.Event.stop(e),t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var a=OpenLayers.Util.pagePosition(n),r=OpenLayers.Util.getViewportElement(),s=window.pageYOffset||r.scrollTop,o=window.pageXOffset||r.scrollLeft;a[0]=a[0]-o,a[1]=a[1]-s,this.target.triggerEvent("buttonclick",{buttonElement:n,buttonXY:{x:this.startEvt.clientX-a[0],y:this.startEvt.clientY-a[1]}})}this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else t=!this.ignore(OpenLayers.Event.element(e)),delete this.startEvt}return t}}),OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),n=!i&&e.match(this.URL_SPLIT_REGEX);if(n){var a=window.location;i=n[1]==a.protocol&&n[3]==a.hostname;var r=n[4],s=a.port;(80!=r&&""!=r||"80"!=s&&""!=s)&&(i=i&&r==s)}return i||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e)),e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{},e.headers=e.headers||{},e=OpenLayers.Util.applyDefaults(e,t),e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var i,n=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(n=!0);n===!1&&(e.headers["X-Requested-With"]="XMLHttpRequest");var a=new OpenLayers.Request.XMLHttpRequest,r=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));r=OpenLayers.Request.makeSameOrigin(r,e.proxy),a.open(e.method,r,e.async,e.user,e.password);for(var s in e.headers)a.setRequestHeader(s,e.headers[s]);var o=this.events,l=this;return a.onreadystatechange=function(){if(a.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=o.triggerEvent("complete",{request:a,config:e,requestUrl:r});t!==!1&&l.runCallbacks({request:a,config:e,requestUrl:r})}},e.async===!1?a.send(e.data):window.setTimeout(function(){0!==a.readyState&&a.send(e.data)},0),a},runCallbacks:function(e){var t,i=e.request,n=e.config,a=n.scope?OpenLayers.Function.bind(n.callback,n.scope):n.callback;n.success&&(t=n.scope?OpenLayers.Function.bind(n.success,n.scope):n.success);var r;n.failure&&(r=n.scope?OpenLayers.Function.bind(n.failure,n.scope):n.failure),"file:"==OpenLayers.Util.createUrlObject(n.url).protocol&&i.responseText&&(i.status=200),a(i),(!i.status||i.status>=200&&i.status<300)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(i.status<200||i.status>=300)&&(this.events.triggerEvent("failure",e),r&&r(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}}),function(){function e(){this._object=o&&!c?new o:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){if(e._object.send(e._data),l&&!e._async)for(e.readyState=t.OPENED,r(e);e.readyState<t.DONE;)if(e.readyState++,n(e),e._aborted)return}function n(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function a(e){var t=e.responseXML,i=e.responseText;return u&&i&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(i)),t&&(u&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function r(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=a(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function s(e){e._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,l=!!window.controllers,u=window.document.all&&!window.opera,c=u&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,l&&o.wrapped&&(t.wrapped=o.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,i,a,o,c){delete this._headers,arguments.length<3&&(a=!0),this._async=a;var d,h=this,p=this.readyState;u&&a&&(d=function(){p!=t.DONE&&(s(h),h.abort())},window.attachEvent("onunload",d)),t.onopen&&t.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,i,a,o,c):arguments.length>3?this._object.open(e,i,a,o):this._object.open(e,i,a),this.readyState=t.OPENED,n(this),this._object.onreadystatechange=function(){if(!l||a){if(h.readyState=h._object.readyState,r(h),h._aborted)return void(h.readyState=t.UNSENT);h.readyState==t.DONE&&(delete h._data,s(h),u&&a&&window.detachEvent("onunload",d)),p!=h.readyState&&n(h),p=h.readyState}}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,i(this)},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),s(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var n,a=0;n=this._listeners[a];a++)if(n[0]==e&&n[1]==t&&n[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var n,a=0;(n=this._listeners[a])&&(n[0]!=e||n[1]!=t||n[2]!=i);a++);n&&this._listeners.splice(a,1)},t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,n=0;i=this._listeners[n];n++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),"object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var n=this.getCode(),a=t.getCode();i=n==a||!!OpenLayers.Projection.transforms[n]&&OpenLayers.Projection.transforms[n][a]===OpenLayers.Projection.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var n=OpenLayers.Projection.defaults[e];n&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=n)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){if(t&&i)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),i instanceof OpenLayers.Projection||(i=new OpenLayers.Projection(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var n=t.getCode(),a=i.getCode(),r=OpenLayers.Projection.transforms;r[n]&&r[n][a]&&r[n][a](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/a,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/a*Math.PI))-Math.PI/2),e}function t(e){e.x=e.x*a/180;var t=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*a;return e.y=Math.max(-20037508.34,Math.min(t,20037508.34)),e}function i(i,n){var a,r,s,o,l,u=OpenLayers.Projection.addTransform,c=OpenLayers.Projection.nullTransform;for(a=0,r=n.length;r>a;++a)for(s=n[a],u(i,s,t),u(s,i,e),l=a+1;r>l;++l)o=n[l],u(s,o,c),u(o,s,c)}var n,a=20037508.34,r=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(n=r.length-1;n>=0;--n)i(r[n],s);for(n=s.length-1;n>=0;--n)i(s[n],r)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(t=e,e=t&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t);
var i=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[i]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var n=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(n,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),n=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(n),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var a=!0,r=document.getElementsByTagName("link"),s=0,o=r.length;o>s;++s)if(OpenLayers.Util.isEquivalentUrl(r.item(s).href,this.theme)){a=!1;break}if(a){var l=document.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(l)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var s=0,o=this.controls.length;o>s;s++)this.addControlToMap(this.controls[s]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,delete this.zoom,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var n="function"==typeof i.test,a=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||n&&i.test(e[t])});return a},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,n=this.layers.length;n>i;i++){var a=this.layers[i];if(a.id==e){t=a;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;t>e;e++){var i=this.layers[e];this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;i>t;t++)if(this.layers[t]==e)return!1;return this.events.triggerEvent("preaddlayer",{layer:e})===!1?!1:(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,i=e.length;i>t;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,n=this.layers.length;n>i;i++){var a=this.layers[i];if(a.isBaseLayer||this.allOverlays){this.setBaseLayer(a);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(0>t?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var n=0,a=this.layers.length;a>n;n++)this.setLayerZIndex(this.layers[n],n);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=t){var n=this.getZoomForResolution(i||this.resolution,!0);this.setCenter(t,n,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,n=0,a=e.length;a>n;n++){var r=e[n],s=i[n]?i[n]:null;this.addControl(r,s)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&(e.outsideViewport||(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i))),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,n=this.controls.length;n>i;i++){var a=this.controls[i];if(a.id==e){t=a;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e);var n=e.draw();n&&(n.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(n))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){this.size=e;for(var i=0,n=this.layers.length;n>i;i++)this.layers[i].onMapResize();var a=this.getCachedCenter();if(null!=this.baseLayer&&null!=a){var r=this.getZoom();this.zoom=null,this.setCenter(a,r)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t){var n=this.size.w*t/2,a=this.size.h*t/2;i=new OpenLayers.Bounds(e.lon-n,e.lat-a,e.lon+n,e.lat+a)}return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)(0!=e||0!=t)&&this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter()),a=n.add(e,t);if(this.dragging||!a.equals(n)){var r=this.getLonLatFromViewPortPx(a);i.animate?this.panTo(r):(this.moveTo(r),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(e.equals(t))return;var i=this.getPixelFromLonLat(t),n=this.getPixelFromLonLat(e),a={x:n.x-i.x,y:n.y-i.y},r={x:0,y:0};this.panTween.start({x:0,y:0},a,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-r.x,i=e.y-r.y;this.moveByPx(t,i),r.x=Math.round(e.x),r.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,i,n){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:n})},moveByPx:function(e,t){var i=this.size.w/2,n=this.size.h/2,a=i+e,r=n+t,s=this.baseLayer.wrapDateLine,o=0,l=0;if(this.restrictedExtent&&(o=i,l=n,s=!1),e=s||a<=this.maxPx.x-o&&a>=this.minPx.x+o?Math.round(e):0,t=r<=this.maxPx.y-l&&r>=this.minPx.y+l?Math.round(t):0,e||t){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerOriginPx.x-=e,this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerOriginPx.y-=t,this.minPx.y-=t,this.maxPx.y-=t),this.applyTransform();var u,c,d;for(c=0,d=this.layers.length;d>c;++c)u=this.layers[c],u.visibility&&(u===this.baseLayer||u.inRange)&&(u.moveByPx(e,t),u.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,i=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>i)if(this.fractionalZoom)e=this.getZoomForResolution(i);else for(var n=0|e,a=t.length;a>n;++n)if(t[n]<=i){e=n;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,i){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e)),i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var n=t;t=this.adjustZoom(t),t!==n&&(e=this.getCenter());var a=i.dragging||this.dragging,r=i.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var s=this.getResolutionForZoom(t),o=this.calculateBounds(e,s);if(!this.restrictedExtent.containsBounds(o)){var l=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(l.lon,e.lat):o.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-o.right,0)),o.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,l.lat):o.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-o.top))}}var u=r||this.isValidZoomLevel(t)&&t!=this.getZoom(),c=this.isValidLonLat(e)&&!e.equals(this.center);if(u||c||a){a||this.events.triggerEvent("movestart",{zoomChanged:u}),c&&(!u&&this.center&&this.centerLayerContainer(e),this.center=e.clone());var d=u?this.getResolutionForZoom(t):this.getResolution();if(u||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var h=this.getMaxExtent({restricted:!0}),p=h.getCenterLonLat(),f=this.center.lon-p.lon,m=p.lat-this.center.lat,g=Math.round(h.getWidth()/d),v=Math.round(h.getHeight()/d);this.minPx={x:(this.size.w-g)/2-f/d,y:(this.size.h-v)/2-m/d},this.maxPx={x:this.minPx.x+Math.round(h.getWidth()/d),y:this.minPx.y+Math.round(h.getHeight()/d)}}u&&(this.zoom=t,this.resolution=d);var y=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(y,u,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:u})),y=this.baseLayer.getExtent();for(var b=this.layers.length-1;b>=0;--b){var k=this.layers[b];if(k!==this.baseLayer&&!k.isBaseLayer){var _=k.calculateInRange();k.inRange!=_&&(k.inRange=_,_||k.display(!1),this.events.triggerEvent("changelayer",{layer:k,property:"visibility"})),_&&k.visibility&&(k.moveTo(y,u,i.dragging),i.dragging||k.events.triggerEvent("moveend",{zoomChanged:u}))}}if(this.events.triggerEvent("move"),a||this.events.triggerEvent("moveend"),u){for(var b=0,w=this.popups.length;w>b;b++)this.popups[b].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var n=this.layerContainerOriginPx.x,a=this.layerContainerOriginPx.y,r=Math.round(t.x-i.x),s=Math.round(t.y-i.y);this.applyTransform(this.layerContainerOriginPx.x=r,this.layerContainerOriginPx.y=s);var o=n-r,l=a-s;this.minPx.x-=o,this.maxPx.x-=o,this.minPx.y-=l,this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var i=this.getMaxExtent(),n=this.baseLayer.wrapDateLine&&i;t=i.containsLonLat(e,{worldBounds:n})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e,t){var i=this;if(i.isValidZoomLevel(e))if(i.baseLayer.wrapDateLine&&(e=i.adjustZoom(e)),i.zoomTween){var n=i.getResolution(),a=i.getResolutionForZoom(e),r={scale:1},s={scale:n/a};if(i.zoomTween.playing&&i.zoomTween.duration<3*i.zoomDuration)i.zoomTween.finish={scale:i.zoomTween.finish.scale*s.scale};else{if(!t){var o=i.getSize();t={x:o.w/2,y:o.h/2}}i.zoomTween.start(r,s,i.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var n=i.layerContainerOriginPx,a=e.scale,r=(a-1)*(n.x-t.x)|0,s=(a-1)*(n.y-t.y)|0;i.applyTransform(n.x+r,n.y+s,a)},done:function(e){i.applyTransform();var n=i.getResolution()/e.scale,a=i.getZoomForResolution(n,!0);i.moveTo(i.getZoomTargetCenter(t,n),a,!0)}}})}}else{var l=t?i.getZoomTargetCenter(t,i.getResolutionForZoom(e)):null;i.setCenter(l,e)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var n=this.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=n.getWidth();i=e.getCenterLonLat().wrapDateLine(n)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=e?e.restricted:!0,i=this.getMaxExtent({restricted:t});this.zoomToExtent(i)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.size.w*i/2,a=this.size.h*i/2,r=this.getCachedCenter(),s=new OpenLayers.Bounds(r.lon-n,r.lat-a,r.lon+n,r.lat+a);this.zoomToExtent(s,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getZoomTargetCenter:function(e,t){var i=null,n=this.getSize(),a=n.w/2-e.x,r=e.y-n.h/2,s=this.getLonLatFromPixel(e);return s&&(i=new OpenLayers.LonLat(s.lon+a*t,s.lat+r*t)),i},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),n=t.add(-i/2,0),a=t.add(i/2,0),r=t.add(0,-i/2),s=t.add(0,i/2),o=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||o;return l.equals(o)||(n.transform(l,o),a.transform(l,o),r.transform(l,o),s.transform(l,o)),new OpenLayers.Size(OpenLayers.Util.distVincenty(n,a),OpenLayers.Util.distVincenty(r,s))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var i=this.layerContainerOriginPx.x,n=this.layerContainerOriginPx.y;t=e.add(i,n)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var i=-this.layerContainerOriginPx.x,n=-this.layerContainerOriginPx.y;t=e.add(i,n),(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,i){i=i||1;var n=this.layerContainerOriginPx,a=1!==i;e=e||n.x,t=t||n.y;var r=this.layerContainerDiv.style,s=this.applyTransform.transform,o=this.applyTransform.template;if(void 0===s&&(s=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=s,s)){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));l&&"none"===l||(o=["translate3d(",",0) ","scale3d(",",1)"],r[s]=[o[0],"0,0",o[1]].join("")),o&&~r[s].indexOf(o[0])||(o=["translate(",") ","scale(",")"]),this.applyTransform.template=o}null===s||"translate3d("!==o[0]&&a!==!0?(r.left=e+"px",r.top=t+"px",null!==s&&(r[s]="")):(a===!0&&"translate("===o[0]&&(e-=n.x,t-=n.y,r.left=n.x+"px",r.top=n.y+"px"),r[s]=[o[0],e,"px,",t,"px",o[1],o[2],i,",",i,o[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={},t=OpenLayers.Util.extend({},t),null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange),this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),e&&("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.map.getResolution(),n=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var a in e)if(e.hasOwnProperty(a)&&OpenLayers.Util.indexOf(n,a)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0}}return e},moveTo:function(){var e=this.visibility;this.isBaseLayer||(e=e&&this.inRange),this.display(e)},moveByPx:function(){},setMap:function(e){if(null==this.map){if(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t,this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,n={},a=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=this.options[i],a&&this.options[i]&&(a=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=a),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=null!=this.options[i]?this.options[i]:this.map[i];null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var r;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(r=this.options.maxResolution),this.options.minScale&&(r=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var s;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution),this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort(function(e,t){return t-e}),r||(r=n.resolutions[0]),!s)){var o=n.resolutions.length-1;s=n.resolutions[o]}if(this.resolutions=n.resolutions,this.resolutions){for(t=this.resolutions.length,this.scales=new Array(t),e=0;t>e;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=s,s&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units)),this.maxResolution=r,r&&(this.minScale=OpenLayers.Util.getScaleFromResolution(r,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,n;for(n=e.length,t=new Array(n),i=0;n>i;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,n,a=e.maxResolution;null!=e.minScale?a=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==a&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,n=this.maxExtent.getHeight()/t.h,a=Math.max(i,n));var r=e.minResolution;if(null!=e.maxScale?r=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,n=this.minExtent.getHeight()/t.h,r=Math.max(i,n)),"number"!=typeof a&&"number"!=typeof r&&null!=this.maxExtent){var s=this.map.getTileSize();a=Math.max(this.maxExtent.getWidth()/s.w,this.maxExtent.getHeight()/s.h)}var o=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof r&&"number"==typeof a&&void 0===l){var u=a/r;l=Math.floor(Math.log(u)/Math.log(2))+1}else void 0===l&&null!=o&&(l=o+1);if(!("number"!=typeof l||0>=l||"number"!=typeof a&&"number"!=typeof r)){var c=new Array(l),d=2;"number"==typeof r&&"number"==typeof a&&(d=Math.pow(a/r,1/(l-1)));var h;if("number"==typeof a)for(h=0;l>h;h++)c[h]=a/Math.pow(d,h);else for(h=0;l>h;h++)c[l-1-h]=r*Math.pow(d,h);return c}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),n=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(n,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e),n=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[n])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var i,n,a;if(this.map.fractionalZoom){var r,s=0,o=this.resolutions.length-1,l=this.resolutions[s],u=this.resolutions[o];for(n=0,a=this.resolutions.length;a>n;++n)if(r=this.resolutions[n],r>=e&&(l=r,s=n),e>=r){u=r,o=n;break}var c=l-u;i=c>0?s+(l-e)/c:s}else{var d,h=Number.POSITIVE_INFINITY;for(n=0,a=this.resolutions.length;a>n;n++)if(t){if(d=Math.abs(this.resolutions[n]-e),d>h)break;h=d}else if(this.resolutions[n]<e)break;i=Math.max(0,n-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var n=i.getResolution(),a=i.getMaxExtent({restricted:!0}),r=(e.x-i.minPx.x)*n+a.left,s=(i.minPx.y-e.y)*n+a.top;t=new OpenLayers.LonLat(r,s),this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var i=null;if(null!=e){t=t||this.map.getResolution();var n=this.map.calculateBounds(null,t);i=new OpenLayers.Pixel(1/t*(e.lon-n.left),1/t*(n.top-e.lat))}return i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,i=0,n=t.length;n>i;++i){var a=t[i].firstChild||t[i],r=t[i].lastChild;r&&"iframe"===r.nodeName.toLowerCase()&&(a=r.parentNode),OpenLayers.Util.modifyDOMElement(a,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,n){this.url=e,this.size=t||{w:20,h:20},this.offset=i||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=n;
var a=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(a)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var i=t?t:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=i:(this.icon.url=i.url,this.icon.size=i.size,this.icon.offset=i.offset,this.icon.calculateOffset=i.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e),this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){var e=this.icon&&this.icon.isDrawn();return e},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,i,n,a,r){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=n&&(this.contentHTML=n),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var s=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(s,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),a&&this.addCloseBox(r),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");"hidden"!=t&&(this.contentDiv._oldOverflow=t,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,n=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv){var a=parseInt(this.closeDiv.style.width);i+=a+t.right}this.size.w+=i,this.size.h+=n,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),n=this.getSafeContentSize(i),a=null;if(n.equals(i))a=i;else{var r={w:n.w<i.w?n.w:null,h:n.h<i.h?n.h:null};if(r.w&&r.h)a=n;else{var s=OpenLayers.Util.getRenderedDimensions(e,r,{displayClass:this.contentDisplayClass,containerElement:t}),o=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=o&&s.equals(n)){var l=OpenLayers.Util.getScrollbarWidth();r.w?s.h+=l:s.w+=l}a=this.getSafeContentSize(s)}}this.setSize(a)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),i=0,n=t.length;n>i;i++){var a=t[i];if(0==a.width||0==a.height){var r={popup:this,img:a};a._onImgLoad=OpenLayers.Function.bind(e,r),OpenLayers.Event.observe(a,"load",a._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),i=this.getContentDivPadding(),n=i.left+i.right,a=i.top+i.bottom;if(this.fixPadding(),n+=this.padding.left+this.padding.right,a+=this.padding.top+this.padding.bottom,this.closeDiv){var r=parseInt(this.closeDiv.style.width);n+=r+i.right}if(this.minSize&&(t.w=Math.max(t.w,this.minSize.w-n),t.h=Math.max(t.h,this.minSize.h-a)),this.maxSize&&(t.w=Math.min(t.w,this.maxSize.w-n),t.h=Math.min(t.h,this.maxSize.h-a)),this.map&&this.map.size){var s=0,o=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":s=l.x,o=this.map.size.h-l.y;break;case"tl":s=this.map.size.w-l.x,o=this.map.size.h-l.y;break;case"bl":s=this.map.size.w-l.x,o=l.y;break;case"br":s=l.x,o=l.y;break;default:s=l.x,o=this.map.size.h-l.y}}var u=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-a-o,c=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-n-s;t.w=Math.min(t.w,c),t.h=Math.min(t.h,u)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=e,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv);var i=e||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(i,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(i,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var n=t.x-i.x,a=t.y-i.y;this.map.pan(n,a)},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,n,a,r){this.layer=e,this.position=t.clone(),this.setBounds(i),this.url=n,a&&(this.size=a.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,r),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&this.events.triggerEvent("beforedraw")===!1&&(t=null),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var i=this.layer.map,n=i.baseLayer.wrapDateLine&&i.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:n})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},moveTo:function(e,t,i){null==i&&(i=!0),this.setBounds(e),this.position=t.clone(),i&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,n){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=n,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):e===!1&&this.unload(),e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top=this.position.y+"px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),this.layerAlphaHack===!0&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,i=0;this.layer.gutter&&(t=this.layer.gutter/this.layer.tileSize.w*100,i=this.layer.gutter/this.layer.tileSize.h*100),e.left=-t+"%",e.top=-i+"%",e.width=2*t+100+"%",e.height=2*i+100+"%"}e.visibility="hidden",e.opacity=0,this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(e){var t=this.imgDiv;e?(t.style.visibility="hidden",t.style.opacity=0,this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e):(this.stopLoading(),this.imgDiv=null,t.parentNode&&t.parentNode.removeChild(t))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading(),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;return e.className="olTileImage",e.galleryImg="no",e}(),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(e,t,i,n,a){this.url=t,this.extent=i,this.maxExtent=i,this.size=n,OpenLayers.Layer.prototype.initialize.apply(this,[e,a]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setMap:function(){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(e,t){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var i=null==this.tile;if(t||i){this.setTileSize();var n=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});i?(this.tile=new OpenLayers.Tile.Image(this,n,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=n.clone()),this.tile.draw()}},setTileSize:function(){var e=this.extent.getWidth()/this.map.getResolution(),t=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(e,t)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this.events.triggerEvent("loadstart")},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},setUrl:function(e){this.url=e,this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},i))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,n=0,a=e.length;a>n;n++)i*=e.charCodeAt(n)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var a=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(a,i));var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var s in n)s.toUpperCase()in r&&delete n[s];return a=OpenLayers.Util.getParameterString(n),OpenLayers.Util.urlAppend(i,a)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],n=0,a=i.length;a>n;n++){var r=i[n];this.destroyTile(r)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(e){var t=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&t&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.loading=!1,e.numLoadingTiles=0,e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){{var n=!this.grid.length||t,a=this.getTilesBounds(),r=this.map.getResolution();this.getServerResolution(r)}this.singleTile?(n||!i&&!a.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(r),this.initSingleTile(e)):(n=n||!a.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),n?(!t||"resize"!==this.transitionEffect&&this.gridResolution!==r||this.applyBackBuffer(r),this.initGriddedTiles(e)):this.moveGriddedTiles())}},getTileData:function(e){var t=null,i=e.lon,n=e.lat,a=this.grid.length;if(this.map&&a){var r=this.map.getResolution(),s=this.tileSize.w,o=this.tileSize.h,l=this.grid[0][0].bounds,u=l.left,c=l.top;if(u>i&&this.map.baseLayer.wrapDateLine){var d=this.map.getMaxExtent().getWidth(),h=Math.ceil((u-i)/d);i+=d*h}var p=(i-u)/(r*s),f=(c-n)/(r*o),m=Math.floor(p),g=Math.floor(f);if(g>=0&&a>g){var v=this.grid[g][m];v&&(t={tile:v,i:Math.floor((p-m)*s),j:Math.floor((f-g)*o)})}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;if(e=e||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var i,n,a,r;for(i=this.serverResolutions.length-1;i>=0&&(a=this.serverResolutions[i],n=Math.abs(a-e),!(n>t));i--)t=n,r=a;e=r}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div),this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top},this.backBufferResolution=this.gridResolution}for(var n,a=this.backBufferResolution/e,r=t.childNodes,s=r.length-1;s>=0;--s)n=r[s],n.style.top=(a*n._i*n._h|0)+"px",n.style.left=(a*n._j*n._w|0)+"px",n.style.width=Math.round(a*n._w)+"px",n.style.height=Math.round(a*n._h)+"px";var o=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,u=this.map.layerContainerOriginPx.y;t.style.left=Math.round(o.x-l)+"px",t.style.top=Math.round(o.y-u)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var i=0,n=this.grid.length;n>i;i++)for(var a=0,r=this.grid[i].length;r>a;a++){var s=this.grid[i][a],o=this.grid[i][a].createBackBuffer();o&&(o._i=i,o._j=a,o._w=s.size.w,o._h=s.size.h,o.id=s.id+"_bb",e.appendChild(o))}}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio,10),e.w=parseInt(e.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var i=this.grid[t-1][0].bounds,n=this.grid[0].length*i.getWidth(),a=this.grid.length*i.getHeight();e=new OpenLayers.Bounds(i.left,i.bottom,i.left+n,i.bottom+a)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio,a=new OpenLayers.Bounds(t.lon-i/2,t.lat-n/2,t.lon+i/2,t.lat+n/2),r=this.map.getLayerPxFromLonLat({lon:a.left,lat:a.top});this.grid.length||(this.grid[0]=[]);var s=this.grid[0][0];s?s.moveTo(a,r):(s=this.addTile(a,r),this.addTileMonitoringHooks(s),s.draw(),this.grid[0][0]=s),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.lon,s=Math.floor(r/n)-this.buffer,o=this.rowSign,l=o*(t.lat-e.top+a),u=Math[~o?"floor":"ceil"](l/a)-this.buffer*o;return{tilelon:n,tilelat:a,startcol:s,startrow:u}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},getTileBoundsForGridIndex:function(e,t){var i=this.getTileOrigin(),n=this.gridLayout,a=n.tilelon,r=n.tilelat,s=n.startcol,o=n.startrow,l=this.rowSign;return new OpenLayers.Bounds(i.lon+(s+t)*a,i.lat-(o+e*l)*r*l,i.lon+(s+t+1)*a,i.lat-(o+(e-1)*l)*r*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),i=this.getTileOrigin(),n=this.map.getResolution(),a=this.getServerResolution(),r=n/a,s={w:this.tileSize.w/r,h:this.tileSize.h/r},o=Math.ceil(t.h/s.h)+2*this.buffer+1,l=Math.ceil(t.w/s.w)+2*this.buffer+1,u=this.calculateGridLayout(e,i,a);this.gridLayout=u;var c=u.tilelon,d=u.tilelat,h=this.map.layerContainerOriginPx.x,p=this.map.layerContainerOriginPx.y,f=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(f.left,f.top));m.x=Math.round(m.x)-h,m.y=Math.round(m.y)-p;var g=[],v=this.map.getCenter(),y=0;do{var b=this.grid[y];b||(b=[],this.grid.push(b));var k=0;do{f=this.getTileBoundsForGridIndex(y,k);var _=m.clone();_.x=_.x+k*Math.round(s.w),_.y=_.y+y*Math.round(s.h);var w=b[k];w?w.moveTo(f,_,!1):(w=this.addTile(f,_),this.addTileMonitoringHooks(w),b.push(w));var L=f.getCenterLonLat();g.push({tile:w,distance:Math.pow(L.lon-v.lon,2)+Math.pow(L.lat-v.lat,2)}),k+=1}while(f.right<=e.right+c*this.buffer||l>k);y+=1}while(f.bottom>=e.bottom-d*this.buffer||o>y);this.removeExcessTiles(y,k);var n=this.getServerResolution();this.gridResolution=n,g.sort(function(e,t){return e.distance-t.distance});for(var x=0,S=g.length;S>x;++x)g[x].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:i}),i},addTileMonitoringHooks:function(e){var t="olTileReplacing";e.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),t)},e.onLoadEnd=function(i){this.numLoadingTiles--;var n="unload"===i.type;if(this.events.triggerEvent("tileloaded",{tile:e,aborted:n}),!this.singleTile&&!n&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var a=e.getTile();if("none"===OpenLayers.Element.getStyle(a,"display")){var r=document.getElementById(e.id+"_bb");
r&&r.parentNode.removeChild(r)}OpenLayers.Element.removeClass(a,t)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=n?this.div.lastChild:e.imgDiv;for(var s=this.transitionendEvents,o=s.length-1;o>=0;--o)OpenLayers.Event.observe(this._transitionElement,s[o],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],i={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},n=this.getServerResolution()/this.map.getResolution(),a={w:Math.round(this.tileSize.w*n),h:Math.round(this.tileSize.h*n)};if(i.x>-a.w*(e-1))this.shiftColumn(!0,a);else if(i.x<-a.w*e)this.shiftColumn(!1,a);else if(i.y>-a.h*(e-1))this.shiftRow(!0,a);else{if(!(i.y<-a.h*e))break;this.shiftRow(!1,a)}}},shiftRow:function(e,t){var i=this.grid,n=e?0:i.length-1,a=e?-1:1,r=this.rowSign,s=this.gridLayout;s.startrow+=a*r;for(var o=i[n],l=i[e?"pop":"shift"](),u=0,c=l.length;c>u;u++){var d=l[u],h=o[u].position.clone();h.y+=t.h*a,d.moveTo(this.getTileBoundsForGridIndex(n,u),h)}i[e?"unshift":"push"](l)},shiftColumn:function(e,t){var i=this.grid,n=e?0:i[0].length-1,a=e?-1:1,r=this.gridLayout;r.startcol+=a;for(var s=0,o=i.length;o>s;s++){var l=i[s],u=l[n].position.clone(),c=l[e?"pop":"shift"]();u.x+=t.w*a,c.moveTo(this.getTileBoundsForGridIndex(s,n),u),l[e?"unshift":"push"](c)}},removeExcessTiles:function(e,t){for(var i,n;this.grid.length>e;){var a=this.grid.pop();for(i=0,n=a.length;n>i;i++){var r=a[i];this.destroyTile(r)}}for(i=0,n=this.grid.length;n>i;i++)for(;this.grid[i].length>t;){var a=this.grid[i],r=a.pop();this.destroyTile(r)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),n=i*this.tileSize.w,a=i*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),s=t.left+n*Math.floor((r.lon-t.left)/n),o=t.bottom+a*Math.floor((r.lat-t.bottom)/a);return new OpenLayers.Bounds(s,o,s+n,o+a)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.markers.length;i>t;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var i=0,n=this.markers.length;n>i;i++)this.drawMarker(this.markers[i]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),this.opacity<1&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var i=e.draw(t);this.div.appendChild(i)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,i=this.markers.length;i>t;t++){var n=this.markers[t];e.extend(n.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,i,n){var a=[];i=OpenLayers.Util.upperCaseObject(i),parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),a.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=n&&n.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),i={},n=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,n):e.toArray(n),i.WIDTH=t.w,i.HEIGHT=t.h;var a=this.getFullRequestString(i);return a},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e){var t=this.map.getProjectionObject(),i=this.projection&&this.projection.equals(t)?this.projection.getCode():t.getCode(),n="none"==i?null:i;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=n:this.params.SRS=n,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var i in t)if(!(i in e))throw new Error("Missing property '"+i+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var n=[e.name,e.url,e.params,e];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,n),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var a=this.matrixIds.length;if(a&&"string"==typeof this.matrixIds[0]){var r=this.matrixIds;this.matrixIds=new Array(a);for(var s=0;a>s;++s)this.matrixIds[s]={identifier:r[s]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t){return(t||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,i=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,n=Number.POSITIVE_INFINITY,a=0,r=this.matrixIds.length;r>a;++a)t=Math.abs(1-this.matrixIds[a].scaleDenominator/i),n>t&&(n=t,e=this.matrixIds[a]);else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()};return e},getTileInfo:function(e){var t=this.getServerResolution(),i=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),n=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),a=Math.floor(i),r=Math.floor(n);return{col:a,row:r,i:Math.floor((i-a)*this.tileSize.w),j:Math.floor((n-r)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var i,n=e.getCenterLonLat(),a=this.getTileInfo(n),r=(this.matrix.identifier,this.dimensions);if(t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,a.row,a.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(i=this.params,-1!==t.indexOf("{")){var s=t.replace(/\{/g,"${"),o={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:a.row,TileCol:a.col};if(r){var l,u;for(u=r.length-1;u>=0;--u)l=r[u],o[l]=i[l.toUpperCase()]}t=OpenLayers.String.format(s,o)}else{var c=this.version+"/"+this.layer+"/"+this.style+"/";if(r)for(var u=0;u<r.length;u++)i[r[u]]&&(c=c+i[r[u]]+"/");c=c+this.matrixSet+"/"+this.matrix.identifier+"/"+a.row+"/"+a.col+"."+this.formatSuffix,t.match(/\/$/)||(t+="/"),t+=c}else"KVP"===this.requestEncoding.toUpperCase()&&(i={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:a.row,TILECOL:a.col,FORMAT:this.format},t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[i]))}return t},mergeNewParams:function(e){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},i)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},i])},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var n=""+t.x+t.y+t.z;i=this.selectUrl(n,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.getServerResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),n=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),a=this.getServerZoom();if(this.wrapDateLine){var r=Math.pow(2,a);i=(i%r+r)%r}return{x:i,y:n,z:a}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var e=this.layerInfo,t=new OpenLayers.Bounds(e.fullExtent.xmin,e.fullExtent.ymin,e.fullExtent.xmax,e.fullExtent.ymax);if(this.projection="EPSG:"+e.spatialReference.wkid,this.sphericalMercator=102100==e.spatialReference.wkid,this.units="esriFeet"==e.units?"ft":"m",e.tileInfo){this.tileSize=new OpenLayers.Size(e.tileInfo.width||e.tileInfo.cols,e.tileInfo.height||e.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(e.tileInfo.origin.x,e.tileInfo.origin.y);var i=new OpenLayers.Geometry.Point(t.left,t.top),n=new OpenLayers.Geometry.Point(t.right,t.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var a in e.tileInfo.lods)if(e.tileInfo.lods.hasOwnProperty(a)){var r=e.tileInfo.lods[a];this.useScales?this.scales.push(r.scale):this.resolutions.push(r.resolution);var s=this.getContainingTileCoords(i,r.resolution);r.startTileCol=s.x,r.startTileRow=s.y;var o=this.getContainingTileCoords(n,r.resolution);r.endTileCol=o.x,r.endTileRow=o.y,this.lods.push(r)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&e.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=e.tileInfo.dpi)}}},getContainingTileCoords:function(e,t){return new OpenLayers.Pixel(Math.max(Math.floor((e.x-this.tileOrigin.lon)/(this.tileSize.w*t)),0),Math.max(Math.floor((this.tileOrigin.lat-e.y)/(this.tileSize.h*t)),0))},calculateMaxExtentWithLOD:function(e){var t=e.endTileCol-e.startTileCol+1,i=e.endTileRow-e.startTileRow+1,n=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,a=n+t*this.tileSize.w*e.resolution,r=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution,s=r-i*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(n,s,a,r)},calculateMaxExtentWithExtent:function(e,t){var i=new OpenLayers.Geometry.Point(e.left,e.top),n=new OpenLayers.Geometry.Point(e.right,e.bottom),a=this.getContainingTileCoords(i,t),r=this.getContainingTileCoords(n,t),s={resolution:t,startTileCol:a.x,startTileRow:a.y,endTileCol:r.x,endTileRow:r.y};return this.calculateMaxExtentWithLOD(s)},getUpperLeftTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(t,e)},getLowerRightTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(t,e)},getMaxExtentForResolution:function(e){var t=this.getUpperLeftTileCoord(e),i=this.getLowerRightTileCoord(e),n=i.x-t.x+1,a=i.y-t.y+1,r=this.tileOrigin.lon+t.x*this.tileSize.w*e,s=r+n*this.tileSize.w*e,o=this.tileOrigin.lat-t.y*this.tileSize.h*e,l=o-a*this.tileSize.h*e;return new OpenLayers.Bounds(r,l,s,o)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},initGriddedTiles:function(){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var e=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(e)},getTileOrigin:function(){if(!this._tileOrigin){var e=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(e.left,e.bottom)}return this._tileOrigin},getURL:function(e){var t=this.getResolution(),i=this.tileOrigin.lon+t*this.tileSize.w/2,n=this.tileOrigin.lat-t*this.tileSize.h/2,a=e.getCenterLonLat(),r=({x:a.lon,y:a.lat},Math.round(Math.abs((a.lon-i)/(t*this.tileSize.w)))),s=Math.round(Math.abs((n-a.lat)/(t*this.tileSize.h))),o=this.map.getZoom();if(this.lods){var l=this.lods[this.map.getZoom()];if(r<l.startTileCol||r>l.endTileCol||s<l.startTileRow||s>l.endTileRow)return null}else{var u=this.getUpperLeftTileCoord(t),c=this.getLowerRightTileCoord(t);if(r<u.x||r>=c.x||s<u.y||s>=c.y)return null}var d=this.url,h=""+r+s+o;return OpenLayers.Util.isArray(d)&&(d=this.selectUrl(h,d)),this.useArcGISServer?d+="/tile/${z}/${y}/${x}":(r="C"+OpenLayers.Number.zeroPad(r,8,16),s="R"+OpenLayers.Number.zeroPad(s,8,16),o="L"+OpenLayers.Number.zeroPad(o,2,10),d=d+"/${z}/${y}/${x}."+this.type),d=OpenLayers.String.format(d,{x:r,y:s,z:o}),OpenLayers.Util.urlAppend(d,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,i=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var n=this.geometry.getBounds();t=i.intersectsBounds(n)}else{var a=i.toGeometry();t=a.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var n=!1;return this.geometry&&(n=this.geometry.atPoint(e,t,i)),n},destroyPopup:function(){},move:function(e){if(!this.layer||!this.geometry.move)return void 0;var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),n=this.layer.map.getResolution();return this.geometry.move(n*(t.x-i.x),n*(i.y-t.y)),this.layer.drawFeature(this),i},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t;var n=this.map||e.map;n&&this.setMap(n),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],t=0,i=e.length;i>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.startTouch(),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),i=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(i,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this["double"]&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy),t&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,n=this.down.touches.length;n>i;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(){var e=!0;return this.down&&this.first&&(e=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),e},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=new Array(i);for(var n,a=0;i>a;a++)n=e.touches[a],t[a]={clientX:n.olClientX,clientY:n.olClientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){return this.passesTolerance(e.xy)&&(this.clearTimer(),this.callback("move",[e]),this.px=e.xy,e=OpenLayers.Util.extend({},e),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)),!this.stopMove},mouseout:function(e){return OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[e])),!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));i<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),e=!0),e},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0):!1},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(t,[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.startTouch(),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(e)?this.lastUp&&this.lastUp.equals(e.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var n=!0;if(null!=i&&e&&t){var a=e.distanceTo(t);a>i&&(n=!1)}return n},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);
this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1,n=this.line.geometry.components[i];!n||isNaN(n.x)||isNaN(n.y)||this.insertXY(n.x+e,n.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var i=t*Math.cos(e),n=t*Math.sin(e);this.insertDeltaXY(i,n)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var n=this.line.geometry.components[i],a=this.line.geometry.components[i-1],r=Math.atan2(n.y-a.y,n.x-a.x);this.insertDirectionLength(180*r/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,n=t[i],a=e.removeComponent(n);if(a){if(this.touch&&i>0){t=e.components;var r=t[i-1],s=this.getCurrentPointIndex(),o=t[s];o.x=r.x,o.y=r.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(n),this.drawFeature()}return a},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var e,t,i=this.point.geometry,n=this.control.layer.features,a=n.length-1;a>=0;--a)if(e=n[a].geometry,(e instanceof OpenLayers.Geometry.Polygon||e instanceof OpenLayers.Geometry.MultiPolygon)&&e.intersects(i)){t=n[a],this.control.layer.removeFeatures([t],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),t.geometry.addComponent(this.line.geometry),this.polygon=t,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,i=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var n=i[i.length-3];t.x=n.x,t.y=n.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,n=i.length-2;n>=0;--n)if(e.intersects(i[n])){t=!1;break}if(t){e:for(var n=i.length-2;n>0;--n)for(var a=i[n].components,r=0,s=a.length;s>r;++r)if(e.containsPoint(a[r])){t=!1;break e}}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,n]),this.layer=t},touchstart:function(e){return this.startTouch(),OpenLayers.Event.isMultiTouch(e)?!0:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),this.handle(e)?!this.stopDown:!0},mouseup:function(e){return this.up=e.xy,this.handle(e)?!this.stopUp:!0},click:function(e){return this.handle(e)?!this.stopClick:!0},mousemove:function(e){return this.callbacks.over||this.callbacks.out?(this.handle(e),!0):!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,n=!!this.feature,a="click"==t||"dblclick"==t||"touchstart"==t;if(this.feature=this.layer.getFeatureFromEvent(e),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===t&&OpenLayers.Event.preventDefault(e);var r=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(n&&r?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):(!n||a)&&this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(n&&r||a)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(n||a)&&this.triggerCallback(t,"out",[this.lastFeature]);return i},triggerCallback:function(e,t,i){var n=this.EVENTMAP[e][t];if(n)if("click"==e&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));a<=this.clickTolerance&&this.callback(n,i),this.up=this.down=null}else this.callback(n,i)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var e=this;this._docMove=function(t){e.mousemove({xy:{x:t.clientX,y:t.clientY},element:document})},this._docUp=function(t){e.mouseup({xy:{x:t.clientX,y:t.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.start=e.xy,this.last=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.preventDefault(e),this.oldOnselectstart||(this.oldOnselectstart=this.map.viewPortDiv.onselectstart?this.map.viewPortDiv.onselectstart:OpenLayers.Function.True),this.map.viewPortDiv.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(this.started=!1,this.start=null,this.last=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=this.map.viewPortDiv.onselectstart,this.map.viewPortDiv.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),this.map.viewPortDiv.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.startTouch(),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),this.map.viewPortDiv.onselectstart&&(this.map.viewPortDiv.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(e))this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){return this.started&&!OpenLayers.Event.isMultiTouch(e)?(this.started=!1,this.pinching=!1,this.callback("done",[e,this.start,this.last]),this.start=null,this.last=null,!1):!0},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,e=!0),e},getDistance:function(e){var t=e[0],i=e[1];return Math.sqrt(Math.pow(t.olClientX-i.olClientX,2)+Math.pow(t.olClientY-i.olClientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),i=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:i}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),e=!0}return e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius;var t=this.layer.getLonLatFromViewPortPx(e.xy);this.origin=new OpenLayers.Geometry.Point(t.lon,t.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),i=new OpenLayers.Geometry.Point(t.lon,t.lat);if(this.irregular){var n=Math.sqrt(2)*Math.abs(i.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,n)}else this.fixedRadius?this.origin=i:(this.calculateAngle(i,e),this.radius=Math.max(this.map.getResolution()/2,i.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var a,r=i.x-this.origin.x,s=i.y-this.origin.y;a=0==s?r/(this.radius*Math.sqrt(2)):r/s,this.feature.geometry.resize(1,this.origin,a),this.feature.geometry.move(r/2,s/2)}this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var n=0;n<this.sides;++n)t=i.components[n],e=this.angle+2*n*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var i=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var n=Math.PI/180*this.snapAngle;this.angle=Math.round(i/n)*n}else this.angle=i},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e){this.callbacks[e]&&this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,i=this.dragHandler.start.y,n=Math.abs(t-e.x),a=Math.abs(i-e.y),r=this.getBoxOffsets();this.zoomBox.style.width=n+r.width+1+"px",this.zoomBox.style.height=a+r.height+1+"px",this.zoomBox.style.left=(e.x<t?t-n-r.left:t-r.left)+"px",this.zoomBox.style.top=(e.y<i?i-a-r.top:i-r.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var i=this.dragHandler.start,n=Math.min(i.y,e.y),a=Math.max(i.y,e.y),r=Math.min(i.x,e.x),s=Math.max(i.x,e.x);t=new OpenLayers.Bounds(r,a,s,n)}else t=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:i,right:n,top:a,bottom:r,width:t===!1?i+n:0,height:t===!1?a+r:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,i=!1,n=!1,a=OpenLayers.Event.element(e);null!=a&&!n&&!t;){if(!t)try{var r;if(a.currentStyle)r=a.currentStyle.overflow;else{var s=document.defaultView.getComputedStyle(a,null);r=s.getPropertyValue("overflow")}t=r&&"auto"==r||"scroll"==r}catch(o){}if(!i&&(i=OpenLayers.Element.hasClass(a,"olScrollable"),!i))for(var l=0,u=this.map.layers.length;u>l;l++){var c=this.map.layers[l];if(a==c.div||a==c.pane){i=!0;break}}n=a==this.map.div,a=a.parentNode}if(!t&&n){if(i){var d=0;if(e.wheelDelta?(d=e.wheelDelta,d%160===0&&(d=.75*d),d/=120):e.detail&&(d=-(e.detail/Math.abs(e.detail))),this.delta+=d,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var h=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(h)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(e.xy=this.map.events.getMousePosition(e),0>t?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1]))},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var e=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",e),OpenLayers.Event.observe(window,"mousewheel",e),OpenLayers.Event.observe(document,"mousewheel",e),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var e=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",e),OpenLayers.Event.stopObserving(window,"mousewheel",e),OpenLayers.Event.stopObserving(document,"mousewheel",e),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;t>e;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var t=0,i=this.KEY_EVENTS.length;i>t;t++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[t],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,i=e.getCenterPixel();if(this.out){var n=e.right-e.left,a=e.bottom-e.top,r=Math.min(this.map.size.h/a,this.map.size.w/n),s=this.map.getExtent(),o=this.map.getLonLatFromPixel(i),l=o.lon-s.getWidth()/2*r,u=o.lon+s.getWidth()/2*r,c=o.lat-s.getHeight()/2*r,d=o.lat+s.getHeight()/2*r;t=new OpenLayers.Bounds(l,c,u,d)}else{var h=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),p=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(h.lon,h.lat,p.lon,p.lat)}var f=this.map.getZoom(),m=this.map.getSize(),g={x:m.w/2,y:m.h/2},v=this.map.getZoomForExtent(t),y=this.map.getResolution(),b=this.map.getResolutionForZoom(v);if(y==b)this.map.setCenter(this.map.getLonLatFromPixel(i));else{var k={x:(y*i.x-b*g.x)/(y-b),y:(y*i.y-b*g.y)/(y-b)};this.map.zoomTo(v,k)}f==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,n){i.map.pan(e,t,{dragging:!n,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e){var t=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.pinchOrigin=t,this.currentCenter=t},pinchMove:function(e,t){var i=t.scale,n=this.map.layerContainerOriginPx,a=this.pinchOrigin,r=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy,s=Math.round(n.x+r.x-a.x+(i-1)*(n.x-a.x)),o=Math.round(n.y+r.y-a.y+(i-1)*(n.y-a.y));this.map.applyTransform(s,o,i),this.currentCenter=r},pinchDone:function(e,t,i){this.map.applyTransform();var n=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(n!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var a=this.map.getResolutionForZoom(n),r=this.map.getLonLatFromPixel(this.pinchOrigin),s=this.currentCenter,o=this.map.getSize();
r.lon+=a*(o.w/2-s.x),r.lat-=a*(o.h/2-s.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(r,n)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var e=this.map.baseLayer.clone();this.layers=[e]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv);var t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,i=this.handlers.drag.last.y-e.y;if(0!=t||0!=i){var n=this.rectPxBounds.top,a=this.rectPxBounds.left,r=Math.abs(this.rectPxBounds.getHeight()),s=this.rectPxBounds.getWidth(),o=Math.max(0,n-i);o=Math.min(o,this.ovmap.size.h-this.hComp-r);var l=Math.max(0,a-t);l=Math.min(l,this.ovmap.size.w-this.wComp-s),this.setRectPxBounds(new OpenLayers.Bounds(l,o+r,l+s,o))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),i=e.xy.x-t.x,n=e.xy.y-t.y,a=this.rectPxBounds.top,r=this.rectPxBounds.left,s=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),l=Math.max(0,a+n);l=Math.min(l,this.ovmap.size.h-s);var u=Math.max(0,r+i);u=Math.min(u,this.ovmap.size.w-o),this.setRectPxBounds(new OpenLayers.Bounds(u,l+s,u+o,l)),this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="",this.showToggle(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none",this.showToggle(!0),null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.getMaxExtent(),i=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(i=i.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var n=this.ovmap.getResolution()/this.map.getResolution();return n>this.minRatio&&n<=this.maxRatio&&this.ovmap.getExtent().containsBounds(i)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),i=t/e;i>this.maxRatio?t=this.minRatio*e:i<=this.minRatio&&(t=this.maxRatio*e);var n;this.ovmap.getProjection()!=this.map.getProjection()?(n=this.map.center.clone(),n.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):n=this.map.center,this.ovmap.setCenter(n,this.ovmap.getZoomForResolution(t*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,e),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,i=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&i?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[i]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),i=Math.max(e.left,0),n=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),a=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),r=Math.max(a-i,0),s=Math.max(n-t,0);if(r<this.minRectSize||s<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var o=i+r/2-this.minRectSize/2,l=t+s/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px",this.extentRectangle.style.left=Math.round(o)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(t)+"px",this.extentRectangle.style.left=Math.round(i)+"px",this.extentRectangle.style.height=Math.round(s)+"px",this.extentRectangle.style.width=Math.round(r)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(i),Math.round(n),Math.round(a),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),i=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),n=null;return t&&i&&(n=new OpenLayers.Bounds(t.x,t.y,i.x,i.y)),n},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),i=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,i=this.ovmap.getResolution(),n=this.ovmap.getExtent().getCenterLonLat(),a=e.x-t.w/2,r=e.y-t.h/2;return{lon:n.lon+a*i,lat:n.lat-r*i}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),i=this.ovmap.getExtent();return i?{x:Math.round(1/t*(e.lon-i.left)),y:Math.round(1/t*(i.top-e.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var n=this.layer.styleMap&&this.layer.styleMap.styles.temporary;n&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":n})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){var t=new OpenLayers.Feature.Vector(e),i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});i!==!1&&(t.state=OpenLayers.State.INSERT,this.layer.addFeatures([t]),this.featureAdded(t),this.events.triggerEvent("featureadded",{feature:t}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){this.handlers.feature.touch&&!this.over&&this.overFeature(e)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(e){this.handlers.feature.touch&&this.over&&(this.outFeature(e),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;return this.handlers.drag.dragging?this.over=this.feature.id==e.id?!0:!1:(this.feature=e,this.handlers.drag.activate(),t=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(e)),t},downFeature:function(e){this.lastPixel=e,this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y)),this.layer.drawFeature(this.feature),this.lastPixel=e,this.onDrag(this.feature,e)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){this.handlers.drag.dragging?this.feature.id==e.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(e),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(e){this.handlers.drag.setMap(e),this.handlers.feature.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,t){t=t||{},this.layer=e,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[t]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var i={down:function(){this.vertex=null;var e=this.layer.getFeatureFromEvent(this.handlers.drag.evt);e?this.dragStart(e):this.clickout&&(this._unselect=this.feature)},move:function(e){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,e)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(){this.vertex&&this.dragComplete(this.vertex)}},n={documentDrag:this.documentDrag,stopDown:!1},a={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,a),drag:new OpenLayers.Handler.Drag(this,i,n)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var t=this.feature;t&&t.geometry&&t.layer&&this.unselectFeature(t),e=!0}return e},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},selectFeature:function(e){if(!(this.feature===e||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME))){this.beforeSelectFeature(e)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=e,this.layer.selectedFeatures.push(e),this.layer.drawFeature(e,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var t=e.modified;!e.geometry||t&&t.geometry||(this._originalGeometry=e.geometry.clone())}},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,e),this.onModificationEnd(e),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},dragStart:function(e){var t="OpenLayers.Geometry.Point"==e.geometry.CLASS_NAME;this.standalone||(e._sketch||!t)&&e._sketch||(this.toggle&&this.feature===e&&(this._unselect=e),this.selectFeature(e)),(e._sketch||t)&&(this.vertex=e,this.handlers.drag.stopDown=!0)},dragVertex:function(e,t){var i=this.map.getLonLatFromViewPortPx(t),n=e.geometry;n.move(i.lon-n.x,i.lat-n.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}):(e._index?(e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(e)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(e){var t=e.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,t)){var i=this.layer.getFeatureFromEvent(this.handlers.drag.evt);i&&-1!=OpenLayers.Util.indexOf(this.vertices,i)&&!this.handlers.drag.dragging&&i.geometry.parent&&(i.geometry.parent.removeComponent(i.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:i.geometry,feature:this.feature,pixel:e.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function e(i){var n,a,r,s;if("OpenLayers.Geometry.Point"==i.CLASS_NAME)a=new OpenLayers.Feature.Vector(i),a._sketch=!0,a.renderIntent=t.vertexRenderIntent,t.vertices.push(a);else{var o=i.components.length;for("OpenLayers.Geometry.LinearRing"==i.CLASS_NAME&&(o-=1),n=0;o>n;++n)r=i.components[n],"OpenLayers.Geometry.Point"==r.CLASS_NAME?(a=new OpenLayers.Feature.Vector(r),a._sketch=!0,a.renderIntent=t.vertexRenderIntent,t.vertices.push(a)):e(r);if(t.createVertices&&"OpenLayers.Geometry.MultiPoint"!=i.CLASS_NAME)for(n=0,s=i.components.length;s-1>n;++n){var l=i.components[n],u=i.components[n+1];if("OpenLayers.Geometry.Point"==l.CLASS_NAME&&"OpenLayers.Geometry.Point"==u.CLASS_NAME){var c=(l.x+u.x)/2,d=(l.y+u.y)/2,h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c,d),null,t.virtualStyle);h.geometry.parent=i,h._index=n+1,h._sketch=!0,t.virtualVertices.push(h)}}}}this.vertices=[],this.virtualVertices=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,t=e.getBounds().getCenterLonLat(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),n=new OpenLayers.Feature.Vector(i);i.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i),e.move(t,i)},n._sketch=!0,this.dragHandle=n,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),n=new OpenLayers.Geometry.Point(i.lon,i.lat),a=new OpenLayers.Geometry.Point(t.right,t.bottom),r=new OpenLayers.Feature.Vector(a),s=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,o=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,l=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;a.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i);var a=this.x-n.x,r=this.y-n.y,u=a-t,c=r-i;if(l){var d=Math.atan2(c,u),h=Math.atan2(r,a),p=h-d;p*=180/Math.PI,e.rotate(p,n)}if(s){var f,m;if(o)f=r/c,m=a/u/f;else{var g=Math.sqrt(u*u+c*c),v=Math.sqrt(a*a+r*r);f=v/g}e.resize(f,n,m)}},r._sketch=!0,this.radiusHandle=r,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(e){this.handlers.drag.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,i,n,a,r=this.layers||[this.layer];for(n=0;n<r.length;++n)if(t=r[n],a=0,null!=t.selectedFeatures)for(;t.selectedFeatures.length>a;)i=t.selectedFeatures[a],e&&e.except==i?++a:this.unselect(i)},clickFeature:function(e){if(!this.hover){var t=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;t?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):-1==OpenLayers.Util.indexOf(t.selectedFeatures,e)&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer,i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var n=this.selectStyle||this.renderIntent;t.drawFeature(e,n),this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:e._prevHighlighter==this.id?delete e._prevHighlighter:(e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;t!==!1&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),t!==!1&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),i=this.map.getLonLatFromPixel({x:e.right,y:e.top}),n=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();var a=this.multiple;this.multiple=!0;var r=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:r});for(var s,o=0;o<r.length;++o){s=r[o];for(var l=0,u=s.features.length;u>l;++l){var c=s.features[l];c.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,c.geometry.CLASS_NAME)>-1)&&n.toGeometry().intersects(c.geometry)&&-1==OpenLayers.Util.indexOf(s.selectedFeatures,c)&&this.select(c)}}this.multiple=a,this.events.triggerEvent("boxselectionend",{layers:r})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";{this.topInUnits.length}this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(e){var t,i=parseInt(Math.log(e)/Math.log(10)),n=Math.pow(10,i),a=parseInt(e/n);return t=a>5?5:a>2?2:1,t*n},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),i=OpenLayers.INCHES_PER_UNIT,n=this.maxWidth*e*i[t],a=1;if(this.geodesic===!0){var r=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,s=n/i.km;a=r/s,n*=a}var o,l;n>1e5?(o=this.topOutUnits,l=this.bottomOutUnits):(o=this.topInUnits,l=this.bottomInUnits);var u=n/i[o],c=n/i[l],d=this.getBarLen(u),h=this.getBarLen(c);u=d/i[t]*i[o],c=h/i[t]*i[l];var p=u/e/a,f=c/e/a;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(f)+"px",this.eBottom.innerHTML=h+" "+l),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(p)+"px",this.eTop.innerHTML=d+" "+o)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var i=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(i,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var i=this.map.getZoom(),n=i+t;n=Math.max(n,0),n=Math.min(n,this.map.getNumZoomLevels()),n!==i&&this.map.zoomTo(n,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions),this.previous=new OpenLayers.Control.Button(t);var i={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(i,this.nextOptions),this.next=new OpenLayers.Control.Button(i),this.clear()},onPreviousChange:function(e){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e,this.next.setMap(e),this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();return void 0!=t?(this.nextStack.unshift(e),this.previousStack.unshift(t),this.restoring=!0,this.restore(t),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(e),t},nextTrigger:function(){var e=this.nextStack.shift();return void 0!=e&&(this.previousStack.unshift(e),this.restoring=!0,this.restore(e),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),e},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,i;if(this.map.getProjectionObject()==e.projection)i=this.map.getZoomForResolution(e.resolution),t=e.center;else{t=e.center.clone(),t.transform(e.projection,this.map.getProjectionObject());var n=e.units,a=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,r=n&&a?OpenLayers.INCHES_PER_UNIT[n]/OpenLayers.INCHES_PER_UNIT[a]:1;i=this.map.getZoomForResolution(r*e.resolution)}this.map.setCenter(t,i)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0,0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear(),e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial};this.immediate&&(i.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){this.immediate=e,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var i=this.active;i&&this.deactivate(),this.handler=new e(this,this.callbacks,t),i&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay(),t=t.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,i){i&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(t.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t){var i,n;e.CLASS_NAME.indexOf("LineString")>-1?(i=this.getBestLength(e),n=1):(i=this.getBestArea(e),n=2),this.events.triggerEvent(t,{measure:i[0],units:i[1],order:n,geometry:e})},getBestArea:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],a=0,r=n.length;r>a&&(t=n[a],i=this.getArea(e,t),!(i>1));++a);return[i,t]},getArea:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicArea(this.map.getProjectionObject()),n="m"):(i=e.getArea(),n=this.map.getUnits());var a=OpenLayers.INCHES_PER_UNIT[t];if(a){var r=OpenLayers.INCHES_PER_UNIT[n];i*=Math.pow(r/a,2)}return i},getBestLength:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],a=0,r=n.length;r>a&&(t=n[a],i=this.getLength(e,t),!(i>1));++a);return[i,t]},getLength:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicLength(this.map.getProjectionObject()),n="m"):(i=e.getLength(),n=this.map.getUnits());var a=OpenLayers.INCHES_PER_UNIT[t];if(a){var r=OpenLayers.INCHES_PER_UNIT[n];i*=r/a}return i},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){if(e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t,i=this.layers||this.map.layers,n=[],a=i.length-1;a>=0;--a)e=i[a],e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())&&(t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,this.drillDown!==!1||this.url||(this.url=t),(this.drillDown===!0||this.urlMatches(t))&&n.push(e));return n},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var i=0,n=this.layerUrls.length;n>i;++i)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],e)){t=!0;break}return t},buildWMSOptions:function(e,t,i,n){for(var a=[],r=[],s=0,o=t.length;o>s;s++)null!=t[s].params.LAYERS&&(a=a.concat(t[s].params.LAYERS),r=r.concat(this.getStyleNames(t[s])));var l=t[0],u=this.map.getProjection(),c=l.projection;c&&c.equals(this.map.getProjectionObject())&&(u=c.getCode());var d=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:n,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:u,i:parseInt(i.x),j:parseInt(i.y)}:{srs:u,x:parseInt(i.x),y:parseInt(i.y)});return 0!=a.length&&(d=OpenLayers.Util.extend({layers:a,query_layers:a,styles:r},d)),OpenLayers.Util.applyDefaults(d,this.vendorParams),{url:e,params:OpenLayers.Util.upperCaseObject(d),callback:function(t){this.handleResponse(i,t,e)},scope:this}},getStyleNames:function(e){var t;return t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"")},request:function(e,t){var i=this.findLayers();if(0==i.length)return this.events.triggerEvent("nogetfeatureinfo"),void OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");if(t=t||{},this.drillDown===!1){var n=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT),a=OpenLayers.Request.GET(n);t.hover===!0&&(this.hoverRequest=a)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var r,s={},o=0,l=i.length;l>o;o++){var u=i[o];r=OpenLayers.Util.isArray(u.url)?u.url[0]:u.url,r in s?s[r].push(u):(this._numRequests++,s[r]=[u])}var i;for(var r in s){i=s[r];var n=this.buildWMSOptions(r,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(n)}}},triggerGetFeatureInfo:function(e,t,i){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:i,request:e,xy:t}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,i){var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var a=this.format.read(n);this.drillDown===!1?this.triggerGetFeatureInfo(t,e,a):(this._requestCount++,this._features=(this._features||[]).concat("object"===this.output?{url:i,features:a}:a),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(t,e,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(e,t,i){var n=!1,a=this.getBounds();if(null!=a&&null!=e){var r=null!=t?t:0,s=null!=i?i:0,o=new OpenLayers.Bounds(this.bounds.left-r,this.bounds.bottom-s,this.bounds.right+r,this.bounds.top+s);n=o.containsLonLat(e)}return n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;i||(i=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=i);var n=i.read(e);if(n instanceof OpenLayers.Feature.Vector)t=n.geometry;else if(OpenLayers.Util.isArray(n)){for(var a=n.length,r=new Array(a),s=0;a>s;++s)r[s]=n[s].geometry;t=new OpenLayers.Geometry.Collection(r)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var n=i&&i.point,a=i&&i.tolerance,r=!1,s=e.x1-t.x1,o=e.y1-t.y1,l=e.x2-e.x1,u=e.y2-e.y1,c=t.y2-t.y1,d=t.x2-t.x1,h=c*l-d*u,p=d*o-c*s,f=l*o-u*s;if(0==h)0==p&&0==f&&(r=!0);else{var m=p/h,g=f/h;if(m>=0&&1>=m&&g>=0&&1>=g)if(n){var v=e.x1+m*l,y=e.y1+m*u;r=new OpenLayers.Geometry.Point(v,y)}else r=!0}if(a){var b;if(r){if(n){var k,v,y,_=[e,t];e:for(var w=0;2>w;++w){k=_[w];for(var L=1;3>L;++L)if(v=k["x"+L],y=k["y"+L],b=Math.sqrt(Math.pow(v-r.x,2)+Math.pow(y-r.y,2)),a>b){r.x=v,r.y=y;break e}}}}else{var x,S,v,y,O,T,_=[e,t];e:for(var w=0;2>w;++w){x=_[w],S=_[(w+1)%2];for(var L=1;3>L;++L)if(O={x:x["x"+L],y:x["y"+L]},T=OpenLayers.Geometry.distanceToSegment(O,S),T.distance<a){r=n?new OpenLayers.Geometry.Point(O.x,O.y):!0;break e}}}}return r},OpenLayers.Geometry.distanceToSegment=function(e,t){var i=OpenLayers.Geometry.distanceSquaredToSegment(e,t);return i.distance=Math.sqrt(i.distance),i},OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var i,n,a=e.x,r=e.y,s=t.x1,o=t.y1,l=t.x2,u=t.y2,c=l-s,d=u-o,h=(c*(a-s)+d*(r-o))/(Math.pow(c,2)+Math.pow(d,2));return 0>=h?(i=s,n=o):h>=1?(i=l,n=u):(i=s+h*c,n=o+h*d),{distance:Math.pow(i-a,2)+Math.pow(n-r,2),x:i,y:n,along:h}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;i>t;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,n=t.length;n>i;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var n=this.components.slice(0,t),a=this.components.slice(t,this.components.length);n.push(e),this.components=n.concat(a)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,n=this.components.length;n>i;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,n=[],a=[],r=0,s=Number.MAX_VALUE,o=0;t>o;++o){i=this.components[o];var l=i.getArea(),u=i.getCentroid(!0);isNaN(l)||isNaN(u.x)||isNaN(u.y)||(n.push(l),r+=l,s=s>l&&l>0?l:s,a.push(u))}if(t=n.length,0===r){for(var o=0;t>o;++o)n[o]=1;r=n.length}else{for(var o=0;t>o;++o)n[o]/=s;r/=s}for(var u,l,c=0,d=0,o=0;t>o;++o)u=a[o],l=n[o],c+=u.x*l,d+=u.y*l;return new OpenLayers.Geometry.Point(c/r,d/r)},getGeodesicLength:function(e){for(var t=0,i=0,n=this.components.length;n>i;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,n=this.components.length;n>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;n>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0;n<this.components.length;++n)this.components[n].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,n,a,r=!(t&&t.edge===!1),s=r&&t&&t.details,o=Number.POSITIVE_INFINITY,l=0,u=this.components.length;u>l&&(i=this.components[l].distanceTo(e,t),a=s?i.distance:i,!(o>a&&(o=a,n=i,0==o)));++l);return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,n=this.components.length;n>i;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;n>i;i++){var a=this.components[i];a.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,n=this.components.length;n>i&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,n=this.components.length;n>i;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,n,a,r,s,o,l=!(t&&t.edge===!1),u=l&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(n=this.x,a=this.y,r=e.x,s=e.y,i=Math.sqrt(Math.pow(n-r,2)+Math.pow(a-s,2)),o=u?{x0:n,y0:a,x1:r,y1:s,distance:i}:i):(o=e.distanceTo(this,t),u&&(o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance})),o},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(n),this.y=t.y+i*Math.sin(n),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=void 0==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;i>t;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0;if(t.components&&t.components.length>1)for(var a,r,s=1,o=t.components.length;o>s;s++)a=t.components[s-1],r=t.components[s],n+=OpenLayers.Util.distVincenty({lon:a.x,lat:a.y},{lon:r.x,lat:r.y});return 1e3*n},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var e=this.components&&this.components.length>2;return e&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),e},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,a=this.getSortedSegments();n="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var r,s,o,l,u,c,d,h;e:for(var p=0,f=a.length;f>p;++p){r=a[p],s=r.x1,o=r.x2,l=r.y1,u=r.y2;for(var m=0,g=n.length;g>m&&(c=n[m],!(c.x1>o));++m)if(!(c.x2<s||(d=c.y1,h=c.y2,Math.min(d,h)>Math.max(l,u)||Math.max(d,h)<Math.min(l,u)||!OpenLayers.Geometry.segmentsIntersect(r,c)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,n=this.components.length-1,a=new Array(n),r=0;n>r;++r)t=this.components[r],i=this.components[r+1],a[r]=t.x<i.x?{x1:t.x,y1:t.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:t.x,y2:t.y};return a.sort(e)},splitWithSegment:function(e,t){for(var i,n,a,r,s,o=!(t&&t.edge===!1),l=t&&t.tolerance,u=[],c=this.getVertices(),d=[],h=[],p=!1,f={point:!0,tolerance:l},m=null,g=0,v=c.length-2;v>=g;++g)if(i=c[g],d.push(i.clone()),n=c[g+1],s={x1:i.x,y1:i.y,x2:n.x,y2:n.y},a=OpenLayers.Geometry.segmentsIntersect(e,s,f),a instanceof OpenLayers.Geometry.Point&&(r=a.x===e.x1&&a.y===e.y1||a.x===e.x2&&a.y===e.y2||a.equals(i)||a.equals(n)?!0:!1,r||o)){if(a.equals(h[h.length-1])||h.push(a.clone()),0===g&&a.equals(i))continue;if(a.equals(n))continue;p=!0,a.equals(i)||d.push(a),u.push(new OpenLayers.Geometry.LineString(d)),d=[a.clone()]}if(p&&(d.push(n.clone()),u.push(new OpenLayers.Geometry.LineString(d))),h.length>0){var y=e.x1<e.x2?1:-1,b=e.y1<e.y2?1:-1;m={lines:u,points:h.sort(function(e,t){return y*e.x-y*t.x||b*e.y-b*t.y})}}return m},split:function(e,t){var i,n,a,r,s=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,u,c,d,h,p,f=this.getVertices(),m=[];a=[];for(var g=0,v=f.length-2;v>=g;++g){l=f[g],u=f[g+1],c={x1:l.x,y1:l.y,x2:u.x,y2:u.y},r=r||[e],o&&m.push(l.clone());for(var y=0;y<r.length;++y)if(d=r[y].splitWithSegment(c,t),d&&(h=d.lines,h.length>0&&(h.unshift(y,1),Array.prototype.splice.apply(r,h),y+=h.length-2),o))for(var b=0,k=d.points.length;k>b;++b)p=d.points[b],p.equals(l)||(m.push(p),a.push(new OpenLayers.Geometry.LineString(m)),m=p.equals(u)?[]:[p.clone()])}o&&a.length>0&&m.length>0&&(m.push(u.clone()),a.push(new OpenLayers.Geometry.LineString(m)))}else s=e.splitWith(this,t);return r&&r.length>1?n=!0:r=[],a&&a.length>1?i=!0:a=[],(n||i)&&(s=o?[a,r]:r),s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1),a=n&&t&&t.details,r={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,l=this.getSortedSegments(),u=e.x,c=e.y,d=0,h=l.length;h>d;++d)if(o=l[d],i=OpenLayers.Geometry.distanceToSegment(e,o),i.distance<s){if(s=i.distance,r=i,0===s)break}else if(o.x2>u&&(c>o.y1&&c<o.y2||c<o.y1&&c>o.y2))break;r=a?{distance:r.distance,x0:r.x,y0:r.y,x1:u,y1:c}:r.distance}else if(e instanceof OpenLayers.Geometry.LineString){var p,f,m,g,v,y=this.getSortedSegments(),b=e.getSortedSegments(),k=b.length,_={point:!0};e:for(var d=0,h=y.length;h>d;++d){p=y[d],g=p.x1,v=p.y1;for(var w=0;k>w;++w){if(f=b[w],m=OpenLayers.Geometry.segmentsIntersect(p,f,_)){s=0,r={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:g,y:v},f),i.distance<s&&(s=i.distance,r={distance:s,x0:g,y0:v,x1:i.x,y1:i.y})}}if(a||(r=r.distance),0!==s&&p){i=e.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),t);var L=a?i.distance:i;s>L&&(r=a?{distance:s,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:L)}}else r=e.distanceTo(this,t),a&&(r={distance:r.distance,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0});return r},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t){return e-t},n=function(e,t,i,r){for(var s,l=0,u=0,c=t;i>c;c++)s=a(e[t],e[i],e[c]),s>l&&(l=s,u=c);l>r&&u!=t&&(o.push(u),n(e,t,u,r),n(e,u,i,r))},a=function(e,t,i){var n=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=n/a*2;return r},r=0,s=t.length-1,o=[];for(o.push(r),o.push(s);t[r].equals(t[s]);)s--,o.push(s);n(t,r,s,e);var l=[];o.sort(i);for(var u=0;u<o.length;u++)l.push(t[o[u]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=!1,n=this.components.pop();null==t&&e.equals(n)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var a=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[a]),i},removeComponent:function(){var e=this.components&&this.components.length>3;if(e){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var t=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[t])}return e},move:function(e,t){for(var i=0,n=this.components.length;n-1>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;n-1>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0,a=this.components.length;a-1>n;++n)this.components[n].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;n-1>i;i++){var a=this.components[i];a.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&2>=e)return this.components[0].clone();if(e>2){var t=0,i=0,n=this.components[0].x,a=this.components[0].y,r=-1*this.getArea();if(0!=r){for(var s=0;e-1>s;s++){var o=this.components[s],l=this.components[s+1];t+=(o.x+l.x-2*n)*((o.x-n)*(l.y-a)-(l.x-n)*(o.y-a)),i+=(o.y+l.y-2*a)*((o.x-n)*(l.y-a)-(l.x-n)*(o.y-a))}var u=n+t/(6*r),c=a+i/(6*r)}else{for(var s=0;e-1>s;s++)t+=this.components[s].x,i+=this.components[s].y;var u=t/(e-1),c=i/(e-1)}return new OpenLayers.Geometry.Point(u,c)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,n=this.components.length;n-1>i;i++){var a=this.components[i],r=this.components[i+1];t+=(a.x+r.x)*(r.y-a.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0,a=t.components&&t.components.length;if(a>2){for(var r,s,o=0;a-1>o;o++)r=t.components[o],s=t.components[o+1],n+=OpenLayers.Util.rad(s.x-r.x)*(2+Math.sin(OpenLayers.Util.rad(r.y))+Math.sin(OpenLayers.Util.rad(s.y)));n=6378137*n*6378137/2}return n},containsPoint:function(e){function t(e,t,i,n,a){return(e-a)*((n-t)/(a-i))+n}for(var i,n,a,r,s,o,l,u=OpenLayers.Number.limitSigDigs,c=14,d=u(e.x,c),h=u(e.y,c),p=this.components.length-1,f=0,m=0;p>m;++m)if(i=this.components[m],a=u(i.x,c),r=u(i.y,c),n=this.components[m+1],s=u(n.x,c),o=u(n.y,c),r!=o){if(l=u(t(h,a,r,s,o),c),l==d&&(o>r&&h>=r&&o>=h||r>o&&r>=h&&h>=o)){f=-1;break}d>=l||a!=s&&(l<Math.min(a,s)||l>Math.max(a,s))||(o>r&&h>=r&&o>h||r>o&&r>h&&h>=o)&&++f}else if(h==r&&(s>=a&&d>=a&&s>=d||a>=s&&a>=d&&d>=s)){f=-1;break}var g=-1==f?1:!!(1&f);return g},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,n=e.components.length;n>i&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;i>t;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,n=this.components.length;n>i;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))
}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&(i=this.components[0].containsPoint(e),1!==i&&i&&t>1))for(var n,a=1;t>a;++a)if(n=this.components[a].containsPoint(e)){i=1===n?1:!1;break}return i},intersects:function(e){var t,i,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;i>t&&!(n=e.intersects(this.components[t]));++t);if(!n)for(t=0,i=e.components.length;i>t&&!(n=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;i>t&&!(n=this.intersects(e.components[t]));++t);if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var a=this.components[0];for(t=0,i=a.components.length;i>t&&!(n=e.containsPoint(a.components[t]));++t);}return n},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1);return i=!n&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,n){var a=Math.PI*(1/i-.5);n&&(a+=n/180*Math.PI);for(var r,s,o,l=[],u=0;i>u;++u)r=a+2*u*Math.PI/i,s=e.x+t*Math.cos(r),o=e.y+t*Math.sin(r),l.push(new OpenLayers.Geometry.Point(s,o));var c=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([c])},OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var i,n,a,r,s,o=null,l=t&&t.mutual,u=[],c=[e],d=0,h=this.components.length;h>d;++d){n=this.components[d],r=!1;for(var p=0;p<c.length;++p)if(i=n.split(c[p],t)){if(l){a=i[0];for(var f=0,m=a.length;m>f;++f)0===f&&u.length?u[u.length-1].addComponent(a[f]):u.push(new OpenLayers.Geometry.MultiLineString([a[f]]));r=!0,i=i[1]}if(i.length){i.unshift(p,1),Array.prototype.splice.apply(c,i);break}}r||(u.length?u[u.length-1].addComponent(n.clone()):u=[new OpenLayers.Geometry.MultiLineString(n.clone())])}return u&&u.length>1?r=!0:u=[],c&&c.length>1?s=!0:c=[],(r||s)&&(o=l?[u,c]:c),o},splitWith:function(e,t){var i,n,a,r,s,o,l,u=null,c=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[],o=[e];for(var d=0,h=this.components.length;h>d;++d){s=!1,n=this.components[d];for(var p=0;p<o.length;++p)if(i=o[p].split(n,t)){c&&(a=i[0],a.length&&(a.unshift(p,1),Array.prototype.splice.apply(o,a),p+=a.length-2),i=i[1],0===i.length&&(i=[n.clone()]));for(var f=0,m=i.length;m>f;++f)0===f&&l.length?l[l.length-1].addComponent(i[f]):l.push(new OpenLayers.Geometry.MultiLineString([i[f]]));s=!0}s||(l.length?l[l.length-1].addComponent(n.clone()):l=[new OpenLayers.Geometry.MultiLineString([n.clone()])])}}else u=e.split(this);return o&&o.length>1?r=!0:o=[],l&&l.length>1?s=!0:l=[],(r||s)&&(u=c?[o,l]:l),u},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/i);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),i.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(i,n):t={display:"none"};var a=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&a!==!1){var r=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var s=isNaN(t.labelXOffset)?0:t.labelXOffset,o=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();r.move(s*l,o*l)}this.drawText(e.id,t,r)}else this.removeText(e.id);return a}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var i=t.getWidth(),n=(this.extent.left+this.extent.right)/2,a=(e.left+e.right)/2,r=Math.round((a-n)/i);this.featureDx=r*i}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id),this.removeText(n.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return e.stroke===!1&&(delete t.strokeWidth,delete t.strokeColor),e.fill===!1&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,a=this.order.length;a-n>1;){i=parseInt((n+a)/2);var r=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));r>0?n=i:a=i}return this.order.splice(a,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(a)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var i=OpenLayers.Util.getElement(this.order[t]);return void 0==i&&(i=this.getNextElement(t)),i}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var n=e.getZIndex(t),a=0;if(i){var r=e.getZIndex(i);a=n-r}return a},Z_ORDER_DRAWING_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==n&&(n=1),n},Z_ORDER_Y_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===n){var a=i._boundsBottom-t._boundsBottom;n=0===a?1:a}return n}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var a,r=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/r),s=this.map.getMaxExtent();s.right>e.left&&s.right<e.right?a=!0:s.left>e.left&&s.left<e.right&&(a=!1),(a!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=a===!0?s.getWidth()/n:0),this.rightOfDateLine=a}return i},getNodeType:function(){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,a=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var r=0,s=e.components.length;s>r;r++)a=this.drawGeometry(e.components[r],t,i)&&a;return a}a=!1;var o=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):o=!0,a=this.redrawNode(e.id,e,t,i)),0==a){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(o=!0),l.parentNode.removeChild(l))}if(o){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return a},redrawNode:function(e,t,i,n){i=this.applyDefaultSymbolizer(i);var a=this.nodeFactory(e,this.getNodeType(t,i));a._featureId=n,a._boundsBottom=t.getBounds().bottom,a._geometryClass=t.CLASS_NAME,a._style=i;var r=this.drawGeometryNode(a,t,i);if(r===!1)return!1;if(a=r.node,this.indexer){var s=this.indexer.insert(a);s?this.vectorRoot.insertBefore(a,s):this.vectorRoot.appendChild(a)}else a.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(a);return this.postDraw(a),r.complete},redrawBackgroundNode:function(e,t,i){var n=OpenLayers.Util.extend({},i);return n.externalGraphic=n.backgroundGraphic,n.graphicXOffset=n.backgroundXOffset,n.graphicYOffset=n.backgroundYOffset,n.graphicZIndex=n.backgroundGraphicZIndex,n.graphicWidth=n.backgroundWidth||n.graphicWidth,n.graphicHeight=n.backgroundHeight||n.graphicHeight,n.backgroundGraphic=null,n.backgroundXOffset=null,n.backgroundYOffset=null,n.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,n,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var n,a={isFilled:void 0===i.fill?!0:i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i.graphic===!1&&(a.isFilled=!1,a.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":a.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=a,0!=n?{node:this.setStyle(e,i,a,t),complete:n}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var i=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);i&&this.textRoot.removeChild(i)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,n=i?i:t||e.srcElement;return n._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;n>i;i++)this.eraseGeometry(e.components[i],t);else{var a=OpenLayers.Util.getElement(e.id);if(a&&a.parentNode&&(a.geometry&&(a.geometry.destroy(),a.geometry=null),a.parentNode.removeChild(a),this.indexer&&this.indexer.remove(a),a._style.backgroundGraphic)){var r=e.id+this.BACKGROUND_ID_SUFFIX,s=OpenLayers.Util.getElement(r);s&&s.parentNode&&s.parentNode.removeChild(s)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var n=e+(i?0:this.translationParameters.x),a=t+(i?0:this.translationParameters.y);return n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL&&a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),a=-e.left/n,r=e.top/n;if(t){this.left=a,this.top=r;var s="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",s),this.translate(this.xOffset,0),!0}var o=this.translate(a-this.left+this.xOffset,r-this.top);return o||this.setExtent(e,!0),i&&o},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="path"}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var n=t.title||t.graphicTitle;if(n){e.setAttributeNS(null,"title",n);var a=e.getElementsByTagName("title");if(a.length>0)a[0].firstChild.textContent=n;else{var r=this.nodeFactory(null,"title");r.textContent=n,e.appendChild(r)}}var s,o=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&o){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){s=this.getPosition(e),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var u=t.graphicWidth||t.graphicHeight,c=t.graphicHeight||t.graphicWidth;u=u?u:2*t.pointRadius,c=c?c:2*t.pointRadius;var d=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*u),h=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*c),p=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(s.x+d).toFixed()),e.setAttributeNS(null,"y",(s.y+h).toFixed()),e.setAttributeNS(null,"width",u),e.setAttributeNS(null,"height",c),e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+p),e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var f=3*t.pointRadius,m=2*f,g=this.importSymbol(t.graphicName);s=this.getPosition(e),l=3*this.symbolMetrics[g.id][0]/m;var v=e.parentNode,y=e.nextSibling;v&&v.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(g.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",g.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",m),e.setAttributeNS(null,"height",m),e.setAttributeNS(null,"x",s.x-f),e.setAttributeNS(null,"y",s.y-f),y?v.insertBefore(e,y):v&&v.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var b=t.rotation;if((void 0!==b||void 0!==e._rotation)&&s)if(e._rotation=b,b|=0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+b+" "+s.x+" "+s.y+")");else{var k=this.symbolMetrics[g.id];e.firstChild.setAttributeNS(null,"transform","rotate("+b+" "+k[1]+" "+k[2]+")")}}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*l),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var n=this.getResolution(),a=(t.x-this.featureDx)/n+this.left,r=this.top-t.y/n;return this.inValidRange(a,r)?(e.setAttributeNS(null,"cx",a),e.setAttributeNS(null,"cy",r),e.setAttributeNS(null,"r",i),e):!1},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawPolygon:function(e,t){for(var i,n,a="",r=!0,s=!0,o=0,l=t.components.length;l>o;o++)a+=" M",i=this.getComponentsString(t.components[o].components," "),n=i.path,n?(a+=" "+n,s=i.complete&&s):r=!1;return a+=" z",r?(e.setAttributeNS(null,"d",a),e.setAttributeNS(null,"fill-rule","evenodd"),s?e:null):!1},drawRectangle:function(e,t){var i=this.getResolution(),n=(t.x-this.featureDx)/i+this.left,a=this.top-t.y/i;return this.inValidRange(n,a)?(e.setAttributeNS(null,"x",n),e.setAttributeNS(null,"y",a),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e):!1},drawText:function(e,t,i){var n=!!t.labelOutlineWidth;if(n){var a=OpenLayers.Util.extend({},t);a.fontColor=a.labelOutlineColor,a.fontStrokeColor=a.labelOutlineColor,a.fontStrokeWidth=t.labelOutlineWidth,t.labelOutlineOpacity&&(a.fontOpacity=t.labelOutlineOpacity),delete a.labelOutlineWidth,this.drawText(e,a,i)}var r=this.getResolution(),s=(i.x-this.featureDx)/r+this.left,o=i.y/r-this.top,l=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+l,"text");u.setAttributeNS(null,"x",s),u.setAttributeNS(null,"y",-o),t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(u.setAttributeNS(null,"pointer-events","visible"),u._featureId=e):u.setAttributeNS(null,"pointer-events","none");var c=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[c[0]]||"middle"),OpenLayers.IS_GECKO===!0&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[c[1]]||"central");for(var d=t.label.split("\n"),h=d.length;u.childNodes.length>h;)u.removeChild(u.lastChild);for(var p=0;h>p;p++){var f=this.nodeFactory(e+l+"_tspan_"+p,"tspan");if(t.labelSelect===!0&&(f._featureId=e,f._geometry=i,f._geometryClass=i.CLASS_NAME),OpenLayers.IS_GECKO===!1&&f.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[c[1]]||"-35%"),f.setAttribute("x",s),0==p){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[c[1]];null==m&&(m=-.5),f.setAttribute("dy",m*(h-1)+"em")}else f.setAttribute("dy","1em");f.textContent=""===d[p]?" ":d[p],f.parentNode||u.appendChild(f)}u.parentNode||this.textRoot.appendChild(u)},getComponentsString:function(e,t){for(var i,n,a=[],r=!0,s=e.length,o=[],l=0;s>l;l++)n=e[l],a.push(n),i=this.getShortString(n),i?o.push(i):(l>0&&this.getShortString(e[l-1])&&o.push(this.clipLine(e[l],e[l-1])),s-1>l&&this.getShortString(e[l+1])&&o.push(this.clipLine(e[l],e[l+1])),r=!1);return{path:o.join(t||","),complete:r}},clipLine:function(e,t){if(t.equals(e))return"";var i,n=this.getResolution(),a=this.MAX_PIXEL-this.translationParameters.x,r=this.MAX_PIXEL-this.translationParameters.y,s=(t.x-this.featureDx)/n+this.left,o=this.top-t.y/n,l=(e.x-this.featureDx)/n+this.left,u=this.top-e.y/n;return(-a>l||l>a)&&(i=(u-o)/(l-s),l=0>l?-a:a,u=o+(l-s)*i),(-r>u||u>r)&&(i=(l-s)/(u-o),u=0>u?-r:r,l=s+(u-o)*i),l+","+u},getShortString:function(e){var t=this.getResolution(),i=(e.x-this.featureDx)/t+this.left,n=this.top-e.y/t;return this.inValidRange(i,n)?i+","+n:!1},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");var a=this.nodeFactory(t,"symbol"),r=this.nodeFactory(null,"polygon");a.appendChild(r);for(var s,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),u=[],c=0;c<n.length;c+=2)s=n[c],o=n[c+1],l.left=Math.min(l.left,s),l.bottom=Math.min(l.bottom,o),l.right=Math.max(l.right,s),l.top=Math.max(l.top,o),u.push(s,",",o);r.setAttributeNS(null,"points",u.join(" "));var d=l.getWidth(),h=l.getHeight(),p=[l.left-d,l.bottom-h,3*d,3*h];return a.setAttributeNS(null,"viewBox",p.join(" ")),this.symbolMetrics[t]=[Math.max(d,h),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(a),a},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot?i.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;if(t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px",i.style.height=e.h+"px",i.width=e.w,i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var n,a=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent());var r=a&&a.intersectsBounds(this.extent,{worldBounds:n});i="none"!==t.display&&!!a&&r,i?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=n&&"OpenLayers.Geometry.MultiPoint"!=n&&"OpenLayers.Geometry.MultiLineString"!=n&&"OpenLayers.Geometry.MultiPolygon"!=n)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}else for(var a=0;a<e.components.length;a++)this.drawGeometry(e.components[a],t,i)},drawExternalGraphic:function(e,t,i){var n=new Image,a=t.title||t.graphicTitle;a&&(n.title=a);var r=t.graphicWidth||t.graphicHeight,s=t.graphicHeight||t.graphicWidth;r=r?r:2*t.pointRadius,s=s?s:2*t.pointRadius;var o=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*s),u=t.graphicOpacity||t.fillOpacity,c=function(){if(this.features[i]){var t=this.getLocalXY(e),a=t[0],c=t[1];if(!isNaN(a)&&!isNaN(c)){var d=a+o|0,h=c+l|0,p=this.canvas;p.globalAlpha=u;var f=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(n,d*f,h*f,r*f,s*f),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(d,h,r,s))}}};n.onload=OpenLayers.Function.bind(c,this),n.src=t.externalGraphic},drawNamedSymbol:function(e,t,i){var n,a,r,s,o,l,u,c,d,h=Math.PI/180,p=OpenLayers.Renderer.symbol[t.graphicName];if(!p)throw new Error(t.graphicName+" is not a valid symbol name");if(p.length&&!(p.length<2)){var f=this.getLocalXY(e),m=f[0],g=f[1];if(!isNaN(m)&&!isNaN(g)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{for(l=new OpenLayers.Bounds,o=0;o<p.length;o+=2)l.extend(new OpenLayers.LonLat(p[o],p[o+1]));this.cachedSymbolBounds[t.graphicName]=l}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(m,g),this.hitDetection&&this.hitContext.translate(m,g),c=h*t.rotation,isNaN(c)||(this.canvas.rotate(c),this.hitDetection&&this.hitContext.rotate(c)),u=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight()),this.canvas.scale(u,u),this.hitDetection&&this.hitContext.scale(u,u),r=l.getCenterLonLat().lon,s=l.getCenterLonLat().lat,this.canvas.translate(-r,-s),this.hitDetection&&this.hitContext.translate(-r,-s),d=t.strokeWidth,t.strokeWidth=d/u,t.fill!==!1){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),o=0;o<p.length;o+=2)n=p[o],a=p[o+1],0==o&&this.canvas.moveTo(n,a),this.canvas.lineTo(n,a);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),o=0;o<p.length;o+=2)n=p[o],a=p[o+1],0==o&&this.canvas.moveTo(n,a),this.hitContext.lineTo(n,a);this.hitContext.closePath(),this.hitContext.fill()}}if(t.stroke!==!1){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),o=0;o<p.length;o+=2)n=p[o],a=p[o+1],0==o&&this.canvas.moveTo(n,a),this.canvas.lineTo(n,a);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",i,t,u),this.hitContext.beginPath(),o=0;o<p.length;o+=2)n=p[o],a=p[o+1],0==o&&this.hitContext.moveTo(n,a),this.hitContext.lineTo(n,a);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=d,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;t>=16777216&&(this.hitOverflow=t-16777215,t=t%16777216+1);var i="000000"+t.toString(16),n=i.length;return i="#"+i.substring(n-6,n)},setHitContextStyle:function(e,t,i,n){var a=this.featureIdToHex(t);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=a):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=a,"undefined"==typeof n?this.hitContext.lineWidth=i.strokeWidth+2:isNaN(n)||(this.hitContext.lineWidth=i.strokeWidth+2/n)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,i);else{var n=this.getLocalXY(e),a=n[0],r=n[1];if(!isNaN(a)&&!isNaN(r)){var s=2*Math.PI,o=t.pointRadius;t.fill!==!1&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(a,r,o,0,s,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(a,r,o,0,s,!0),this.hitContext.fill())),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(a,r,o,0,s,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(a,r,o,0,s,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){t.fill!==!1&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,n,a){var r=t.components,s=r.length;e.beginPath();var o=this.getLocalXY(r[0]),l=o[0],u=o[1];if(!isNaN(l)&&!isNaN(u)){e.moveTo(o[0],o[1]);for(var c=1;s>c;++c){var d=this.getLocalXY(r[c]);e.lineTo(d[0],d[1])}"fill"===a?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var n=e.components,a=n.length;this.drawLinearRing(n[0],t,i);
for(var r=1;a>r;++r)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(n[r],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(n[r],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),a=t.label.split("\n"),r=a.length;if(this.canvas.fillText){this.canvas.font=n,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var o=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;i[1]+=o*s*(r-1);for(var l=0;r>l;l++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1,this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(a[l],i[0],i[1]+o*l+1),this.canvas.restore()),this.canvas.fillText(a[l],i[0],i[1]+o*l)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var u=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==u&&(u=-.5);var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var o=this.canvas.mozMeasureText("xx");i[1]+=o*(1+s*r);for(var l=0;r>l;l++){var c=i[0]+u*this.canvas.mozMeasureText(a[l]),d=i[1]+l*o;this.canvas.translate(c,d),this.canvas.mozDrawText(a[l]),this.canvas.translate(-c,-d)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent,n=(e.x-this.featureDx)/t+-i.left/t,a=i.top/t-e.y/t;return[n,a]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,i;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var n=e.xy,a=0|n.x,r=0|n.y,s=this.hitContext.getImageData(a,r,1,1).data;if(255===s[3]){var o=s[2]+256*(s[1]+256*s[0]);if(o){t="OpenLayers_Feature_Vector_"+(o-1+this.hitOverflow);try{i=this.features[t][0]}catch(l){}}}}return i},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var i,n,a,r=[],s=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var o in this.features)this.features.hasOwnProperty(o)&&(i=this.features[o][0],n=i.geometry,this.calculateFeatureDx(n.getBounds(),s),a=this.features[o][1],this.drawGeometry(n,a,i.id),a.label&&r.push([i,a]));for(var l,u=0,c=r.length;c>u;++u)l=r[u],this.drawText(l[0].geometry.getCentroid(),l[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var e=document.createStyleSheet(),t=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],i=0,n=t.length;n>i;i++)e.addRule("olv\\:"+t[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),a=e.left/n|0,r=e.top/n-this.size.h|0;t||!this.offset?(this.offset={x:a,y:r},a=0,r=0):(a-=this.offset.x,r-=this.offset.y);var s=a-this.xOffset+" "+r;this.root.coordorigin=s;for(var o,l=[this.root,this.vectorRoot,this.textRoot],u=0,c=l.length;c>u;++u){o=l[u];var d=this.size.w+" "+this.size.h;o.coordsize=d}return this.root.style.flip="y",i},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var e,t=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],i=this.size.w+"px",n=this.size.h+"px",a=0,r=t.length;r>a;++a)e=t[a],e.style.width=i,e.style.height=n},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="olv:shape"}return i},setStyle:function(e,t,i,n){t=t||e._style,i=i||e._options;var a=t.fillColor,r=t.title||t.graphicTitle;if(r&&(e.title=r),"OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){i.isFilled=!0;var s=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;s=s?s:2*t.pointRadius,o=o?o:2*t.pointRadius;var l=this.getResolution(),u=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s),c=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o);e.style.left=((n.x-this.featureDx)/l-this.offset.x+u|0)+"px",e.style.top=(n.y/l-this.offset.y-(c+o)|0)+"px",e.style.width=s+"px",e.style.height=o+"px",e.style.flip="y",a="none",i.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var d=this.importSymbol(t.graphicName);e.path=d.path,e.coordorigin=d.left+","+d.bottom;var h=d.size;e.coordsize=h+","+h,this.drawCircle(e,n,t.pointRadius),e.style.flip="y"}else this.drawCircle(e,n,t.pointRadius);i.isFilled?e.fillcolor=a:e.filled="false";var p=e.getElementsByTagName("fill"),f=0==p.length?null:p[0];i.isFilled?(f||(f=this.createNode("olv:fill",e.id+"_fill")),f.opacity=t.fillOpacity,"OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic&&(t.graphicOpacity&&(f.opacity=t.graphicOpacity),f.src=t.externalGraphic,f.type="frame",t.graphicWidth&&t.graphicHeight||(f.aspect="atmost")),f.parentNode!=e&&e.appendChild(f)):f&&e.removeChild(f);var m=t.rotation;(void 0!==m||void 0!==e._rotation)&&(e._rotation=m,t.externalGraphic?(this.graphicRotate(e,u,c,t),f.opacity=0):"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=m||0));var g=e.getElementsByTagName("stroke"),v=0==g.length?null:g[0];return i.isStroked?(v||(v=this.createNode("olv:stroke",e.id+"_stroke"),e.appendChild(v)),v.on=!0,v.color=t.strokeColor,v.weight=t.strokeWidth+"px",v.opacity=t.strokeOpacity,v.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round",t.strokeDashstyle&&(v.dashstyle=this.dashStyle(t))):(e.stroked=!1,v&&(v.on=!1)),"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor),e},graphicRotate:function(e,t,i,n){var a,r,n=n||e._style,s=n.rotation||0;if(!n.graphicWidth||!n.graphicHeight){var o=new Image;return o.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==o.readyState||"interactive"==o.readyState)&&(a=o.width/o.height,r=Math.max(2*n.pointRadius,n.graphicWidth||0,n.graphicHeight||0),t*=a,n.graphicWidth=r*a,n.graphicHeight=r,this.graphicRotate(e,t,i,n))},this),void(o.src=n.externalGraphic)}r=Math.max(n.graphicWidth,n.graphicHeight),a=n.graphicWidth/n.graphicHeight;var l=Math.round(n.graphicWidth||r*a),u=Math.round(n.graphicHeight||r);e.style.width=l+"px",e.style.height=u+"px";var c=document.getElementById(e.id+"_image");c||(c=this.createNode("olv:imagedata",e.id+"_image"),e.appendChild(c)),c.style.width=l+"px",c.style.height=u+"px",c.src=n.externalGraphic,c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var d=s*Math.PI/180,h=Math.sin(d),p=Math.cos(d),f="progid:DXImageTransform.Microsoft.Matrix(M11="+p+",M12="+-h+",M21="+h+",M22="+p+",SizingMethod='auto expand')\n",m=n.graphicOpacity||n.fillOpacity;m&&1!=m&&(f+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+m+")\n"),e.style.filter=f;var g=new OpenLayers.Geometry.Point(-t,-i),v=new OpenLayers.Bounds(0,0,l,u).toGeometry();v.rotate(n.rotation,g);var y=v.getBounds();e.style.left=Math.round(parseInt(e.style.left)+y.left)+"px",e.style.top=Math.round(parseInt(e.style.top)-y.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,i=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t),"none"==i&&e.strokecolor!=i&&(e.strokecolor=i)},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var n=this.getResolution(),a=new OpenLayers.Bounds((i.left-this.featureDx)/n-this.offset.x|0,i.bottom/n-this.offset.y|0,(i.right-this.featureDx)/n-this.offset.x|0,i.top/n-this.offset.y|0);e.style.left=a.left+"px",e.style.top=a.top+"px",e.style.width=a.getWidth()+"px",e.style.height=a.getHeight()+"px",e.coordorigin=a.left+" "+a.top,e.coordsize=a.getWidth()+" "+a.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);return 2==i.length?1*i[0]>=2*i[1]?"longdash":1==i[0]||1==i[1]?"dot":"dash":4==i.length?1*i[0]>=2*i[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var i=document.createElement(e);return t&&(i.id=t),i.unselectable="on",i.onselectstart=OpenLayers.Function.False,i},nodeTypeCompare:function(e,t){var i=t,n=i.indexOf(":");-1!=n&&(i=i.substr(n+1));var a=e.nodeName;return n=a.indexOf(":"),-1!=n&&(a=a.substr(n+1)),i==a},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var n=this.getResolution();e.style.left=((t.x-this.featureDx)/n-this.offset.x|0)-i+"px",e.style.top=(t.y/n-this.offset.y|0)-i+"px";var a=2*i;return e.style.width=a+"px",e.style.height=a+"px",e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,i){this.setNodeDimension(e,t);for(var n,a,r,s=this.getResolution(),o=t.components.length,l=new Array(o),u=0;o>u;u++)n=t.components[u],a=(n.x-this.featureDx)/s-this.offset.x|0,r=n.y/s-this.offset.y|0,l[u]=" "+a+","+r+" l ";var c=i?" x e":" e";return e.path="m"+l.join("")+c,e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var i,n,a,r,s,o,l,u,c,d,h,p,f=this.getResolution(),m=[];for(i=0,n=t.components.length;n>i;i++){for(m.push("m"),a=t.components[i].components,r=0===i,s=null,o=null,l=0,u=a.length;u>l;l++)c=a[l],h=(c.x-this.featureDx)/f-this.offset.x|0,p=c.y/f-this.offset.y|0,d=" "+h+","+p,m.push(d),0==l&&m.push(" l"),r||(s?s!=d&&(o?o!=d&&(r=!0):o=d):s=d);m.push(r?" x ":" ")}return m.push("e"),e.path=m.join(""),e},drawRectangle:function(e,t){var i=this.getResolution();return e.style.left=((t.x-this.featureDx)/i-this.offset.x|0)+"px",e.style.top=(t.y/i-this.offset.y|0)+"px",e.style.width=(t.width/i|0)+"px",e.style.height=(t.height/i|0)+"px",e},drawText:function(e,t,i){var n=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),a=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),r=this.getResolution();n.style.left=((i.x-this.featureDx)/r-this.offset.x|0)+"px",n.style.top=(i.y/r-this.offset.y|0)+"px",n.style.flip="y",a.innerText=t.label,"inherit"!=t.cursor&&null!=t.cursor&&(a.style.cursor=t.cursor),t.fontColor&&(a.style.color=t.fontColor),t.fontOpacity&&(a.style.filter="alpha(opacity="+100*t.fontOpacity+")"),t.fontFamily&&(a.style.fontFamily=t.fontFamily),t.fontSize&&(a.style.fontSize=t.fontSize),t.fontWeight&&(a.style.fontWeight=t.fontWeight),t.fontStyle&&(a.style.fontStyle=t.fontStyle),t.labelSelect===!0&&(n._featureId=e,a._featureId=e,a._geometry=i,a._geometryClass=i.CLASS_NAME),a.style.whiteSpace="nowrap",a.inset="1px,0px,0px,0px",n.parentNode||(n.appendChild(a),this.textRoot.appendChild(n));var s=t.labelAlign||"cm";1==s.length&&(s+="m");var o=a.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(0,1)],l=a.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(1,1)];n.style.left=parseInt(n.style.left)-o-1+"px",n.style.top=parseInt(n.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id)),t&&t.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,i=this.symbolCache[t];if(i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");for(var a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),r=["m"],s=0;s<n.length;s+=2){var o=n[s],l=n[s+1];a.left=Math.min(a.left,o),a.bottom=Math.min(a.bottom,l),a.right=Math.max(a.right,o),a.top=Math.max(a.top,l),r.push(o),r.push(l),0==s&&r.push("l")}r.push("x e");var u=r.join(" "),c=(a.getWidth()-a.getHeight())/2;return c>0?(a.bottom=a.bottom-c,a.top=a.top+c):(a.left=a.left+c,a.right=a.right-c),i={path:u,size:a.getWidth(),left:a.left,bottom:a.bottom},this.symbolCache[t]=i,i},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var e=0,t=this.strategies.length;t>e;e++)this.strategies[e].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,n=new Array(i),a=0;i>a;++a)n[a]=t[a].clone();return e.features=n,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;t>e;e++){var i=this.renderers[e],n="function"==typeof i?i:OpenLayers.Renderer[i];if(n&&n.prototype.supported()){this.renderer=new n(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var e=this.map.getSize();e.w=e.w*this.ratio,e.h=e.h*this.ratio,this.renderer.setSize(e)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio,e.h=e.h*this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!i){this.renderer.root.style.visibility="hidden";var a=this.map.getSize(),r=a.w,s=a.h,o=r/2*this.ratio-r/2,l=s/2*this.ratio-s/2;o+=this.map.layerContainerOriginPx.x,o=-Math.round(o),l+=this.map.layerContainerOriginPx.y,l=-Math.round(l),this.div.style.left=o+"px",this.div.style.top=l+"px";var u=this.map.getExtent().scale(this.ratio);if(n=this.renderer.setExtent(u,t),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!t&&n)for(var c in this.unrenderedFeatures){var d=this.unrenderedFeatures[c];this.drawFeature(d)}}if(!this.drawn||t||!n){this.drawn=!0;for(var d,c=0,h=this.features.length;h>c;c++)this.renderer.locked=c!==h-1,d=this.features[c],this.drawFeature(d)}},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var e=this.div.style.display;e!=this.renderer.root.style.display&&(this.renderer.root.style.display=e)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var n={features:e},a=this.events.triggerEvent("beforefeaturesadded",n);if(a===!1)return;e=n.features}for(var r=[],s=0,o=e.length;o>s;s++){this.renderer.locked=s!=e.length-1?!0:!1;var l=e[s];if(this.geometryType&&!(l.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(l.layer=this,!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style)),i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}r.push(l),this.features.push(l),this.drawFeature(l),i&&(this.events.triggerEvent("featureadded",{feature:l}),this.onFeatureInsert(l))}i&&this.events.triggerEvent("featuresadded",{features:r})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;n>=0;n--){this.renderer.locked=0!=n&&e[n-1].geometry?!0:!1;var a=e[n];delete this.unrenderedFeatures[a.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:a}),this.features=OpenLayers.Util.removeItem(this.features,a),a.layer=null,a.geometry&&this.renderer.eraseFeatures(a),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,a)&&OpenLayers.Util.removeItem(this.selectedFeatures,a),i&&this.events.triggerEvent("featureremoved",{feature:a})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,i=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:i});for(var n,a=i.length-1;a>=0;a--)n=i[a],t&&this.events.triggerEvent("beforefeatureremoved",{feature:n}),n.layer=null,t&&this.events.triggerEvent("featureremoved",{feature:n});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],t&&this.events.triggerEvent("featuresremoved",{features:i})},destroyFeatures:function(e,t){var i=void 0==e;if(i&&(e=this.features),e){this.removeFeatures(e,t);for(var n=e.length-1;n>=0;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,i))}var n=this.renderer.drawFeature(e,t);n===!1||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,i=this.renderer.getFeatureIdFromEvent(e);return i&&(t="string"==typeof i?this.getFeatureById(i):i),t},getFeatureBy:function(e,t){for(var i=null,n=0,a=this.features.length;a>n;++n)if(this.features[n][e]==t){i=this.features[n];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,n,a=this.features.length,r=[];for(i=0;a>i;i++)n=this.features[i],n&&n.attributes&&n.attributes[e]===t&&r.push(n);return r},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,n=0,a=t.length;a>n;n++)i=t[n].geometry,i&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,n=0;n<i.length;n++)if(t=i[n].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;t<this.map.layers.length;++t)e=this.map.layers[t],-1!=OpenLayers.Util.indexOf(this.layers,e)&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;t<this.layers.length;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&-1!=OpenLayers.Util.indexOf(this.layers,t)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(e){this.layer=e},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;i>t;t++){var n=e.fid||e.id;if(n==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,i=this.filters.length;i>t;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,i=this.filters.length;i>t;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}return void 0},clone:function(){for(var e=[],t=0,i=this.filters.length;i>t;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,i=!1,n=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof n||"string"!=typeof t?n==t:n.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof n||"string"!=typeof t?n!=t:n.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:i=n<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:i=n>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:i=n<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:i=n>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:i=n>=this.lowerBoundary&&n<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var a=new RegExp(this.value,"gi");i=a.test(n);break;case OpenLayers.Filter.Comparison.IS_NULL:i=null===n}return i},value2regex:function(e,t,i){if("."==e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return e=e?e:"*",t=t?t:".",i=i?i:"!",this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+t,"g"),"."),this.value=this.value.replace(new RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t),this.value},regex2value:function(){var e=this.value;return e=e.replace(/!/g,"!!"),e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."}),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"}),e=e.replace(/\\\\/g,"\\"),e=e.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})),e},cacheFeatures:function(e){var t=!0;return this.clustering||(this.clearCache(),this.features=e.features,this.cluster(),t=!1),t},clearCache:function(){this.clustering||(this.features=null)},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var i,n,a,r=[],s=0;s<this.features.length;++s)if(i=this.features[s],i.geometry){n=!1;for(var o=r.length-1;o>=0;--o)if(a=r[o],this.shouldCluster(a,i)){this.addToCluster(a,i),n=!0;break}n||r.push(this.createCluster(this.features[s]))}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,r.length>0){if(this.threshold>1){var l=r.slice();r=[];for(var u,s=0,c=l.length;c>s;++s)u=l[s],u.attributes.count<this.threshold?Array.prototype.push.apply(r,u.cluster):r.push(u)}this.clustering=!0,this.layer.addFeatures(r),this.clustering=!1}this.clusters=r}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var i=e.geometry.getBounds().getCenterLonLat(),n=t.geometry.getBounds().getCenterLonLat(),a=Math.sqrt(Math.pow(i.lon-n.lon,2)+Math.pow(i.lat-n.lat,2))/this.resolution;return a<=this.distance},addToCluster:function(e,t){e.cluster.push(t),e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});return i.cluster=[e],i},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){var t;return t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var i,n,a=e.params.LAYERS,r=(OpenLayers.Util.isArray(a)?a[0]:a).split(":");r.length>1&&(n=r[0]),i=r.pop();var s={url:e.url,featureType:i,featurePrefix:n,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};
return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,s))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;if(i.status>=200&&i.status<300){var n=this.parseResponse(i,t.readOptions);n&&n.success!==!1?(t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,n):e.features=n,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=n)}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||i.length<=0)return null;var n=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t);if(!this.featureNS){var a=this.readFormat||this.format;this.featureNS=a.featureNS,a.autoConfig=!1,this.geometryName||this.setGeometryName(a.geometryName)}return n},commit:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,n=i.responseXML;n&&n.documentElement||(n=i.responseText);var a=this.format.read(n)||{};e.insertIds=a.insertIds||[],a.success?e.code=OpenLayers.Protocol.Response.SUCCESS:(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=a),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),n=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var a=this.format.writeNode("ogc:Filter",e);n.appendChild(a),i.appendChild(n);var r=OpenLayers.Format.XML.prototype.write.apply(this.format,[i]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:r})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++)this.rules[e].destroy(),this.rules[e]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,a=[],r=!1,s=0,o=n.length;o>s;s++){t=n[s];var l=t.evaluate(e);l&&(t instanceof OpenLayers.Rule&&t.elseFilter?a.push(t):(r=!0,this.applySymbolizer(t,i,e)))}if(0==r&&a.length>0){r=!0;for(var s=0,o=a.length;o>s;s++)this.applySymbolizer(a[s],i,e)}return n.length>0&&0==r&&(i.display="none"),null!=i.label&&"string"!=typeof i.label&&(i.label=String(i.label)),i},applySymbolizer:function(e,t,i){var n=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],a=e.symbolizer[n]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var r=this.defaultStyle;OpenLayers.Util.applyDefaults(a,{pointRadius:r.pointRadius}),(a.stroke===!0||a.graphic===!0)&&OpenLayers.Util.applyDefaults(a,{strokeWidth:r.strokeWidth,strokeColor:r.strokeColor,strokeOpacity:r.strokeOpacity,strokeDashstyle:r.strokeDashstyle,strokeLinecap:r.strokeLinecap}),(a.fill===!0||a.graphic===!0)&&OpenLayers.Util.applyDefaults(a,{fillColor:r.fillColor,fillOpacity:r.fillOpacity}),a.graphic===!0&&OpenLayers.Util.applyDefaults(a,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,a),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],i,t,n);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var i,n,a=this.rules,r=0,s=a.length;s>r;r++){i=a[r].symbolizer;for(var o in i){if(n=i[o],"object"!=typeof n){this.addPropertyStyles(e,i);break}this.addPropertyStyles(e,n)}}return e},addPropertyStyles:function(e,t){var i;for(var n in t)i=t[n],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[n]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,n=t.length;n>i;i++)if(-1!=e.CLASS_NAME.indexOf(t[i]))return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;i>t;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var n=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(n,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,n){return"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,t,[i,n]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,n){var a=[];for(var r in i)a.push(new OpenLayers.Rule({symbolizer:i[r],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:r})}));this.styles[e].addRules(a)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(e){this.symbolizer={},OpenLayers.Util.extend(this,e),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e in this.symbolizer)this.symbolizer[e]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(e){var t=this.getContext(e),i=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var n=e.layer.map.getScale();return this.minScaleDenominator&&(i=n>=OpenLayers.Style.createLiteral(this.minScaleDenominator,t)),i&&this.maxScaleDenominator&&(i=n<OpenLayers.Style.createLiteral(this.maxScaleDenominator,t)),i&&this.filter&&(i=this.filter.evaluate("OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?e:t)),i},getContext:function(e){var t=this.context;return t||(t=e.attributes||e.data),"function"==typeof this.context&&(t=this.context(e)),t},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var t=this.symbolizers.length;e.symbolizers=new Array(t);for(var i=0;t>i;++i)e.symbolizers[i]=this.symbolizers[i].clone()}else{e.symbolizer={};var n,a;for(var r in this.symbolizer)n=this.symbolizer[r],a=typeof n,"object"===a?e.symbolizer[r]=OpenLayers.Util.extend({},n):"string"===a&&(e.symbolizer[r]=n)}return e.filter=this.filter&&this.filter.clone(),e.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(){throw new Error("Read not implemented.")},write:function(){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;return t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,t.loadXML(e),t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return this.keepData&&(this.data=i),i},write:function(e){var t;if(this.xmldom)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var n=document.implementation.createDocument("","",null);n.importNode&&(e=n.importNode(e,!0)),n.appendChild(e),t=i.serializeToString(n)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){var i;return i=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createDocumentFragment:function(){var e;return e=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(e){var t;return"string"!=typeof e&&(e=String(e)),t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var n=[];if(e.getElementsByTagNameNS)n=e.getElementsByTagNameNS(t,i);else for(var a,r,s=e.getElementsByTagName("*"),o=0,l=s.length;l>o;++o)a=s[o],r=a.prefix?a.prefix+":"+i:i,("*"==i||r==a.nodeName)&&("*"==t||t==a.namespaceURI)&&n.push(a);return n},getAttributeNodeNS:function(e,t,i){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,i);else for(var a,r,s=e.attributes,o=0,l=s.length;l>o;++o)if(a=s[o],a.namespaceURI==t&&(r=a.prefix?a.prefix+":"+i:i,r==a.nodeName)){n=a;break}return n},getAttributeNS:function(e,t,i){var n="";if(e.getAttributeNS)n=e.getAttributeNS(t,i)||"";else{var a=this.getAttributeNodeNS(e,t,i);a&&(n=a.nodeValue)}return n},getChildValue:function(e,t){var i=t||"";if(e)for(var n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:i+=n.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,n=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,a=e.firstChild;a;a=a.nextSibling){switch(a.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)n=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return n},hasAttributeNS:function(e,t,i){var n=!1;return n=e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,n){if(e.setAttributeNS)e.setAttributeNS(t,i,n);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var a=e.ownerDocument.createNode(2,i,t);a.nodeValue=n,e.setAttributeNode(a)}else e.setAttribute(i,n)}},createElementNSPlus:function(e,t){t=t||{};var i=t.uri||this.namespaces[t.prefix];if(!i){var n=e.indexOf(":");i=this.namespaces[e.substring(0,n)]}i||(i=this.namespaces[this.defaultPrefix]);var a=this.createElementNS(i,e);t.attributes&&this.setAttributes(a,t.attributes);var r=t.value;return null!=r&&a.appendChild(this.createTextNode(r)),a},setAttributes:function(e,t){var i,n;for(var a in t)null!=t[a]&&t[a].toString&&(i=t[a].toString(),n=this.namespaces[a.substring(0,a.indexOf(":"))]||null,this.setAttributeNS(e,n,a,i))},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var n=e.localName||e.nodeName.split(":").pop(),a=i[n]||i["*"];a&&a.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,n=e.childNodes,a=0,r=n.length;r>a;++a)i=n[a],1==i.nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var n,a,r=e.indexOf(":");r>0?(n=e.substring(0,r),a=e.substring(r+1)):(n=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,a=e);var s=this.writers[n][a].apply(this,[t]);return i&&i.appendChild(s),s},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var n=e;n;n=n.nextSibling)switch(n.nodeType){case 1:if(!(t&&t!==(n.localName||n.nodeName.split(":").pop())||i&&i!==n.namespaceURI))break e;n=null;break e;case 3:if(/^\s*$/.test(n.nodeValue))break;case 4:case 6:case 12:case 10:case 11:n=null;break e}return n||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var n=e.attributes.length;if(n)for(var a,r=0;n>r;++r){if(a=e.attributes[r],"xmlns"===a.prefix&&a.name==="xmlns:"+t){i=a.value||null;break e}if("xmlns"===a.name&&null===t){i=a.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version,i||(i=e.getAttribute("version"),i||(i=this.defaultVersion))):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i&&(""!==t&&this.allowFallback&&(t="",i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]),!i))throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var n=this.parser.write(e,t);return this.stringifyOutput===!1?n:OpenLayers.Format.XML.prototype.write.apply(this,[n])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,n=this.getVersion(i);this.parser=this.getParser(n);var a=this.parser.read(e,t),r=this.parser.errorProperty||null;if(null!==r&&void 0===a[r]){var s=new OpenLayers.Format.OGCExceptionReport;a.error=s.read(e)}return a.version=n,a},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],n=0;n<t.length;n++){var a=this.parseFeature(t[n]);a&&i.push(a)}return i},parseFeature:function(e){for(var t,i,n,a,r=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],s=0;s<r.length;++s)if(t=r[s],i=this.getElementsByTagNameNS(e,this.gmlns,t),i.length>0){if(a=this.parseGeometry[t.toLowerCase()],!a)throw new TypeError("Unsupported geometry type: "+t);n=a.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var o,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(s=0;s<l.length;++s){var u=l[s],c=this.parseGeometry.box.apply(this,[u]),d=u.parentNode,h=d.localName||d.nodeName.split(":").pop();"boundedBy"===h?o=c:n=c.toGeometry()}var p;this.extractAttributes&&(p=this.parseAttributes(e));var f=new OpenLayers.Feature.Vector(n,p);f.bounds=o,f.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var m,g=e.firstChild;g&&(1!=g.nodeType||!(m=g.getAttribute("fid")||g.getAttribute("id")));)g=g.nextSibling;return f.fid=m,f},parseGeometry:{point:function(e){var t,i,n=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.trimSpace,""),n=i.split(this.regExes.splitSpace)),0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),n=i.split(","))),0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord"),t.length>0)){var a=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),r=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");a.length>0&&r.length>0&&(n=[a[0].firstChild.nodeValue,r[0].firstChild.nodeValue])}return 2==n.length&&(n[2]=null),this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(t.length>0)for(var n,a=0;a<t.length;++a)n=this.parseGeometry.point.apply(this,[t[a]]),n&&i.push(n);return new OpenLayers.Geometry.MultiPoint(i)},linestring:function(e,t){var i,n,a=[],r=[];if(i=this.getElementsByTagNameNS(e,this.gmlns,"posList"),i.length>0){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),a=n.split(this.regExes.splitSpace);for(var s,o,l,u,c=parseInt(i[0].getAttribute("dimension")),d=0;d<a.length/c;++d)s=d*c,o=a[s],l=a[s+1],u=2==c?null:a[s+2],r.push(this.xy?new OpenLayers.Geometry.Point(o,l,u):new OpenLayers.Geometry.Point(l,o,u))}if(0==a.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i.length>0)){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),n=n.replace(this.regExes.trimComma,",");for(var h=n.split(this.regExes.splitSpace),d=0;d<h.length;++d)a=h[d].split(","),2==a.length&&(a[2]=null),r.push(this.xy?new OpenLayers.Geometry.Point(a[0],a[1],a[2]):new OpenLayers.Geometry.Point(a[1],a[0],a[2]))}var p=null;return 0!=r.length&&(p=t?new OpenLayers.Geometry.LinearRing(r):new OpenLayers.Geometry.LineString(r)),p},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(t.length>0)for(var n,a=0;a<t.length;++a)n=this.parseGeometry.linestring.apply(this,[t[a]]),n&&i.push(n);return new OpenLayers.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(t.length>0)for(var n,a=0;a<t.length;++a)n=this.parseGeometry.linestring.apply(this,[t[a],!0]),n&&i.push(n);return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(t.length>0)for(var n,a=0;a<t.length;++a)n=this.parseGeometry.polygon.apply(this,[t[a]]),n&&i.push(n);return new OpenLayers.Geometry.MultiPolygon(i)},envelope:function(e){var t,i,n=[],a=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(a.length>0){var r=[];if(a.length>0&&(t=a[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),r=t.split(this.regExes.splitSpace)),2==r.length&&(r[2]=null),this.xy)var s=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);else var s=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){var r=[];if(o.length>0&&(t=o[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),r=t.split(this.regExes.splitSpace)),2==r.length&&(r[2]=null),this.xy)var l=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);else var l=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}if(s&&l){n.push(new OpenLayers.Geometry.Point(s.x,s.y)),n.push(new OpenLayers.Geometry.Point(l.x,s.y)),n.push(new OpenLayers.Geometry.Point(l.x,l.y)),n.push(new OpenLayers.Geometry.Point(s.x,l.y)),n.push(new OpenLayers.Geometry.Point(s.x,s.y));var u=new OpenLayers.Geometry.LinearRing(n);i=new OpenLayers.Geometry.Polygon([u])}return i},box:function(e){var t,i,n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),a=null,r=null;return n.length>0&&(t=n[0].firstChild.nodeValue,i=t.split(" "),2==i.length&&(a=i[0].split(","),r=i[1].split(","))),null!==a&&null!==r?new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(r[0]),parseFloat(r[1])):void 0}},parseAttributes:function(e){for(var t,i,n,a,r,s,o,l={},u=e.firstChild;u;){if(1==u.nodeType){for(t=u.childNodes,i=0;i<t.length;++i)n=t[i],1==n.nodeType&&(a=n.childNodes,1==a.length?(r=a[0],(3==r.nodeType||4==r.nodeType)&&(s=n.prefix?n.nodeName.split(":")[1]:n.nodeName,o=r.nodeValue.replace(this.regExes.trimSpace,""),l[s]=o)):l[n.nodeName.split(":").pop()]=null);break}u=u.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<e.length;i++)t.appendChild(this.createFeatureXML(e[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);n.appendChild(i);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),s=e.fid||e.id;r.setAttribute("fid",s),r.appendChild(n);for(var o in e.attributes){var l=this.createTextNode(e.attributes[o]),u=o.substring(o.lastIndexOf(":")+1),c=this.createElementNS(this.featureNS,this.featurePrefix+":"+u);c.appendChild(l),r.appendChild(c)}return a.appendChild(r),a},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[i.toLowerCase()];return n.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPoint"),a=e.components,r=0;r<a.length;r++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[a[r]]),t.appendChild(i),n.appendChild(t);return n},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiLineString"),a=e.components,r=0;r<a.length;++r)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[a[r]]),t.appendChild(i),n.appendChild(t);return n},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n,a=this.createElementNS(this.gmlns,"gml:Polygon"),r=e.components,s=0;s<r.length;++s)n=0==s?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+n),i=this.buildGeometry.linearring.apply(this,[r[s]]),t.appendChild(i),a.appendChild(t);return a},multipolygon:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPolygon"),a=e.components,r=0;r<a.length;++r)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[a[r]]),t.appendChild(i),n.appendChild(t);return n},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds)i.push(e.left+","+e.bottom),i.push(e.right+","+e.top);else for(var n=e.components?e.components:[e],a=0;a<n.length;a++)i.push(n[a].x+","+n[a].y);var r=this.createTextNode(i.join(" "));return t.appendChild(r),t},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t=[];if(this.readNode(e,{features:t},!0),0==t.length){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length)for(var n=0,a=i.length;a>n;++n)this.readNode(i[n],{features:t},!0);else{var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");i.length&&this.readNode(i[0],{features:t},!0)}}return t},readNode:function(e,t,i){return i===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var n,a=i.split(this.regExes.splitSpace),r=a.length,s=new Array(r),o=0;r>o;++o)n=a[o].split(","),s[o]=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2]);t.points=s},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)
},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,n=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,n)?n===this.featureType&&(i="_typeName"):i="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry",i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var n=new OpenLayers.Feature.Vector(i.components[0],i.attributes);this.singleFeatureType||(n.type=e.nodeName.split(":").pop(),n.namespace=e.namespaceURI);var a=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");a&&(n.fid=a),this.internalProjection&&this.externalProjection&&n.geometry&&n.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(n.bounds=i.bounds),t.features.push(n)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),n=this.getChildValue(e);t.attributes[i]=n}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],n=0,a=i.length;a>n;++n)this.writeNode("pointMember",i[n],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],n=0,a=i.length;a>n;++n)this.writeNode("lineStringMember",i[n],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],n=0,a=i.length;a>n;++n)this.writeNode("polygonMember",i[n],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,n=e.components.length;n>i;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var i in e.attributes){var n=e.attributes[i];null!=n&&this.writeNode("feature:_attribute",{name:i,value:n},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],n=this.writeNode("gml:"+i,e,t);return this.srsName&&n.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,n=e.length;n>i;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],a=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,n=new Array(i),a=0;i>a;++a)t=e[a],n[a]=this.xy?t.x+","+t.y:t.y+","+t.x,void 0!=t.z&&(n[a]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?n[0]:n.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,i){var n=parseInt(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;n&&(t.srsDimension=n)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,n=this.getChildValue(e).replace(this.regExes.trimSpace,""),a=n.split(this.regExes.splitSpace);i=this.xy?new OpenLayers.Geometry.Point(a[0],a[1],a[2]):new OpenLayers.Geometry.Point(a[1],a[0],a[2]),t.points=[i]},posList:function(e,t){for(var i,n,a,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),s=r.split(this.regExes.splitSpace),o=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,l=s.length/o,u=new Array(l),c=0,d=s.length;d>c;c+=o)i=s[c],n=s[c+1],a=2==o?void 0:s[c+2],u[c/o]=this.xy?new OpenLayers.Geometry.Point(i,n,a):new OpenLayers.Geometry.Point(n,i,a);t.points=u},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],a=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,a.x,a.y))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,n=e.length;n>i;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,n=new Array(i),a=0;i>a;++a)t=e[a],n[a]=this.xy?t.x+" "+t.y:t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:n.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,n=e.components.length;n>i;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,n=e.components.length;n>i;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],n=0,a=i.length;a>n;++n)this.writeNode("curveMember",i[n],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],n=0,a=i.length;a>n;++n)this.writeNode("surfaceMember",i[n],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=walk(i,t[i]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,n=typeof e;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[n].apply(this,[e])}catch(a){OpenLayers.Console.error("Trouble serializing: "+a)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,n,a,r=!1;for(i in e)e.hasOwnProperty(i)&&(n=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),a=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=n&&null!=a&&(r&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),a),r=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var n=0,a=e.length;a>n;++n)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),null!=t&&(n>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var n=t[i];return n?n:(n=i.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t?t:"FeatureCollection";var n=null,a=null;if(a="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof a.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(a,t))switch(t){case"Geometry":try{n=this.parseGeometry(a)}catch(r){OpenLayers.Console.error(r)}break;case"Feature":try{n=this.parseFeature(a),n.type="Feature"}catch(r){OpenLayers.Console.error(r)}break;case"FeatureCollection":switch(n=[],a.type){case"Feature":try{n.push(this.parseFeature(a))}catch(r){n=null,OpenLayers.Console.error(r)}break;case"FeatureCollection":for(var s=0,o=a.features.length;o>s;++s)try{n.push(this.parseFeature(a.features[s]))}catch(r){n=null,OpenLayers.Console.error(r)}break;default:try{var l=this.parseGeometry(a);n.push(new OpenLayers.Feature.Vector(l))}catch(r){n=null,OpenLayers.Console.error(r)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return n},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,n,a;n=e.properties?e.properties:{},a=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(r){throw r}return t=new OpenLayers.Feature.Vector(i,n),a&&(t.bounds=OpenLayers.Bounds.fromArray(a)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var n=e.geometries.length,a=new Array(n),r=0;n>r;++r)a[r]=this.parseGeometry.apply(this,[e.geometries[r]]);t=new OpenLayers.Geometry.Collection(a),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(s){throw s}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,n=0,a=e.length;a>n;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,n=0,a=e.length;a>n;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,n=0,a=e.length;a>n;++n){try{i=this.parseCoords.linestring.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,n=[],a=0,r=e.length;r>a;++a){try{i=this.parseCoords.linestring.apply(this,[e[a]])}catch(s){throw s}t=new OpenLayers.Geometry.LinearRing(i.components),n.push(t)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){for(var t=[],i=null,n=0,a=e.length;a>n;++n){try{i=this.parseCoords.polygon.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var n=e.length;i.features=new Array(n);for(var a=0;n>a;++a){var r=e[a];if(!r instanceof OpenLayers.Feature.Vector){var s="FeatureCollection only supports collections of features: "+r;throw s}i.features[a]=this.extract.feature.apply(this,[r])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),i={};if(t.match(/epsg:/i)){var n=parseInt(t.substring(t.indexOf(":")+1));i=4326==n?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+n}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t,i=e.CLASS_NAME.split(".")[2],n=this.extract[i.toLowerCase()].apply(this,[e]);return t="Collection"==i?{type:"GeometryCollection",geometries:n}:{type:i,coordinates:n}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=new Array(t),n=0;t>n;++n)i[n]=this.extract.geometry.apply(this,[e.components[n]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement;if(i){var n=this["read_"+i.nodeName];t=n?n.call(this,i):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],i=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(i)for(var n=0,a=i.length;a>n;++n){var r=i[n],s=r.nodeName;r.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(r,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var u=o[l],c=this.parseGeometry(u),d=this.parseAttributes(u),h=new OpenLayers.Feature.Vector(c.geometry,d,null);h.bounds=c.bounds,h.type=s,t.push(h)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],i=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,a=i.length;a>n;n++){var r,s=i[n],o=null,l={},u=s.attributes.length;if(u>0)for(r=0;u>r;r++){var c=s.attributes[r];l[c.nodeName]=c.nodeValue}else{var d=s.childNodes;for(r=0,u=d.length;u>r;++r){var h=d[r];3!=h.nodeType&&(l[h.getAttribute("name")]=h.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var i,n,a,r,s,o=[];if(e&&e.hasChildNodes()){i=e.childNodes,a=i.length;for(var l=0;a>l;l++){for(s=i[l];s&&1!=s.nodeType;)s=s.nextSibling,l++;n=s?s.nodeName:"",n.length>0&&n.indexOf(t)>-1?o.push(s):(r=this.getSiblingNodesByTagCriteria(s,t),r.length>0&&(0==o.length?o=r:o.push(r)))}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var i=e.childNodes,n=i.length,a=0;n>a;++a){var r=i[a];if(1==r.nodeType){var s=r.childNodes,o=r.prefix?r.nodeName.split(":")[1]:r.nodeName;if(0==s.length)t[o]=null;else if(1==s.length){var l=s[0];if(3==l.nodeType||4==l.nodeType){var u=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=u}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,i=this.gmlFormat.parseFeature(e),n=null;return i&&(t=i.geometry&&i.geometry.clone(),n=i.bounds&&i.bounds.clone(),i.destroy()),{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e){var t=this.version;if(!t){var i=e.getAttribute("xmlns:ows");i&&"1.1"===i.substring(i.lastIndexOf("/")+1)&&(t="1.1.0"),t||(t=this.defaultVersion)}return t},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.get.push(i)},Post:function(e,t){t.post||(t.post=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.post.push(i)},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){t.constraints||(t.constraints={});var i=e.getAttribute("name");t.constraints[i]={},this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var n=i.split(this.regExes.splitSpace);t.left=n[0],t.bottom=n[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var n=i.split(this.regExes.splitSpace);t.right=n[0],t.top=n[1],t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top),delete t.left,delete t.bottom,delete t.right,delete t.top
},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,i),this.writeNode("ows:UpperCorner",e,i),i},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var i,n=e.contents,a=(n.layers,0),r=n.layers.length;r>a;++a)if(n.layers[a].identifier===t.layer){i=n.layers[a];break}if(!i)throw new Error("Layer not found");var s=t.format;!s&&i.formats&&i.formats.length&&(s=i.formats[0]);var o;if(t.matrixSet?o=n.tileMatrixSets[t.matrixSet]:i.tileMatrixSetLinks.length>=1&&(o=n.tileMatrixSets[i.tileMatrixSetLinks[0].tileMatrixSet]),!o)throw new Error("matrixSet not found");for(var l,a=0,r=i.styles.length;r>a&&(l=i.styles[a],!l.isDefault);++a);var u=t.requestEncoding;if(!u&&(u="KVP",e.operationsMetadata.GetTile.dcp.http)){var c=e.operationsMetadata.GetTile.dcp.http;if(c.get[0].constraints){var d=c.get[0].constraints,h=d.GetEncoding.allowedValues;h.KVP||!h.REST&&!h.RESTful||(u="REST")}}var p=[],f=t.params||{};delete t.params;for(var m=0,g=i.dimensions.length;g>m;m++){var v=i.dimensions[m];p.push(v.identifier),f.hasOwnProperty(v.identifier)||(f[v.identifier]=v["default"])}var y=t.projection||o.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),b=t.units||("EPSG:4326"===y?"degrees":"m"),k=[];for(var _ in o.matrixIds)o.matrixIds.hasOwnProperty(_)&&k.push(28e-5*o.matrixIds[_].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[b]);var w;if("REST"===u&&i.resourceUrls){w=[];for(var L,x=(i.resourceUrls,0),S=i.resourceUrls.length;S>x;++x)L=i.resourceUrls[x],L.format===s&&"tile"===L.resourceType&&w.push(L.template)}else{var O=e.operationsMetadata.GetTile.dcp.http.get;w=[];for(var T,a=0,r=O.length;r>a;a++)T=O[a].constraints,(!T||T&&T.GetEncoding.allowedValues[u])&&w.push(O[a].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(t,{url:w,requestEncoding:u,name:i.title,style:l.identifier,format:s,matrixIds:o.matrixIds,matrixSet:o.identifier,projection:y,units:b,resolutions:t.isBaseLayer===!1?void 0:k,serverResolutions:k,tileFullExtent:o.bounds,dimensions:p,params:f}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};i.layers=[],this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,n=this.getChildValue(e),a=n.split(" ");if(t.supportedCRS){var r=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[r]}t.topLeftCorner=i?new OpenLayers.LonLat(a[1],a[0]):new OpenLayers.LonLat(a[0],a[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var n=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(n)},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},LegendURL:function(e,t){t.legend={},t.legend.href=e.getAttribute("xlink:href"),t.legend.format=e.getAttribute("format")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t["default"]=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,n;e=e.replace(/[\n\r]/g," ");var a=this.regExes.typeStr.exec(e);if(a&&(i=a[1].toLowerCase(),n=a[2],this.parse[i]&&(t=this.parse[i].apply(this,[n])),this.internalProjection&&this.externalProjection))if(t&&"OpenLayers.Feature.Vector"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==typeof t)for(var r=0,s=t.length;s>r;r++){var o=t[r];o.geometry.transform(this.externalProjection,this.internalProjection)}return t},write:function(e){var t,i,n;e.constructor==Array?(t=e,n=!0):(t=[e],n=!1);var a=[];n&&a.push("GEOMETRYCOLLECTION(");for(var r=0,s=t.length;s>r;++r)n&&r>0&&a.push(","),i=t[r].geometry,a.push(this.extractGeometry(i));return n&&a.push(")"),a.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t])return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var i="collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase(),n=i+"("+this.extract[t].apply(this,[e])+")";return n},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=OpenLayers.String.trim(e).split(","),n=[],a=0,r=i.length;r>a;++a)t=i[a].replace(this.regExes.trimParens,"$1"),n.push(this.parse.point.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(n))},linestring:function(e){for(var t=OpenLayers.String.trim(e).split(","),i=[],n=0,a=t.length;a>n;++n)i.push(this.parse.point.apply(this,[t[n]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.parenComma),n=[],a=0,r=i.length;r>a;++a)t=i[a].replace(this.regExes.trimParens,"$1"),n.push(this.parse.linestring.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(n))},polygon:function(e){for(var t,i,n,a=OpenLayers.String.trim(e).split(this.regExes.parenComma),r=[],s=0,o=a.length;o>s;++s)t=a[s].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,n=new OpenLayers.Geometry.LinearRing(i.components),r.push(n);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(r))},multipolygon:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma),n=[],a=0,r=i.length;r>a;++a)t=i[a].replace(this.regExes.trimParens,"$1"),n.push(this.parse.polygon.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(n))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=OpenLayers.String.trim(e).split("|"),i=[],n=0,a=t.length;a>n;++n)i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[n]]));return i}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t,i="",n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 1:t=this.readNode(n),t.property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=n.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(){},PropertyIsNull:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,i),t.filters.push(i)}}},readSpatial:function(e,t,i){var n=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,n),n.value=n.components[0],delete n.components,t.filters.push(n)},encodeLiteral:function(e){return e instanceof Date&&(e=OpenLayers.Date.toISOString(e)),e},writeOgcExpression:function(e,t){return e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t),t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(e),e,t),t},_featureIds:function(e){for(var t=this.createDocumentFragment(),i=0,n=e.fids.length;n>i;++i)this.writeNode("ogc:FeatureId",e.fids[i],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),n=0,a=e.filters.length;a>n;++n)t=e.filters[n],this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),n=0,a=e.filters.length;a>n;++n)t=e.filters[n],this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,n=0,a=i.length;a>n;n++)this.writeOgcExpression(i[n],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",e,t),t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),a=e.getAttribute("singleChar"),r=e.getAttribute("escape");i.value2regex(n,a,r),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),a=e.getAttribute("singleChar"),r=e.getAttribute("escapeChar");i.value2regex(n,a,r),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,n=e.length;n>i;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},OpenLayers.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),n=this.schemaLocationAttr();return n&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",n),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,n=this.featureType.length;n>i;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){e=e||{};var t,i,n=e.options||{},a=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:n.handle}}),r=e.features;if(r){n.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var s,o;for(t=0,i=r.length;i>t;++t)o=r[t],s=this.stateName[o.state],s&&this.writeNode(s,{feature:o,options:n},a);n.multi===!0&&this.setGeometryTypes()}if(n.nativeElements)for(t=0,i=n.nativeElements.length;i>t;++t)this.writeNode("wfs:Native",n.nativeElements[t],a);return a},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,n),n},Update:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&this.setAttributeNS(n,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS);var a=t.modified;null===this.geometryName||a&&void 0===a.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},n));for(var r in t.attributes)void 0===t.attributes[r]||a&&a.attributes&&(!a.attributes||void 0===a.attributes[r])||this.writeNode("Property",{name:r,value:t.attributes[r]},n);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&this.setAttributeNS(n,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,n=[];for(var a in t)i=this.namespaces[a],i&&n.push(i+" "+t[a]);var r=n.join(" ")||void 0;return r},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;i>t;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds=t.insertIds.concat(i.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);
var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&this.setAttributeNS(i,this.namespaces.xmlns,"xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,a=e.propertyNames.length;a>n;n++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS&&this.setAttributeNS(i,this.namespaces.xmlns,"xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,a=e.propertyNames.length;a>n;n++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,i)),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==typeof OpenLayers.Lang[i[0]]&&(t=i[0]),i[1]){var n=i[0]+"-"+i[1].toUpperCase();"object"==typeof OpenLayers.Lang[n]&&(t=n)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()],n=i&&i[e];return n||(n=e),t&&(n=OpenLayers.String.format(n,t)),n}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.applyDefaults(e,this.options),e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.createRequest(e.url,e.params,OpenLayers.Function.bind(function(i){t.data=i,this.handleRead(t,e)},this));return t.priv=i,t},createRequest:function(e,t,i){var n=OpenLayers.Protocol.Script.register(i),a=OpenLayers.String.format(this.callbackTemplate,{id:n});t=OpenLayers.Util.extend({},t),t[this.callbackKey]=this.callbackPrefix+a,e=OpenLayers.Util.urlAppend(e,OpenLayers.Util.getParameterString(t));var r=document.createElement("script");r.type="text/javascript",r.src=e,r.id="OpenLayers_Protocol_Script_"+n,this.pendingRequests[r.id]=r;var s=document.getElementsByTagName("head")[0];return s.appendChild(r),r},destroyRequest:function(e){OpenLayers.Protocol.Script.unregister(e.id.split("_").pop()),delete this.pendingRequests[e.id],e.parentNode&&e.parentNode.removeChild(e)},handleRead:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){t.callback&&(e.data?(e.features=this.parseFeatures(e.data),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(e.priv),t.callback.call(t.scope,e))},parseFeatures:function(e){return this.format.read(e)},abort:function(e){if(e)this.destroyRequest(e.priv);else for(var t in this.pendingRequests)this.destroyRequest(this.pendingRequests[t])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var e=OpenLayers.Protocol.Script,t=0;e.registry={},e.register=function(i){var n="c"+ ++t;return e.registry[n]=function(){i.apply(this,arguments)},n},e.unregister=function(t){delete e.registry[t]}}(),define("libraries/OpenLayers/OpenLayers.2_13_1-full-map",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/openlayers/theme/default/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,define("src/oskari/map-ol2/module",["oskari","jquery","libraries/proj4js-1.0.1/proj4js-compressed","libraries/OpenLayers/OpenLayers.2_13_1-full-map","css!resources/openlayers/theme/default/style.css"],function(e){return e.bundleCls("ol2").category({__name:"lib-ol2",getName:function(){return this.__name},create:function(){return this},update:function(){},start:function(){},stop:function(){}})}),function(e){define("jquery-ui",["jquery"],function(){return function(){return function(e,t){function i(t,i){var a,r,s,o=t.nodeName.toLowerCase();return"area"===o?(a=t.parentNode,r=a.name,t.href&&r&&"map"===a.nodeName.toLowerCase()?(s=e("img[usemap=#"+r+"]")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var a=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var n=this;setTimeout(function(){e(n).focus(),i&&i.call(n)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,a,r=e(this[0]);r.length&&r[0]!==document;){if(n=r.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(a=parseInt(r.css("zIndex"),10),!isNaN(a)&&0!==a))return a;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),a=isNaN(n);return(a||n>=0)&&i(t,!a)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));i.offsetHeight,e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function a(t,i,n,a){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?o["inner"+n].call(this):this.each(function(){e(this).css(s,a(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?o["outer"+n].call(this,t):this.each(function(){e(this).css(s,a(this,t,!0,i)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var a,r=e.ui[t].prototype;for(a in n)r.plugins[a]=r.plugins[a]||[],r.plugins[a].push([i,n[a]])},call:function(e,t,i){var n,a=e.plugins[t];if(a&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<a.length;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}},contains:e.contains,hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return t[n]>0?!0:(t[n]=1,a=t[n]>0,t[n]=0,a)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,n,a,r,s){return e.ui.isOverAxis(t,n,r)&&e.ui.isOverAxis(i,a,s)}}))}(jQuery),function(e,t){var i=0,n=Array.prototype.slice,a=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(r){}a(t)},e.widget=function(t,i,n){var a,r,s,o,l=t.split(".")[0];t=t.split(".")[1],a=l+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[l]=e[l]||{},r=e[l][t],s=e[l][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),o=new i,o.options=e.widget.extend({},o.options),e.each(n,function(t,a){e.isFunction(a)&&(n[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=n,t=a.apply(this,arguments),this._super=i,this._superApply=r,t}}())}),s.prototype=e.widget.extend(o,{widgetEventPrefix:r?o.widgetEventPrefix:t},n,{constructor:s,namespace:l,widgetName:t,widgetBaseClass:a,widgetFullName:a}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete r._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var a,r,s=n.call(arguments,1),o=0,l=s.length;l>o;o++)for(a in s[o])r=s[o][a],s[o].hasOwnProperty(a)&&r!==t&&(i[a]=e.isPlainObject(r)?e.isPlainObject(i[a])?e.widget.extend({},i[a],r):e.widget.extend({},r):r);return i},e.widget.bridge=function(i,a){var r=a.prototype.widgetFullName||i;e.fn[i]=function(s){var o="string"==typeof s,l=n.call(arguments,1),u=this;return s=!o&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,this.each(o?function(){var n,a=e.data(this,r);return a?e.isFunction(a[s])&&"_"!==s.charAt(0)?(n=a[s].apply(a,l),n!==a&&n!==t?(u=n&&n.jquery?u.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")}:function(){var t=e.data(this,r);t?t.option(s||{})._init():e.data(this,r,new a(s,this))}),u}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetName,this),e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var a,r,s,o=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(o={},a=i.split("."),i=a.shift(),a.length){for(r=o[i]=e.widget.extend({},this.options[i]),s=0;s<a.length-1;s++)r[a[s]]=r[a[s]]||{},r=r[a[s]];if(i=a.pop(),n===t)return r[i]===t?null:r[i];r[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];o[i]=n}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var a,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=a=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,a=this.widget()),e.each(n,function(n,s){function o(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(o.guid=s.guid=s.guid||o.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),u=l[1]+r.eventNamespace,c=l[2];c?a.delegate(c,u,o):i.bind(u,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var a,r,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(a in r)a in i||(i[a]=r[a]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,a,r){"string"==typeof a&&(a={effect:a});var s,o=a?a===!0||"number"==typeof a?i:a.effect||i:t;a=a||{},"number"==typeof a&&(a={duration:a}),s=!e.isEmptyObject(a),a.complete=r,a.delay&&n.delay(a.delay),s&&e.effects&&(e.effects.effect[o]||e.uiBackCompat!==!1&&e.effects[o])?n[t](a):o!==t&&n[o]?n[o](a.duration,a.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,a=1===i.which,r="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return a&&!r&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function i(e,t,i){return[parseInt(e[0],10)*(h.test(e[0])?t/100:1),parseInt(e[1],10)*(h.test(e[1])?i/100:1)]}function n(t,i){return parseInt(e.css(t,i),10)||0}e.ui=e.ui||{};var a,r=Math.max,s=Math.abs,o=Math.round,l=/left|center|right/,u=/top|center|bottom/,c=/[\+\-]\d+%?/,d=/^\w+/,h=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(a!==t)return a;var i,n,r=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=r.children()[0];return e("body").append(r),i=s.offsetWidth,r.css("overflow","scroll"),n=s.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),a=i-n},getScrollInfo:function(t){var i=t.isWindow?"":t.element.css("overflow-x"),n=t.isWindow?"":t.element.css("overflow-y"),a="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,r="scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return p.apply(this,arguments);t=e.extend({},t);var a,h,f,m,g,v=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),k=v[0],_=(t.collision||"flip").split(" "),w={};return 9===k.nodeType?(h=v.width(),f=v.height(),m={top:0,left:0}):e.isWindow(k)?(h=v.width(),f=v.height(),m={top:v.scrollTop(),left:v.scrollLeft()}):k.preventDefault?(t.at="left top",h=f=0,m={top:k.pageY,left:k.pageX}):(h=v.outerWidth(),f=v.outerHeight(),m=v.offset()),g=e.extend({},m),e.each(["my","at"],function(){var e,i,n=(t[this]||"").split(" ");1===n.length&&(n=l.test(n[0])?n.concat(["center"]):u.test(n[0])?["center"].concat(n):["center","center"]),n[0]=l.test(n[0])?n[0]:"center",n[1]=u.test(n[1])?n[1]:"center",e=c.exec(n[0]),i=c.exec(n[1]),w[this]=[e?e[0]:0,i?i[0]:0],t[this]=[d.exec(n[0])[0],d.exec(n[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===t.at[0]?g.left+=h:"center"===t.at[0]&&(g.left+=h/2),"bottom"===t.at[1]?g.top+=f:"center"===t.at[1]&&(g.top+=f/2),a=i(w.at,h,f),g.left+=a[0],g.top+=a[1],this.each(function(){var l,u,c=e(this),d=c.outerWidth(),p=c.outerHeight(),k=n(this,"marginLeft"),L=n(this,"marginTop"),x=d+k+n(this,"marginRight")+b.width,S=p+L+n(this,"marginBottom")+b.height,O=e.extend({},g),T=i(w.my,c.outerWidth(),c.outerHeight());"right"===t.my[0]?O.left-=d:"center"===t.my[0]&&(O.left-=d/2),"bottom"===t.my[1]?O.top-=p:"center"===t.my[1]&&(O.top-=p/2),O.left+=T[0],O.top+=T[1],e.support.offsetFractions||(O.left=o(O.left),O.top=o(O.top)),l={marginLeft:k,marginTop:L},e.each(["left","top"],function(i,n){e.ui.position[_[i]]&&e.ui.position[_[i]][n](O,{targetWidth:h,targetHeight:f,elemWidth:d,elemHeight:p,collisionPosition:l,collisionWidth:x,collisionHeight:S,offset:[a[0]+T[0],a[1]+T[1]],my:t.my,at:t.at,within:y,elem:c})}),e.fn.bgiframe&&c.bgiframe(),t.using&&(u=function(e){var i=m.left-O.left,n=i+h-d,a=m.top-O.top,o=a+f-p,l={target:{element:v,left:m.left,top:m.top,width:h,height:f},element:{element:c,left:O.left,top:O.top,width:d,height:p},horizontal:0>n?"left":i>0?"right":"center",vertical:0>o?"top":a>0?"bottom":"middle"};d>h&&s(i+n)<h&&(l.horizontal="center"),p>f&&s(a+o)<f&&(l.vertical="middle"),l.important=r(s(i),s(n))>r(s(a),s(o))?"horizontal":"vertical",t.using.call(this,e,l)}),c.offset(e.extend(O,{using:u}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,a=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,l=a-o,u=o+t.collisionWidth-s-a;t.collisionWidth>s?l>0&&0>=u?(i=e.left+l+t.collisionWidth-s-a,e.left+=l-i):e.left=u>0&&0>=l?a:l>u?a+s-t.collisionWidth:a:l>0?e.left+=l:u>0?e.left-=u:e.left=r(e.left-o,e.left)},top:function(e,t){var i,n=t.within,a=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,l=a-o,u=o+t.collisionHeight-s-a;t.collisionHeight>s?l>0&&0>=u?(i=e.top+l+t.collisionHeight-s-a,e.top+=l-i):e.top=u>0&&0>=l?a:l>u?a+s-t.collisionHeight:a:l>0?e.top+=l:u>0?e.top-=u:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var i,n,a=t.within,r=a.offset.left+a.scrollLeft,o=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,u=e.left-t.collisionPosition.marginLeft,c=u-l,d=u+t.collisionWidth-o-l,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>c?(i=e.left+h+p+f+t.collisionWidth-o-r,(0>i||i<s(c))&&(e.left+=h+p+f)):d>0&&(n=e.left-t.collisionPosition.marginLeft+h+p+f-l,(n>0||s(n)<d)&&(e.left+=h+p+f))},top:function(e,t){var i,n,a=t.within,r=a.offset.top+a.scrollTop,o=a.height,l=a.isWindow?a.scrollTop:a.offset.top,u=e.top-t.collisionPosition.marginTop,c=u-l,d=u+t.collisionHeight-o-l,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>c?(n=e.top+p+f+m+t.collisionHeight-o-r,e.top+p+f+m>c&&(0>n||n<s(c))&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-l,e.top+p+f+m>d&&(i>0||s(i)<d)&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,n,a,r,s=document.getElementsByTagName("body")[0],o=document.createElement("div");t=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in n)t.style[r]=n[r];t.appendChild(o),i=s||document.documentElement,i.insertBefore(t,i.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",a=e(o).offset().left,e.support.offsetFractions=a>10&&11>a,t.innerHTML="",i.removeChild(t)}(),e.uiBackCompat!==!1&&!function(e){var i=e.fn.position;e.fn.position=function(n){if(!n||!n.offset)return i.call(this,n);var a=n.offset.split(" "),r=n.at.split(" ");return 1===a.length&&(a[1]=a[0]),/^\d/.test(a[0])&&(a[0]="+"+a[0]),/^\d/.test(a[1])&&(a[1]="+"+a[1]),1===r.length&&(/left|center|right/.test(r[0])?r[1]="center":(r[1]=r[0],r[0]="center")),i.call(this,e.extend(n,{at:r[0]+a[0]+" "+r[1]+a[1],offset:t}))}}(jQuery)}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var n=this.element[0],a=!1;n&&(n=n.parentNode);)n==document&&(a=!0);if(!a&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]==this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)
},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var i=e(t.containment),n=i[0];if(!n)return;var a=(i.offset(),"hidden"!=e(n).css("overflow"));this.containment=[(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0),(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0),(a?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(a?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*n}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName),r=t.pageX,s=t.pageY;if(this.originalPosition){var o;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();o=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else o=this.containment;t.pageX-this.offset.click.left<o[0]&&(r=o[0]+this.offset.click.left),t.pageY-this.offset.click.top<o[1]&&(s=o[1]+this.offset.click.top),t.pageX-this.offset.click.left>o[2]&&(r=o[2]+this.offset.click.left),t.pageY-this.offset.click.top>o[3]&&(s=o[3]+this.offset.click.top)}if(i.grid){var u=i.grid[1]?this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;s=o?u-this.offset.click.top<o[1]||u-this.offset.click.top>o[3]?u-this.offset.click.top<o[1]?u+i.grid[1]:u-i.grid[1]:u:u;var c=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=o?c-this.offset.click.left<o[0]||c-this.offset.click.left>o[2]?c-this.offset.click.left<o[0]?c+i.grid[0]:c-i.grid[0]:c:c}}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("draggable"),a=n.options,r=e.extend({},i,{item:n.element});n.sortables=[],e(a.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i){var n=e(this).data("draggable"),a=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,a))})},drag:function(t,i){var n=e(this).data("draggable"),a=this;e.each(n.sortables,function(){var r=!1,s=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!=s&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(s.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(a).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),a=e(this).data("draggable").options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i){var n=e(this).data("draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),n=i.options,a=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){for(var n=e(this).data("draggable"),a=n.options,r=a.snapTolerance,s=i.offset.left,o=s+n.helperProportions.width,l=i.offset.top,u=l+n.helperProportions.height,c=n.snapElements.length-1;c>=0;c--){var d=n.snapElements[c].left,h=d+n.snapElements[c].width,p=n.snapElements[c].top,f=p+n.snapElements[c].height;if(s>d-r&&h+r>s&&l>p-r&&f+r>l||s>d-r&&h+r>s&&u>p-r&&f+r>u||o>d-r&&h+r>o&&l>p-r&&f+r>l||o>d-r&&h+r>o&&u>p-r&&f+r>u){if("inner"!=a.snapMode){var m=Math.abs(p-u)<=r,g=Math.abs(f-l)<=r,v=Math.abs(d-o)<=r,y=Math.abs(h-s)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d-n.helperProportions.width}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left)}var b=m||g||v||y;if("outer"!=a.snapMode){var m=Math.abs(p-l)<=r,g=Math.abs(f-u)<=r,v=Math.abs(d-s)<=r,y=Math.abs(h-o)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f-n.helperProportions.height,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[c].snapping&&(m||g||v||y||b)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=m||g||v||y||b}else n.snapElements[c].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[c].item})),n.snapElements[c].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});if(i.length){var n=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=n+e}),this[0].style.zIndex=n+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),a=e(this).data("draggable").options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i){var n=e(this).data("draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(e){e.widget("ui.droppable",{version:"1.9.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;i<t.length;i++)t[i]==this&&t.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return!1;var a=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope==n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(a=!0,!1):void 0}),a?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,i,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left,r=a+t.helperProportions.width,s=(t.positionAbs||t.position.absolute).top,o=s+t.helperProportions.height,l=i.offset.left,u=l+i.proportions.width,c=i.offset.top,d=c+i.proportions.height;switch(n){case"fit":return a>=l&&u>=r&&s>=c&&d>=o;case"intersect":return l<a+t.helperProportions.width/2&&r-t.helperProportions.width/2<u&&c<s+t.helperProportions.height/2&&o-t.helperProportions.height/2<d;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,f=e.ui.isOver(p,h,c,l,i.proportions.height,i.proportions.width);return f;case"touch":return(s>=c&&d>=s||o>=c&&d>=o||c>s&&o>d)&&(a>=l&&u>=a||r>=l&&u>=r||l>a&&r>u);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n=e.ui.ddmanager.droppables[t.options.scope]||[],a=i?i.type:null,r=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var s=0;s<n.length;s++)if(!(n[s].options.disabled||t&&!n[s].accept.call(n[s].element[0],t.currentItem||t.element))){for(var o=0;o<r.length;o++)if(r[o]==n[s].element[0]){n[s].proportions.height=0;continue e}n[s].visible="none"!=n[s].element.css("display"),n[s].visible&&("mousedown"==a&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions={width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n=e.ui.intersect(t,this,this.options.tolerance),a=n||1!=this.isover?n&&0==this.isover?"isover":null:"isout";if(a){var r;if(this.options.greedy){var s=this.options.scope,o=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===s});o.length&&(r=e.data(o[0],"droppable"),r.greedyChild="isover"==a?1:0)}r&&"isover"==a&&(r.isover=0,r.isout=1,r._out.call(r,i)),this[a]=1,this["isout"==a?"isover":"isout"]=0,this["isover"==a?"_over":"_out"].call(this,i),r&&"isout"==a&&(r.isout=0,r.isover=1,r._over.call(r,i))}}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var n=this.handles.split(",");this.handles={};for(var a=0;a<n.length;a++){var r=e.trim(n[a]),s="ui-resizable-"+r,o=e('<div class="ui-resizable-handle '+s+'"></div>');o.css({zIndex:i.zIndex}),"se"==r&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(o)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var n=e(this.handles[i],this.element),a=0;a=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth();var r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");t.css(r,a),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){i.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())}).mouseleave(function(){i.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")}).insertAfter(i),i.remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var n in this.handles)e(this.handles[n])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var n=this.options,a=this.element.position(),r=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(r.is(".ui-draggable")||/absolute/.test(r.css("position")))&&r.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy();var s=t(this.helper.css("left")),o=t(this.helper.css("top"));n.containment&&(s+=e(n.containment).scrollLeft()||0,o+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:s,top:o},this.size=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalPosition={left:s,top:o},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1;var l=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor","auto"==l?this.axis+"-resize":l),r.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var t=this.helper,i=(this.options,this.originalMousePosition),n=this.axis,a=e.pageX-i.left||0,r=e.pageY-i.top||0,s=this._change[n];if(!s)return!1;var o=s.apply(this,[e,a,r]);return this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(o=this._updateRatio(o,e)),o=this._respectSize(o,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(o),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,n=this;if(this._helper){var a=this._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),s=r&&e.ui.hasScroll(a[0],"left")?0:n.sizeDiff.height,o=r?0:n.sizeDiff.width,l={width:n.helper.width()-o,height:n.helper.height()-s},u=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,c=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;i.animate||this.element.css(e.extend(l,{top:c,left:u})),n.helper.height(n.size.height),n.helper.width(n.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,a,r,s,o=this.options;s={minWidth:i(o.minWidth)?o.minWidth:0,maxWidth:i(o.maxWidth)?o.maxWidth:1/0,minHeight:i(o.minHeight)?o.minHeight:0,maxHeight:i(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,a=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),a>s.minHeight&&(s.minHeight=a),n<s.maxWidth&&(s.maxWidth=n),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.options;this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),n=this.size,a=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"==a&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"==a&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e,t){var n=(this.helper,this._vBoundaries),a=(this._aspectRatio||t.shiftKey,this.axis),r=i(e.width)&&n.maxWidth&&n.maxWidth<e.width,s=i(e.height)&&n.maxHeight&&n.maxHeight<e.height,o=i(e.width)&&n.minWidth&&n.minWidth>e.width,l=i(e.height)&&n.minHeight&&n.minHeight>e.height;o&&(e.width=n.minWidth),l&&(e.height=n.minHeight),r&&(e.width=n.maxWidth),s&&(e.height=n.maxHeight);var u=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,d=/sw|nw|w/.test(a),h=/nw|ne|n/.test(a);o&&d&&(e.left=u-n.minWidth),r&&d&&(e.left=u-n.maxWidth),l&&h&&(e.top=c-n.minHeight),s&&h&&(e.top=c-n.maxHeight);var p=!e.width&&!e.height;return p&&!e.left&&e.top?e.top=null:p&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){this.options;if(this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;i<this._proportionallyResizeElements.length;i++){var n=this._proportionallyResizeElements[i];if(!this.borderDif){var a=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],r=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];this.borderDif=e.map(a,function(e,t){var i=parseInt(e,10)||0,n=parseInt(r[t],10)||0;return i+n})}n.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.ui.ie6?1:0,a=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+a,height:this.element.outerHeight()+a,position:"absolute",left:this.elementOffset.left-n+"px",top:this.elementOffset.top-n+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=(this.options,this.originalSize),a=this.originalPosition;return{top:a.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("resizable"),a=n.options,r=n.originalSize,s=n.originalPosition,o={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,n){e(t).each(function(){var t=e(this),a=e(this).data("resizable-alsoresize"),r={},s=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(a[t]||0)+(o[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})};"object"!=typeof a.alsoResize||a.alsoResize.nodeType?l(a.alsoResize):e.each(a.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("resizable"),n=i.options,a=i._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),s=r&&e.ui.hasScroll(a[0],"left")?0:i.sizeDiff.height,o=r?0:i.sizeDiff.width,l={width:i.size.width-o,height:i.size.height-s},u=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&u?{top:c,left:u}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};a&&a.length&&e(a[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),n=i.options,a=i.element,r=n.containment,s=r instanceof e?r.get(0):/parent/.test(r)?a.parent().get(0):r;
if(s)if(i.containerElement=e(s),/document/.test(r)||r==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var o=e(s),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,i){l[e]=t(o.css("padding"+i))}),i.containerOffset=o.offset(),i.containerPosition=o.position(),i.containerSize={height:o.innerHeight()-l[3],width:o.innerWidth()-l[1]};var u=i.containerOffset,c=i.containerSize.height,d=i.containerSize.width,h=e.ui.hasScroll(s,"left")?s.scrollWidth:d,p=e.ui.hasScroll(s)?s.scrollHeight:c;i.parentData={element:s,left:u.left,top:u.top,width:h,height:p}}},resize:function(t){var i=e(this).data("resizable"),n=i.options,a=(i.containerSize,i.containerOffset),r=(i.size,i.position),s=i._aspectRatio||t.shiftKey,o={top:0,left:0},l=i.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(o=a),r.left<(i._helper?a.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-a.left:i.position.left-o.left),s&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=n.helper?a.left:0),r.top<(i._helper?a.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-a.top:i.position.top),s&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?a.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var u=Math.abs((i._helper?i.offset.left-o.left:i.offset.left-o.left)+i.sizeDiff.width),c=Math.abs((i._helper?i.offset.top-o.top:i.offset.top-a.top)+i.sizeDiff.height),d=i.containerElement.get(0)==i.element.parent().get(0),h=/relative|absolute/.test(i.containerElement.css("position"));d&&h&&(u-=i.parentData.left),u+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-u,s&&(i.size.height=i.size.width/i.aspectRatio)),c+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-c,s&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data("resizable"),i=t.options,n=(t.position,t.containerOffset),a=t.containerPosition,r=t.containerElement,s=e(t.helper),o=s.offset(),l=s.outerWidth()-t.sizeDiff.width,u=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:o.left-a.left-n.left,width:l,height:u}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:o.left-a.left-n.left,width:l,height:u})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){{var t=e(this).data("resizable");t.options}t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){{var t=e(this).data("resizable");t.options}t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t){{var i=e(this).data("resizable"),n=i.options,a=i.size,r=i.originalSize,s=i.originalPosition,o=i.axis;n._aspectRatio||t.shiftKey}n.grid="number"==typeof n.grid?[n.grid,n.grid]:n.grid;var l=Math.round((a.width-r.width)/(n.grid[0]||1))*(n.grid[0]||1),u=Math.round((a.height-r.height)/(n.grid[1]||1))*(n.grid[1]||1);/^(se|s|e)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u):/^(ne)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u,i.position.top=s.top-u):/^(sw)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u,i.position.left=s.left-l):(i.size.width=r.width+l,i.size.height=r.height+u,i.position.top=s.top-u,i.position.left=s.left-l)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass("ui-selectee"),i.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var n=this.options;this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,t.metaKey||t.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().andSelf().each(function(){var n=e.data(this,"selectable-item");if(n){var a=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected");return n.$element.removeClass(a?"ui-unselecting":"ui-selected").addClass(a?"ui-selecting":"ui-unselecting"),n.unselecting=!a,n.selecting=a,n.selected=a,a?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var n=this.options,a=this.opos[0],r=this.opos[1],s=t.pageX,o=t.pageY;if(a>s){var l=s;s=a,a=l}if(r>o){var l=o;o=r,r=l}return this.helper.css({left:a,top:r,width:s-a,height:o-r}),this.selectees.each(function(){var l=e.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var u=!1;"touch"==n.tolerance?u=!(l.left>s||l.right<a||l.top>o||l.bottom<r):"fit"==n.tolerance&&(u=l.left>a&&l.right<s&&l.top>r&&l.bottom<o),u?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",t,{selecting:l.element}))):(l.selecting&&((t.metaKey||t.ctrlKey)&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",t,{unselecting:l.element}))),l.selected&&(t.metaKey||t.ctrlKey||l.startselected||(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",t,{unselecting:l.element}))))}}),!1}},_mouseStop:function(t){var i=this;this.dragged=!1;this.options;return e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);{var a=null;e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")==n?(a=e(this),!1):void 0})}if(e.data(t.target,n.widgetName+"-item")==n&&(a=e(t.target)),!a)return!1;if(this.options.handle&&!i){var r=!1;if(e(this.options.handle,a).find("*").andSelf().each(function(){this==t.target&&(r=!0)}),!r)return!1}return this.currentItem=a,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,n){var a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",a.cursor)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var a=this.items.length-1;a>=0;a--){var r=this.items[a],s=r.item[0],o=this._intersectsWithPointer(r);if(o&&r.instance===this.currentContainer&&s!=this.currentItem[0]&&this.placeholder[1==o?"next":"prev"]()[0]!=s&&!e.contains(this.placeholder[0],s)&&("semi-dynamic"==this.options.type?!e.contains(this.element[0],s):!0)){if(this.direction=1==o?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,a=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,a=n+this.helperProportions.height,r=e.left,s=r+e.width,o=e.top,l=o+e.height,u=this.offset.click.top,c=this.offset.click.left,d=n+u>o&&l>n+u&&t+c>r&&s>t+c;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?d:r<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&o<n+this.helperProportions.height/2&&a-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),a=i&&n,r=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return a?this.floating?s&&"right"==s||"down"==r?2:1:r&&("down"==r?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),a=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&n||"left"==r&&!n:a&&("down"==a&&i||"up"==a&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],n=[],a=this._connectWith();if(a&&t)for(var r=a.length-1;r>=0;r--)for(var s=e(a[r]),o=s.length-1;o>=0;o--){var l=e.data(s[o],this.widgetName);l&&l!=this&&!l.options.disabled&&n.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var r=n.length-1;r>=0;r--)n[r][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,n=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],a=this._connectWith();if(a&&this.ready)for(var r=a.length-1;r>=0;r--)for(var s=e(a[r]),o=s.length-1;o>=0;o--){var l=e.data(s[o],this.widgetName);l&&l!=this&&!l.options.disabled&&(n.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var r=n.length-1;r>=0;r--)for(var u=n[r][1],c=n[r][0],o=0,d=c.length;d>o;o++){var h=e(c[o]);h.data(this.widgetName+"-item",u),i.push({item:h,instance:u,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var a=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item;t||(n.width=a.outerWidth(),n.height=a.outerHeight());var r=a.offset();n.left=r.left,n.top=r.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var r=this.containers[i].element.offset();this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var i=t.options;if(!i.placeholder||i.placeholder.constructor==String){var n=i.placeholder;i.placeholder={element:function(){var i=e(document.createElement(t.currentItem[0].nodeName)).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return n||(i.style.visibility="hidden"),i},update:function(e,a){(!n||i.forcePlaceholderSize)&&(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}}t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var i=null,n=null,a=this.containers.length-1;a>=0;a--)if(!e.contains(this.currentItem[0],this.containers[a].element[0]))if(this._intersectsWith(this.containers[a].containerCache)){if(i&&e.contains(this.containers[a].element[0],i.element[0]))continue;i=this.containers[a],n=a}else this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",t,this._uiHash(this)),this.containers[a].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1;else{for(var r=1e4,s=null,o=this.containers[n].floating?"left":"top",l=this.containers[n].floating?"width":"height",u=this.positionAbs[o]+this.offset.click[o],c=this.items.length-1;c>=0;c--)if(e.contains(this.containers[n].element[0],this.items[c].item[0])&&this.items[c].item[0]!=this.currentItem[0]){var d=this.items[c].item.offset()[o],h=!1;Math.abs(d-u)>Math.abs(d+this.items[c][l]-u)&&(h=!0,d+=this.items[c][l]),Math.abs(d-u)<r&&(r=Math.abs(d-u),s=this.items[c],this.direction=h?"up":"down")}if(!s&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],s?this._rearrange(t,s,null,!0):this._rearrange(t,null,this.containers[n].element,!0),this._trigger("change",t,this._uiHash()),this.containers[n]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],n=e(t.containment).offset(),a="hidden"!=e(i).css("overflow");this.containment=[n.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(a?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(a?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*n}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var r=t.pageX,s=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),i.grid)){var o=this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1];s=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+i.grid[1]:o-i.grid[1]:o:o;var l=this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0];r=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay(function(){a==this.counter&&this.refreshPositions(!n)})},_clear:function(t,i){this.reverting=!1;var n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var a in this._storedCSS)("auto"==this._storedCSS[a]||"static"==this._storedCSS[a])&&(this._storedCSS[a]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!i&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||i||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(i||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var a=this.containers.length-1;a>=0;a--)i||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[a])),this.containers[a].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[a])),this.containers[a].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var a=0;a<n.length;a++)n[a].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var a=0;a<n.length;a++)n[a].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){var t=0;e.widget("ui.autocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,i,n;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(a){if(this.element.prop("readOnly"))return t=!0,n=!0,void(i=!0);t=!1,n=!1,i=!1;var r=e.ui.keyCode;switch(a.keyCode){case r.PAGE_UP:t=!0,this._move("previousPage",a);break;case r.PAGE_DOWN:t=!0,this._move("nextPage",a);break;case r.UP:t=!0,this._keyEvent("previous",a);break;case r.DOWN:t=!0,this._keyEvent("next",a);
break;case r.ENTER:case r.NUMPAD_ENTER:this.menu.active&&(t=!0,a.preventDefault(),this.menu.select(a));break;case r.TAB:this.menu.active&&this.menu.select(a);break;case r.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(a),a.preventDefault());break;default:i=!0,this._searchTimeout(a)}},keypress:function(n){if(t)return t=!1,void n.preventDefault();if(!i){var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:this._move("previousPage",n);break;case a.PAGE_DOWN:this._move("nextPage",n);break;case a.UP:this._keyEvent("previous",n);break;case a.DOWN:this._keyEvent("next",n)}}},input:function(e){return n?(n=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:e(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(n){n.target===t.element[0]||n.target===i||e.contains(i,n.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});var n=i.item.data("ui-autocomplete-item")||i.item.data("item.autocomplete");!1!==this._trigger("focus",t,{item:n})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value):this.liveRegion.text(n.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),e.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this.document.find(t||"body")[0]),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var t,i,n=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,n){n(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,a){n.xhr&&n.xhr.abort(),n.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){a(e)},error:function(){a([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,i=++t;return function(n){i===t&&e.__response(n),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(i,t),this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e){var t=!1;e.widget("ui.menu",{version:"1.9.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(i){var n=e(i.target).closest(".ui-menu-item");!t&&n.not(".ui-state-disabled").length&&(t=!0,this.select(i),n.has(".ui-menu").length?this.expand(i):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(i){e(i.target).closest(".ui-menu").length||this.collapseAll(i),t=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,a,r,s,o,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,a=this.previousFilter||"",r=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),r===a?s=!0:r=a+r,o=new RegExp("^"+i(r),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())}),n=s&&-1!==n.index(this.active.next())?this.active.nextAll(".ui-menu-item"):n,n.length||(r=String.fromCharCode(t.keyCode),o=new RegExp("^"+i(r),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i=this.options.icons.submenu,n=this.element.find(this.options.menus);n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),n=t.prev("a"),a=e("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);n.attr("aria-haspopup","true").prepend(a),t.attr("aria-labelledby",n.attr("id"))}),t=n.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-—–\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var i,n;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),n=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,n,a,r,s,o;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,a=t.offset().top-this.activeMenu.offset().top-i-n,r=this.activeMenu.scrollTop(),s=this.activeMenu.height(),o=t.height(),0>a?this.activeMenu.scrollTop(r+a):a+o>s&&this.activeMenu.scrollTop(r+a-s+o))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(t),this.activeMenu=n},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;this.active&&(n="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,n)},nextPage:function(t){var i,n,a;return this.active?void(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,a=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n-a<0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var i,n,a;return this.active?void(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,a=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n+a>0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var i,n,a=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(a.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),a.range&&(a.range===!0&&(a.values||(a.values=[this._valueMin(),this._valueMin()]),a.values.length&&2!==a.values.length&&(a.values=[a.values[0],a.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===a.range||"max"===a.range?" ui-slider-range-"+a.range:""))),n=a.values&&a.values.length||1,i=r.length;n>i;i++)o.push(s);this.handles=r.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){a.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){a.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(i){var n,a,r,s,o=e(i.target).data("ui-slider-handle-index");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass("ui-state-active"),n=this._start(i,o),n===!1))return}switch(s=this.options.step,a=r=this.options.values&&this.options.values.length?this.values(o):this.value(),i.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(a+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(a-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(a===this._valueMax())return;r=this._trimAlignValue(a+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(a===this._valueMin())return;r=this._trimAlignValue(a-s)}this._slide(i,o,r)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,n,a,r,s,o,l,u,c=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),a=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(n-c.values(t));a>i&&(a=i,r=e(this),s=t)}),d.range===!0&&this.values(1)===d.min&&(s+=1,r=e(this.handles[s])),o=this._start(t,s),o===!1?!1:(this._mouseSliding=!0,this._handleIndex=s,r.addClass("ui-state-active").focus(),l=r.offset(),u=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=u?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,a,r;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),a=this._valueMax()-this._valueMin(),r=this._valueMin()+n*a,this._trimAlignValue(r)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,a,r;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&n>i)&&(i=n),i!==this.values(t)&&(a=this.values(),a[t]=i,r=this._trigger("slide",e,{handle:this.handles[t],value:i,values:a}),n=this.values(t?0:1),r!==!1&&this.values(t,i,!0))):i!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:i}),r!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var n,a,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,a=arguments[0],r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(a[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,i){var n,a=0;switch(e.isArray(this.options.values)&&(a=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;a>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,a,r,s=this.options.range,o=this.options,l=this,u=this._animateOff?!1:o.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[u?"animate":"css"](c,o.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[u?"animate":"css"]({left:i+"%"},o.animate),1===n&&l.range[u?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:o.animate})):(0===n&&l.range.stop(1,1)[u?"animate":"css"]({bottom:i+"%"},o.animate),1===n&&l.range[u?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:o.animate}))),t=i}):(n=this.value(),a=this._valueMin(),r=this._valueMax(),i=r!==a?(n-a)/(r-a)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[u?"animate":"css"](c,o.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:i+"%"},o.animate),"max"===s&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:i+"%"},o.animate),"max"===s&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))}})}(jQuery),function(e){function t(t,i){var n=(t.attr("aria-describedby")||"").split(/\s+/);n.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(n.join(" ")))}function i(t){var i=t.data("ui-tooltip-id"),n=(t.attr("aria-describedby")||"").split(/\s+/),a=e.inArray(i,n);-1!==a&&n.splice(a,1),t.removeData("ui-tooltip-id"),n=e.trim(n.join(" ")),n?t.attr("aria-describedby",n):t.removeAttr("aria-describedby")}var n=0;e.widget("ui.tooltip",{version:"1.9.2",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var n=this;return"disabled"===t?(this[i?"_disable":"_enable"](),void(this.options[t]=i)):(this._super(t,i),void("content"===t&&e.each(this.tooltips,function(e,t){n._updateContent(t)})))},_disable:function(){var t=this;e.each(this.tooltips,function(i,n){var a=e.Event("blur");a.target=a.currentTarget=n[0],t.close(a,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,n=e(t?t.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&n.parents().each(function(){var t,n=e(this);n.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._updateContent(n,t))},_updateContent:function(e,t){var i,n=this.options.content,a=this,r=t?t.type:null;return"string"==typeof n?this._open(t,e,n):(i=n.call(e[0],function(i){e.data("ui-tooltip-open")&&a._delay(function(){t&&(t.type=r),this._open(t,e,i)})}),void(i&&this._open(t,e,i)))},_open:function(i,n,a){function r(e){u.of=e,s.is(":hidden")||s.position(u)}var s,o,l,u=e.extend({},this.options.position);if(a){if(s=this._find(n),s.length)return void s.find(".ui-tooltip-content").html(a);n.is("[title]")&&(i&&"mouseover"===i.type?n.attr("title",""):n.removeAttr("title")),s=this._tooltip(n),t(n,s.attr("id")),s.find(".ui-tooltip-content").html(a),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:r}),r(i)):s.position(e.extend({of:n},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(l=setInterval(function(){s.is(":visible")&&(r(u.of),clearInterval(l))},e.fx.interval)),this._trigger("open",i,{tooltip:s}),o={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=n[0],this.close(i,!0)}},remove:function(){this._removeTooltip(s)}},i&&"mouseover"!==i.type||(o.mouseleave="close"),i&&"focusin"!==i.type||(o.focusout="close"),this._on(!0,n,o)}},close:function(t){var n=this,a=e(t?t.currentTarget:this.element),r=this._find(a);this.closing||(a.data("ui-tooltip-title")&&a.attr("title",a.data("ui-tooltip-title")),i(a),r.stop(!0),this._hide(r,this.options.hide,function(){n._removeTooltip(e(this))}),a.removeData("ui-tooltip-open"),this._off(a,"mouseleave focusout keyup"),a[0]!==this.element[0]&&this._off(a,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete n.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:r}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+n++,a=e("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(a),a.appendTo(this.document[0].body),e.fn.bgiframe&&a.bgiframe(),this.tooltips[i]=t,a},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,n){var a=e.Event("blur");a.target=a.currentTarget=n[0],t.close(a,!0),e("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))})}})}(jQuery),e.$=$}.apply(e,arguments)})}(this),Oskari.AbstractFunc=function(){var e=arguments[0];return function(){throw"AbstractFuncCalled: "+e}},Oskari.clazz.define("Oskari.mapping.mapmodule.AbstractMapModule",function(e,t,i){var n=this;if(n._id=e,n._imageUrl=t,n._options={resolutions:[2048,1024,512,256,128,64,32,16,8,4,2,1,.5],srsName:"EPSG:3067",units:"m"},i)for(var a in i)n._options[a]=i[a];n._controls={},n._layerPlugins={},n._projection=null,n._projectionCode=n._options.srsName,n._supportedFormats={},n._map=null,n._mapScales=[],n._mapResolutions=n._options.resolutions,n._maxExtent=n._options.maxExtent||{},n._extent=n._maxExtent.left?[n._maxExtent.left,n._maxExtent.bottom,n._maxExtent.right,n._maxExtent.top]:[],n._sandbox=null,n._stealth=!1,n._pluginInstances={},n._localization=null,n.layerDefs=[],n.layerDefsById={}},{getImageUrl:function(){return this._imageUrl?this._imageUrl:"/Oskari/resources"},getControls:function(){return this._controls},getMapControl:function(e){return this._controls[e]},addMapControl:function(e,t){this._controls[e]=t,this._addMapControlImpl(t)},removeMapControl:function(e){var t=this._controls[e];this._removeMapControlImpl(t),delete this._controls[e]},setLayerPlugin:function(e,t){null!==e&&void 0!==e&&e.length||this._sandbox.printWarn("Setting layer plugin",t,"with a non-existent ID:",e),null===t||void 0===t?delete this._layerPlugins[e]:this._layerPlugins[e]=t},getLayerPlugin:function(e){return this._layerPlugins[e]},getLayerPlugins:function(){return this._layerPlugins},getName:function(){return this._id+"MapModule"},getSandbox:function(){return this._sandbox},getLocalization:function(e,t){return this._localization&&t!==!0||(this._localization=Oskari.getLocalization("MapModule")),e?this._localization[e]:this._localization},init:function(e){var t=this;return e.printDebug("Initializing oskari map module...#############################################"),t._sandbox=e,t._options&&(t._options.resolutions&&(t._mapResolutions=t._options.resolutions),t._options.srsName&&(t._projectionCode=t._options.srsName,t._sandbox&&t._sandbox.getMap().setSrsName(t._projectionCode))),t._map=t._createMapImpl(),t._calculateScalesImpl(t._mapResolutions),t._initImpl(t._sandbox,t._options,t._map)
},_initImpl:function(e,t,i){return i},getPluginInstances:function(){return this._pluginInstances},getPluginInstance:function(e){return this._pluginInstances[this.getName()+e]},isPluginActivated:function(e){var t=this._pluginInstances[this.getName()+e];return t?!0:!1},registerPlugin:function(e){var t=this.getSandbox();e.setMapModule(this);var i=e.getName();t.printDebug("["+this.getName()+"] Registering "+i),e.register(),this._pluginInstances[i]=e},unregisterPlugin:function(e){var t=this.getSandbox(),i=e.getName();t.printDebug("["+this.getName()+"] Unregistering "+i),e.unregister(),this._pluginInstances[i]=void 0,e.setMapModule(null),delete this._pluginInstances[i]},startPlugin:function(e){var t=this.getSandbox(),i=e.getName();t.printDebug("["+this.getName()+"] Starting "+i),e.startPlugin(t)},stopPlugin:function(e){var t=this.getSandbox(),i=e.getName();t.printDebug("["+this.getName()+"] Starting "+i),e.stopPlugin(t)},startPlugins:function(e){var t;for(t in this._pluginInstances)this._pluginInstances.hasOwnProperty(t)&&(e.printDebug("["+this.getName()+"] Starting "+t),this._pluginInstances[t].startPlugin(e))},stopPlugins:function(e){var t;for(t in this._pluginInstances)this._pluginInstances.hasOwnProperty(t)&&(e.printDebug("["+this.getName()+"] Starting "+t),this._pluginInstances[t].stopPlugin(e))},getStealth:function(){return this._stealth},setStealth:function(e){this._stealth=!!e},notifyAll:function(e,t){this.getStealth()||this.getSandbox().notifyAll(e,t)},getMap:function(){return this._map},getProjection:function(){return this._projectionCode},getProjectionObject:function(){return this._projection},getResolutionArray:function(){return this._mapResolutions},getExtentArray:function(){return this._extent},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(e){this.setZoomLevel(e,!1)},moveMapByPixels:function(e,t,i,n){return this.panMapByPixels(e,t,i,n)},isValidLonLat:function(e,t){var i=!0;return 625e4>t||t>82e5?i=!1:((0>e||e>135e4)&&(i=!1),i)},getClosestZoomLevel:function(e,t){var i=this.getZoomLevel();if(!t||!e)return i;var n,a=this.getMap().getScale();if(t>a){for(n=i;n>0;n--)if(this._mapScales[n]>=t)return n}else if(a>e)for(n=i;n<this._mapScales.length;n++)if(this._mapScales[n]<=e)return n;return i},formatMeasurementResult:function(e,t){var i,n;if("area"===t)i=Math.round(100*e.getArea())/100,n=" m²",i>=1e6&&(i=Math.round(i)/1e6,n=" km²");else{if("line"!==t)return"";i=Math.round(100*e.getLength())/100,n=" m",i>=1e3&&(i=Math.round(i)/1e3,n=" km")}return(i+n).replace(".",",")},start:function(e){if(!this.started){e.printDebug("Starting "+this.getName());var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this.startPlugins(e),this.updateCurrentState(),this.started=this._startImpl()}},_startImpl:function(){return!0},stop:function(e){this.started&&(this.stopPlugins(e),this.started=this._stopImpl())},_stopImpl:function(){return!0},eventHandlers:{},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},updateCurrentState:function(){var e,t,i=this,n=i._sandbox,a=n.findAllSelectedMapLayers(),r=this.getLayerPlugins();for(t in r)r.hasOwnProperty(t)&&(e=r[t],n.printDebug("preselecting "+t),e.preselectLayers(a))},getLayersByName:function(e){var t,i,n=[],a=this.layerDefs;for(t=0;t<a.length;t++)i=a[t],-1!=i.name.indexOf(e)&&n.push(i.impl);return n},getLayers:function(){return this.layerDefs},getLayerDefs:function(){return this.layerDefs},addLayer:function(e,t,i,n){var a={name:i,id:t.getId(),impl:e,layer:t};this.layerDefs.push(a),this.layerDefsById[t.getId()]=a,this._addLayerImpl(e,n)},removeLayer:function(e,t){this._removeLayerImpl(e),delete this.layerDefsById[t.getId()];var i,n=[];for(i=0;i<this.layerDefs.length;i++)this.layerDefs[i].layer.getId()===t.getId()?delete this.layerDefs[i]:n.push(this.layerDefs[i]);this.layerDefs=n},setLayerIndex:function(e,t){var i=this.getLayerDefs(),n=this.getLayerIndex(e),a=[],r=i[n],s=0;for(s=0;s<i.length;s++)s===t&&r&&(a.push(r),r=null),i[s].impl!==e&&a.push(i[s]);for(s===t&&r&&a.push(r),this.layerDefs=a,s=0;s<i.length;s++)this._setLayerImplIndex(i[s].impl,s)},getLayerIndex:function(e){var t,i=this.getLayerDefs();for(t=0;t<i.length;t++)if(i[t].impl===e)return t;return-1},getMapScale:function(){var e=this.getMapSize(),t=this.getMapExtent(),i=(t[2]-t[0])/e[0];return OpenLayers.Util.getScaleFromResolution(i,"m")},calculateLayerMinMaxResolutions:function(e,t){var i,n,a;for(a=0;a<this._mapScales.length;a++)(!t||t>=this._mapScales[a])&&(!e||e<=this._mapScales[a])&&(void 0===i&&(i=a),n=a);return{min:i,max:n}},getMapScales:function(){return this._mapScales},calculateLayerScales:function(e,t){var i,n=[];for(i=0;i<this._mapScales.length;i++)(!t||t>=this._mapScales[i])&&(!e||e<=this._mapScales[i])&&n.push(this._mapScales[i]);return n},calculateLayerResolutions:function(e,t){var i,n=[];for(i=0;i<this._mapScales.length;i++)(!t||t>=this._mapScales[i])&&(!e||e<=this._mapScales[i])&&n.push(this._options.resolutions[i]);return n},getState:function(){var e,t={plugins:{}};for(e in this._pluginInstances)this._pluginInstances.hasOwnProperty(e)&&this._pluginInstances[e].getState&&(t.plugins[e]=this._pluginInstances[e].getState());return t},getStateParameters:function(){var e,t="";for(e in this._pluginInstances)this._pluginInstances.hasOwnProperty(e)&&this._pluginInstances[e].getStateParameters&&(t+=this._pluginInstances[e].getStateParameters());return t},setState:function(e){var t;for(t in this._pluginInstances)this._pluginInstances.hasOwnProperty(t)&&e[t]&&this._pluginInstances[t].setState&&this._pluginInstances[t].setState(e[t])},_crs2MapImpl:Oskari.AbstractFunc("_crs2MapImpl"),_map2CrsImpl:Oskari.AbstractFunc("_map2CrsImpl"),updateSize:Oskari.AbstractFunc("updateSize"),_createMapImpl:Oskari.AbstractFunc("_createMapImpl"),moveMapToLanLot:function(){return this.panMapToLonLat.apply(this,arguments)},panMapToLonLat:Oskari.AbstractFunc("moveMapToLanLot"),zoomToScale:Oskari.AbstractFunc("zoomToScale"),centerMap:Oskari.AbstractFunc("centerMap"),panMapByPixels:Oskari.AbstractFunc("panMapByPixels"),centerMapByPixels:Oskari.AbstractFunc("centerMapByPixels"),zoomToExtent:Oskari.AbstractFunc("zoomToExtent"),setZoomLevel:Oskari.AbstractFunc("setZoomLevel"),getZoomLevel:function(){return this.getMap().getZoom()},_updateDomainImpl:Oskari.AbstractFunc("_updateDomainImpl"),_addLayerImpl:Oskari.AbstractFunc("_addLayerImpl(layerImpl, index)"),_setLayerImplIndex:Oskari.AbstractFunc("_setLayerImplIndex(layerImpl,n)"),_removeLayerImpl:Oskari.AbstractFunc("_removeLayerImpl(layerImpl)"),_setLayerImplVisible:Oskari.AbstractFunc("_setLayerImplVisible"),_setLayerImplOpacity:Oskari.AbstractFunc("_setLayerImplOpacity"),adjustZoomLevel:Oskari.AbstractFunc("adjustZoomLevel(amount, suppressEvent)"),notifyMoveEnd:function(){},_calculateScalesImpl:Oskari.AbstractFunc("_calculateScalesImpl(resolutions)"),_addMapControlImpl:Oskari.AbstractFunc("_addMapControlImpl(ctl)"),_removeMapControlImpl:Oskari.AbstractFunc("_removeMapControlImpl(ctl)")},{protocol:["Oskari.mapframework.module.Module"]}),define("src/mapping/mapmodule/AbstractMapModule",function(){}),Oskari.clazz.define("Oskari.mapping.mapmodule.plugin.AbstractMapModulePlugin",function(e){this._mapModule=null,this._name="AbstractPlugin"+Math.floor(1632960*Math.random()+46656).toString(36),this._pluginName=this._name,this._sandbox=null,this._map=null,this._config=e||{},this._eventHandlers={},this.isInLayerToolsEditMode=!1},{getName:function(){return this._pluginName},getMap:function(){return this._map},getMapModule:function(){if(null===this._mapModule||void 0===this._mapModule)throw"No mapmodule provided!";return this._mapModule},setMapModule:function(e){e&&(this._mapModule=e,this._map=e.getMap(),this._pluginName=e.getName()+this._name)},init:function(){return this._initImpl()},_initImpl:function(){},register:function(){return this._registerImpl()},_registerImpl:function(){},unregister:function(){return this._unregisterImpl()},_unregisterImpl:function(){},createEventHandlers:function(){var e=this,t=e._createEventHandlers();return t.LayerToolsEditModeEvent=function(t){e._setLayerToolsEditMode(t.isInMode())},t},_createEventHandlers:function(){return{}},inLayerToolsEditMode:function(){return this._isInLayerToolsEditMode},_setLayerToolsEditMode:function(e){this._isInLayerToolsEditMode=e,this._setLayerToolsEditModeImpl()},_setLayerToolsEditModeImpl:function(){},startPlugin:function(e){var t,i=this;i._eventHandlers=i.createEventHandlers(),i._sandbox=e,e.register(i);for(t in i._eventHandlers)i._eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(i,t);i._startPluginImpl(e),i._setLayerToolsEditMode(i.getMapModule().isInLayerToolsEditMode())},_startPluginImpl:function(){},stopPlugin:function(e){var t,i=this;i._stopPluginImpl(e);for(t in i._eventHandlers)i._eventHandlers.hasOwnProperty(t)&&i._sandbox.unregisterFromEventByName(i,t);e.unregister(i),i._sandbox=null},_stopPluginImpl:function(){},start:function(e){return this._startImpl(e)},_startImpl:function(){},stop:function(e){return this._stopImpl(e)},_stopImpl:function(){},onEvent:function(e){var t=this,i=t._eventHandlers[e.getName()];return i?i.apply(t,[e]):void 0}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("src/mapping/mapmodule/plugin/AbstractMapModulePlugin",function(){}),Oskari.clazz.define("Oskari.mapping.mapmodule.plugin.BasicMapModulePlugin",function(e){this._config=e,this._enabled=!0,this._visible=!0},{_startPluginImpl:function(){var e=this;e._element=e._createControlElement(),e._ctl=e._createControlAdapter(e._element),e._ctl&&e.getMapModule().addMapControl(e._pluginName,e._ctl),e.refresh(),e.setEnabled(e._enabled),e.setVisible(e._visible),e._element&&e._element.attr("data-clazz",e.getClazz()),e.getMapModule().setMapControlPlugin(e._element,e.getLocation(),e.getIndex())},_stopPluginImpl:function(){var e=this,t=e.getMapModule();e._ctl&&(t.removeMapControl(e._pluginName,e._ctl),e._ctl=null),e._destroyControlElement(),e._element&&(t.removeMapControlPlugin(e._element,this.inLayerToolsEditMode()),e._element=null)},getClazz:function(){var e=this._clazz;if(null===e||void 0===e||e.length<1)throw"No clazz provided for "+this.getName()+"!";return e},getElement:function(){return this._element},getIndex:function(){return this._index},getConfig:function(){var e={};return this._config?jQuery.extend(!0,e,this._config):e},setConfig:function(e){this._config=e,this.refresh()},refresh:function(){},getLocation:function(){var e=this._defaultLocation;return this._config&&this._config.location&&(e=this._config.location.classes),e},setLocation:function(e){var t=this,i=t.getElement();t._config||(t._config={}),t._config.location||(t._config.location={}),t._config.location.classes=e,i&&t.getMapModule().setMapControlPlugin(i,e,t.getIndex())},_setColorScheme:function(){},_setFont:function(){},_setStyle:function(){},hasUI:function(){return!0},_createControlElement:function(){},_destroyControlElement:function(){},_createControlAdapter:function(){},_toggleUIControls:function(){},setEnabled:function(e){this._toggleUIControls(e),this._enabled=e},getEnabled:function(){return this._enabled},setVisible:function(e){this._element&&this._element.toggle(e),this._visible=e},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"],extend:["Oskari.mapping.mapmodule.plugin.AbstractMapModulePlugin"]}),define("src/mapping/mapmodule/plugin/BasicMapModulePlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.MapModule",function(e,t,i,n){this._options={resolutions:[2e3,1e3,500,200,100,50,20,10,4,2,1,.5,.25],srsName:"EPSG:3067",units:"m"},this._mapDivId=n;var a;if(i)for(a in i)i.hasOwnProperty(a)&&(this._options[a]=i[a])},{_addMapControlPluginContainers:function(){var e,t,i=["bottom center","center top","center right","center left","bottom right","bottom left","right top","left top"],n=this.getMapEl();for(t=0;t<i.length;t++)e=jQuery('<div class="mapplugins"><div class="mappluginsContainer"><div class="mappluginsContent"></div></div></div>'),e.addClass(i[t]),e.attr("data-location",i[t]),n.append(e)},_getMapControlPluginContainer:function(e){var t,i=(e+"").split(" "),n=".mapplugins."+i.join("."),a=this.getMapEl();if(t=a.find(n),!t.length){var r,s,o,l,u,c=["bottom center","center top","center right","center left","bottom right","bottom left","right top","left top"],d=null;for(l=0;l<c.length;l++)if(r=c[l].split(" "),s=a.find(".mapplugins."+r.join(".")),s.length)d=s;else{for(o=!0,u=0;u<r.length;u++)if(jQuery.inArray(r[u],i)<0){o=!1;break}o&&(t=jQuery('<div class="mapplugins"><div class="mappluginsContainer"><div class="mappluginsContent"></div></div></div>'),t.addClass(e),t.attr("data-location",e),null!==d&&d.length?d.after(t):a.prepend(t))}}return t},setMapControlPlugin:function(e,t,i){var n,a=this._getMapControlPluginContainer(t),r=a.find(".mappluginsContainer .mappluginsContent"),s=i+"",o=/^(?=.*\bbottom\b)((?=.*\bleft\b)|(?=.*\bright\b)).+/.test(t),l=null;if(!e)throw"Element is non-existent.";if(!t)throw"No container classes.";if(!r||!r.length)throw'Container with classes "'+containerSelector+'" not found.';e.attr("data-position",i),e.detach(),null!==i&&void 0!==i?(r.find(".mapplugin").each(function(){n=jQuery(this),(!o&&n.attr("data-position")<=s||o&&n.attr("data-position")>s)&&(l=n)}),l?l.after(e):r.prepend(e)):r.append(e),a.css("display","")},removeMapControlPlugin:function(e,t){var i=e.parents(".mapplugins"),n=e.parents(".mappluginsContent");e.remove(),t||0!==n.children().length||i.css("display","none")},_initImpl:function(e,t,i){var n=this._calculateScalesFromResolutions(t.resolutions,i.units);return this._mapScales=n,this._createBaseLayer(),this._addMapControlPluginContainers(),i},_startImpl:function(){var e=this.getSandbox();return this._addRequestHandlersImpl(e),!0},_addRequestHandlersImpl:function(e){this.requestHandlers={mapLayerUpdateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",e,this),mapMoveRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",e,this)},e.addRequestHandler("MapModulePlugin.MapLayerUpdateRequest",this.requestHandlers.mapLayerUpdateHandler),e.addRequestHandler("MapMoveRequest",this.requestHandlers.mapMoveRequestHandler)},_calculateScalesFromResolutions:function(e,t){var i,n,a=[];for(i=0;i<e.length;++i)n=OpenLayers.Util.getScaleFromResolution(e[i],t),n=1e8*n,n=Math.round(n),n/=1e8,a.push(n);return a},getMapViewPortDiv:function(){return this._map.viewPortDiv},getMapLayersContainerDiv:function(){return this._map.layerContainerDiv},_createMap:function(){this.getSandbox().printWarn("_createMap is deprecated. Use _createMapImpl instead."),this._createMapImpl()},_createMapImpl:function(){var e=(this._sandbox,new OpenLayers.LonLat(0,0)),t=new OpenLayers.Bounds(0,0,1e7,1e7);return null!==this._options&&void 0!==this._options&&null!==this._options.maxExtent&&void 0!==this._options.maxExtent&&null!==this._options.maxExtent.left&&void 0!==this._options.maxExtent.left&&null!==this._options.maxExtent.bottom&&void 0!==this._options.maxExtent.bottom&&null!==this._options.maxExtent.right&&void 0!==this._options.maxExtent.right&&null!==this._options.maxExtent.top&&void 0!==this._options.maxExtent.top&&(t=new OpenLayers.Bounds(this._options.maxExtent.left,this._options.maxExtent.bottom,this._options.maxExtent.right,this._options.maxExtent.top)),this._map=new OpenLayers.Map({controls:[],units:this._options.units,maxExtent:t,resolutions:this._options.resolutions,projection:this._options.srsName,isBaseLayer:!0,center:e,fallThrough:!0,theme:null,zoom:0,zoomMethod:null}),this._map},_ensureExists:function(e){return null!==e&&void 0!==e},_createBaseLayer:function(){var e=new OpenLayers.Layer("BaseLayer",{layerId:0,isBaseLayer:!0,displayInLayerSwitcher:!1});this._map.addLayer(e)},moveMapToLanLot:function(e,t,i){var n=i===!0;this._map.setCenter(e,this._getMapZoom(),n),t&&this.adjustZoomLevel(t,!0),this._updateDomainImpl()},panMapToLonLat:function(e,t){this._map.setCenter(e,this._getMapZoom()),this._updateDomainImpl(),t!==!0&&this.notifyMoveEnd()},zoomToScale:function(e,t,i){var n=t===!0;this._map.zoomToScale(e,n),this._updateDomainImpl(),i!==!0&&this.notifyMoveEnd()},centerMap:function(e,t,i){this._map.setCenter(e,t,!1),this._updateDomainImpl(),i!==!0&&this.notifyMoveEnd()},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(e){this.setZoomLevel(e,!1)},panMapEast:function(){var e=this._map.getSize();this.panMapByPixels(.75*e.w,0)},panMapWest:function(){var e=this._map.getSize();this.panMapByPixels(-.75*e.w,0)},panMapNorth:function(){var e=this._map.getSize();this.panMapByPixels(0,-.75*e.h)},panMapSouth:function(){var e=this._map.getSize();this.panMapByPixels(0,.75*e.h)},panMapByPixels:function(e,t,i,n,a){this._map.pan(e,t,{dragging:a?!0:!1,animate:!1}),this._updateDomainImpl(),i!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd()},moveMapByPixels:function(e,t,i,n){this._map.moveByPx(e,t),this._updateDomainImpl(),i!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd()},centerMapByPixels:function(e,t,i,n){var a=new OpenLayers.Pixel(e,t),r=this._map.getLonLatFromViewPortPx(a);this.isValidLonLat(r.lon,r.lat)&&(this.moveMapToLanLot(r),i!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd())},isValidLonLat:function(e,t){var i=!0;return 625e4>t||t>82e5?i=!1:((0>e||e>135e4)&&(i=!1),i)},zoomToExtent:function(e,t,i){this._map.zoomToExtent(e),this._updateDomainImpl(),t!==!0&&this.notifyStartMove(),i!==!0&&this.notifyMoveEnd()},adjustZoomLevel:function(e,t){var i=this._getNewZoomLevel(e);this._map.zoomTo(i),this._updateDomainImpl(),t!==!0&&this.notifyMoveEnd()},setZoomLevel:function(e,t){var i=this._getMapZoom();e!==i&&((0>e||e>this._map.getNumZoomLevels)&&(e=this._getMapZoom()),this._map.zoomTo(e),this._updateDomainImpl(),t!==!0&&this.notifyMoveEnd())},_getNewZoomLevel:function(e){var t=this._getMapZoom()+e;return t>=0&&t<=this._map.getNumZoomLevels()?t:this._getMapZoom()},notifyStartMove:function(){if(!this.getStealth()){this.getSandbox().getMap().setMoving(!0);var e=this._getMapCenter().lon,t=this._getMapCenter().lat,i=this.getSandbox().getEventBuilder("MapMoveStartEvent")(e,t);this.getSandbox().notifyAll(i)}},_getMapCenter:function(){return this._map.getCenter()},_getMapZoom:function(){return this._map.getZoom()},_getMapScale:function(){return this._map.getScale()},_getMapLayersByName:function(e){return this._map.getLayersByName(e)},notifyMoveEnd:function(e){if(!this.getStealth()){var t=this.getSandbox();t.getMap().setMoving(!1);var i=this._getMapCenter();this._updateDomainImpl();var n=t.getEventBuilder("AfterMapMoveEvent")(i.lon,i.lat,this._getMapZoom(),!1,this._getMapScale(),e);t.notifyAll(n)}},updateSize:function(){this.getMap().updateSize(),this._updateDomainImpl();var e=this.getSandbox(),t=e.getMap(),i=e.getEventBuilder("MapSizeChangedEvent")(t.getWidth(),t.getHeight());e.notifyAll(i)},_updateDomain:function(){this.getSandbox().printWarn("_updateDomain is deprecated. Use _updateDomainImpl instead."),this._updateDomainImpl()},_updateDomainImpl:function(){if(!this.getStealth()){var e=this.getSandbox(),t=e.getMap(),i=this._getMapCenter();t.moveTo(i.lon,i.lat,this._getMapZoom()),t.setScale(this._getMapScale());var n=this._map.getCurrentSize();t.setWidth(n.w),t.setHeight(n.h),t.setResolution(this._map.getResolution()),t.setExtent(this._map.getExtent()),t.setMaxExtent(this._map.getMaxExtent()),t.setBbox(this._map.calculateBounds())}},transformCoordinates:function(e,t){return this.getSandbox().printWarn("transformCoordinates is deprecated. Use _transformCoordinates instead if called from plugin. Otherwise, use Requests instead."),this._transformCoordinates(e,t)},_transformCoordinates:function(e,t){return e.transform(new OpenLayers.Projection(t),this.getMap().getProjectionObject())},eventHandlers:{AfterMapLayerAddEvent:function(e){this._afterMapLayerAddEvent(e)},LayerToolsEditModeEvent:function(e){this._isInLayerToolsEditMode=e.isInMode()}},_afterMapLayerAddEvent:function(e){var t,i=(this.getMap(),e.getMapLayer()),n=e.getKeepLayersOrder(),a=e.isBasemap(),r=this.getLayerPlugins(),s=[];for(_.each(r,function(e){if(_.isFunction(e.addMapLayerToMap)){var t=e.addMapLayerToMap(i,n,a);_.isFunction(t)&&s.push(t)}}),t=0;t<s.length;t++)s[t].apply()},getOLMapLayers:function(e){var t=this,i=t._sandbox,n=i.findMapLayerFromSelectedMapLayers(e);if(!n)return null;var a,r,s,o=this.getLayerPlugins(),l=[];for(a in o)o.hasOwnProperty(a)&&(r=o[a],r||this.getSandbox().printWarn('LayerPlugins has no entry for "'+a+'"'),s=r?r.getOLMapLayers(n):null,s&&(l=l.concat(s)));return l},changeCssClasses:function(e,t,i){var n,a,r;for(n=0;n<i.length;n++)r=i[n],r.removeClass(function(e,i){var n="",r=i.split(" ");for(a=0;a<r.length;++a)t.test(r[a])&&(n+=r[a]+" ");return n}),r.addClass(e)},isInLayerToolsEditMode:function(){return this._isInLayerToolsEditMode},_calculateScalesImpl:function(e){for(var t=0;t<e.length;++t){var i=OpenLayers.Util.getScaleFromResolution(e[t],"m");i=1e4*i,i=Math.round(i),i/=1e4,this._mapScales.push(i)}},_addMapControlImpl:function(e){this._map.addControl(e)},_removeMapControlImpl:function(e){this._map.removeControl(e)},getMapEl:function(){var e=jQuery("#"+this._mapDivId);return e.length||this.getSandbox().printWarn("mapDiv not found with #"+this._mapDivId),e},getMapElDom:function(){return this.getMapEl().get(0)}},{protocol:["Oskari.mapframework.module.Module"],extend:["Oskari.mapping.mapmodule.AbstractMapModule"]}),define("bundles/framework/bundle/mapmodule-plugin/ui/module/map-module",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.Plugin",function(){throw"Oskari.mapframework.ui.module.common.mapmodule.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setMapModule:function(){throw"Implement your own"},register:function(){throw"Implement your own"},unregister:function(){throw"Implement your own"},startPlugin:function(){throw"Implement your own"},stopPlugin:function(){throw"Implement your own"},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}}),define("bundles/framework/bundle/mapmodule-plugin/plugin/Plugin",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ControlsPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.conf=e||{}},{__name:"ControlsPlugin",getName:function(){return this.pluginName},hasUI:function(){return!0},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name,this._createMapControls())},register:function(){},unregister:function(){},init:function(e){var t=this,i=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",t.getMapModule());this.requestHandlers={ToolSelectionRequest:Oskari.clazz.create("Oskari.mapframework.mapmodule.ToolSelectionHandler",e,t),EnableMapKeyboardMovementRequest:i,DisableMapKeyboardMovementRequest:i,EnableMapMouseMovementRequest:i,DisableMapMouseMovementRequest:i}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t,i;for(t in this.requestHandlers)this.requestHandlers.hasOwnProperty(t)&&e.addRequestHandler(t,this.requestHandlers[t]);for(i in this.eventHandlers)this.eventHandlers.hasOwnProperty(i)&&e.registerForEventByName(this,i);this._addMapControls()},stopPlugin:function(e){var t,i;for(t in this.requestHandlers)this.requestHandlers.hasOwnProperty(t)&&e.removeRequestHandler(t,this.requestHandlers[t]);for(i in this.eventHandlers)this.eventHandlers.hasOwnProperty(i)&&e.unregisterFromEventByName(this,i);e.unregister(this),this._removeMapControls(),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this.conf.zoomBox!==!1&&this._zoomBoxTool.deactivate(),this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate())}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_addMapControls:function(){this.conf.zoomBox!==!1&&(this.getMapModule().addMapControl("zoomBoxTool",this._zoomBoxTool),this._zoomBoxTool.deactivate()),this.conf.keyboardControls!==!1&&(this.getMapModule().addMapControl("keyboardControls",this._keyboardControls),this.getMapModule().getMapControl("keyboardControls").activate()),this.conf.measureControls!==!1&&(this.getMapModule().addMapControl("measureControls_line",this._measureControls.line),this._measureControls.line.deactivate(),this.getMapModule().addMapControl("measureControls_area",this._measureControls.area),this._measureControls.area.deactivate()),this.getMapModule().addMapControl("mouseControls",this._mouseControls)},_removeMapControls:function(){this.conf.zoomBox!==!1&&(this._zoomBoxTool.deactivate(),this.getMapModule().removeMapControl("zoomBoxTool",this._zoomBoxTool)),this.conf.keyboardControls!==!1&&(this._keyboardControls.deactivate(),this.getMapModule().removeMapControl("keyboardControls",this._keyboardControls)),this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate(),this.getMapModule().removeMapControl("measureControls_line",this._measureControls.line),this.getMapModule().removeMapControl("measureControls_area",this._measureControls.area)),this._mouseControls.deactivate(),this.getMapModule().removeMapControl("mouseControls",this._mouseControls)},_createMapControls:function(){function e(e,i){var n=t._sandbox,a=e.geometry,r=e.units,s=e.order,o=e.measure,l=null;1===s?l=o.toFixed(3)+" "+r:2===s&&(l=o.toFixed(3)+" "+r+"<sup>2</sup>");var u=null,c=null;if(i&&OpenLayers.Format.GeoJSON){var d=new OpenLayers.Format.GeoJSON;u=d.write(a,!0),c="application/json"}n.request(t,n.getRequestBuilder("ShowMapMeasurementRequest")(l,i,u,c))}{var t=this;t._sandbox}if(!this._zoomBoxTool){this.conf.zoomBox!==!1&&(OpenLayers.Control.ZoomBox.prototype.draw=function(){this.handler=new OpenLayers.Handler.Box(this,{done:function(e){this.zoomBox(e),t.getMapModule()&&t.getMapModule().notifyMoveEnd()}},{keyMask:this.keyMask})},this._zoomBoxTool=new OpenLayers.Control.ZoomBox({alwaysZoom:!0})),this.conf.keyboardControls!==!1&&(this._keyboardControls=new OpenLayers.Control.PorttiKeyboard,this._keyboardControls.setup(this.getMapModule()));var i={handlerOptions:{persist:!0},immediate:!0},n={handlerOptions:{persist:!0},immediate:!0};this._measureControls={},this.conf.measureControls!==!1&&(this._measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,i),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,n)});var a,r;for(a in this._measureControls)this._measureControls.hasOwnProperty(a)&&(r=this._measureControls[a],r.events.on({measure:function(t){e(t,!0)},measurepartial:function(t){e(t,!1)}}));this.conf.mouseControls!==!1&&(this._mouseControls=new OskariNavigation,this._mouseControls.setup(this.getMapModule()))}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/ControlsPlugin",function(){}),OpenLayers.Control.PorttiKeyboard=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:50,core:null,setup:function(e){this.mapmodule=e,this.sandbox=e.getSandbox()},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyDown,keyup:this.defaultKeyUp})},defaultKeyDown:function(e){if(!(jQuery("input:focus").length>0))switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.mapmodule.panMapByPixels(-this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_RIGHT:this.mapmodule.panMapByPixels(this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_UP:this.mapmodule.panMapByPixels(0,-this.slideFactor,!1,!0);break;case OpenLayers.Event.KEY_DOWN:this.mapmodule.panMapByPixels(0,this.slideFactor,!1,!0);break;case 17:this.sandbox.postRequestByName("CtrlKeyDownRequest");break;case 27:this.sandbox.postRequestByName("EscPressedEvent");break;case 33:this.mapmodule.notifyStartMove(),this.mapmodule.panMapNorth();break;case 34:this.mapmodule.notifyStartMove(),this.mapmodule.panMapSouth();break;case 35:this.mapmodule.notifyStartMove(),this.mapmodule.panMapEast();break;case 36:this.mapmodule.notifyStartMove(),this.mapmodule.panMapWest();break;case 43:case 61:case 187:case 107:this.mapmodule.zoomIn();break;case 45:case 109:case 189:case 95:this.mapmodule.zoomOut();break;case 70:this.sandbox.isCtrlKeyDown()||this.sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest")}},defaultKeyUp:function(e){switch(e.keyCode){case 17:this.sandbox.postRequestByName("CtrlKeyUpRequest");break;case 37:case 38:case 39:case 40:case 33:case 34:case 35:case 36:case 43:case 61:case 187:case 107:case 45:case 109:case 189:case 95:this.mapmodule.notifyMoveEnd()}},CLASS_NAME:"OpenLayers.Control.PorttiKeyboard"}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiKeyboard",function(){}),OskariNavigation=OpenLayers.Class(OpenLayers.Control.Navigation,{initialize:function(e,t){OpenLayers.Control.Navigation.prototype.initialize.apply(this,[e,t])},setup:function(e){this.mapmodule=e,this.sandbox=this.mapmodule.getSandbox(),this._hoverEventBuilder=this.sandbox.getEventBuilder("MouseHoverEvent"),this._hoverEvent=this._hoverEventBuilder(),this._mapClickedBuilder=this.sandbox.getEventBuilder("MapClickedEvent")},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False),OpenLayers.Control.DragPan.prototype.enableKinetic=!1,window.navigator.msPointerEnabled&&jQuery(this.mapmodule.getMapEl()).css("ms-touch-action","none");var e=this,t=function(t,i){return function(){var n=i||e;t.apply(n,arguments),e.mapmodule.notifyMoveEnd()}},i=function(t,i){return function(){var n=i||e;t.apply(n,arguments),e.__sendMapClickEvent(arguments[0])}},n={click:i(this.defaultClick),dblclick:t(this.defaultDblClick),dblrightclick:t(this.defaultDblRightClick)},a={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,n,a),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));var r=this.dragPan.panMapDone;this.dragPan.panMapDone=t(r,this.dragPan),this.wheelChange=t(this.wheelChange),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});var s=this.zoomBox.zoomBox;this.zoomBox.zoomBox=t(s,this.zoomBox),this.dragPan.draw(),this.zoomBox.draw();var o=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(o,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OskariPinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)),this.pinchZoom.setup(this.mapmodule)),this.__addHoverSupport()},__addHoverSupport:function(){var e={move:this.__defaultHoverMove,pause:this.__defaultHoverPause},t={pixelTolerance:1.1,passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));i<this.pixelTolerance&&(t=!1)}return t}};this.handlers.hover=new OpenLayers.Handler.Hover(this,e,t),this.handlers.hover.activate()},__defaultHoverMove:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this._hoverEvent.set(t.lon,t.lat,!1,e.pageX,e.pageY),this.sandbox.notifyAll(this._hoverEvent,!0)},__defaultHoverPause:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this._hoverEvent.set(t.lon,t.lat,!0,e.pageX,e.pageY),this.sandbox.notifyAll(this._hoverEvent)
},__sendMapClickEvent:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy),i=this._mapClickedBuilder(t,e.xy.x,e.xy.y);this.sandbox.notifyAll(i)}}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/OskariNavigation",function(){}),OskariPinchZoom=OpenLayers.Class(OpenLayers.Control.PinchZoom,{initialize:function(){OpenLayers.Control.PinchZoom.prototype.initialize.apply(this,arguments)},setup:function(e){this.mapmodule=e},pinchDone:function(){OpenLayers.Control.PinchZoom.prototype.pinchDone.apply(this,arguments),this.mapmodule.notifyMoveEnd()}}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/OskariPinchZoom",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"DisableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/DisableMapKeyboardMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapMouseMovementRequest",function(){this._creator=null},{__name:"DisableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/DisableMapMouseMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"EnableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/EnableMapKeyboardMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapMouseMovementRequest",function(){this._creator=null},{__name:"EnableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/EnableMapMouseMovementRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",function(e){this.mapModule=e},{handleRequest:function(e,t){var i;"EnableMapKeyboardMovementRequest"===t.getName()?(i=this.mapModule.getMapControl("keyboardControls"),i&&i.activate()):"DisableMapKeyboardMovementRequest"===t.getName()?(i=this.mapModule.getMapControl("keyboardControls"),i&&i.deactivate()):"EnableMapMouseMovementRequest"===t.getName()?(i=this.mapModule.getMapControl("mouseControls"),i&&(i.activate(),i.registerMouseEvents())):"DisableMapMouseMovementRequest"===t.getName()&&(i=this.mapModule.getMapControl("mouseControls"),i&&(i.deactivate(),i.unregisterMouseEvents()))}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMovementControlsRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapMeasurementRequest",function(e,t,i,n){this._creator=null,this._value=e,this._geometry=i,this._finished=t,this._geometryMimeType=n},{__name:"ShowMapMeasurementRequest",getName:function(){return this.__name},getValue:function(){return this._value},getGeometry:function(){return this._geometry},getGeometryMimeType:function(){return this._geometryMimeType},isFinished:function(){return this._finished}},{protocol:["Oskari.mapframework.request.Request"]}),define("src/oskari/base/request/common/show-map-measurement-request",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",function(e){this.getInfoPlugin=e},{handleRequest:function(e,t){"MapModulePlugin.GetFeatureInfoRequest"==t.getName()?this.getInfoPlugin.handleGetInfo({lon:t.getLon(),lat:t.getLat()},t.getX(),t.getY()):"MapModulePlugin.GetFeatureInfoActivationRequest"==t.getName()&&this.getInfoPlugin.setEnabled(t.isEnabled())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoRequest",function(e,t,i,n){this._lon=e,this._lat=t,this._x=i,this._y=n},{__name:"MapModulePlugin.GetFeatureInfoRequest",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoActivationRequest",function(e){this._enable=e===!0},{__name:"MapModulePlugin.GetFeatureInfoActivationRequest",getName:function(){return this.__name},isEnabled:function(){return this._enable}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoActivationRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.GetInfoPlugin",function(e,t){var i=this;i.config=e,i._locale=t,i.mapModule=null,i.pluginName=null,i._sandbox=null,i._map=null,i.enabled=!0,i.infoboxId="getinforesult",i._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null},i.clickLocation=null,i.template={};var n;for(n in i.__templates)i.__templates.hasOwnProperty(n)&&(i.template[n]=jQuery(i.__templates[n]))},{__name:"GetInfoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this;t._sandbox=e,t._sandbox.printDebug("[GetInfoPlugin] init"),t.getGFIHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",t)},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;e&&e.register&&(i._sandbox=e),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoRequest",i.getGFIHandler),i._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoActivationRequest",i.getGFIHandler)},stopPlugin:function(e){var t,i=this;i._closeGfiInfo(),e&&e.register&&(i._sandbox=e);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.unregisterFromEventByName(i,t);i._sandbox.unregister(i),i._map=null,i._sandbox=null,i.clickLocation=null},start:function(){},stop:function(){},setEnabled:function(e){this.enabled=e===!0,this.enabled||this._closeGfiInfo()},eventHandlers:{EscPressedEvent:function(){this._closeGfiInfo()},MapClickedEvent:function(e){this.enabled&&(this.clickLocation={lonlat:e.getLonLat()},this.handleGetInfo(this.clickLocation.lonlat))},AfterMapMoveEvent:function(){this._cancelAjaxRequest()},AfterMapLayerRemoveEvent:function(e){this._refreshGfiInfo("remove",e.getMapLayer().getId())},AfterMapLayerAddEvent:function(){this._refreshGfiInfo()},"InfoBox.InfoBoxEvent":function(e){this._handleInfoBoxEvent(e)},GetInfoResultEvent:function(e){this.enabled&&this._handleInfoResult(e.getData())},"Realtime.RefreshLayerEvent":function(e){this._refreshGfiInfo("update",e.getMapLayer().getId())}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_cancelAjaxRequest:function(){var e=this;if(e._pendingAjaxQuery.busy){var t=e._pendingAjaxQuery.jqhr;e._pendingAjaxQuery.jqhr=null,t&&(this._sandbox.printDebug("[GetInfoPlugin] Abort jqhr ajax request"),t.abort(),t=null,e._pendingAjaxQuery.busy=!1)}},_buildLayerIdList:function(e){var t=this,i=e||t._sandbox.findAllSelectedMapLayers(),n=_.chain(i).filter(function(e){return t._isQualified(e)}).map(function(e){return e.getId()}).value().join(",");return n||null},_isQualified:function(e){return!this._isIgnoredLayerType(e)&&e.getQueryable&&e.getQueryable()&&e.isInScale(this._sandbox.getMap().getScale())&&e.isVisible()},_isIgnoredLayerType:function(e){return _.any((this.config||{}).ignoredLayerTypes,function(t){return e.isLayerOfType(t)})},_startAjaxRequest:function(e){this._pendingAjaxQuery.busy=!0,this._pendingAjaxQuery.timestamp=e},_finishAjaxRequest:function(){this._pendingAjaxQuery.busy=!1,this._pendingAjaxQuery.jqhr=null,this._sandbox.printDebug("[GetInfoPlugin] finished jqhr ajax request")},_notifyAjaxFailure:function(){this._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo AJAX failed")},_isAjaxRequestBusy:function(){return this._pendingAjaxQuery.busy},handleGetInfo:function(e,t){var i=this,n=(new Date).getTime(),a=i._buildLayerIdList(t),r=this._sandbox.getAjaxUrl(),s=i._sandbox.getMap(),o=i.mapModule.getMap(),l=o.getViewPortPxFromLonLat(e);if(a){if(i._pendingAjaxQuery.busy&&i._pendingAjaxQuery.timestamp&&n-i._pendingAjaxQuery.timestamp<500)return void i._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo NOT SENT (time difference < 500ms)");i._cancelAjaxRequest(),i._startAjaxRequest(n),jQuery.ajax({beforeSend:function(e){i._pendingAjaxQuery.jqhr=e,e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){i._isAjaxRequestBusy()&&_.each(t.data,function(t){i._handleInfoResult({features:[t],lonlat:e,via:"ajax"})}),i._finishAjaxRequest()},error:function(){i._finishAjaxRequest(),i._notifyAjaxFailure()},always:function(){i._finishAjaxRequest()},complete:function(){i._finishAjaxRequest()},data:{layerIds:a,projection:i.mapModule.getProjection(),x:Math.round(l.x),y:Math.round(l.y),lon:e.lon,lat:e.lat,width:s.getWidth(),height:s.getHeight(),bbox:s.getBbox().toBBOX(),zoom:s.getZoom(),srs:s.getSrsName()},type:"POST",dataType:"json",url:r+"action_route=GetFeatureInfoWMS"})}},_handleInfoResult:function(e){var t=[],i={},n=[];n="ajax"===e.via?this._parseGfiResponse(e):this._formatWFSFeaturesForInfoBox(e),n.length&&(i.actions={},i.html=this._renderFragments(n),i.layerId=n[0].layerId,t.push(i)),this._showGfiInfo(t,e.lonlat)},_closeGfiInfo:function(){var e,t=this._sandbox.getRequestBuilder("InfoBox.HideInfoBoxRequest");t&&(e=t(this.infoboxId),this._sandbox.request(this,e))},_showGfiInfo:function(e,t){var i,n,a,r=this.getMapModule().getLocalization("plugin",!0),s=r[this.__name],o=this._sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest");_.isObject(this.config)&&(n=this.config.colourScheme,a=this.config.font),o&&(i=o(this.infoboxId,s.title,e,t,!0,n,a),this._sandbox.request(this,i))},_refreshGfiInfo:function(e,t){var i,n;this.clickLocation&&(i=this._sandbox.getRequestBuilder("InfoBox.RefreshInfoBoxRequest"),i&&(n=i(this.infoboxId,e,t),this._sandbox.request(this,n)))},_handleInfoBoxEvent:function(e){var t,i,n,a=this._sandbox,r=this.clickLocation,s=e.getContentId();e.getId()===this.infoboxId&&e.isOpen()&&_.isObject(r)&&(s?(t=a.findMapLayerFromSelectedMapLayers(s),t&&this.handleGetInfo(r.lonlat,[t])):(i=a.getEventBuilder("MapClickedEvent"),n=i(r.lonlat),setTimeout(function(){a.notifyAll(n)},0)))}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetInfoPlugin",function(){}),Oskari.clazz.category("Oskari.mapframework.mapmodule.GetInfoPlugin","formatter",{__templates:{wrapper:"<div></div>",getinfoResultTable:'<table class="getinforesult_table"></table>',tableRow:"<tr></tr>",tableCell:"<td></td>",span:"<span></span>",header:'<div class="getinforesult_header"><div class="icon-bubble-left"></div>',headerTitle:'<div class="getinforesult_header_title"></div>',myPlacesWrapper:'<div class="myplaces_place"><h3 class="myplaces_header"></h3><p class="myplaces_desc"></p><a class="myplaces_imglink" target="_blank"><img class="myplaces_img"></img></a><a class="myplaces_link" target="_blank"></a></div>',linkOutside:'<a target="_blank"></a>'},_renderFragments:function(e){var t=this;return _.foldl(e,function(e,i){var n=i.layerName,a=i.markup;if(i.isMyPlace)a&&e.append(a);else{var r=t.template.wrapper.clone(),s=t.template.header.clone(),o=t.template.headerTitle.clone();o.append(n),s.append(o),r.append(s),a&&r.append(a),e.append(r)}return delete i.isMyPlace,e},t.template.wrapper.clone())},_parseGfiResponse:function(e){if(0!==e.layerCount){var t,i=this,n=this._sandbox;return t=_.chain(e.features).map(function(e){var t=n.findMapLayerFromSelectedMapLayers(e.layerId),a=t?t.getName():"",r=i._formatGfiDatum(e),s=e.layerId+"";return null!==r&&void 0!==r?{markup:r,layerId:s,layerName:a,type:e.type,isMyPlace:!!s.match("myplaces_")}:void 0}).reject(function(e){return void 0===e}).value(),t||[]}},_isHTML:function(e){var t=!1;return e&&"string"==typeof e&&(e.indexOf("<html")>=0?t=!0:e.indexOf("<HTML")>=0&&(t=!0)),t},_formatGfiDatum:function(e){if(!e.presentationType)return null;var t=this,i=t.template.wrapper.clone();if("JSON"===e.presentationType||e.content&&e.content.parsed){if(e.layerId&&"string"==typeof e.layerId&&e.layerId.match("myplaces_"))return _.foldl(e.content.parsed.places,function(e,i){return e.append(t._formatMyPlacesGfi(i)),e},jQuery("<div></div>"));var n,a,r,s,o,l,u,c,d,h,p,f=!1,m=e.content.parsed,g=[];for("[object Array]"===Object.prototype.toString.call(m)?g=m:g.push(m),n=0;n<g.length;n+=1){r=g[n],s=t.template.getinfoResultTable.clone();for(a in r)r.hasOwnProperty(a)&&(o=t._formatJSONValue(r[a]),o&&(l=t.template.tableRow.clone(),f||l.addClass("odd"),f=!f,u=t.template.tableCell.clone(),c=this.getMapModule().getLocalization("plugin",!0),d=c[this.__name],h=d[a],u.append(h||a),l.append(u),p=t.template.tableCell.clone(),p.append(o),l.append(p),s.append(l)));i.append(s)}}else if(t._isHTML(e.content)){var v=jQuery("<div></div>").append(e.content);if(v.find("link, meta, script, style, title").remove(),""===jQuery.trim(v.html()))return null;v.find("table").addClass("getinforesult_table"),v.find("tr").removeClass("odd"),v.find("tr:even").addClass("odd"),i.append(v.html())}else i.append(e.content);return e.gfiContent&&i.append("\n"+e.gfiContent),i},_formatJSONValue:function(e){if(e){var t=this.template.span.clone();if("[object Array]"===Object.prototype.toString.call(e)){var i,n,a,r,s,o,l;for(i=0;i<e.length;i+=1){n=e[i];for(a in n)n.hasOwnProperty(a)&&(r=this._formatJSONValue(n[a]),r&&(s=this.getMapModule().getLocalization("plugin",!0),o=s[this.__name],l=o[a],t.append(l||a),t.append(": "),t.append(r),t.append("<br/>")))}}else if(e.indexOf&&e.indexOf("://")>0&&e.indexOf("://")<7){var u=this.template.linkOutside.clone();u.attr("href",e),u.append(e),t.append(u)}else t.append(e);return t}},_formatWFSFeaturesForInfoBox:function(e){var t,i,n=this,a=this._sandbox.findMapLayerFromSelectedMapLayers(e.layerId),r=a.isLayerOfType("myplaces"),s=a.getFields().slice(),o=["__fid","__centerX","__centerY"],l="wfslayer";if("empty"!==e.features&&null!==a&&void 0!==a)return r||(s=_.chain(s).zip(a.getLocales().slice()).map(function(e){return _.contains(o,_.first(e))?_.first(e):_.last(e)||_.first(e)}).value()),t=_.map(e.features,function(t){var u=_.chain(s).zip(t).filter(function(e){return!_.contains(o,_.first(e))}).foldl(function(e,t){return e[_.first(t)]=_.last(t),e},{}).value();return i=r?n._formatMyPlacesGfi(u):n._json2html(u),{markup:i,layerId:e.layerId,layerName:a.getName(),type:l,isMyPlace:r}})},_formatMyPlacesGfi:function(e){var t=this,i=t.template.myPlacesWrapper.clone(),n=i.find("p.myplaces_desc"),a=i.find("a.myplaces_imglink"),r=i.find("a.myplaces_link");return i.find("h3.myplaces_header").html(e.name),e.place_desc?n.html(e.place_desc):e.description?n.html(e.description):n.remove(),e.image_url&&"string"==typeof e.image_url?a.attr({href:e.image_url}).find("img.myplaces_img").attr({src:e.image_url}):e.imageUrl&&"string"==typeof e.imageUrl?a.attr({href:e.imageUrl}).find("img.myplaces_img").attr({src:e.imageUrl}):a.remove(),e.link?r.attr({href:e.link}).html(e.link):r.remove(),i},_json2html:function(e){if(null===e||void 0===e)return"";var t,i,n,a,r,s,o,l=!0,u=this.template.getinfoResultTable.clone(),c=null,d=null,h=null;for(t in e)if(e.hasOwnProperty(t)){if(i=e[t],null===i||void 0===i||null===t||void 0===t)continue;switch(n=(typeof i).toLowerCase(),a="",n){case"string":0===i.indexOf("http://")?(a=this.template.linkOutside.clone(),a.attr("href",i),a.append(i)):a=i;break;case"undefined":a="n/a";break;case"boolean":a=i?"true":"false";break;case"number":a=""+i;break;case"function":a="?";break;case"object":if(jQuery.isArray(i)){for(r=this.template.wrapper.clone(),o=0;o<i.length;o+=1)s=this._json2html(i[o]),r.append(s);a=r}else a=this._json2html(i);break;default:a=""}l=!l,c=this.template.tableRow.clone(),l||c.addClass("odd"),d=this.template.tableCell.clone(),d.append(t),c.append(d),h=this.template.tableCell.clone(),h.append(a),c.append(h),u.append(c)}return u}}),define("bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoFormatter",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/getinfo/css/getinfo.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.mapmodule.MarkersPlugin",function(e,t){var i=this;i.conf=e,i.state=t,i.mapModule=null,i.pluginName=null,i.dotForm=null,i._markers=[],i._sandbox=null,i._map=null,i._svg=!1,i._defaultIconUrl="/Oskari/resources/framework/bundle/mapmodule-plugin/images/marker.png",i._defaultIconUrlSize=32,i._prevIconUrl="",i._preSVGIconUrl="data:image/svg+xml;base64,",i._font={name:"dot-markers",baseIndex:57344},i._defaultData={x:0,y:0,color:"ffde00",msg:"",shape:2,size:1},i._strokeStyle={"stroke-width":1,stroke:"#b4b4b4"},i._localization=null,i.buttonGroup="selectiontools",i.buttons=null,i.dialog=null,i._buttonsAdded=!1},{__name:"MarkersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this;return this.requestHandlers={addMarkerHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.AddMarkerRequestHandler",e,t),removeMarkersHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkersRequestHandler",e,t)},null},register:function(){this.getMapModule().setLayerPlugin("markers",this)},unregister:function(){this.getMapModule().setLayerPlugin("markers",null)},startPlugin:function(e){var t,i=this;this._sandbox=e,this._map=this.getMapModule().getMap(),this._createMapMarkerLayer(),e.register(this);for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this._sandbox.addRequestHandler("MapModulePlugin.AddMarkerRequest",i.requestHandlers.addMarkerHandler),this._sandbox.addRequestHandler("MapModulePlugin.RemoveMarkersRequest",i.requestHandlers.removeMarkersHandler);var n=this.getLocalization();this.dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),this.buttons={add:{iconCls:"marker-share",tooltip:n.buttons.add,sticky:!0,callback:function(){i.enableGfi(!1),i._map.events.register("click",i,i._showForm);var e=n.dialog,t=[],a=Oskari.clazz.create("Oskari.userinterface.component.Button"),r=Oskari.clazz.create("Oskari.userinterface.component.buttons.CancelButton");a.setTitle(n.buttons.clear),a.setHandler(function(){i.removeMarkers(),i.stopMarkerAdd(),i.enableGfi(!0)}),t.push(a),r.setHandler(function(){i.stopMarkerAdd(),i.enableGfi(!0)}),r.setPrimary(!0),t.push(r),i.dialog.show(e.title,e.message,t),i.mapModule.getMapEl().addClass("cursor-crosshair"),i.dialog.moveTo("#toolbar div.toolrow[tbgroup=default-selectiontools]","bottom")}}},this._svg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"),this._registerTools(),this.setState(this.state)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.removeRequestHandler("MapModulePlugin.RemoveMarkersRequest",this.requestHandlers.removeMarkersHandler),e.removeRequestHandler("MapModulePlugin.AddMarkerRequest",this.requestHandlers.addMarkerHandler),e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterHideMapMarkerEvent:function(e){this.afterHideMapMarkerEvent(e)},"Toolbar.ToolbarLoadedEvent":function(){this._registerTools()},SearchClearedEvent:function(){this.removeMarkers()},AfterRearrangeSelectedMapLayerEvent:function(){this.raiseMarkerLayer()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_createMapMarkerLayer:function(){var e=new OpenLayers.Layer.Vector("Markers");this._map.addLayer(e),this.raiseMarkerLayer(e)},addMapLayerToMap:function(){var e=this;return function(){e.raiseMarkerLayer()}},afterHideMapMarkerEvent:function(){var e=this._map.getLayersByName("Markers");null!==e&&void 0!==e&&null!==e[0]&&void 0!==e[0]&&e[0].setVisibility(!1)},removeMarkers:function(e){var t=this,i=t.getSandbox(),n=t._map.getLayersByName("Markers");if(null!==n&&void 0!==n&&null!==n[0]&&void 0!==n[0]&&n[0].removeAllFeatures(),t._markers.length=0,!e){var a=i.getEventBuilder("AfterRemoveMarkersEvent")();i.notifyAll(a)}},getMapMarkerBounds:function(){var e=this._map.getLayersByName("Markers");return e&&e[0]?e[0].getDataExtent():void 0},_showForm:function(e){var t=this;t.stopMarkerAdd();var i=t._map.getLonLatFromPixel(e.xy),n=t.getLocalization().form;t.dotForm=Oskari.clazz.create("Oskari.userinterface.component.visualization-form.DotForm",t,n,t._defaultData);var a=t.dotForm.getDialog();a&&a.close(!0),t.dotForm.showForm(jQuery("div.selection-line")[0],{messageEnabled:!0},"right"),t.dotForm.setSaveHandler(function(){var e=t.dotForm.getValues(),n=t._sandbox.getRequestBuilder("MapModulePlugin.AddMarkerRequest");if(n){var a={x:i.lon,y:i.lat,msg:e.message,color:e.color,shape:e.shape,size:e.size},r=n(a);t._sandbox.request(t.getName(),r)}t.dotForm.getDialog().close(!0),t.enableGfi(!0)}),t.dotForm.setCancelHandler(function(){t.dotForm.getDialog().close(),t.enableGfi(!0)})},stopMarkerAdd:function(){var e=this;e._map.events.unregister("click",e,e._showForm),e.dialog&&(e.mapModule.getMapEl().removeClass("cursor-crosshair"),e.dialog.close(!0)),jQuery("div.tool.marker-share.selected").removeClass("selected")},addMapMarkers:function(e){var t;for(t=0;t<e.length;t+=1)this.addMapMarker(e[t],null,null,!0)},addMapMarker:function(e,t,i,n){var a,r,s=this,o=jQuery.extend(!0,s._defaultData,e);if("undefined"==typeof e.x||"undefined"==typeof e.y)return void s._sandbox.printWarn("Undefined coordinate in",e," combined data is",o);var l=null;s._svg?"undefined"!=typeof o.iconUrl&&null!==o.iconUrl?(l=o.iconUrl,a=jQuery.isNumeric(e.size)?o.size:s._defaultIconUrlSize):(l=this.constructImage(o),a=this._getSizeInPixels(o.size)):(l=s._defaultIconUrl,a=this._getSizeInPixels(o.size));var u=this._map.getLayersByName("Markers"),c=new OpenLayers.Geometry.Point(o.x,o.y),d=new OpenLayers.Feature.Vector(c,null,{externalGraphic:l,graphicWidth:a,graphicHeight:a,fillOpacity:1,label:decodeURIComponent(o.msg),fontColor:"$000000",fontSize:"16px",fontFamily:"Arial",fontWeight:"bold",labelAlign:"lm",labelXOffset:8+2*o.size,labelYOffset:8,labelOutlineColor:"white",labelOutlineWidth:1});if(i)for(r in i)i.hasOwnProperty(r)&&d.events.register(r,d,i[r]);if(this._markers.push(o),u[0].addFeatures([d]),this.raiseMarkerLayer(u[0]),s._prevIconUrl=l,s.updateState(),!n){var h=s._sandbox.getEventBuilder("AfterAddMarkerEvent")(o,t,i);s._sandbox.notifyAll(h)}},constructImage:function(e){var t,i,n=this,a=n._defaultIconUrl;if("undefined"!=typeof Raphael){if("number"!=typeof e.size&&(e.size=parseInt(e.size,10)),t=e.size,isNaN(t))return;t=this._getSizeInPixels(t);var r=Raphael(0,0,t,t);r.clear();var s=r.getFont(n._font.name),o=n.getFont().baseIndex;if("number"==typeof e.shape)o+=e.shape;else{var l=parseInt(e.shape,10);o+=isNaN(l)?n._defaultData.shape:l}i="string"==typeof e.color?"#"+e.color:n._defaultData.color,r.print(0,55*t/100,String.fromCharCode(o),s,t).attr({fill:i,stroke_width:n._strokeStyle.stroke_width,stroke:n._strokeStyle.stroke}),a=n._preSVGIconUrl+jQuery.base64.encode(r.toSVG()),r.remove()}return a},_getSizeInPixels:function(e){return 40+10*e},raiseMarkerLayer:function(e){var t=null;t="undefined"!=typeof e?e:this._map.getLayersByName("Markers")[0];var i=Math.max(this._map.Z_INDEX_BASE.Feature,t.getZIndex())+1;t.setZIndex(i),t.setVisibility(!0)},_registerTools:function(){var e=this;if(!e._buttonsAdded){var t=this.getSandbox(),i=t.getRequestBuilder("Toolbar.AddToolButtonRequest");if("undefined"!=typeof i){var n,a;for(a in e.buttons)e.buttons.hasOwnProperty(a)&&i&&(n=i(a,e.buttonGroup,e.buttons[a]),t.request(e.getName(),n));e._buttonsAdded=!0}}},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},rgbToHex:function(e){if("#"===e.charAt(0))return e.substring(1);var t,i=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);for(delete i[0],t=1;3>=t;++t)i[t]=parseInt(i[t],10).toString(16),1===i[t].length&&(i[t]="0"+i[t]);return i.join("")},enableGfi:function(e){var t=this._sandbox,i=t.getEventBuilder("DrawFilterPlugin.SelectedDrawingEvent"),n=t.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest"),a=t.getRequestBuilder("WfsLayerPlugin.ActivateHighlightRequest");i&&t.notifyAll(i()),n&&t.request(this.pluginName,n(e)),a&&t.request(this.pluginName,a(e)),n=this._sandbox.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest"),n&&this._sandbox.request(this,n(e))},getLocalization:function(e){return this._localization||(this._localization=this.getMapModule().getLocalization("plugin",!0)[this.__name]),e?this._localization[e]:this._localization},getSandbox:function(){return this._sandbox},setState:function(e){this.state=e,this.removeMarkers(!0),this.state&&this.state.markers&&this.addMapMarkers(this.state.markers,null)},getStateParameters:function(){var e=this.getState();if(!e||!e.markers)return"";var t="|",i="___",n=[];return _.each(e.markers,function(e){var i=e.shape+t+e.size+t+e.color+t+e.x+"_"+e.y+t+encodeURIComponent(e.msg);n.push(i)}),n.length>0?"&markers="+n.join(i):""},getState:function(){return this.updateState(),jQuery.extend({},this.state)},updateState:function(){var e,t=this;for(("undefined"==typeof t.state||null===t.state)&&(t.state={}),t.state.markers=[],e=0;e<t._markers.length;e++)t.state.markers.push(t._markers[e])},getFont:function(){return this._font},getIcon:function(){return this._prevIconUrl},getOLMapLayers:function(){return null}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/markers/MarkersPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.AddMarkerRequest",function(e,t,i,n){this._creator=null,this._data=e,this._id=t,this._events=i,this._iconUrl=n},{__name:"MapModulePlugin.AddMarkerRequest",getName:function(){return this.__name},getData:function(){return this._data},getX:function(){return this._data.x},getY:function(){return this._data.y},getIconUrl:function(){return this._data.iconUrl},getID:function(){return this._id},getEvents:function(){return this._events}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/AddMarkerRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.AddMarkerRequestHandler",function(e,t){this.sandbox=e,this.markersPlugin=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.mapmodule.request.AddMarkerRequestHandler] Add Marker"),this.markersPlugin.addMapMarker(t.getData(),t.getID(),t.getEvents())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/AddMarkerRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkersRequest",function(){this._creator=null},{__name:"MapModulePlugin.RemoveMarkersRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkersRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkersRequestHandler",function(e,t){this.sandbox=e,this.markersPlugin=t},{handleRequest:function(){this.sandbox.printDebug("[Oskari.mapframework.bundle.mapmodule.request.RemoveMarkersRequestHandler] Remove markers"),this.markersPlugin.removeMarkers()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkersRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.AfterAddMarkerEvent",function(e,t,i){this._data=e,this._id=t,this._events=i},{__name:"AfterAddMarkerEvent",getName:function(){return this.__name},getData:function(){return this._data},getID:function(){return this._id},getEvents:function(){return this._events}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/AfterAddMarkerEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.AfterRemoveMarkersEvent",function(){},{__name:"AfterRemoveMarkersEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/AfterRemoveMarkersEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.conf=e,t.element=null,t.loc=null},{__name:"SearchPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(e){var t=this,i=t.getMapModule().getLocalization("plugin",!0),n=null;t.loc=i[t.__name],t.template=jQuery('<div class="mapplugin search default-search-div" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"><div class="search-textarea-and-button"><input placeholder="'+t.loc.placeholder+'" type="text" /><input type="button" value="'+t.loc.search+'" name="search" /></div><div class="results"><div class="header"><div class="close icon-close" title="'+t.loc.close+'"></div></div><div class="content">&nbsp;</div></div></div>'),t.styledTemplate=jQuery('<div class="mapplugin search published-search-div" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"><div class="search-area-div search-textarea-and-button"><div class="search-left"></div><div class="search-middle"><input class="search-input" placeholder="'+t.loc.placeholder+'" type="text" /><div class="close-results icon-close" title="'+t.loc.close+'"></div></div><div class="search-right"></div></div><div class="results published-search-results"><div class="content published-search-content"></div></div></div>'),t.templateResultsTable=jQuery('<table class="search-results"><thead><tr><th>'+t.loc.column_name+"</th><th>"+t.loc.column_village+"</th><th>"+t.loc.column_type+"</th></tr></thead><tbody></tbody></table>"),t.templateResultsRow=jQuery('<tr><td><a href="JavaScript:void(0);""></a></td><td></td><td></td></tr>'),n=t.conf&&t.conf.url?t.conf.url:e.getAjaxUrl()+"action_route=GetSearchResult",t.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",n)},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);
for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(){var e,t=this;t.element.remove(),t.element=null;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null},start:function(){},stop:function(){},eventHandlers:{LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){var t,i=this;i.isInLayerToolsEditMode!==e&&(i.isInLayerToolsEditMode=e,i.isInLayerToolsEditMode?(i._inputField.prop("disabled",!0),i._searchButton.prop("disabled",!0),t=jQuery('<div class="search-editmode-overlay">'),i.element.find(".search-textarea-and-button").css({position:"relative"}).append(t),t.mousedown(function(e){e.preventDefault()})):(i._inputField.prop("disabled",!1),i._searchButton.prop("disabled",!1),i.element.find(".search-editmode-overlay").remove()))},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,1)},_createUI:function(){var e,t=this;t.conf&&t.conf.toolStyle?(e=t.styledTemplate.clone(),t.element=e,t._inputField=e.find("input[type=text]"),t._searchButton=e.find("input[type=button]"),t.changeToolStyle(t.conf.toolStyle,e)):(e=t.template.clone(),t.element=e,t._inputField=e.find("input[type=text]"),t._searchButton=e.find("input[type=button]")),t._bindUIEvents()},_bindUIEvents:function(){var e,t=this,i=t._sandbox,n=this.element,a="top left",r=1;t._inputField.focus(function(){e=i.getRequestBuilder("DisableMapKeyboardMovementRequest"),e&&i.request(t.getName(),e())}),t._inputField.blur(function(){e=i.getRequestBuilder("EnableMapKeyboardMovementRequest"),e&&i.request(t.getName(),e())}),t._inputField.keypress(function(e){t.isInLayerToolsEditMode||t._checkForEnter(e)}),t._searchButton.click(function(){t.isInLayerToolsEditMode||t._doSearch()}),n.find("div.search-right").click(function(){t.isInLayerToolsEditMode||t._doSearch()}),n.find("div.close").click(function(){t.isInLayerToolsEditMode||(t._hideSearch(),t._inputField.val(""))}),n.find("div.close-results").click(function(){t.isInLayerToolsEditMode||(t._hideSearch(),t._inputField.val(""))}),n.find("div.results").hide(),t.conf&&t.conf.location&&(a=t.conf.location.classes||a,r=t.conf.location.position||r),t.getMapModule().setMapControlPlugin(n,a,r),t.conf&&t.conf.font&&t.changeFont(t.conf.font,n),t.conf&&t.conf.toolStyle&&t._inputField.keyup(function(e){(27===e.keyCode||8===e.keyCode&&!jQuery(this).val())&&t._hideSearch()}),t._setLayerToolsEditMode(t.getMapModule().isInLayerToolsEditMode())},_checkForEnter:function(e){var t;window.event?t=window.event.keyCode:e&&(t=e.which),13===e.keyCode&&this._doSearch()},_doSearch:function(){if(!this._searchInProgess){var e=this;e._hideSearch(),e._searchInProgess=!0;var t=e.element.find("input[type=text]");t.addClass("search-loading");var i=t.val(),n=function(t){e._showResults(t),e._enableSearch()},a=function(){e._enableSearch()};e.service.doSearch(i,n,a)}},_setMarker:function(e){var t,i=this,n=i._sandbox,a="number"!=typeof e.lat?parseFloat(e.lat):e.lat,r="number"!=typeof e.lon?parseFloat(e.lon):e.lon;t=n.getRequestBuilder("MapModulePlugin.RemoveMarkersRequest"),t&&n.request(i.getName(),t()),t=n.getRequestBuilder("MapModulePlugin.AddMarkerRequest"),t&&i._sandbox.request(i.getName(),t({color:"ffde00",msg:e.name,shape:2,size:3,x:r,y:a}))},_showResults:function(e){var t=e.error,i=this,n=i.element.find("div.results"),a=n.find("div.header"),r=n.find("div.content");if(t)return r.html(t),void n.show();var s,o,l,u=e.totalCount;if(i.results=e.locations,0===u)r.html(this.loc.noresults),n.show();else if(1===u)o=e.locations[0].lon,s=e.locations[0].lat,l=e.locations[0].zoomLevel,i._sandbox.request(i.getName(),i._sandbox.getRequestBuilder("MapMoveRequest")(o,s,l,!1)),i._setMarker(e.locations[0]);else{var c,d=i.templateResultsTable.clone(),h=d.find("tbody"),p=function(){return i._resultClicked(i.results[parseInt(jQuery(this).attr("data-location"),10)]),!1};for(c=0;u>c;c+=1){if(c>=100){h.append('<tr><td class="search-result-too-many" colspan="3">'+i.loc.toomanyresults+"</td></tr>");break}o=e.locations[c].lon,s=e.locations[c].lat,l=e.locations[c].zoomLevel;var f=i.templateResultsRow.clone(),m=e.locations[c].name,g=e.locations[c].village,v=e.locations[c].type,y=f.find("td"),b=jQuery(y[0]).find("a");f.attr("data-location",c),b.attr("data-location",c),b.attr("title",m),b.append(m),b.click(p),jQuery(y[1]).attr("title",g).append(g),jQuery(y[2]).attr("title",v).append(v),jQuery.browser.msie&&f.append(jQuery('<td style="width: 0px;"></td>')),h.append(f)}i.conf&&i.conf.toolStyle||h.find(":odd").addClass("odd"),r.html(d),n.show(),i.conf&&i.conf.font&&i.changeFont(i.conf.font,r),i.conf&&i.conf.toolStyle&&(a.remove(),i.changeResultListStyle(i.conf.toolStyle,n))}},_resultClicked:function(e){this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(e.lon,e.lat,e.zoomLevel,!1)),this._setMarker(e)},_enableSearch:function(){this._searchInProgess=!1,jQuery("#search-string").removeClass("search-loading")},_hideSearch:function(){this.element.find("div.results").hide(),this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("HideMapMarkerRequest")())},changeToolStyle:function(e,t){var i=this;if(t=t||i.element,e&&t){if(null===e.val)return i.conf.toolStyle=null,t.removeClass("published-search-div").addClass("default-search-div"),t.empty(),i.template.children().clone().appendTo(t),i._inputField=t.find("input[type=text]"),i._searchButton=t.find("input[type=button]"),i._bindUIEvents(),void(i.isInLayerToolsEditMode&&(i.isInLayerToolsEditMode=!1,i._setLayerToolsEditMode(!0)));t.hasClass("default-search-div")&&(t.removeClass("default-search-div").addClass("published-search-div"),t.empty(),i.styledTemplate.children().clone().appendTo(t),i._inputField=t.find("input[type=text]"),i._searchButton=t.find("input[type=button]"),i._bindUIEvents(),i.isInLayerToolsEditMode&&(i.isInLayerToolsEditMode=!1,i._setLayerToolsEditMode(!0)));var n=this.getMapModule().getImageUrl(),a=n+"/framework/bundle/mapmodule-plugin/plugin/search/images/",r=e.val,s=a+"search-tool-"+r+"_01.png",o=a+"search-tool-"+r+"_02.png",l=a+"search-tool-"+r+"_03.png",u=t.find("div.search-left"),c=t.find("div.search-middle"),d=t.find("div.search-right"),h=c.find("div.close-results"),p=t.find("input.search-input"),f=318-(e.widthLeft+e.widthRight),m=f-35;u.css({"background-image":'url("'+s+'")',width:e.widthLeft+"px"}),c.css({"background-image":'url("'+o+'")',"background-repeat":"repeat-x",width:f+"px"}),d.css({"background-image":'url("'+l+'")',width:e.widthRight+"px"}),p.css({width:m+"px"}),h.removeClass("icon-close icon-close-white"),/dark/.test(r)?(h.addClass("icon-close-white"),h.css({"margin-top":"8px"}),p.css({color:"#ddd"})):(h.addClass("icon-close"),h.css({"margin-top":"10px"}),p.css({color:""})),i._setLayerToolsEditMode(i.getMapModule().isInLayerToolsEditMode())}},changeFont:function(e,t){if(t=t||this.element,t&&e){var i=[];i.push(t.find("table.search-results")),i.push(t.find("input"));var n="oskari-publisher-font-"+e,a=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(n,a,i)}},changeResultListStyle:function(e,t){var i="oskari-publisher-search-results-"+e.val,n=/oskari-publisher-search-results-/;this.getMapModule().changeCssClasses(i,n,[t])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/search/SearchPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(e){this._searchUrl=e},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(e,t,i){var n=Oskari.getLang(),a=Oskari.getSandbox().getMap().getSrsName();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,data:{searchKey:e,Language:n,epsg:a},error:i,success:t})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/search/service/searchservice",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",function(e){this.conf=e,this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=null},{templates:{main:jQuery('<div class="mapplugin logoplugin" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"><div class="icon"></div><div class="terms"><a href="JavaScript:void(0);"></a></div><div class="data-sources"></div></div>'),dataSourcesDialog:jQuery('<div class="data-sources-dialog"><div class="layers"><h4></h4></div><div class="indicators"><h4></h4></div></div>')},__name:"LogoPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(){},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(e){var t,i=this,n=e||i._sandbox;for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&n.unregisterFromEventByName(i,t);n.unregister(i),i._map=null,i._sandbox=null,i.element&&(i.element.find("a").unbind("click"),i.element.remove(),i.element=void 0)},start:function(){},stop:function(){},eventHandlers:{"StatsGrid.IndicatorsEvent":function(e){this._addIndicatorsToDataSourcesDialog(e.getIndicators())},LayerToolsEditModeEvent:function(e){this.isInLayerToolsEditMode=!!e.isInMode(),this.isInLayerToolsEditMode||this.setLocation(this.element.parents(".mapplugins").attr("data-location"))},MapSizeChangedEvent:function(){if(this.dataSourcesDialog){var e=jQuery("div.logoplugin div.data-sources");e&&this.dataSourcesDialog.moveTo(e,"top")}}},onEvent:function(e){var t=this.eventHandlers[e.getName()];return t?t.apply(this,[e]):void 0},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,1)},_createUI:function(){var e,t,i=this,n=i._sandbox,a=i.getMapModule().getLocalization("plugin",!0),r=a[i.__name],s="bottom left",o=1;i.conf&&(e=n.getLocalizedProperty(i.conf.mapUrlPrefix),t=n.getLocalizedProperty(i.conf.termsUrl)),i.element||(i.element=i.templates.main.clone()),i.conf&&(i.conf.location&&(s=i.conf.location.classes||s,o=i.conf.location.position||o),i.conf.font&&this.changeFont(i.conf.font)),i.getMapModule().setMapControlPlugin(i.element,s,o),i._createServiceLink(e),i._createTermsLink(r,t),i._createDataSourcesLink(r),this.isInLayerToolsEditMode=i.getMapModule().isInLayerToolsEditMode()},_createServiceLink:function(e){var t,i=this,n=i.element.find("div.icon");e&&n.bind("click",function(){return i.isInLayerToolsEditMode?void 0:(t=i._sandbox.generateMapLinkParameters(),window.open(e+t,"_blank"),!1)})},_createTermsLink:function(e,t){var i=this,n=i.element.find("a");t?(n.append(e.terms),n.bind("click",function(){return i.isInLayerToolsEditMode?void 0:(window.open(t,"_blank"),!1)})):n.hide()},_createDataSourcesLink:function(e){var t=this,i=t.element.find("div.data-sources");t.conf&&t.conf.hideDataSourceLink?i.remove():(i.html(e.dataSources),i.click(function(e){t.isInLayerToolsEditMode||t.dataSourcesDialog?t.dataSourcesDialog&&(t.dataSourcesDialog.close(!0),t.dataSourcesDialog=null):(t._openDataSourcesDialog(e.target),t._requestDataSources())}))},changeFont:function(e,t){var i,n;t=t||this.element,t&&e&&(i="oskari-publisher-font-"+e,n=/oskari-publisher-font-/,this.getMapModule().changeCssClasses(i,n,[t]))},_requestDataSources:function(){var e,t=this,i=t._sandbox.getRequestBuilder("StatsGrid.IndicatorsRequest");i&&(e=i(),t._sandbox.request(t,e))},_openDataSourcesDialog:function(e){var t,i,n=this,a=n.getMapModule().getLocalization("plugin",!0)[n.__name],r=a.dataSources,s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=Oskari.clazz.create("Oskari.userinterface.component.Button"),l=n.templates.dataSourcesDialog.clone(),u=l.find("div.layers"),c=a.layersHeader,d=n._sandbox.findAllSelectedMapLayers(),h=d.length;if(o.setTitle("OK"),o.setHandler(function(){n.dataSourcesDialog=null,s.close(!0)}),0===h)u.remove();else for(u.find("h4").html(c),i=0;h>i;i+=1)t=d[i],u.append("<div>"+t.getName()+" - "+t.getOrganizationName()+"</div>");n.dataSourcesDialog=s,s.show(r,l,[o]),e=e||n.element.find("div.data-sources"),s.moveTo(e,"top")},_addIndicatorsToDataSourcesDialog:function(e){if(this.dataSourcesDialog){var t,i,n,a=this.dataSourcesDialog,r=this.getMapModule().getLocalization("plugin",!0)[this.__name],s=a.getJqueryContent(),o=s.find("div.indicators"),l=r.indicatorsHeader;if(e=e||{},jQuery.isEmptyObject(e))o.remove();else{o.find("h4").html(l);for(i in e)e.hasOwnProperty(i)&&(t=e[i],o.append("<div>"+t.title+" - "+t.organization+"</div>"))}n=n||this.element.find("div.data-sources"),a.moveTo(n,"top")}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/logo/LogoPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.DataSourcePlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.template=null,this.element=null,this.sandbox=null,this.tool=null},{__name:"DataSourcePlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(){this.template=jQuery("<div class='oskari-datasource'><div class='link'><a href='JavaScript:void(0);'></a></div></div>"),this.templateinfoIcon=jQuery('<div class="icon-info"></div>'),this.templategroupTemplate=jQuery('<ul style="padding: 0 12px;"></ul>'),this.templatecontent=jQuery("<div></div>"),this.templateheading=jQuery("<b></b>")},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this._createUI()},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null,this.element.find("a").unbind("click"),this.element.remove(),this.element=void 0},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_layerListComparator:function(e,t){var i=e.getOrganizationName().toLowerCase(),n=t.getOrganizationName().toLowerCase(),a=0;return i===n&&(i=e.getName().toLowerCase(),n=t.getName().toLowerCase()),n>i&&(a=-1),i>n&&(a=1),a},_createUI:function(){var e=this,t=(e._sandbox,jQuery(this._map.div));this.element||(this.element=this.template.clone()),t.append(this.element);var i=this.getMapModule().getLocalization("plugin",!0);this.localization=i[this.__name];var n=this.element.find("a");n.append(this.localization.link),n.bind("click",function(){return e._openDialog(),!1})},_openDialog:function(){var e,t,i,n,a=this,r=(a._sandbox,Oskari.clazz.create("Oskari.userinterface.component.Popup")),s=r.createCloseButton(this.localization.button.close),o=(this.templateinfoIcon.clone(),this.templategroupTemplate.clone()),l=this._getLayers(),u=null,c=this.templatecontent.clone(),d=null;for(e=0;e<l.length;++e)t=l[e],u!==t.getOrganizationName()&&(u=t.getOrganizationName(),i=this.templateheading.clone(),i.append(u?u:"N/A"),c.append(i),d=o.clone(),c.append(d)),n=this._getLayerContainer(t),n&&d.append(n);r.show(this.localization.popup.title,c,[s]),r.moveTo(this.element.find("a"),"top")},_getLayers:function(){var e=this,t=e._sandbox.findAllSelectedMapLayers();return t.sort(function(t,i){return e._layerListComparator(t,i)}),t},_getLayerContainer:function(e){var t=this,i=this.templateinfoIcon.clone(),n=e.getName();if(n){var a=jQuery("<li>"+n+"</li>"),r=e.getMetadataIdentifier();if(r){var s=i.clone();s.bind("click",function(){t._getMetadataInfoCallback(e)}),a.append(s)}return a}return null},_getMetadataInfoCallback:function(e){var t=this,i=t._sandbox,n=e.getMetadataIdentifier(),a=[],r={};r[n]=!0;var s,o,l=e.getSubLayers();if(l&&l.length>0)for(s=0;s<l.length;s++)o=l[s].getMetadataIdentifier(),o&&""!==o&&!r[o]&&(r[o]=!0,a.push({uuid:o}));i.postRequestByName("catalogue.ShowMetadataRequest",[{uuid:n},a])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/datasource/DataSourcePlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/datasource/css/datasource.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",function(e){var t=this;t.mapModule=this.mapmodule,t.pluginName=null,t._sandbox=null,t._map=null,t.conf=e||{},t.element=null,t._indexMap=null,t._indexMapUrl="/framework/bundle/mapmodule-plugin/plugin/indexmap/images/suomi25m_tm35fin.png",t.isInLayerToolsEditMode=!1},{templates:{main:jQuery('<div class="mapplugin indexmap" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin"></div>'),toggle:jQuery('<div class="indexmapToggle"></div>')},__name:"IndexMapPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(){},setLocation:function(e){var t=this;t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,5)},_createUI:function(){var e=this,t=new OpenLayers.Layer.Image("Overview map image",e.getMapModule().getImageUrl()+e._indexMapUrl,new OpenLayers.Bounds(26783,6608595,852783,7787250),new OpenLayers.Size(120,173)),i="bottom right",n=5;e.element=e.conf.containerId?jQuery("#"+e.conf.containerId):e.templates.main.clone();var a={div:e.element[0],mapOptions:{maxExtent:new OpenLayers.Bounds(26783,6608595,852783,7787250),units:"m",projection:e._map.getProjection(),numZoomLevels:1},layers:[t],size:new OpenLayers.Size(120,173),autoPan:!1,controls:[]};e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.conf.containerId||e.getMapModule().setMapControlPlugin(e.element,i,n),e._indexMap=new OpenLayers.Control.OverviewMap(a),e._indexMap.isSuitableOverview=function(){return!0},this.isInLayerToolsEditMode=e.getMapModule().isInLayerToolsEditMode(),OpenLayers.Util.extend(e._indexMap,{updateMapToRect:function(){var t=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(t=t.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(t.getCenterLonLat()),e.getMapModule().notifyMoveEnd(e.getClazz())}})},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._createUI(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i.getMapModule().addMapControl("overviewMap",i._indexMap);var n=i.templates.toggle.clone();i._bindIcon(n),i.element.append(n)},_bindIcon:function(e){var t=this;e.bind("click",function(e){e.preventDefault();var i=t.element.find(".olControlOverviewMapElement");i.toggle()})},stopPlugin:function(){var e,t=this;t.getMapModule().removeMapControl("overviewMap");for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(e){this._indexMap&&e.getCreator()!==this.getClazz()&&this._indexMap.update()},LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){if(this.isInLayerToolsEditMode!==e){this.isInLayerToolsEditMode=e;var t=this.element.find(".indexmapToggle");if(e){var i=this.element.find(".olControlOverviewMapElement");i.hide(),t.unbind("click")}else this._bindIcon(t)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/indexmap/IndexMapPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",function(e){var t=this;t.conf=e,t.element=null,t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t._scalebar=null},{templates:{main:jQuery('<div class="mapplugin scalebar" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"></div>')},__name:"ScaleBarPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(){},register:function(){},unregister:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,3)},startPlugin:function(e){var t,i=this,n="bottom left",a=3;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i.element=i.templates.main.clone(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i.conf&&i.conf.location&&(n=i.conf.location.classes||n,a=i.conf.location.position||a),i.getMapModule().setMapControlPlugin(i.element,n,a),i._scalebar=new OpenLayers.Control.ScaleLine({div:i.element[0]}),i.getMapModule().addMapControl("scaleBar",i._scalebar)},stopPlugin:function(){var e,t=this;t.getMapModule().removeMapControl("scaleBar");for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._scalebar&&this._scalebar.update()},LayerToolsEditModeEvent:function(e){this.isInLayerToolsEditMode=e.isInMode()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/scalebar/ScaleBarPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/scalebar/css/scalebar.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin",function(e){var t=this;t.conf=e||{},t.element=null,t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t._scalebar=null,t.toolbarId=t.conf.toolbarId,t.toolbarContent="publishedToolbarContent",t.toolbarPopupContent="publishedToolbarPopupContent",t.toolbarContainer="publishedToolbarContainer",t.isInLayerToolsEditMode=!1},{templates:{main:jQuery("<div class=\"mapplugin tools\" data-clazz=\"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin\"><div class='icon menu-rounded-dark'></div><div class='publishedToolbarContainer'><div class='tools-top-arrow'></div></div></div>"),container:jQuery("<div></div>"),publishedToolbarPopupContent:jQuery('<div class="publishedToolPopupContent"><h3></h3><div class="content"></div><div class="actions"></div></div>')},__name:"PublisherToolbarPlugin",getName:function(){return this.pluginName},getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin"},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(){var e=this,t=e.getMapModule().getLocalization("plugin",!0),i=e._sandbox.getRequestBuilder("ToolSelectionRequest"),n="MapModulePlugin.GetFeatureInfoActivationRequest",a=e._sandbox.getRequestBuilder(n);e.localization=t[e.__name],e.template=jQuery(e.templates.main),e.buttonGroups=[{name:"history",buttons:{history_back:{toolbarid:e.toolbarId,iconCls:"tool-history-back-dark",tooltip:e.localization.history.back,prepend:!0,enabled:!1,sticky:!1,callback:function(){e._sandbox.request(e,i("map_control_tool_prev"))}},history_forward:{toolbarid:e.toolbarId,iconCls:"tool-history-forward-dark",tooltip:e.localization.history.next,enabled:!1,sticky:!1,callback:function(){e._sandbox.request(e,i("map_control_tool_next"))}}}},{name:"basictools",buttons:{measureline:{toolbarid:e.toolbarId,iconCls:"tool-measure-line-dark",tooltip:e.localization.measure.line,enabled:!1,sticky:!0,callback:function(){var t="map_control_measure_tool";e._sandbox.request(e,a(!1)),e._sandbox.request(e,i(t))}},measurearea:{toolbarid:e.toolbarId,iconCls:"tool-measure-area-dark",tooltip:e.localization.measure.area,enabled:!1,sticky:!0,callback:function(){var t="map_control_measure_area_tool";e._sandbox.request(e,a(!1)),e._sandbox.request(e,i(t))}}}}],this.requestHandlers={toolContainerRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequestHandler",e)}},register:function(){},unregister:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,0)},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._sandbox.addRequestHandler("Toolbar.ToolContainerRequest",this.requestHandlers.toolContainerRequestHandler),i._createUI()},stopPlugin:function(){var e,t=this;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t.destroy(),t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){this.isInLayerToolsEditMode!==e&&(this.isInLayerToolsEditMode=e,e?(this.element.find("."+this.toolbarContainer).hide(),this.element.find("div.icon").unbind("click")):this._bindIcon())},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},show:function(e){var t=e?"show":"hide";this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,t])},destroy:function(){this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,"remove"])},changeName:function(e){this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,"changeName",e])},_createUI:function(){var e,t,i,n,a,r=this,s=(r._sandbox,[r.toolbarContent,r.toolbarPopupContent]);if(!r.element)for(r.element=r.template.clone(),t=r.element.find("."+r.toolbarContainer),n=0,a=s.length;a>n;n++)r.templates.container.clone().attr("class",s[n]).appendTo(t);this.conf&&this.conf.toolStyle&&this.changeToolStyle(this.conf.toolStyle,r.element),r.insertToMap(),e=r.element.find("."+r.toolbarContainer),e.hide(),r._bindIcon(),r.conf&&r.conf.font&&r.changeFont(r.conf.font,i)},_bindIcon:function(){var e=this,t=e.element.find("div.icon"),i=e.element.find("."+e.toolbarContainer);t.bind("click",function(){i.toggle()})},insertToMap:function(){var e=this,t="top left",i=0;e.conf&&e.conf.location&&(t=e.conf.location.classes||t,i=e.conf.location.position||i),e.getMapModule().setMapControlPlugin(e.element,t,i)},setToolbarContainer:function(){var e=this,t=e._sandbox,i=t.getRequestBuilder("Toolbar.ToolbarRequest");e.toolbarId&&e.toolbarContent&&null!==i&&void 0!==i&&t.requestByName(e,"Toolbar.ToolbarRequest",[e.toolbarId,"add",{title:e.localization.title,show:!1,toolbarContainer:e.element.find("."+e.toolbarContent),closeBoxCallback:function(){}}])},getToolOptions:function(){var e=this;return e.buttonGroups},changeToolStyle:function(e,t){var i=this;if(t=t||i.element){var n=(i.getMapModule().getImageUrl(),t.find(".icon")),a=t.find("."+i.toolbarContent),r=t.find("."+i.toolbarPopupContent),s=e?e.split("-")[1]:"dark";null===e?(n.removeAttr("style"),a.removeClass("light","dark"),r.removeClass("light","dark")):(n.removeClass(),n.addClass("icon menu-"+e),"dark"===s?(a.removeClass("light").addClass("dark"),r.removeClass("light").addClass("dark")):(a.removeClass("dark").addClass("light"),r.removeClass("dark").addClass("light")));var o,l,u,c=i.element.find("."+i.toolbarContent);for(o in i.buttonGroups)if(i.buttonGroups.hasOwnProperty(o)){var d=i.buttonGroups[o],h=c.find("div.toolrow[tbgroup="+i.toolbarId+"-"+d.name+"]");for(l in d.buttons)if(d.buttons.hasOwnProperty(l)){var p=d.buttons[l],f=p.iconCls.split("-"),m=f[0],g=f.length-1;for("dark"!==f[g]&&"light"!==f[g]&&(f.push("dark"),g++),u=1;u<f.length;u++)m+=g>u?"-"+f[u]:"-"+s;{h.find("."+p.iconCls).removeClass(p.iconCls).addClass(m)}p.iconCls=m}}}},changeFont:function(e,t){if(t=t||this.element,t&&e){var i=[];i.push(t.find(".publishedToolbarPopupContent"));var n="oskari-publisher-font-"+e,a=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(n,a,i)}},setToolContent:function(e){var t,i,n=this,a=e.className||"",r=e.title||"",s=e.content||"",o=e.buttons||[],l=n.element.find("."+n.toolbarContent),u=n.element.find("."+a),c=!1;if(0===u.length&&(u=n.templates.publishedToolbarPopupContent.clone(),c=!0),u.find("h3").html(r),u.find(".content").html(s),a&&(u.removeClass(),u.addClass("publishedToolPopupContent "+a)),c&&o&&o.length>0)for(t=u.find(".actions"),t.empty(),i=0;i<o.length;i+=1)o[i].insertTo(t);else c&&u.bind("click",function(){n.resetToolContent()});return c&&(n.element.find("."+n.toolbarPopupContent).append(u),l.hide()),u},resetToolContent:function(e){var t=this,i=e.className||"publishedToolPopupContent",n=t.element.find("."+t.toolbarContent),a=t.element.find("."+i);
a.remove(),n.show()},getToolConfs:function(){var e,t,i,n,a=this,r={};for(e in a.buttonGroups)if(a.buttonGroups.hasOwnProperty(e)){t=a.buttonGroups[e],r[t.name]={};for(i in t.buttons)t.buttons.hasOwnProperty(i)&&(n=t.buttons[i],r[t.name][i]={iconCls:n.iconCls})}return r}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.FullScreenPlugin",function(){var e=this;e.mapModule=null,e.pluginName=null,e._sandbox=null,e._map=null,e._fullscreen=null,e.templates={}},{__name:"FullScreenPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},init:function(){var e=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/";this.templates.main=jQuery('<div class="fullscreenDiv"><img class="fullscreenDivImg" src="'+e+'hide-navigation.png"></img></div>')},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),this._map=this.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i.createUI()},stopPlugin:function(e){var t;jQuery("div.fullscreenDiv").remove();for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location=e,t.element&&(t.stopPlugin(),t.startPlugin())},createUI:function(){var e=this,t=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/",i="top left",n=1;e.element||(e.element=e.templates.main.clone()),e.element.find(".fullscreenDivImg").bind("click",function(i){i.preventDefault(),e._sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest"),jQuery(this).attr("src").match(/hide-navigation/)?jQuery(this).attr("src",t+"show-navigation.png"):jQuery(this).attr("src",t+"hide-navigation.png")}),e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.getMapModule().setMapControlPlugin(e.element,i,n)},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/fullscreen/FullScreen",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/fullscreen/css/fullscreen.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.element=void 0,t.conf=e,t.initialSetup=!0,t.isInLayerToolsEditMode=!1,t.templates={}},{__name:"LayerSelectionPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){var e=this;e.templates.main=jQuery("<div class='mapplugin layerselection' data-clazz='Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin'>"+'<div class="header"><div class="header-icon icon-arrow-white-right"></div></div><div class="content"><div class="layers"></div><div class="baselayers"></div></div></div>'),e.templates.layer=jQuery("<div class='layer'><label><span></span></label></div>"),e.templates.checkbox=jQuery("<input type='checkbox' />"),e.templates.radiobutton=jQuery("<input type='radio' name='defaultBaselayer'/>"),e.templates.baseLayerHeader=jQuery('<div class="baseLayerHeader"></div>'),e.templates.headerArrow=jQuery('<div class="styled-header-arrow"></div>'),e.templates.contentHeader=jQuery('<div class="content-header"><div class="content-header-title"></div><div class="content-close icon-close-white"></div></div>')},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(e){var t,i=this,n=e||this._sandbox;for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&n&&n.unregisterFromEventByName(i,t);n.unregister(i),i.element&&(i.element.remove(),i.element=void 0,delete i.element)},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.removeLayer(e.getMapLayer())},AfterMapLayerAddEvent:function(e){this.addLayer(e.getMapLayer()),this._checkBaseLayers(e.getMapLayer())},MapLayerVisibilityChangedEvent:function(e){this.updateLayer(e.getMapLayer())},AfterMapMoveEvent:function(){this._checkBaseLayers()},AfterRearrangeSelectedMapLayerEvent:function(e){e._creator!==this.getName()&&this.sortLayers()},LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){if(this.isInLayerToolsEditMode!==e){var t=this.element.find("div.header");this.isInLayerToolsEditMode=e,e?(this.closeSelection(),t.unbind("click")):this._bindHeader(t)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},selectBaseLayer:function(e){var t,i=this.element.find("div.content div.baselayers");i&&0!==i.length&&(t=i.find("input[value="+e+"]"),t.attr("checked","checked"),this._changedBaseLayer())},addLayer:function(e){if(!this.layerRefs[e.getId()]){var t=this.element.find("div.content"),i=t.find("div.layers"),n=this.templates.layer.clone(),a=this.templates.checkbox.clone();n.find("span").append(e.getName()),a.attr("value",e.getId()),e.isVisible()?a.attr("checked",!0):a.attr("checked",!1),this._bindCheckbox(a,e),n.find("span").before(a),this.layerRefs[e.getId()]=n,i.append(n)}},updateLayer:function(e){var t,i=this.layerRefs[e.getId()],n=e.isVisible();t=i.find("input"),n?t.is(":checked")||t.attr("checked","checked"):t.is(":checked")&&t.removeAttr("checked")},_bindCheckbox:function(e,t){var i=this;e.change(function(){var e=jQuery(this),n=e.is(":checked");n?i._setLayerVisible(t,!0):i._setLayerVisible(t,!1)})},_setLayerVisible:function(e,t){var i=this._sandbox,n=i.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),a=n(e.getId(),t);i.request(this,a)},removeLayer:function(e){var t=this.layerRefs[e.getId()];t&&t.remove(),delete this.layerRefs[e.getId()]},addBaseLayer:function(e){var t=this;if(e&&e.getId&&t.element){var i=t.layerRefs[e.getId()];if(!i.parent().hasClass("baselayers")){i.remove();var n=i.find("input");n.remove(),n=t.templates.radiobutton.clone(),n.attr("value",e.getId()),n.bind("change",function(){t._changedBaseLayer()}),i.find("span").before(n);var a=t.element.find("div.content div.baselayers");if(0===a.find("div.layer").length){var r=t.getMapModule().getLocalization("plugin"),s=r[t.__name],o=t.templates.baseLayerHeader.clone();o.append(s.chooseDefaultBaseLayer),a.parent().find(".baseLayerHeader").remove(),a.before(o),n.attr("checked","checked")}a.append(i),t.layerRefs[e.getId()]=i,t._changedBaseLayer(),t.sortLayers()}}},removeBaseLayer:function(e){var t=this.layerRefs[e.getId()];t.remove();var i=t.find("input"),n=i.is(":checked");i.remove(),i=this.templates.checkbox.clone(),i.attr("value",e.getId()),n&&i.attr("checked","checked"),this._bindCheckbox(i,e),t.find("span").before(i);var a=this.element.find("div.content div.layers");a.append(t),this._setLayerVisible(e,!0);var r=this.element.find("div.content div.baselayers"),s=r.find("div.layer");if(0===s.length){var o=this.element.find("div.content div.baseLayerHeader");o.remove()}else{this.sortLayers();var l=s.find("input:checked");0===l.length&&(jQuery(s.find("input").get(0)).attr("checked","checked"),this._changedBaseLayer())}},_changedBaseLayer:function(){var e,t,i,n=this,a=n._sandbox,r=n.getBaseLayers();for(e=0;e<r.baseLayers.length;e+=1)t=r.baseLayers[e],i=a.findMapLayerFromSelectedMapLayers(t),null!==i&&void 0!==i&&n._setLayerVisible(i,r.defaultBaseLayer+""==t+"");var s="RearrangeSelectedMapLayerRequest",o=a.getRequestBuilder(s),l=o(r.defaultBaseLayer,0);a.request(n,l)},sortLayers:function(){var e,t,i,n=this._sandbox.findAllSelectedMapLayers(),a=[],r=this.element.find("div.content div.layers"),s=r.find("div.layer").detach(),o=this.element.find("div.content div.baselayers"),l=o.find("div.layer").detach(),u=function(e,n){var a=jQuery(n),s=a.find("input");return s.val()===t?(r.append(a),i=!0,!1):void 0},c=function(e,n){var a=jQuery(n),r=a.find("input");return r.val()===t?(o.append(a),i=!0,!1):void 0},d=function(e,t){var i=0;return e.getName()<t.getName()?i=-1:e.getName()>t.getName()&&(i=1),i};for(e=n.length-1;e>-1;e-=1)t=n[e].getId()+"",i=!1,s.each(u),i||a.push(n[e]);for(a.sort(d),e=0;e<a.length;e++)t=a[e].getId()+"",l.each(c)},setupLayers:function(e){var t=this;delete this.layerRefs,this.layerRefs={};var i,n=this._sandbox.findAllSelectedMapLayers();for(i=n.length-1;i>-1;i-=1)t.addLayer(n[i]),e&&jQuery.inArray(n[i].getId()+"",e)>-1&&t.addBaseLayer(n[i])},openSelection:function(){var e,t=this.element.find("div.header div.header-icon");t.removeClass("icon-arrow-white-right"),t.addClass("icon-arrow-white-down"),e=this.element.find("div.content").show()},closeSelection:function(){var e,t=this.element.find("div.header div.header-icon");t.removeClass("icon-arrow-white-down"),t.addClass("icon-arrow-white-right"),e=this.element.find("div.content").hide()},getBaseLayers:function(){var e,t,i=this.element.find("div.content div.baselayers div.layer input"),n=[],a=null;for(e=0;e<i.length;e+=1)t=jQuery(i[e]),n.push(t.val()),t.is(":checked")&&(a=t.val());return{baseLayers:n,defaultBaseLayer:a}},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,3)},_bindHeader:function(e){var t=this;e.bind("click",function(){var e=t.element.find("div.content");e.is(":hidden")?t.openSelection():t.closeSelection()})},_createUI:function(){var e=this,t="top left",i=3;e.element||(e.element=e.templates.main.clone());var n=e.getMapModule().getLocalization("plugin",!0),a=n[e.__name],r=e.element.find("div.header");r.append(a.title),e._bindHeader(r),e.closeSelection(),e.setupLayers(),e.conf&&e.conf.location&&(t=e.conf.location.classes||t,i=e.conf.location.position||i),e.getMapModule().setMapControlPlugin(e.element,t,i),e.conf&&e.conf.toolStyle&&e.changeToolStyle(e.conf.toolStyle,e.element),e.conf&&e.conf.font&&e.changeFont(e.conf.font,e.element),e.conf&&e.conf.colourScheme&&e.changeColourScheme(e.conf.colourScheme,e.element)},changeToolStyle:function(e,t){if(t=t||this.element){if(null===e)return void(this.element&&(delete this.conf.toolStyle,this.stopPlugin(),this.startPlugin()));var i=this,n=this.getMapModule().getLocalization("plugin",!0),a=t.find("div.header"),r=this.templates.headerArrow.clone(),s=t.find("div.content"),o=this.templates.contentHeader.clone(),l=this.getMapModule().getImageUrl(),u=l+"/framework/bundle/mapmodule-plugin/plugin/layers/images/",c=u+"map-layer-button-"+e+".png";a.empty(),null!==e?(t.addClass("published-styled-layerselector"),s.addClass("published-styled-layerselector-content"),s.addClass("layerselection-styled-content"),a.addClass("published-styled-layerselector-header"),this.getMapModule().changeCssClasses("oskari-publisher-layers-"+e,/oskari-publisher-layers-/,[s]),this.getMapModule().changeCssClasses("oskari-publisher-layers-header-"+e,/oskari-publisher-layers-header-/,[o]),a.css({"background-image":'url("'+c+'")'})):(t.removeClass("published-styled-layerselector"),s.removeClass("published-styled-layerselector-content"),s.removeClass("layerselection-styled-content"),a.removeClass("published-styled-layerselector-header"),this.getMapModule().changeCssClasses("",/oskari-publisher-layers-/,[s]),this.getMapModule().changeCssClasses("",/oskari-publisher-layers-header-/,[o]),a.css({"background-image":""})),s.find("div.content-header").remove(),s.find("div.styled-header-arrow").remove(),o.find("div.content-header-title").append(n[this.__name].title),s.prepend(o),s.prepend(r),o.find("div.content-close").on("click",function(){i.closeSelection()}),this.conf&&this.conf.colourScheme&&this.changeColourScheme(this.conf.colourScheme,this.element)}},changeColourScheme:function(e,t){if(t=t||this.element,t&&e){t.find("div.content-header").css({"background-color":e.bgColour}),t.find("div.styled-header-arrow").css({"border-bottom-color":e.bgColour});var i=t.find("div.content-header div.content-close");i.removeClass("icon-close").removeClass("icon-close-white"),i.addClass(e.iconCls),t.find("div.content-header div.content-header-title").css({color:e.titleColour})}},changeFont:function(e,t){if(t=t||this.element,t&&e){var i="oskari-publisher-font-"+e,n=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(i,n,[t])}},_checkBaseLayers:function(e){var t;if(this.conf&&this.conf.baseLayers)if(!this.initialSetup||null!==e&&void 0!==e){if(null!==e&&void 0!==e){for(t=0;t<this.conf.baseLayers.length;t++)this.conf.baseLayers[t]==e.getId()&&this.addBaseLayer(e);this.conf.defaultBaseLayer==e.getId()&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}else{for(this.initialSetup=!1,t=0;t<this.conf.baseLayers.length;t+=1)e=this._sandbox.findMapLayerFromSelectedMapLayers(this.conf.baseLayers[t]),this.addBaseLayer(e);this.conf.defaultBaseLayer&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayerSelectionPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.BackgroundLayerSelectionPlugin",function(e){var t;if(this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=void 0,this.conf=e,this.error=!(this.conf&&this.conf.baseLayers&&this.conf.baseLayers.length),!this.error)for(t=0;t<this.conf.baseLayers.length;t+=1)"number"==typeof this.conf.baseLayers[t]&&(this.conf.baseLayers[t]=this.conf.baseLayers[t].toString());this.initialSetup=!0},{__name:"BackgroundLayerSelectionPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},getElement:function(){return this.element},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){this.template=jQuery('<div class="backgroundLayerSelectionPlugin oskariui mapplugin"><div class="bg"></div><div class="content">    <ul></ul>    <div class="currentSelection"></div></div></div>'),this.dropdownArrowTemplate=jQuery('<div class="header-icon icon-arrow-white-right"></div>'),this.layerSelectionTemplate=jQuery("<li></li>"),this.errorTemplate=jQuery('<div class="backgroundLayerSelectionPlugin oskariui mapplugin"><div class="bg"></div><div class="error">No baseLayers defined in configuration</div></div>')},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(){var e,t=this;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t.element&&(t.element.remove(),t.element=void 0,delete t.element)},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(){this._updateUISelection()},AfterMapLayerRemoveEvent:function(){this._createLayerSelectionElements()},AfterMapLayerAddEvent:function(){this._createLayerSelectionElements()},MapLayerEvent:function(){this._createLayerSelectionElements()},"userinterface.ExtensionUpdatedEvent":function(e){if(jQuery.inArray(e.getExtension().getName(),["Analyse","Publisher","StatsGrid","Printout"])>-1){var t=this,i="close"!==e.getViewState();i?t.hiddenByMode||(t.hiddenByMode=!0,t.element.hide()):t.hiddenByMode&&(t.hiddenByMode=null,delete t.hiddenByMode,t.element.show())}}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_toggleSelection:function(){var e=this.element.find("div.header-icon"),t=this.element.find("div.content");t.hasClass("open")?(e.addClass("icon-arrow-white-right"),e.removeClass("icon-arrow-white-down"),t.removeClass("open")):(e.removeClass("icon-arrow-white-right"),e.addClass("icon-arrow-white-down"),t.addClass("open"))},_getBottomLayer:function(){var e=0,t=this._sandbox.findAllSelectedMapLayers();return t&&t.length?t[e]:null},_updateSelection:function(e){if(!this.error){var t=this,i=t._getBottomLayer(),n="",a=t.element.find("div.currentSelection"),r=t._sandbox.findMapLayerFromSelectedMapLayers(e),s=!0;e!==a.attr("data-layerId")&&(i&&(n+=i.getId(),jQuery.inArray(n,t.conf.baseLayers)>-1&&t._sandbox.postRequestByName("RemoveMapLayerRequest",[n])),r?t._sandbox.postRequestByName("RemoveMapLayerRequest",[e]):(r=t._sandbox.findMapLayerFromAllAvailable(e),s=r?r.isBaseLayer():!0),t._sandbox.postRequestByName("AddMapLayerRequest",[e,!1,s]),t._sandbox.postRequestByName("RearrangeSelectedMapLayerRequest",[e,0]),t._toggleSelection())}},_updateUISelection:function(e){var t,i,n=this,a=n._getBottomLayer(),r="",s="",o=n.element.find("div.currentSelection");a&&(r+=a.getId(),s=a.getName()),(e||r!==o.attr("data-layerId"))&&(n.element.find("li").each(function(){t=jQuery(this),t.toggleClass("selected",t.attr("data-layerId")===r)}),o.empty(),o.attr("data-layerId",""),o.attr("title",""),jQuery.inArray(r,n.conf.baseLayers)>-1&&(o.attr("data-layerId",r),o.attr("title",s),o.html(s)),i=n.dropdownArrowTemplate.clone(),n.element.find("div.content").hasClass("open")&&i.removeClass("icon-arrow-white-right").addClass("icon-arrow-white-down"),o.prepend(i),n.conf&&(n.conf.font&&n.changeFont(n.conf.font,n.element),n.conf.colorScheme&&n.changeColorScheme(n.conf.colorScheme,n.element)))},_createLayerSelectionElements:function(){if(!this.error){var e,t,i,n=this,a=n.conf.baseLayers,r=n.element.find("ul"),s=function(){n._updateSelection(jQuery(this).attr("data-layerId"))};for(r.empty(),i=0;i<a.length;i+=1)e=n._sandbox.findMapLayerFromAllAvailable(a[i]),e&&(t=n.layerSelectionTemplate.clone(),t.attr("data-layerId",a[i]).attr("title",e.getName()).html(e.getName()),r.append(t),t.bind("click",s));n._updateUISelection(!0)}},_createUI:function(){var e=this,t="bottom center",i=0;e.element||(e.error?e.element=e.errorTemplate.clone():(e.element=e.template.clone(),e.element.find("div.currentSelection").bind("click",function(){e._toggleSelection()}),e.element.find("div.content").toggleClass("dropdown",e.conf&&e.conf.showAsDropdown),e._createLayerSelectionElements())),e.conf&&e.conf.location&&(t=e.conf.location.classes||t,i=e.conf.location.position||i),e.getMapModule().setMapControlPlugin(e.element,t,i)},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location=e,t.element&&(t.stopPlugin(),t.startPlugin())},changeColorScheme:function(e,t){t=t||this.element,t&&e&&(t.find("li").css({"background-color":e.buttonBackgroundColor,color:e.buttonColor}).filter(".selected").css({"background-color":e.buttonSelectedBackgroundColor,color:e.buttonSelectedColor}),t.find(".dropdown li").css({"background-color":e.buttonSelectedBackgroundColor,color:e.buttonSelectedColor,"border-color":e.buttonBorderColor}),t.find("div.currentSelection").css({"background-color":e.buttonBackgroundColor,color:e.buttonColor}))},changeFont:function(e,t){if(t=t||this.element,t&&e){var i="oskari-publisher-font-"+e,n=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(i,n,[t])}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/layers/BackgroundLayerSelectionPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/layers/css/backgroundlayerselection.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._visibilityPollingInterval=1500,this._visibilityCheckOrder=0,this._previousTimer=null},{__name:"LayersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(e){this.requestHandlers={layerVisibilityHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",e,this),layerContentHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",e,this)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);e.addRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.addRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler)},stopPlugin:function(e){e.removeRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.removeRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(e){this._afterRearrangeSelectedMapLayerEvent(e)},MapMoveStartEvent:function(){this._visibilityCheckOrder++,this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null)},AfterMapMoveEvent:function(){this._scheduleVisiblityCheck()},AfterMapLayerAddEvent:function(e){this._parseGeometryForLayer(e.getMapLayer()),this._scheduleVisiblityCheck()}},_scheduleVisiblityCheck:function(){var e=this;this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null),this._visibilityCheckOrder++,this._previousTimer=setTimeout(function(){e._checkLayersVisibility(e._visibilityCheckOrder)},this._visibilityPollingInterval)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},_parseGeometryForLayer:function(e){if(e.getGeometry&&0===e.getGeometry().length){var t=e.getGeometryWKT();if(!t)return;var i=new OpenLayers.Format.WKT,n=i.read(t);if(n){n.constructor!=Array&&(n=[n]);var a,r=[];for(a=0;a<n.length;++a)r.push(n[a].geometry);e.setGeometry(r)}}},_checkLayersVisibility:function(e){if(e===this._visibilityCheckOrder){var t,i,n=this._sandbox.findAllSelectedMapLayers();for(t=0;t<n.length;++t)i=n[t],i.isVisible()&&this.notifyLayerVisibilityChanged(i);this._visibilityCheckScheduled=!1}},_isInScale:function(e){var t=this._sandbox.getMap().getScale();return e.isInScale(t)},isInGeometry:function(e){var t=e.getGeometry();if(!t)return!0;if(0===t.length)return!0;var i,n,a=this.getMap().getExtent();for(i=0;i<t.length;++i)if(n=t[i].getBounds(),n&&n.intersectsBounds(a))return!0;return!1},notifyLayerVisibilityChanged:function(e){var t=e.isVisible(),i=e.isVisible();e.isVisible()&&(t=this._isInScale(e),i=this.isInGeometry(e));var n=(this.getMap(),this.getMapModule().getOLMapLayers(e.getId())),a=n.length?n[0]:null;t&&i&&e.isVisible()?a&&!a.getVisibility()&&(a.setVisibility(!0),a.display(!0)):a&&a.getVisibility()&&(a.setVisibility(!1),a.display(!1));var r=this._sandbox.getEventBuilder("MapLayerVisibilityChangedEvent")(e,t,i);this._sandbox.notifyAll(r)},_afterRearrangeSelectedMapLayerEvent:function(){var e=this._sandbox.findAllSelectedMapLayers(),t=0,i=this._map.layers.length,n=this._map.getLayersByName("Markers");n.length>0&&(this._map.setLayerIndex(n[0],i),i--);var a,r,s,o,l;for(a=0,r=e.length;r>a;a++)if(null!==e[a]&&void 0!==e[a])for(l=this.getMapModule().getOLMapLayers(e[a].getId()),s=0,o=l.length;o>s;s++)this._map.setLayerIndex(l[s],t),t++}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayersPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._visible=t},{__name:"MapModulePlugin.MapLayerVisibilityRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var i=t.getMapLayerId(),n=this.sandbox.findMapLayerFromSelectedMapLayers(i);if(n&&n.isVisible()!==t.getVisible()){n.setVisible(t.getVisible());var a,r=(this.layersPlugin.getMap(),this.layersPlugin.getMapModule()),s=r.getOLMapLayers(n.getId());for(a=0;a<s.length;a++)s[a].setVisibility(n.isVisible()),s[a].display(n.isVisible());this.layersPlugin.notifyLayerVisibilityChanged(n)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"MapModulePlugin.MapMoveByLayerContentRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var i=t.getMapLayerId(),n=this.sandbox.findMapLayerFromSelectedMapLayers(i);if(n){var a=this.layersPlugin.getMapModule().getClosestZoomLevel(n.getMinScale(),n.getMaxScale());if(this.layersPlugin.getMapModule().setZoomLevel(a,!0),n.getGeometry().length>0){var r=this.layersPlugin.isInGeometry(n);if(!r){var s=n.getGeometry()[0].getCentroid();this.layersPlugin.getMapModule().moveMapToLanLot(new OpenLayers.LonLat(s.x,s.y))}}this.layersPlugin.getMapModule().notifyMoveEnd(),this.layersPlugin._checkLayersVisibility(this.layersPlugin._visibilityCheckOrder)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapLayerVisibilityChangedEvent",function(e,t,i){this._mapLayer=e,this._inScale=1==t,this._geomMatch=0!=i},{__name:"MapLayerVisibilityChangedEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},isInScale:function(){return this._inScale},isGeometryMatch:function(){return this._geomMatch}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/MapLayerVisibilityChangedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.WmsLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={}},{__name:"WmsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("wmslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wmslayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{MapLayerEvent:function(e){var t=e.getOperation(),i=this._sandbox.findMapLayerFromSelectedMapLayers(e.getLayerId());"update"===t&&i&&i.isLayerOfType("WMS")&&this._updateLayer(i)},AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this._afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,a=this._sandbox;for(t=0;t<e.length;t++)i=e[t],n=i.getId(),i.isLayerOfType("WMS")&&(a.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},addMapLayerToMap:function(e,t){if(e.isLayerOfType("WMS")){var i,n,a=[],r=e.getSubLayers(),s="layer_";for(r.length>0?(a=r,s="basemap_"):a.push(e),i=0,n=a.length;n>i;i++){var o=a[i],l={layers:o.getWmsName(),transparent:!0,id:o.getId(),styles:o.getCurrentStyle().getName(),format:"image/png"},u={layerId:o.getWmsName(),isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:!0,buffer:0},c=o.getParams(),d=o.getOptions();if(o.getMaxScale()||o.getMinScale()){var h=this.getMapModule().calculateLayerResolutions(o.getMaxScale(),o.getMinScale());u.resolutions=h}var p;for(p in c)c.hasOwnProperty(p)&&(l[p]=c[p]);for(p in d)d.hasOwnProperty(p)&&(u[p]=d[p]);var f=new OpenLayers.Layer.WMS(s+o.getId(),o.getWmsUrls(),l,u);f.opacity=o.getOpacity()/100,this._map.addLayer(f),this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for "+o.getId()),t?this._map.setLayerIndex(f,this._map.layers.length):this._map.setLayerIndex(f,0)}}},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this._removeMapLayerFromMap(t)},_removeMapLayerFromMap:function(e){if(e.isLayerOfType("WMS")){var t;if(e.isBaseLayer()||e.isGroupLayer()){var i;if(e.getSubLayers().length>0)for(i=0;i<e.getSubLayers().length;i++){var n=e.getSubLayers()[i];t=this._map.getLayersByName("basemap_"+n.getId()),t&&t[0]&&t[0].destroy&&t[0].destroy()}else t=this._map.getLayersByName("layer_"+e.getId()),t[0].destroy()}else t=this._map.getLayersByName("layer_"+e.getId()),t[0].destroy()
}},getOLMapLayers:function(e){if(!e.isLayerOfType("WMS"))return null;if(e.isBaseLayer()||e.isGroupLayer()){if(e.getSubLayers().length>0){var t,i=[];for(t=0;t<e.getSubLayers().length;t++){var n=this._map.getLayersByName("basemap_"+e.getSubLayers()[t].getId());i.push(n[0])}return i}return this._map.getLayersByName("layer_"+e.getId())}return this._map.getLayersByName("layer_"+e.getId())},_afterChangeMapLayerOpacityEvent:function(e){var t,i=e.getMapLayer();if(i.isLayerOfType("WMS"))if(i.isBaseLayer()||i.isGroupLayer())if(i.getSubLayers().length>0){var n;for(n=0;n<i.getSubLayers().length;n++)t=this._map.getLayersByName("basemap_"+i.getSubLayers()[n].getId()),t[0].setOpacity(i.getOpacity()/100)}else t=this._map.getLayersByName("layer_"+i.getId()),null!==t[0]&&void 0!==t[0]&&t[0].setOpacity(i.getOpacity()/100);else this._sandbox.printDebug("Setting Layer Opacity for "+i.getId()+" to "+i.getOpacity()),t=this._map.getLayersByName("layer_"+i.getId()),null!==t[0]&&void 0!==t[0]&&t[0].setOpacity(i.getOpacity()/100)},_afterChangeMapLayerStyleEvent:function(e){if(e.getMapLayer().isLayerOfType("WMS")){var t=e.getMapLayer();if(!t.isBaseLayer()){var i=this._map.getLayersByName("layer_"+t.getId());null!==i&&void 0!==i&&i[0].mergeNewParams({styles:t.getCurrentStyle().getName()})}}},_updateLayer:function(e){var t,i,n,a=this.getOLMapLayers(e),r=e.getSubLayers(),s=r.length?r:[e],o=s.length,l=this.getMapModule().getMap().getScale();for(t=0;o>t;++t)i=this._calculateResolutions(s[t]),n=s[t].isInScale(l),i&&n&&a&&a[t]&&(a[t].addOptions({resolutions:i}),a[t].setVisibility(n),a[t].redraw(!0))},_calculateResolutions:function(e){var t=this.getMapModule(),i=e.getMinScale(),n=e.getMaxScale();return i||n?t.calculateLayerResolutions(n,i):void 0}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin",function(){}),define("src/mapping/mapmodule/ol2/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin",["bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin"],function(){}),Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this.config=e},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(){var e=(this.config?this.config.sandbox:null)||"sandbox",t=Oskari.getSandbox(e),i=t.getService("Oskari.mapframework.service.MapLayerService");if(i){i.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var n=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");i.registerLayerModelBuilder("wmtslayer",n)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this.afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,a=this._sandbox;for(t=0;t<e.length;t++)i=e[t],n=i.getId(),i.isLayerOfType("WMTS")&&(a.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},addMapLayerToMap:function(e){if(e.isLayerOfType("WMTS")){var t=this,i=t.getMap(),n=e.getWmtsMatrixSet().matrixIds,a=e.getWmtsLayerDef(),r=null;r=e.isBaseLayer()||e.isGroupLayer()?"basemap_"+e.getId():"layer_"+e.getId();var s=this._sandbox,o="image/png",l="KVP",u=a.resourceUrl?a.resourceUrl.tile?a.resourceUrl.tile.template:void 0:void 0;u?l="REST":u=e.getWmtsUrls()[0];var c=e.getWmtsMatrixSet();n=[];var d,h,p,f=[],m=[];for(d=0;d<c.matrixIds.length;d++)n.push(c.matrixIds[d]),h=c.matrixIds[d].scaleDenominator,p=h/90.71446714322*OpenLayers.METERS_PER_INCH,f.push(p),m.push(p);var g={name:r.split(".").join(""),url:u,requestEncoding:l,layer:e.getWmtsName(),matrixSet:c.identifier,format:o,style:e.getCurrentStyle().getName(),transparent:!0,matrixIds:n,isBaseLayer:e.isBaseLayer(),buffer:0,serverResolutions:m,visibility:e.isInScale(s.getMap().getScale()),layerDef:a};s.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+c.identifier+" / "+g.id+"/"+g.layer+"/"+g.url);var v=new OpenLayers.Layer.WMTS(g);v.opacity=e.getOpacity()/100,s.printDebug("[WmtsLayerPlugin] created WMTS layer "+v),i.addLayers([v])}},getOLMapLayers:function(e){return e.isLayerOfType("WMTS")?this._map.getLayersByName(e.isBaseLayer()||e.isGroupLayer()?"basemap_"+e.getId():"layer_"+e.getId()):null},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){var t=this.getOLMapLayers(e);t&&t[0]&&t[0].destroy()},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer(),i=this.getOLMapLayers(t),n=t.getOpacity()/100;i&&i[0]&&i[0].setOpacity(n)},afterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer(),i=this.getOLMapLayers(t),n=t.getCurrentStyle().getName();i&&i[0]&&i[0].mergeNewParams({styles:n})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapwmts/plugin/wmtslayer/WmtsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.domain.AbstractLayer",function(e,t){var i=this;i._id=void 0,i._name=null,i._description=null,i._type=null,i._layerType="",i._params=e||{},i._options=t||{},i._metaType=null,i._maxScale=null,i._minScale=null,i._visible=null,i._opacity=100,i._isSticky=null,i._inspireName=null,i._organizationName=null,i._dataUrl=null,i._orderNumber=null,i._subLayers=[],i._styles=[],i._currentStyle=null,i._legendImage=null,i._featureInfoEnabled=null,i._queryable=null,i._queryFormat=null,i._permissions={},i._geometry=[],i._geometryWKT=null,i._tools=[],i._metadataIdentifier=null,i._backendStatus=null,i._featureData=!1,i._layerUrls=[],i._layerName=null,i._baseLayerId=-1,i._realtime=!1,i._refreshRate=null,i._admin=null,this._gfiContent=null},{setLocalization:function(e){var t,i,n={},a={},r={},s={};for(t in e)e.hasOwnProperty(t)&&(i=e[t],i.name&&(n[t]=i.name),i.subtitle&&(a[t]=i.subtitle),i.inspire&&(r[t]=i.inspire),i.orgName&&(s[t]=i.orgName));for(t in n)if(n.hasOwnProperty(t)){this.setName(n);break}for(t in a)if(a.hasOwnProperty(t)){this.setDescription(a);break}for(t in r)if(r.hasOwnProperty(t)){this.setInspireName(r);break}for(t in s)if(s.hasOwnProperty(t)){this.setOrganizationName(s);break}},setId:function(e){this._id=e},getId:function(){return this._id},setParentId:function(e){this._baseLayerId=e},getParentId:function(){return this._baseLayerId?this._baseLayerId:-1},setQueryFormat:function(e){this._queryFormat=e},getQueryFormat:function(){return this._queryFormat},setName:function(e){this._name=e},getName:function(e){return this._name&&"object"==typeof this._name?e?this._name[e]:this._name[Oskari.getLang()]:this._name},setType:function(e){this._type=e},getType:function(){return this._type},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(e){return this._organizationName&&"object"==typeof this._organizationName?e?this._organizationName[e]:this._organizationName[Oskari.getLang()]:this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(e){return this._inspireName&&"object"==typeof this._inspireName?e?this._inspireName[e]:this._inspireName[Oskari.getLang()]:this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(e){return this._description&&"object"==typeof this._description?e?this._description[e]:this._description[Oskari.getLang()]:this._description},addSubLayer:function(e){var t,i,n=this.getSubLayers();for(t=0,i=n.length;i>t;++t)if(n[t].getId()===e.getId())return!1;return n.push(e),!0},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},isVisible:function(){return this._visible===!0},setVisible:function(e){this._visible=e},setOpacity:function(e){this._opacity=e},getOpacity:function(){return null===this._opacity||void 0===this._opacity?100:this._opacity},setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null,delete this._permissions[e]},getPermission:function(e){return this._permissions[e]},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e},setMetaType:function(e){this._metaType=e},getMetaType:function(){return this._metaType},addStyle:function(e){if(e&&e.getName&&"function"==typeof e.getName){var t,i,n=!1;for(t=0;t<this.getStyles().length;++t)if(i=this.getStyles()[t],i.getName()===e.getName()){n=!0;break}n||this.getStyles().push(e)}},getStyles:function(){return this._styles||(this._styles=[]),this._styles},selectStyle:function(e){for(var t=this,i=0;i<t.getStyles().length;i++){var n=t.getStyles()[i];if(n.getName()===e)return t._currentStyle=n,void(n.getLegend()&&(t._legendImage=n.getLegend()))}t._currentStyle||(this._currentStyle=this._createEmptyStyle())},_createEmptyStyle:function(){var e=Oskari.clazz.create("Oskari.mapframework.domain.Style");return e.setName(""),e.setTitle(""),e.setLegend(""),e},getCurrentStyle:function(){return this._currentStyle||this.selectStyle(""),this._currentStyle},getTools:function(){return this._tools},setTools:function(e){this._tools=e},addTool:function(e){this._tools.push(e)},getTool:function(e){var t,i=null;if(this._tools.length>0&&""!==e)for(t=0;t<this._tools.length;t++)if(i=this._tools[t],i.getName()===e)return i;return i},setLegendImage:function(e){this._legendImage=e},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){var e,t=!1;if(this._legendImage)t=!0;else for(e=0;e<this.getStyles().length;++e)if(this.getStyles()[e].getLegend()){t=!0;break}return t},setSticky:function(e){this._isSticky=e},isSticky:function(){return this._isSticky},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return"GROUP_LAYER"===this._type},isBaseLayer:function(){return"BASE_LAYER"===this._type},isInScale:function(e){var t=!1,i=this.getSubLayers();return e=e||Oskari.getSandbox().getMap().getScale(),i&&i.length?t=_.any(i,function(t){return t.isInScale(e)}):((e>this.getMaxScale()||!this.getMaxScale())&&e<this.getMinScale()||!this.getMinScale())&&(t=!0),t},getLayerType:function(){return this._layerType.toLowerCase()},isLayerOfType:function(e){return e&&e.toLowerCase()===this.getLayerType()},getIconClassname:function(){var e;return e=this.isBaseLayer()?"layer-base":this.isGroupLayer()?"layer-group":"layer-"+this.getLayerType()},getParams:function(){return this._params},getOptions:function(){return this._options},hasFeatureData:function(){return this._featureData},getLayerName:function(){return this._layerName},setLayerName:function(e){this._layerName=e},addLayerUrl:function(e){var t,i,n=this.getLayerUrls(),a=n.length,r=!1;for(t=0;a>t;++t)if(i=n[t],i===e){r=!0;break}r||n.push(e)},setLayerUrls:function(e){"[object Array]"===Object.prototype.toString.call(e)?this._layerUrls=e:"string"==typeof someVar&&(this._layerUrls=[e])},getLayerUrls:function(){return this._layerUrls||(this._layerUrls=[]),this._layerUrls},getLayerUrl:function(){var e=this.getLayerUrls();return e&&e.length>0?e[0]:void 0},setRealtime:function(e){this._realtime=e===!0},isRealtime:function(){return this._realtime},setRefreshRate:function(e){this._refreshRate=0>e?0:e},getRefreshRate:function(){return this._refreshRate},setGfiContent:function(e){this._gfiContent=e},getGfiContent:function(){return this._gfiContent},setAdmin:function(e){this._admin=e},getAdmin:function(){return this._admin}}),define("sources/framework/domain/AbstractLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._WmtsMatrixSetId=null,this._OriginalWmtsMatrixSetData=null,this._WmtsMatrixSet=null,this._WmtsLayerDef=null,this._availableQueryFormats=[],this._layerType="WMTS"},{setWmtsName:function(e){this.setLayerName(e)},getWmtsName:function(){return this.getLayerName()},setWmtsMatrixSetId:function(e){this._WmtsMatrixSetId=e},getWmtsMatrixSetId:function(){return this._WmtsMatrixSetId},setOriginalMatrixSetData:function(e){this._OriginalWmtsMatrixSetData=e},getOriginalMatrixSetData:function(){return this._OriginalWmtsMatrixSetData},setWmtsMatrixSet:function(e){this._WmtsMatrixSet=e},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},getOriginalWmtsMatrixSetAsString:function(){var e=this.getOriginalMatrixSetData();if(!e)return"";try{return JSON.stringify(e,null,3)}catch(t){return t}},setWmtsLayerDef:function(e){this._WmtsLayerDef=e},getWmtsLayerDef:function(){return this._WmtsLayerDef},addWmtsUrl:function(e){this.addLayerUrl(e)},getWmtsUrls:function(){return this.getLayerUrls()},setAvailableQueryFormats:function(e){this._availableQueryFormats=e||[]},getAvailableQueryFormats:function(){return this._availableQueryFormats||[]}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/framework/bundle/mapwmts/domain/WmtsLayer",function(){}),define("src/mapping/model/WmtsLayerModel",["./AbstractMapLayerModel","bundles/framework/bundle/mapwmts/domain/WmtsLayer"],function(){Oskari.cls("Oskari.mapframework.wmts.domain.WmtsLayer").category({_WmtsCaps:null,setWmtsCaps:function(e){this._WmtsCaps=e},getWmtsCaps:function(){return this._WmtsCaps}})}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(e){this.mapLayerService=e,this.capabilities={}},{setCapabilities:function(e,t){this.capabilities[e]=t},getCapabilities:function(e){return this.capabilities[e]},readWMTSCapabilites:function(e,t,i,n,a){var r=this,s=new OpenLayers.Format.WMTSCapabilities,o=OpenLayers.Util.extend({url:t,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(t){var a=t.responseXML;a&&a.documentElement||(a=t.responseText);var o=s.read(a);r.setCapabilities(e,o);var l=r.parseCapabilitiesToLayers(e,o,i);n&&n.apply(this,[l,o])},failure:function(){alert("Trouble getting capabilities doc"),OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}},a||{});OpenLayers.Request.GET(o)},parseCapabilitiesToLayers:function(e,t,i){var n=this.mapLayerService,a=null;a=t.operationsMetadata.GetTile.dcp.http.getArray?t.operationsMetadata.GetTile.dcp.http.getArray:t.operationsMetadata.GetTile.dcp.http.get;var r,s,o,l,u,c,d,h,p,f,m,g=t.contents.layers,v=t.contents,y=v.tileMatrixSets[i],b=[];for(r=0;r<g.length;r++){for(s=g[r],o=s.identifier,l=s.identifier,u={wmtsName:o,descriptionLink:"",orgName:e,type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:!0,style:"",dataUrl:"",name:o,opacity:100,inspire:e,maxScale:1},c=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer"),c.setAsNormalLayer(),c.setId(o.split(".").join("_")),c.setName(u.name),c.setWmtsName(u.wmtsName),c.setOpacity(u.opacity),c.setMaxScale(u.maxScale),c.setMinScale(u.minScale),c.setDescription(u.info),c.setDataUrl(u.dataUrl),c.setOrganizationName(u.orgName),c.setInspireName(u.inspire),c.setWmtsMatrixSet(y),c.setWmtsLayerDef(s),c.setVisible(!0),c.addWmtsUrl(a),d=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),f=0,m=s.styles.length;m>f;++f)if(h=s.styles[f],p=d(),p.setName(h.identifier),p.setTitle(h.identifier),c.addStyle(p),h.isDefault){c.selectStyle(h.identifier);break}n.addLayer(c,!1),b.push(c)}return b}}),define("bundles/framework/bundle/mapwmts/service/WmtsLayerService",function(){}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(e,t,i){t.wmsName&&e.setWmtsName(t.wmsName),t.wmsUrl&&e.setLayerUrls(i.parseUrls(t.wmsUrl)),i.populateStyles(e,t),e.setOriginalMatrixSetData(t.tileMatrixSetData);var n=t.tileMatrixSetId;if(t.formats&&(e.setQueryFormat(t.formats.value),e.setAvailableQueryFormats(t.formats.available)),e.setWmtsMatrixSetId(n),e.setFeatureInfoEnabled(!0),t.tileMatrixSetData&&t.tileLayerData)e.setWmtsMatrixSet(t.tileMatrixSetData),e.setWmtsLayerDef(t.tileLayerData);else if(t.tileMatrixSetData&&t.tileMatrixSetId){if(t.tileMatrixSetData.contents&&t.tileMatrixSetData.contents.tileMatrixSets){var a=t.tileMatrixSetData.contents.tileMatrixSets[n];e.setWmtsMatrixSet(a)}var r,s=e.getWmtsName(),o=t.tileMatrixSetData.contents.layers;for(r=0;r<o.length;r++)if(o[r].identifier===s){e.setWmtsLayerDef(o[r]);break}}}}),define("bundles/framework/bundle/mapwmts/service/WmtsLayerModelBuilder",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(){this.name="MapWmts",this.mediator=null,this.sandbox=null,this.service=null,this.ui=null},{start:function(){if("started"!==this.mediator.getState()){var e=this,t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);this.sandbox=n;var a=n.getService("Oskari.mapframework.service.MapLayerService");a.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var r=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");a.registerLayerModelBuilder("wmtslayer",r);var s=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",a);return this.service=s,this.mediator.setState("started"),this}},update:function(e,t,i,n){e.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+n)},stop:function(){return this.mediator.setState("stopped"),this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]}),define("bundles/framework/bundle/mapwmts/instance",function(){}),define("src/framework/mapwmts/module",["oskari","jquery","bundles/framework/bundle/mapwmts/plugin/wmtslayer/WmtsLayerPlugin","sources/framework/domain/AbstractLayer","src/mapping/model/WmtsLayerModel","bundles/framework/bundle/mapwmts/service/WmtsLayerService","bundles/framework/bundle/mapwmts/service/WmtsLayerModelBuilder","bundles/framework/bundle/mapwmts/instance"],function(e){return e.bundleCls("mapwmts").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.MapWmtsBundleInstance")},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}})}),this.org=this.org||{},org.cometd={},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract"},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return void 0===e||null===e?!1:"string"==typeof e||e instanceof String},org.cometd.Utils.isArray=function(e){return void 0===e||null===e?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var i=0;i<t.length;++i)if(e===t[i])return i;return-1},org.cometd.Utils.setTimeout=function(e,t,i){return window.setTimeout(function(){try{t()}catch(i){e._debug("Exception invoking timed function",t,i)}},i)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(i,n,a){for(var r=[],s=0;s<e.length;++s){var o=e[s];t[o].accept(i,n,a)===!0&&r.push(o)}return r},this.negotiateTransport=function(i,n,a,r){for(var s=0;s<e.length;++s)for(var o=e[s],l=0;l<i.length;++l)if(o===i[l]){var u=t[o];if(u.accept(n,a,r)===!0)return u}return null},this.add=function(i,n,a){for(var r=!1,s=0;s<e.length;++s)if(e[s]===i){r=!0;break}return r||("number"!=typeof a?e.push(i):e.splice(a,0,i),t[i]=n),!r},this.find=function(i){for(var n=0;n<e.length;++n)if(e[n]===i)return t[i];return null},this.remove=function(i){for(var n=0;n<e.length;++n)if(e[n]===i){e.splice(n,1);var a=t[i];return delete t[i],a}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var i=0;i<e.length;++i)t[e[i]].reset()}},org.cometd.Transport=function(){var e,t;this.registered=function(i,n){e=i,t=n},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,i){return org.cometd.Utils.setTimeout(t,e,i)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(){throw"Abstract"},this.getType=function(){return e},this.send=function(){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function e(e){for(;d.length>0;){var t=d[0],i=t[0],n=t[1];if(i.url!==e.url||i.sync!==e.sync)break;d.shift(),e.messages=e.messages.concat(i.messages),this._debug("Coalesced",i.messages.length,"messages from request",n.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var i=this.getConfiguration().maxNetworkDelay,n=i;t.metaConnect===!0&&(n+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",n,"ms for the response, maxNetworkDelay",i);var a=this;t.timeout=this.setTimeout(function(){t.expired=!0,t.xhr&&t.xhr.abort();var i="Request "+t.id+" of transport "+a.getType()+" exceeded "+n+" ms max network delay";a._debug(i),a.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,"timeout",i)},n)}}function i(e){var i=++l,n={id:i,metaConnect:!1};c.length<this.getConfiguration().maxConnections-1?(c.push(n),t.call(this,e,n)):(this._debug("Transport",this.getType(),"queueing request",i,"envelope",e),d.push([e,n]))}function n(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==u&&u.id!==t)throw"Longpoll request mismatch, completing request "+t;u=null}function a(t,n){var a=org.cometd.Utils.inArray(t,c);if(a>=0&&c.splice(a,1),d.length>0){var r=d.shift(),s=r[0],o=r[1];if(this._debug("Transport dequeued request",o.id),n)this.getConfiguration().autoBatch&&e.call(this,s),i.call(this,s),this._debug("Transport completed request",t.id,s);else{var l=this;this.setTimeout(function(){l.complete(o,!1,o.metaConnect),s.onFailure(o.xhr,s.messages,"error","Previous request failed")},0)}}}function r(e){if(null!==u)throw"Concurrent metaConnect requests not allowed, request id="+u.id+" not yet completed";var i=++l;this._debug("Transport",this.getType(),"metaConnect send, request",i,"envelope",e);var n={id:i,metaConnect:!0};t.call(this,e,n),u=n}var s=new org.cometd.Transport,o=org.cometd.Transport.derive(s),l=0,u=null,c=[],d=[];return o.complete=function(e,t,i){i?n.call(this,e):a.call(this,e,t)},o.transportSend=function(){throw"Abstract"},o.transportSuccess=function(e,t,i){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),i&&i.length>0?e.onSuccess(i):e.onFailure(t.xhr,e.messages,"Empty HTTP response"))},o.transportFailure=function(e,t,i,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,i,n))},o.send=function(e,t){t?r.call(this,e):i.call(this,e)},o.abort=function(){s.abort();for(var e=0;e<c.length;++e){var t=c[e];this._debug("Aborting request",t),t.xhr&&t.xhr.abort()}u&&(this._debug("Aborting metaConnect request",u),u.xhr&&u.xhr.abort()),this.reset()},o.reset=function(){s.reset(),u=null,c=[],d=[]},o},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),i=!0;return t.accept=function(e,t){return i||!t},t.xhrSend=function(){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var n=this;try{var a=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(a){n._debug("Transport",n.getType(),"received response",a);var r=!1;try{var s=n.convertToMessages(a);0===s.length?(i=!1,n.transportFailure(e,t,"no response",null)):(r=!0,n.transportSuccess(e,t,s))}catch(o){n._debug(o),r||(i=!1,n.transportFailure(e,t,"bad response",o))}},onError:function(r,s){i=!1,a?n.setTimeout(function(){n.transportFailure(e,t,r,s)},0):n.transportFailure(e,t,r,s)}}),a=!1}catch(r){i=!1,this.setTimeout(function(){n.transportFailure(e,t,"error",r)},0)}},t.reset=function(){e.reset(),i=!0},t},org.cometd.CallbackPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),i=2e3;return t.accept=function(){return!0},t.jsonpSend=function(){throw"Abstract"},t.transportSend=function(e,t){for(var n=this,a=0,r=e.messages.length,s=[];r>0;){var o=org.cometd.JSON.toJSON(e.messages.slice(a,a+r)),l=e.url.length+encodeURI(o).length;if(l>i){if(1===r){var u="Bayeux message too big ("+l+" bytes, max is "+i+") for transport "+this.getType();return void this.setTimeout(function(){n.transportFailure(e,t,"error",u)},0)}--r}else s.push(r),a+=r,r=e.messages.length-a}var c=e;if(s.length>1){var d=0,h=s[0];this._debug("Transport",this.getType(),"split",e.messages.length,"messages into",s.join(" + ")),c=this._mixin(!1,{},e),c.messages=e.messages.slice(d,h),c.onSuccess=e.onSuccess,c.onFailure=e.onFailure;for(var p=1;p<s.length;++p){var f=this._mixin(!1,{},e);d=h,h+=s[p],f.messages=e.messages.slice(d,h),f.onSuccess=e.onSuccess,f.onFailure=e.onFailure,this.send(f,t.metaConnect)}}this._debug("Transport",this.getType(),"sending request",t.id,"envelope",c);try{var m=!0;this.jsonpSend({transport:this,url:c.url,sync:c.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(c.messages),onSuccess:function(e){var i=!1;try{var a=n.convertToMessages(e);0===a.length?n.transportFailure(c,t,"no response"):(i=!0,n.transportSuccess(c,t,a))}catch(r){n._debug(r),i||n.transportFailure(c,t,"bad response",r)}},onError:function(e,i){m?n.setTimeout(function(){n.transportFailure(c,t,e,i)},0):n.transportFailure(c,t,e,i)}}),m=!1}catch(g){this.setTimeout(function(){n.transportFailure(c,t,"error",g)},0)}},t},org.cometd.WebSocketTransport=function(){function e(){var e=n.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);var t=this,i=null,a=n.getConfiguration().connectTimeout;a>0&&(i=this.setTimeout(function(){i=null,h||(t._debug("Transport",t.getType(),"timed out while connecting to URL",e,":",a,"ms"),t.onClose(1002,"Connect Timeout"))},a));var r=new org.cometd.WebSocket(e),s=function(){return t._debug("WebSocket opened",r),i&&(t.clearTimeout(i),i=null),r!==d?void t._debug("Ignoring open event, WebSocket",d):void t.onOpen()},o=function(e){var n=e?e.code:1e3,a=e?e.reason:void 0;return t._debug("WebSocket closed",n,"/",a,r),i&&(t.clearTimeout(i),i=null),r!==d?void t._debug("Ignoring close event, WebSocket",d):void t.onClose(n,a)},l=function(e){return t._debug("WebSocket message",e,r),r!==d?void t._debug("Ignoring message event, WebSocket",d):void t.onMessage(e)};r.onopen=s,r.onclose=o,r.onerror=function(){o({code:1002})},r.onmessage=l,d=r,this._debug("Transport",this.getType(),"configured callbacks on",r)}function t(e,t){var i=org.cometd.JSON.toJSON(e.messages);d.send(i),this._debug("Transport",this.getType(),"sent",e,"metaConnect =",t);var n=this.getConfiguration().maxNetworkDelay,a=n;t&&(a+=this.getAdvice().timeout,p=!0);for(var r=[],s=0;s<e.messages.length;++s){var o=e.messages[s];if(o.id){r.push(o.id);var l=d;c[o.id]=this.setTimeout(function(){l&&l.close(1e3,"Timeout")},a)}}this._debug("Transport",this.getType(),"waiting at most",a,"ms for messages",r,"maxNetworkDelay",n,", timeouts:",c)}function i(i,n){try{null===d?e.call(this):h&&t.call(this,i,n)}catch(a){var r=d;this.setTimeout(function(){i.onFailure(r,i.messages,"error",a)},0)}}var n,a,r=new org.cometd.Transport,s=org.cometd.Transport.derive(r),o=!0,l=!1,u={},c={},d=null,h=!1,p=!1;return s.onOpen=function(){this._debug("Transport",this.getType(),"opened",d),h=!0,l=!0,this._debug("Sending pending messages",u);for(var e in u){var i=u[e],n=i[0],r=i[1];a=n.onSuccess,t.call(this,n,r)}},s.onMessage=function(e){this._debug("Transport",this.getType(),"received websocket message",e,d);for(var t=!1,i=this.convertToMessages(e.data),n=[],r=0;r<i.length;++r){var s=i[r];if((/^\/meta\//.test(s.channel)||void 0===s.data)&&s.id){n.push(s.id);var o=c[s.id];o&&(this.clearTimeout(o),delete c[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",c))}"/meta/connect"===s.channel&&(p=!1),"/meta/disconnect"!==s.channel||p||(t=!0)}for(var l=!1,h=0;h<n.length;++h){var f=n[h];for(var m in u){var g=m.split(","),v=org.cometd.Utils.inArray(f,g);if(v>=0){l=!0,g.splice(v,1);var y=u[m][0],b=u[m][1];delete u[m],g.length>0&&(u[g.join(",")]=[y,b]);break}}}l&&this._debug("Transport",this.getType(),"removed envelope, envelopes",u),a.call(this,i),t&&d.close(1e3,"Disconnect")},s.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t,d),o=l;for(var i in c)this.clearTimeout(c[i]);c={};for(var n in u){var a=u[n][0],r=u[n][1];r&&(p=!1),a.onFailure(d,a.messages,"closed "+e+"/"+t)}u={},null!==d&&h&&d.close(1e3,"Close"),h=!1,d=null},s.registered=function(e,t){r.registered(e,t),n=t},s.accept=function(){return o&&!!org.cometd.WebSocket&&n.websocketEnabled!==!1},s.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var n=[],a=0;a<e.messages.length;++a){var r=e.messages[a];r.id&&n.push(r.id)}u[n.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",u),i.call(this,e,t)},s.abort=function(){if(r.abort(),null!==d)try{d.close(1001)}catch(e){this._debug(e)}this.reset()},s.reset=function(){r.reset(),null!==d&&h&&d.close(1e3,"Reset"),o=!0,l=!1,c={},u={},d=null,h=!1,a=null},s},org.cometd.Cometd=function(e){function t(e){return org.cometd.Utils.isString(e)}function i(e){return void 0===e||null===e?!1:"function"==typeof e}function n(e,t){if(window.console){var n=window.console[e];i(n)&&n.apply(window.console,t)}}function a(e){if(tt._debug("Configuring cometd object with",e),t(e)&&(e={url:e}),e||(e={}),bt=tt._mixin(!1,bt,e),!bt.url)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";
var i=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(bt.url),n=i[2],a=i[8],r=i[9];if(nt=tt._isCrossDomain(n),bt.appendMessageTypeToURL)if(void 0!==r&&r.length>0)tt._info("Appending message type to URI "+a+r+" is not supported, disabling 'appendMessageTypeToURL' configuration"),bt.appendMessageTypeToURL=!1;else{var s=a.split("/"),o=s.length-1;a.match(/\/$/)&&(o-=1),s[o].indexOf(".")>=0&&(tt._info("Appending message type to URI "+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),bt.appendMessageTypeToURL=!1)}}function r(){for(var e in dt)for(var t=dt[e],i=0;i<t.length;++i){var n=t[i];n&&!n.listener&&(delete t[i],tt._debug("Removed subscription",n,"for channel",e))}}function s(e){rt!==e&&(tt._debug("Status",rt,"->",e),rt=e)}function o(){return"disconnecting"===rt||"disconnected"===rt}function l(){return++st}function u(e,t,n,a,r){try{return t.call(e,a)}catch(s){tt._debug("Exception during execution of extension",n,s);var o=tt.onExtensionException;if(i(o)){tt._debug("Invoking extension exception callback",n,s);try{o.call(tt,s,n,r,a)}catch(l){tt._info("Exception during execution of exception callback in extension",n,l)}}return a}}function c(e){for(var t=0;t<ft.length&&(void 0!==e&&null!==e);++t){var n=bt.reverseIncomingExtensions?ft.length-1-t:t,a=ft[n],r=a.extension.incoming;if(i(r)){var s=u(a.extension,r,a.name,e,!1);e=void 0===s?e:s}}return e}function d(e){for(var t=0;t<ft.length&&(void 0!==e&&null!==e);++t){var n=ft[t],a=n.extension.outgoing;if(i(a)){var r=u(n.extension,a,n.name,e,!0);e=void 0===r?e:r}}return e}function h(e,t){var n=dt[e];if(n&&n.length>0)for(var a=0;a<n.length;++a){var r=n[a];if(r)try{r.callback.call(r.scope,t)}catch(s){tt._debug("Exception during notification",r,t,s);var o=tt.onListenerException;if(i(o)){tt._debug("Invoking listener exception callback",r,s);try{o.call(tt,s,r.handle,r.listener,t)}catch(l){tt._info("Exception during execution of listener callback",r,l)}}}}}function p(e,t){h(e,t);for(var i=e.split("/"),n=i.length-1,a=n;a>0;--a){var r=i.slice(0,a).join("/")+"/*";a===n&&h(r,t),r+="*",h(r,t)}}function f(){null!==pt&&org.cometd.Utils.clearTimeout(pt),pt=null}function m(e){f();var t=mt.interval+ht;tt._debug("Function scheduled in",t,"ms, interval =",mt.interval,"backoff =",ht,e),pt=org.cometd.Utils.setTimeout(tt,e,t)}function g(e,t,n,a){for(var r=0;r<t.length;++r){var s=t[r];s.id=""+l(),ot&&(s.clientId=ot);var o=void 0;i(s._callback)&&(o=s._callback,delete s._callback),s=d(s),void 0!==s&&null!==s?(t[r]=s,o&&(gt[s.id]=o)):t.splice(r--,1)}if(0!==t.length){var u=bt.url;bt.appendMessageTypeToURL&&(u.match(/\/$/)||(u+="/"),a&&(u+=a));var c={url:u,sync:e,messages:t,onSuccess:function(e){try{kt.call(tt,e)}catch(t){tt._debug("Exception during handling of messages",t)}},onFailure:function(e,t,i,n){try{_t.call(tt,e,t,i,n)}catch(a){tt._debug("Exception during handling of failure",a)}}};tt._debug("Send",c),J.send(c,n)}}function v(e){lt>0||ct===!0?ut.push(e):g(!1,[e],!1)}function y(){ht=0}function b(){ht<bt.maxBackoff&&(ht+=bt.backoffIncrement)}function k(){++lt}function _(){var e=ut;ut=[],e.length>0&&g(!1,e,!1)}function w(){if(--lt,0>lt)throw"Calls to startBatch() and endBatch() are not paired";0!==lt||o()||ct||_()}function L(){if(!o()){var e={channel:"/meta/connect",connectionType:J.getType()};yt||(e.advice={timeout:0}),s("connecting"),tt._debug("Connect sent",e),g(!1,[e],!0,"connect"),s("connected")}}function x(){s("connecting"),m(function(){L()})}function S(e){e&&(mt=tt._mixin(!1,{},bt.advice,e),tt._debug("New advice",mt))}function O(e){f(),e&&J.abort(),ot=null,s("disconnected"),lt=0,y(),ut.length>0&&(_t.call(tt,void 0,ut,"error","Disconnected"),ut=[])}function T(e){ot=null,r(),o()?(at.reset(),S(bt.advice)):S(tt._mixin(!1,mt,{reconnect:"retry"})),lt=0,ct=!0,et=e;var t="1.0",i=at.findTransportTypes(t,nt,bt.url),n={version:t,minimumVersion:"0.9",channel:"/meta/handshake",supportedConnectionTypes:i,advice:{timeout:mt.timeout,interval:mt.interval}},a=tt._mixin(!1,{},et,n);J=at.negotiateTransport(i,t,nt,bt.url),tt._debug("Initial transport is",J.getType()),s("handshaking"),tt._debug("Handshake sent",a),g(!1,[a],!1,"handshake")}function C(){s("handshaking"),ct=!0,m(function(){T(et)})}function M(e){p("/meta/handshake",e),p("/meta/unsuccessful",e);var t=!o()&&"none"!==mt.reconnect;t?(b(),C()):O(!1)}function N(e){if(e.successful){ot=e.clientId;var t=at.negotiateTransport(e.supportedConnectionTypes,e.version,nt,bt.url);if(null===t)throw"Could not negotiate transport with server; client "+at.findTransportTypes(e.version,nt,bt.url)+", server "+e.supportedConnectionTypes;J!==t&&(tt._debug("Transport",J,"->",t),J=t),ct=!1,_(),e.reestablish=vt,vt=!0,p("/meta/handshake",e);var i=o()?"none":mt.reconnect;switch(i){case"retry":y(),x();break;case"none":O(!1);break;default:throw"Unrecognized advice action "+i}}else M(e)}function E(e,t){M({successful:!1,failure:!0,channel:"/meta/handshake",request:t,xhr:e,advice:{reconnect:"retry",interval:ht}})}function z(e){p("/meta/connect",e),p("/meta/unsuccessful",e);var t=o()?"none":mt.reconnect;switch(t){case"retry":x(),b();break;case"handshake":at.reset(),y(),C();break;case"none":O(!1);break;default:throw"Unrecognized advice action"+t}}function P(e){if(yt=e.successful){p("/meta/connect",e);var t=o()?"none":mt.reconnect;switch(t){case"retry":y(),x();break;case"none":O(!1);break;default:throw"Unrecognized advice action "+t}}else z(e)}function A(e,t){yt=!1,z({successful:!1,failure:!0,channel:"/meta/connect",request:t,xhr:e,advice:{reconnect:"retry",interval:ht}})}function R(e){O(!0),p("/meta/disconnect",e),p("/meta/unsuccessful",e)}function I(e){e.successful?(O(!1),p("/meta/disconnect",e)):R(e)}function D(e,t){R({successful:!1,failure:!0,channel:"/meta/disconnect",request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function j(e){p("/meta/subscribe",e),p("/meta/unsuccessful",e)}function F(e){e.successful?p("/meta/subscribe",e):j(e)}function q(e,t){j({successful:!1,failure:!0,channel:"/meta/subscribe",request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function B(e){p("/meta/unsubscribe",e),p("/meta/unsuccessful",e)}function H(e){e.successful?p("/meta/unsubscribe",e):B(e)}function U(e,t){B({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function G(e){var t=gt[e.id];i(t)&&(delete gt[e.id],t.call(tt,e))}function V(e){G(e),p("/meta/publish",e),p("/meta/unsuccessful",e)}function W(e){void 0===e.successful?e.data?p(e.channel,e):tt._debug("Unknown message",e):e.successful?(G(e),p("/meta/publish",e)):V(e)}function Q(e,t){V({successful:!1,failure:!0,channel:t.channel,request:t,xhr:e,advice:{reconnect:"none",interval:0}})}function K(e){if(e=c(e),void 0!==e&&null!==e){S(e.advice);var t=e.channel;switch(t){case"/meta/handshake":N(e);break;case"/meta/connect":P(e);break;case"/meta/disconnect":I(e);break;case"/meta/subscribe":F(e);break;case"/meta/unsubscribe":H(e);break;default:W(e)}}}function X(e){var t=dt[e];if(t)for(var i=0;i<t.length;++i)if(t[i])return!0;return!1}function $(e,n){var a={scope:e,method:n};if(i(e))a.scope=void 0,a.method=e;else if(t(n)){if(!e)throw"Invalid scope "+e;if(a.method=e[n],!i(a.method))throw"Invalid callback "+n+" for scope "+e}else if(!i(n))throw"Invalid callback "+n;return a}function Y(e,t,i,n){var a=$(t,i);tt._debug("Adding listener on",e,"with scope",a.scope,"and callback",a.method);var r={channel:e,scope:a.scope,callback:a.method,listener:n},s=dt[e];s||(s=[],dt[e]=s);var o=s.push(r)-1;return r.id=o,r.handle=[e,o],tt._debug("Added listener",r,"for channel",e,"having id =",o),r.handle}function Z(e){var t=dt[e[0]];t&&(delete t[e[1]],tt._debug("Removed listener",e))}var J,et,tt=this,it=e||"default",nt=!1,at=new org.cometd.TransportRegistry,rt="disconnected",st=0,ot=null,lt=0,ut=[],ct=!1,dt={},ht=0,pt=null,ft=[],mt={},gt={},vt=!1,yt=!1,bt={connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,t){for(var i=t||{},n=2;n<arguments.length;++n){var a=arguments[n];if(void 0!==a&&null!==a)for(var r in a){var s=a[r],o=i[r];if(s!==t&&void 0!==s)if(e&&"object"==typeof s&&null!==s)if(s instanceof Array)i[r]=this._mixin(e,o instanceof Array?o:[],s);else{var l="object"!=typeof o||o instanceof Array?{}:o;i[r]=this._mixin(e,l,s)}else i[r]=s}}return i},this._warn=function(){n("warn",arguments)},this._info=function(){"warn"!==bt.logLevel&&n("info",arguments)},this._debug=function(){"debug"===bt.logLevel&&n("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var kt,_t;this.send=v,this.receive=K,kt=function(e){tt._debug("Received",e);for(var t=0;t<e.length;++t){var i=e[t];K(i)}},_t=function(e,t,i,n){tt._debug("handleFailure",e,t,i,n);for(var a=0;a<t.length;++a){var r=t[a],s=r.channel;switch(s){case"/meta/handshake":E(e,r);break;case"/meta/connect":A(e,r);break;case"/meta/disconnect":D(e,r);break;case"/meta/subscribe":q(e,r);break;case"/meta/unsubscribe":U(e,r);break;default:Q(e,r)}}},this.registerTransport=function(e,t,n){var a=at.add(e,t,n);return a&&(this._debug("Registered transport",e),i(t.registered)&&t.registered(e,this)),a},this.getTransportTypes=function(){return at.getTransportTypes()},this.unregisterTransport=function(e){var t=at.remove(e);return null!==t&&(this._debug("Unregistered transport",e),i(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){at.clear()},this.findTransport=function(e){return at.find(e)},this.configure=function(e){a.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e){s("disconnected"),vt=!1,T(e)},this.disconnect=function(e,t){if(!o()){void 0===t&&"boolean"!=typeof e&&(t=e,e=!1);var i={channel:"/meta/disconnect"},n=this._mixin(!1,{},t,i);s("disconnecting"),g(e===!0,[n],!1,"disconnect")}},this.startBatch=function(){k()},this.endBatch=function(){w()},this.batch=function(e,t){var i=$(e,t);this.startBatch();try{i.method.call(i.scope),this.endBatch()}catch(n){throw this._debug("Exception during execution of batch",n),this.endBatch(),n}},this.addListener=function(e,i,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!t(e))throw"Illegal argument type: channel must be a string";return Y(e,i,n,!0)},this.removeListener=function(e){if(!org.cometd.Utils.isArray(e))throw"Invalid argument: expected subscription, not "+e;Z(e)},this.clearListeners=function(){dt={}},this.subscribe=function(e,n,a,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!t(e))throw"Illegal argument type: channel must be a string";if(o())throw"Illegal state: already disconnected";i(n)&&(r=a,a=n,n=void 0);var s=!X(e),l=Y(e,n,a,!1);if(s){var u={channel:"/meta/subscribe",subscription:e},c=this._mixin(!1,{},r,u);v(c)}return l},this.unsubscribe=function(e,t){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(o())throw"Illegal state: already disconnected";this.removeListener(e);var i=e[0];if(!X(i)){var n={channel:"/meta/unsubscribe",subscription:i},a=this._mixin(!1,{},t,n);v(a)}},this.clearSubscriptions=function(){r()},this.publish=function(e,n,a,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!t(e))throw"Illegal argument type: channel must be a string";if(o())throw"Illegal state: already disconnected";i(n)?(r=n,n=a={}):i(a)&&(r=a,a={});var s={channel:e,data:n,_callback:r},l=this._mixin(!1,{},a,s);v(l)},this.getStatus=function(){return rt},this.isDisconnected=o,this.setBackoffIncrement=function(e){bt.backoffIncrement=e},this.getBackoffIncrement=function(){return bt.backoffIncrement},this.getBackoffPeriod=function(){return ht},this.setLogLevel=function(e){bt.logLevel=e},this.registerExtension=function(e,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!t(e))throw"Illegal argument type: extension name must be a string";for(var a=!1,r=0;r<ft.length;++r){var s=ft[r];if(s.name===e){a=!0;break}}return a?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(ft.push({name:e,extension:n}),this._debug("Registered extension",e),i(n.registered)&&n.registered(e,this),!0)},this.unregisterExtension=function(e){if(!t(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,a=0;a<ft.length;++a){var r=ft[a];if(r.name===e){ft.splice(a,1),n=!0,this._debug("Unregistered extension",e);var s=r.extension;i(s.unregistered)&&s.unregistered();break}}return n},this.getExtension=function(e){for(var t=0;t<ft.length;++t){var i=ft[t];if(i.name===e)return i.extension}return null},this.getName=function(){return it},this.getClientId=function(){return ot},this.getURL=function(){return bt.url},this.getTransport=function(){return J},this.getConfiguration=function(){return this._mixin(!0,{},bt)},this.getAdvice=function(){return this._mixin(!0,{},mt)},org.cometd.WebSocket=window.WebSocket,org.cometd.WebSocket||(org.cometd.WebSocket=window.MozWebSocket)},"function"==typeof define&&define.amd&&define("bundles/framework/bundle/mapwfs2/comp",[],function(){return org.cometd}),function(e){function t(e,t){function i(e,t){if(t)for(var i in t)"content-type"!==i.toLowerCase()&&e.setRequestHeader(i,t[i])}function n(){var n=new t.LongPollingTransport,a=t.Transport.derive(n);return a.xhrSend=function(t){return e.ajax({url:t.url,async:t.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,xhrFields:{withCredentials:!0},beforeSend:function(e){return i(e,t.headers),!0},success:t.onSuccess,error:function(e,i,n){t.onError(i,n)}})},a}function a(){var n=new t.CallbackPollingTransport,a=t.Transport.derive(n);return a.jsonpSend=function(t){e.ajax({url:t.url,async:t.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return i(e,t.headers),!0},success:t.onSuccess,error:function(e,i,n){t.onError(i,n)}})},a}return t.JSON.toJSON=JSON.stringify,t.JSON.fromJSON=JSON.parse,e.Cometd=function(e){var i=new t.Cometd(e);return t.WebSocket&&i.registerTransport("websocket",new t.WebSocketTransport),i.registerTransport("long-polling",new n),i.registerTransport("callback-polling",new a),i},e.cometd=new e.Cometd,e.cometd}t(e,org.cometd)}(jQuery),function(e,t,i){function n(e){return e}function a(e){return decodeURIComponent(e.replace(r," "))}var r=/\+/g,s=e.cookie=function(r,o,l){if(o!==i){if(l=e.extend({},s.defaults,l),null===o&&(l.expires=-1),"number"==typeof l.expires){var u=l.expires,c=l.expires=new Date;c.setDate(c.getDate()+u)}return o=s.json?JSON.stringify(o):String(o),t.cookie=[encodeURIComponent(r),"=",s.raw?o:encodeURIComponent(o),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var d,h=s.raw?n:a,p=t.cookie.split("; "),f=0;d=p[f]&&p[f].split("=");f++)if(h(d.shift())===r){var m=h(d.join("="));return s.json?JSON.parse(m):m}return null};s.defaults={},e.removeCookie=function(t,i){return null!==e.cookie(t)?(e.cookie(t,null,i),!0):!1}}(jQuery,document),define("libraries/jquery/plugins/jquery.cookie",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.service.Connection",function(e,t){this.config=e||{},this.plugin=t,this.cometd=jQuery.cometd,this._connected=!1,this._errorSub=null,this._connectionProblemWaitTime=5e3,"undefined"==typeof this.config.lazy&&(this.config.lazy=!0),this._lazy=this.config.lazy,this._disconnectTime=this.config.disconnectTime||3e4,this._backoffIncrement=this.config.backoffIncrement||1e3,this._maxBackoff=this.config.maxBackoff||6e4,this._maxNetworkDelay=this.config.maxNetworkDelay||1e4,this.browser={},this.getBrowser(),this.cometURL=location.protocol+"//"+this.config.hostname+this.config.port+this.config.contextPath+"/cometd",this.cometd.configure({url:this.cometURL,backoffIncrement:this._backoffIncrement,maxBackoff:this._maxBackoff,maxNetworkDelay:this._maxNetworkDelay});var i=this;this.cometd.addListener("/meta/handshake",function(){i._metaHandshake.apply(i,arguments)}),this.cometd.addListener("/meta/connect",function(){i._metaConnect.apply(i,arguments)}),this._lazy||this.connect(),jQuery(window).unload(function(){i.disconnect()})},{connect:function(){this.cometd.handshake()},disconnect:function(){this.cometd.disconnect(!0)},isConnected:function(){return this._connected},isLazy:function(){return this._lazy},get:function(){return this.cometd},getBrowser:function(){this.browser={name:"",versionNum:""},this.browser.name=jQuery.browser.msie?"msie":jQuery.browser.chrome?"chrome":jQuery.browser.mozilla?"mozilla":jQuery.browser.safari?"safari":"unknown",this.browser.versionNum=parseInt(jQuery.browser.version,10)},updateLazyDisconnect:function(e){if(this.isLazy())if(e)this._disconnectTimer&&(clearTimeout(this._disconnectTimer),this._disconnectTimer=null);else{var t=this;this._disconnectTimer=setTimeout(function(){t.disconnect()},this._disconnectTime)}},_metaConnect:function(e){if(this.cometd.isDisconnected())return void(this._connected=!1);var t=this._connected;if(this._connected=e.successful===!0,!t&&this._connected)this._brokenConnectionTimer&&(clearTimeout(this._brokenConnectionTimer),this._brokenConnectionTimer=null),this.plugin.clearConnectionErrorTriggers();else if(t&&!this._connected){var i=this;this._brokenConnectionTimer=setTimeout(function(){i.plugin.showErrorPopup("connection_broken",null,!0)},this._connectionProblemWaitTime)}},_metaHandshake:function(e){var t=this;e.successful===!0?(this._connectionNotAvailableTimer&&(clearTimeout(this._connectionNotAvailableTimer),this._connectionNotAvailableTimer=null),this.cometd.batch(function(){t._errorSub=t.cometd.subscribe("/error",t.getError),t.plugin.getIO().subscribe(),t.plugin.getIO().startup({clientId:e.clientId,browser:t.browser.name,browserVersion:t.browser.versionNum})})):this._connectionNotAvailableTimer=setTimeout(function(){t.plugin.showErrorPopup("connection_not_available",null,!0)},this._connectionProblemWaitTime)},getError:function(e){var t=e.data.message,i=this.plugin.getSandbox().findMapLayerFromSelectedMapLayers(e.data.layerId),n=e.data.once;this.plugin.showErrorPopup(t,i,n)}}),define("bundles/framework/bundle/mapwfs2/service/Connection",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.service.Mediator",function(e,t){this.config=e,this.plugin=t,this.connection=this.plugin.getConnection(),this.cometd=this.connection.get(),this.layerProperties={},this.rootURL=location.protocol+"//"+this.config.hostname+this.config.port+this.config.contextPath,this.session={session:jQuery.cookie("JSESSIONID")||"",route:jQuery.cookie("ROUTEID")||""},this._previousTimer=null,this._featureUpdateFrequence=200},{getSessionID:function(){return this.session.session},getRootURL:function(){return this.rootURL},subscribe:function(){var e=this,t={"/wfs/properties":function(){e.getWFSProperties.apply(e,arguments)},"/wfs/feature":function(){e.getWFSFeature.apply(e,arguments)},"/wfs/featureGeometries":function(){e.getWFSFeatureGeometries.apply(e,arguments)},"/wfs/mapClick":function(){e.getWFSMapClick.apply(e,arguments)},"/wfs/filter":function(){e.getWFSFilter.apply(e,arguments)},"/wfs/propertyfilter":function(){e.getWFSFilter.apply(e,arguments)},"/wfs/image":function(){e.getWFSImage.apply(e,arguments)},"/wfs/reset":function(){e.resetWFS.apply(e,arguments)}};for(var i in t)this.cometd.subscribe(i,t[i])},startup:function(e){var t=this;e&&(this.session=e),this.session.session=jQuery.cookie("JSESSIONID")||"",this.session.route=jQuery.cookie("ROUTEID")||"";var i,n=this.plugin.getSandbox().findAllSelectedMapLayers(),a={};for(i=0;i<n.length;++i)n[i].hasFeatureData()&&(a[n[i].getId()+""]={styleName:n[i].getCurrentStyle().getName()});var r=this.plugin.getSandbox().getMap().getSrsName(),s=this.plugin.getSandbox().getMap().getExtent(),o=this.plugin.getSandbox().getMap().getZoom(),l=this.plugin.mapModule.getMapScales(),u=this.plugin.getGrid();(null===u||void 0===u)&&(u={});var c=this.plugin.getTileSize();(null===c||void 0===c)&&(c={}),this.cometd.publish("/service/wfs/init",{session:this.session.session,route:this.session.route,language:Oskari.getLang(),browser:this.session.browser,browserVersion:this.session.browserVersion,location:{srs:r,bbox:[s.left,s.bottom,s.right,s.top],zoom:o},grid:u,tileSize:c,mapSize:{width:t.plugin.getSandbox().getMap().getWidth(),height:t.plugin.getSandbox().getMap().getHeight()},mapScales:l,layers:a})}}),Oskari.clazz.category("Oskari.mapframework.bundle.mapwfs2.service.Mediator","getters",{getWFSProperties:function(e){var t=this.plugin.getSandbox().findMapLayerFromSelectedMapLayers(e.data.layerId);if("analysis"!=t.getLayerType()){var i=t.getFields(),n=t.getLocales();i.length>0&&!this.plugin.isArrayEqual(e.data.fields,i)&&!this.plugin.isArrayEqual(e.data.locales,n)&&this.plugin.mapMoveHandler(),t.setFields(e.data.fields),t.setLocales(e.data.locales)}var a=this;this._propertyTimer&&(clearTimeout(this._propertyTimer),this._propertyTimer=null),this._propertyTimer=setTimeout(function(){var e=a.plugin.getSandbox().getEventBuilder("WFSPropertiesEvent")(t);a.plugin.getSandbox().notifyAll(e)},this._featureUpdateFrequence)},getWFSFeature:function(e){var t=this.plugin.getSandbox().findMapLayerFromSelectedMapLayers(e.data.layerId);"empty"!=e.data.feature&&"max"!=e.data.feature&&t.setActiveFeature(e.data.feature);var i=this;this._featureTimer&&(clearTimeout(this._featureTimer),this._featureTimer=null),this._featureTimer=setTimeout(function(){var n=i.plugin.getSandbox().getEventBuilder("WFSFeatureEvent")(t,e.data.feature);i.plugin.getSandbox().notifyAll(n)},this._featureUpdateFrequence)},getWFSMapClick:function(e){var t=this.plugin.getSandbox(),i=t.findMapLayerFromSelectedMapLayers(e.data.layerId),n=e.data.keepPrevious,a=[];if("empty"!=e.data.features){i.setSelectedFeatures([]);for(var r=0;r<e.data.features.length;++r)a.push(e.data.features[r][0])}i.setClickedFeatureIds(n?i.getClickedFeatureIds().concat(a):a);var s=t.getEventBuilder("WFSFeaturesSelectedEvent")(a,i,n);t.notifyAll(s),e.data.lonlat=this.lonlat;var o=t.getEventBuilder("GetInfoResultEvent")(e.data);t.notifyAll(o)},getWFSFeatureGeometries:function(e){var t=this.plugin.getSandbox(),i=t.findMapLayerFromSelectedMapLayers(e.data.layerId),n=e.data.keepPrevious;n?e.data.geometries&&i.addClickedGeometries(e.data.geometries):e.data.geometries&&i.setClickedGeometries(e.data.geometries);var a=t.getEventBuilder("WFSFeatureGeometriesEvent")(i,n);t.notifyAll(a)},getWFSFilter:function(e){var t=this.plugin.getSandbox().findMapLayerFromSelectedMapLayers(e.data.layerId),i=[];if("empty"!=e.data.features){t.setClickedFeatureIds([]);for(var n=0;n<e.data.features.length;++n)i.push(e.data.features[n][0])}t.setSelectedFeatures("empty"!=e.data.features?e.data.features:[]);var a=this.plugin.getSandbox().getEventBuilder("WFSFeaturesSelectedEvent")(i,t,!1);this.plugin.getSandbox().notifyAll(a)},getWFSImage:function(e){var t=this.plugin.getSandbox().findMapLayerFromSelectedMapLayers(e.data.layerId),i="";try{i="undefined"!=typeof e.data.data?"data:image/png;base64,"+e.data.data:this.rootURL+e.data.url+"&session="+this.session.session}catch(n){this.plugin.getSandbox().printDebug(n)}var a=e.data.type,r=e.data.boundaryTile,s=e.data.keepPrevious,o={width:e.data.width,height:e.data.height},l=this.plugin.getSandbox().getEventBuilder("WFSImageEvent")(t,i,e.data.bbox,o,a,r,s);if(this.plugin.getSandbox().notifyAll(l),"normal"==a){this.plugin.setPrintTile(t,e.data.bbox,this.rootURL+e.data.url+"&session="+this.session.session);var u=this.plugin.getSandbox().getEventBuilder("Printout.PrintableContentEvent");if(u){var c=u(this.plugin.getName(),t,this.plugin.getPrintTiles(),null);this.plugin.getSandbox().notifyAll(c)}}},resetWFS:function(){this.startup(null)}}),Oskari.clazz.category("Oskari.mapframework.bundle.mapwfs2.service.Mediator","setters",{addMapLayer:function(e,t){this.connection.isConnected()&&this.cometd.publish("/service/wfs/addMapLayer",{layerId:e,styleName:t})},removeMapLayer:function(e){this.connection.isConnected()&&this.cometd.publish("/service/wfs/removeMapLayer",{layerId:e})},highlightMapLayerFeatures:function(e,t,i,n){this.connection.isConnected()&&this.cometd.publish("/service/wfs/highlightFeatures",{layerId:e,featureIds:t,keepPrevious:i,geomRequest:n})},setLocation:function(e,t,i,n,a,r){this.connection.isConnected()&&this.cometd.publish("/service/wfs/setLocation",{layerId:e,srs:t,bbox:i,zoom:n,grid:a,tiles:r})},setMapSize:function(e,t){this.connection.isConnected()&&this.cometd.publish("/service/wfs/setMapSize",{width:e,height:t})},setMapLayerStyle:function(e,t){this.connection.isConnected()&&this.cometd.publish("/service/wfs/setMapLayerStyle",{layerId:e,styleName:t})},setMapLayerCustomStyle:function(e,t){this.connection.isConnected()&&this.cometd.publish("/service/wfs/setMapLayerCustomStyle",{layerId:e,fill_color:t.area.fillColor,fill_pattern:t.area.fillStyle,border_color:t.area.lineColor,border_linejoin:t.area.lineCorner,border_dasharray:t.area.lineStyle,border_width:t.area.lineWidth,stroke_linecap:t.line.cap,stroke_color:t.line.color,stroke_linejoin:t.line.corner,stroke_dasharray:t.line.style,stroke_width:t.line.width,dot_color:t.dot.color,dot_shape:t.dot.shape,dot_size:t.dot.size})},setMapClick:function(e,t,i){this.connection.isConnected()&&(this.lonlat=e,this.cometd.publish("/service/wfs/setMapClick",{longitude:e.lon,latitude:e.lat,keepPrevious:t,geomRequest:i}))},setFilter:function(e){filter={geojson:e},this.connection.isConnected()&&this.cometd.publish("/service/wfs/setFilter",{filter:filter})},setPropertyFilter:function(e,t){filter={filters:e,layer_id:t},this.connection.isConnected()&&this.cometd.publish("/service/wfs/setPropertyFilter",{filter:filter})},setMapLayerVisibility:function(e,t){this.connection.isConnected()&&this.cometd.publish("/service/wfs/setMapLayerVisibility",{layerId:e,visible:t})}}),define("bundles/framework/bundle/mapwfs2/service/Mediator",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.plugin.QueuedTilesGrid",function(e){this.grid=[],this.map=null,this.tileSize=null,this.maxExtent=null,this.buffer=0,this.numLoadingTiles=0;var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},{destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],n=0,a=i.length;a>n;n++){var r=i[n];r.destroy()}this.grid=[]}},moveTo:function(e,t){if(e=e||this.map.getExtent(),null!==e&&void 0!==e){var i=!this.grid.length||t,n=this.getTilesBounds();i||!n.containsBounds(e,!0)?this.initGriddedTiles(e):this.moveGriddedTiles(e)}},setTileSize:function(){},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,i=this.grid[t][0],n=this.grid[0].length-1,a=this.grid[0][n];e=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,a.bounds.right,a.bounds.top)}return e},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.left,s=Math.floor(r/n)-this.buffer,o=r/n-s,l=-o*this.tileSize.w,u=t.left+s*n,c=e.top-(t.bottom+a),d=Math.ceil(c/a)+this.buffer,h=d-c/a,p=-h*this.tileSize.h,f=t.bottom+d*a;return{tilelon:n,tilelat:a,tileoffsetlon:u,tileoffsetlat:f,tileoffsetx:l,tileoffsety:p}},initGriddedTiles:function(e){var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),n=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),a=this.maxExtent,r=this.map.getResolution(),s=this.calculateGridLayout(e,a,r),o=Math.round(s.tileoffsetx),l=Math.round(s.tileoffsety),u=s.tileoffsetlon,c=s.tileoffsetlat,d=s.tilelon,h=s.tilelat;this.origin=new OpenLayers.Pixel(o,l);var p=o,f=u,m=0,g=parseInt(this.map.layerContainerDiv.style.left,10),v=parseInt(this.map.layerContainerDiv.style.top,10);do{var y=this.grid[m++];y||(y=[],this.grid.push(y)),u=f,o=p;var b=0;do{var k=new OpenLayers.Bounds(u,c,u+d,c+h),_=o;_-=g;var w=l;w-=v;var L=new OpenLayers.Pixel(_,w),x=y[b++];x?x.moveTo(k,L,!1):(x=this.addTile(k,L),y.push(x)),u+=d,o+=this.tileSize.w}while(u<=e.right+d*this.buffer||n>b);c-=h,l+=this.tileSize.h}while(c>=e.bottom-h*this.buffer||i>m);this.removeExcessTiles(m,b)},addTile:function(e,t){return new OpenLayers.Tile(this.layer,e,t,"",this.tileSize)},moveGriddedTiles:function(){for(var e=this.buffer||1;;){var t=this.grid[0][0].position,i=this.map.getViewPortPxFromLayerPx(t);if(i.x>-this.tileSize.w*(e-1))this.shiftColumn(!0);else if(i.x<-this.tileSize.w*e)this.shiftColumn(!1);else if(i.y>-this.tileSize.h*(e-1))this.shiftRow(!0);else{if(!(i.y<-this.tileSize.h*e))break;this.shiftRow(!1)}}},shiftRow:function(e){var t,i,n,a,r,s=e?0:this.grid.length-1,o=this.grid,l=o[s],u=this.map.getResolution(),c=e?-this.tileSize.h:this.tileSize.h,d=u*-c,h=e?o.pop():o.shift();for(t=0,i=l.length;i>t;t++)n=l[t],a=n.bounds.clone(),r=n.position.clone(),a.bottom=a.bottom+d,a.top=a.top+d,r.y=r.y+c,h[t].moveTo(a,r);e?o.unshift(h):o.push(h)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.map.getResolution(),n=i*t,a=0,r=this.grid.length;r>a;a++){var s=this.grid[a],o=e?0:s.length-1,l=s[o],u=l.bounds.clone(),c=l.position.clone();u.left=u.left+n,u.right=u.right+n,c.x=c.x+t;var d=e?this.grid[a].pop():this.grid[a].shift();d.moveTo(u,c),e?s.unshift(d):s.push(d)}},removeExcessTiles:function(e,t){for(var i,n,a,r;this.grid.length>e;)for(a=this.grid.pop(),i=0,n=a.length;n>i;i++)r=a[i],r.destroy();for(;this.grid[0].length>t;)for(i=0,n=this.grid.length;n>i;i++)a=this.grid[i],r=a.pop(),r.destroy()},onMapResize:function(){},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesGrid"}),define("bundles/framework/bundle/mapwfs2/plugin/QueuedTilesGrid",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.plugin.QueuedTilesStrategy",function(e){this.debugGridFeatures=!0,this.options=e,this.tileQueue=e.tileQueue,this.autoActivate=!0,this.autoDestroy=!1,this.grid=null,this.bounds=null;var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.active=!1},{getGrid:function(){return this.grid},setLayer:function(e){this.layer=e},flushTileQueue:function(){for(var e=this.tileQueue.queue,t=[],i=0;i<e.length;i++)null!==e[i].tileFeature&&void 0!==e[i].tileFeature&&(t.push(e[i].tileFeature),e[i].tileFeature=null);t.length>0&&this.layer.destroyFeatures(t),this.tileQueue.flushQueue()},unloadOutOfViewFeatures:function(){},ratio:1,activate:function(){return this.active?!1:(this.active=!0,this.grid=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.plugin.QueuedTilesGrid",{map:this.layer.map,layer:this.layer,maxExtent:this.layer.map.getMaxExtent(),tileSize:this.layer.map.getTileSize()}),this.layer.events.on({refresh:this.updateRefresh,scope:this}),!0)},deactivate:function(){return this.active?(this.layer.events.un({refresh:this.update,scope:this}),this.grid.destroy(),this.grid=null,!0):!1},updateRefresh:function(){this.update()},updateMoveEnd:function(){this.update()},update:function(){var e=this.layer.map.getExtent();this.grid.moveTo(e,!0),this.flushTileQueue();var t=this.layer.map.getZoom();t<this.minZoom||this.triggerRead()},invalidBounds:function(e){return e||(e=this.layer.map.getExtent()),!this.bounds||!this.bounds.containsBounds(e)},triggerUnload:function(){this.layer.destroyFeatures()},triggerRead:function(){for(var e=this.grid.grid,t=[],i=this.debugGridFeatures,n=0;n<e.length;n++)for(var a=0;a<e[n].length;a++){var r=e[n][a].bounds.clone(),s={left:r.left,top:r.top,right:r.right,bottom:r.bottom},o=null;if(i){var l=new OpenLayers.Geometry.Point(r.left,r.bottom),u=new OpenLayers.Geometry.Point(r.right,r.top),c=new OpenLayers.Geometry.Point(r.left,r.top),d=new OpenLayers.Geometry.Point(r.right,r.bottom),h=new OpenLayers.Geometry.LineString([l,d,u,c,l]);o=new OpenLayers.Feature.Vector(h,{featureClassName:this.CLASS_NAME,description:""}),o.renderIntent="tile",t.push(o)
}var p=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.domain.QueuedTile",{bounds:s,tileFeature:o});this.tileQueue.pushJob(p)}i&&this.layer.addFeatures(t)},merge:function(e){var t=e.features;t&&t.length>0&&this.layer.addFeatures(t)},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesStrategy"}),define("bundles/framework/bundle/mapwfs2/plugin/QueuedTilesStrategy",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.plugin.TileCache",function(){this.data={},this.ts={}},{mget:function(e,t,i){var n=this.data[e];if(n){var a=n[t];if(a)return a[i]}},mput:function(e,t,i,n){var a=this.data[e];a||(a={},this.data[e]=a);var r=a[t];r||(r={},a[t]=r),r[i]=n;var s=this.ts[e];s||(s={},this.ts[e]=s);var o=s[t];o||(o={},s[t]=o),o[i]=(new Date).getTime()},mdel:function(e,t,i){var n=this.data[e];if(n){var a=n[t];if(a){if(null===i||void 0===i)return a=void 0,void delete n[t];var r=a[i];r&&(r=void 0,delete a[i])}}},purgeOffset:function(e){var t=(new Date).getTime()-e;for(var i in this.data)for(var n in this.data[i])for(var a in this.data[i][n])this.ts[i][n][a]<t&&(delete this.data[i][n][a],delete this.ts[i][n][a])}}),define("bundles/framework/bundle/mapwfs2/plugin/TileCache",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.plugin.WfsLayerPlugin",function(e){this.config=e||{},this._sandbox=null,this._map=null,this.mapModule=null,this.pluginName=null,this._connection=null,this._io=null,this.tileSize=null,this.zoomLevel=null,this._isWFSOpen=0,this._printTiles={},this._tiles={},this._tilesToUpdate=null,this._tileData=null,this._tileDataTemp=null,this._highlighted=!0,this.errorTriggers={connection_not_available:{limit:1,count:0},connection_broken:{limit:1,count:0}},this.activeHighlightLayers=[]},{__name:"WfsLayerPlugin",__layerPrefix:"wfs_layer_",__typeHighlight:"highlight",__typeNormal:"normal",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},init:function(){var e=(this.config?this.config.sandbox:null)||"sandbox",t=Oskari.getSandbox(e);this._sandbox=t,this.config&&(this.config.hostname&&"localhost"!==this.config.hostname||(this.config.hostname=location.hostname),this.config.port||(this.config.port=""+location.port),this.config.port.length>0&&(this.config.port=":"+this.config.port),this.config.contextPath||(this.config.contextPath="/transport")),this._connection=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.service.Connection",this.config,this),this._io=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.service.Mediator",this.config,this);var i=t.getService("Oskari.mapframework.service.MapLayerService");if(i){i.registerLayerModel("wfslayer","Oskari.mapframework.bundle.mapwfs2.domain.WFSLayer");var n=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.domain.WfsLayerModelBuilder",t);i.registerLayerModelBuilder("wfslayer",n)}this._tilesToUpdate=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.plugin.TileCache"),this._tileData=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.plugin.TileCache"),this._tileDataTemp=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.plugin.TileCache"),this._visualizationForm=Oskari.clazz.create("Oskari.userinterface.component.VisualizationForm")},register:function(){this.getMapModule().setLayerPlugin("wfslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wfslayer",null)},startPlugin:function(e){this._map=this.getMapModule().getMap(),this.createTilesGrid(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this.requestHandlers={showOwnStyleHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.request.ShowOwnStyleRequestHandler",this),activateHighlightHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.request.ActivateHighlightRequestHandler",this)},e.addRequestHandler("ShowOwnStyleRequest",this.requestHandlers.showOwnStyleHandler),e.addRequestHandler("WfsLayerPlugin.ActivateHighlightRequest",this.requestHandlers.activateHighlightHandler)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null},start:function(){},stop:function(){},getSandbox:function(){return this._sandbox},getConnection:function(){return this._connection},getIO:function(){return this._io},getVisualizationForm:function(){return this._visualizationForm},eventHandlers:{AfterMapMoveEvent:function(){return this.config&&this.config.deferSetLocation?void this.getSandbox().printDebug("setLocation deferred (to aftermapmove)"):void this.mapMoveHandler()},AfterMapLayerAddEvent:function(e){this.mapLayerAddHandler(e)},AfterMapLayerRemoveEvent:function(e){this.mapLayerRemoveHandler(e)},WFSFeaturesSelectedEvent:function(e){this.featuresSelectedHandler(e)},MapClickedEvent:function(e){this.mapClickedHandler(e)},AfterChangeMapLayerStyleEvent:function(e){this.changeMapLayerStyleHandler(e)},MapLayerVisibilityChangedEvent:function(e){this.mapLayerVisibilityChangedHandler(e),e.getMapLayer().hasFeatureData()&&this.config&&this.config.deferSetLocation&&(this.getSandbox().printDebug("sending deferred setLocation"),this.mapMoveHandler())},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},MapSizeChangedEvent:function(e){this.mapSizeChangedHandler(e)},WFSSetFilter:function(e){this.setFilterHandler(e)},WFSSetPropertyFilter:function(e){this.setPropertyFilterHandler(e)},WFSImageEvent:function(e){this.drawImageTile(e.getLayer(),e.getImageUrl(),e.getBBOX(),e.getSize(),e.getLayerType(),e.isBoundaryTile(),e.isKeepPrevious())}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},mapMoveHandler:function(){var e,t=this.getSandbox().getMap().getSrsName(),i=this.getSandbox().getMap().getExtent(),n=this.getSandbox().getMap().getZoom(),a=!1;this._printTiles={};var r=this.getGrid();this.refreshCaches();var s,o=this.getSandbox().findAllSelectedMapLayers();for(s=0;s<o.length;++s)if(o[s].hasFeatureData()&&(o[s].setActiveFeatures([]),null!==r&&void 0!==r)){var l=o[s].getId(),u=this.getNonCachedGrid(l,r);this.getIO().setLocation(l,t,[i.left,i.bottom,i.right,i.top],n,r,u),this._tilesLayer.redraw()}if(this.zoomLevel!==n){this.zoomLevel=n;for(var c=0;c<this.activeHighlightLayers.length;++c)(this.getConnection().isLazy()&&!this.getConnection().isConnected()||!this.getSandbox().findMapLayerFromSelectedMapLayers(this.activeHighlightLayers[c].getId()))&&(t=this.getSandbox().getMap().getSrsName(),i=this.getSandbox().getMap().getExtent(),n=this.getSandbox().getMap().getZoom(),e=this.activeHighlightLayers[c].getClickedFeatureListIds(),this.removeHighlightImages(this.activeHighlightLayers[c]),this.getHighlightImage(this.activeHighlightLayers[c],t,[i.left,i.bottom,i.right,i.top],n,e));for(var d=0;d<o.length;++d)o[d].hasFeatureData()&&(e=this.getAllFeatureIds(o[d]),this.removeHighlightImages(o[d]),this._highlighted&&this.getIO().highlightMapLayerFeatures(o[d].getId(),e,!1,a))}},mapLayerAddHandler:function(e){if(e.getMapLayer().hasFeatureData()){this.getConnection().isLazy()&&!this.getConnection().isConnected()&&this.getConnection().connect(),this._isWFSOpen++,this.getConnection().updateLazyDisconnect(this.isWFSOpen());var t=null;e.getMapLayer().getCurrentStyle()&&(t=e.getMapLayer().getCurrentStyle().getName()),(null===t||void 0===t||""===t)&&(t="default"),this._addMapLayerToMap(e.getMapLayer(),this.__typeNormal);var i=this;this.getConnection().get().batch(function(){i.getIO().addMapLayer(e.getMapLayer().getId(),t),i.mapMoveHandler()})}},mapLayerRemoveHandler:function(e){var t=e.getMapLayer();t.hasFeatureData()&&(this._isWFSOpen--,this.getConnection().updateLazyDisconnect(this.isWFSOpen()),this.getIO().removeMapLayer(t.getId()),this.removeMapLayerFromMap(t),this._printTiles[t.getId()]=[],delete this.errorTriggers["wfs_no_permissions_"+t.getId()],delete this.errorTriggers["wfs_configuring_layer_failed_"+t.getId()],delete this.errorTriggers["wfs_request_failed_"+t.getId()],delete this.errorTriggers["features_parsing_failed_"+t.getId()])},featuresSelectedHandler:function(e){if(e.getMapLayer().hasFeatureData()){var t,i,n,a=e.getMapLayer(),r=a.getClickedFeatureListIds(),s=e.getWfsFeatureIds(),o=!0;if(e.isKeepSelection())for(t=!1,i=0;i<s.length;++i){for(t=!1,n=0;n<r.length;++n)s[i]!==r[n]||(t=!0);t||r.push(s[i])}else a.setClickedFeatureListIds(e.getWfsFeatureIds());if(e.isKeepSelection()||this.removeHighlightImages(),this.getConnection().isLazy()&&!this.getConnection().isConnected()||!this.getSandbox().findMapLayerFromSelectedMapLayers(a.getId())){var l=this.getSandbox().getMap().getSrsName(),u=this.getSandbox().getMap().getExtent(),c=this.getSandbox().getMap().getZoom();a.setClickedFeatureListIds(e.getWfsFeatureIds()),this.getHighlightImage(a,l,[u.left,u.bottom,u.right,u.top],c,e.getWfsFeatureIds())}this._highlighted&&this.getIO().highlightMapLayerFeatures(a.getId(),e.getWfsFeatureIds(),e.isKeepSelection(),o)}},mapClickedHandler:function(e){if(!this.getSandbox().getMap().isMoving()){var t=e.getLonLat(),i=this.getSandbox().isCtrlKeyDown();this.getIO().setMapClick(t,i)}},changeMapLayerStyleHandler:function(e){if(e.getMapLayer().hasFeatureData()){var t=this.getOLMapLayer(e.getMapLayer(),this.__typeNormal);t.redraw(),this.getIO().setMapLayerStyle(e.getMapLayer().getId(),e.getMapLayer().getCurrentStyle().getName())}},mapLayerVisibilityChangedHandler:function(e){e.getMapLayer().hasFeatureData()&&this.getIO().setMapLayerVisibility(e.getMapLayer().getId(),e.getMapLayer().isVisible())},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.hasFeatureData())for(var i=this.getOLMapLayers(t),n=0;n<i.length;n++)i[n].setOpacity(t.getOpacity()/100)},mapSizeChangedHandler:function(e){this.getIO().setMapSize(e.getWidth(),e.getHeight());var t=this.getSandbox().getMap().getSrsName(),i=this.getSandbox().getMap().getExtent(),n=this.getSandbox().getMap().getZoom(),a=this.getGrid();this.refreshCaches();for(var r=this.getSandbox().findAllSelectedMapLayers(),s=0;s<r.length;++s)if(r[s].hasFeatureData()&&(r[s].setActiveFeatures([]),null!==a&&void 0!==a)){var o=r[s].getId(),l=this.getNonCachedGrid(o,a);this.getIO().setLocation(o,t,[i.left,i.bottom,i.right,i.top],n,a,l),this._tilesLayer.redraw()}},setFilterHandler:function(e){for(var t=this.getSandbox().findAllSelectedMapLayers(),i=0;i<t.length;++i)t[i].hasFeatureData()&&t[i].setSelectedFeatures([]);this.getIO().setFilter(e.getGeoJson())},setPropertyFilterHandler:function(e){for(var t=this.getSandbox().findAllSelectedMapLayers(),i=0;i<t.length;++i)t[i].hasFeatureData()&&t[i].getId()===e.getLayerId()&&t[i].setSelectedFeatures([]);this.getIO().setPropertyFilter(e.getFilters(),e.getLayerId())},setCustomStyle:function(e,t){this.getIO().setMapLayerCustomStyle(e,t)},clearConnectionErrorTriggers:function(){this.errorTriggers.connection_not_available={limit:1,count:0},this.errorTriggers.connection_broken={limit:1,count:0}},preselectLayers:function(e){_.each(e,function(e){e.hasFeatureData()&&this.getSandbox().printDebug("[WfsLayerPlugin] preselecting "+e.getId())})},removeHighlightImages:function(e){if(!e||e.hasFeatureData()){var t="(.*)";e&&(t=e.getId());var i,n,a=new RegExp(this.__layerPrefix+t+"_"+this.__typeHighlight),r=this._map.getLayersByName(a);for(i=0;i<r.length;i++)n=this._map.getLayerIndex(r[i]),r[i].destroy()}},removeMapLayerFromMap:function(e){for(var t=this.getOLMapLayers(e),i=0;i<t.length;i++)t[i].destroy()},getOLMapLayers:function(e){if(!e||e.hasFeatureData()){var t="";e&&(t=e.getId());var i=new RegExp(this.__layerPrefix+t+"_(.*)","i");return this._map.getLayersByName(i)}},getOLMapLayer:function(e,t){if(!e||!e.hasFeatureData())return null;var i=this.__layerPrefix+e.getId()+"_"+t,n=new RegExp(i);return this._map.getLayersByName(n)[0]},drawImageTile:function(e,t,i,n,a,r){var s=this.__layerPrefix+e.getId()+"_"+a,o=new OpenLayers.Bounds(i);if(t&&e&&o){var l=null;if(a===this.__typeHighlight){var u=new OpenLayers.Size(n.width,n.height),c=this.mapModule.calculateLayerScales(e.getMaxScale(),e.getMinScale()),d=new OpenLayers.Layer.Image(s,t,o,u,{scales:c,transparent:!0,format:"image/png",isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:!0,buffer:0});d.opacity=e.getOpacity()/100,this._map.addLayer(d),d.setVisibility(!0),d.redraw(!0),null!==l&&null!==d&&this._map.setLayerIndex(d,l);var h=new RegExp(this.__layerPrefix+e.getId()+"_"+this.__typeNormal),p=new RegExp(this.__layerPrefix+e.getId()+"_"+this.__typeHighlight),f=this._map.getLayersByName(h),m=this._map.getLayersByName(p);if(f.length>0&&m.length>0){var g=this._map.getLayerIndex(f[f.length-1]);this._map.setLayerIndex(m[0],g+10)}}else{var v=o.toArray(!1),y=v.join(","),b=e.getCurrentStyle().getName(),k=this._tilesToUpdate.mget(e.getId(),"",y);if(r){var _=this._tileDataTemp.mget(e.getId(),b,y);if(_)return;this._tileDataTemp.mput(e.getId(),b,y,t)}else this._tileData.mput(e.getId(),b,y,t);k&&k.draw()}}},_addMapLayerToMap:function(e,t){if(e.hasFeatureData()){var i,n=this.__layerPrefix+e.getId()+"_"+t,a=this.getMapModule().calculateLayerScales(e.getMaxScale(),e.getMinScale()),r={layers:"",transparent:!0,id:e.getId(),styles:e.getCurrentStyle().getName(),format:"image/png"},s={layerId:e.getId(),scales:a,isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0,_plugin:this,getURL:function(e,t){e=this.adjustBounds(e);var i=e.toArray(!1),n=i.join(","),a=this._plugin.getSandbox().findMapLayerFromSelectedMapLayers(this.layerId),r=a.getCurrentStyle().getName(),s=this._plugin._tileData.mget(this.layerId,r,n);return s?this._plugin._tilesToUpdate.mdel(this.layerId,"",n):(s=this._plugin._tileDataTemp.mget(this.layerId,r,n),this._plugin._tilesToUpdate.mput(this.layerId,"",n,t)),s},addTile:function(e,t){var i=OpenLayers.Util.extend({},this.tileOptions);OpenLayers.Util.extend(i,{setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},renderTile:function(){if(this.layer.div.appendChild(this.getTile()),this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e===this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds,this),this.initImage()}});var n=new this.tileClass(this,t,e,null,this.tileSize,i);this._plugin._tiles[n.id]=n;{var a=e.toArray(!1),r=a.join(","),s=this._plugin.getSandbox().findMapLayerFromSelectedMapLayers(this.layerId);s.getCurrentStyle().getName()}return this._plugin._tilesToUpdate.mput(this.layerId,"",r,n),n.events.register("beforedraw",this,this.queueTileDraw),n},destroyTile:function(e){this.removeTileMonitoringHooks(e),delete this._plugin._tiles[e.id],e.destroy()}},o=e.getParams(),l=e.getOptions();for(i in o)r[i]=o[i];for(i in l)s[i]=l[i];var u=new OpenLayers.Layer.WMS(n,"",r,s);u.opacity=e.getOpacity()/100,this._map.addLayer(u)}},createTilesGrid:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.domain.TileQueue"),t=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs2.plugin.QueuedTilesStrategy",{tileQueue:e});t.debugGridFeatures=!1,this.tileQueue=e,this.tileStrategy=t;var i=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:3,strokeColor:"red",strokeWidth:2,fillColor:"#800000"}),tile:new OpenLayers.Style({strokeColor:"#008080",strokeWidth:5,fillColor:"#ffcc66",fillOpacity:.5}),select:new OpenLayers.Style({fillColor:"#66ccff",strokeColor:"#3399ff"})});this._tilesLayer=new OpenLayers.Layer.Vector("Tiles Layer",{strategies:[t],styleMap:i,visibility:!0}),this._map.addLayer(this._tilesLayer),this._tilesLayer.setOpacity(.3)},getTileSize:function(){var e=this.tileStrategy.getGrid().grid;return this.tileSize=null,e&&(this.tileSize={},this.tileSize.width=e[0][0].size.w,this.tileSize.height=e[0][0].size.h),this.tileSize},getGrid:function(){var e=null;this.tileStrategy.update();var t=this.tileStrategy.getGrid().grid;if(t){e={rows:t.length,columns:t[0].length,bounds:[]};for(var i=0,n=t.length;n>i;i++)for(var a=t[i],r=0,s=a.length;s>r;r++){var o=a[r];if("undefined"==typeof o.bounds.left||"undefined"==typeof o.bounds.bottom||"undefined"==typeof o.bounds.right||"undefined"==typeof o.bounds.top)return null;var l=[];l[0]=o.bounds.left,l[1]=o.bounds.bottom,l[2]=o.bounds.right,l[3]=o.bounds.top,e.bounds.push(l)}}return e},getPrintTiles:function(){return this._printTiles},setPrintTile:function(e,t,i){"undefined"==typeof this._printTiles[e.getId()]&&(this._printTiles[e.getId()]=[]),this._printTiles[e.getId()].push({bbox:t,url:i})},refreshCaches:function(){this._tileData.purgeOffset(24e4),this._tileDataTemp.purgeOffset(24e4)},getNonCachedGrid:function(e,t){var i,n,a,r=this.getSandbox().findMapLayerFromSelectedMapLayers(e),s=r.getCurrentStyle().getName(),o=[];for(i=0;i<t.bounds.length;i++)n=t.bounds[i].join(","),a=this._tileData.mget(e,s,n),a||o.push(t.bounds[i]);return o},deleteTileCache:function(e,t){this._tileData.mdel(e,t),this._tileDataTemp.mdel(e,t)},isWFSOpen:function(){return this._isWFSOpen>0?!0:!1},getLayerCount:function(){return this._isWFSOpen},isArrayEqual:function(e,t){if(t.length!==e.length)return!1;var i;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization("MapWfs2")),e?this._localization[e]:this._localization},showErrorPopup:function(e,t,i){if(i)if(this.errorTriggers[e]){if(this.errorTriggers[e].count>=this.errorTriggers[e].limit)return;this.errorTriggers[e].count++}else{if(this.errorTriggers[e+"_"+t.getId()])return;this.errorTriggers[e+"_"+t.getId()]=!0}var n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=this.getLocalization("error").title,r=this.getLocalization("error")[e];t&&(r=r.replace(/\{layer\}/,t.getName()));var s=n.createCloseButton(this.getLocalization().button.close);s.addClass("primary"),n.addClass("error_handling"),n.show(a,r,[s]),n.fadeout(5e3)},getAllFeatureIds:function(e){var t,i=e.getClickedFeatureIds().slice(0);for(t=0;t<e.getSelectedFeatures().length;++t)i.push(e.getSelectedFeatures()[t][0]);return i},getHighlightImage:function(e,t,i,n,a){var r=function(e,t){var i;for(i=0;i<e.length;i++)if(e[i]==t)return!0;return!1};r(this.activeHighlightLayers,e)||this.activeHighlightLayers.push(e);var s={width:this.getSandbox().getMap().getWidth(),height:this.getSandbox().getMap().getHeight()},o="?layerId="+e.getId()+"&session="+this.getIO().getSessionID()+"&type=highlight&srs="+t+"&bbox="+i.join(",")+"&zoom="+n+"&featureIds="+a.join(",")+"&width="+s.width+"&height="+s.height,l=this.getIO().getRootURL()+"/image"+o,u=this.getSandbox().getEventBuilder("WFSImageEvent")(e,l,i,s,"highlight",!1,!1);this.getSandbox().notifyAll(u)},setHighlighted:function(e){this._highlighted=e}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapwfs2/plugin/WfsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.event.WFSFeatureEvent",function(e,t){this._layer=e,this._feature=t},{__name:"WFSFeatureEvent",getName:function(){return this.__name},getLayer:function(){return this._layer},getFeature:function(){return this._feature}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapwfs2/event/WFSFeatureEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.event.WFSFeaturesSelectedEvent",function(e,t,i){this._wfsFeatureIds=e,this._addToSelection=i,this._mapLayer=t},{__name:"WFSFeaturesSelectedEvent",getName:function(){return this.__name},getWfsFeatureIds:function(){return this._wfsFeatureIds},isKeepSelection:function(){return this._addToSelection?this._addToSelection:!1},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapwfs2/event/WFSFeaturesSelectedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.event.WFSFeatureGeometriesEvent",function(e,t){this._addToSelection=t,this._mapLayer=e},{__name:"WFSFeatureGeometriesEvent",getName:function(){return this.__name},isKeepSelection:function(){return this._addToSelection?this._addToSelection:!1},getMapLayer:function(){return this._mapLayer},getGeometries:function(){return this._mapLayer.getClickedGeometries()}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapwfs2/event/WFSFeatureGeometriesEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.event.WFSImageEvent",function(e,t,i,n,a,r,s){this._layer=e,this._imageUrl=t,this._bbox=i,this._size=n,this._layerType=a,this._boundaryTile=r,this._keepPrevious=s},{__name:"WFSImageEvent",getName:function(){return this.__name},getLayer:function(){return this._layer},getImageUrl:function(){return this._imageUrl},getBBOX:function(){return this._bbox},getSize:function(){return this._size},getLayerType:function(){return this._layerType},isBoundaryTile:function(){return this._boundaryTile},isKeepPrevious:function(){return this._keepPrevious}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapwfs2/event/WFSImageEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.event.WFSPropertiesEvent",function(e,t,i){this._layer=e,this._locales=t,this._fields=i},{__name:"WFSPropertiesEvent",getName:function(){return this.__name},getLayer:function(){return this._layer},getLocales:function(){return this._locales},getFields:function(){return this._fields}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapwfs2/event/WFSPropertiesEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.request.ShowOwnStyleRequest",function(e){this._id=e},{__name:"ShowOwnStyleRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapwfs2/request/ShowOwnStyleRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.request.ShowOwnStyleRequestHandler",function(e){this.plugin=e,this.localization=e.getLocalization("popup"),this.visualizationForm=this.plugin.getVisualizationForm(),this.template={};var t;for(t in this.__templates)this.__templates.hasOwnProperty(t)&&(this.template[t]=jQuery(this.__templates[t]))},{__templates:{wrapper:"<div></div>",toolsButton:'<div style= "display: inline-block; border: 1px solid;"></div>',link:'<div class="link"><a href="javascript:void(0);"></a></div></div>'},handleRequest:function(e,t){var i=t.getId(),n=this.plugin.getSandbox().findMapLayerFromSelectedMapLayers(i),a=n.getCustomStyle();a&&this.visualizationForm.setValues(a);var r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=this.localization.title,o=this.template.wrapper.clone();o.append(this.visualizationForm.getForm());var l=this,u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.setTitle(this.localization.button.save),u.addClass("primary saveOwnStyle"),u.setHandler(function(){var e="oskari_custom";l.plugin.deleteTileCache(i,e);var t=l.visualizationForm.getValues();n.setCustomStyle(t),l.plugin.setCustomStyle(i,t),n.selectStyle(e);var a=l.plugin.getSandbox().getEventBuilder("MapLayerEvent")(i,"update");l.plugin.getSandbox().notifyAll(a),r.close()});var c=Oskari.clazz.create("Oskari.userinterface.component.Button");c.setTitle(this.localization.button.cancel),c.setHandler(function(){r.close()}),r.addClass("wfs_own_style"),r.show(s,o,[c,u])}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapwfs2/request/ShowOwnStyleRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.request.ActivateHighlightRequest",function(e){this._enabled=e},{__name:"WfsLayerPlugin.ActivateHighlightRequest",getName:function(){return this.__name},isEnabled:function(){return this._enabled}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapwfs2/request/ActivateHighlightRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.request.ActivateHighlightRequestHandler",function(e){this.plugin=e},{handleRequest:function(e,t){var i=t.isEnabled();this.plugin.setHighlighted(i),i||this.plugin.removeHighlightImages()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapwfs2/request/ActivateHighlightRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.domain.QueuedTile",function(e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},{getBounds:function(){return this.bounds}}),define("bundles/framework/bundle/mapwfs2/domain/QueuedTile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.domain.TileQueue",function(){this.queue=[]},{getQueue:function(){return this.queue},getLength:function(){return this.queue.length},popJob:function(){var e=this.queue,t=e.length;if(0===t)return null;if(4>t)return e.shift(-1);var i=null,n=Math.floor(t/2);return i=e[n],this.queue=e.slice(0,n).concat(e.slice(n+1)),i},pushJob:function(e){this.queue.push(e)},flushQueue:function(){this.queue=[]}}),define("bundles/framework/bundle/mapwfs2/domain/TileQueue",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.domain.WFSLayer",function(){this._layerType="WFS",this._featureData=!0,this._fields=[],this._locales=[],this._activeFeatures=[],this._selectedFeatures=[],this._clickedFeatureIds=[],this._clickedFeatureListIds=[],this._clickedGeometries=[],this._propertyTypes={},this._wpsLayerParams={},this._styles=[],this._customStyle=null,this._filterJson=null,this.localization=Oskari.getLocalization("MapWfs2")},{getFields:function(){return this._fields},setFields:function(e){this._fields=e},getLocales:function(){return this._locales},setLocales:function(e){this._locales=e},getActiveFeatures:function(){return this._activeFeatures},setActiveFeature:function(e){this._activeFeatures.push(e)},setActiveFeatures:function(e){this._activeFeatures=e},getSelectedFeatures:function(){return this._selectedFeatures},setSelectedFeature:function(e){this._selectedFeatures.push(e)},setSelectedFeatures:function(e){this._selectedFeatures=e},getClickedFeatureIds:function(){return this._clickedFeatureIds},setClickedFeatureId:function(e){this._clickedFeatureIds.push(e)},setClickedFeatureIds:function(e){this._clickedFeatureIds=e},getClickedFeatureListIds:function(){return this._clickedFeatureListIds},setClickedFeatureListId:function(e){this._clickedFeatureListIds.push(e)},setClickedFeatureListIds:function(e){this._clickedFeatureListIds=e},getClickedGeometries:function(){return this._clickedGeometries},setClickedGeometries:function(e){this._clickedGeometries=e},addClickedGeometries:function(e){for(var t=0;t<e.length;++t)this._clickedGeometries.push(e[t])},setPropertyTypes:function(e){this._propertyTypes=e},getPropertyTypes:function(){return this._propertyTypes},setWpsLayerParams:function(e){this._wpsLayerParams=e},getWpsLayerParams:function(){return this._wpsLayerParams},getFilterJson:function(){return this._filterJson},setFilterJson:function(e){this._filterJson=e},getLegendImage:function(){return null},setCustomStyle:function(e){this._customStyle=e},getCustomStyle:function(){return this._customStyle},getStyles:function(){if(this.getCustomStyle()){var e=this.localization["own-style"],t=Oskari.clazz.create("Oskari.mapframework.domain.Style");return t.setName("oskari_custom"),t.setTitle(e),t.setLegend(""),this._styles.concat([t])}return this._styles}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/framework/bundle/mapwfs2/domain/WFSLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs2.domain.WfsLayerModelBuilder",function(e){this.localization=Oskari.getLocalization("MapWfs2"),this.sandbox=e},{parseLayerData:function(e,t,i){var n=this,a=Oskari.clazz.builder("Oskari.mapframework.domain.Tool");if(e.isLayerOfType("WFS")){var r=this.localization["own-style"],s=a();s.setName("ownStyle"),s.setTitle(r),s.setTooltip(r),s.setCallback(function(){n.sandbox.postRequestByName("ShowOwnStyleRequest",[e.getId()])}),e.addTool(s)}var o=this.localization["object-data"],l=a();l.setName("objectData"),l.setTitle(o),l.setTooltip(o),l.setCallback(function(){n.sandbox.postRequestByName("ShowFeatureDataRequest",[e.getId()])}),e.addTool(l);var u,c=this.localization["default-style"],d=Oskari.clazz.create("Oskari.mapframework.domain.Style");if(d.setName("default"),d.setTitle(c),d.setLegend(""),t.styles&&t.styles.length>0)for(u=0;u<t.styles.length;u++)if("default"===t.styles[u].name){t.styles[u].title=c;break}i.populateStyles(e,t,d)}}),define("bundles/framework/bundle/mapwfs2/domain/WfsLayerModelBuilder",function(){}),Oskari.clazz.define("Oskari.userinterface.component.VisualizationForm",function(e){this._clazzPrefix="Oskari.userinterface.component.visualization-form.",this._clazzSuffix="Form",this._iconClsPrefix="icon-",this._defaultLocKey="VisualizationForm",this._loc=this._getLocalization("DivManazer"),this.lineCapMap=["butt","round"],this.lineCornerMap=["mitre","round","bevel"],this.lineStyleMap=["","5 2",""],this.dialog=null;var t={forms:["dot","line","area"],formValues:{dot:{shape:1,color:"000000",size:3},line:{style:0,cap:0,corner:0,width:1,color:"3233ff"},area:{line:{width:1,corner:0,style:0,color:"000000"},fill:{style:-1,color:"ffde00"}}}};e=e||{},this._options=jQuery.extend({},t,e),this._formClazzes=this._createFormClazzes(this._options.forms,this._options.formValues),this.template=jQuery('<div id="visualization-form"></div>'),this.templateRenderButton=jQuery('<div class="renderButton"></div>')},{getForm:function(){var e,t,i=this,n=this.template.clone(),a=this._getFormClazz();for(t in a)a.hasOwnProperty(t)&&(e=this.templateRenderButton.clone(),e.attr("title",this._loc.tooltips[t]),e.addClass(this._iconClsPrefix+("dot"===t?"point":t)),e.click(i._bindRenderButton(a[t])),n.append(e));return n},getValues:function(){var e,t,i={},n=this._getFormClazz();for(e in n)n.hasOwnProperty(e)&&(t=n[e],i[e]=t.getValues());return i},setValues:function(e){if(null!==e&&void 0!==e&&"object"==typeof e){var t,i,n=this._getFormClazz();for(t in n)n.hasOwnProperty(t)&&(i=n[t],i.setValues(e[t]))}},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},rgbToHex:function(e){if("#"===e.charAt(0))return e.substring(1);var t,i=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);for(delete i[0],t=1;3>=t;++t)i[t]=parseInt(i[t],10).toString(16),1===i[t].length&&(i[t]="0"+i[t]);return i.join("")},_bindRenderButton:function(e){var t=this;return function(i){e&&e.showForm&&"function"==typeof e.showForm&&(t.dialog&&t.dialog.close(!0),t.dialog=e.showForm(i.target))}},_getFormClazz:function(e){var t;return t=null!==e&&void 0!==e?this._formClazzes[e]:this._formClazzes},_getLocalization:function(e){var t=Oskari.getLocalization(e),i=null;return t&&(i=t[this._defaultLocKey]),i},_createFormClazzes:function(e,t){var i,n,a,r,s=e?e.length:0,o={};for(i=0;s>i;++i)n=e[i],a=t[n],r=this._createFormClazz(n,a),o[n]=r;return o},_createFormClazz:function(e,t){var i=this._capitalize(e),n=this._clazzPrefix+i+this._clazzSuffix,a=this._loc[e];return Oskari.clazz.create(n,this,a,t)},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),define("bundles/framework/bundle/divmanazer/component/VisualizationForm",function(){}),Oskari.clazz.define("Oskari.userinterface.component.visualization-form.DotForm",function(e,t,i){this.creator=e,this.loc=t,this.defaultValues=i,this.saveButton=null,this.cancelButton=null,this.saveButtonHandler=null,this.renderDialog=null,this.messageEnabled=!1,this.values={size:this.defaultValues.size,color:this.defaultValues.color,shape:this.defaultValues.shape,message:""},this.minSize=null!==this.defaultValues.dotMinSize&&void 0!==this.defaultValues.dotMinSize?this.defaultValues.dotMinSize:1,this.maxSize=this.defaultValues.dotMaxSize?this.defaultValues.dotMaxSize:5,this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.paper=null,this.activeColorCell=6,this.symbolButtons={square:{iconCls:"marker-square",iconId:1,offset:[5,36],scale:2},dot:{iconCls:"marker-dot",iconId:5,offset:[5,30],scale:0},arrow:{iconCls:"marker-arrow",iconId:6,offset:[5,35],scale:2},pin:{iconCls:"marker-pin",iconId:3,offset:[2,35],scale:2},pin2:{iconCls:"marker-pin2",iconId:2,offset:[5,35],scale:2},stud:{iconCls:"marker-stud",iconId:0,offset:[2,35],scale:2},flag:{iconCls:"marker-flag",iconId:4,offset:[9,35],scale:2}},this.templateSymbolDialogContent=jQuery('<div class="pointform"><div class="container"><div class="column1"><label>'+this.loc.symbol.label+'</label><div class="symbols icon-buttons"></div><label>'+this.loc.size.label+'</label><br><div class="sizer-values"></div><div class="sizer"></div></div><div class="column2"><div class="column21"><label>'+this.loc.color.label+'</label><div class="color-grid"><div class="color-rectangle"></div></div><div class="color-label"><label>'+this.loc.color.labelOr+'</label></div><div class="color-source-selector"><label>'+this.loc.color.labelCustom+'</label></div><div class="custom-colors"></div></div><div class="column22"><label>'+this.loc.preview.label+'</label><div class="preview"></div></div></div></div></div>'),this.templateSymbolButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.templateSizerValue=jQuery('<div class="sizer-value"></div>'),this.templateMessage=jQuery('<div class = "message"><label class="message-label"></label><div class="field"><input type="text" name="message-text" class="message-text"/></div></div>'),this.previewSize=50
},{getValues:function(){return{size:this.values.size,color:this.values.color,shape:this.values.shape,message:this.values.message}},setValues:function(e){null!==e&&void 0!==e&&jQuery.extend(!0,this.values,e)},showForm:function(e,t,i){var n=this;null!==t&&void 0!==t&&(jQuery.extend(!0,n.values,t.dot),this.messageEnabled=t.messageEnabled),n.renderDialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n.renderDialog.addClass("renderdialog"),n.renderDialog.addClass("pointvisualization");var a,r,s,o=n.loc.title,l=n.templateSymbolDialogContent.clone(),u=l.find("div.symbols");for(a in this.symbolButtons)this.symbolButtons.hasOwnProperty(a)&&(r=this.templateSymbolButton.clone(),s=this.symbolButtons[a],r.addClass(s.iconCls),r.attr("id",s.iconId+"marker"),s.iconId===parseInt(n.values.shape,10)&&r.css("border","2px solid"),r.click(function(){n.values.shape=parseInt(jQuery(this).attr("id").charAt(0),10),n._selectButton(n.values.shape),n._updatePreview(l)}),u.append(r));var c,d,h,p=10,f=110,m=n.maxSize-n.minSize,g=f/m,v=0;for(u=l.find(".sizer-values"),c=1;p>=c;c++)d=n.templateSizerValue.clone(),d.html(c),d.addClass("value"+c),c<n.minSize||c>n.maxSize?d.hide():(h=v*g.toString()+"px",d.css("left",h),d.show(),v+=1),u.append(d);u=l.find(".sizer"),u.slider({range:"min",min:n.minSize,max:n.maxSize,value:this.values.size,slide:function(e,t){n.values.size=t.value,n._updatePreview(l)}});var y,b,k,_,w,L=!1;for(u=l.find(".color-rectangle"),c=0;c<n.basicColors.length;c++)y=n.templateColorCell.clone(),y.css("background-color",n.basicColors[c]),b="ColorCell",k=c+b,k.length===b.length+1&&(k="0"+k),y.attr("id",k),y.click(function(){jQuery(".color-source").prop("checked")||(_=parseInt(this.id.substring(0,2),10),_!==n.activeColorCell&&(n.activeColorCell>-1&&(w=n.activeColorCell.toString(),n.activeColorCell<10&&(w="0"+w),jQuery("#"+w+"ColorCell").css("border","1px solid #000000")),n.values.color=n.creator.rgbToHex(this.style.backgroundColor),n.activeColorCell=_,10>_&&(_="0"+_.toString()),jQuery("#"+_+"ColorCell").css("border","3px solid #ffffff"),n._updatePreview(l)))}),"#"+n.values.color===n.basicColors[c]&&(y.css("border","3px solid #ffffff"),n.activeColorCell=c,L=!0),u.append(y);u=l.find(".color-source-selector");var x=n.templateColorSource.clone();x.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var e=jQuery("#"+n.activeColorCell+"ColorCell");this.checked?e.css("border","1px solid #000000"):e.css("border","3px solid #ffffff"),n._updatePreview(l)}),u.prepend(x),L||(x.checked=!0,u.find("input.color-source").prop("disabled",!1).attr("checked","checked")),u=l.find(".custom-colors");var S=this.templateCustomColor.clone();u.append(S);var O=n.templateColorValue.clone();O.addClass("custom-red-value"),l.find(".colorcolumn1").append(O),l.find("label.custom-red-value").text("R");var T=n.templateColorValue.clone();T.addClass("custom-green-value"),l.find(".colorcolumn21").append(T),l.find("label.custom-green-value").text("G");var C=n.templateColorValue.clone();if(C.addClass("custom-blue-value"),l.find(".colorcolumn22").append(C),l.find("label.custom-blue-value").text("B"),!L){var M=n.creator.hexToRgb(n.values.color);l.find("input.custom-color.custom-red-value").val(M.r),l.find("input.custom-color.custom-green-value").val(M.g),l.find("input.custom-color.custom-blue-value").val(M.b),l.find("input.custom-color").prop("disabled",!1)}if(l.find(".custom-color").change(function(){var e,t,i=[];for(i[0]=jQuery("input.custom-color.custom-red-value").val(),i[1]=jQuery("input.custom-color.custom-green-value").val(),i[2]=jQuery("input.custom-color.custom-blue-value").val(),e=0;3>e;e++){if(t=parseInt(i[e],10),0>t||t>255)return;i[e]=t.toString(16),1===i[e].length&&(i[e]="0"+i[e])}n.values.color=i.join(""),n._updatePreview()}),this._updatePreview(l),this.messageEnabled){var N=this.templateMessage.clone();N.find("label.message-label").html(this.loc.message.label);var E=N.find("input.message-text");E.attr("placeholder",this.loc.message.hint),E.bind("input",function(){n.values.message=jQuery(this).val()}),E.keypress(function(e){13===e.keyCode&&(null!==n.saveButtonHandler?n.saveButtonHandler():n.renderDialog.close())}),N.insertAfter(l.find("div.preview"))}var z=Oskari.clazz.create("Oskari.userinterface.component.buttons.SaveButton");z.addClass("primary showSelection"),z.setHandler(null!==this.saveButtonHandler?this.saveButtonHandler:function(){n.renderDialog.close()}),this.saveButton=z;var P=Oskari.clazz.create("Oskari.userinterface.component.buttons.CancelButton");return P.setHandler(function(){n.values.size=n.defaultValues.size,n.values.color=n.defaultValues.color,n.values.shape=n.defaultValues.shape,n.renderDialog.close()}),this.cancelButton=P,n.renderDialog.show(o,l,[z,P]),"string"==typeof i?n.renderDialog.moveTo(e,i):n.renderDialog.moveTo(e,"top"),this.saveButton.setFocus(!0),n.renderDialog},getDialog:function(){return this.renderDialog},_selectButton:function(e){var t,i,n;for(t in this.symbolButtons)this.symbolButtons.hasOwnProperty(t)&&(i=this.symbolButtons[t],n=jQuery("div#"+i.iconId+"marker.icon-button"),i.iconId.toString()===e.toString()?n.css("border","2px solid"):n.css("border","1px solid"))},setSaveHandler:function(e){this.saveButtonHandler=e,null!==this.saveButton&&this.saveButton.setHandler(e)},setCancelHandler:function(e){this.cancelButtonHandler=e,null!==this.cancelButton&&this.cancelButton.setHandler(e)},_updatePreview:function(e){var t,i=this,n=void 0===e||null===e?jQuery(".pointform"):e,a=n.find(".preview");if(a.length>0){t=a.get(0),0===t.children.length&&(this.paper=Raphael(t,50,50));var r=0,s=[0,0],o=0;for(var l in i.symbolButtons)if(i.symbolButtons.hasOwnProperty(l)){var u=i.symbolButtons[l];if(u.iconId.toString()===i.values.shape.toString()){r=u.iconId,s=u.offset,o=u.scale;break}}var c=this.paper.getFont("dot-markers"),d=57344;this.paper.clear();var h=s[0]-5*this.values.size,p=s[1]+this.values.size*o,f=40+10*this.values.size;this.paper.print(h,p,String.fromCharCode(r+d),c,f).attr({"stroke-width":1,fill:"#"+i.values.color,stroke:"#b4b4b4"}),this.paper.circle(0,0,0)}},_getOnScreenForm:function(){return jQuery("div.renderdialog")}}),define("bundles/framework/bundle/divmanazer/component/visualization-form/DotForm",function(){}),Oskari.clazz.define("Oskari.userinterface.component.visualization-form.LineForm",function(e,t,i){this.creator=e,this.loc=t,this.defaultValues=i,this.values={style:this.defaultValues.style,cap:this.defaultValues.cap,corner:this.defaultValues.corner,width:this.defaultValues.width,color:this.defaultValues.color},this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"],this.capButtonNames=["icon-line-flat_cap","icon-line-round_cap"],this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"],this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.paper=null,this.activeColorCell=-1;var n;for(n=0;n<this.basicColors.length;n++)if(this.basicColors[n]==="#"+this.values.color){this.activeColorCell=n;break}this.templateLineStyleDialogContent=jQuery('<div class="lineform"><div class="container"><div class="column1"><label>'+this.loc.style.label+'</label><div class="style icon-buttons"></div><label>'+this.loc.cap.label+'</label><div class="cap icon-buttons"></div><label>'+this.loc.corner.label+'</label><div class="corner icon-buttons"></div><label>'+this.loc.width.label+'</label><br><div class="width"></div></div><div class="column2"><div class="column21"><label>'+this.loc.color.label+'</label><div class="color-grid"><div class="color-rectangle"></div></div><div class="color-label"><label>'+this.loc.color.labelOr+'</label></div><div class="color-source-selector"><label>'+this.loc.color.labelCustom+'</label></div><div class="custom-colors"></div></div><div class="column22"><label>'+this.loc.preview.label+'</label><div class="preview"></div></div></div></div></div>'),this.templateButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.minWidth=1,this.maxWidth=10,this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.width+'">'),this.previewSize=50,this.selectColor="#dddddd"},{getValues:function(){var e=this.values.cap,t=this.values.corner,i=this.values.style;return"number"==typeof e&&(e=this.creator.lineCapMap[e]),"number"==typeof t&&(t=this.creator.lineCornerMap[t]),"number"==typeof i&&(i=this.creator.lineStyleMap[i]),{width:this.values.width,color:this.values.color,cap:e,corner:t,style:i}},setValues:function(e){var t;if(null!==e&&void 0!==e){for(t=0;t<this.creator.lineCapMap.length;t++)e.cap===this.creator.lineCapMap[t]&&(e.cap=t);for(t=0;t<this.creator.lineCornerMap.length;t++)e.corner===this.creator.lineCornerMap[t]&&(e.corner=t);for(t=0;t<this.creator.lineStyleMap.length;t++)e.style===this.creator.lineStyleMap[t]&&(e.style=t);jQuery.extend(!0,this.values,e)}},showForm:function(e,t){var i=this;null!==t&&void 0!==t&&jQuery.extend(!0,i.values,t.line);var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.addClass("renderdialog"),n.addClass("linevisualization");var a,r,s,o,l,u=i.loc.title,c=i.templateLineStyleDialogContent.clone(),d=c.find("div.style");for(0===i.values.style.length&&(i.values.style=0),a=0;a<i.styleButtonNames.length;a++)s=i.templateButton.clone(),s.addClass(i.styleButtonNames[a]),s.attr("id",a+"linestyle"),a===i.values.style&&this._styleSelectedButton(s),s.click(function(){l=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("style",l),i.values.style=l,i._updatePreview(c)}),d.append(s);for(d=c.find("div.cap"),a=0;a<i.capButtonNames.length;a++)o=i.templateButton.clone(),o.addClass(i.capButtonNames[a]),o.attr("id",a+"linecap"),a===i.values.cap&&this._styleSelectedButton(o),o.click(function(){l=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("cap",l),i.values.cap=l,i._updatePreview(c)}),d.append(o);for(d=c.find("div.corner"),a=0;a<i.cornerButtonNames.length;a++)r=i.templateButton.clone(),r.addClass(i.cornerButtonNames[a]),r.attr("id",a+"linecorner"),a===i.values.corner&&this._styleSelectedButton(r),r.click(function(){l=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("corner",l),i.values.corner=l,i._updatePreview(c)}),d.append(r);d=c.find("div.width");var h=i.templateWidthValue.clone();h.change(function(){var e=parseInt(h.val(),10);isNaN(e)||(i.values.width=e,i._updatePreview())}),h.val(null!==i.values.width&&void 0!==i.values.width?i.values.width:1),d.append(h);var p,f,m,g,v,y=!1;for(d=c.find(".color-rectangle"),a=0;a<i.basicColors.length;a++)p=i.templateColorCell.clone(),p.css("background-color",i.basicColors[a]),f="ColorCell",m=a+f,m.length===f.length+1&&(m="0"+m),p.attr("id",m),p.click(function(){jQuery(".color-source").prop("checked")||(g=parseInt(this.id.substring(0,2),10),g!==i.activeColorCell&&(i.activeColorCell>-1&&(v=i.activeColorCell.toString(),i.activeColorCell<10&&(v="0"+v),jQuery("#"+v+"ColorCell").css("border","1px solid #000000")),i.values.color=i.creator.rgbToHex(this.style.backgroundColor),i.activeColorCell=g,10>g&&(g="0"+g.toString()),jQuery("#"+g+"ColorCell").css("border","3px solid #ffffff"),i._updatePreview(c)))}),"#"+i.values.color===i.basicColors[a]&&(p.css("border","3px solid #ffffff"),i.activeColorCell=a,y=!0),d.append(p);d=c.find(".color-source-selector");var b=i.templateColorSource.clone();-1===i.activeColorCell&&b.attr("checked",!0),b.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var e=i.activeColorCell.toString();i.activeColorCell<10&&(e="0"+e);var t=jQuery("#"+e+"ColorCell");this.checked&&(t.css("border","1px solid #000000"),jQuery(".custom-red-value").val(parseInt(i.values.color.substring(0,2),16)),jQuery(".custom-green-value").val(parseInt(i.values.color.substring(2,4),16)),jQuery(".custom-blue-value").val(parseInt(i.values.color.substring(4),16)),i.activeColorCell=-1),i._updatePreview(c)}),d.prepend(b),y||(b.checked=!0,d.find("input.color-source").prop("disabled",!1).attr("checked","checked")),d=c.find(".custom-colors");var k=this.templateCustomColor.clone();d.append(k);var _=i.templateColorValue.clone();_.addClass("custom-red-value"),-1===i.activeColorCell&&(_.val(parseInt(i.values.color.substring(0,2),16)),_.prop("disabled",!1)),c.find(".colorcolumn1").append(_),c.find("label.custom-red-value").text("R");var w=i.templateColorValue.clone();w.addClass("custom-green-value"),-1===i.activeColorCell&&(w.val(parseInt(i.values.color.substring(2,4),16)),w.prop("disabled",!1)),c.find(".colorcolumn21").append(w),c.find("label.custom-green-value").text("G");var L=i.templateColorValue.clone();if(L.addClass("custom-blue-value"),-1===i.activeColorCell&&(L.val(parseInt(i.values.color.substring(4),16)),L.prop("disabled",!1)),c.find(".colorcolumn22").append(L),c.find("label.custom-blue-value").text("B"),!y){var x=i.creator.hexToRgb(i.values.color);c.find("input.custom-color.custom-red-value").val(x.r),c.find("input.custom-color.custom-green-value").val(x.g),c.find("input.custom-color.custom-blue-value").val(x.b),c.find("input.custom-color").prop("disabled",!1)}c.find(".custom-color").change(function(){var e,t,n=[];for(n[0]=jQuery("input.custom-color.custom-red-value").val(),n[1]=jQuery("input.custom-color.custom-green-value").val(),n[2]=jQuery("input.custom-color.custom-blue-value").val(),e=0;3>e;e++){if(t=parseInt(n[e],10),0>t||t>255)return;n[e]=t.toString(16),1===n[e].length&&(n[e]="0"+n[e])}i.values.color=n.join(""),i._updatePreview()}),this._updatePreview(c);var S=Oskari.clazz.create("Oskari.userinterface.component.Button");S.setTitle(i.loc.buttons.save),S.addClass("primary showSelection"),S.setHandler(function(){n.close()});var O=Oskari.clazz.create("Oskari.userinterface.component.Button");return O.setTitle(i.loc.buttons.cancel),O.setHandler(function(){i.values.size=i.defaultValues.size,i.values.color=i.defaultValues.color,i.values.shape=i.defaultValues.shape,n.close()}),n.show(u,c,[S,O]),n.moveTo(e,"top"),i._updatePreview(),S.setFocus(!0),n},_selectButton:function(e,t){this._styleUnselectedButton(jQuery("div#"+this.values[e]+"line"+e+".icon-button")),this._styleSelectedButton(jQuery("div#"+t+"line"+e+".icon-button"))},_updatePreview:function(e){var t,i=this,n=void 0===e||null===e?jQuery(".lineform"):e,a=n.find(".preview");if(a.length>0){t=a.get(0),0===t.children.length&&(this.paper=Raphael(t,50,50));var r={stroke:"#"+i.values.color,fill:"none","stroke-width":i.values.width,"stroke-linejoin":0===i.values.corner?"miter":"round","stroke-linecap":0===i.values.cap?"butt":"round","stroke-dasharray":1===i.values.style?"- ":""},s=[10,15],o=[20,35],l=[40,25];if(this.paper.clear(),2!==i.values.style)this.paper.path("M"+s[0]+","+s[1]+"L"+o+","+l).attr(r);else{var u=1.5+.5*i.values.width,c=[s[0]+2*u/Math.sqrt(5),s[1]-u/Math.sqrt(5)],d=[s[0]-2*u/Math.sqrt(5),s[1]+u/Math.sqrt(5)],h=[];h[0]=o[0]+.5*u*(Math.sqrt(3)-1),h[1]=o[1]-.5*u*(Math.sqrt(3)+1);var p=[];p[0]=o[0]-.5*u*(Math.sqrt(3)-1),p[1]=o[1]+.5*u*(Math.sqrt(3)+1);var f=[l[0]-u/Math.sqrt(5),l[1]-2*u/Math.sqrt(5)],m=[l[0]+u/Math.sqrt(5),l[1]+2*u/Math.sqrt(5)];this.paper.path("M"+c[0]+","+c[1]+"L"+h+","+f+"M"+d[0]+","+d[1]+"L"+p+","+m).attr(r),this.paper.circle(0,0,0)}}},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(e){e.css("border","2px solid"),e.css("background-color",this.selectColor)},_styleUnselectedButton:function(e){e.css("border","1px solid"),e.css("background-color","transparent")}}),define("bundles/framework/bundle/divmanazer/component/visualization-form/LineForm",function(){}),Oskari.clazz.define("Oskari.userinterface.component.visualization-form.AreaForm",function(e,t,i){this.creator=e,this.loc=t,this.defaultValues=i,this.first=!0,this.values={lineWidth:this.defaultValues.line.width,lineCorner:this.defaultValues.line.corner,lineStyle:this.defaultValues.line.style,lineColor:this.defaultValues.line.color,fillColor:this.defaultValues.fill.color,fillStyle:this.defaultValues.fill.style},this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"],this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"],this.colorTypes=["line","fill"],this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.paper=null,this.activeColorCell=[-1,-1];var n,a;for(n=0;n<this.basicColors.length;n++)for(a=0;a<this.basicColors.length;a++)if(this.basicColors[a]==="#"+this.values.fillColor[n]){this.activeColorCell[n]=a;break}this.fillButtonNames=["icon-line-thin-diagonal","icon-line-wide-diagonal","icon-line-thin-horizontal","icon-line-wide-horizontal"],this.templateAreaStyleDialogContent=jQuery('<div class="areaform"><div class="container"><div class="column1"><label>'+this.loc.linestyle.label+'</label><div class="style icon-buttons"></div><label>'+this.loc.linecorner.label+'</label><div class="corner icon-buttons"></div><label>'+this.loc.linewidth.label+'</label><br><div class="width"></div></div><div class="column2"><div class="column21"><label>'+this.loc.linecolor.label+'</label><div class="color-grid"><div class="color-rectangle line"></div></div><div class="color-label"><label>'+this.loc.linecolor.labelOr+'</label></div><div class="color-source-selector-line"><label>'+this.loc.linecolor.labelCustom+'</label></div><div class="custom-colors-line"></div></div><div class="column22"><div class="column221"><label>'+this.loc.color.label+'</label><div class="color-grid"><div class="color-rectangle fill"></div></div><div class="color-label"><label>'+this.loc.color.labelOr+'</label></div><div class="color-source-selector-fill"><label>'+this.loc.color.labelCustom+'</label></div><div class="custom-colors-fill"></div><label>'+this.loc.fill.label+'</label><div class="fill icon-buttons"></div></div><div class="column222"><label>'+this.loc.preview.label+'</label><div class="preview"></div></div></div></div></div></div>'),this.templateButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.minWidth=1,this.maxWidth=5,this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.lineWidth+'">'),this.previewSize=50,this.selectColor="#dddddd"},{getValues:function(){var e=this.values.lineCorner,t=this.values.lineStyle;return"number"==typeof e&&(e=this.creator.lineCornerMap[e]),"number"==typeof t&&(t=this.creator.lineStyleMap[t]),{lineWidth:this.values.lineWidth,lineCorner:e,lineStyle:t,lineColor:this.values.lineColor,fillColor:this.values.fillColor,fillStyle:this.values.fillStyle}},setValues:function(e){var t;if(null!==e&&void 0!==e){for(t=0;t<this.creator.lineCornerMap.length;t++)e.lineCorner===this.creator.lineCornerMap[t]&&(e.lineCorner=t);for(t=0;t<this.creator.lineStyleMap.length;t++)e.lineStyle===this.creator.lineStyleMap[t]&&(e.lineStyle=t);jQuery.extend(!0,this.values,e)}},showForm:function(e,t){var i=this;null!==t&&void 0!==t&&jQuery.extend(!0,i.values,t.area);var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.addClass("renderdialog"),n.addClass("areavisualization");var a,r,s,o,l=i.loc.title,u=i.templateAreaStyleDialogContent.clone(),c=u.find("div.style");for(0===i.values.lineStyle.length&&(i.values.lineStyle=0),a=0;a<i.styleButtonNames.length;a++)r=i.templateButton.clone(),r.addClass(i.styleButtonNames[a]),r.attr("id",a+"linestyle"),a===i.values.lineStyle&&this._styleSelectedButton(r),r.click(function(){s=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("lineStyle",s),i.values.lineStyle=s,i._updatePreview(u)}),c.append(r);for(c=u.find("div.corner"),a=0;a<i.cornerButtonNames.length;a++)o=i.templateButton.clone(),o.addClass(i.cornerButtonNames[a]),o.attr("id",a+"linecorner"),a===i.values.lineCorner&&this._styleSelectedButton(o),o.click(function(){s=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("lineCorner",s),i.values.lineCorner=s,i._updatePreview(u)}),c.append(o);c=u.find("div.width");var d=i.templateWidthValue.clone();d.val(null!==i.values.lineWidth&&void 0!==i.values.lineWidth?i.values.lineWidth:1),d.change(function(){var e=parseInt(d.val(),10);isNaN(e)||(i.values.lineWidth=e,i._updatePreview())}),c.append(d);var h,p,f,m,g,v,y,b,k,_,w,L;for(h=0;2>h;h++){for(p=!1,f=0===h?"lineColor":"fillColor",c=u.find(".color-rectangle."+i.colorTypes[h]),a=0;a<i.basicColors.length;a++)m=i.templateColorCell.clone(),m.css("background-color",i.basicColors[a]),g="ColorCell",v=a.toString()+h.toString()+g,v.length===g.length+2&&(v="0"+v),m.attr("id",v),m.click(function(){var e=parseInt(this.id.substring(0,2),10),t=parseInt(this.id.substring(2,3),10);if(!jQuery("#"+t+"color-checkbox").prop("checked")&&e!==i.activeColorCell[t]){if(i.activeColorCell[t]>-1){var n=i.activeColorCell[t].toString();i.activeColorCell[t]<10&&(n="0"+n),jQuery("#"+n+t+"ColorCell").css("border","1px solid #000000")}i.values[0===t?"lineColor":"fillColor"]=i.creator.rgbToHex(this.style.backgroundColor),i.activeColorCell[t]=e,10>e&&(e="0"+e.toString()),jQuery("#"+e+t+"ColorCell").css("border","3px solid #ffffff"),i._updatePreview(u)}}),"#"+i.values[f]===i.basicColors[a]&&(m.css("border","3px solid #ffffff"),i.activeColorCell[h]=a,p=!0),c.append(m);c=u.find(".color-source-selector-"+i.colorTypes[h]),y=i.templateColorSource.clone(),y.attr("id",h+"color-checkbox"),-1===i.activeColorCell[h]&&y.attr("checked",!0),y.change(function(){var e=this.id.substring(0,1),t="0"===e?"lineColor":"fillColor";jQuery("input.custom-color."+i.colorTypes[e]).prop("disabled",!this.checked);var n=i.activeColorCell[e].toString();i.activeColorCell[e]<10&&(n="0"+n);var a=jQuery("#"+n+e+"ColorCell");this.checked&&(a.css("border","1px solid #000000"),jQuery(".custom-red-value."+i.colorTypes[e]).val(parseInt(i.values[t].substring(0,2),16)),jQuery(".custom-green-value."+i.colorTypes[e]).val(parseInt(i.values[t].substring(2,4),16)),jQuery(".custom-blue-value."+i.colorTypes[e]).val(parseInt(i.values[t].substring(4),16)),i.activeColorCell[e]=-1),i._updatePreview(u)}),c.prepend(y),p||(y.checked=!0,c.find("input.color-source").prop("disabled",!1).attr("checked","checked")),c=u.find(".custom-colors-"+i.colorTypes[h]),b=this.templateCustomColor.clone(),b.addClass(i.colorTypes[h]),c.append(b),k=i.templateColorValue.clone(),k.addClass("custom-red-value"),k.addClass(i.colorTypes[h]),-1===i.activeColorCell[h]&&(k.val(parseInt(i.values.lineColor.substring(0,2),16)),k.prop("disabled",!1)),c.find(".colorcolumn1").append(k),c.find("label.custom-red-value").text("R"),c.find("input.custom-red-value").attr("id",h+"red-value"),_=i.templateColorValue.clone(),_.addClass("custom-green-value"),_.addClass(i.colorTypes[h]),-1===i.activeColorCell[h]&&(_.val(parseInt(i.values[f].substring(2,4),16)),_.prop("disabled",!1)),c.find(".colorcolumn21").append(_),c.find("label.custom-green-value").text("G"),c.find("input.custom-green-value").attr("id",h+"green-value"),w=i.templateColorValue.clone(),w.addClass("custom-blue-value"),w.addClass(i.colorTypes[h]),-1===i.activeColorCell[h]&&(w.val(parseInt(i.values[f].substring(4),16)),w.prop("disabled",!1)),c.find(".colorcolumn22").append(w),c.find("label.custom-blue-value").text("B"),c.find("input.custom-blue-value").attr("id",h+"blue-value"),p||(L=i.creator.hexToRgb(i.values[f]),c.find("input.custom-color.custom-red-value").val(L.r),c.find("input.custom-color.custom-green-value").val(L.g),c.find("input.custom-color.custom-blue-value").val(L.b),u.find("input#"+h.toString()+"red-value.custom-color").prop("disabled",!1),u.find("input#"+h.toString()+"green-value.custom-color").prop("disabled",!1),u.find("input#"+h.toString()+"blue-value.custom-color").prop("disabled",!1)),c.find(".custom-color").change(function(){var e,t,n=this.id.substring(0,1),a=[];for(a[0]=jQuery("input#"+n+"red-value").val(),a[1]=jQuery("input#"+n+"green-value").val(),a[2]=jQuery("input#"+n+"blue-value").val(),e=0;3>e;e++){if(t=parseInt(a[e],10),0>t||t>255)return;a[e]=t.toString(16),1===a[e].length&&(a[e]="0"+a[e])}i.values["0"===n?"lineColor":"fillColor"]=a.join(""),i._updatePreview()})}for(c=u.find("div.fill.icon-buttons"),a=0;a<i.fillButtonNames.length;a++){var x=i.templateButton.clone();x.addClass(i.fillButtonNames[a]),x.attr("id",a+"fillstyle"),a===i.values.fillStyle&&this._styleSelectedButton(x),x.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);i.values.fillStyle===e?(i.values.fillStyle=-1,i._styleUnselectedButton(jQuery("div#"+e+"fillstyle.icon-button"))):(-1!==i.values.fillStyle&&i._styleUnselectedButton(jQuery("div#"+i.values.fillStyle+"fillstyle.icon-button")),i._styleSelectedButton(jQuery("div#"+e+"fillstyle.icon-button")),i.values.fillStyle=e),i._updatePreview(u)}),c.append(x)}this._updatePreview(u);var S=Oskari.clazz.create("Oskari.userinterface.component.Button");S.setTitle(i.loc.buttons.save),S.addClass("primary showSelection"),S.setHandler(function(){n.close()});var O=Oskari.clazz.create("Oskari.userinterface.component.Button");return O.setTitle(i.loc.buttons.cancel),O.setHandler(function(){i.values.lineWidth=i.defaultValues.line.width,i.values.lineCorner=i.defaultValues.line.corner,i.values.lineStyle=i.defaultValues.line.style,i.values.lineColor=i.defaultValues.line.color,i.values.fillColor=i.defaultValues.fill.color,i.values.fillStyle=i.defaultValues.fill.style,n.close()}),n.show(l,u,[S,O]),n.moveTo(e,"top"),S.setFocus(!0),n},_selectButton:function(e,t){var i=e.substring(4).toLowerCase();this._styleUnselectedButton(jQuery("div#"+this.values[e]+"line"+i+".icon-button")),this._styleSelectedButton(jQuery("div#"+t+"line"+i+".icon-button"))},_updatePreview:function(e){this.first&&(this.first=!1,this.values.fillStyle=this.defaultValues.fill.style);var t,i=this,n=void 0===e||null===e?jQuery(".areaform"):e,a=n.find(".preview");if(a.length>0){t=a.get(0),0===t.children.length&&(this.paper=Raphael(t,50,50));var r=parseInt(i.values.fillStyle,10)<0?"#"+i.values.fillColor:"none",s={stroke:"#"+i.values.lineColor,fill:r,"stroke-width":i.values.lineWidth,"stroke-linejoin":0===i.values.lineCorner?"miter":"round","stroke-linecap":"butt","stroke-dasharray":1===i.values.lineStyle?"- ":""},o={};if(this.paper.clear(),i.values.fillStyle>=0)switch(i.values.fillStyle){case 0:var l=[10.5,17.5],u=[12.3,19.7],c=[14.1,21.9],d=[15.9,24.1],h=[17.7,26.3],p=[19.5,28.5],f=[21.4,30.6],m=[23.2,32.8],g=[25,35],v=[26.8,37.2],y=[28.6,39.4],b=[11.2,16.8],k=[16,16],_=[20.8,15.2],w=[25.6,14.4],L=[30.4,13.6],x=[35.2,12.8],S=[40,12],O=[37.4,18.6],T=[34.8,25.2],C=[32.2,31.8],M=[29.6,38.4];o={"stroke-width":1,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+l+"L"+b+"M"+u+"L"+k+"M"+c+"L"+_+"M"+d+"L"+w+"M"+h+"L"+L+"M"+p+"L"+x+"M"+f+"L"+S+"M"+m+"L"+O+"M"+g+"L"+T+"M"+v+"L"+C+"M"+y+"L"+M).attr(o),this.paper.circle(0,0,0);break;case 1:var N=[14.8,16.2],E=[23.2,14.8],z=[31.6,13.4],P=[39.8,12.2],A=[35.4,23.6],R=[30.9,35.1],I=[11.9,19.1],D=[15,23],j=[18.2,26.8],F=[21.4,30.6],q=[24.5,34.5],B=[27.7,38.3];o={"stroke-width":2,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+N+"L"+I+"M"+E+"L"+D+"M"+z+"L"+j+"M"+P+"L"+F+"M"+A+"L"+q+"M"+R+"L"+B).attr(o),this.paper.circle(0,0,0);break;case 2:var H=[19,15.5],U=[12.1,19.5],G=[15.4,23.5],V=[18.7,27.5],W=[22,31.5],Q=[25.3,35.5],K=[28.6,39.5],X=[38.6,15.5],$=[37,19.5],Y=[35.4,23.5],Z=[33.9,27.5],J=[32.3,31.5],et=[30.7,35.5],tt=[29.1,39.5];o={"stroke-width":1,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+H+"L"+X+"M"+U+"L"+$+"M"+G+"L"+Y+"M"+V+"L"+Z+"M"+W+"L"+J+"M"+Q+"L"+et+"M"+K+"L"+tt).attr(o),this.paper.circle(0,0,0);break;case 3:var it=[16.1,16],nt=[13.4,21],at=[17.5,26],rt=[21.6,31],st=[25.7,36],ot=[38.4,16],lt=[36.4,21],ut=[35.5,26],ct=[32.5,31],dt=[30.5,36];o={"stroke-width":2,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+it+"L"+ot+"M"+nt+"L"+lt+"M"+at+"L"+ut+"M"+rt+"L"+ct+"M"+st+"L"+dt).attr(o),this.paper.circle(0,0,0)}{var ht=[10,17],pt=[40,12],ft=[29,40];this.paper.path("M"+ht+"L"+pt+","+ft+"Z").attr(s)}if(this.paper.circle(0,0,0),2===i.values.lineStyle){var mt=2*(2+parseInt(i.values.lineWidth,10)),gt=Math.atan(Math.abs((pt[1]-ht[1])/(pt[0]-ht[0]))),vt=[ht[0]+mt*Math.sin(Math.PI/3+gt),ht[1]+mt*Math.cos(Math.PI/3+gt)],yt=Math.atan(Math.abs((ft[1]-pt[1])/(ft[0]-pt[0]))),bt=[pt[0]-mt*Math.sin(Math.PI/3+yt),pt[1]-mt*Math.cos(Math.PI/3+yt)],kt=Math.atan(Math.abs((ht[1]-ft[1])/(ht[0]-ft[0]))),_t=[ft[0]-mt*Math.cos(Math.PI/6+kt),ft[1]-mt*Math.sin(Math.PI/6+kt)];this.paper.path("M"+vt+"L"+bt+","+_t+"Z").attr(s)}}},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(e){e.css("border","2px solid"),e.css("background-color",this.selectColor)},_styleUnselectedButton:function(e){e.css("border","1px solid"),e.css("background-color","transparent")}}),define("bundles/framework/bundle/divmanazer/component/visualization-form/AreaForm",function(){}),Oskari.registerLocalization({lang:"fi",key:"MapWfs2",value:{title:"MapWfs2",desc:"","object-data":"Kohdetiedot","default-style":"Oletustyyli","own-style":"Oma tyyli",tile:{title:"MapWfs2"},flyout:{title:"MapWfs2",message:"MapWfs2"},error:{title:"Virhe",connection_not_available:"Yhteyttä WFS-taustapalveluun ei voitu muodostaa .",connection_broken:"Yhteys WFS-taustapalveluun katkesi.",wfs_no_permissions:"Sinulla ei ole riittäviä oikeuksia WFS-tasoon {layer}.",wfs_configuring_layer_failed:"WFS-tason {layer} konfigurointi epäonnistui.",wfs_request_failed:"WFS-tasolle {layer} kohdistunut kysely epäonnistui.",features_parsing_failed:"WFS-tason {layer} kohdetietojen käsittely epäonnistui."},button:{cancel:"Peruuta",show:"Näytä kohteet",close:"Sulje",edit:"Muokkaa"},popup:{title:"Oma tyyli",button:{cancel:"Peruuta",save:"Tallenna"}}}}),define("bundles/framework/bundle/mapwfs2/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"MapWfs2",value:{title:"MapWfs2",desc:"","object-data":"Objektuppgifter","default-style":"Förvald utseende","own-style":"Egen stil",tile:{title:"MapWfs2"},flyout:{title:"MapWfs2",message:"MapWfs2"},error:{title:"Felmeddelande",connection_not_available:"Kontakt med WFS-bakgrundstjänsten fås inte.",connection_broken:"Kontakten med WFS-bakgrundstjänsten har avbrutits.",wfs_no_permissions:"Rättigheter till WFS-lager ({layer}) saknas.",wfs_configuring_layer_failed:"Konfigureringen av WFS-lager ({layer}) misslyckades.",wfs_request_failed:"Din förfrågan för WFS-lager ({layer}) misslyckades.",features_parsing_failed:"Hanteringen av features i WFS-lager ({layer}) misslyckades."},button:{cancel:"Avbryt",show:"Visa",close:"Stäng",edit:"Redigera"},popup:{title:"Egen stil",button:{cancel:"Avbryt",save:"Lagra"}}}}),define("bundles/framework/bundle/mapwfs2/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"MapWfs2",value:{title:"MapWfs2",desc:"","object-data":"Object data","default-style":"Default style","own-style":"Own style",tile:{title:"MapWfs2"},flyout:{title:"MapWfs2",message:"MapWfs2"},error:{title:"Error",connection_not_available:"Connection to the WFS background service is unavailable.",connection_broken:"Connection to the WFS background service broke down.",wfs_no_permissions:"You do not have the permission to use WFS layer {layer}.",wfs_configuring_layer_failed:"Configuring WFS layer {layer} failed.",wfs_request_failed:"Request to WFS layer {layer} failed.",features_parsing_failed:"The feature parsing of WFS layer {layer}) failed."},button:{cancel:"Cancel",show:"Show places",close:"Close",edit:"Edit"},popup:{title:"Own style",button:{cancel:"Cancel",save:"Save"}}}}),define("bundles/framework/bundle/mapwfs2/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"MapWfs2",value:{title:"MapWfs2",desc:"","object-data":"Object data","default-style":"Default style","own-style":"Own style",tile:{title:"MapWfs2"},flyout:{title:"MapWfs2",message:"MapWfs2"},error:{title:"Error",connection_not_available:"Connection to the WFS background service is not available.",connection_broken:"Connection to the WFS background service broke down.",wfs_no_permissions:"No permission to use WFS layer ({layer}).",wfs_configuring_layer_failed:"Configuring WFS layer ({layer}) failed.",wfs_request_failed:"WFS layer's ({layer}) request failed.",features_parsing_failed:"Feature parsing of WFS layer ({layer}) failed."},button:{cancel:"Cancel",show:"View places",close:"Close",edit:"Edit"},popup:{title:"Own style",button:{cancel:"Cancel",save:"Save"}}}}),define("bundles/framework/bundle/mapwfs2/locale/es",function(){}),Oskari.registerLocalization({lang:"de",key:"MapWfs2",value:{title:"MapWfs2",desc:"","object-data":"Object data","default-style":"Default style","own-style":"Own style",tile:{title:"MapWfs2"},flyout:{title:"MapWfs2",message:"MapWfs2"},error:{title:"Error",connection_not_available:"Connection to the WFS background service is not available.",connection_broken:"Connection to the WFS background service broke down.",wfs_no_permissions:"No permission to use WFS layer ({layer}).",wfs_configuring_layer_failed:"Configuring WFS layer ({layer}) failed.",wfs_request_failed:"WFS layer's ({layer}) request failed.",features_parsing_failed:"Feature parsing of WFS layer ({layer}) failed."},button:{cancel:"Cancel",show:"View places",close:"Close",edit:"Edit"},popup:{title:"Own style",button:{cancel:"Cancel",save:"Save"}}}}),define("bundles/framework/bundle/mapwfs2/locale/de",function(){}),Oskari.registerLocalization({lang:"cs",key:"MapWfs2",value:{title:"MapWfs2",desc:"","object-data":"Object data","default-style":"Default style","own-style":"Own style",tile:{title:"MapWfs2"},flyout:{title:"MapWfs2",message:"MapWfs2"},error:{title:"Error",connection_not_available:"Connection to the WFS background service is not available.",connection_broken:"Connection to the WFS background service broke down.",wfs_no_permissions:"No permission to use WFS layer ({layer}).",wfs_configuring_layer_failed:"Configuring WFS layer ({layer}) failed.",wfs_request_failed:"WFS layer's ({layer}) request failed.",features_parsing_failed:"Feature parsing of WFS layer ({layer}) failed."},button:{cancel:"Cancel",show:"View places",close:"Close",edit:"Edit"},popup:{title:"Own style",button:{cancel:"Cancel",save:"Save"}}}}),define("bundles/framework/bundle/mapwfs2/locale/cs",function(){}),define("src/framework/mapwfs2/module",["oskari","jquery","bundles/framework/bundle/mapwfs2/comp","libraries/jquery/plugins/jquery.cookie","bundles/framework/bundle/mapwfs2/service/Connection","bundles/framework/bundle/mapwfs2/service/Mediator","bundles/framework/bundle/mapwfs2/plugin/QueuedTilesGrid","bundles/framework/bundle/mapwfs2/plugin/QueuedTilesStrategy","bundles/framework/bundle/mapwfs2/plugin/TileCache","bundles/framework/bundle/mapwfs2/plugin/WfsLayerPlugin","bundles/framework/bundle/mapwfs2/event/WFSFeatureEvent","bundles/framework/bundle/mapwfs2/event/WFSFeaturesSelectedEvent","bundles/framework/bundle/mapwfs2/event/WFSFeatureGeometriesEvent","bundles/framework/bundle/mapwfs2/event/WFSImageEvent","bundles/framework/bundle/mapwfs2/event/WFSPropertiesEvent","bundles/framework/bundle/mapwfs2/request/ShowOwnStyleRequest","bundles/framework/bundle/mapwfs2/request/ShowOwnStyleRequestHandler","bundles/framework/bundle/mapwfs2/request/ActivateHighlightRequest","bundles/framework/bundle/mapwfs2/request/ActivateHighlightRequestHandler","bundles/framework/bundle/mapwfs2/domain/QueuedTile","bundles/framework/bundle/mapwfs2/domain/TileQueue","bundles/framework/bundle/mapwfs2/domain/WFSLayer","bundles/framework/bundle/mapwfs2/domain/WfsLayerModelBuilder","bundles/framework/bundle/divmanazer/component/VisualizationForm","bundles/framework/bundle/divmanazer/component/visualization-form/DotForm","bundles/framework/bundle/divmanazer/component/visualization-form/LineForm","bundles/framework/bundle/divmanazer/component/visualization-form/AreaForm","bundles/framework/bundle/mapwfs2/locale/fi","bundles/framework/bundle/mapwfs2/locale/sv","bundles/framework/bundle/mapwfs2/locale/en","bundles/framework/bundle/mapwfs2/locale/es","bundles/framework/bundle/mapwfs2/locale/de","bundles/framework/bundle/mapwfs2/locale/cs"],function(e){return e.bundleCls("mapwfs2").category({create:function(){return this
},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.plugin.StatsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._statsDrawLayer=null,this._highlightCtrl=null,this._navCtrl=null,this._getFeatureControlHover=null,this._getFeatureControlSelect=null,this._modeVisible=!1,this.config=e,this.ajaxUrl=null,this.featureAttribute="kuntakoodi",e&&e.ajaxUrl&&(me.ajaxUrl=e.ajaxUrl),e&&e.published&&(me._modeVisible=e.published)},{__name:"StatsLayerPlugin",_layerType:"STATS",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("statslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("statslayer",null)},init:function(){var e=(this.config?this.config.sandbox:null)||"sandbox",t=Oskari.getSandbox(e),i=t.getService("Oskari.mapframework.service.MapLayerService");if(i){i.registerLayerModel("statslayer","Oskari.mapframework.bundle.mapstats.domain.StatsLayer");var n=Oskari.clazz.create("Oskari.mapframework.bundle.mapstats.domain.StatsLayerModelBuilder",t);i.registerLayerModelBuilder("statslayer",n)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this.ajaxUrl||(this.ajaxUrl=e.getAjaxUrl()+"action_route=GetStatsTile")},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},MapLayerVisibilityChangedEvent:function(e){this._mapLayerVisibilityChangedEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(){},"MapStats.StatsVisualizationChangeEvent":function(e){this._afterStatsVisualizationChangeEvent(e)},"StatsGrid.ModeChangedEvent":function(e){this._afterModeChangedEvent(e)},"StatsGrid.SelectHilightsModeEvent":function(e){this._hilightFeatures(e)},"StatsGrid.ClearHilightsEvent":function(e){this._clearHilights(e)},"MapStats.HoverTooltipContentEvent":function(e){this._afterHoverTooltipContentEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,a=this._sandbox;for(t=0;t<e.length;t++)i=e[t],n=i.getId(),i.isLayerOfType(this._layerType)&&(a.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},activateControls:function(){var e=this;e._getFeatureControlHover&&e._getFeatureControlHover.activate(),e._getFeatureControlSelect&&e._getFeatureControlSelect.activate()},deactivateControls:function(){var e=this;e._getFeatureControlHover&&e._getFeatureControlHover.deactivate(),e._getFeatureControlSelect&&e._getFeatureControlSelect.deactivate()},addMapLayerToMap:function(e,t){if(e.isLayerOfType(this._layerType)){var i,n=this,a=n._sandbox.getEventBuilder("MapStats.FeatureHighlightedEvent"),r=n.getMapModule().calculateLayerScales(e.getMaxScale(),e.getMinScale()),s=new OpenLayers.Layer.WMS("layer_"+e.getId(),n.ajaxUrl+"&LAYERID="+e.getId(),{layers:e.getWmsName(),transparent:!0,format:"image/png"},{scales:r,isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:!0,singleTile:!0,buffer:0});n._statsDrawLayer=new OpenLayers.Layer.Vector("Stats Draw Layer",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillOpacity:0,strokeOpacity:0}),temporary:new OpenLayers.Style({strokeColor:"#ff6666",strokeOpacity:1,strokeWidth:3,fillColor:"#ff0000",fillOpacity:0,graphicZIndex:2,cursor:"pointer"}),select:new OpenLayers.Style({})})}),n._map.addLayers([n._statsDrawLayer]),n._highlightCtrl=new OpenLayers.Control.SelectFeature(n._statsDrawLayer,{hover:!0,highlightOnly:!0,outFeature:function(e){n._highlightCtrl.unhighlight(e),n._removePopup()},renderIntent:"temporary"}),void 0!==n._highlightCtrl.handlers?n._highlightCtrl.handlers.feature.stopDown=!1:void 0!==n._highlightCtrl.handler&&(n._highlightCtrl.handler.stopDown=!1,n._highlightCtrl.handler.stopUp=!1),n._map.addControl(this._highlightCtrl),n._highlightCtrl.activate();var o=[s];n._getFeatureControlHover=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:!1,hover:!0,handlerOptions:{hover:{delay:0},stopSingle:!1},infoFormat:"application/vnd.ogc.gml",layers:o,eventListeners:{getfeatureinfo:function(e){var t,i=n._map.getLayersByName("Stats Draw Layer")[0];if("undefined"!=typeof i){if(0===e.features.length){for(t=0;t<i.features.length;t++)i.features[t].selected||i.removeFeatures([i.features[t]]);return void n._removePopup()}var a=!1,r=n.featureAttribute;for(t=0;t<i.features.length;t++)i.features[t].attributes[r]===e.features[0].attributes[r]?a=!0:i.features[t].selected||i.removeFeatures([i.features[t]]);a||(i.addFeatures([e.features[0]]),n._highlightCtrl.highlight(e.features[0]),n._removePopup(),n._addPopup(e)),i.redraw()}},beforegetfeatureinfo:function(){},nogetfeatureinfo:function(){}}}),n._map.addControl(n._getFeatureControlHover),n._modeVisible&&n._getFeatureControlHover.activate(),n._getFeatureControlSelect=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:!0,hover:!1,handlerOptions:{click:{delay:0},pixelTolerance:5},infoFormat:"application/vnd.ogc.gml",layers:o,eventListeners:{getfeatureinfo:function(e){if(0!==e.features.length){var t=e.features[0],r=n._map.getLayersByName("Stats Draw Layer")[0];if("undefined"!=typeof r){var s,o,l=-1,u=n.featureAttribute;for(s=0;s<r.features.length;s++)if(r.features[s].attributes[u]===e.features[0].attributes[u]){l=s;break}o=OpenLayers.Util.applyDefaults(o,OpenLayers.Feature.Vector.style["default"]),o.fillColor="#ff0000",o.strokeColor="#ff3333",o.strokeWidth=3,o.fillOpacity=.2,l>=0?(r.features[s].selected=!r.features[s].selected,r.features[s].selected?r.features[s].style=o:(r.features[s].style=null,n._highlightCtrl.highlight(r.features[s])),a&&(i=a(r.features[s],r.features[s].selected,"click"))):(r.addFeatures([t]),t.selected=!0,t.style=o,a&&(i=a(t,t.selected,"click"))),r.redraw(),i&&n._sandbox.notifyAll(i)}}},beforegetfeatureinfo:function(){},nogetfeatureinfo:function(){}}}),n._map.addControl(n._getFeatureControlSelect),n._modeVisible&&n._getFeatureControlSelect.activate(),s.opacity=e.getOpacity()/100,n._map.addLayer(s),n._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for StatsLayer "+e.getId()),t?n._map.setLayerIndex(s,n._map.layers.length):n._map.setLayerIndex(s,0)}},_afterModeChangedEvent:function(e){this._modeVisible=e.isModeVisible();var t=this._map.getLayersByName("Stats Draw Layer")[0];this._modeVisible?this.activateControls():(this.deactivateControls(),t&&t.removeAllFeatures(),this._removePopup())},_clearHilights:function(){var e,t=this._map.getLayersByName("Stats Draw Layer")[0];if(t)for(e=0;e<t.features.length;e++)t.features[e].style=null,this._highlightCtrl.highlight(t.features[e]);t.redraw(),this._removePopup()},_hilightFeatures:function(e){var t=e.getCodes(),i=this._map.getLayersByName("Stats Draw Layer")[0];if("undefined"!=typeof i){var n,a=this.featureAttribute;n=OpenLayers.Util.applyDefaults(n,OpenLayers.Feature.Vector.style["default"]),n.fillColor="#ff0000",n.strokeColor="#ff3333",n.strokeWidth=3,n.fillOpacity=.2;var r,s;for(r in t)if(t.hasOwnProperty(r))for(s=0;s<i.features.length;s++)if(i.features[s].attributes[a]===r&&t[r]){i.features[s].style=n,this._highlightCtrl.highlight(i.features[s]);break}i.redraw()}},_afterMapLayerRemoveEvent:function(e){var t=this,i=e.getMapLayer();i.isLayerOfType(t._layerType)&&(t._removeMapLayerFromMap(i),t._highlightCtrl.deactivate(),t._getFeatureControlHover.deactivate(),t._getFeatureControlSelect.deactivate(),t._map.removeControl(t._highlightCtrl),t._map.removeControl(t._getFeatureControlHover),t._map.removeControl(t._getFeatureControlSelect),t._map.removeLayer(t._statsDrawLayer))},_mapLayerVisibilityChangedEvent:function(e){var t=e.getMapLayer();"STATS"===t._layerType&&(this._statsDrawLayer.setVisibility(t.isVisible()),this._modeVisible&&(t.isVisible()?(this._getFeatureControlHover.activate(),this._getFeatureControlSelect.activate()):(this._getFeatureControlHover.deactivate(),this._getFeatureControlSelect.deactivate())))},_removeMapLayerFromMap:function(e){if(e.isLayerOfType(this._layerType)){var t=this.getOLMapLayers(e);t[0].destroy()}},getOLMapLayers:function(e){return e.isLayerOfType(this._layerType)?this._map.getLayersByName("layer_"+e.getId()):null},_removePopup:function(e){e=e||this._popup,e&&this._map.removePopup(e)},_addPopup:function(e){var t=e.features[0].attributes.kuntanimi;this._popup=new OpenLayers.Popup("mapstatsHover",this._map.getLonLatFromPixel(new OpenLayers.Pixel(e.xy.x+5,e.xy.y+5)),new OpenLayers.Size(100,100),t),this._popup.autoSize=!0,this._popup.opacity=.8,this._map.addPopup(this._popup);var i=this._sandbox.getRequestBuilder("StatsGrid.TooltipContentRequest");if(i){var n=i(e.features[0]);this._sandbox.request(this,n)}},_afterHoverTooltipContentEvent:function(e){var t=e.getContent();this._popup&&this._popup.setContentHTML(t)},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType(this._layerType)){this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var i=this.getOLMapLayers(t);null!==i[0]&&void 0!==i[0]&&i[0].setOpacity(t.getOpacity()/100)}},_afterStatsVisualizationChangeEvent:function(e){var t=e.getLayer(),i=e.getParams(),n=this.getOLMapLayers(t);this.featureAttribute=i.VIS_ATTR,null!==n&&void 0!==n&&n[0].mergeNewParams({VIS_ID:i.VIS_ID,VIS_NAME:i.VIS_NAME,VIS_ATTR:i.VIS_ATTR,VIS_CLASSES:i.VIS_CLASSES,VIS_COLORS:i.VIS_COLORS,LAYERS:i.VIS_NAME})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapstats/plugin/StatsLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.domain.StatsLayer",function(){this._layerType="STATS"},{setWmsName:function(e){this._wmsName=e},getWmsName:function(){return this._wmsName},setFilterPropertyName:function(e){this._filterPropertyName=e},getFilterPropertyName:function(){return this._filterPropertyName},setCategoryMappings:function(e){this._categoryMappings=e},getCategoryMappings:function(){return this._categoryMappings}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),define("bundles/framework/bundle/mapstats/domain/StatsLayer",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.domain.StatsLayerModelBuilder",function(e){this.localization=Oskari.getLocalization("MapStats"),this.sandbox=e},{parseLayerData:function(e,t){var i=this;e.setWmsName(t.wmsName),t.visualizations&&e.setFilterPropertyName(t.visualizations[0].filterproperty);var n=Oskari.clazz.builder("Oskari.mapframework.domain.Tool"),a=n(),r=i.localization.tools.table_icon;if(a.setName("table_icon"),a.setTitle(r.title),a.setTooltip(r.tooltip),a.setCallback(function(){i.sandbox.postRequestByName("StatsGrid.StatsGridRequest",[!0,e])}),e.addTool(a),e.setCategoryMappings({categories:["KUNTA","ALUEHALLINTOVIRASTO","MAAKUNTA","NUTS1","SAIRAANHOITOPIIRI","SEUTUKUNTA","ERVA","ELY-KESKUS"],wmsNames:{KUNTA:"oskari:kunnat2013",ALUEHALLINTOVIRASTO:"oskari:avi",MAAKUNTA:"oskari:maakunta",NUTS1:"oskari:nuts1",SAIRAANHOITOPIIRI:"oskari:sairaanhoitopiiri",SEUTUKUNTA:"oskari:seutukunta",ERVA:"oskari:erva-alueet","ELY-KESKUS":"oskari:ely"},filterProperties:{KUNTA:"kuntakoodi",ALUEHALLINTOVIRASTO:"avi_nro",MAAKUNTA:"maakuntanro",NUTS1:"code",SAIRAANHOITOPIIRI:"sairaanhoitopiirinro",SEUTUKUNTA:"seutukuntanro",ERVA:"erva_numero","ELY-KESKUS":"ely_nro"}}),e.getMetadataIdentifier()){var s=n();s.setName("info_icon"),s.setIconCls("icon-info"),s.setCallback(function(){var t="catalogue.ShowMetadataRequest",n=e.getMetadataIdentifier(),a=[],r={};r[n]=!0;var s,o,l=e.getSubLayers();if(l&&l.length>0)for(s=0;s<l.length;s+=1)o=l[s].getMetadataIdentifier(),o&&""!==o&&!r[o]&&(r[o]=!0,a.push({uuid:o}));i.sandbox.postRequestByName(t,[{uuid:n},a])}),e.addTool(s)}}}),define("bundles/framework/bundle/mapstats/domain/StatsLayerModelBuilder",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.event.StatsVisualizationChangeEvent",function(e,t){this._layer=e,this._params=t},{getName:function(){return"MapStats.StatsVisualizationChangeEvent"},getLayer:function(){return this._layer},getParams:function(){return this._params}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapstats/event/StatsVisualizationChangeEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.event.FeatureHighlightedEvent",function(e,t,i){this._feature=e,this._highlighted=t,this._highlightType=i},{getName:function(){return"MapStats.FeatureHighlightedEvent"},getFeature:function(){return this._feature},isHighlighted:function(){return this._highlighted},getHighlighType:function(){return this._highlightType}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapstats/event/FeatureHighlightedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapstats.event.HoverTooltipContentEvent",function(e){this._content=e},{getName:function(){return"MapStats.HoverTooltipContentEvent"},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapstats/event/HoverTooltipContentEvent",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapstats/css/mapstats.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"MapStats",value:{tools:{table_icon:{tooltip:"Siirry teemakarttoihin",title:"Teemakartat"},diagram_icon:{tooltip:"Näytä tiedot diagrammissa",title:"Diagrammi"},statistics:{tooltip:"siirry teemakarttoihin",title:"Tilastot"}}}}),define("bundles/framework/bundle/mapstats/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"MapStats",value:{tools:{table_icon:{tooltip:"Gå till temakartor",title:"Temakartor"},diagram_icon:{tooltip:"Öppna diagram",title:"Diagram"},statistics:{tooltip:"går till temakartor",title:"Statistik"}}}}),define("bundles/framework/bundle/mapstats/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"MapStats",value:{tools:{table_icon:{tooltip:"Go to thematic maps",title:"Thematic maps"},diagram_icon:{tooltip:"Show diagram",title:"Diagram"},statistics:{tooltip:"going to the thematic maps",title:"Statistics"}}}}),define("bundles/framework/bundle/mapstats/locale/en",function(){}),define("src/framework/mapstats/module",["oskari","jquery","bundles/framework/bundle/mapstats/plugin/StatsLayerPlugin","bundles/framework/bundle/mapstats/domain/StatsLayer","bundles/framework/bundle/mapstats/domain/StatsLayerModelBuilder","bundles/framework/bundle/mapstats/event/StatsVisualizationChangeEvent","bundles/framework/bundle/mapstats/event/FeatureHighlightedEvent","bundles/framework/bundle/mapstats/event/HoverTooltipContentEvent","css!resources/framework/bundle/mapstats/css/mapstats.css","bundles/framework/bundle/mapstats/locale/fi","bundles/framework/bundle/mapstats/locale/sv","bundles/framework/bundle/mapstats/locale/en"],function(e){return e.bundleCls("mapstats").category({create:function(){return null},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}})}),Oskari.clazz.define("Oskari.mapframework.mapmodule.VectorLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"VectorLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("vectorlayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("vectorlayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);var t;for(t in this.eventHandlers)e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n=this._sandbox;for(t=0,i=e.length;i>t;t++){var a=e[t],r=a.getId();a.isLayerOfType("VECTOR")&&(n.printDebug("preselecting "+r),this.addMapLayerToMap(a,!0,a.isBaseLayer()))}},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",function(){this.read=function(e){return e}})},addMapLayerToMap:function(e,t){if(e.isLayerOfType("VECTOR")){var i=new OpenLayers.StyleMap,n={styleMap:i},a=e.getStyledLayerDescriptor();if(a){this._sandbox.printDebug(a);var r=this._sldFormat.read(a),s=r.namedLayers[0].userStyles,o=s[0];i.styles["default"]=o}var l=new OpenLayers.Layer.Vector("layer_"+e.getId(),n);l.opacity=e.getOpacity()/100,this._map.addLayer(l),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(l,this._map.layers.length):this._map.setLayerIndex(l,0)}},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("VECTOR")){this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var i=this._map.getLayersByName("layer_"+t.getId());null!==i[0]&&void 0!==i[0]&&i[0].setOpacity(t.getOpacity()/100)}},removeMapLayerFromMap:function(e){if(e.isLayerOfType("VECTOR")){var t=this._map.getLayersByName("layer_"+e.getId());t[0].destroy()}},getOLMapLayers:function(e){return e.isLayerOfType("VECTOR")?this._map.getLayersByName("layer_"+e.getId()):void 0},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer(),i=e.getMimeType(),n=e.getFeatures(),a=e.getOp(),r=this._map.getLayersByName("layer_"+t.getId())[0];if(r){a&&"replace"==a&&r.removeFeatures(r.features);var s=this._supportedFormats[i];if(s){var o=s.read(n);r.addFeatures(o)}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/vectorlayer/VectorLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.GeoLocationPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._locationIsSet=!1},{__name:"GeoLocationPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!1},init:function(){},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._setupLocation()},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},hasSetLocation:function(){return this._locationIsSet},_setupLocation:function(){var e=this,t=function(t,i){var n=e.getMapModule().transformCoordinates(new OpenLayers.LonLat(t,i),"EPSG:4326");e.getMapModule().centerMap(n,6),e._locationIsSet=!0};if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(e){var i=e.coords.latitude,n=e.coords.longitude;t(n,i)},function(){},{maximumAge:36e5,timeout:6e3});else if("function"==typeof window.geoip_latitude&&"function"==typeof window.geoip_longitude){var i=geoip_latitude(),n=geoip_longitude();t(n,i)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/location/GeoLocationPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.drawControls=null,this.drawLayer=null,this.editMode=!1,this.currentDrawMode=null,this.prefix="DrawPlugin.",this.creatorId=void 0,e&&e.id&&(this.prefix=e.id+".",this.creatorId=e.id),e&&e.graphicFill&&(this.graphicFill=e.graphicFill),this.multipart=e&&e.multipart===!0},{__name:"DrawPlugin",getName:function(){return this.prefix+this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e?(this._map=e.getMap(),this.pluginName=e.getName()+this.__name):(this._map=null,this.pluginName=null)},startDrawing:function(e){if(this._map.raiseLayer(this.drawLayer,1e3),e.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else if(this.drawLayer.destroyFeatures(),e.geometry){this.editMode=!0;var t=[new OpenLayers.Feature.Vector(e.geometry)];this.drawLayer.addFeatures(t),this.modifyControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this.toggleControl(e.drawMode)},stopDrawing:function(){this.toggleControl(),this.drawLayer&&this.drawLayer.destroyFeatures()},forceFinishDraw:function(){try{this.finishedDrawing(!0)}catch(e){this.stopDrawing();var t=this._sandbox.getEventBuilder("DrawPlugin.SelectedDrawingEvent"),i=t(null,null,this.creatorId);this._sandbox.notifyAll(i)}},finishedDrawing:function(e){if(!this.multipart||e){var t,i,n=this._getActiveDrawControls();for(t=0;t<n.length;t++)if(typeof this.drawControls[n[t]].handler.finishGeometry==typeof Function){switch(n[t]){case"line":if(this.drawControls.line.handler.line.geometry.components.length<2)continue;break;case"area":if(i=this.drawControls.area.handler.polygon.geometry.components,i[i.length-1].components.length<3)continue}this.drawControls[n[t]].handler.finishGeometry()}this.toggleControl()}if(!this.editMode){var a=this.drawLayer.features.length-1;this.modifyControls.select.select(this.drawLayer.features[a])}var r,s;!this.multipart||e?(r=this._sandbox.getEventBuilder("DrawPlugin.FinishedDrawingEvent"),s=r(this.getDrawing(),this.editMode,this.creatorId),this._sandbox.notifyAll(s)):(r=this._sandbox.getEventBuilder("DrawPlugin.AddedFeatureEvent"),s=r(this.getDrawing(),this.currentDrawMode,this.creatorId),this._sandbox.notifyAll(s))},toggleControl:function(e){this.currentDrawMode=e;var t,i;for(t in this.drawControls)this.drawControls.hasOwnProperty(t)&&(i=this.drawControls[t],e===t?i.activate():i.deactivate())},init:function(e){var t=this;if(this.requestHandlers={startDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",e,t),stopDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",e,t),getGeometryHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",e,t)},this.drawLayer=new OpenLayers.Layer.Vector(this.prefix+"DrawLayer",{eventListeners:{featuresadded:function(){t.finishedDrawing()},vertexmodified:function(){t._sendActiveGeometry(t.getDrawing())}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Path,{callbacks:{modify:function(e,i){t._sendActiveGeometry(t.getActiveDrawing(i.geometry),"line")}}}),area:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Polygon,{handlerOptions:{holeModifier:"altKey"},callbacks:{modify:function(e,i){t._sendActiveGeometry(t.getActiveDrawing(i.geometry),"area")}}}),box:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}})},null!==this.graphicFill&&void 0!==this.graphicFill){var i,n=this.graphicFill,a=new OpenLayers.Format.SLD,r=a.read(n);if(r&&r.namedLayers)for(i in r.namedLayers)if(r.namedLayers.hasOwnProperty(i)){this.drawLayer.styleMap.styles["default"]=r.namedLayers[i].userStyles[0],this.drawLayer.redraw();break}}this.modifyControls={modify:new OpenLayers.Control.ModifyFeature(t.drawLayer,{standalone:!0})},this.modifyControls.select=new OpenLayers.Control.SelectFeature(t.drawLayer,{onBeforeSelect:this.modifyControls.modify.beforeSelectFeature,onSelect:this.modifyControls.modify.selectFeature,onUnselect:this.modifyControls.modify.unselectFeature,scope:this.modifyControls.modify}),this._map.addLayers([t.drawLayer]);var s;for(s in this.drawControls)this.drawControls.hasOwnProperty(s)&&this._map.addControl(this.drawControls[s]);for(s in this.modifyControls)this.modifyControls.hasOwnProperty(s)&&this._map.addControl(this.modifyControls[s]);this.modifyControls.modify.activate()},getDrawing:function(){if(0===this.drawLayer.features.length)return null;var e=this.drawLayer.features[0].geometry.CLASS_NAME;if("OpenLayers.Geometry.MultiPoint"===e||"OpenLayers.Geometry.MultiLineString"===e||"OpenLayers.Geometry.MultiPolygon"===e)return this.drawLayer.features[0].geometry;var t,i,n=null,a=[];for(t=0;t<this.drawLayer.features.length;t++)i=this.drawLayer.features[t].geometry,"OpenLayers.Geometry.Polygon"===i.CLASS_NAME&&i.components.length&&"OpenLayers.Geometry.LinearRing"===i.components[0].CLASS_NAME&&i.components[0].components.length<4||a.push(i);switch(e){case"OpenLayers.Geometry.Point":n=new OpenLayers.Geometry.MultiPoint(a);break;case"OpenLayers.Geometry.LineString":n=new OpenLayers.Geometry.MultiLineString(a);break;case"OpenLayers.Geometry.Polygon":n=new OpenLayers.Geometry.MultiPolygon(a)}return n},getActiveDrawing:function(e){var t,i=this.getDrawing();return null!==i&&void 0!==i?(t=i.clone(),t.addComponent(e),t):e},_getActiveDrawControls:function(){var e,t=[];for(e in this.drawControls)this.drawControls.hasOwnProperty(e)&&this.drawControls[e].active&&t.push(e);return t},_sendActiveGeometry:function(e,t){var i,n,a=this._sandbox.getEventBuilder("DrawPlugin.ActiveDrawingEvent");if(null===t||void 0===t)switch(n=e.CLASS_NAME){case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.MultiLineString":t="line";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.MultiPolygon":t="area";break;default:return}a&&(i=a(e,t,this.creatorId),this._sandbox.notifyAll(i))},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this),e.addRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.addRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.addRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler)},stopPlugin:function(e){this.toggleControl(),this.drawLayer&&(this.drawLayer.destroyFeatures(),this._map.removeLayer(this.drawLayer),this.drawLayer=void 0),e.removeRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.removeRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.removeRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler),e.unregister(this),this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.AddedFeatureEvent",function(e,t,i){this._drawing=e,this._drawingMode=t,this._creatorId=i},{__name:"DrawPlugin.AddedFeatureEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawingMode:function(){return this._drawingMode},getCreatorId:function(){return this._creatorId}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.FinishedDrawingEvent",function(e,t,i){this._drawing=e,this._modification=1==t,this._creatorId=i},{__name:"DrawPlugin.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification},getCreatorId:function(){return this._creatorId}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.SelectedDrawingEvent",function(e,t,i){this._creator=null,this._place=e,this._dblClick=t,this._creatorId=i},{__name:"DrawPlugin.SelectedDrawingEvent",getName:function(){return this.__name},getPlace:function(){return this._place},isDblClick:function(){return this._dblClick},getCreatorId:function(){return this._creatorId}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.ActiveDrawingEvent",function(e,t,i){this._drawing=e,this._drawMode=t,this._creatorId=i},{__name:"DrawPlugin.ActiveDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawMode:function(){return this._drawMode},getCreatorId:function(){return this._creatorId}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/ActiveDrawingEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequest",function(e){this._creator=null,this._callbackMethod=e},{__name:"DrawPlugin.GetGeometryRequest",getName:function(){return this.__name},getCallBack:function(){return this._callbackMethod}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var i=t.getCallBack();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler] geometry requested");var n=this.drawPlugin.getDrawing();i(n.geometry)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequest",function(e){if(e.geometry)this._geometry=e.geometry;else if(e.continueCurrent)this._continueCurrent=e.continueCurrent;else{if(!this.drawModes[e.drawMode])throw"Unknown draw mode '"+e.drawMode+"'";this._drawMode=e.drawMode}},{__name:"DrawPlugin.StartDrawingRequest",getName:function(){return this.__name},isModify:function(){return this._continueCurrent},drawModes:{point:"point",line:"line",area:"area",cut:"cut",box:"box"},getDrawMode:function(){return this._drawMode
},getGeometry:function(){return this._geometry}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var i=t.getDrawMode();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler] Start Drawing: "+i),this.drawPlugin.startDrawing({drawMode:t.getDrawMode(),geometry:t.getGeometry(),isModify:t.isModify(),style:""})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequest",function(e){this._creator=null,this._isCancel=1==e},{__name:"DrawPlugin.StopDrawingRequest",getName:function(){return this.__name},isCancel:function(){return this._isCancel===!0}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler] Stop drawing"),t.isCancel()?this.drawPlugin.stopDrawing():this.drawPlugin.forceFinishDraw()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequest",function(e,t){this._op=e,this._data=t||{}},{__name:"Toolbar.ToolContainerRequest",getName:function(){return this.__name},getOp:function(){return this._op},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){e.getSandbox();"set"==t.getOp()?this._toolbar.setToolContent(t.getData()):"reset"==t.getOp()&&this._toolbar.resetToolContent(t.getData())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.RealtimePlugin",function(e){this.minRefreshRate=1e3,this.maxRefreshRate=1/0,this.ignoredLayerTypes=[],this.mapModule=void 0,this.pluginName=void 0,this.sandbox=void 0,this.intervals=void 0,this.config={minRefreshRate:this.minRefreshRate,maxRefreshRate:this.maxRefreshRate,ignoredLayerTypes:this.ignoredLayerTypes},e=e||{};for(var t in e)e.hasOwnProperty(t)&&(this.config[t]=e[t])},{__name:"RealtimePlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!1},register:function(){},unregister:function(){},init:function(){},start:function(){},stop:function(){},startPlugin:function(e){this.sandbox=e,this.intervals={},e.register(this);for(var t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){for(var t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this.sandbox=void 0,this.intervals=void 0},eventHandlers:{AfterMapLayerAddEvent:function(e){var t=e.getMapLayer();t.isRealtime()&&this._isNotIgnored(t)&&this._setInterval(t)},AfterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();t.isRealtime()&&this._isNotIgnored(t)&&this._clearInterval(t)},MapLayerEvent:function(e){var t=e.getOperation(),i=this.sandbox.findMapLayerFromSelectedMapLayers(e.getLayerId());"update"===t&&i&&i.isRealtime()&&this._isNotIgnored(i)&&this._resetInterval(i)},MapLayerVisibilityChangedEvent:function(e){var t=e.getMapLayer(),i=t.isVisible(),n=e.isInScale(),a=e.isGeometryMatch(),r=!i||!n||!a;t.isRealtime()&&this._isNotIgnored(t)&&this._resetInterval(t,r)},AfterMapMoveEvent:function(){this._resetEveryInterval()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];return t?t.apply(this,[e]):void 0},_getInterval:function(e){return this.intervals[""+e.getId()]},_setInterval:function(e){void 0===this._getInterval(e)&&(this.intervals[""+e.getId()]=this._createInterval(e))},_createInterval:function(e){var t,i=this,n=i.sandbox,a=this._getRefreshRate(e.getRefreshRate()),r=n.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),s=r?r(e.getId(),!0):void 0,o=n.getEventBuilder("Realtime.RefreshLayerEvent"),l=o?o(e):void 0;return t=setInterval(function(){s&&n.request(i,s),l&&n.notifyAll(l)},a)},_clearInterval:function(e){var t=this._getInterval(e);void 0!==t&&(clearInterval(t),delete this.intervals[""+e.getId()])},_resetInterval:function(e,t){this._clearInterval(e),t||this._setInterval(e)},_resetEveryInterval:function(){var e=this,t=e.sandbox;_.chain(this.intervals).keys().map(function(e){return t.findMapLayerFromSelectedMapLayers(e)}).filter(function(e){return e&&e.isRealtime()}).each(function(t){e._resetInterval(t)})},_getRefreshRate:function(e){var t=this.config.minRefreshRate||this.minRefreshRate,i=this.config.maxRefreshRate||this.maxRefreshRate;return _.min([_.max([1e3*e,t]),i])},_isNotIgnored:function(e){return!_.any(this.config.ignoredLayerTypes,function(t){return e.isLayerOfType(t)})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/realtime/RealtimePlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.RealtimePlugin.event.RefreshLayerEvent",function(e){this._layer=e},{__name:"Realtime.RefreshLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._layer}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/realtime/event/RefreshLayerEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ToolSelectionRequest",function(e){this._toolId=e},{tools:{navigate:"map_control_navigate_tool",zoom:"map_control_zoom_tool",previous:"map_control_tool_prev",next:"map_control_tool_prev",measure:"map_control_measure_tool",measure_area:"map_control_measure_area_tool",select:"map_control_select_tool",draw_area:"map_control_draw_area_tool"},__name:"ToolSelectionRequest",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(e){this._toolId=e},getNamespace:function(){return-1==this._toolId.indexOf(".")?"":this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){return-1==this._toolId.indexOf(".")?this._toolId:this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/ToolSelectionRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ToolSelectionHandler",function(e,t){this.sandbox=e,this.controlsPlugin=t},{handleRequest:function(e,t){var i,n=(t.getToolId(),t.getNamespace(),t.getToolName());if("map_control_tool_prev"===n)i=this.sandbox.findRegisteredModuleInstance("StateHandler"),i&&i.historyMovePrevious();else if("map_control_tool_next"===n)i=this.sandbox.findRegisteredModuleInstance("StateHandler"),i&&i.historyMoveNext();else if("map_control_select_tool"===n){var a=this.sandbox.findRegisteredModuleInstance("SketchLayerPlugin");a&&a.clearBbox()}else"map_control_zoom_tool"===n&&this.controlsPlugin._zoomBoxTool?this.controlsPlugin._zoomBoxTool.activate():"map_control_measure_tool"===n&&this.controlsPlugin._measureControls?this.controlsPlugin._measureControls.line.activate():"map_control_measure_area_tool"===n&&this.controlsPlugin._measureControls&&this.controlsPlugin._measureControls.area.activate()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/controls/ToolSelectionHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequest",function(e,t,i){this._layerId=e,this._forced=1==t,this._parameters=i},{__name:"MapModulePlugin.MapLayerUpdateRequest",getName:function(){return this.__name},getLayerId:function(){return this._layerId},isForced:function(){return this._forced},getParameters:function(){return this._parameters},setParameters:function(e){this._parameters=e}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var i,n,a,r=t.getLayerId(),s=t.isForced(),o=t.getParameters(),l=this.sandbox,u=l.findMapLayerFromSelectedMapLayers(r);if(u)if(o&&u.isLayerOfType("WMS")){if(n=this.mapModule.getOLMapLayers(r),a=0,n)for(a=n.length,i=0;i<n.length;++i)n[i].mergeNewParams(o);this.sandbox.printDebug("[MapLayerUpdateRequestHandler] WMS layer / merge new params: "+r+", found "+a)}else{if(n=this.mapModule.getOLMapLayers(r),a=0,n)for(a=n.length,i=0;i<n.length;++i)n[i].redraw(s);this.sandbox.printDebug("[MapLayerUpdateRequestHandler] Layer / update layer "+r+", found "+a)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var i=t.getCenterX(),n=t.getCenterY(),a=t.getZoom(),r=t.getSrsName(),s=new OpenLayers.LonLat(i,n);if(r&&this.mapModule.getProjection()!==r){var o=Proj4js.defs[r];if(!o)throw"SrsName not supported!";s=this.mapModule.transformCoordinates(s,r)}this.mapModule.moveMapToLanLot(s,a,!1),(a||0===a)&&("OpenLayers.Bounds"===a.CLASS_NAME?this.mapModule.zoomToExtent(a):this.mapModule.zoomTo(a)),this.sandbox.printDebug("[MapMoveRequestHandler] map moved")}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/request/MapMoveRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapClickedEvent",function(e,t,i){this._lonlat=e,this._mouseX=t,this._mouseY=i},{__name:"MapClickedEvent",getName:function(){return this.__name},getLonLat:function(){return this._lonlat},getMouseX:function(){return this._mouseX},getMouseY:function(){return this._mouseY}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/MapClickedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.EscPressedEvent",function(){},{__name:"EscPressedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/EscPressedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.GetInfoResultEvent",function(e){this._data=e},{__name:"GetInfoResultEvent",getName:function(){return this.__name},getData:function(){return this._data}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/GetInfoResultEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapSizeChangedEvent",function(e,t){this._width=e,this._height=t},{__name:"MapSizeChangedEvent",getName:function(){return this.__name},getWidth:function(){return this._width},getHeight:function(){return this._height}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/event/MapSizeChangedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.templates={},this.element=null,this.__parent=null,this._slider=null,this._zoombar_messages={},this._suppressEvents=!1,this.conf=e},{__name:"Portti2Zoombar",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},getElement:function(){return this.element},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){this.templates.main=jQuery('<div class="oskariui mapplugin pzbDiv zoombar" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar"><div class="pzbDiv-plus"></div><input type=\'hidden\' /><div class="slider"></div><div class="pzbDiv-minus"></div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._draw(),i._setZoombarValue(i._map.getZoom())},stopPlugin:function(){var e,t=this;t.element&&(t.element.remove(),t._slider.remove(),delete t.element);for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._sandbox=null},_draw:function(){var e=this;e.__parent||(e.__parent=e._map.div),e.element||(e.element=e.templates.main.clone());var t="pzb-input-"+e.getName(),i="pzb-slider-"+e.getName(),n=e.element.find("div.slider"),a="top right",r=2;e.element.find("input").attr("id",t),n.attr("id",i),e.element.mousedown(function(t){e.isInLayerToolsEditMode||t.stopPropagation()}),e.conf&&e.conf.location&&(a=e.conf.location.classes||a,r=e.conf.location.position||r),e.getMapModule().setMapControlPlugin(e.element,a.replace("with-panbuttons",""),r),n=e.element.find("div.slider"),n.css("height",11*e._map.getNumZoomLevels()+"px"),e._slider=n.slider({orientation:"vertical",range:"min",min:0,max:e._map.getNumZoomLevels()-1,value:e._map.getZoom(),slide:function(t,i){e.getMapModule().zoomTo(i.value)}});var s=e.element.find(".pzbDiv-plus");s.bind("click",function(){e.isInLayerToolsEditMode||e._slider.slider("value")<e._map.getNumZoomLevels()&&e.getMapModule().zoomTo(e._slider.slider("value")+1)});var o=e.element.find(".pzbDiv-minus");o.bind("click",function(){e.isInLayerToolsEditMode||e._slider.slider("value")>0&&e.getMapModule().zoomTo(e._slider.slider("value")-1)}),e.conf&&e.conf.toolStyle&&e.changeToolStyle(e.conf.toolStyle,e.element),e._setLayerToolsEditMode(e.getMapModule().isInLayerToolsEditMode())},_setZoombarValue:function(e){var t=this;t._slider&&(this._suppressEvents=!0,t._slider.slider("value",e),this._suppressEvents=!1)},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,2)},eventHandlers:{AfterMapMoveEvent:function(e){if(this._sandbox){var t=this;t._setZoombarValue(e.getZoom())}},LayerToolsEditModeEvent:function(e){this._sandbox&&this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){this.isInLayerToolsEditMode=e,this._slider&&this.isInLayerToolsEditMode?this._slider.slider("option","disabled",!0):this._slider&&this._slider.slider("option","disabled",!1)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(){},stop:function(){},changeToolStyle:function(e,t){if(t=t||this.element,e&&t){var i=this.getMapModule().getImageUrl(),n=i+"/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/",a=e.val,r=n+"zoombar-"+a+".png",s=n+"zoombar-cursor-"+a+".png",o=n+"zoombar_minus-"+a+".png",l=n+"zoombar_plus-"+a+".png",u=t.find(".ui-slider-vertical"),c=t.find(".ui-slider-handle"),d=t.find(".pzbDiv-plus"),h=t.find(".pzbDiv-minus"),p=t.find("div.slider"),f=a&&a.match(/^rounded/),m=this._map.getNumZoomLevels()*e.heightCenter;null===e.val?(u.css({"background-image":"",width:"","margin-left":""}),c.css({"background-image":"",width:"",height:"","margin-left":""}),d.css({"background-image":"",width:"",height:""}),h.css({"background-image":"",width:"",height:""}),p.css({height:m+"px"})):(u.css({"background-image":'url("'+r+'")',width:e.widthCenter,"margin-left":"0"}),c.css({"background-image":'url("'+s+'")',width:e.widthCursor,height:e.heightCursor,"margin-left":f?"2px":"0"}),d.css({"background-image":'url("'+l+'")',width:e.widthPlus,height:e.heightPlus}),h.css({"background-image":'url("'+o+'")',width:e.widthMinus,height:e.heightMinus}),p.css({height:m+"px"}))}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/zoombar/Portti2Zoombar",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/zoombar/css/porttizoombar.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapping.mapmodule.AbstractMapLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._supportedFormats={},this.tileSize=[256,256]},{getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin(this.getLayerTypeIdentifier(),this)},unregister:function(){this.getMapModule().setLayerPlugin(this.getLayerTypeIdentifier(),null)},init:function(){},startPlugin:function(e){this._sandbox=e,e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerAddEvent:function(e){var t=e.getMapLayer();t.isLayerOfType(this.getLayerTypeSelector())&&this._afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();t.isLayerOfType(this.getLayerTypeSelector())&&this._afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();t.isLayerOfType(this.getLayerTypeSelector())&&this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer();t.isLayerOfType(this.getLayerTypeSelector())&&this._afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this._sandbox,i=0;i<e.length;i++){var n=e[i],a=n.getId();n.isLayerOfType(this.getLayerTypeSelector())&&(t.printDebug("preselecting "+a),this._addMapLayerToMap(n,!0,n.isBaseLayer()))}},_afterMapLayerAddEvent:function(e){this._addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this._removeMapLayerFromMap(t)},getOLMapLayers:function(e){if(!e.isLayerOfType(this.getLayerTypeSelector()))return null;if(e.isBaseLayer()||e.isGroupLayer()){if(e.getSubLayers().length>0){for(var t=[],i=0;i<e.getSubLayers().length;i++){var n=this.mapModule.getLayersByName("basemap_"+e.getSubLayers()[i].getId());t.push(n[0])}return t}return this.mapModule.getLayersByName("layer_"+e.getId())}return this.mapModule.getLayersByName("layer_"+e.getId())},getLayerTypeSelector:function(){return void 0},getLayerTypeIdentifier:function(){return void 0},_addMapLayerToMap:function(){},_removeMapLayerFromMap:function(){},_afterChangeMapLayerOpacityEvent:function(){},_afterChangeMapLayerStyleEvent:function(){},__name:"OVERRIDETHIS"},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("src/mapping/mapmodule/AbstractMapLayerPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.templates={},t.element=null,t.__parent=null,t.conf=e},{__name:"PanButtons",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},getElement:function(){return this.element},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){var e=(new Date).getTime().toString();this.templates.main=jQuery('<div class="mapplugin panbuttonDiv panbuttons" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"><div>  <img class="panbuttonDivImg" usemap="#panbuttons_'+e+'">    <map name="panbuttons_'+e+'">      <area shape="circle" class="panbuttons_center" coords="45,45,20" href="#">      <area shape="polygon" class="panbuttons_left" coords="13,20,25,30,20,45,27,65,13,70,5,45" href="#">      <area shape="polygon" class="panbuttons_up" coords="30,8,45,4,60,8,60,23,45,20,30,23" href="#">      <area shape="polygon" class="panbuttons_right" coords="79,20,67,30,72,45,65,65,79,70,87,45" href="#">      <area shape="polygon" class="panbuttons_down" coords="30,82,45,86,60,82,60,68,45,70,30,68" href="#">    </map>  </img></div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);this._draw()},stopPlugin:function(){var e,t=this;t.element&&(t.element.remove(),delete t.element);for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(this)},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,0)},_draw:function(){var e=this;e.__parent||(e.__parent=this._map.div),e.element||(e.element=e.templates.main.clone());var t=e.element,i="top right",n=0;e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.mapModule.setMapControlPlugin(t,i,n);var a=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",r=t.find(".panbuttonDivImg");r.attr("src",a+"empty.png"),e.conf&&e.conf.toolStyle&&e.changeToolStyle(e.conf.toolStyle,t);var s=t.find(".panbuttons_center");s.bind("mouseover",function(){r.addClass("root")}),s.bind("mouseout",function(){r.removeClass("root")}),s.bind("click",function(){if(!e.isInLayerToolsEditMode){var t="StateHandler.SetStateRequest",i=e.getMapModule(),n=i.getSandbox(),a=n.getRequestBuilder(t);a?n.request(e,a()):n.resetState()}});var o=t.find(".panbuttons_left");o.bind("mouseover",function(){r.addClass("left")}),o.bind("mouseout",function(){r.removeClass("left")}),o.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(-100,0,!0)});var l=t.find(".panbuttons_right");l.bind("mouseover",function(){r.addClass("right")}),l.bind("mouseout",function(){r.removeClass("right")}),l.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(100,0,!0)});var u=t.find(".panbuttons_up");u.bind("mouseover",function(){r.addClass("up")}),u.bind("mouseout",function(){r.removeClass("up")}),u.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(0,-100,!0)});var c=t.find(".panbuttons_down");c.bind("mouseover",function(){r.addClass("down")}),c.bind("mouseout",function(){r.removeClass("down")}),c.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(0,100,!0)}),t.mousedown(function(t){if(!e.isInLayerToolsEditMode){var i=Math.round(.5*r[0].width),n=r.offset(),a=n.left+i,s=n.top+i;Math.sqrt(Math.pow(a-t.pageX,2)+Math.pow(s-t.pageY,2))<i&&t.stopPropagation()}}),this.isInLayerToolsEditMode=e.getMapModule().isInLayerToolsEditMode()},eventHandlers:{LayerToolsEditModeEvent:function(e){this.isInLayerToolsEditMode=e.isInMode()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(){},stop:function(){},changeToolStyle:function(e,t){if(t=t||this.element){var i=t.find("img.panbuttonDivImg");if(null===e)i.removeAttr("style");else{var n=this.getMapModule().getImageUrl(),a=n+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",r=a+"panbutton-sprites-"+e+".png";i.css({"background-image":'url("'+r+'")'})}}}},{protocol:['Oskari.mapframework.module.Module", "Oskari.mapframework.ui.module.common.mapmodule.Plugin']}),define("bundles/framework/bundle/mapmodule-plugin/plugin/panbuttons/PanButtons",function(){}),define("src/mapping/mapmodule/ol2/mapmodule-plugin/plugin/panbuttons/PanButtons",["bundles/framework/bundle/mapmodule-plugin/plugin/panbuttons/PanButtons"],function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapmodule-plugin/css/mapmodule.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"bg",key:"MapModule",value:{status_update_map:"Актуализиране на картата",zoombar_tooltip:{"zoomLvl-0":"Фон карта","zoomLvl-1":"Страна","zoomLvl-2":"Област","zoomLvl-3":"","zoomLvl-4":"Град","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Част от град","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Улица","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Условия на ползване",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Източник на данни",popup:{title:"Източници на данни",content:"NOT TRANSLATED"},button:{close:"Затваряне"}},LayerSelectionPlugin:{title:"Данни за обекта",chooseDefaultBaseLayer:"Избиране на картен слой за фон"},SearchPlugin:{placeholder:"Търсене на места",search:"Търсене",title:"Резултати от търсенето",close:"Затваряне на резултатите от търсенето",noresults:"Не са намерени резултати",toomanyresults:"Намерени са повече от 100 резултата. Моля, прецизирайте търсенето си",column_name:"Име",column_village:"Община",column_type:"Тип"},GetInfoPlugin:{title:"Картни слоеве",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/bg",function(){}),Oskari.registerLocalization({lang:"cs",key:"MapModule",value:{status_update_map:"Aktualizace mapy",zoombar_tooltip:{"zoomLvl-0":"Mapa pozadí","zoomLvl-1":"Stát","zoomLvl-2":"Provincie","zoomLvl-3":"","zoomLvl-4":"Město","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Městská část","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulice","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Podmínky užití"},DataSourcePlugin:{link:"Datový zdroj",popup:{title:"Datové zdroje",content:" "},button:{close:"Zavřít"}},LayerSelectionPlugin:{title:"Objektová data",chooseDefaultBaseLayer:"Vyberte vrstvu pozadí mapy"},SearchPlugin:{placeholder:"Vyhledat místa",search:"Vyhledat",title:"Výsledky vyhledávání",close:"Zavřít výsledky hledání",noresults:"Žádné výsledky nenalezeny",toomanyresults:"Nalezeno více než 100 výsledků. Specifikujte dotaz podrobněji.",column_name:"Jméno",column_village:"Obec",column_type:"Typ"},GetInfoPlugin:{title:"NOT TRANSLATED",layer:"NOT TRANSLATED",places:"Místa",description:"Popis",link:"URL-adresa",name:"Jméno"}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"MapModule",value:{status_update_map:"Opdaterer kort",zoombar_tooltip:{"zoomLvl-0":"Baggrundskort","zoomLvl-1":"Land","zoomLvl-2":"Provins","zoomLvl-3":"","zoomLvl-4":"By","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Bydel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Gade/vej","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Brugsbetingelser",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Datakilde",popup:{title:"Datakilde",content:"NOT TRANSLATED"},button:{close:"Luk"}},LayerSelectionPlugin:{title:"Objektdata",chooseDefaultBaseLayer:"Vælg bagrundskortlag"},SearchPlugin:{placeholder:"Find steder",search:"Find",title:"Søgeresultater",close:"Luk søgeresultater",noresults:"Ingen resultater fundet",toomanyresults:"Over 100 resultater blev fundet, specificer din søgning yderligere",column_name:"Navn",column_village:"Kommune",column_type:"Type"},GetInfoPlugin:{title:"Kortlag",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"MapModule",value:{status_update_map:"Karte wird aktualisiert",zoombar_tooltip:{"zoomLvl-0":"Hintergrundkarte","zoomLvl-1":"Land","zoomLvl-2":"Region","zoomLvl-3":"","zoomLvl-4":"Stadt","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadtteil","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Straße","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Nutzungsbedingungen"},DataSourcePlugin:{link:"Datenquelle",popup:{title:"Datenquellen",content:" "},button:{close:"Schließen"}},LayerSelectionPlugin:{title:"Objektdaten",chooseDefaultBaseLayer:"Hintergrundkarte wählen"},SearchPlugin:{placeholder:"Finde Orte",search:"Finde",title:"Suchergebnisse",close:"Liste der Suchergebnisse schließen",noresults:"Keine Ergebnisse gefunden",toomanyresults:"Über 100 Ergebnisse gefunden. Bitte verfeinern Sie Ihre Suche.",column_name:"Name",column_village:"Gemeinde",column_type:"Typ"},GetInfoPlugin:{title:"Kartenebenen",layer:"NOT TRANSLATED",places:"Orte",description:"Beschreibung",link:"URL-addresse",name:"Name"}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/de",function(){}),Oskari.registerLocalization({lang:"el",key:"MapModule",value:{status_update_map:"Ανανέωση χάρτη",zoombar_tooltip:{"zoomLvl-0":"Υπόβαθρο","zoomLvl-1":"Χώρα","zoomLvl-2":"Διοικητικό Διαμέρισμα","zoomLvl-3":"","zoomLvl-4":"Πόλη","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Τμήμα πόλης","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Οδός","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Όροι χρήσης",dataSources:"Πηγές δεδομένων",layersHeader:"Επίπεδα χάρτη",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Πηγή δεδομένων",popup:{title:"Πηγές δεδομένων",content:" "},button:{close:"Κλείσιμο"}},LayerSelectionPlugin:{title:"Ψηφιδωτά δεδομένα",chooseDefaultBaseLayer:"Επιλογή υποβάθρου"},SearchPlugin:{placeholder:"Αναζήτηση τοποθεσιών",search:"Αναζήτηση",title:"NOT TRANSLATED",close:"Κλείσιμο αποτελεσμάτων αναζήτησης",noresults:"Δεν βρέθηκαν αποτελέσματα",toomanyresults:"Βρέθηκαν πάνω από 100 αποτελέσματα. Παρακαλούμε ξανακαθορίστε την αναζήτησή σας λεπτομερέστερα.",column_name:"Όνομα",column_village:"Δήμος",column_type:"Τύπος/Πληκτρολογήστε (ανάλογα με την περίπτωση)"},GetInfoPlugin:{title:"Επίπεδα χάρτη",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"Περιγραφή",link:"NOT TRANSLATED",name:"Όνομα"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"Πίσω",next:"Επόμενο"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/el",function(){}),Oskari.registerLocalization({lang:"en",key:"MapModule",value:{status_update_map:"Loading the map...",zoombar_tooltip:{"zoomLvl-0":"Background map","zoomLvl-1":"Country","zoomLvl-2":"Province","zoomLvl-3":"","zoomLvl-4":"Town","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Part of town","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Street","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Terms of Use",dataSources:"Data sources",layersHeader:"Map Layers",indicatorsHeader:"Indicators"},DataSourcePlugin:{link:"Data source",popup:{title:"Data Sources",content:"NOT TRANSLATED"},button:{close:"Close"}},LayerSelectionPlugin:{title:"Map layers",chooseDefaultBaseLayer:"Select the background map"},SearchPlugin:{placeholder:"Search location",search:"Search",title:"Search Results",close:"Close search results.",noresults:"No results found. Please refine your search.",toomanyresults:"Over 100 results found. Please refine your search.",column_name:"Name",column_village:"Municipality",column_type:"Type"},GetInfoPlugin:{title:"Feature Data",layer:"Map layer",places:"Features",description:"Description",link:"Web address",name:"Name"},PublisherToolbarPlugin:{test:"test",history:{reset:"Return to the default view",back:"Return to the previous view",next:"Move to the next view"},measure:{line:"Measure a distance",area:"Measure an area"}},MarkersPlugin:{buttons:{add:"Map marker",clear:"Delete all markers"},form:{title:"Point feature style",tooltip:"",symbol:{label:"Icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom colour (RGB 0-255)"},preview:{label:"Preview"},message:{label:"The text on the map",hint:"Write a text to be shown on the map."}},dialog:{title:"Map marker",message:"Select a new location for the marker by clicking the map."}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"MapModule",value:{status_update_map:"Actualizando mapa",zoombar_tooltip:{"zoomLvl-0":"Mapa de fondo","zoomLvl-1":"País","zoomLvl-2":"Provincia","zoomLvl-3":"","zoomLvl-4":"Ciudad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Parte de una ciudad","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Calle","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Términos de uso",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Fuente de datos",popup:{title:"Fuentes de datos",content:"NOT TRANSLATED"},button:{close:"Cerrar"}},LayerSelectionPlugin:{title:"Datos del objeto",chooseDefaultBaseLayer:"Seleccionar capa de fondo"},SearchPlugin:{placeholder:"Encontrar sitios",search:"Encontrar",title:"Resultados de la búsqueda",close:"Cerrar resultados de búsqueda",noresults:"No se encontraron resultados",toomanyresults:"Más de 100 resultados encontrados. Por favor, refine la búsqueda",column_name:"Nombre",column_village:"Municipio",column_type:"Tipo"},GetInfoPlugin:{title:"Capas",layer:"Layer",places:"Sitios",description:"Descripción",link:"URL-address",name:"Nombre"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"MapModule",value:{status_update_map:"Kaardi uuendamine",zoombar_tooltip:{"zoomLvl-0":"Aluskaart","zoomLvl-1":"Riik","zoomLvl-2":"Maakond","zoomLvl-3":"","zoomLvl-4":"Linn","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Linnaosa","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Tänav","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Kasutustingimused",dataSources:"Andmete allikad",layersHeader:"Kaardikihid",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Andmete allikas",popup:{title:"Andmete allikad",content:" "},button:{close:"Sulge"}},LayerSelectionPlugin:{title:"Objekti andmed",chooseDefaultBaseLayer:"Vali aluskaardi kiht"},SearchPlugin:{placeholder:"Leia kohad",search:"Leia",title:"Otsingutulemused",close:"Sulge otsingutulemused",noresults:"Otsingutulemusi ei leitud",toomanyresults:"Leiti üle 100 otsingutulemuse. Palun täpsusta otsingut.",column_name:"Name",column_village:"Omavalitsus",column_type:"Tüüp"},GetInfoPlugin:{title:"Kaardikihid",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"Nimi"},PublisherToolbarPlugin:{test:"test",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"MapModule",value:{status_update_map:"Päivitetään karttaa",zoombar_tooltip:{"zoomLvl-0":"Taustakartta","zoomLvl-1":"Koko maa","zoomLvl-2":"Maakunta","zoomLvl-3":"","zoomLvl-4":"Kunta","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Kunnanosa","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Katu","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Käyttöehdot",dataSources:"Tietolähteet",layersHeader:"Karttatasot",indicatorsHeader:"Indikaattorit"},DataSourcePlugin:{link:"Aineiston lähde",popup:{title:"Tietolähteet",content:"NOT TRANSLATED"},button:{close:"Sulje"}},LayerSelectionPlugin:{title:"Karttatasot",chooseDefaultBaseLayer:"Valitse taustakartta"},SearchPlugin:{placeholder:"Hae kohteita paikannimen tai osoitteen perusteella.",search:"Hae",title:"Paikkahaun tulokset",close:"Sulje hakutulokset",noresults:"Antamallasi hakusanalla ei löytynyt yhtään kohdetta.",toomanyresults:"Hakusi tuotti yli 100 hakutulosta. Anna tarkempi hakusana.",column_name:"Nimi",column_village:"Kunta",column_type:"Tyyppi"},GetInfoPlugin:{title:"Kohdetiedot",layer:"Karttataso",places:"Kohteet",description:"Kuvaus",link:"Verkko-osoite",name:"Nimi"},PublisherToolbarPlugin:{test:"testi",history:{reset:"Paluu oletusnäkymään",back:"Takaisin",next:"Eteenpäin"},measure:{line:"Mittaa etäisyys",area:"Mittaa alue"}},MarkersPlugin:{buttons:{add:"Karttamerkintä",clear:"Poista kaikki merkinnät"},form:{title:"Pistekohteen esitystapa",tooltip:"",symbol:{label:"Pistekohteen kuvake"},size:{label:"Koko"},color:{label:"Väri",labelOr:"tai",labelCustom:"Oma RGB-väri (0-255)"},preview:{label:"Esikatselu"},message:{label:"Viesti",hint:"Kirjoita viestiteksti"}},dialog:{title:"Karttamerkintä",message:"Valitse kartalta uusi sijainti klikkaamalla."}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/fi",function(){}),Oskari.registerLocalization({lang:"hr",key:"MapModule",value:{status_update_map:"Ažuriranje karte",zoombar_tooltip:{"zoomLvl-0":"Karta pozadine","zoomLvl-1":"Zemlja","zoomLvl-2":"Pokrajina","zoomLvl-3":"","zoomLvl-4":"Grad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Dio grada","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Uvjeti korištenja",dataSources:"Izvori podataka",layersHeader:"Slojevi karte",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Izvor podataka",popup:{title:"Izvori podataka",content:" "},button:{close:"Zatvori"}},LayerSelectionPlugin:{title:"Podaci o objektu",chooseDefaultBaseLayer:"Odaberi sloj karte pozadine"},SearchPlugin:{placeholder:"Nađi mjesta",search:"Nađi  ",title:"Rezultati pretraživanja",close:"Zatvori rezultate pretraživanja",noresults:"Nisu pronađeni rezultati",toomanyresults:"Pronađeno je preko 100 rezultata. Precizirajte pretraživanje.",column_name:"Ime",column_village:"Općina",column_type:"Tip"},GetInfoPlugin:{title:"Slojevi karte",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"Ime"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"MapModule",value:{status_update_map:"Térkép frissítés",zoombar_tooltip:{"zoomLvl-0":"Háttértérkép","zoomLvl-1":"Ország","zoomLvl-2":"Tartomány","zoomLvl-3":"","zoomLvl-4":"Város","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Városrész","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Utca","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Felhasználási feltételek",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Adatforrás",popup:{title:"Adatforrások",content:"NOT TRANSLATED"},button:{close:"Bezárás"}},LayerSelectionPlugin:{title:"Objektum adatai",chooseDefaultBaseLayer:"Háttértérképréteg kiválasztása."},SearchPlugin:{placeholder:"Helyek keresése",search:"Keresés",title:"Keresési eredmények",close:"Keresési eredmények bezárása.",noresults:"Nincs találat.",toomanyresults:"Több mint 100 találat. Kérem pontosítsa a keresést.",column_name:"Név",column_village:"Település",column_type:"Típus"},GetInfoPlugin:{title:"Térképrétegek",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/hu",function(){}),Oskari.registerLocalization({lang:"hy",key:"MapModule",value:{status_update_map:"Թարմացվող քարտեզ",zoombar_tooltip:{"zoomLvl-0":"Ֆոնային քարտեզ","zoomLvl-1":"Երկիր","zoomLvl-2":"Շրջան","zoomLvl-3":"","zoomLvl-4":"Քաղաք","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Տեղանք քաղաքից","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Փողոց","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Օգտագործվող տերմիններ",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Տվյալների աղբյուր",popup:{title:"Տվյալների աղբյուրներ",content:"NOT TRANSLATED"},button:{close:"Փակել"}},LayerSelectionPlugin:{title:"Օբյեկտի տվյալներ",chooseDefaultBaseLayer:"Ընտրել ֆոնային քարտեզի շերտը"},SearchPlugin:{placeholder:"Որոնել տեղանք",search:"Որոնում",title:"Որոնման արդյունքներ",close:"Փակել որոնման արդյունքները",noresults:"Ոչ մի արդյուք չի գտնվել",toomanyresults:"Գտնվել է 100-ից ավել արդյունք: խնդրում ենք մանրամասնել Ձեր որոնումը",column_name:"Անվանում",column_village:"Համայնք",column_type:"Տեսակ"},GetInfoPlugin:{title:"Քարտեզի շերտ",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/hy",function(){}),Oskari.registerLocalization({lang:"ka",key:"MapModule",value:{status_update_map:"რუკის განახლება",zoombar_tooltip:{"zoomLvl-0":"ფონური რუკა","zoomLvl-1":"ქვეყანა","zoomLvl-2":"პროვინცია","zoomLvl-3":"","zoomLvl-4":"ქალაქი","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"ქალაქის ნაწილი","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"ქუჩა","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"გამოყენების პირობები",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"მონაცემთა წყარო",popup:{title:"მონაცემთა წყაროები",content:"NOT TRANSLATED"},button:{close:"დახურვა"}},LayerSelectionPlugin:{title:"გრაფიკული ობიექტი",chooseDefaultBaseLayer:"ფონური რუკის ფენის შერჩევა"},SearchPlugin:{placeholder:"ადგილის ძებნა",search:"ძებნა",title:"NOT TRANSLATED",close:"ძებნის შედეგების დახურვა",noresults:"შედეგები არ მოიძებნა",toomanyresults:"მოძებნილია 100–ზე მეტი ობიექტი. გთხოვთ, დააზუსტეთ ძებნა",column_name:"დასახელება",column_village:"მუნიციპალიტეტი",column_type:"ტიპი"},GetInfoPlugin:{title:"რუკის ფენები",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/ka",function(){}),Oskari.registerLocalization({lang:"lv",key:"MapModule",value:{status_update_map:"Kartes atjaunināšana",zoombar_tooltip:{"zoomLvl-0":"Fona karte","zoomLvl-1":"Valsts","zoomLvl-2":"Province","zoomLvl-3":"","zoomLvl-4":"Pilsēta","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"NOT TRANSLATED","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Iela","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Lietošanas noteikumi",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Datu avots",popup:{title:"Datu avoti",content:"NOT TRANSLATED"},button:{close:"Aizvērt"}},LayerSelectionPlugin:{title:"Objekta dati",chooseDefaultBaseLayer:"Izvēlēties fona kartes slāni"},SearchPlugin:{placeholder:"Atrast vietas",search:"Atrast",title:"Meklēšanas rezultāti",close:"Aizvērt meklēšanas rezultātus",noresults:"Rezultāti nav atrasti",toomanyresults:"Atrasti vairāk kā 100 rezultāti. Lūdzu precizējiet meklēšanas kritērijus",column_name:"Nosaukums",column_village:"Pašvaldība",column_type:"Tips"},GetInfoPlugin:{title:"Kartes slāņi",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"MapModule",value:{status_update_map:"Kaart aan het vernieuwen",zoombar_tooltip:{"zoomLvl-0":"Achtergrondkaart","zoomLvl-1":"Land","zoomLvl-2":"Provincie","zoomLvl-3":"","zoomLvl-4":"Stad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadsdeel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Straat","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Gebruiksvoorwaarden",dataSources:"Gegevensbronnen",layersHeader:"Kaartlagen",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Gegevensbron",popup:{title:"Gegevensbronnen",content:" "},button:{close:"Sluiten"}},LayerSelectionPlugin:{title:"Objectgegevens",chooseDefaultBaseLayer:"Selecteer achtergrondkaartlaag"},SearchPlugin:{placeholder:"Vind plaatsen",search:"Vinden",title:"Zoekresultaten",close:"Sluit zoekresultaten",noresults:"Geen resultaten gevonden",toomanyresults:"Meer dan 100 resultaten gevonden. Verfijn uw zoekopdracht.",column_name:"Naam",column_village:"Gemeente",column_type:"Type"},GetInfoPlugin:{title:"Kaartlagen",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"Beschrijving",link:"NOT TRANSLATED",name:"Naam"},PublisherToolbarPlugin:{test:"test",history:{reset:"Terug naar standaardweergave",back:"Terug",next:"Verder"},measure:{line:"Meet afstand",area:"Meet gebied"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"MapModule",value:{status_update_map:"Aktualizacja Mapy",zoombar_tooltip:{"zoomLvl-0":"Mapa Źródłowa","zoomLvl-1":"Kraj","zoomLvl-2":"Prowincja/Województwo","zoomLvl-3":"","zoomLvl-4":"Miasto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Część miasta","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Zasady korzystania",dataSources:"Źródła danych",layersHeader:"Warstwy map",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Źródło danych",popup:{title:"Źródła danych",content:" "},button:{close:"Zakończ"}},LayerSelectionPlugin:{title:"Dane obiektu",chooseDefaultBaseLayer:"Wybierz żródłowa warstwę mapy"},SearchPlugin:{placeholder:"Znajdź miejsca",search:"Znajdź",title:"Wyniki Wyszukiwania",close:"Zamknij wyniki wyszukiwania",noresults:"Brak wyników",toomanyresults:"Ponad 100 wyników. Proszę doprecyzować zapytanie.",column_name:"Nazwa",column_village:"Gmina",column_type:"Typ"},GetInfoPlugin:{title:"Warstwy map",layer:"NOT TRANSLATED",places:"Miejsca",description:"Opis",link:"NOT TRANSLATED",name:"Nazwa"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"Powrót do domyślnego widoku",back:"Cofnij",next:"Następny"},measure:{line:"Pomiar odległości",area:"Pomiar powierzchni"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"MapModule",value:{status_update_map:"A atualizar",zoombar_tooltip:{"zoomLvl-0":"Carta de fundo","zoomLvl-1":"País","zoomLvl-2":"Região","zoomLvl-3":"","zoomLvl-4":"Localidade","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Parte de localidade","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Rua","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Termos de utilização",dataSources:"Fontes de dados",layersHeader:"Camadas",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Fonte de dados",popup:{title:"Fontes de dados",content:"NOT TRANSLATED"},button:{close:"Fechar"}},LayerSelectionPlugin:{title:"Objetos",chooseDefaultBaseLayer:"Selecionar carta de fundo"},SearchPlugin:{placeholder:"Encontrar lugares",search:"Encontrar",title:"Resultados da pesquisa",close:"Fechar resultados da pesquisa",noresults:"Sem resultados",toomanyresults:"Mais de 100 resultados. Restrinja a pesquisa",column_name:"Nome",column_village:"Concelho",column_type:"Tipo"},GetInfoPlugin:{title:"Camadas",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"Descrição",link:"NOT TRANSLATED",name:"Nome"},PublisherToolbarPlugin:{test:"test",history:{reset:"Voltar à vista padrão",back:"Voltar",next:"Seguinte"},measure:{line:"Medir distância",area:"Medir área"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"MapModule",value:{status_update_map:"Actualizare hartă",zoombar_tooltip:{"zoomLvl-0":"Hartă suport","zoomLvl-1":"Ţară","zoomLvl-2":"Provincie","zoomLvl-3":"","zoomLvl-4":"Oraş","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Zonă a oraşului","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Stradă","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Termeni de folosinţă",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Sursa de date",popup:{title:"Surse de date",content:"NOT TRANSLATED"},button:{close:"Închidere"}},LayerSelectionPlugin:{title:"Date obiect",chooseDefaultBaseLayer:"Selectare strat de hartă suport"},SearchPlugin:{placeholder:"Căutare locaţii",search:"Căutare",title:"Căutare Rezultate",close:"Închide rezultatele căutării",noresults:"Nu au fost găsite rezultate",toomanyresults:"Peste 100 de rezultate găsite. Vă rugăm revizuiţi căutarea",column_name:"Nume",column_village:"Municipalitate",column_type:"Tip"},GetInfoPlugin:{title:"Straturi de hartă",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/ro",function(){}),Oskari.registerLocalization({lang:"sk",key:"MapModule",value:{status_update_map:"Aktualizácia mapy",zoombar_tooltip:{"zoomLvl-0":"Podkladová mapa","zoomLvl-1":"Krajina","zoomLvl-2":"Oblasť","zoomLvl-3":"","zoomLvl-4":"Mesto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Mestská časť","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Podmienky používania",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Zdroj údajov",popup:{title:"Zdroje údajov",content:"NOT TRANSLATED"},button:{close:"Zatvoriť"}},LayerSelectionPlugin:{title:"Údaje o objekte",chooseDefaultBaseLayer:"Zvoliť mapovú vrstvu podkladovej mapy"},SearchPlugin:{placeholder:"Nájsť umiestnenia",search:"Nájsť",title:"Vyhľadať Výsledky",close:"Zavrieť výsledky vyhľadávania",noresults:"Nenašli sa žiadne výsledky",toomanyresults:"Našlo sa vyše 100 výsledkov. Spresnite vyhľadávanie, prosím",column_name:"Názov",column_village:"Obec",column_type:"Typ"},GetInfoPlugin:{title:"Mapové vrstvy",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/sk",function(){}),Oskari.registerLocalization({lang:"sl",key:"MapModule",value:{status_update_map:"Posodabljanje karte",zoombar_tooltip:{"zoomLvl-0":"Karta za ozadje","zoomLvl-1":"Država","zoomLvl-2":"Provinca","zoomLvl-3":"","zoomLvl-4":"Mesto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Del mesta","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Pogoji uporabe",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Vir podatkov",popup:{title:"Viri podatkov",content:"NOT TRANSLATED"},button:{close:"Zapri"}},LayerSelectionPlugin:{title:"Objektni podatek",chooseDefaultBaseLayer:"Izberi karto za ozadje"},SearchPlugin:{placeholder:"Išči kraje",search:"Išči",title:"Rezultati iskanja",close:"Zapri rezultate iskanja",noresults:"Ni rezultatov",toomanyresults:"Najdenih je bilo več kot 100 rezultatov. Prosimo omejite iskanje.",column_name:"Ime",column_village:"Občina",column_type:"Tip"},GetInfoPlugin:{title:"Sloj karte",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/sl",function(){}),Oskari.registerLocalization({lang:"sq",key:"MapModule",value:{status_update_map:"Azhurnimi i hartës",zoombar_tooltip:{"zoomLvl-0":"Harta në sfond","zoomLvl-1":"Vendi","zoomLvl-2":"Provinca","zoomLvl-3":"","zoomLvl-4":"Qyteti","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Pjesa e qytetit","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Rruga","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Kushtet e përdorimit",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Burimi i të dhënave",popup:{title:"Burimet e të dhënave",content:"NOT TRANSLATED"},button:{close:"Mbyll"}},LayerSelectionPlugin:{title:"Të dhënat e objektit",chooseDefaultBaseLayer:"Zgjidh shtresën e hartës në sfond"},SearchPlugin:{placeholder:"Gjej vende",search:"Gjej",title:"Rezultatet e kërkimit",close:"Mbyll rezultatet e kërkimit",noresults:"Asnjë rezultat i gjetur",toomanyresults:"Mbi 100 rezultate të gjetura. Ju lutem përmirësojeni kërkimin tuaj",column_name:"Emri",column_village:"Komuna",column_type:"Lloji"},GetInfoPlugin:{title:"Shtresat e hartës",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/sq",function(){}),Oskari.registerLocalization({lang:"sv",key:"MapModule",value:{status_update_map:"Uppdaterar kartan",zoombar_tooltip:{"zoomLvl-0":"Bakgrundskarta","zoomLvl-1":"Hela landet","zoomLvl-2":"Landskap","zoomLvl-3":"","zoomLvl-4":"Kommun","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadsdel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Gata","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Användningsvillkor",dataSources:"Datakällor",layersHeader:"Kartlager",indicatorsHeader:"Indikator"},DataSourcePlugin:{link:"Datakälla",popup:{title:"Datakällor",content:"NOT TRANSLATED"},button:{close:"Stäng"}},LayerSelectionPlugin:{title:"Kartlager",chooseDefaultBaseLayer:"Välj bottenkarta"},SearchPlugin:{placeholder:"Sök plats/adress",search:"Sök",title:"Sökresultat",close:"Stäng sökresultat",noresults:"Inga träffar",toomanyresults:"Över 100 träffar, avgränsa sökningen.",column_name:"Namn",column_village:"Kommun",column_type:"Typ"},GetInfoPlugin:{title:"Objektuppgifter",layer:"Lagret",places:"Object",description:"Beskrivning",link:"URL-address",name:"Namn"},PublisherToolbarPlugin:{test:"test",history:{reset:"Tillbaka till standardvyn",back:"Föregående",next:"Nästa"},measure:{line:"Mät avstånd",area:"Mät areal"}},MarkersPlugin:{buttons:{add:"NOT TRANSLATED",clear:"NOT TRANSLATED"},form:{title:"NOT TRANSLATED",tooltip:"",symbol:{label:"NOT TRANSLATED"},size:{label:"NOT TRANSLATED"},color:{label:"NOT TRANSLATED",labelOr:"NOT TRANSLATED",labelCustom:"NOT TRANSLATED"},preview:{label:"NOT TRANSLATED"},message:{label:"NOT TRANSLATED",hint:"NOT TRANSLATED"}},dialog:{title:"NOT TRANSLATED",message:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"MapModule",value:{status_update_map:"Оновлення карти",zoombar_tooltip:{"zoomLvl-0":"Основна карта","zoomLvl-1":"Країна","zoomLvl-2":"Область","zoomLvl-3":"","zoomLvl-4":"Місто","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Частина міста","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Вулиця","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Умови використання",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Джерело даних",popup:{title:"Джерела даних",content:"NOT TRANSLATED"},button:{close:"Закрити"}},LayerSelectionPlugin:{title:"Дані об'єкта",chooseDefaultBaseLayer:"Обрати шар основної карти"},SearchPlugin:{placeholder:"Пошук місць",search:"Пошук",title:"Результати пошуку",close:"Закрити результати пошуку",noresults:"Нічого не знайдено",toomanyresults:"Знайдено більше 100 результатів. Будь ласка, уточніть пошук",column_name:"Назва",column_village:"Муніципалітет",column_type:"Тип"},GetInfoPlugin:{title:"Шари карти",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/mapmodule-plugin/locale/uk",function(){}),Oskari.registerLocalization({lang:"fi",key:"Generic",value:{"default-style":"Oletustyyli"}}),define("bundles/framework/bundle/mapfull/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"Generic",value:{"default-style":"Förvald utseende"}}),define("bundles/framework/bundle/mapfull/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"Generic",value:{"default-style":"Default style"}}),define("bundles/framework/bundle/mapfull/locale/en",function(){}),Oskari.registerLocalization({lang:"fi",key:"DivManazer",value:{buttons:{add:"Lisää",cancel:"Peruuta",close:"Poistu","delete":"Poista",edit:"Muokkaa",ok:"OK",save:"Tallenna",search:"Hae"},LanguageSelect:{title:"kieli",tooltip:"Valitse kieli",languages:{af:"afrikaans",ak:"akan",am:"amhara",ar:"arabia",az:"azeri",be:"valkovenäjä",bg:"bulgaria",bm:"bambara",bn:"bengali",bo:"tiibet",br:"bretoni",bs:"bosnia",ca:"katalaani",cs:"tšekki",cy:"kymri",da:"tanska",de:"saksa",dz:"dzongkha",ee:"ewe",el:"kreikka",en:"englanti",eo:"esperanto",es:"espanja",et:"viro",eu:"baski",fa:"farsi",ff:"fulani",fi:"suomi",fo:"fääri",fr:"ranska",fy:"länsifriisi",ga:"iiri",gd:"gaeli",gl:"galicia",gu:"gudžarati",ha:"hausa",he:"heprea",hi:"hindi",hr:"kroatia",hu:"unkari",hy:"armenia",ia:"interlingua",id:"indonesia",ig:"igbo",is:"islanti",it:"italia",ja:"japani",ka:"georgia",ki:"kikuju",kk:"kazakki",kl:"kalaallisut",km:"khmer",kn:"kannada",ko:"korea",ks:"kašmiri",kw:"korni",ky:"kirgiisi",lb:"luxemburg",lg:"ganda",ln:"lingala",lo:"lao",lt:"liettua",lu:"katanganluba",lv:"latvia",mg:"malagassi",mk:"makedonia",ml:"malajalam",mn:"mongoli",mr:"marathi",ms:"malaiji",mt:"malta",my:"burma",nb:"norjan bokmål",nd:"pohjois-ndebele",ne:"nepali",nl:"hollanti",nn:"norjan nynorsk",om:"oromo",or:"orija",os:"osseetti",pa:"pandžabi",pl:"puola",ps:"paštu",pt:"portugali",qu:"ketšua",rm:"retoromaani",rn:"rundi",ro:"romania",ru:"venäjä",rw:"ruanda",se:"pohjoissaame",sg:"sango",si:"sinhala",sk:"slovakki",sl:"sloveeni",sn:"šona",so:"somali",sq:"albania",sr:"serbia",sv:"ruotsi",sw:"swahili",ta:"tamili",te:"telugu",th:"thai",ti:"tigrinja",tn:"tswana",to:"tonga",tr:"turkki",ts:"tsonga",ug:"uiguuri",uk:"ukraina",ur:"urdu",uz:"uzbekki",vi:"vietnam",yi:"jiddiš",yo:"joruba",zh:"kiina",zu:"zulu"}},VisualizationForm:{tooltips:{dot:"Muokkaa pisteen esitystapaa",area:"Muokkaa alueen esitystapaa",line:"Muokkaa viivan esitystapaa"},dot:{title:"Pisteen esitystapa",tooltip:"",symbol:{label:"Symboli"},size:{label:"Koko"},color:{label:"Väri",labelOr:"tai",labelCustom:"Oma RGB-väri (0-255)"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},line:{title:"Viivan esitystapa",tooltip:"",style:{label:"Tyyli"},cap:{label:"Päädyt"},corner:{label:"Kulmat"},width:{label:"Leveys"},color:{label:"Väri",labelOr:"tai",labelCustom:"Oma RGB-väri (0-255)"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},area:{title:"Alueen esitystapa",tooltip:"",linestyle:{label:"Viivan tyyli"},linecap:{label:"Viivan päädyt"},linecorner:{label:"Kulmat"},linewidth:{label:"Leveys"},linecolor:{label:"Viivan väri",labelOr:"tai",labelCustom:"Oma RGB-väri (0-255)"},color:{label:"Täyttöväri",labelOr:"tai",labelCustom:"Oma RGB-väri (0-255)"},fill:{label:"Täyttökuvio"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}}},Grid:{columnSelector:{title:"Ominaisuudet",tooltip:"Näytä sarakkeet"},"export":{title:"Aineiston vienti",csv:"CSV",excel:"Excel"}}}}),define("bundles/framework/bundle/divmanazer/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"DivManazer",value:{buttons:{add:"Tillägg",cancel:"Tillbaka",close:"Avbryta","delete":"Ta bort",edit:"Editera",ok:"OK",save:"Lagra",search:"Sök"},LanguageSelect:{title:"språk",tooltip:"Välj språk",languages:{af:"afrikaans",ak:"akan",am:"amhariska",ar:"arabiska",az:"azerbajdzjanska",be:"vitryska",bg:"bulgariska",bm:"bambara",bn:"bengali",bo:"tibetanska",br:"bretonska",bs:"bosniska",ca:"katalanska",cs:"tjeckiska",cy:"walesiska",da:"danska",de:"tyska",dz:"bhutanesiska",ee:"ewe",el:"grekiska",en:"engelska",eo:"esperanto",es:"spanska",et:"estniska",eu:"baskiska",fa:"persiska",ff:"fulani",fi:"finska",fo:"färöiska",fr:"franska",fy:"västfrisiska",ga:"iriska",gd:"höglandsskotska",gl:"galiciska",gu:"gujarati",ha:"hausa",he:"hebreiska",hi:"hindi",hr:"kroatiska",hu:"ungerska",hy:"armeniska",ia:"interlingua",id:"indonesiska",ig:"igbo",is:"isländska",it:"italienska",ja:"japanska",ka:"georgiska",ki:"kikuyu",kk:"kazakiska",kl:"grönländska",km:"kambodjanska",kn:"kannada",ko:"koreanska",ks:"kashmiriska",kw:"korniska",ky:"kirgisiska",lb:"luxemburgiska",lg:"luganda",ln:"lingala",lo:"laotiska",lt:"litauiska",lu:"luba-katanga",lv:"lettiska",mg:"malagassiska",mk:"makedonska",ml:"malayalam",mn:"mongoliska",mr:"marathi",ms:"malajiska",mt:"maltesiska",my:"burmesiska",nb:"norskt bokmål",nd:"nordndebele",ne:"nepalesiska",nl:"nederländska",nn:"nynorska",om:"oromo",or:"oriya",os:"ossetiska",pa:"punjabi",pl:"polska",ps:"afghanska",pt:"portugisiska",qu:"quechua",rm:"rätoromanska",rn:"rundi",ro:"rumänska",ru:"ryska",rw:"kinjarwanda",se:"nordsamiska",sg:"sango",si:"singalesiska",sk:"slovakiska",sl:"slovenska",sn:"shona",so:"somaliska",sq:"albanska",sr:"serbiska",sv:"svenska",sw:"swahili",ta:"tamil",te:"telugiska",th:"thailändska",ti:"tigrinja",tn:"tswana",to:"tonganska",tr:"turkiska",ts:"tsonga",ug:"uiguriska",uk:"ukrainska",ur:"urdu",uz:"uzbekiska",vi:"vietnamesiska",yi:"jiddisch",yo:"yoruba",zh:"kinesiska",zu:"zulu"}},VisualizationForm:{tooltips:{dot:"Editera punktens stil",area:"Editera områdets stil",line:"Editera linjens stil"},dot:{title:"Visualisering av punktobjekt",tooltip:"Punktens stil",symbol:{label:"Ikon för punktobjekt"},size:{label:"Storlek"},color:{label:"Färg",labelOr:"eller",labelCustom:"Egen RGB-färg (0-255)"},preview:{label:"Förhandsgranska"},buttons:{save:"Lagra",cancel:"Tillbaka"}},line:{title:"Visualisering av linje",tooltip:"",style:{label:"Linjens stil"},cap:{label:"Linjens ändpunkter"},corner:{label:"Hörn"},width:{label:"Bredd"},color:{label:"Färg",labelOr:"eller",labelCustom:"Egen RGB-färg (0-255)"},preview:{label:"Förhandsgranska"},buttons:{save:"Lagra",cancel:"Tillbaka"}},area:{title:"Visualisering av området",tooltip:"",linestyle:{label:"Konturlinjens stil"},linecap:{label:"Linjens ändpunkter"},linecorner:{label:"Hörn"},linewidth:{label:"Bredd"},linecolor:{label:"Linjens färg",labelOr:"eller",labelCustom:"Egen RGB-färg (0-255)"},color:{label:"Ifyllnadsfärg för område",labelOr:"eller",labelCustom:"Egen RGB-färg (0-255)"},fill:{label:"Ifyllnandsmönster för område"},preview:{label:"Förhandsvisning"},buttons:{save:"Lagra",cancel:"Tillbaka"}}},Grid:{columnSelector:{title:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},"export":{title:"NOT TRANSLATED",csv:"CSV",excel:"Excel"}}}}),define("bundles/framework/bundle/divmanazer/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"DivManazer",value:{buttons:{add:"Add",cancel:"Cancel",close:"Close","delete":"Delete",edit:"Edit",ok:"OK",save:"Save",search:"Search"},LanguageSelect:{title:"Language",tooltip:"Select language",languages:{af:"Afrikaans",ak:"Akan",am:"Amharic",ar:"Arabic",az:"Azerbaijani",be:"Belarusian",bg:"Bulgarian",bm:"Bambara",bn:"Bengali",bo:"Tibetan",br:"Breton",bs:"Bosnian",ca:"Catalan",cs:"Czech",cy:"Welsh",da:"Danish",de:"German",dz:"Dzongkha",ee:"Ewe",el:"Greek",en:"English",eo:"Esperanto",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",ff:"Fulah",fi:"Finnish",fo:"Faroese",fr:"French",fy:"Western Frisian",ga:"Irish",gd:"Scottish Gaelic",gl:"Galician",gu:"Gujarati",ha:"Hausa",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",hy:"Armenian",ia:"Interlingua",id:"Indonesian",ig:"Igbo",is:"Icelandic",it:"Italian",ja:"Japanese",ka:"Georgian",ki:"Kikuyu",kk:"Kazakh",kl:"Kalaallisut",km:"Khmer",kn:"Kannada",ko:"Korean",ks:"Kashmiri",kw:"Cornish",ky:"Kyrgyz",lb:"Luxembourgish",lg:"Ganda",ln:"Lingala",lo:"Lao",lt:"Lithuanian",lu:"Luba-Katanga",lv:"Latvian",mg:"Malagasy",mk:"Macedonian",ml:"Malayalam",mn:"Mongolian",mr:"Marathi",ms:"Malay",mt:"Maltese",my:"Burmese",nb:"Norwegian Bokmål",nd:"North Ndebele",ne:"Nepali",nl:"Dutch",nn:"Norwegian Nynorsk",om:"Oromo",or:"Oriya",os:"Ossetic",pa:"Punjabi",pl:"Polish",ps:"Pashto",pt:"Portuguese",qu:"Quechua",rm:"Romansh",rn:"Rundi",ro:"Romanian",ru:"Russian",rw:"Kinyarwanda",se:"Northern Sami",sg:"Sango",si:"Sinhala",sk:"Slovak",sl:"Slovenian",sn:"Shona",so:"Somali",sq:"Albanian",sr:"Serbian",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",th:"Thai",ti:"Tigrinya",tn:"Tswana",to:"Tongan",tr:"Turkish",ts:"Tsonga",ug:"Uyghur",uk:"Ukrainian",ur:"Urdu",uz:"Uzbek",vi:"Vietnamese",yi:"Yiddish",yo:"Yoruba",zh:"Chinese",zu:"Zulu"}},VisualizationForm:{tooltips:{dot:"Edit point feature style",area:"Edit area feature style",line:"Edit line feature style"},dot:{title:"Point feature style",tooltip:"",symbol:{label:"Icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom colour (RGB 0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line feature style",tooltip:"",style:{label:"Dash"},cap:{label:"Endings"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom colour (RGB 0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area feature style",tooltip:"",linestyle:{label:"Line dash"},linecap:{label:"Line endings"},linecorner:{label:"Line corners"},linewidth:{label:"Line width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom colour (RGB 0-255)"},color:{label:"Fill colour",labelOr:"or",labelCustom:"Custom colour (RGB 0-255)"},fill:{label:"Fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}},Grid:{columnSelector:{title:"Properties",tooltip:"NOT TRANSLATED"},"export":{title:"Export data",csv:"CSV",excel:"Excel"}}}}),define("bundles/framework/bundle/divmanazer/locale/en",function(){}),Oskari.registerLocalization({lang:"cs",key:"DivManazer",value:{buttons:{add:"NOT TRANSLATED",cancel:"NOT TRANSLATED",close:"NOT TRANSLATED","delete":"NOT TRANSLATED",edit:"NOT TRANSLATED",ok:"NOT TRANSLATED",save:"NOT TRANSLATED",search:"NOT TRANSLATED"},LanguageSelect:{title:"Jazyk",tooltip:"NOT TRANSLATED",languages:{af:"afrikánština",ak:"akanština",am:"amharština",ar:"arabština",az:"ázerbájdžánština",be:"běloruština",bg:"bulharština",bm:"bambarština",bn:"bengálština",bo:"tibetština",br:"bretonština",bs:"bosenština",ca:"katalánština",cs:"čeština",cy:"velština",da:"dánština",de:"němčina",dz:"dzongkä",ee:"eweština",el:"řečtina",en:"angličtina",eo:"esperanto",es:"španělština",et:"estonština",eu:"baskičtina",fa:"perština",ff:"fulbština",fi:"finština",fo:"faerština",fr:"francouzština",fy:"fríština",ga:"irština",gd:"skotská gaelština",gl:"galicijština",gu:"gudžarátština",ha:"hauština",he:"hebrejština",hi:"hindština",hr:"chorvatština",hu:"maďarština",hy:"arménština",ia:"interlingua",id:"indonéština",ig:"igboština",is:"islandština",it:"italština",ja:"japonština",ka:"gruzínština",ki:"kikujština",kk:"kazaština",kl:"grónština",km:"khmérština",kn:"kannadština",ko:"korejština",ks:"kašmírština",kw:"kornština",ky:"kyrgyzština",lb:"lucemburština",lg:"gandština",ln:"lingalština",lo:"laoština",lt:"litevština",lu:"lubu-katanžština",lv:"lotyština",mg:"malgaština",mk:"makedonština",ml:"malajálamština",mn:"mongolština",mr:"maráthština",ms:"malajština",mt:"maltština",my:"barmština",nb:"norština (bokmål)",nd:"ndebele (Zimbabwe)",ne:"nepálština",nl:"nizozemština",nn:"norština (nynorsk)",om:"oromština",or:"urijština",os:"osetština",pa:"paňdžábština",pl:"polština",ps:"paštština",pt:"portugalština",qu:"kečuánština",rm:"rétorománština",rn:"kirundština",ro:"rumunština",ru:"ruština",rw:"kiňarwandština",se:"sámština (severní)",sg:"sangština",si:"sinhálština",sk:"slovenština",sl:"slovinština",sn:"šonština",so:"somálština",sq:"albánština",sr:"srbština",sv:"švédština",sw:"svahilština",ta:"tamilština",te:"telugština",th:"thajština",ti:"tigrinijština",tn:"setswanština",to:"tongánština",tr:"turečtina",ts:"tsonga",ug:"ujgurština",uk:"ukrajinština",ur:"urdština",uz:"uzbečtina",vi:"vietnamština",yi:"jidiš",yo:"jorubština",zh:"čínština",zu:"zuluština"}},VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}}),define("bundles/framework/bundle/divmanazer/locale/cs",function(){}),Oskari.registerLocalization({lang:"de",key:"DivManazer",value:{buttons:{add:"NOT TRANSLATED",cancel:"NOT TRANSLATED",close:"NOT TRANSLATED","delete":"NOT TRANSLATED",edit:"NOT TRANSLATED",ok:"NOT TRANSLATED",save:"NOT TRANSLATED",search:"NOT TRANSLATED"},LanguageSelect:{title:"Sprache",tooltip:"NOT TRANSLATED",languages:{af:"Afrikaans",ak:"Akan",am:"Amharisch",ar:"Arabisch",az:"Aserbaidschanisch",be:"Weißrussisch",bg:"Bulgarisch",bm:"Bambara-Sprache",bn:"Bengalisch",bo:"Tibetisch",br:"Bretonisch",bs:"Bosnisch",ca:"Katalanisch",cs:"Tschechisch",cy:"Walisisch",da:"Dänisch",de:"Deutsch",dz:"Bhutanisch",ee:"Ewe",el:"Griechisch",en:"Englisch",eo:"Esperanto",es:"Spanisch",et:"Estnisch",eu:"Baskisch",fa:"Persisch",ff:"Ful",fi:"Finnisch",fo:"Färöisch",fr:"Französisch",fy:"Westfriesisch",ga:"Irisch",gd:"Schottisches Gälisch",gl:"Galizisch",gu:"Gujarati",ha:"Hausa",he:"Hebräisch",hi:"Hindi",hr:"Kroatisch",hu:"Ungarisch",hy:"Armenisch",ia:"Interlingua",id:"Indonesisch",ig:"Igbo",is:"Isländisch",it:"Italienisch",ja:"Japanisch",ka:"Georgisch",ki:"Kikuyu",kk:"Kasachisch",kl:"Grönländisch",km:"Kambodschanisch",kn:"Kannada",ko:"Koreanisch",ks:"Kaschmirisch",kw:"Kornisch",ky:"Kirgisisch",lb:"Luxemburgisch",lg:"Ganda",ln:"Lingala",lo:"Laotisch",lt:"Litauisch",lu:"Luba-Katanga",lv:"Lettisch",mg:"Madagassisch",mk:"Mazedonisch",ml:"Malayalam",mn:"Mongolisch",mr:"Marathi",ms:"Malaiisch",mt:"Maltesisch",my:"Birmanisch",nb:"Norwegisch Bokmål",nd:"Nord-Ndebele-Sprache",ne:"Nepalesisch",nl:"Niederländisch",nn:"Norwegisch Nynorsk",om:"Oromo",or:"Oriya",os:"Ossetisch",pa:"Panjabi",pl:"Polnisch",ps:"Paschtu",pt:"Portugiesisch",qu:"Quechua",rm:"Rätoromanisch",rn:"Rundi-Sprache",ro:"Rumänisch",ru:"Russisch",rw:"Ruandisch",se:"Nord-Samisch",sg:"Sango",si:"Singhalesisch",sk:"Slowakisch",sl:"Slowenisch",sn:"Shona",so:"Somali",sq:"Albanisch",sr:"Serbisch",sv:"Schwedisch",sw:"Suaheli",ta:"Tamilisch",te:"Telugu",th:"Thailändisch",ti:"Tigrinja",tn:"Tswana-Sprache",to:"Tongaisch",tr:"Türkisch",ts:"Tsonga",ug:"Uigurisch",uk:"Ukrainisch",ur:"Urdu",uz:"Usbekisch",vi:"Vietnamesisch",yi:"Jiddisch",yo:"Yoruba",zh:"Chinesisch",zu:"Zulu"}},VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}}),define("bundles/framework/bundle/divmanazer/locale/de",function(){}),Oskari.registerLocalization({lang:"es",key:"DivManazer",value:{buttons:{add:"NOT TRANSLATED",cancel:"NOT TRANSLATED",close:"NOT TRANSLATED","delete":"NOT TRANSLATED",edit:"NOT TRANSLATED",ok:"NOT TRANSLATED",save:"NOT TRANSLATED",search:"NOT TRANSLATED"},LanguageSelect:{title:"Idioma",tooltip:"NOT TRANSLATED",languages:{af:"afrikáans",ak:"akan",am:"amárico",ar:"árabe",az:"azerí",be:"bielorruso",bg:"búlgaro",bm:"bambara",bn:"bengalí",bo:"tibetano",br:"bretón",bs:"bosnio",ca:"catalán",cs:"checo",cy:"galés",da:"danés",de:"alemán",dz:"dzongkha",ee:"ewé",el:"griego",en:"inglés",eo:"esperanto",es:"español",et:"estonio",eu:"euskera",fa:"persa",ff:"fula",fi:"finés",fo:"feroés",fr:"francés",fy:"frisón occidental",ga:"irlandés",gd:"gaélico escocés",gl:"gallego",gu:"gujarati",ha:"hausa",he:"hebreo",hi:"hindi",hr:"croata",hu:"húngaro",hy:"armenio",ia:"interlingua",id:"indonesio",ig:"igbo",is:"islandés",it:"italiano",ja:"japonés",ka:"georgiano",ki:"kikuyu",kk:"kazajo",kl:"groenlandés",km:"jemer",kn:"canarés",ko:"coreano",ks:"cachemiro",kw:"córnico",ky:"kirguís",lb:"luxemburgués",lg:"ganda",ln:"lingala",lo:"laosiano",lt:"lituano",lu:"luba-katanga",lv:"letón",mg:"malgache",mk:"macedonio",ml:"malayalam",mn:"mongol",mr:"marathi",ms:"malayo",mt:"maltés",my:"birmano",nb:"bokmal noruego",nd:"ndebele septentrional",ne:"nepalí",nl:"neerlandés",nn:"nynorsk noruego",om:"oromo",or:"oriya",os:"osético",pa:"punjabí",pl:"polaco",ps:"pastún",pt:"portugués",qu:"quechua",rm:"retorrománico",rn:"kiroundi",ro:"rumano",ru:"ruso",rw:"kinyarwanda",se:"sami septentrional",sg:"sango",si:"cingalés",sk:"eslovaco",sl:"esloveno",sn:"shona",so:"somalí",sq:"albanés",sr:"serbio",sv:"sueco",sw:"swahili",ta:"tamil",te:"telugu",th:"tailandés",ti:"tigriña",tn:"setchwana",to:"tongano",tr:"turco",ts:"tsonga",ug:"uigur",uk:"ucraniano",ur:"urdu",uz:"uzbeko",vi:"vietnamita",yi:"yídish",yo:"yoruba",zh:"chino",zu:"zulú"}},VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}}),define("bundles/framework/bundle/divmanazer/locale/es",function(){}),Oskari.clazz.define("Oskari.mapframework.mapmodule.MetadataLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._layer=null,this._supportedFormats={},this._features=null,this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})
},{__name:"MetadataLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("metadatalayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("metadatalayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,a=this.getMapLayer(),r=this._sandbox;for(t=0;t<e.length;t+=1)i=e[t],n=i.getId()+"",i.isLayerOfType("VECTOR")&&a.getId()+""===n&&(r.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},setMapLayer:function(e){this._layer=e},getMapLayer:function(){return this._layer},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",{read:function(e){return e}})},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer(),i=this.getMapLayer();if(t.isLayerOfType("VECTOR")&&t.getId()+""==i.getId()+""){this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var n=this._map.getLayersByName("layer_"+t.getId());(null!==n[0]||void 0!==n[0])&&n[0].setOpacity(t.getOpacity()/100)}},addMapLayerToMap:function(e,t){var i=this.getMapLayer();if(e.isLayerOfType("VECTOR")&&e.getId()+""==i.getId()+""){var n=new OpenLayers.StyleMap,a={styleMap:n},r=e.getStyledLayerDescriptor();if(r){this._sandbox.printDebug(r);var s=this._sldFormat.read(r),o=s.namedLayers[0].userStyles,l=o[0];n.styles["default"]=l}else this._sandbox.printDebug("NO SLD FOUND");var u=new OpenLayers.Layer.Vector("layer_"+e.getId(),a);u.opacity=e.getOpacity()/100,this._map.addLayer(u),this._features&&u.addFeatures(this._features),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(u,this._map.layers.length):this._map.setLayerIndex(u,0)}},removeMapLayerFromMap:function(e){var t=this.getMapLayer();if(e.isLayerOfType("VECTOR")&&e.getId()+""==t.getId()+""){var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}},getOLMapLayers:function(e){if(e.isLayerOfType("VECTOR")){var t=this.getMapLayer();if(e.getId()+""==t.getId()+"")return this._map.getLayersByName("layer_"+e.getId())}},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer();if(null!==t&&void 0!==t){var i=this.getMapLayer();if(t.getId()+""==i.getId()+""){var n=e.getMimeType(),a=e.getFeatures(),r=e.getOp(),s=this._supportedFormats[n];if(s){var o=s.read(a);this._features=o;var l=this._map.getLayersByName("layer_"+t.getId())[0];l&&(r&&"replace"===r&&l.removeFeatures(l.features),l.addFeatures(o))}}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/catalogue/bundle/metadataflyout/plugin/MetadataLayerPlugin",function(){}),define("src/mapping/mapmodule/ol2/mapmodule-plugin/module",["oskari","jquery-ui","src/oskari/base/module","../../AbstractMapModule","../../plugin/AbstractMapModulePlugin","../../plugin/BasicMapModulePlugin","bundles/framework/bundle/mapmodule-plugin/ui/module/map-module","bundles/framework/bundle/mapmodule-plugin/plugin/Plugin","bundles/framework/bundle/mapmodule-plugin/plugin/controls/ControlsPlugin","bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiKeyboard","bundles/framework/bundle/mapmodule-plugin/plugin/controls/OskariNavigation","bundles/framework/bundle/mapmodule-plugin/plugin/controls/OskariPinchZoom","bundles/framework/bundle/mapmodule-plugin/request/DisableMapKeyboardMovementRequest","bundles/framework/bundle/mapmodule-plugin/request/DisableMapMouseMovementRequest","bundles/framework/bundle/mapmodule-plugin/request/EnableMapKeyboardMovementRequest","bundles/framework/bundle/mapmodule-plugin/request/EnableMapMouseMovementRequest","bundles/framework/bundle/mapmodule-plugin/request/MapMovementControlsRequestHandler","src/oskari/base/request/common/show-map-measurement-request","bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoHandler","bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoRequest","bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoActivationRequest","bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetInfoPlugin","bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoFormatter","css!resources/framework/bundle/mapmodule-plugin/plugin/getinfo/css/getinfo.css","bundles/framework/bundle/mapmodule-plugin/plugin/markers/MarkersPlugin","bundles/framework/bundle/mapmodule-plugin/request/AddMarkerRequest","bundles/framework/bundle/mapmodule-plugin/request/AddMarkerRequestHandler","bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkersRequest","bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkersRequestHandler","bundles/framework/bundle/mapmodule-plugin/event/AfterAddMarkerEvent","bundles/framework/bundle/mapmodule-plugin/event/AfterRemoveMarkersEvent","bundles/framework/bundle/mapmodule-plugin/plugin/search/SearchPlugin","bundles/framework/bundle/search/service/searchservice","css!resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css","bundles/framework/bundle/mapmodule-plugin/plugin/logo/LogoPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css","bundles/framework/bundle/mapmodule-plugin/plugin/datasource/DataSourcePlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/datasource/css/datasource.css","bundles/framework/bundle/mapmodule-plugin/plugin/indexmap/IndexMapPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css","bundles/framework/bundle/mapmodule-plugin/plugin/scalebar/ScaleBarPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/scalebar/css/scalebar.css","bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css","bundles/framework/bundle/mapmodule-plugin/plugin/fullscreen/FullScreen","css!resources/framework/bundle/mapmodule-plugin/plugin/fullscreen/css/fullscreen.css","bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayerSelectionPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css","bundles/framework/bundle/mapmodule-plugin/plugin/layers/BackgroundLayerSelectionPlugin","css!resources/framework/bundle/mapmodule-plugin/plugin/layers/css/backgroundlayerselection.css","bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayersPlugin","bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequest","bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequestHandler","bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequest","bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequestHandler","bundles/framework/bundle/mapmodule-plugin/event/MapLayerVisibilityChangedEvent","./plugin/wmslayer/WmsLayerPlugin","mapwmts","mapwfs2","mapstats","bundles/framework/bundle/mapmodule-plugin/plugin/vectorlayer/VectorLayerPlugin","bundles/framework/bundle/mapmodule-plugin/plugin/location/GeoLocationPlugin","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/ActiveDrawingEvent","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler","bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin","bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequest","bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequestHandler","css!resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css","bundles/framework/bundle/mapmodule-plugin/plugin/realtime/RealtimePlugin","bundles/framework/bundle/mapmodule-plugin/plugin/realtime/event/RefreshLayerEvent","bundles/framework/bundle/mapmodule-plugin/request/ToolSelectionRequest","bundles/framework/bundle/mapmodule-plugin/plugin/controls/ToolSelectionHandler","bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequest","bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequestHandler","bundles/framework/bundle/mapmodule-plugin/request/MapMoveRequestHandler","bundles/framework/bundle/mapmodule-plugin/event/MapClickedEvent","bundles/framework/bundle/mapmodule-plugin/event/EscPressedEvent","bundles/framework/bundle/mapmodule-plugin/event/GetInfoResultEvent","bundles/framework/bundle/mapmodule-plugin/event/MapSizeChangedEvent","bundles/framework/bundle/mapmodule-plugin/plugin/zoombar/Portti2Zoombar","css!resources/framework/bundle/mapmodule-plugin/plugin/zoombar/css/porttizoombar.css","../../AbstractMapLayerPlugin","./plugin/panbuttons/PanButtons","css!resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css","css!resources/framework/bundle/mapmodule-plugin/css/mapmodule.css","bundles/framework/bundle/mapmodule-plugin/locale/bg","bundles/framework/bundle/mapmodule-plugin/locale/cs","bundles/framework/bundle/mapmodule-plugin/locale/da","bundles/framework/bundle/mapmodule-plugin/locale/de","bundles/framework/bundle/mapmodule-plugin/locale/el","bundles/framework/bundle/mapmodule-plugin/locale/en","bundles/framework/bundle/mapmodule-plugin/locale/es","bundles/framework/bundle/mapmodule-plugin/locale/et","bundles/framework/bundle/mapmodule-plugin/locale/fi","bundles/framework/bundle/mapmodule-plugin/locale/hr","bundles/framework/bundle/mapmodule-plugin/locale/hu","bundles/framework/bundle/mapmodule-plugin/locale/hy","bundles/framework/bundle/mapmodule-plugin/locale/ka","bundles/framework/bundle/mapmodule-plugin/locale/lv","bundles/framework/bundle/mapmodule-plugin/locale/nl","bundles/framework/bundle/mapmodule-plugin/locale/pl","bundles/framework/bundle/mapmodule-plugin/locale/pt","bundles/framework/bundle/mapmodule-plugin/locale/ro","bundles/framework/bundle/mapmodule-plugin/locale/sk","bundles/framework/bundle/mapmodule-plugin/locale/sl","bundles/framework/bundle/mapmodule-plugin/locale/sq","bundles/framework/bundle/mapmodule-plugin/locale/sv","bundles/framework/bundle/mapmodule-plugin/locale/uk","bundles/framework/bundle/mapfull/locale/fi","bundles/framework/bundle/mapfull/locale/sv","bundles/framework/bundle/mapfull/locale/en","bundles/framework/bundle/divmanazer/locale/fi","bundles/framework/bundle/divmanazer/locale/sv","bundles/framework/bundle/divmanazer/locale/en","bundles/framework/bundle/divmanazer/locale/cs","bundles/framework/bundle/divmanazer/locale/de","bundles/framework/bundle/divmanazer/locale/es","bundles/catalogue/bundle/metadataflyout/plugin/MetadataLayerPlugin"],function(e){return e.bundleCls("mapmodule-plugin").category({create:function(){return this},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}})}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance",function(){this.__name="mapfull",this.map=null,this.core=null,this.sandbox=null,this.mapmodule=null,this.mapDivId="mapdiv",this.contentMapDivId="contentMap"},{getName:function(){return this.__name},getMapModule:function(){return this.mapmodule},getSandbox:function(){return this.sandbox},_createUi:function(){var e=this,t=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",e.conf.imageLocation,e.conf.mapOptions,e.mapDivId);e.mapmodule=t;var i=e.sandbox.register(t);if(e.conf.size)jQuery("#"+e.mapDivId).width(e.conf.size.width),jQuery("#"+e.mapDivId).height(e.conf.size.height);else{var n,a=function(){if(null===e.resizeEnabled||void 0===e.resizeEnabled||e.resizeEnabled){var i=jQuery("#"+e.contentMapDivId),n=jQuery("#"+e.mapDivId),a=jQuery(window).height();i.height(a);var r=i.find(".oskariui-menutoolbar");n.height(r.length>0&&r.is(":visible")?a-r.height():a),t.updateSize()}};jQuery(window).resize(function(){clearTimeout(n),n=setTimeout(a,100)}),a()}if(t.start(e.sandbox),e.nomaprender||i.render(e.mapDivId),e.conf.plugins){var r,s=this.conf.plugins;for(r=0;r<s.length;r++)try{s[r].instance=Oskari.clazz.create(s[r].id,s[r].config,s[r].state),t.registerPlugin(s[r].instance),t.startPlugin(s[r].instance)}catch(o){e.sandbox.printWarn("Unable to start plugin: "+s[r].id+": "+o)}}e.map=i},start:function(){var e=this,t=e.conf;e._handleProjectionDefs(e.conf.projectionDefs);var i=Oskari.clazz.create("Oskari.mapframework.core.Core");e.core=i;var n=i.getSandbox();e.sandbox=n;var a=(t?t.sandbox:null)||"sandbox";Oskari.setSandbox(a,n),jQuery.ajax({type:"POST",url:t.globalMapAjaxUrl+"action_route=GetSupportedLocales",timestamp:(new Date).getTime(),success:function(e){Oskari.setSupportedLocales(e.supportedLocales)},error:function(){}}),t&&(t.mapElement&&(e.mapDivId=t.mapElement),t.mapContainer&&(e.contentMapDivId=t.mapContainer)),n.setUser(t.user),n.setAjaxUrl(t.globalMapAjaxUrl);var r=e._createServices(t),s=[];s.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement")),i.init(r,s),e._createUi();var o,l,u=n.getService("Oskari.mapframework.service.MapLayerService"),c=t.layers;if(c)for(o=0;o<c.length;o++)l=u.createMapLayer(c[o]),l?u.addLayer(l,!0):n.printWarn("MapFullBundleInstance.start: Undefined mapLayer returned for",c[o]);n.registerAsStateful(e.mediator.bundleId,this);var d=!1;if(e.mapmodule.isPluginActivated("GeoLocationPlugin")){var h=e.mapmodule.getPluginInstance("GeoLocationPlugin");d=h.hasSetLocation()}e.setState(e.state,d),e.mapResizeEnabledRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequestHandler",e),e.mapWindowFullScreenRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequestHandler",e),n.addRequestHandler("MapFull.MapResizeEnabledRequest",e.mapResizeEnabledRequestHandler),n.addRequestHandler("MapFull.MapWindowFullScreenRequest",e.mapWindowFullScreenRequestHandler),"undefined"!=typeof Raphael&&Raphael.registerFont({w:512,face:{"font-family":"dot-markers","font-weight":400,"font-stretch":"normal","units-per-em":"512","panose-1":"2 0 5 3 0 0 0 0 0 0",ascent:"480",descent:"-32",bbox:"0 -480 512 32","underline-thickness":"0","underline-position":"0","unicode-range":"U+E000-U+F000"},glyphs:{" ":{},"":{d:"288,-426v-21,-4,-35,-2,-42,5v-2,2,-2,4,-1,7v2,5,5,10,9,18v4,8,6,13,7,15v-3,3,-9,9,-18,17v-13,12,-13,12,-19,18v-7,7,-1,15,18,24v8,4,17,7,26,8v23,5,39,3,49,-5v3,-3,4,-6,3,-9r-9,-18v-4,-9,-4,-10,-8,-18v-3,-6,-4,-9,-5,-11v2,-2,2,-3,11,-11v9,-8,9,-8,15,-14v6,-5,1,-12,-15,-20v-7,-3,-14,-5,-21,-6xm262,-256r9,-48r-12,-2r-9,50r12,0"},"":{d:"320,-427r-127,0r0,126r35,0r28,45r28,-45r36,0r0,-126"},"":{d:"256,-429v-17,0,-30,5,-42,17v-12,12,-18,26,-18,43v0,10,5,24,15,43v10,19,20,35,30,48r15,21v40,-53,60,-90,60,-112v0,-17,-6,-31,-18,-43v-12,-12,-25,-17,-42,-17xm256,-344v-7,0,-12,-2,-17,-7v-5,-5,-7,-10,-7,-17v0,-7,2,-13,7,-18v5,-5,10,-7,17,-7v7,0,13,2,18,7v5,5,7,11,7,18v0,7,-2,12,-7,17v-5,5,-11,7,-18,7"},"":{d:"262,-257r17,-71r-12,-2r-17,73r12,0xm240,-380v0,12,4,22,12,31v8,9,19,13,31,13v12,0,22,-4,31,-13v9,-9,13,-19,13,-31v0,-12,-4,-22,-13,-30v-9,-8,-19,-13,-31,-13v-12,0,-23,5,-31,13v-8,8,-12,18,-12,30"},"":{d:"262,-257r41,-169r-13,0r-40,169r12,0xm164,-427r18,45r-38,44r115,0r21,-89r-116,0"},"":{d:"196,-256v0,17,6,30,18,42v12,12,25,18,42,18v17,0,30,-6,42,-18v12,-12,18,-25,18,-42v0,-17,-6,-30,-18,-42v-12,-12,-25,-18,-42,-18v-17,0,-30,6,-42,18v-12,12,-18,25,-18,42"},"":{d:"284,-331r0,-93r-56,0r0,93r-39,0r67,75r67,-75r-39,0"},"":{d:"0,-480r512,512r-512,0r0,-512",w:0}," ":{}}})},_handleProjectionDefs:function(e){Proj4js.defs={"EPSG:3067":"+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs","EPSG:4326":"+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"},e&&(Proj4js.defs=e)},_teardownState:function(e){var t,i=this.sandbox.findAllSelectedMapLayers(),n=this.sandbox.getRequestBuilder("RemoveMapLayerRequest");for(t=0;t<i.length;t++)this.sandbox.request(e.getName(),n(i[t].getId()))},_createServices:function(e){var t=this,i=[],n=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",e.globalMapAjaxUrl+"action_route=GetMapLayers&lang="+Oskari.getLang(),t.core.getSandbox());return i.push(n),"true"==e.disableDevelopmentMode&&t.core.disableDebug(),i},update:function(){},stop:function(){this.sandbox.unregisterStateful(this.mediator.bundleId),alert("Stopped!")},setState:function(e,t){var i,n,a,r,s,o,l,u=this,c=u.sandbox.findRegisteredModuleInstance("MainMapModule");if(u._teardownState(c),e.east&&t!==!0&&u.sandbox.getMap().moveTo(e.east,e.north,e.zoom),u.sandbox.syncMapState(!0),e.selectedLayers)for(i=u.sandbox.getRequestBuilder("AddMapLayerRequest"),n=u.sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),a=u.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),r=u.sandbox.getRequestBuilder("ChangeMapLayerStyleRequest"),s=e.selectedLayers.length,o=0;s>o;++o)l=e.selectedLayers[o],u.sandbox.request(c.getName(),i(l.id,!0)),u.sandbox.request(c.getName(),a(l.id,l.hidden!==!0)),l.style&&u.sandbox.request(c.getName(),r(l.id,l.style)),l.opacity&&u.sandbox.request(c.getName(),n(l.id,l.opacity));e.plugins||(e.plugins={}),e.plugins.MainMapModuleMarkersPlugin||(e.plugins.MainMapModuleMarkersPlugin={});var d,h,p=c.getPluginInstances();for(h in e.plugins)e.plugins.hasOwnProperty(h)&&(d=p[h],d&&d.setState&&d.setState(e.plugins[h]))},getState:function(){var e,t,i,n=this.sandbox.getMap(),a=this.sandbox.findAllSelectedMapLayers(),r=this.sandbox.findRegisteredModuleInstance("MainMapModule"),s=jQuery.extend({north:n.getY(),east:n.getX(),zoom:n.getZoom(),srs:n.getSrsName(),selectedLayers:[]},r.getState());for(e=0;e<a.length;e++)t=a[e],i={id:t.getId(),opacity:t.getOpacity()},t.isVisible()||(i.hidden=!0),t.getCurrentStyle&&t.getCurrentStyle()&&t.getCurrentStyle().getName()&&"!default!"!==t.getCurrentStyle().getName()&&(i.style=t.getCurrentStyle().getName()),s.selectedLayers.push(i);return s},getStateParameters:function(){var e,t=this.getState(),i="zoomLevel="+t.zoom+"&coord="+t.east+"_"+t.north+"&mapLayers=",n=t.selectedLayers,a=this.sandbox.findRegisteredModuleInstance("MainMapModule"),r="",s=null,o=0,l=0;if(this.conf&&this.conf.link)for(e in this.conf.link)this.conf.link.hasOwnProperty(e)&&(i=e+"="+this.conf.link[e]+"&"+i);for(o=0,l=n.length;l>o;o++)s=n[o],s.hidden||(""!==r&&(r+=","),r+=s.id+"+"+s.opacity,r+=s.style?"+"+s.style:"+");return i+r+a.getStateParameters()},toggleFullScreen:function(){jQuery("#"+this.contentMapDivId).toggleClass("oskari-map-window-fullscreen"),this.mapmodule.updateSize()},getMapEl:function(){var e=jQuery("#"+this.mapDivId);return e.length||this.sandbox.printWarn("mapDiv not found with id "+this._mapDivId),e},getMapElDom:function(){return this.getMapEl().get(0)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.userinterface.Stateful"]}),define("bundles/framework/bundle/mapfull/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement",function(){},{enhance:function(e){function t(e){return e===!0||"true"===e}e.printDebug("Checking if map is started with link...");var i=e.getRequestParameter("coord"),n=e.getRequestParameter("zoomLevel"),a=(e.getRequestParameter("mapLayers"),e.getRequestParameter("showMarker")),r=e.getRequestParameter("isCenterMarker"),s=e.getRequestParameter("keepLayersOrder");if(null===s&&(s=!0),e.getMap().setMarkerVisible(t(a)||t(r)),null!==i&&null!==n){var o;o=i.split(i.indexOf("_")>=0?"_":"%20");var l=o[0],u=o[1];if(null===l||null===u)return void e.printDebug("Could not parse link location. Skipping.");e.printDebug("This is startup by link, moving map..."),e.getMap().moveTo(l,u,n)}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]}),define("bundles/framework/bundle/mapfull/enhancement/start-map-with-link-enhancement",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequest",function(e){this._creator=null,this._resizeEnabled=e},{__name:"MapFull.MapResizeEnabledRequest",getName:function(){return this.__name},getResizeEnabled:function(){return this._resizeEnabled}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapfull/request/MapResizeEnabledRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequestHandler",function(e){this.mapfull=e},{handleRequest:function(e,t){this.mapfull.resizeEnabled=t.getResizeEnabled()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapfull/request/MapResizeEnabledRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequest",function(){this._creator=null},{__name:"MapFull.MapWindowFullScreenRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequestHandler",function(e){this.mapfull=e},{handleRequest:function(){this.mapfull.toggleFullScreen()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequestHandler",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/mapfull/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,define("src/mapping/mapmodule/ol2/mapfull/module",["oskari","jquery","oskariui","../mapmodule-plugin/module","bundles/framework/bundle/mapfull/instance","bundles/framework/bundle/mapfull/enhancement/start-map-with-link-enhancement","bundles/framework/bundle/mapfull/request/MapResizeEnabledRequest","bundles/framework/bundle/mapfull/request/MapResizeEnabledRequestHandler","bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequest","bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequestHandler","css!resources/framework/bundle/mapfull/css/style.css"],function(e){return e.bundleCls("oskariui"),e.bundleCls("openlayers-default-theme"),e.bundleCls("mapmodule-plugin"),e.bundleCls("mapfull").category({create:function(){return e.cls("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance").create()}})}),define("src/framework/divmanazer/extension/BaseExtension",["src/oskari/oskari"],function(e){var t=e.cls("Oskari.BaseExtension",function(e,t){this.sandbox=null,this.plugins={},this._localization=t,this.conf={name:e}},{getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},getSandbox:function(){return this.sandbox},update:function(){},setLocalization:function(e){this._localization=e},getLocalization:function(t){return this._localization||(this._localization=e.getLocalization(this.getName())),t?this._localization[t]:this._localization},start:function(){var t=this,i=this.conf,n=(i?i.sandbox:null)||"sandbox",a=e.getSandbox(n);t.sandbox=a,a.register(this),i&&i.stateful===!0&&a.registerAsStateful(this.mediator.bundleId,this)},stop:function(){var e=this.sandbox;e.unregisterStateful(this.mediator.bundleId),e.unregister(this),this.sandbox=null,this.started=!1},startExtension:function(){var e=this,t=e.sandbox;e.startPlugin();for(p in e.requestHandlers)t.addRequestHandler(p,this);for(p in e.eventHandlers)t.registerForEventByName(e,p)},startPlugin:function(){console.log("BASECLASS startPlugin called ",this)},stopPlugin:function(){console.log("BASECLASS stopPlugin called ",this)},stopExtension:function(){var e=this,t=e.sandbox;for(p in e.eventHandlers)t.unregisterFromEventByName(e,p);for(p in e.requestHandlers)t.removeRequestHandler(p,this);this.stopPlugin()},getPlugins:function(){return this.plugins},init:function(){return null},getName:function(){return this.conf.name},getConfiguration:function(){return this.conf},eventHandlers:{},requestHandlers:{},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},handleRequest:function(e,t){return this.onRequest(t)},onRequest:function(e){var t=this,i=t.requestHandlers[e.getName()];return i?i.apply(this,[e]):void 0},getLang:function(){return e.getLang()},slicer:Array.prototype.slice,notify:function(e,t){return this.getSandbox().notifyAll(e,t)},request:function(e){return this.getSandbox().request(this,e)},issue:function(){var e=arguments[0],t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getRequestBuilder(e),n=i.apply(i,t);return this.getSandbox().request(this.getExtension(),n)},notify:function(){var e=arguments[0],t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getEventBuilder(e),n=i.apply(i,t);return this.getSandbox().notifyAll(n)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension","Oskari.mapframework.core.RequestHandler"]});return t}),define("src/framework/divmanazer/extension/EnhancedExtension",["./BaseExtension"],function(e){var t=e.extend({getTile:function(){return this.plugins["Oskari.userinterface.Tile"]},setTile:function(e){this.plugins["Oskari.userinterface.Tile"]=e},setDefaultTile:function(e){var t=Oskari.cls().extend("Oskari.userinterface.extension.DefaultTile"),i=t.create(this,{title:e||""});return this.plugins["Oskari.userinterface.Tile"]=i,i},getFlyout:function(){return this.plugins["Oskari.userinterface.Flyout"]},setFlyout:function(e){this.plugins["Oskari.userinterface.Flyout"]=e},start:function(){var e=this,t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,n.register(this),t&&t.stateful===!0&&n.registerAsStateful(this.mediator.bundleId,this);var a=n.getRequestBuilder("userinterface.AddExtensionRequest")(this);n.request(this,a)},stop:function(){var e=this.sandbox,t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),e.unregisterStateful(this.mediator.bundleId),e.unregister(this),this.sandbox=null,this.started=!1}});return t}),define("src/framework/divmanazer/instance",["jquery"],function(e){Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null,this.requestHandlers={},this.extensions=[],this.extensionsByName={},this.compiledTemplates={},this.flyoutContainer=null,this.tileContainer=null,this.flyoutZIndexBase=1100,this.menubarContainerId="#menubar"},{getName:function(){return"userinterface.DivManazer"},init:function(){},getExtensionByName:function(e){return this.extensionsByName[e]},getSandbox:function(){return this.sandbox},start:function(){this.compileTemplates();var t,i,n,a,r,s=this.conf,o=(s?s.sandbox:null)||"sandbox",l=Oskari.getSandbox(o);if(this.sandbox=l,this.flyoutContainer=e(document.body),this.tileContainer=e(this.menubarContainerId),this.tileContainer.addClass("oskari-tile-container"),this.sandbox.register(this),this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this),this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this),this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this),l.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),l.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),l.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),this.requestHandlers.modal=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",this),l.addRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),e.browser.msie&&e.browser.version<"9.0")for(t=this.compiledTemplates["Oskari.userinterface.Flyout"].children(".oskari-flyoutcontentcontainer"),i=this.flyoutContainer.height(),n=this.ieFixClasses,a=0;a<n.length;a+=1)if(r=n[a],i>=r.min&&i<=r.max){t.addClass(r.cls);break}},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),sandbox.removeRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),this.sandbox.unregister(this),this.started=!1},templates:{"Oskari.userinterface.Tile":'<div class="oskari-tile oskari-tile-closed"><div class="oskari-tile-title"></div><div class="oskari-tile-status"></div></div>',"Oskari.userinterface.Flyout":'<div class="oskari-flyout oskari-closed"><div class="oskari-flyouttoolbar"><div class="oskari-flyoutheading"></div><div class="oskari-flyout-title"><p></p></div><div class="oskari-flyouttools"><div class="oskari-flyouttool-help"></div><div class="oskari-flyouttool-attach"></div><div class="oskari-flyouttool-detach"></div><div class="oskari-flyouttool-minimize"></div><div class="oskari-flyouttool-restore"></div><div class="oskari-flyouttool-close icon-close icon-close:hover"></div></div></div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"></div></div></div>',"Oskari.userinterface.View":'<div class="oskari-view"></div>'},compileTemplates:function(){var t,i=this;i.compiledTemplates["Oskari.userinterface.Tile"]=e(this.templates["Oskari.userinterface.Tile"]),t=e(i.templates["Oskari.userinterface.Flyout"]),t.css("left",i.defaults.attach.left),t.css("top",i.defaults.attach.top),i.compiledTemplates["Oskari.userinterface.Flyout"]=t,i.compiledTemplates["Oskari.userinterface.View"]=e(this.templates["Oskari.userinterface.View"])},addExtension:function(e){var t,i,n,a,r,s,o,l,u,c,d,h,p,f,m=this;return e.startExtension(),t=e.getPlugins(),i=m.extensions,n=m.extensionsByName,a={state:"close",extension:e,draggable:null,draggableTarget:null,draggableHandle:null,viewState:{},extensionUpdatedEvent:null},a.extensionUpdatedEvent=m.sandbox.getEventBuilder("userinterface.ExtensionUpdatedEvent")(e,a.state),r=i.length,s=e.getName(),o=t["Oskari.userinterface.Flyout"],l=null,u=null,null!==o&&void 0!==o&&(l=m.createFlyout(e,o,r,a),m._applyDraggableToFlyout(l,a,".oskari-flyouttoolbar"),c=l.children(".oskari-flyoutcontentcontainer"),u=c.children(".oskari-flyoutcontent"),o.setEl(u.get()),m.flyoutContainer.append(l),o.startPlugin()),d=t["Oskari.userinterface.Tile"],h=null,null!==d&&void 0!==d&&(h=m.createTile(e,d,r,a),d.startPlugin(),h.fadeIn(200),m.tileContainer.append(h)),p=t["Oskari.userinterface.View"],f=null,null!==p&&void 0!==p&&(f=m.createView(e,p,r,a),u=f,p.setEl(u.get()),p.startPlugin()),a.plugins={},d&&(a.plugins["Oskari.userinterface.Tile"]={plugin:d,el:h}),o&&(a.plugins["Oskari.userinterface.Flyout"]={plugin:o,el:l}),p&&(a.plugins["Oskari.userinterface.View"]={plugin:p,el:f}),i.push(a),n[s]=a,a
},_applyDraggableToFlyout:function(t,i,n){var a,r=this,s=t.children(n).get()[0],o=t.get()[0],l=!1;i.draggableHandle=s,i.draggableTarget=o,i.draggable=e(t).draggable({handle:e(s),helper:l?function(){return a=e("<div />"),a.css("width",t.css("width")),a.css("height",t.css("height")),a.css("border","2px solid rgba(0,0,0,.5)"),a.css("z-index",t.css("z-index")),a}:null,scroll:!1,stack:".oskari-flyout",create:function(){e.browser.msie&&"9"===e.browser.version[0]&&t.css("width",t.width()+"px")},start:function(){l&&t.css("display","none")},drag:function(){},stop:function(e,n){var a;l&&(t.css("top",n.helper.css("top")),t.css("left",n.helper.css("left"))),r.shuffleZIndices(t),l&&t.css("display",""),a=r.getFlyoutViewState(t,"detach"),i.viewState=a,r.notifyExtensionViewStateChange(i)}})},createTile:function(e,t){var i=this,n=this.compiledTemplates["Oskari.userinterface.Tile"].clone(!0,!0),a=n.children(".oskari-tile-title");return a.append(t.getTitle()),n.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"toggle"])}),t.setEl(n.get()),n},createFlyout:function(e,t){var i,n,a=this,r=this.compiledTemplates["Oskari.userinterface.Flyout"].clone(!0,!0);return r.find(".oskari-flyout-title p").append(t.getTitle()),i=r.children(".oskari-flyouttoolbar").children(".oskari-flyouttools"),n={attach:i.children(".oskari-flyouttool-attach"),detach:i.children(".oskari-flyouttool-detach"),minimize:i.children(".oskari-flyouttool-minimize"),restore:i.children(".oskari-flyouttool-restore"),close:i.children(".oskari-flyouttool-close"),help:i.children(".oskari-flyouttool-help")},n.detach.click(function(){a.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"detach"])}),n.attach.click(function(){a.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"attach"])}),n.minimize.click(function(){a.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"minimize"])}),n.restore.click(function(){a.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"restore"])}),n.close.click(function(){a.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"close"])}),n.help.click(function(){a.getSandbox().postRequestByName("userguide.ShowUserGuideRequest",[{placement:"bottom",el:n.help,extension:e.getName(),toggle:!0}])}),r},createView:function(){var e=this,t=e.compiledTemplates["Oskari.userinterface.View"].clone(!0,!0);return t},removeExtension:function(e){var t,i,n,a,r,s,o,l,u,c=this,d=c.extensions,h=this.extensionsByName,p=h[e.getName()],f=p.plugins["Oskari.userinterface.Flyout"];for(f&&(t=f.plugin,i=f.el,n=this.flyoutOps,a=n.close,a.apply(this,[i,t,p]),i.remove()),r=p.plugins["Oskari.userinterface.Tile"],r&&(s=r.el,s.remove()),h[e.getName()]=null,o=[],l=0,u=d.length;u>l;l+=1)d[l]!==p&&o.push(d[l]);c.extensions=o,e.stopExtension()},updateExtension:function(t,i){var n,a,r,s,o,l,u,c,d,h,p,f,m,g,v,y,b,k,_,w,L,x,S,O,T,C,M=this,N=M.extensions;if(t){if(a=this.extensionsByName,r=a[t.getName()],s=r.state,o=i.getState(),"toggle"===o&&("close"===s?o="attach":"attach"===s?o="close":"detach"===s?o="minimize":"minimize"===s?o="restore":"restore"===s&&(o="minimize")),c=r.plugins["Oskari.userinterface.Flyout"],"attach"===o&&c){(i.getExtensionLocation().top||i.getExtensionLocation().left)&&(M.origExtensionLocation={});var E=function(t,i,n){i.origExtensionLocation&&(t.getExtensionLocation()[n]?(i.origExtensionLocation[n]=e(c.el).css(n),e(c.el).css(n,t.getExtensionLocation()[n]+"px")):i.origExtensionLocation[n]&&e(c.el).css(n,i.origExtensionLocation[n]))};for(E(i,M,"top"),E(i,M,"left"),l=M.flyoutOps,d=l.close,h=0,C=N.length;C>h;h+=1)p=N[h],p!==r&&"attach"===p.state&&(f="close",m=p.plugins,g=m["Oskari.userinterface.Flyout"],g&&(v=g.plugin,y=g.el,p.state=f,d.apply(this,[y,v,p]),M.notifyExtensionViewStateChange(p),b=m["Oskari.userinterface.Tile"],b&&(k=b.el,M.applyTransition(k,f,M.tileTransitions))))}c&&(_=c.plugin,w=c.el,l=M.flyoutOps,u=l[o],u.apply(this,[w,_,r,N])),L=r.plugins["Oskari.userinterface.Tile"],L&&(x=L.el,M.applyTransition(x,o,M.tileTransitions)),S=r.plugins["Oskari.userinterface.View"],S&&(O=S.plugin,T=S.el,l=M.viewOps,u=l[o],u&&u.apply(this,[T,O,r,N])),r.state=o,M.notifyExtensionViewStateChange(r)}else for(n=0;n<N.length;n+=1)this.updateExtension(N[n].extension,i)},notifyExtensionViewStateChange:function(e){var t=e.extensionUpdatedEvent;t.setViewState(e.state),t.setViewInfo(e.viewState),this.sandbox.notifyAll(t,!0)},validStates:{attach:{attach:!0,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!1},detach:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!1},minimize:{attach:!0,detach:!0,close:!1,minimize:!0,restore:!1,drawer:!1,sidebar:!1},restore:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!0,drawer:!1,sidebar:!1},close:{attach:!1,detach:!1,close:!0,minimize:!1,restore:!1,drawer:!1,sidebar:!1},drawer:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!0,sidebar:!1},sidebar:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!0}},defaults:{detach:{left:"212px",top:"50px"},attach:{left:"192px",top:"30px"}},tileTransitions:{attach:{"oskari-tile-attached":!0,"oskari-tile-detached":!1,"oskari-tile-closed":!1},detach:{"oskari-tile-attached":!1,"oskari-tile-detached":!0,"oskari-tile-minimized":!1,"oskari-tile-closed":!1},minimize:{"oskari-tile-minimized":!0,"oskari-tile-closed":!1,"oskari-tile-detached":!1},restore:{"oskari-tile-minimized":!1,"oskari-tile-detached":!0},close:{"oskari-tile-closed":!0,"oskari-tile-attached":!1,"oskari-tile-detached":!1}},flyoutTransitions:{attach:{"oskari-attached":!0,"oskari-detached":!1,"oskari-closed":!1},detach:{"oskari-attached":!1,"oskari-detached":!0,"oskari-closed":!1},minimize:{"oskari-minimized":!0,"oskari-closed":!1,"oskari-detached":!1},restore:{"oskari-minimized":!1,"oskari-closed":!1,"oskari-detached":!0,"oskari-attached":!1},close:{"oskari-closed":!0,"oskari-minimized":!1,"oskari-detached":!1,"oskari-attached":!1}},applyTransition:function(e,t,i){var n,a=i[t];if(a)for(n in a)a.hasOwnProperty(n)&&(a[n]?e.addClass(n):e.removeClass(n))},getFlyoutViewState:function(e,t){var i={left:e.css("left"),top:e.css("top"),width:e.width(),height:e.height(),"z-index":e.css("z-index"),viewState:t};return i},flyoutOps:{detach:function(e,t,i){var n,a=this;(!i.viewState.left||!i.viewState.top||i.viewState.left===a.defaults.attach.left&&i.viewState.top===a.defaults.attach.top)&&(i.viewState.left=a.defaults.detach.left,i.viewState.top=a.defaults.detach.top),a.shuffleZIndices(e),a.applyTransition(e,"detach",a.flyoutTransitions),n=a.getFlyoutViewState(e,"detach"),i.viewState=n},attach:function(e,t,i){var n,a=this;a.shuffleZIndices(e),a.applyTransition(e,"attach",a.flyoutTransitions),n=a.getFlyoutViewState(e,"attach"),i.viewState=n},minimize:function(e,t,i){var n=this,a=n.getFlyoutViewState(e,"minimize");n.applyTransition(e,"minimize",n.flyoutTransitions),i.viewState=a},restore:function(e){var t=this;t.applyTransition(e,"restore",t.flyoutTransitions)},close:function(e,t,i){var n=this;i.viewState={viewState:"close"},n.applyTransition(e,"close",n.flyoutTransitions)}},viewOps:{view:function(){},close:function(){}},setState:function(e){var t,i,n,a=this,r=e;if(r)for(t in a.extensionsByName)a.extensionsByName.hasOwnProperty(t)&&(i=a.extensionsByName[t],n=r.extensionStatesByName[t],n&&(i.state=n.state,i.viewState=n.viewState||{}))},getState:function(){var e,t,i,n=this;n.refreshExtensionViewStates(),e={extensionStatesByName:{}};for(t in n.extensionsByName)n.extensionsByName.hasOwnProperty(t)&&(i=n.extensionsByName[t],e.extensionStatesByName[t]={state:i.state,viewState:i.viewState});return e},applyState:function(){var e=this;e.restoreExtensionViewStates()},refreshExtensionViewStates:function(){var e,t,i,n,a,r=this;for(e in r.extensionsByName)r.extensionsByName.hasOwnProperty(e)&&(t=r.extensionsByName[e],i=t.plugins["Oskari.userinterface.Flyout"],i&&(n=i.el,a=r.getFlyoutViewState(n,t.state),t.viewState=a))},restoreExtensionViewStates:function(){var e,t,i,n,a,r,s,o,l,u=this,c=u.flyoutOps,d=u.extensions;for(e in u.extensionsByName)u.extensionsByName.hasOwnProperty(e)&&(t=u.extensionsByName[e],i=t.plugins["Oskari.userinterface.Flyout"],i&&(n=i.plugin,a=i.el,r=t.viewState,a.removeAttr("style"),a.css("left",r.left),a.css("top",r.top),a.width(r.width),a.height(r.height),a.css("z-index",r["z-index"]),s=c[t.state],s.apply(u,[a,n,t,d])),o=t.plugins["Oskari.userinterface.Tile"],o&&(l=o.el,u.applyTransition(l,t.state,u.tileTransitions)))},_toggleMapWindowFullScreen:function(){var e=this,t=e.sandbox.getRequestBuilder("MapFull.MapWindowFullScreenRequest");t&&e.sandbox.request(e.getName(),t())},shuffleZIndices:function(e){var t,i,n,a,r,s,o,l=this,u=[],c={},d={},h={},p=1100;for(i in l.extensionsByName)l.extensionsByName.hasOwnProperty(i)&&(n=l.extensionsByName[i],a=n.plugins["Oskari.userinterface.Flyout"],a&&(r=a.el,s=r.css("z-index"),u.push(s),t=String(s),c[t]=s,h[t]=r,d[t]=n));for(u.sort(),o=0;o<u.length;o+=1)t=u[o],c[t]=p+o,h[t].css("z-index",c[u[o]]);e.css("z-index",p+u.length+2)},ieFixClasses:[{min:400,max:599,cls:"oskari-flyoutcontentcontainer_IE_400_599"},{min:600,max:799,cls:"oskari-flyoutcontentcontainer_IE_600_799"},{min:800,max:999,cls:"oskari-flyoutcontentcontainer_IE_800_999"},{min:1e3,max:1199,cls:"oskari-flyoutcontentcontainer_IE_1000_1199"},{min:1200,max:1399,cls:"oskari-flyoutcontentcontainer_IE_1200_1399"},{min:1400,max:9999,cls:"oskari-flyoutcontentcontainer_IE_1400"}]},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Stateful"]})}),Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(e){this._extension=e},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/divmanazer/request/AddExtensionRequest",function(){}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension();this.ui.addExtension(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/divmanazer/request/AddExtensionRequestHandler",function(){}),Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(e){this._extension=e},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/divmanazer/request/RemoveExtensionRequest",function(){}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension();this.ui.removeExtension(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/divmanazer/request/RemoveExtensionRequestHandler",function(){}),Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(e,t,i,n,a){this._extension=e,this._state=t,this._extensionName=i,this._location={},this._location.top=n,this._location.left=a},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state},getExtensionName:function(){return this._extensionName},getExtensionLocation:function(){return this._location}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/divmanazer/request/UpdateExtensionRequest",function(){}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i,n=t.getExtension(),a=t.getExtensionName();if(!n&&a&&"*"!=a){if(i=this.ui.getExtensionByName(a),!i)return;n=i.extension}this.ui.updateExtension(n,t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/divmanazer/request/UpdateExtensionRequestHandler",function(){}),Oskari.clazz.define("Oskari.userinterface.request.ModalDialogRequest",function(e,t,i,n){this._title=e?e:"Untitled",this._message=t?t:"Lorem ipsum",this._buttons=i?i:{},this._parent=parent?parent:jQuery("#mapdiv"),this._onshow=n?n:null},{__name:"userinterface.ModalDialogRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getMessage:function(){return this._message},getButtons:function(){return this._buttons},getGeom:function(){return this._geom},getParent:function(){return this._parent},getOnShow:function(){return this._onshow}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/divmanazer/request/ModalDialogRequest",function(){}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",function(e){this._ui=e,this._tpl={},this._tpl.modal=jQuery('<div id="modaldialog" class="modaldialog">  <div class="modaltitle"></div>  <div class="modalmessage"></div>  <div class="modalbuttons"></div> </div>'),this._tpl.button=jQuery('<div class="modalbutton"><input type="button" /></input></div>'),this._buttons={},this._args={closeClass:"modalclose",overlayId:"modaloverlay",overlayCss:{"background-color":"lightgrey",cursor:"wait"},containerId:"modalcontainer",containerCss:{"background-color":"white"},onClose:function(){this.close()},zIndex:80130}},{handleRequest:function(e,t){var i=this._tpl.modal.clone();i.find(".modaltitle").append(t.getTitle()),i.find(".modalmessage").append(t.getMessage());var n=t.getButtons(),a=i.find(".modalbuttons");for(var r in n)if(n[r].name){var s=n[r],o=this._tpl.button.clone(),l=o.find("input");l.attr("name",s.name),l.attr("text",s.text),l.attr("value",s.text),l.bind("click",s.onclick),s.close!==!1&&l.addClass(this._args.closeClass),a.append(o)}t.onshow&&(this._args.onShow=onshow),$.modal=i.modal(this._args)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/divmanazer/request/ModalDialogRequestHandler",function(){}),Oskari.clazz.define("Oskari.userinterface.event.ExtensionUpdatedEvent",function(e,t,i){this._creator=null,this._extension=e,this.viewstate=t,this.viewinfo=i},{__name:"userinterface.ExtensionUpdatedEvent",getName:function(){return this.__name},getExtension:function(){return this._extension},getViewState:function(){return this.viewstate},setViewState:function(e){this.viewstate=e},getViewInfo:function(){return this.viewinfo},setViewInfo:function(e){this.viewinfo=e}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/divmanazer/event/ExtensionUpdatedEvent",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Component",function(){this._clazz="Oskari.userinterface.component.Component",this._element=null,this._visible=!0},{destroy:function(e){this._destroyImpl(e),e||this._element&&this._element.parentNode&&this._element.parentNode.removeChild(this._element)},_destroyImpl:function(){return void 0},_getClasses:function(){return this._element.className.split(/\s+/).sort()},addClass:function(e){var t=this._getClasses();-1===t.indexOf(e)&&(t.push(e),this._element.className=t.join(" "))},removeClass:function(e){var t=this._getClasses(),i=t.indexOf(e);-1!==i&&(t.splice(i,1),this._element.className=t.join(" "))},toggleClass:function(e,t){t?this.addClass(e):this.removeClass(e)},getClazz:function(){return this._clazz},getElement:function(){return this._element},getName:function(){return void 0},setName:function(){return void 0},getTitle:function(){return void 0},setTitle:function(){return void 0},isVisible:function(){return this._visible},setVisible:function(e){if("boolean"!=typeof e)throw new TypeError(this.getClazz()+".setVisible: visible is not a boolean");this._setVisibleImpl(e)},_setVisibleImpl:function(){return void 0},insertTo:function(e){var t;if(!e)throw new TypeError(this.getClazz()+".insertTo: container is required.");if(t=e,!t.appendChild&&t.length&&(t=t[0]),!t.appendChild)throw new TypeError(this.getClazz()+".insertTo: container is not a DOMElement.");t.appendChild(this._element)}}),define("bundles/framework/bundle/divmanazer/component/Component",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Accordion",function(){this.template=jQuery('<div class="accordion"></div>'),this.templateMsg=jQuery('<div class="accordionmsg"></div>'),this.panels=[],this.ui=this.template.clone(),this.hasMessage=!1},{addPanel:function(e){this.removeMessage(),this.panels.push(e),e.insertTo(this.ui)},removePanel:function(e){var t,i=null;for(t=0;t<this.panels.length;t+=1)if(this.panels[t]===e){i=this.panels[t],this.panels.splice(t,1);break}return i?(i.destroy(),!0):!1},removeAllPanels:function(){this.ui.empty(),this.panels=[]},removeMessage:function(){if(this.hasMessage){this.hasMessage=!1;var e=this.ui.find("div.accordionmsg");e.length>0&&e.remove()}},showMessage:function(e){this.removeMessage(),this.hasMessage=!0;var t=this.templateMsg.clone();t.append(e),this.ui.append(t)},showPanels:function(){var e=0;for(e=0;e<this.panels.length;e+=1)this.panels[e].setVisible(!0)},hidePanels:function(){var e=0;for(e=0;e<this.panels.length;e+=1)this.panels[e].setVisible(!1)},insertTo:function(e){e.append(this.ui)},getContainer:function(){return this.ui}}),define("bundles/framework/bundle/divmanazer/component/Accordion",function(){}),Oskari.clazz.define("Oskari.userinterface.component.AccordionPanel",function(){this.template=jQuery('<div class="accordion_panel"><div class="header"><div class="headerIcon icon-arrow-right"></div><div class="headerText"></div></div><div class="content"></div></div>'),this.title=null,this.content=null,this.html=this.template.clone();var e=this,t=e.html.find("div.header");t.click(function(){e.isOpen()?e.close():e.open()}),this.html.find("div.content").hide()},{setVisible:function(e){e===!0?this.html.show():this.html.hide()},isVisible:function(){return this.html.is(":visible")},isOpen:function(){return this.html.hasClass("open")},open:function(){this.html.addClass("open");var e=this.html.find("div.header div.headerIcon");e.removeClass("icon-arrow-right"),e.addClass("icon-arrow-down"),this.html.find("div.content").show()},close:function(){this.html.removeClass("open");var e=this.html.find("div.header div.headerIcon");e.removeClass("icon-arrow-down"),e.addClass("icon-arrow-right"),this.html.find("div.content").hide()},setTitle:function(e){this.title=e;var t=this.html.find("div.header div.headerText");t.html(this.title)},getTitle:function(){return this.title},setId:function(e){var t=this.html.find("div.header");t.attr("id",e)},setContent:function(e){this.content=e;var t=this.html.find("div.content");t.append(this.content)},destroy:function(){this.html.remove()},getContainer:function(){return this.html.find("div.content")},getHeader:function(){return this.html.find("div.header")},insertTo:function(e){e.append(this.html)}}),define("bundles/framework/bundle/divmanazer/component/AccordionPanel",function(){}),Oskari.clazz.define("Oskari.userinterface.component.TabContainer",function(e){this.extraContent=null,this.panels=[],this.tabChangeListeners=[],this.emptyMsg=e?e:"No content",this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"</div>"),this.templateTabs=jQuery('<nav class="tabsHeader"><ul class="tabsItem"></ul></nav><div class="tabsContent tabsContentItem"></div>'),this.templateExtra=jQuery('<div class="extraContent"></div>'),this.ui=this.template.clone()},{addPanel:function(e,t){var i,n,a,r,s=this;0===this.panels.length?(i=this.templateTabs.clone(),this.ui.html(i),"number"!=typeof e.getPriority()&&e.setPriority(1)):t?e.setPriority(this.panels[0].getPriority()-1):"number"!=typeof e.getPriority()&&e.setPriority(this.panels[this.panels.length-1].getPriority()+1);for(var o=0;o<this.panels.length&&!(e.getPriority()<this.panels[o].getPriority());)o+=1;n=this.ui.find("ul.tabsItem"),a=e.getHeader(),0===o?(n.prepend(a),this.select(e)):n.children().eq(o-1).after(a),e.insertAt(this.ui.find("div.tabsContentItem"),o),this.panels.splice(o,0,e),1===this.panels.length&&this.select(e),r=a.find("a"),r.bind("click",function(){return s.select(e),!1})},setExtra:function(e){this.extraContent=this.templateExtra.clone(),this.extraContent.append(e),this.ui.find(".tabsHeader").append(this.extraContent)},removeExtra:function(){this.extraContent&&this.extraContent.remove()},addTabChangeListener:function(e){this.tabChangeListeners.push(e)},select:function(e){var t,i,n,a=null;for(t=0;t<this.panels.length;t+=1)if(this.isSelected(this.panels[t])){a=this.panels[t],a.handleSelection(!1);break}for(i=this.ui.find("ul"),i.find("li").removeClass("active"),n=this.ui.children().children("div.tab-content"),n.hide(),e.getHeader().addClass("active"),e.getContainer().show(),e.handleSelection(!0),t=0;t<this.tabChangeListeners.length;t+=1)this.tabChangeListeners[t](a,e)},isSelected:function(e){return e.getHeader().hasClass("active")},removePanel:function(e){var t,i=null;for(t=0;t<this.panels.length;t+=1)if(this.panels[t]===e){i=this.panels[t],this.panels.splice(t,1);break}if(0===this.panels.length)for(this.ui.html(this.emptyMsg),t=0;t<this.tabChangeListeners.length;t+=1)this.tabChangeListeners[t](e);else this.select(this.panels[0]);return i?(i.destroy(),!0):!1},getElement:function(){return this.ui},insertTo:function(e){e.append(this.ui)},destroy:function(){var e;for(e=this.panels.length;e>=0;e-=1)this.panels[e].destroy();this.panels=[],this.ui.remove()}}),define("bundles/framework/bundle/divmanazer/component/TabContainer",function(){}),Oskari.clazz.define("Oskari.userinterface.component.TabDropdownContainer",function(e,t){this.button=t,this.panels=[],this.tabChangeListeners=[],this.emptyMsg=e?e:"No content",this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"</div>"),this.templateTabOption=jQuery("<option></option>"),this.templateTabs=jQuery('<div class="tabsHeader"><ul><li><select name="tabs"></select></li></ul></div><div class="tabsContent"></div>'),this.ui=this.template.clone()},{addPanel:function(e){var t=this;if(0===this.panels.length){var i=this.templateTabs.clone();t.ui.html(i),t.button&&t.button.insertTo&&t.button.insertTo(t.ui.find("li"))}var n=this.ui.find("ul li select"),a=this.templateTabOption.clone();a.attr("id","layer-id-"+e.getId()),a.append(e.getTitle()),n.append(a),e.setHeader(a),e.insertTo(this.ui.find("div.tabsContent")),this.panels.push(e),1===this.panels.length&&(this.select(e),n.bind("change",function(){t.select(t.panels[this.selectedIndex])}))},updatePanel:function(e){var t,i,n=this,a=n.ui.find("ul li select");for(t=0;t<a.find("option").length;t++)i=jQuery(a.find("option")[t]),i.attr("id")==="layer-id-"+e.getId()&&i.html(e.getTitle())},addTabChangeListener:function(e){this.tabChangeListeners.push(e)},select:function(e){var t,i=null;if(this.tabChangeListeners.length>0)for(t=0;t<this.panels.length;t++)if(this.isSelected(this.panels[t])){i=this.panels[t];break}var n=this.ui.children().children("div.tab-content");n.hide();var a=this.ui.find("ul li select"),r=a.find("option");r.removeAttr("selected");var s=this._getPanelIndex(e);for(jQuery(r[s]).attr("selected","selected"),e.getContainer().show(),t=0;t<this.tabChangeListeners.length;t++)this.tabChangeListeners[t](i,e)},isSelected:function(e){var t=this.ui.find("ul li select :selected");return t.index()===this._getPanelIndex(e)},_getPanelIndex:function(e){var t;for(t=0;t<this.panels.length;t++)if(this.panels[t].getId()===e.getId())return t;return-1},removePanel:function(e){var t,i,n=null;for(t=0;t<this.panels.length;t++)if(this.panels[t].getId()===e.getId()){n=this.panels[t],this.panels.splice(t,1);break}var a=this.ui.find("ul li select :selected");for(t=0;t<a.length;t++)i=jQuery(a[t]),i.attr("id")==="layer-id-"+n.getId()&&i.remove();if(0===this.panels.length)for(this.ui.html(this.emptyMsg),t=0;t<this.tabChangeListeners.length;t++)this.tabChangeListeners[t](e);else this.select(this.panels[0]);return n?(n.destroy(),!0):!1},insertTo:function(e){e.append(this.ui)}}),define("bundles/framework/bundle/divmanazer/component/TabDropdownContainer",function(){}),Oskari.clazz.define("Oskari.userinterface.component.TabPanel",function(){this.template=jQuery('<div class="tab-content"></div>'),this.templateTabHeader=jQuery('<li><a href="JavaScript:void(0);"></a></li>'),this.id=null,this.title=null,this.content=null,this.header=null,this.selectionHandler=null,this.priority=1,this.html=this.template.clone(),this.html.hide()},{setId:function(e){this.id=e},getId:function(){return this.id},setPriority:function(e){this.priority=e},getPriority:function(){return this.priority},setTitle:function(e,t){var i,n;this.title=e,i=this.templateTabHeader.clone(),this.header=i,t&&i.attr("id",t),n=i.find("a"),n.html(this.getTitle())},getTitle:function(){return this.title},setHeader:function(e){this.header=e},getHeader:function(){return this.header},setContent:function(e){this.content=e,this.html.html(this.content)},destroy:function(){this.header.remove(),this.html.remove()},getContainer:function(){return this.html},setSelectionHandler:function(e){this.selectionHandler=e},handleSelection:function(e){this.selectionHandler&&this.selectionHandler(e===!0)},insertTo:function(e){e.append(this.html)},insertAt:function(e,t){0===t?e.prepend(this.html[0]):e.children().eq(t-1).after(this.html[0])}}),define("bundles/framework/bundle/divmanazer/component/TabPanel",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Badge",function(){this.compiledTemplates={},this.compileTemplates(),this.ui=null,this.container=null},{templates:{"default":'<span class="oskari-badge"></span>',success:'<span class="oskari-badge oskari-badge-success"></span>',warning:'<span class="oskari-badge oskari-badge-warning"></span>',important:'<span class="oskari-badge oskari-badge-important"></span>',info:'<span class="oskari-badge oskari-badge-info"></span>',inverse:'<span class="oskari-badge oskari-badge-inverse"></span>'},compileTemplates:function(){var e;for(e in this.templates)this.templates.hasOwnProperty(e)&&(this.compiledTemplates[e]=jQuery(this.templates[e]))},insertTo:function(e){this.container=e},setContent:function(e,t){this.ui&&(this.ui.remove(),this.ui=null);var i=this.compiledTemplates[t||"default"].clone();i.append(e),this.container.append(i),this.ui=i},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}}),define("bundles/framework/bundle/divmanazer/component/Badge",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Alert",function(){this.compiledTemplates={},this.compileTemplates(),this.ui=null,this.container=null},{templates:{"default":'<div class="oskari-alert"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>',success:'<div class="oskari-alert oskari-alert-success"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>',error:'<div class="oskari-alert oskari-alert-error"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>',info:'<div class="oskari-alert oskari-alert-info"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>'},compileTemplates:function(){var e;for(e in this.templates)this.templates.hasOwnProperty(e)&&(this.compiledTemplates[e]=jQuery(this.templates[e]))},insertTo:function(e){this.container=e},setContent:function(e,t,i){this.ui&&(this.ui.remove(),this.ui=null);var n=this,a=n.compiledTemplates[t||"default"].clone(),r=!i;a.append(e),n.container.prepend(a),n.ui=a,r?a.children(".oskari-alert-icon-close").click(function(){n.hide()}):a.children(".oskari-alert-icon-close").remove()},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}}),define("bundles/framework/bundle/divmanazer/component/Alert",function(){}),define("src/framework/divmanazer/component/Popup",["jquery"],function(e){Oskari.clazz.define("Oskari.userinterface.component.Popup",function(){this.template=e('<div class="divmanazerpopup"><h3 class="popupHeader"></h3><div class="content"></div><div class="actions"></div></div>'),this.templateButton=e('<div class="button"><a href="JavaScript:void(0);"></a></div>'),this.dialog=this.template.clone(),this.overlay=null},{show:function(t,i,n){var a,r,s,o,l=this,u=this.dialog.find("div.content");if(this.dialog.find("h3").html(t),u.html(i),n&&n.length>0)for(a=this.dialog.find("div.actions"),a.empty(),r=0;r<n.length;r+=1)n[r].insertTo(a);else this.dialog.bind("click",function(){l.close(!0)});e("body").append(this.dialog),s=u.height(),o=.6*e(document).height(),s>o&&(u.height(o),u.css("overflow-y","auto")),this.dialog.css("margin-left",-(this.dialog.width()/2)+"px"),this.dialog.css("margin-top",-(this.dialog.height()/2)+"px")},fadeout:function(e){var t=this,i=3e3;e&&(i=e),setTimeout(function(){t.close()},i)},addClass:function(e){this.dialog.addClass(e)},createCloseButton:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Button");return i.setTitle(e),i.setHandler(function(){t.close(!0)}),i},close:function(e){var t=this;this.overlay&&this.overlay.close(),e?t.dialog.remove():(t.dialog.animate({opacity:0},500),setTimeout(function(){t.dialog.remove()},500))},alignment:["left","right","top","bottom"],moveTo:function(t,i){var n=this,a="right",r=e(t),s=r.offset();if(r&&0!==r.length&&s){var o=r.outerWidth(),l=r.outerHeight(),u=n.dialog.outerWidth(),c=n.dialog.outerHeight(),d=s.left,h=s.top;i&&-1!==e.inArray(i,this.alignment)&&(a=i),"right"===a?(d=d+o+5,h=h+l/2-c/2):"left"===a?(d=d-u-5,h=h+l/2-c/2):"top"===a?(h=h-c-5,d=d+o/2-u/2):"bottom"===a&&(h=h+l+5,d=d+o/2-u/2),0>d&&(d=0),0>h&&(h=0),n.dialog.addClass("arrow"),n.dialog.addClass(i),n.dialog.css({left:d+"px",top:h+"px","margin-left":0,"margin-top":0})}},resetPosition:function(){var e;for(this.dialog.removeClass("arrow"),e=0;e<this.alignment.length;e+=1)this.dialog.removeClass(this.alignment[e]);this.dialog.removeAttr("style")},makeModal:function(){var e=Oskari.clazz.create("Oskari.userinterface.component.Overlay");e.overlay("body"),this.overlay=e,e.followResizing(!0)},setContent:function(e){var t=this.dialog.find("div.content");t.empty(),t.append(e)},getContent:function(){return this.dialog.find("div.content")[0].textContent},getJqueryContent:function(){return this.dialog.find("div.content")},makeDraggable:function(){var e=this;e.dialog.css("position","absolute"),e.dialog.draggable({scroll:!1})}})}),Oskari.clazz.define("Oskari.userinterface.component.Overlay",function(){this.template=jQuery('<div class="oskarioverlay transparent"></div>'),this._overlays=null,this._resizingWorkaround=null},{overlay:function(e){var t,i=this,n=e;n||(n="body"),t=jQuery(n),i._overlays=_.map(t,function(e){return{overlay:i.template.clone(),target:jQuery(e)}}),_.forEach(i._overlays,function(e){e.target.append(e.overlay)}),i._setupSizeAndLocation(),_.forEach(i._overlays,function(e){e.overlay.bind("click",function(e){e.preventDefault()})})},_setupSizeAndLocation:function(){var e=this;_.forEach(e._overlays,function(e){e.overlay.css({left:"0px",top:"0px",width:e.target.width()+"px",height:e.target.height()+"px"})})},resize:function(){var e=this;_.forEach(e._overlays,function(e){e.overlay.height(e.target.height()),e.overlay.width(e.target.width())})},followResizing:function(e){var t=this;e?jQuery(window).resize(function(){t.resize()}):this._resizingWorkaround=setTimeout(function(){t.resize(),t.followResizing()},500)},close:function(){var e=this;_.forEach(e._overlays,function(e){e.overlay.remove()}),this._resizingWorkaround&&clearTimeout(this._resizingWorkaround)},bindClickToClose:function(){var e=this;_.forEach(e._overlays,function(t){t.overlay.bind("click",function(){e.close()})})}}),define("bundles/framework/bundle/divmanazer/component/Overlay",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Button",function(e){this._element=document.createElement("input"),this._element.className="oskari-formcomponent oskari-button",this._element.type="button",null!==e&&void 0!==e&&this.setName(e)
},{focus:function(){this._element.focus()},getName:function(){return this._element.name},setName:function(e){this._element.name=e},getTitle:function(){return this._element.value},setTitle:function(e){this._element.value=e},getTooltip:function(){return this._element.title},setTooltip:function(e){this._element.title=e},getValue:function(){return this._element.value},setValue:function(e){this._element.value=e},setId:function(e){this.id=e,this._element?this._element.id=e:console.warn("No UI")},_setEnabledImpl:function(e){this._element.disabled=!e},_setHandlerImpl:function(){this._element.onclick=this._handler},setPrimary:function(e,t){if("boolean"!=typeof e)throw new TypeError(this.getClazz()+".setPrimary: primary is not a boolean");if(void 0!==t&&"boolean"!=typeof t)throw new TypeError(this.getClazz()+".setPrimary: focus is not a boolean");this.toggleClass("primary",e),t&&this.focus()},hide:function(){Oskari.getSandbox().printWarn("Oskari.userinterface.component.Button: hide is deprecated, please use setVisible instead."),this.setVisible(!1)},show:function(){Oskari.getSandbox().printWarn("Oskari.userinterface.component.Button: show is deprecated, please use setVisible instead."),this.setVisible(!0)},setFocus:function(e){Oskari.getSandbox().printWarn("Oskari.userinterface.component.Button: setFocus is deprecated, please use focus instead."),e&&this.focus()},getButton:function(){return Oskari.getSandbox().printWarn("Oskari.userinterface.component.Button: getButton is deprecated, please use getElement instead."),jQuery(this.getElement())}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/Button",function(){}),Oskari.clazz.category("Oskari.userinterface.component.FilterDialog",function(e,t,i){this.sandbox=i||Oskari.getSandbox(),this.loc=e,this.fixedOptions={},t&&(this.fixedOptions=t),this.__filterTemplates={filterContent:'<div class="analyse-filter-popup-content"></div>',filterContentBBOX:'<div class="analyse-filter analyse-filter-popup-bbox"><div class="bbox-title"></div><div class="bbox-radio"><div class="bbox-on"><input id="analyse-filter-bbox-on" type="radio" name="filter-bbox" value="true" /><label for="analyse-filter-bbox-on"></label></div><div class="bbox-off"><input id="analyse-filter-bbox-off" type="radio" name="filter-bbox" value="false" checked="checked" /><label for="analyse-filter-bbox-off"></label></div></div></div>',filterClickedFeatures:'<div class="analyse-filter analyse-filter-clicked-features"><div class="clicked-features-title"></div><input type="checkbox" name="analyse-clicked-features" id="analyse-clicked-features" /><label for="analyse-clicked-features"></label></div>',filterContentValues:'<div class="analyse-filter analyse-filter-popup-values"><div class="values-title"></div></div>',filterContentOption:'<div class="filter-option"><input name="case-sensitive" type="checkbox"></input><select class="attribute"></select><select class="operator"></select><input name="attribute-value" type="text"></input></div>',manageFilterOption:'<div class="manage-filter-option"><div class="add-filter-option">+</div><div class="remove-filter-option">-</div></div>',filterBooleanOption:'<select class="boolean"></select>',option:"<option></option>"},this.popup=null,this._layer=null,this._closeButtonHandler=null,this._clearButtonHandler=null,this._updateButtonHandler=null},{createFilterDialog:function(e){var t,i,n,a,r=this,s=Oskari.clazz.create("Oskari.userinterface.component.Button"),o=Oskari.clazz.create("Oskari.userinterface.component.Button"),l=Oskari.clazz.create("Oskari.userinterface.component.Button");if("undefined"!=typeof e&&(r._layer=e),null!==typeof r._layer){if(t=r._layer.getFilterJson(),null===r._layer.getFilterJson())return void r._loadWFSLayerPropertiesAndTypes(r._layer.getId());n=this.getFilterDialogContent(r._layer),i=this.loc.filter.description+" "+r._layer.getName(),r.popup=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s.setTitle(this.loc.filter.cancelButton),s.addClass("analyse-close-filter"),s.setHandler(function(){r.popup.close(!0),r._closeButtonHandler&&r._closeButtonHandler.apply()}),o.setTitle(r.loc.filter.clearButton),o.addClass("analyse-clear-filter"),o.setHandler(function(){r.popup.setContent(r.getFilterDialogContent(r._layer)),r._clearButtonHandler&&r._clearButtonHandler.apply()}),l.setTitle(this.loc.filter.refreshButton),l.addClass("primary"),l.addClass("analyse-update-filter"),l.setHandler(function(){var e=r.getFilterValues();a=r._validateFilterValues(e),a?r._displayValidationErrors(a):(r.popup.close(!0),r._updateButtonHandler&&r._updateButtonHandler.call(r,e))}),r.popup.show(i,n,[s,o,l]),r.popup.makeDraggable()}},getFilterDialogContent:function(e){var t,i=jQuery(this.__filterTemplates.filterContent),n=jQuery(this.__filterTemplates.filterContentBBOX),a=jQuery(this.__filterTemplates.filterClickedFeatures),r=jQuery(this.__filterTemplates.filterContentValues);return"undefined"==typeof this.fixedOptions.bboxSelection&&(n.find("div.bbox-title").html("<h4>"+this.loc.filter.bbox.title+"</h4>"),n.find("div.bbox-on").find("label").html(this.loc.filter.bbox.on),n.find("div.bbox-off").find("label").html(this.loc.filter.bbox.off),i.append(n)),"undefined"==typeof this.fixedOptions.clickedFeaturesSelection&&(a.find("div.clicked-features-title").html("<h4>"+this.loc.filter.clickedFeatures.title+"</h4>"),a.find("label").html(this.loc.filter.clickedFeatures.label),i.append(a)),r.find("div.values-title").html("<h4>"+this.loc.filter.values.title+"</h4>"),t=this._addAttributeFilter(e),r.append(t),i.append(r),i},fillDialogContent:function(e,t,i){var n,a,r=e.find("div.bbox-radio"),s=e.find("div.analyse-filter-clicked-features"),o=e.find("div.filter-option");if(t.bbox&&!jQuery.isEmptyObject(t.bbox)?(r.find("div.bbox-off").find("input[name=filter-bbox]").removeAttr("checked"),r.find("div.bbox-on").find("input[name=filter-bbox]").attr("checked","checked")):(r.find("div.bbox-off").find("input[name=filter-bbox]").attr("checked","checked"),r.find("div.bbox-on").find("input[name=filter-bbox]").removeAttr("checked")),t.featureIds&&s.find("input[name=analyse-clicked-features]").attr("checked","checked"),t.filters&&t.filters.length)for(n=t.filters[0],this._fillFilterOptionsDiv(o,n),a=1;t.filters&&a<t.filters.length;++a)if(n=t.filters[a],n.boolean){var l=e.find("div.filter-option").last(),u=this._createBooleanSelect();jQuery(u.find("option")).filter(function(){return jQuery(this).val()===n.boolean}).prop("selected","selected"),l.find("div.manage-filter-option").replaceWith(u)}else{var c=this._addAttributeFilter(i);this._fillFilterOptionsDiv(c,n),e.find("div.analyse-filter-popup-values").append(c)}},_fillFilterOptionsDiv:function(e,t){jQuery(e.find("select.attribute option")).filter(function(){return jQuery(this).val()===t.attribute}).prop("selected","selected"),jQuery(e.find("select.operator option")).filter(function(){return jQuery(this).val()===t.operator}).prop("selected","selected"),e.find("input[name=case-sensitive]").attr("checked",t.caseSensitive),e.find("input[name=attribute-value]").val(t.value)},_addAttributeFilter:function(e){{var t=jQuery(this.__filterTemplates.filterContentOption),i=t.find("select.attribute"),n=this.loc.filter.values.placeholders.attribute,a=t.find("select.operator");this.loc.filter.values.placeholders.operator}return this._appendOptionValues(i,n,this._layer.getFilterJson()),this._appendOptionValues(a,null,[{id:"=",name:this.loc.filter.values.equals},{id:"~=",name:this.loc.filter.values.like},{id:"≠",name:this.loc.filter.values.notEquals},{id:"~≠",name:this.loc.filter.values.notLike},{id:">",name:this.loc.filter.values.greaterThan},{id:"<",name:this.loc.filter.values.lessThan},{id:"≥",name:this.loc.filter.values.greaterThanOrEqualTo},{id:"≤",name:this.loc.filter.values.lessThanOrEqualTo}]),t.find("input[name=attribute-value]").attr("placeholder",this.loc.filter.values.placeholders["attribute-value"]),t.find("input[name=case-sensitive]").attr("title",this.loc.filter.values.placeholders["case-sensitive"]),t.append(this._addManageFilterOption(e)),t},_addManageFilterOption:function(e){var t=jQuery(this.__filterTemplates.manageFilterOption),i=this.loc.filter.addFilter,n=this.loc.filter.removeFilter;return t.find("div.add-filter-option").attr("title",i),t.find("div.remove-filter-option").attr("title",n),this._bindAddNewFilter(t.find("div.add-filter-option"),e),this._bindRemoveFilter(t.find("div.remove-filter-option"),e),t},_bindAddNewFilter:function(e,t){var i=this;e.on("click",function(){i._changeAttributeFilter(jQuery(this),t)})},_bindRemoveFilter:function(e,t){var i=this;e.on("click",function(){i._removeFilter(jQuery(this),t)})},_changeAttributeFilter:function(e,t){var i=e.parents("div.filter-option"),n=e.parents("div.analyse-filter-popup-values"),a=this._addAttributeFilter(t),r=this._createBooleanSelect();i.find("div.manage-filter-option").remove(),i.append(r),n.append(a)},_removeFilter:function(e,t){var i=e.parents("div.filter-option"),n=i.prev("div.filter-option"),a=this._addManageFilterOption(t);n.find("select.boolean").replaceWith(a),n&&n.length&&i.remove()},_createBooleanSelect:function(){{var e=jQuery(this.__filterTemplates.filterBooleanOption);this.loc.filter.values.placeholders.boolean}return this._appendOptionValues(e,null,["AND","OR"]),e},_appendOptionValues:function(e,t,i){var n,a=jQuery(this.__filterTemplates.option);for(t&&(a.attr("value",""),a.html(t),e.append(a)),n=0;i&&n<i.length;++n)a=jQuery(this.__filterTemplates.option),"string"==typeof i[n]?(a.attr("value",i[n]),a.html(i[n])):(a.attr("value",i[n].id),a.html(i[n].name)),e.append(a)},getFilterValues:function(){var e,t,i,n,a,r,s,o,l,u={};if(o=this.popup.getJqueryContent(),e="undefined"==typeof this.fixedOptions.bboxSelection?jQuery(o).find("input[name=filter-bbox]:checked").val():this.fixedOptions.bboxSelection,"true"===e&&(u.bbox=this.sandbox.getMap().getBbox()),t="undefined"==typeof this.fixedOptions.clickedFeaturesSelection?jQuery(o).find("input[name=analyse-clicked-features]").is(":checked"):this.fixedOptions.clickedFeaturesSelection,t&&(u.featureIds=!0),i=jQuery(o).find("div.filter-option"),i&&i.length)for(u.filters=[],l=0;l<i.length;++l)n=jQuery(i[l]),a={},a.caseSensitive=n.find('input[name="case-sensitive"]').is(":checked"),a.attribute=n.find("select.attribute").val(),a.operator=n.find("select.operator").val(),a.value=n.find("input[name=attribute-value]").val(),u.filters.push(a),r=n.find("select.boolean").val(),r&&u.filters.push({"boolean":r});return s=u.filters[0],1!==i.length||s.attribute||s.value||delete u.filters,u},_validateFilterValues:function(e){var t,i,n=[],a=e?e.filters:null;for(i=0;a&&i<a.length;++i)t=a[i],i%2===0?(t.boolean&&n.push("boolean_operator_missing"),t.attribute||n.push("attribute_missing"),t.operator||n.push("operator_missing"),t.value||n.push("value_missing")):t.boolean||n.push("boolean_operator_missing");return n.length||(n=!1),n},_displayValidationErrors:function(e){var t,i=this.loc.filter.validation,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=n.createCloseButton(this.loc.buttons.ok),r=this.loc.error.title,s="<h4>"+i.title+"</h4>";for(t=0;t<e.length;++t)s+="<p>"+i[e[t]]+"</p>";n.show(r,s,[a])},_loadWFSLayerPropertiesAndTypes:function(e){{var t=this;t.sandbox.getAjaxUrl()}t._getWFSLayerPropertiesAndTypes(e,function(e){e&&t._handleWFSLayerPropertiesAndTypesResponse(e)},function(){t.instance.showMessage(t.loc.error.title,t.loc.error.loadLayerTypesFailed)})},_getWFSLayerPropertiesAndTypes:function(e,t,i){var n=this.sandbox.getAjaxUrl()+"action_route=GetWFSDescribeFeature&layer_id="+e;jQuery.ajax({type:"GET",dataType:"json",url:n,beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:t,error:i})},_handleWFSLayerPropertiesAndTypesResponse:function(e){var t=e.propertyTypes,i=[];for(var n in t)t.hasOwnProperty(n)&&i.push({id:n,name:n,type:t[n]});this._layer.setFilterJson(i),this.createFilterDialog()},setCloseButtonHandler:function(e){this._closeButtonHandler=e},setClearButtonHandler:function(e){this._clearButtonHandler=e},setUpdateButtonHandler:function(e){this._updateButtonHandler=e}}),define("bundles/framework/bundle/divmanazer/component/FilterDialog",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Form",function(){var e=this;e._element=document.createElement("form"),e._element.className="oskariform oskari-formcomponent oskari-form",e._element.onsubmit=function(t){return e._onSubmit(t)}},{_destroyImpl:function(e){var t,i=this.getComponents();for(t=i.length-1;t>=0;t-=1)i.pop().destroy(e)},getAction:function(){return this._element.action},setAction:function(e){if("string"!=typeof e)throw new TypeError(this.getClazz()+".setAction: action is not a string");this._element.action=e},isEnabled:function(){return!this._element.disabled},setEnabled:function(e){if("boolean"!=typeof e)throw new TypeError(this.getClazz()+".setEnabled: enabled is not a boolean");this._element.disabled=!e},getMethod:function(){return this._element.method},setMethod:function(e){var t;if("string"!=typeof e)throw new TypeError(this.getClazz()+".setMethod: method is not a string");if(t=e.toUpperCase(),"GET"!==e&&"POST"!==e)throw new TypeError(this.getClazz()+".setMethod: unknown method: "+e);this._element.method=t},addField:function(e){Oskari.getSandbox().printWarn(this.getClazz()+".addField is deprecated, please use addComponent instead."),this.addComponent(e)},getForm:function(){return Oskari.getSandbox().printWarn(this.getClazz()+".getForm is deprecated, please use getElement instead."),jQuery(this.getElement())},getHandler:function(){return this._handler},setHandler:function(e){this._handler=e},validate:function(){var e,t=[];for(e=0;e<this.fields.length;e+=1)t=t.concat(this.fields[e].validate());return t},showErrors:function(){Oskari.getSandbox().printWarn(this.getClazz()+".showErrors is deprecated.");var e;this._components.forEach(function(t){t.validate&&(e=t.validate(),t.showErrors&&t.showErrors(e))})},clearErrors:function(){Oskari.getSandbox().printWarn(this.getClazz()+".clearErrors is deprecated."),this._components.forEach(function(e){e.clearErrors&&e.clearErrors()})},_onSubmit:function(e){return this.getHandler()&&this.getHandler()(this,e),!0}},{extend:["Oskari.userinterface.component.Container"]}),define("bundles/framework/bundle/divmanazer/component/Form",function(){}),Oskari.clazz.define("Oskari.userinterface.component.SearchForm",function(){this._element.className="oskari-formcomponent oskari-searchform",this._input=null,this._button=null,this._initFields()},{_initFields:function(){this._input=Oskari.clazz.create("Oskari.userinterface.component.SearchInput","q"),this.addComponent(this._input),this._button=Oskari.clazz.create("Oskari.userinterface.component.buttons.SearchButton"),this.addComponent(this._button)},getButton:function(){return this._button},getInput:function(){return this._input}},{extend:["Oskari.userinterface.component.Form"]}),define("bundles/framework/bundle/divmanazer/component/SearchForm",function(){}),Oskari.clazz.define("Oskari.userinterface.component.UIHelper",function(e){this.sandbox=e},{processHelpLinks:function(e,t,i,n){if(t){var a,r=this;a=function(t){return function(a,r){var s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=s.createCloseButton("OK");o.addClass("primary"),a?(s.show(e,r.static,[o]),s.moveTo(t,"bottom")):s.show(i,n,[o])}},t.find("[helptags]").each(function(e,t){var i=jQuery(t),n=i.attr("helptags");i.bind("click",function(){r.getHelpArticle(n,a(i))})})}},getHelpArticle:function(e,t){var i=this;jQuery.ajax({url:i.sandbox.getAjaxUrl()+"action_route=GetArticlesByTag",data:{tags:e},type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){e&&e.articles[0]&&e.articles[0].content?t(!0,e.articles[0].content):t(!1)},error:function(){t(!1)}})}}),define("bundles/framework/bundle/divmanazer/component/UIHelper",function(){}),Oskari.clazz.define("Oskari.userinterface.component.FormInput",function(e,t){var i,n,a=t||Oskari.getSandbox();a.printWarn("Oskari.userinterface.component.FormInput is deprecated, please use Oskari.userinterface.component.TextInput instead."),this.sandbox=a,this.template=jQuery('<div class="oskarifield"><label></label><input type="text" autofocus/></div>'),this.templateErrors=jQuery('<div class="error"></div>'),this.templateTooltip=jQuery('<div class="icon-info"></div>'),this.templateClearButton=jQuery('<div class="icon-close"></div>'),this._field=this.template.clone(),i=this._field.find("label"),i.attr("for",e),n=this._field.find("input").focus(),n.attr("name",e),this._name=e,this._validator=null,this._required=!1,this._requiredMsg="required",this._contentCheck=!1,this._contentCheckMsg="illegal characters",this._bindFocusAndBlur(),this._regExp=/[\s\w\d\.\,\?\!\-äöåÄÖÅ]*/,this._colorRegExp=/^([A-Fa-f0-9]{6})$/},{destroy:function(){this._field&&this._field.remove()},setLabel:function(e){var t=this._field.find("label");t.html(e)},setIds:function(e,t){e&&this._field.attr("id",e),t&&this._field.find("input").attr("id",t)},setTooltip:function(e,t){var i,n=this.templateTooltip.clone();n.attr("title",e),t&&(n.addClass("help"),n.attr("helptags",t)),i=this._field.find("label"),i.before(n)},setPlaceholder:function(e){var t=this._field.find("input");t.attr("placeholder",e)},setRequired:function(e,t){this._required=e===!0,t&&(this._requiredMsg=t)},setContentCheck:function(e,t,i){this._contentCheck=e===!0,i&&(this._regExp=i),t&&(this._contentCheckMsg=t)},showErrors:function(e){this.clearErrors();var t,i=this.templateErrors.clone();for(t=0;t<e.length;t+=1)i.append(e[t].error+"<br/>");this._field.append(i)},clearErrors:function(){var e=this._field.find("div.error");e.remove()},getField:function(){return this._field},getElement:function(){return this._field[0]},getValue:function(e){var t=this._field.find("input").val();return(null===t||void 0===t)&&(t=""),e&&(t=t.match(this._regExp).join("")),t=t.replace("<",""),t=t.replace("&",""),t=t.replace("\\","")},setValue:function(e){this._field.find("input").attr("value",e)},getName:function(){return this._name},setEnabled:function(e){e===!0?this._field.find("input").removeAttr("disabled"):this._field.find("input").attr("disabled","disabled")},setRegExp:function(e){this._regExp=e},setValidator:function(e){this._validator=e},validate:function(){var e,t=[];return this._validator&&(t=this._validator(this)),e=this.getValue(),this._required&&(this.checkLength(e,1)||t.push({field:this.getName(),error:this._requiredMsg})),this._contentCheck&&(this.checkValue()||t.push({field:this.getName(),error:this._contentCheckMsg})),t},checkLength:function(e,t,i){if(e){var n=jQuery.trim(e.toString());return t&&n.length<t?!1:i&&n.length>i?!1:!0}return!1},checkValue:function(){var e=this.getValue(),t=this.getValue(!0);return e===t},validateNumberRange:function(e,t,i){return isNaN(parseInt(e,10))?!1:isFinite(e)?t>e||e>i?!1:!0:!1},validateHexColor:function(e){return this._colorRegExp.test(e)},bindEnterKey:function(e){var t=this,i=this._field.find("input");i.keypress(function(i){t._isEnterPress(i)&&e(i)})},bindUpKey:function(e){var t=this,i=this._field.find("input");i.keydown(function(i){t._isUpPress(i)&&(i.preventDefault(),e(i))})},bindDownKey:function(e){var t=this,i=this._field.find("input");i.keydown(function(i){t._isDownPress(i)&&(i.preventDefault(),e(i))})},bindOnBlur:function(e){var t=this._field.find("input");t.blur(function(){e()})},bindChange:function(e,t){var i=this._field.find("input");t?i.keyup(e):i.on("change",e)},addClearButton:function(e){var t=this.templateClearButton.clone(),i=this._field.find("input");t.attr("id",e),t.bind("click",function(){i.val(""),i.trigger("change"),i.trigger("keyup")}),i.after(t)},_bindFocusAndBlur:function(){var e,t,i,n=this.sandbox;n&&(e=n.getRequestBuilder("EnableMapKeyboardMovementRequest"),t=n.getRequestBuilder("DisableMapKeyboardMovementRequest"),e&&t&&(i=this._field.find("input"),i.focus(function(){n.postRequestByName("DisableMapKeyboardMovementRequest")}),i.blur(function(){n.postRequestByName("EnableMapKeyboardMovementRequest")})))},_isEnterPress:function(e){var t=e.which;return 13===t},_isDownPress:function(e){var t=e.which;return 40===t},_isUpPress:function(e){var t=e.which;return 38===t}}),define("bundles/framework/bundle/divmanazer/component/FormInput",function(){}),!function(e){var t=function(e,t){this.init("oskariTooltip",e,t)},i=function(e,t){this.init("oskariPopover",e,t)};t.prototype={constructor:t,init:function(t,i,n){var a,r;this.type=t,this.$element=e(i),this.options=this.getOptions(n),this.enabled=!0,"manual"!==this.options.trigger&&(a="hover"===this.options.trigger?"mouseenter":"focus",r="hover"===this.options.trigger?"mouseleave":"blur",this.$element.on(a,this.options.selector,e.proxy(this.enter,this)),this.$element.on(r,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.show?(clearTimeout(this.timeout),i.hoverState="in",void(this.timeout=setTimeout(function(){"in"===i.hoverState&&i.show()},i.options.delay.show))):i.show()},leave:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.hide?(clearTimeout(this.timeout),i.hoverState="out",void(this.timeout=setTimeout(function(){"out"===i.hoverState&&i.hide()},i.options.delay.hide))):i.hide()},show:function(){var e,t,i,n,a,r,s;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),r=this.options.placement.apply(this.options.scope),t=/in/.test(r),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),i=this.getPosition(t),n=e[0].offsetWidth,a=e[0].offsetHeight,t?r.split(" ")[1]:r){case"bottom":s={top:i.top+i.height,left:i.left+i.width/2-n/2};break;case"top":s={top:i.top-a,left:i.left+i.width/2-n/2};break;case"left":s={top:i.top+i.height/2-a/2,left:i.left-n};break;case"right":s={top:i.top+i.height/2-a/2,left:i.left+i.width}}e.css(s).addClass(r).addClass("in")}},isHTML:function(e){return"string"!=typeof e||"<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(e)},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".oskari-tooltip-inner")[this.isHTML(t)?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){i.off(e.support.transition.end).remove()},500);i.one(e.support.transition.end,function(){clearTimeout(t),i.remove()})}var i=this.tip();i.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():i.remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){return this.options.title.apply(this.options.scope)},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},attach:function(e){this.$element=e}},e.fn.oskariTooltip=function(i){return this.each(function(){var n=e(this),a=n.data("oskariTooltip"),r="object"==typeof i&&i;a||n.data("oskariTooltip",a=new t(this,r)),"string"==typeof i&&a[i]()})},e.fn.oskariTooltip.Constructor=t,e.fn.oskariTooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="oskari-tooltip"><div class="oskari-tooltip-arrow"></div><div class="oskari-tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0},i.prototype=e.extend({},e.fn.oskariTooltip.Constructor.prototype,{constructor:i,setContent:function(){var e=this.tip(),t=this.getTitle(),i=this.getContent();e.find(".oskari-popover-title")[this.isHTML(t)?"html":"text"](t),e.find(".oskari-popover-content > *")[this.isHTML(i)?"html":"text"](i),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){return this.options.content.apply(this.options.scope)},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip}}),e.fn.oskariPopover=function(t){return this.each(function(){var n=e(this),a=n.data("oskariPopover"),r="object"==typeof t&&t;a||n.data("oskariPopover",a=new i(this,r)),"string"==typeof t&&a[t]()})},e.fn.oskariPopover.Constructor=i,e.fn.oskariPopover.defaults=e.extend({},e.fn.oskariTooltip.defaults,{placement:"right",content:"",template:'<div class="oskari-popover"><div class="oskari-arrow"></div><div class="oskari-popover-inner"><h3 class="oskari-popover-title"></h3><div class="oskari-popover-content"><p></p></div></div></div>'}),Oskari.clazz.define("Oskari.userinterface.component.Popover",function(e,t){this.title=e,this.content=t,this.$container=null,this.data=null,this.shown=!1,this.placement="bottom"},{templates:{container:'<div class="oskari-popover-container"/>'},hide:function(){this.shown&&(this.shown=!1,this.data&&this.data.hide())},show:function(){this.shown||this.data&&(this.data.show(),this.shown=!0)},attachTo:function(t){var n=this;n.$container=e(t),n.data?n.data.attach(n.$container):n.data=new i(t,{scope:n,title:n.getTitle,content:n.getContent,trigger:"manual",placement:n.getPlacement}),n.$container.data("oskariPopover",n.data)},getTitle:function(){return this.title},getContent:function(){return this.content},setContent:function(e,t){var i=this;i.hide(),i.content=e,t&&(i.title=t),i.show()},setTitle:function(e,t){var i=this;i.hide(),i.title=e,t&&(i.content=t),i.show()},setPlacement:function(e){this.placement=e},getPlacement:function(){return this.placement}})}(window.jQuery),define("bundles/framework/bundle/divmanazer/component/Popover",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Grid",function(){this.model=null,this._defaultLocKey="Grid",this._loc=this._getLocalization("DivManazer"),this.template=jQuery('<table class="oskari-grid"><thead><tr></tr></thead><tbody></tbody></table>'),this.templateTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>'),this.templateDiv=jQuery("<div></div>"),this.templateRow=jQuery("<tr></tr>"),this.templateCell=jQuery("<td></td>"),this.templatePopupLink=jQuery('<a href="JavaScript: void(0);"></a>'),this.templateTabTools=jQuery('<div class="tab-tools"></div>'),this.templateExporter=jQuery('<div class="exporter"></div>'),this.templateColumnSelectorTitle=jQuery('<div class="column-selector-title"></div>'),this.templateColumnSelectorWrapper=jQuery("<div/>",{}),this.templateColumnSelector=jQuery("<div/>",{}),this.templateColumnSelectorList=jQuery("<ul/>",{}),this.templateColumnSelectorListItem=jQuery('<li><div><input type="checkbox"/><label></label></div></li>'),this.templateColumnSelectorClose=jQuery('<div class="icon-close close-selector-button"></div>'),this.csvButton=null,this.excelButton=null,this.table=null,this.fieldNames=[],this.selectionListeners=[],this.additionalDataHandler=null,this.visibleColumnSelector=null,this.showColumnSelector=!1,this.showExcelExporter=!1,this.resizableColumns=!1,this.uiNames={},this.valueRenderer={},this.lastSort=null},{setDataModel:function(e){this.model=e},getDataModel:function(){return this.model},setColumnSelector:function(e){this.showColumnSelector=e},setExcelExporter:function(e){this.showExcelExporter=e},setResizableColumns:function(e){this.resizableColumns=e},setColumnUIName:function(e,t){this.uiNames[e]=t},setColumnValueRenderer:function(e,t){this.valueRenderer[e]=t},getVisibleFields:function(){return this.fieldNames},setVisibleFields:function(e){this.fieldNames=e},addSelectionListener:function(e){this.selectionListeners.push(e)},_createSubTable:function(e,t,i,n){var a,r,s,o,l,u,c;u=this.templateCell.clone(),a=i,c=t,r=this.table.find("th"),s=jQuery(this.table.find("th")[c]).hasClass("closedSubTable"),u.addClass("base"),u.addClass(a),e.append(u),c+=1;do{if(c===r.length)break;o=!1;for(l in n)if(n.hasOwnProperty(l)&&jQuery(r[c]).data("key")===a&&jQuery(r[c]).data("value")===l){u=this.templateCell.clone(),u.addClass(a),u.append(n[l]),s&&u.addClass("hidden"),e.append(u),c+=1,o=!0;break}}while(o);return c},setAdditionalDataHandler:function(e,t){this.additionalDataHandler={title:e,handler:t}},_createAdditionalDataField:function(e){if(!e||jQuery.isEmptyObject(e))return!1;var t,i=this,n=this._renderAdditionalData(e);return!e.size&&this.additionalDataHandler?(t=this.templatePopupLink.clone(),t.append(this.additionalDataHandler.title),t.bind("click",function(){return i.additionalDataHandler.handler(t,n),!1}),t):n},_renderAdditionalData:function(e){var t,i,n,a,r,s,o,l,u,c=this.template.clone(),d=c.find("tbody");if(e.size){for(t="",l=0;l<e.size();l+=1)0!==l&&(t+=", "),t+=e[l];return t}if(jQuery.isArray(e)){for(r=this.templateDiv.clone(),l=0;l<e.length;l+=1)o=this._renderAdditionalData(e[l]),r.append(o);return r}for(u in e)if(e.hasOwnProperty(u)){i=this.templateRow.clone(),n=this.templateCell.clone(),a=this.templateCell.clone(),t=e[u],n.append(u),i.append(n);try{s=typeof t,"object"===s?(o=this._renderAdditionalData(t),a.append(o)):"function"!==s&&a.append(t),i.append(a)}catch(h){}d.append(i)}return c},_renderHeader:function(e,t){var i,n,a,r,s,o,l,u,c,d,h,p,f,m=this,g=e.find("thead tr"),v=e.find("tbody");if(f=function(i){return function(){var n,a,r=jQuery(this),s=m.getSelection(),o=!1;for(v.empty(),m.lastSort&&m.lastSort.attr===i&&(o=!m.lastSort.descending),m._sortBy(i,o),m._renderBody(e,t),g.find("th").removeClass("asc"),g.find("th").removeClass("desc"),r.parent().addClass(o?"desc":"asc"),n=m.model.getIdField(),a=0;a<s.length;a+=1)m.select(s[a][n],!0);return!1}},r=this.model.getData(),0!==r.length){for(o=[],s=r[0],i=0;i<t.length;i+=1)if(d=t[i],h=s[d],"object"==typeof h){o.push({key:d,baseKey:d,subKey:d,type:"object",visibility:"shown"});for(p in h)h.hasOwnProperty(p)&&o.push({key:d+"."+p,baseKey:d,subKey:p,type:"default",visibility:"hidden"})}else o.push({key:d,baseKey:d,subKey:p,type:"default",visibility:"shown"});for(i=0;i<o.length;i+=1)n=this.templateTableHeader.clone(),a=n.find("a"),l=o[i].key,u=o[i].baseKey,c=this.uiNames[u],c?l!==o[i][d]&&(c=l.replace(u,c)):c=l,a.append(c),m.lastSort&&l===m.lastSort.attr&&n.addClass(m.lastSort.descending?"desc":"asc"),"default"===o[i].type?a.bind("click",f(o[i].key)):"object"===o[i].type&&(n.addClass("closedSubTable"),n.addClass("base"),a.bind("click",function(){var t=jQuery(this).parent(),i=t.data("key");t.hasClass("closedSubTable")?(e.find("th.hidden."+i).removeClass("hidden"),e.find("td.hidden."+i).removeClass("hidden"),t.removeClass("closedSubTable"),t.addClass("openSubTable")):(e.find("th."+i).not(".base").addClass("hidden"),e.find("td."+i).not(".base").addClass("hidden"),t.removeClass("openSubTable"),t.addClass("closedSubTable"))})),"hidden"===o[i].visibility&&n.addClass("hidden"),n.addClass(o[i].baseKey),n.data("key",o[i].baseKey),n.data("value",o[i].subKey),g.append(n)}},_renderBody:function(e,t){var i,n,a,r,s,o,l,u,c,d,h,p=this,f=e.find("tbody"),m=this.model.getData();for(i=0;i<m.length;i+=1){for(n=this.templateRow.clone(),a=m[i],n.attr("data-id",a[this.model.getIdField()]),u=0,r=0;r<t.length;r+=1)s=t[r],o=a[s],"object"==typeof o?u=this._createSubTable(n,u,s,o):(l=this.templateCell.clone(),c=this.valueRenderer[s],c&&(o=c(o,a)),l.append(o),n.append(l),u+=1);
f.append(n)}d=e.find("tbody tr"),h=function(){p._dataSelected(jQuery(this).attr("data-id"))},d.bind("click",h),d.find("a").hover(function(){jQuery(this).parents("tr").unbind("click")},function(){jQuery(this).parents("tr").bind("click",h)})},_renderColumnSelector:function(e,t){this.visibleColumnSelector=this.templateColumnSelectorWrapper.clone();var i,n,a,r,s,o,l=this,u=this.templateColumnSelectorTitle.clone(),c=this.templateColumnSelector.clone(),d=this.templateColumnSelectorList.clone(),h=this.templateColumnSelectorClose.clone();for(this.visibleColumnSelector.addClass("column-selector-placeholder"),c.addClass("column-selector"),u.append(this._loc.columnSelector.title),this.visibleColumnSelector.append(u),this.visibleColumnSelector.append(c),jQuery("input.column-selector-list-item").remove(),this.visibleColumnSelector.click(function(){"hidden"!==c.css("visibility")?c.css("visibility","hidden"):c.css("visibility","visible")}),h.click(function(e){e.stopPropagation(),c.css("visibility","hidden")}),i=this.model.getFields(),a=0;a<i.length;a+=1){for(n=!1,r=0;r<t.length;r+=1)if(i[a]===t[r]){n=!0;break}s=this.templateColumnSelectorListItem.clone(),s.addClass("column-selector-list-item"),o=s.find("input"),o.attr("checked",n),o.addClass("column-selector-list-item"),o.attr("id",i[a]),s.find("label").attr({"for":i[a],"class":"column-label"}).html(i[a]),s.css({margin:"5px"}),o.change(function(){var t,i,n=jQuery("input.column-selector-list-item"),a=l.model.getFields(),r=[];for(t=0;t<a.length;t+=1)for(i=0;i<n.length;i+=1)if(a[t]===n[i].id){n[i].checked&&r.push(a[t]);break}r.length>0&&l.setVisibleFields(r),l.renderTo(e.parent(),{columnSelector:"open"})}),d.append(s)}d.attr("class","column-selector-list"),c.append(d,h),h.click(function(e){e.stopPropagation(),c.css("visibility","hidden")})},_enableColumnResizer:function(){var e,t,i,n=!1,a=jQuery("table.oskari-grid th");a.css("cursor","e-resize"),a.mousedown(function(a){e=jQuery(this),n=!0,t=a.pageX,i=jQuery(this).width(),jQuery(e).addClass("resizing"),jQuery(document).attr("unselectable","on").css("user-select","none").on("selectstart",!1)}),jQuery(document).mousemove(function(a){n&&jQuery(e).width(i+(a.pageX-t))}),jQuery(document).mouseup(function(){n&&(jQuery(e).removeClass("resizing"),n=!1)})},renderTo:function(e,t){var i,n,a,r=this;if(e.empty(),(this.showColumnSelector||this.showExcelExporter)&&(i=this.templateTabTools.clone(),e.parent().children(".tab-tools").remove(),e.parent().prepend(i)),n=this.fieldNames,a=this.template.clone(),0===n.length&&(n=this.model.getFields()),this.table=a,this._renderHeader(a,n),this.lastSort&&this._sortBy(this.lastSort.attr,this.lastSort.descending),this._renderBody(a,n),this.showColumnSelector&&(this._renderColumnSelector(a,n),e.parent().find(".tab-tools").append(this.visibleColumnSelector),null!==t&&void 0!==t&&"open"===t.columnSelector&&this.visibleColumnSelector.find(".column-selector").css("visibility","visible")),this.showExcelExporter){var s=r.templateExporter.clone(),o=r._loc.export.title;s.append(o),r.csvButton=Oskari.clazz.create("Oskari.userinterface.component.Button"),r.csvButton.setTitle(r._loc.export.csv),r.csvButton.addClass("csvExportButton"),r.csvButton.setHandler(function(){var e,t,i,n="",a=r.table.find("thead th").not(".hidden").find("a"),s=r.table.find("tbody tr");for(e=0;e<a.length;e+=1)e>0&&(n+=","),n=n+'"'+jQuery(a[e]).html()+'"';for(n+="\n",e=0;e<s.length;e+=1){for(i=jQuery(s[e]).find("td").not(".hidden"),t=0;t<i.length;t+=1)t>0&&(n+=","),n=n+'"'+jQuery(i[t]).html()+'"';n+="\n"}if("Microsoft Internet Explorer"!==navigator.appName)window.location="data:text/csv;charset=utf8,"+encodeURIComponent(n);else{n=n.split("\n").join("<br />");var o=window.open("","csv","height=400,width=600");o.document.write("<html><head><title>CSV</title>"),o.document.write("</head><body >"),o.document.write(n),o.document.write("</textArea>"),o.document.close()}}),s.append(r.csvButton.getElement()),r.excelButton=Oskari.clazz.create("Oskari.userinterface.component.Button"),r.excelButton.setTitle(r._loc.export.excel),r.excelButton.addClass("excelExportButton"),r.excelButton.setHandler(function(){var e,t=r.table.clone(),i="data:application/vnd.ms-excel;base64,",n='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',a=function(e,t){return e.replace(/{(\w+)}/g,function(e,i){return t[i]})};t.find("th.hidden").remove(),t.find("td.hidden").remove(),e={worksheet:"Worksheet",table:t.html()},window.location.href=i+jQuery.base64.encode(a(n,e))}),"Microsoft Internet Explorer"!==navigator.appName&&s.append(r.excelButton.getElement()),e.parent().find(".tab-tools").append(s)}e.append(a),this.resizableColumns&&this._enableColumnResizer()},_dataSelected:function(e){var t;for(t=0;t<this.selectionListeners.length;t+=1)this.selectionListeners[t](this,e)},select:function(e,t){var i,n,a,r=this.model.getIdField(),s=this.model.getData();for(i=0;i<s.length&&(a=s[i],a[r]!==e);i+=1);n=this.table.find("tbody tr"),t!==!0&&n.removeClass("selected"),jQuery(n[i]).addClass("selected")},removeSelections:function(){var e=this.table.find("tbody tr");e.removeClass("selected")},getSelection:function(){var e,t,i=this.model.getData(),n=[],a=this.table.find("tbody tr");for(e=0;e<a.length;e+=1)t=jQuery(a[e]),t.hasClass("selected")&&n.push(i[e]);return n},getTable:function(){return this.table},_sortBy:function(e,t){var i=this,n=i.model.getData();0!==n.length&&(this.lastSort={attr:e,descending:t},n.sort(function(n,a){return i._sortComparator(n,a,e,t)}))},_getAttributeValue:function(e,t){var i,n=e[t],a=t.split(".");return"undefined"==typeof n&&(n=e[a[0]][a[1]]),n?n.toLowerCase&&(n=n.toLowerCase()):n="",i=parseFloat(n),isNaN(i)||(n=i),n},_sortComparator:function(e,t,i,n){var a,r,s=0;return"object"==typeof e[i]||"object"==typeof t[i]?0:(a=this._getAttributeValue(e,i),r=this._getAttributeValue(t,i),r>a?s=-1:a>r&&(s=1),n&&(s=-1*s),s)},_getLocalization:function(e){var t=Oskari.getLocalization(e),i=null;return t&&(i=t[this._defaultLocKey]),i}}),define("bundles/framework/bundle/divmanazer/component/Grid",function(){}),Oskari.clazz.define("Oskari.userinterface.component.GridModel",function(){this.fields=[],this.data=[],this.idField=null},{_addField:function(e){this.idField||(this.idField=e),this.fields.push(e)},getFields:function(){return this.fields},setIdField:function(e){this.idField=e},getIdField:function(){return this.idField},addData:function(e){var t;if(0===this.fields.length)for(t in e)e.hasOwnProperty(t)&&this._addField(t);this.data.push(e)},getData:function(){return this.data}}),define("bundles/framework/bundle/divmanazer/component/GridModel",function(){}),Oskari.clazz.define("Oskari.userinterface.component.ProgressSpinner",function(){this.container=void 0,this.opts=void 0},{__opts:{lines:15,length:0,width:5,radius:16,corners:0,rotate:0,color:"#000",speed:.6,trail:59,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},insertTo:function(e,t){this.container=e,this.opts=t||this.__opts},start:function(){var e=this.container,t=$(e),i=t.data(),n=this._Spinner,a=this.opts;i.spinner&&(i.spinner.stop(),delete i.spinner),a!==!1&&(i.spinner=new n($.extend({color:t.css("color")},a)).spin(t.get()[0]))},stop:function(){var e,t,i=this.container;i&&(e=$(i),t=e.data(),t.spinner&&(t.spinner.stop(),delete t.spinner))},_Spinner:function(e,t){function i(e,i){var n,a=t.createElement(e||"div");for(n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);return a}function n(e){var t,i;for(t=1,i=arguments.length;i>t;t+=1)e.appendChild(arguments[t]);return e}function a(e,t,i,n){var a=["opacity",t,~~(100*e),i,n].join("-"),r=.01+i/n*100,s=Math.max(1-(1-e)/t*(100-r),e),o=c.substring(0,c.indexOf("Animation")).toLowerCase(),l=o&&"-"+o+"-"||"";return p[a]||(d.insertRule("@"+l+"keyframes "+a+"{0%{opacity:"+s+"}"+r+"%{opacity:"+e+"}"+(r+.01)+"%{opacity:1}"+(r+t)%100+"%{opacity:"+e+"}100%{opacity:"+s+"}}",d.cssRules.length),p[a]=1),a}function r(e,t){var i,n,a=e.style;if(void 0!==a[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<h.length;n+=1)if(i=h[n]+t,void 0!==a[i])return i}function s(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e.style[r(e,i)||i]=t[i]);return e}function o(e){var t,i,n;for(n=1;n<arguments.length;n+=1){t=arguments[n];for(i in t)t.hasOwnProperty(i)&&void 0===e[i]&&(e[i]=t[i])}return e}function l(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function u(e){return this.spin?void(this.opts=o(e||{},u.defaults,f)):new u(e)}var c,d,h=["webkit","Moz","ms","O"],p={},f={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};return d=function(){var e=i("style",{type:"text/css"});return n(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),u.defaults={},o(u.prototype,{spin:function(e){this.stop();var t,n,a,r,o,u,d,h=this,p=h.opts,f=h.el=s(i(0,{className:p.className}),{position:p.position,width:0,zIndex:p.zIndex}),m=p.radius+p.length+p.width;return e&&(e.insertBefore(f,e.firstChild||null),n=l(e),t=l(f),s(f,{left:("auto"===p.left?n.x-t.x+(e.offsetWidth>>1):parseInt(p.left,10)+m)+"px",top:("auto"===p.top?n.y-t.y+(e.offsetHeight>>1):parseInt(p.top,10)+m)+"px"})),f.setAttribute("aria-role","progressbar"),h.lines(f,h.opts),c||(a=0,r=p.fps,o=r/p.speed,u=(1-p.opacity)/(o*p.trail/100),d=o/p.lines,function g(){var e,t;for(a+=1,e=p.lines;e;e-=1)t=Math.max(1-(a+e*d)%o*u,p.opacity),h.opacity(f,p.lines-e,t,p);h.timeout=h.el&&setTimeout(g,~~(1e3/r))}()),h},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(e,t){function r(e,n){return s(i(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*o+t.rotate)+"deg) translate("+t.radius+"px,0)",borderRadius:(t.corners*t.width>>1)+"px"})}var o,l;for(o=0;o<t.lines;o+=1)l=s(i(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:c&&a(t.opacity,t.trail,o,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&n(l,s(r("#000","0 0 4px #000"),{top:"2px"})),n(e,n(l,r(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}}),function(){function e(e,t){return i("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=s(i("group"),{behavior:"url(#default#VML)"});!r(t,"transform")&&t.adj?(d.addRule(".spin-vml","behavior:url(#default#VML)"),u.prototype.lines=function(t,i){function a(){return s(e("group",{coordsize:d+" "+d,coordorigin:-c+" "+-c}),{width:d,height:d})}function r(t,r,o){n(l,n(s(a(),{rotation:360/i.lines*t+"deg",left:~~r}),n(s(e("roundrect",{arcsize:i.corners}),{width:c,height:i.width,left:i.radius,top:-i.width>>1,filter:o}),e("fill",{color:i.color,opacity:i.opacity}),e("stroke",{opacity:0}))))}var o,l,u,c=i.length+i.width,d=2*c;if(o=2*-(i.width+i.length)+"px",l=s(a(),{position:"absolute",top:o,left:o}),i.shadow)for(u=1;u<=i.lines;u+=1)r(u,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(u=1;u<=i.lines;u+=1)r(u);return n(t,l)},u.prototype.opacity=function(e,t,i,n){var a=e.firstChild;n=n.shadow&&n.lines||0,a&&t+n<a.childNodes.length&&(a=a.childNodes[t+n],a=a&&a.firstChild,a=a&&a.firstChild,a&&(a.opacity=i))}):c=r(t,"animation")}(),u}(window,document)}),define("bundles/framework/bundle/divmanazer/component/ProgressSpinner",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Container",function(){this._clazz="Oskari.userinterface.component.Container",this._components=[]},{addComponent:function(e){if(null===e||void 0===e)throw new TypeError(this.getClazz()+".addComponent: no component");if(!e.getElement||!e.destroy)throw Oskari.getSandbox().printWarn(this.getClazz()+".addComponent:",e,"is not a component"),new TypeError(this.getClazz()+".addComponent: component is not a component");if(-1!==this._getComponentIndex(e))throw Oskari.getSandbox().printWarn(this.getClazz()+".addComponent:",e,"has already been added"),new Error(this.getClazz()+".addComponent: component has already been added");this._components.push(e),this._element.appendChild(e.getElement())},removeComponent:function(e){if(null===e||void 0===e)throw new TypeError(this.getClazz()+".removeComponent: no component");var t=this._getComponentIndex(e);-1!==t?(this._components.splice(t,1),e.destroy(!1)):Oskari.getSandbox().printWarn(this.getClazz()+".removeComponent: container doesn't hold component",e)},getComponents:function(){return this._components.slice(0)},getValues:function(e,t){var i,n,a,r=this._components;for(i=0;i<r.length;i+=1)n=r[i],!n.isDisabled()&&n.getName&&n.getName()&&""!==n.getName()&&n.getValue&&void 0!==n.getValue()&&""!==n.getValue()&&(a=e[n.getName()],a?Array.isArray(a)?a.push(n.getValue()):e[n.getName()]=[a,n.getValue()]:e[n.getName()]=n.getValue()),n.getValues&&n.getValues(e,t);return e},_getComponentIndex:function(e){var t,i,n=-1;for(t=0;t<this._components.length;t+=1)if(i=this._components[t],i===e&&i.getElement()===e.getElement()){n=t;break}return n}},{extend:["Oskari.userinterface.component.Component"]}),define("bundles/framework/bundle/divmanazer/component/Container",function(){}),Oskari.clazz.define("Oskari.userinterface.component.FormComponent",function(){this._clazz="Oskari.userinterface.component.FormComponent",this._enabled=!0,this._handler=null,this._name=null,this._required=!1,this._title=null,this._tooltip=null,this._visible=!0},{destroy:function(e){this._destroyImpl(e),e||(console.log("Real destroy"),this.getHandler()&&this.getHandler()(void 0),this._element&&(console.log("Has element"),this._element.parentNode&&(console.log("Has element parent, removing element"),this._element.parentNode.removeChild(this._element))))},focus:function(){return void 0},validate:function(){return!0},isEnabled:function(){return!0},setEnabled:function(e){if("boolean"!=typeof e)throw new TypeError(this.getClazz()+".setEnabled: enabled is not a boolean");this._setEnabledImpl(e)},_setEnabledImpl:function(){return void 0},getHandler:function(){return this._handler},setHandler:function(e){if(e&&"function"!=typeof e)throw new TypeError(this.getClazz()+".setHandler: handler is not a function.");this._handler=e,this._setHandlerImpl()},_setHandlerImpl:function(){return void 0},getName:function(){throw new Error(this.getClazz()+".getName is unimplemented subclass")},setName:function(){throw new Error(this.getClazz()+".setName is unimplemented subclass")},isRequired:function(){return!1},setRequired:function(e){if("boolean"!=typeof e)throw new TypeError(this.getClazz()+".setRequired: required is not a boolean");this._setRequiredImpl(e)},_setRequiredImpl:function(){return void 0},getTitle:function(){throw new Error(this.getClazz()+".getTitle is unimplemented subclass")},setTitle:function(){throw new Error(this.getClazz()+".setTitle is unimplemented subclass")},getTooltip:function(){throw new Error(this.getClazz()+".getTooltip is unimplemented subclass")},setTooltip:function(){throw new Error(this.getClazz()+".setTooltip is unimplemented in subclass")},getValue:function(){throw new Error(this.getClazz()+".getValue is unimplemented subclass")},setValue:function(){throw new Error(this.getClazz()+".setValue is unimplemented subclass")}},{extend:["Oskari.userinterface.component.Component"]}),define("bundles/framework/bundle/divmanazer/component/FormComponent",function(){}),Oskari.clazz.define("Oskari.userinterface.component.Select",function(){var e=this;e._clazz="Oskari.userinterface.component.Select",e._element=document.createElement("label"),e._titleEl=document.createElement("div"),e._select=document.createElement("select"),e._element.className="oskari-formcomponent oskari-select",e._titleEl.style.display="none",null!==name&&void 0!==name&&e.setName(name),e._select.onchange=function(){e._valueChanged()},e._element.appendChild(e._titleEl),e._element.appendChild(e._select)},{focus:function(){this._select.focus()},isEnabled:function(){return!this._element.disabled},isMultiple:function(){return this._select.multiple},setMultiple:function(e){if("boolean"!=typeof e)throw new TypeError(this.getClazz()+".setMultiple: multiple is not a boolean");this._select.multiple=e},setOptions:function(e){if(!Array.isArray(e))throw new TypeError(this.getClazz()+".setOptions: options is not an array");var t,i,n,a=this.getValue(),r=this._select.querySelectorAll("option");for(t=0,i=e.length;i>t;t+=1)t<r.length?n=r[t]:(n=document.createElement("option"),this._select.appendChild(n)),n.text=e[t].title,n.value=e[t].value;for(this._select.disabled=0===i,i=r.length;i>t;t+=1)this._select.removeChild(r[t]);this.getValue()!==a&&this._valueChanged()},_getValueArray:function(e){var t=[];return null!==e&&void 0!==e&&(Array.isArray(e)?(e.forEach(function(e){t.push(String(e))}),t=e):t.push(String(e))),t},_equalValues:function(e,t){var i,n=e.length===t.length;if(n)for(i=0;i<e.length;i+=1)if(e[i]!==t[i]){n=!1;break}return n},_valueChanged:function(){this.getHandler()&&this.getHandler()(this.getValue())},_setEnabledImpl:function(e){this._select.disabled=!e},getName:function(){return this.select.name},setName:function(e){this._select.name=e||""},isRequired:function(){return this._select.required},_setRequiredImpl:function(){this._select.required=this.isRequired()},getTitle:function(){return this._titleEl.textContent},setTitle:function(e){this._titleEl.textContent="",null!==e&&void 0!==e?(this._titleEl.style.display="",this._titleEl.appendChild(document.createTextNode(e))):this._titleEl.style.display="none"},getTooltip:function(){return this._element.title},setTooltip:function(e){this._element.title=e},_getOptionValue:function(e){return void 0!==e.value?e.value:e.textContent},getValue:function(){var e,t,i=this,n=i._select.querySelectorAll("option:checked");if(i.isMultiple())for(t=[],e=0;e<n.length;e+=1)t.push(i._getOptionValue(n[e]));else t=n.length?i._getOptionValue(n[0]):void 0;return t},setValue:function(e){var t,i,n,a=this._getValueArray(this.getValue()),r=this._getValueArray(e),s=this._select.querySelectorAll("option"),o=!1;for(t=s.length-1;t>=0;t-=1)n=s[t],n.selected=-1!==r.indexOf(n.value),n.selected&&(o=!0);!o&&s&&(s[0].selected=!0),r=this._getValueArray(this.getValue()),i=this._equalValues(a,r),i&&this._valueChanged()},_setVisibleImpl:function(){this.getElement().style.display=this.isVisible()?"":"none"}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/Select",function(){}),Oskari.clazz.define("Oskari.userinterface.component.LanguageSelect",function(){var e,t,i=this,n=Oskari.getLocalization("DivManazer").LanguageSelect,a=[];for(i._clazz="Oskari.userinterface.component.LanguageSelect",i._element.className="oskari-formcomponent oskari-select oskari-languageselect",t=Oskari.getSupportedLanguages(),e=0;e<t.length;e+=1)a.push({title:n.languages[t[e]]||t[e],value:t[e]});i.setOptions(a),i.setName("language"),i.setTitle(n.title),i.setTooltip(n.tooltip),i.setValue(Oskari.getLang())},{limitOptions:function(e){if(!Array.isArray(e))throw new TypeError(this.getClazz()+".limitOptions: allowedValues is not an array");var t,i=this._select.querySelectorAll("option");for(t=i.length-1;t>-1;t-=1)-1===e.indexOf(i[t].value)&&this._select.removeChild(i[t])}},{extend:["Oskari.userinterface.component.Select"]}),define("bundles/framework/bundle/divmanazer/component/LanguageSelect",function(){}),Oskari.clazz.define("Oskari.userinterface.component.MultiLevelSelect",function(){var e=this;e._clazz="Oskari.userinterface.component.MultiLevelSelect",e._element=document.createElement("fieldset"),e._name=null,e._selects=[],e._titleEl=document.createElement("legend"),e._element.className="oskari-formcomponent oskari-multilevelselect",e._element.appendChild(e._titleEl),e._handlerInvactive=!1},{_destroyImpl:function(e){var t;if(!e)for(t=this._selects.length-1;t>=0;t-=1)this._selects.pop().destroy(!0)},focus:function(){this._selects&&this._selects[0].focus()},isEnabled:function(){return!this.getElement().disabled},setOptions:function(e){if(!Array.isArray(e))throw new TypeError(this.getClazz()+".setOptions: optionsArray is not an array");if(e.some(function(e){return!e||!Array.isArray(e.options)}))throw new TypeError(this.getClazz()+".setOptions: invalid options in optionsArray");var t,i,n,a,r=this,s=(r.getHandler(),r._selects.length),o=!1;for(r._handlerInvactive=!0,t=0,i=e.length;i>t;t+=1)s>t?(a=r._selects[t].getValue(),r._setSelectOptions(r._selects[t],e[t],a),o=o||r._selects[t].getValue()!==a):(o=!0,n=r._createSelect(e[t]),n.insertTo(r.getElement()),r._selects.push(n));for(s-=1;s>=t;s-=1)o=!0,r._selects.pop().destroy(!1);r._handlerInvactive=!1,o&&r._valueChanged()},_createSelect:function(e,t){if(!Array.isArray(e.options))throw new TypeError(this.getClazz()+"._createSelect: options.options is not an array");var i=this,n=Oskari.clazz.create("Oskari.userinterface.component.Select",i._name);return this._setSelectOptions(n,e,t),n.setHandler(function(){i._valueChanged()}),n},_setSelectOptions:function(e,t,i){t.title&&e.setTitle(t.title),t.multiple&&e.setMultiple(!0),e.setOptions(t.options),void 0!==i&&e.setValue(i)},_valueChanged:function(){!this._handlerInvactive&&this.getHandler()&&this.getHandler()(this.getValue())},_setEnabledImpl:function(e){this.getElement().disabled=!e},getName:function(){return this._name},setName:function(e){var t=this;t._name=e,t._selects.forEach(function(t){t.name=e})},getTitle:function(){return this._titleEl.textContent},setTitle:function(e){this._titleEl.textContent="",null!==e&&void 0!==e?(this._titleEl.style.display="",this._titleEl.appendChild(document.createTextNode(e))):this._titleEl.style.display="none"},getTooltip:function(){return this.getElement().title},setTooltip:function(e){this.getElement().title=e},getValue:function(){return this._selects.map(function(e){return e.getValue()})},setValue:function(e){var t,i,n,a=this,r=!1,s=e;if(null===s||void 0===s)s=[];else if(!Array.isArray(s))throw new TypeError(this.getClazz()+".setValue: value is not an array.");if(e.length>a._selects.length)throw new TypeError(this.getClazz()+".setValue: more values than selects.");for(a._handlerInvactive=!0,t=0;t<e.length;t+=1)i=a._selects[t],n=i.getValue(),i.setValue(e[t]),r=r||i.getValue()!==n;a._handlerInvactive=!1,r&&a._valueChanged()},_setVisibleImpl:function(){this._element.style.display=this._visible?"":"none"}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/MultiLevelSelect",function(){}),Oskari.clazz.define("Oskari.userinterface.component.RadioButtonGroup",function(){var e=this;e._clazz="Oskari.userinterface.component.RadioButtonGroup",e._element=document.createElement("fieldset"),e._titleEl=document.createElement("legend"),e._element.className="oskari-formcomponent oskari-radiobuttongroup",e._titleEl.style.display="none",e._element.appendChild(e._titleEl)},{focus:function(){var e=this._element.querySelector("input");e&&e.focus()},isEnabled:function(){return!this.getElement().disabled},setOptions:function(e){if(!Array.isArray(e))throw new TypeError(this.getClazz()+".setOptions: options is not an array");var t,i,n,a,r,s=this._element.querySelectorAll("label"),o=this,l=function(){o._valueChanged()};for(i=0,a=e.length;a>i;i+=1)i<s.length?r=s[i]:(r=document.createElement("label"),n=document.createElement("input"),n.name=o.getName(),n.type="radio",n.onchange=l,r.appendChild(n),r.appendChild(document.createElement("span")),o._element.appendChild(r)),t=r.querySelector("span"),t.textContent="",t.appendChild(document.createTextNode(e[i].title)),r.querySelector("input").value=e[i].value;for(o._element.disabled=0===a,a=s.length;a>i;i+=1)o._element.removeChild(s[i])},_valueChanged:function(){var e=this.getValue();this.getHandler()&&this.getHandler()(e)},_setEnabledImpl:function(e){this._element.disabled=!e},getName:function(){var e=this._element.querySelector("input"),t="";return e&&(t=e.name),t},setName:function(e){var t,i=this._element.querySelectorAll("input");for(t=0;t<i.length;t+=1)i[t].name=e||""},_setRequiredImpl:function(){var e,t=this._element.querySelectorAll("input");for(e=0;e<t.length;e+=1)t[e].required=this.isRequired()},getTitle:function(){return this._titleEl.textContent},setTitle:function(e){this._titleEl.textContent="",null!==e&&void 0!==e?(this._titleEl.style.display="",this._titleEl.appendChild(document.createTextNode(e))):this._titleEl.style.display="none"},getTooltip:function(){return this._element.title},setTooltip:function(e){this._element.title=e},getValue:function(){var e=this._element.querySelector("input:checked");return e?e.value:void 0},setValue:function(e){var t,i,n=this._element.querySelectorAll("input"),a=!1;for(t=n.length-1;t>=0;t-=1)i=n[t],i.checked=i.value===e,a=a||i.checked;!a&&n&&(n[0].checked=!0),this._valueChanged()},_setVisibleImpl:function(){this.getElement().style.display=this.isVisible()?"":"none"}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/RadioButtonGroup",function(){}),Oskari.clazz.define("Oskari.userinterface.component.CheckboxInput",function(){var e=this;e._clazz="Oskari.userinterface.component.CheckboxInput",e._element=document.createElement("label"),e._input=document.createElement("input"),e._titleEl=document.createElement("span"),e._element.className="oskari-formcomponent oskari-checkboxinput",e._titleEl.style.display="none",e._input.type="checkbox",e._input.onchange=function(){e._valueChanged()},e._input.input=e._input.onchange,e._input.onkeyup=e._input.onchange,e._element.appendChild(e._input),e._element.appendChild(e._titleEl)},{focus:function(){this._input.focus()},isChecked:function(){return this._input.checked},setChecked:function(e){this._input.checked!==e&&(this._input.checked=e,this._valueChanged())},isEnabled:function(){return!this.getElement().disabled},_valueChanged:function(){this.getHandler()&&this.getHandler()(this.getValue())},_setEnabledImpl:function(e){this._input.disabled=!e},getName:function(){return this._input.name},setName:function(e){this._input.name=e||""},getPlaceHolder:function(){return this._input.placeholder},setPlaceHolder:function(e){this._input.placeholder=e},_setRequiredImpl:function(){this._input.required=this.isRequired()},getTitle:function(){return this._titleEl.textContent},setTitle:function(e){this._titleEl.textContent="",null!==e&&void 0!==e?(this._titleEl.style.display="",this._titleEl.appendChild(document.createTextNode(e))):this._titleEl.style.display="none"},getTooltip:function(){return this._element.title},setTooltip:function(){this._element.title=this.getTooltip()},getValue:function(){return this._input.checked?this._input.value:void 0},setValue:function(e){this._input.value=e},_setVisibleImpl:function(){this.getElement().style.display=this.isVisible()?"":"none"}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/CheckboxInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.TextInput",function(e){var t=this,i=document.createElement("div"),n=document.createElement("div");t._clazz="Oskari.userinterface.component.TextInput",t._element=document.createElement("label"),t._titleEl=document.createElement("div"),t._input=document.createElement("input"),t._element.className="oskari-formcomponent oskari-textinput",t._titleEl.style.display="none",null!==e&&void 0!==e&&t.setName(e),t._input.type="text",t._input.setAttribute("autocomplete","off"),t._input.onchange=function(){t._valueChanged()},t._input.input=t._input.onchange,t._input.onkeyup=t._input.onchange,i.onclick=function(){t.setValue("")},i.className="icon-close",n.className="input-controls",n.appendChild(t._input),n.appendChild(i),t._element.appendChild(t._titleEl),t._element.appendChild(n)},{focus:function(){this._input.focus()},isEnabled:function(){return!this.getElement().disabled},_setEnabledImpl:function(e){this._input.disabled=!e},_valueChanged:function(){this.getHandler()&&this.getHandler()(this.getValue())},getName:function(){return this._input.name},setName:function(e){this._input.name=e||""},getPlaceholder:function(){return this._input.placeholder},setPlaceholder:function(e){this._input.placeholder=e},_setRequiredImpl:function(){this._input.required=this.isRequired()},getTitle:function(){return this._titleEl.textContent},setTitle:function(e){this._titleEl.textContent="",null!==e&&void 0!==e?(this._titleEl.style.display="",this._titleEl.appendChild(document.createTextNode(e))):this._titleEl.style.display="none"},getTooltip:function(){return this._element.title},setTooltip:function(e){this._element.title=e},getValue:function(){return this._input.value},setValue:function(e){this._input.value=e},_setVisibleImpl:function(){this.getElement().style.display=this.isVisible()?"":"none"}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/TextInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.EmailInput",function(){this._element.className="oskari-formcomponent oskari-emailinput",this._input.type="email"},{},{extend:["Oskari.userinterface.component.TextInput"]}),define("bundles/framework/bundle/divmanazer/component/EmailInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.NumberInput",function(){this._element.className="oskari-formcomponent oskari-numberinput",this._input.type="number"},{getMax:function(){return this._input.max},setMax:function(e){if(!this._isNumberOrEmpty(e))throw new TypeError(this.getClazz()+".setMax: "+e+" is Not a Number");this._input.max=e},getMin:function(){return this._input.min},setMin:function(e){if(!this._isNumberOrEmpty(e))throw new TypeError(this.getClazz()+".setMin: "+e+" s Not a Number");this._input.min=e},getStep:function(){return this._input.step},setStep:function(e){if(!this._isNumberOrEmpty(e))throw new TypeError(this.getClazz()+".setStep: "+e+" is Not a Number");this._input.step=e},setValue:function(e){if(!this._isNumberOrEmpty(e))throw new TypeError(this.getClazz()+".setValue: "+e+" is Not a Number");this._input.value=e},_isNumberOrEmpty:function(e){return null===e||void 0===e||""===e||!isNaN(e)}},{extend:["Oskari.userinterface.component.TextInput"]}),define("bundles/framework/bundle/divmanazer/component/NumberInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.PasswordInput",function(){this._element.className="oskari-formcomponent oskari-passwordinput",this._input.type="password"},{},{extend:["Oskari.userinterface.component.TextInput"]}),define("bundles/framework/bundle/divmanazer/component/PasswordInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.SearchInput",function(){this._element.className="oskari-formcomponent oskari-searchinput",this._input.type="search"},{},{extend:["Oskari.userinterface.component.TextInput"]}),define("bundles/framework/bundle/divmanazer/component/SearchInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.UrlInput",function(){this._element.className="oskari-formcomponent oskari-urlinput",this._input.type="url"},{},{extend:["Oskari.userinterface.component.TextInput"]}),define("bundles/framework/bundle/divmanazer/component/UrlInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.TextAreaInput",function(e){var t=this,i=document.createElement("div"),n=document.createElement("div");t._clazz="Oskari.userinterface.component.TextAreaInput",t._element=document.createElement("label"),t._titleEl=document.createElement("div"),t._input=document.createElement("textarea"),t._element.className="oskari-formcomponent oskari-textareainput",t._titleEl.style.display="none",null!==e&&void 0!==e&&t.setName(e),t._input.setAttribute("autocomplete","off"),t._input.onchange=function(){t._valueChanged()
},t._input.input=t._input.onchange,t._input.onkeyup=t._input.onchange,i.onclick=function(){t.setValue("")},i.className="icon-close",n.className="input-controls",n.appendChild(t._input),n.appendChild(i),t._element.appendChild(t._titleEl),t._element.appendChild(n)},{focus:function(){this._input.focus()},isEnabled:function(){return!this.getElement().disabled},_setEnabledImpl:function(e){this._input.disabled=!e},_valueChanged:function(){this.getHandler()&&this.getHandler()(this.getValue())},getName:function(){return this._input.name},setName:function(e){this._input.name=e||""},getPlaceholder:function(){return this._input.placeholder},setPlaceholder:function(e){this._input.placeholder=e},_setRequiredImpl:function(){this._input.required=this.isRequired()},getTitle:function(){return this._titleEl.textContent},setTitle:function(e){this._titleEl.textContent="",null!==e&&void 0!==e?(this._titleEl.style.display="",this._titleEl.appendChild(document.createTextNode(e))):this._titleEl.style.display="none"},getTooltip:function(){return this._element.title},setTooltip:function(e){this._element.title=e},getValue:function(){return this._input.value},setValue:function(e){this._input.value=e},_setVisibleImpl:function(){this.getElement().style.display=this.isVisible()?"":"none"}},{extend:["Oskari.userinterface.component.FormComponent"]}),define("bundles/framework/bundle/divmanazer/component/TextAreaInput",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.AddButton",function(){this.setTitle(Oskari.getLocalization("DivManazer").buttons.add),this.setPrimary(!0)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/AddButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.CancelButton",function(){this.setTitle(Oskari.getLocalization("DivManazer").buttons.cancel)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/CancelButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.CloseButton",function(){this.setTitle(Oskari.getLocalization("DivManazer").buttons.close)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/CloseButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.DeleteButton",function(){this.setTitle(Oskari.getLocalization("DivManazer").buttons["delete"])},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/DeleteButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.EditButton",function(){this.setTitle(Oskari.getLocalization("DivManazer").buttons.edit),this.setPrimary(!0)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/EditButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.OkButton",function(){this.setTitle(Oskari.getLocalization("DivManazer").buttons.ok),this.setPrimary(!0)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/OkButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.SaveButton",function(){this._element.type="submit",this.setTitle(Oskari.getLocalization("DivManazer").buttons.save),this.setPrimary(!0)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/SaveButton",function(){}),Oskari.clazz.define("Oskari.userinterface.component.buttons.SearchButton",function(){this._element.type="submit",this.setTitle(Oskari.getLocalization("DivManazer").buttons.search),this.setPrimary(!0)},{},{extend:["Oskari.userinterface.component.Button"]}),define("bundles/framework/bundle/divmanazer/component/buttons/SearchButton",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultTile",function(e,t){this.locale=t,this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.userinterface.extension.DefaultTile"},setEl:function(e){this.container=$(e)},startPlugin:function(){},stopPlugin:function(){this.container&&this.container.empty&&this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state},setEnabled:function(e){e?this.container.removeClass("disabled"):this.container.addClass("disabled")},isEnabled:function(){return!this.container.hasClass("disabled")}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/divmanazer/extension/DefaultTile",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultFlyout",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultFlyout"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale?this.locale:this.instance?this.instance.getLocalization().flyout:void 0},getSandbox:function(){return this.instance.getSandbox()},getExtension:function(){return this.instance},slicer:Array.prototype.slice,issue:function(){var e=arguments[0],t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getRequestBuilder(e),n=i.apply(i,t);return this.getSandbox().request(this.getExtension(),n)},notify:function(){var e=arguments[0],t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getEventBuilder(e),n=i.apply(i,t);return this.getSandbox().notifyAll(n)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/divmanazer/extension/DefaultFlyout",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultExtension",function(e,t,i,n,a){this.sandbox=null,this.plugins={},this._localization=a,this.defaultConf={name:e,tileClazz:i||"Oskari.userinterface.extension.DefaultTile",flyoutClazz:t||"Oskari.userinterface.extension.DefaultFlyout",viewClazz:n}},{getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e,t=this,i=t.getConfiguration(),n=i&&i.sandbox?i.sandbox:"sandbox",a=Oskari.getSandbox(n);t.sandbox=a,a.register(this),i&&i.stateful===!0&&a.registerAsStateful(this.mediator.bundleId,this),e=a.getRequestBuilder("userinterface.AddExtensionRequest")(this),a.request(this,e),this.afterStart(a)},afterStart:function(){},stop:function(){var e=this.sandbox,t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),e.unregisterStateful(this.mediator.bundleId),e.unregister(this),this.sandbox=null,this.started=!1},startExtension:function(){var e,t,i,n,a=this,r=a.sandbox;a.startPlugin();for(e in a.requestHandlers)a.requestHandlers.hasOwnProperty(e)&&r.addRequestHandler(e,this);for(e in a.eventHandlers)a.eventHandlers.hasOwnProperty(e)&&r.registerForEventByName(a,e);t=a.getLocalization("flyout"),t&&a.conf.flyoutClazz&&(a.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create(a.conf.flyoutClazz,a,t)),i=a.getLocalization("tile"),i&&a.conf.tileClazz&&(a.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create(a.conf.tileClazz,a,i)),n=a.getLocalization("view"),n&&a.conf.viewClazz&&(a.plugins["Oskari.userinterface.View"]=Oskari.clazz.create(a.conf.viewClazz,a,n))},startPlugin:function(){},stopPlugin:function(){},stopExtension:function(){var e,t,i=this,n=i.sandbox;for(e in i.eventHandlers)i.eventHandlers.hasOwnProperty(e)&&n.unregisterFromEventByName(i,e);for(e in i.requestHandlers)i.requestHandlers.hasOwnProperty(e)&&n.removeRequestHandler(e,this);for(t in i.plugins)i.plugins.hasOwnProperty(t)&&t&&(i.plugins[t]=null);i.stopPlugin()},getPlugins:function(){return this.plugins},init:function(){return null},getName:function(){return this.getConfiguration().name},getConfiguration:function(){return this.conf&&void 0!==this.__confMerged&&this.__confMerged===this.conf.name||(this.conf=jQuery.extend(!0,{},this.defaultConf,this.conf),this.__confMerged=this.conf.name),this.conf},eventHandlers:{},requestHandlers:{},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];if(i)return i.apply(this,[e])},handleRequest:function(e,t){return this.onRequest(t)},onRequest:function(e){var t=this,i=t.requestHandlers[e.getName()];if(i)return i.apply(this,[e])},getLang:function(){return Oskari.getLang()},getTile:function(){return this.plugins["Oskari.userinterface.Tile"]},setTile:function(e){this.plugins["Oskari.userinterface.Tile"]=e},setDefaultTile:function(e){var t=Oskari.cls().extend("Oskari.userinterface.extension.DefaultTile"),i=t.create(this,{title:e||""});return this.plugins["Oskari.userinterface.Tile"]=i,i},getFlyout:function(){return this.plugins["Oskari.userinterface.Flyout"]},setFlyout:function(e){this.plugins["Oskari.userinterface.Flyout"]=e},slicer:Array.prototype.slice,request:function(e){return this.getSandbox().request(this,e)},issue:function(e){var t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getRequestBuilder(e),n=i.apply(i,t);return this.getSandbox().request(this.getExtension(),n)},notify:function(e){var t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getEventBuilder(e),n=i.apply(i,t);return this.getSandbox().notifyAll(n)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/divmanazer/extension/DefaultExtension",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultView",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultView"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.View"]}),define("bundles/framework/bundle/divmanazer/extension/DefaultView",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultLayout",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultLayout"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.Layout"]}),define("bundles/framework/bundle/divmanazer/extension/DefaultLayout",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.EnhancedTile",function(){},{getName:function(){return"Oskari.userinterface.extension.EnhancedTile"}},{protocol:["Oskari.userinterface.Tile"],extend:["Oskari.userinterface.extension.DefaultTile"]}),define("src/framework/divmanazer/extension/EnhancedTile",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.EnhancedFlyout",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultFlyout"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale?this.locale:this.instance?this.instance.getLocalization().flyout:void 0},getSandbox:function(){return this.instance.getSandbox()},getExtension:function(){return this.instance},slicer:Array.prototype.slice,issue:function(){var e=arguments[0],t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getRequestBuilder(e),n=i.apply(i,t);return this.getSandbox().request(this.getExtension(),n)},notify:function(){var e=arguments[0],t=this.slicer.apply(arguments,[1]),i=this.getSandbox().getEventBuilder(e),n=i.apply(i,t);return this.getSandbox().notifyAll(n)}},{protocol:["Oskari.userinterface.Flyout"]}),define("src/framework/divmanazer/extension/EnhancedFlyout",function(){}),Oskari.clazz.define("Oskari.userinterface.extension.EnhancedView",function(){},{getName:function(){return"Oskari.userinterface.extension.EnhancedView"}},{protocol:["Oskari.userinterface.View"],extend:["Oskari.userinterface.extension.DefaultView"]}),define("src/framework/divmanazer/extension/EnhancedView",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/divman.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/accordion.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/tab.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/modal.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/badge.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/alert.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/formcomponent.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/forminput.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/grid.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/popup.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/button.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/overlay.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/visualizationform.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/divmanazer/css/popover.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,function(e,t,i){function n(e){var t={},n=/^jQuery\d+$/;return i.each(e.attributes,function(e,i){i.specified&&!n.test(i.name)&&(t[i.name]=i.value)}),t}function a(e,t){var n=this,a=i(n);if(n.value==a.attr("placeholder")&&a.hasClass("placeholder"))if(a.data("placeholder-password")){if(a=a.hide().next().show().attr("id",a.removeAttr("id").data("placeholder-id")),e===!0)return a[0].value=t;a.focus()}else n.value="",a.removeClass("placeholder"),n==s()&&n.select()}function r(){var e,t=this,r=i(t),s=this.id;if(""==t.value){if("password"==t.type){if(!r.data("placeholder-textinput")){try{e=r.clone().attr({type:"text"})}catch(o){e=i("<input>").attr(i.extend(n(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":r,"placeholder-id":s}).bind("focus.placeholder",a),r.data({"placeholder-textinput":e,"placeholder-id":s}).before(e)}r=r.removeAttr("id").hide().prev().attr("id",s).show()}r.addClass("placeholder"),r[0].value=r.attr("placeholder")}else r.removeClass("placeholder")}function s(){try{return t.activeElement}catch(e){}}var o,l,u="placeholder"in t.createElement("input"),c="placeholder"in t.createElement("textarea"),d=i.fn,h=i.valHooks,p=i.propHooks;u&&c?(l=d.placeholder=function(){return this},l.input=l.textarea=!0):(l=d.placeholder=function(){var e=this;return e.filter((u?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":a,"blur.placeholder":r}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},l.input=u,l.textarea=c,o={get:function(e){var t=i(e),n=t.data("placeholder-password");return n?n[0].value:t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,t){var n=i(e),o=n.data("placeholder-password");return o?o[0].value=t:n.data("placeholder-enabled")?(""==t?(e.value=t,e!=s()&&r.call(e)):n.hasClass("placeholder")?a.call(e,!0,t)||(e.value=t):e.value=t,n):e.value=t}},u||(h.input=o,p.value=o),c||(h.textarea=o,p.value=o),i(function(){i(t).delegate("form","submit.placeholder",function(){var e=i(".placeholder",this).each(a);setTimeout(function(){e.each(r)},10)})}),i(e).bind("beforeunload.placeholder",function(){i(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery),define("libraries/jquery/plugins/jquery-placeholder/jquery.placeholder",function(){}),define("src/framework/divmanazer/module",["oskari","src/framework/divmanazer/extension/EnhancedExtension","jquery","src/framework/oskariui/module","./instance","bundles/framework/bundle/divmanazer/request/AddExtensionRequest","bundles/framework/bundle/divmanazer/request/AddExtensionRequestHandler","bundles/framework/bundle/divmanazer/request/RemoveExtensionRequest","bundles/framework/bundle/divmanazer/request/RemoveExtensionRequestHandler","bundles/framework/bundle/divmanazer/request/UpdateExtensionRequest","bundles/framework/bundle/divmanazer/request/UpdateExtensionRequestHandler","bundles/framework/bundle/divmanazer/request/ModalDialogRequest","bundles/framework/bundle/divmanazer/request/ModalDialogRequestHandler","bundles/framework/bundle/divmanazer/event/ExtensionUpdatedEvent","bundles/framework/bundle/divmanazer/component/Component","bundles/framework/bundle/divmanazer/component/Accordion","bundles/framework/bundle/divmanazer/component/AccordionPanel","bundles/framework/bundle/divmanazer/component/TabContainer","bundles/framework/bundle/divmanazer/component/TabDropdownContainer","bundles/framework/bundle/divmanazer/component/TabPanel","bundles/framework/bundle/divmanazer/component/Badge","bundles/framework/bundle/divmanazer/component/Alert","./component/Popup","bundles/framework/bundle/divmanazer/component/Overlay","bundles/framework/bundle/divmanazer/component/Button","bundles/framework/bundle/divmanazer/component/FilterDialog","bundles/framework/bundle/divmanazer/component/Form","bundles/framework/bundle/divmanazer/component/SearchForm","bundles/framework/bundle/divmanazer/component/UIHelper","bundles/framework/bundle/divmanazer/component/FormInput","bundles/framework/bundle/divmanazer/component/Popover","bundles/framework/bundle/divmanazer/component/Grid","bundles/framework/bundle/divmanazer/component/GridModel","bundles/framework/bundle/divmanazer/component/ProgressSpinner","bundles/framework/bundle/divmanazer/component/Container","bundles/framework/bundle/divmanazer/component/FormComponent","bundles/framework/bundle/divmanazer/component/Select","bundles/framework/bundle/divmanazer/component/LanguageSelect","bundles/framework/bundle/divmanazer/component/MultiLevelSelect","bundles/framework/bundle/divmanazer/component/RadioButtonGroup","bundles/framework/bundle/divmanazer/component/CheckboxInput","bundles/framework/bundle/divmanazer/component/TextInput","bundles/framework/bundle/divmanazer/component/EmailInput","bundles/framework/bundle/divmanazer/component/NumberInput","bundles/framework/bundle/divmanazer/component/PasswordInput","bundles/framework/bundle/divmanazer/component/SearchInput","bundles/framework/bundle/divmanazer/component/UrlInput","bundles/framework/bundle/divmanazer/component/TextAreaInput","bundles/framework/bundle/divmanazer/component/VisualizationForm","bundles/framework/bundle/divmanazer/component/buttons/AddButton","bundles/framework/bundle/divmanazer/component/buttons/CancelButton","bundles/framework/bundle/divmanazer/component/buttons/CloseButton","bundles/framework/bundle/divmanazer/component/buttons/DeleteButton","bundles/framework/bundle/divmanazer/component/buttons/EditButton","bundles/framework/bundle/divmanazer/component/buttons/OkButton","bundles/framework/bundle/divmanazer/component/buttons/SaveButton","bundles/framework/bundle/divmanazer/component/buttons/SearchButton","bundles/framework/bundle/divmanazer/component/visualization-form/AreaForm","bundles/framework/bundle/divmanazer/component/visualization-form/LineForm","bundles/framework/bundle/divmanazer/component/visualization-form/DotForm","bundles/framework/bundle/divmanazer/extension/DefaultTile","bundles/framework/bundle/divmanazer/extension/DefaultFlyout","bundles/framework/bundle/divmanazer/extension/DefaultExtension","bundles/framework/bundle/divmanazer/extension/DefaultView","bundles/framework/bundle/divmanazer/extension/DefaultLayout","src/framework/divmanazer/extension/EnhancedTile","src/framework/divmanazer/extension/EnhancedFlyout","src/framework/divmanazer/extension/EnhancedView","css!resources/framework/bundle/divmanazer/css/divman.css","css!resources/framework/bundle/divmanazer/css/accordion.css","css!resources/framework/bundle/divmanazer/css/tab.css","css!resources/framework/bundle/divmanazer/css/modal.css","css!resources/framework/bundle/divmanazer/css/badge.css","css!resources/framework/bundle/divmanazer/css/alert.css","css!resources/framework/bundle/divmanazer/css/formcomponent.css","css!resources/framework/bundle/divmanazer/css/forminput.css","css!resources/framework/bundle/divmanazer/css/grid.css","css!resources/framework/bundle/divmanazer/css/popup.css","css!resources/framework/bundle/divmanazer/css/button.css","css!resources/framework/bundle/divmanazer/css/overlay.css","css!resources/framework/bundle/divmanazer/css/visualizationform.css","css!resources/framework/bundle/divmanazer/css/popover.css","libraries/jquery/plugins/jquery-placeholder/jquery.placeholder","bundles/framework/bundle/mapmodule-plugin/locale/en","bundles/framework/bundle/mapmodule-plugin/locale/fi","bundles/framework/bundle/mapmodule-plugin/locale/sv"],function(e,t){return e.ui={},this._baseClassFor={extension:"Oskari.userinterface.extension.EnhancedExtension",tile:"Oskari.userinterface.extension.EnhancedTile",flyout:"Oskari.userinterface.extension.EnhancedFlyout",view:"Oskari.userinterface.extension.EnhancedView"},e.ui.Tile=e.cls("Oskari.Tile").extend(this._baseClassFor.tile),e.ui.Flyout=e.cls("Oskari.Flyout").extend(this._baseClassFor.flyout),e.ui.Extension=t,e.ui.View=e.cls("Oskari.View").extend(this._baseClassFor.view),e.bundleCls("divmanazer").category({create:function(){return e.clazz.create("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance")},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance",function(){this.sandbox=null,this.started=!1,this.buttons={},this.selectedButton=null,this.defaultButton=null,this.container=null,this.menutoolbarcontainer=null,this.containers={},this.toolbars={},this.groupsToToolbars={}},{__name:"Toolbar",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var e=this;if(!e.started){e.started=!0;var t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);n.register(e),e.setSandbox(n);var a=(t?t.defaultToolbarContainer:null)||"#toolbar";this.container=jQuery(a),this.containers["default"]=this.container,this.toolbars["default"]=this.container;var r,s=(t?t.defaultMenuToolbarContainer:null)||"#menutoolbar";this.menutoolbarcontainer=jQuery(s);for(r in e.eventHandlers)e.eventHandlers.hasOwnProperty(r)&&r&&n.registerForEventByName(e,r);n.addRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.ToolbarRequest",this.requestHandlers.toolbarRequestHandler),n.addRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler),n.registerAsStateful(this.mediator.bundleId,this),this._addDefaultButtons&&this._addDefaultButtons();var o=n.getEventBuilder("Toolbar.ToolbarLoadedEvent"),l=o();n.notifyAll(l)}},templates:{group:'<div class="toolrow"></div>',tool:'<div class="tool"></div>',menutoolbar:'<div class="oskari-closed oskariui-menutoolbar"><div class="oskariui-menutoolbar-modetitle"><div class="oskariui-menutoolbar-title"><p></p></div></div><div class="oskariui-menutoolbar-container"><div class="oskariui-menutoolbarbuttongroup"></div></div><div class="oskariui-menutoolbar-closebox"><div class="icon-close-white"></div></div></div>',addedToolbar:'<div class="oskariui-toolbar-title"><p></p></div><div class="oskariui-toolbar-container"><div class="oskariui-toolbarbuttongroup"></div></div>'},init:function(){var e=this;this.templateGroup=jQuery(this.templates.group),this.templateTool=jQuery(this.templates.tool),this.templateMenutoolbar=jQuery(this.templates.menutoolbar),this.requestHandlers={toolButtonRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",e),toolbarRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolbarRequestHandler",e),showMapMeasurementRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",e)}},createMenuToolbarContainer:function(e,t){var i=t||{},n=this.templateMenutoolbar.clone();this.menutoolbarcontainer.append(n),this.toolbars[e]=n;var a=n.find(".oskariui-menutoolbarbuttongroup");return this.containers[e]=a,i.title&&n.find(".oskariui-menutoolbar-title p").append(i.title),i.show&&n.removeClass("oskari-closed"),i.closeBoxCallback&&n.find(".oskariui-menutoolbar-closebox div").click(i.closeBoxCallback),a},addToolbarContainer:function(e,t){var i=t.toolbarContainer;i.append(jQuery(this.templates.addedToolbar)),this.toolbars[e]=i;var n=i.find(".oskariui-toolbarbuttongroup");return this.containers[e]=n,t.title&&i.find(".oskariui-toolbar-title p").append(t.title),n},changeMenuToolbarTitle:function(e){e&&this.menutoolbarcontainer.find(".oskariui-menutoolbar-title p").html(e)},getToolbarContainer:function(e,t){var i=e||"default",n=this.containers[i];return void 0===n&&this.menutoolbarcontainer&&!t.toolbarContainer?n=this.createMenuToolbarContainer(i,t):(void 0===n||0===n.parents("body").length)&&t&&t.toolbarContainer&&(n=this.addToolbarContainer(i,t)),n},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},measureTools:{basictools:{measureline:!0,measurearea:!0}},eventHandlers:{"Toolbar.ToolSelectedEvent":function(e){var t=this,i=this.getSandbox();if(t.measureTools[e.getGroupId()]&&t.measureTools[e.getGroupId()][e.getToolId()]){var n=t.getLocalization("measure").guidance[e.getToolId()];i.request(t,i.getRequestBuilder("ShowMapMeasurementRequest")(n||"",!1,null,null))}}},stop:function(){var e,t=this,i=t.sandbox();for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&e&&i.unregisterFromEventByName(t,e);i.removeRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler),i.removeRequestHandler("Toolbar.ToolbarRequest",this.requestHandlers.toolbarRequestHandler),i.removeRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),i.removeRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),i.removeRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler),i.removeRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),this.sandbox.unregisterStateful(this.mediator.bundleId),t.sandbox.unregister(t),t.started=!1},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},setState:function(e){if(e)if(e.selected){this.selectedButton=e.selected;var t=e.selected.id,i=e.selected.group,n=i.split("-");n.length<2&&(i="default-"+i);var a=this.getToolbarContainer();this._removeToolSelections();var r=a.find("div.toolrow[tbgroup="+i+"]");if(r.length>0){var s=r.find("div.tool[tool="+t+"]");s.length>0&&(s.addClass("selected"),this.buttons[i][t].callback())}}else this.selectedButton=null},getState:function(){var e={};return this.selectedButton&&(e.selected=this.selectedButton),e},_removeToolbar:function(e){var t=this.toolbars[e];t&&t.remove(),this.toolbars[e]=void 0,delete this.toolbars[e]},_showToolbar:function(e){this.toolbars[e].show()},_hideToolbar:function(e){this.toolbars[e].hide()},_addToolbar:function(e,t){this.getToolbarContainer(e,t)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/toolbar/instance",function(){}),Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","button-methods",{addToolButton:function(e,t,i){var n=this;if(!(e&&t&&i&&i.callback))return void n.sandbox.printDebug("All parameters must be defined in AddToolButtonRequest");var a=n.getToolbarContainer(i?i.toolbarid:null,i),r=null,s=(i.toolbarid||"default")+"-"+t;if(n.buttons[s]?r=a.find("div.toolrow[tbgroup="+s+"]"):(n.buttons[s]={},r=n.templateGroup.clone(),r.attr("tbgroup",s),a.append(r),n.groupsToToolbars[s]=i?i.toolbarid:null),!n.buttons[s][e]){n.buttons[s][e]=i;var o=n.templateTool.clone();o.attr("tool",e),o.attr("title",i.tooltip),o.attr("id","oskari_toolbar_"+t+"_"+e),o.addClass(n.conf.classes&&n.conf.classes[t]&&n.conf.classes[t][e]?n.conf.classes[t][e].iconCls:i.iconCls),n.selectedButton?n.selectedButton.id===e&&n.selectedButton.group===s&&(o.addClass("selected"),i.callback()):i.selected&&(o.addClass("selected"),n.selectedButton={id:e,group:s}),i.selected&&(n.defaultButton={id:e,group:s}),o.bind("click",function(){n._clickButton(e,s)}),i.prepend?r.prepend(o):r.append(o),i.disabled===!0&&o.addClass("disabled")}},_clickButton:function(e,t){var i;if(!e){if(!this.defaultButton)return i=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(e,t),this.sandbox.notifyAll(i),void this.container.find(".tool.selected").removeClass("selected");e=this.defaultButton.id,t=this.defaultButton.group}var n,a,r,s=this.buttons[t][e];0!=s.enabled&&(1==s.sticky&&(i=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(e,t),this.sandbox.notifyAll(i),this._removeToolSelections(t),n=this.getToolbarContainer(this.groupsToToolbars[t]),a=n.find("div.toolrow[tbgroup="+t+"]"),r=a.find("div.tool[tool="+e+"]"),r.addClass("selected"),this.selectedButton={id:e,group:t}),s.toggleSelection&&(n=this.getToolbarContainer(this.groupsToToolbars[t]),a=n.find("div.toolrow[tbgroup="+t+"]"),r=a.find("div.tool[tool="+e+"]"),r.hasClass("selected")?r.removeClass("selected"):r.addClass("selected")),s.callback())
},_removeToolSelections:function(e){var t=this.getToolbarContainer(this.groupsToToolbars[e]),i=t.find("div.tool");i.removeClass("selected")},removeToolButton:function(e,t,i){if(t){var n=(i||"default")+"-"+t;if(this.buttons[n]){var a=this.getToolbarContainer(this.groupsToToolbars[n]),r=a.find("div.toolrow[tbgroup="+n+"]");if(e){var s=r.find("div.tool[tool="+e+"]");s.remove(),this.buttons[n][e]=null,delete this.buttons[n][e];var o,l=0;for(o in this.buttons[n])this.buttons[n].hasOwnProperty(o)&&l++;0===l&&(r.remove(),this.buttons[n]=null,delete this.buttons[n])}else r.remove(),this.buttons[n]=null,delete this.buttons[n]}}},changeToolButtonState:function(e,t,i,n){if(t){var a=(n||"default")+"-"+t;if(this.buttons[a]){var r,s,o,l=this.getToolbarContainer(this.groupsToToolbars[a]),u=l.find("div.toolrow[tbgroup="+a+"]");if(e)r=u.find("div.tool[tool="+e+"]"),this.buttons[a][e].enabled=i,i?r.removeClass("disabled"):r.addClass("disabled");else{s=u.find("div.tool"),i?s.removeClass("disabled"):s.addClass("disabled");for(o in this.buttons[a])this.buttons[a].hasOwnProperty(o)&&(this.buttons[a][o].enabled=i)}}}}}),define("bundles/framework/bundle/toolbar/button-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","default-buttons",{_isButtonConfigured:function(e,t){return this.conf&&(this.conf[t]===!1||this.conf[t]&&this.conf[t][e]===!1)?!1:!0},_addDefaultButtons:function(){var e,t,i,n,a,r,s,o,l,u,c,d=this,h=this.getLocalization("buttons"),p=this.getSandbox().getRequestBuilder("ToolSelectionRequest"),f="MapModulePlugin.GetFeatureInfoActivationRequest",m=this.getSandbox().getRequestBuilder(f),g=d.conf?d.getSandbox().getLocalizedProperty(d.conf.mapUrlPrefix):null,v=[{name:"history",buttons:{reset:{iconCls:"tool-reset",tooltip:h.history.reset,sticky:!1,callback:function(){t=d.getSandbox().getRequestBuilder("StateHandler.SetStateRequest"),t&&d.getSandbox().request(d,t())}},history_back:{iconCls:"tool-history-back",tooltip:h.history.back,sticky:!1,callback:function(){d.getSandbox().request(d,p("map_control_tool_prev"))}},history_forward:{iconCls:"tool-history-forward",tooltip:h.history.next,sticky:!1,callback:function(){d.getSandbox().request(d,p("map_control_tool_next"))}}}},{name:"basictools",buttons:{zoombox:{iconCls:"tool-zoombox",tooltip:h.zoom,sticky:!0,callback:function(){i="map_control_zoom_tool",d.getSandbox().request(d,m(!1)),d.getSandbox().request(d,p(i))}},select:{iconCls:"tool-pan",tooltip:h.pan,selected:!0,sticky:!0,callback:function(){i="map_control_navigate_tool",d.getSandbox().request(d,m(!0)),d.getSandbox().request(d,p(i))}},measureline:{iconCls:"tool-measure-line",tooltip:h.measure.line,sticky:!0,callback:function(){i="map_control_measure_tool",d.getSandbox().request(d,m(!1)),d.getSandbox().request(d,p(i))}},measurearea:{iconCls:"tool-measure-area",tooltip:h.measure.area,sticky:!0,callback:function(){i="map_control_measure_area_tool",d.getSandbox().request(d,m(!1)),d.getSandbox().request(d,p(i))}}}},{name:"viewtools",buttons:{link:{iconCls:"tool-link",tooltip:h.link.tooltip,sticky:!1,callback:function(){n=d.getSandbox().generateMapLinkParameters({}),-1===n.indexOf("&markers=")&&(n+="&showMarker=true"),a="Oskari.userinterface.component.Popup",r="Oskari.userinterface.component.Button",s=Oskari.clazz.create(a),s.addClass("no_resize"),o=Oskari.clazz.create(r),o.setTitle(h.link.ok),o.addClass("primary"),o.setHandler(function(){i="EnableMapKeyboardMovementRequest",s.close(),d.getSandbox().postRequestByName(i)}),l='<div class="linkcontent">'+g+n+"</div>",i="DisableMapKeyboardMovementRequest",d.getSandbox().postRequestByName(i),s.show(h.link.title,l,[o])}},print:{iconCls:"tool-print",tooltip:h.print.tooltip,sticky:!1,callback:function(){u="location=1,status=1,scrollbars=1,width=850,height=1200",c=window.location.pathname+"?"+d.getSandbox().generateMapLinkParameters()+"&p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=0&p_p_state=exclusive&showMarker=false&forceCache=true&mapmode=print&viewId=2",window.open(c,"Print",u)}}}}];for(e in v){var y,b=v[e];for(y in b.buttons)("link"!==y||g)&&this._isButtonConfigured(y,b.name)&&this.addToolButton(y,b.name,b.buttons[y])}}}),define("bundles/framework/bundle/toolbar/default-buttons",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.AddToolButtonRequest",function(e,t,i){this._id=e,this._group=t,this._config=i},{__name:"Toolbar.AddToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getConfig:function(){return this._config}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/toolbar/request/AddToolButtonRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.RemoveToolButtonRequest",function(e,t,i){this._id=e,this._group=t,this._toolbarId=i},{__name:"Toolbar.RemoveToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getToolbarId:function(){return this._toolbarId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/toolbar/request/RemoveToolButtonRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonStateRequest",function(e,t,i){this._id=e,this._group=t,this._state=1==i},{__name:"Toolbar.ToolButtonStateRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/toolbar/request/ToolButtonStateRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.SelectToolButtonRequest",function(e,t){this._id=e,this._group=t},{__name:"Toolbar.SelectToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/toolbar/request/SelectToolButtonRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){var i=e.getSandbox(),n=t.getName();"Toolbar.AddToolButtonRequest"==n?this._handleAdd(i,t):"Toolbar.RemoveToolButtonRequest"==n?this._handleRemove(i,t):"Toolbar.ToolButtonStateRequest"==n?this._handleState(i,t):"Toolbar.SelectToolButtonRequest"==n&&this._handleClick(i,t)},_handleAdd:function(e,t){this._toolbar.addToolButton(t.getId(),t.getGroup(),t.getConfig())},_handleRemove:function(e,t){this._toolbar.removeToolButton(t.getId(),t.getGroup(),t.getToolbarId())},_handleState:function(e,t){this._toolbar.changeToolButtonState(t.getId(),t.getGroup(),t.getState())},_handleClick:function(e,t){this._toolbar._clickButton(t.getId(),t.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/toolbar/request/ToolButtonRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",function(e){var t=this;t._toolbar=e;var i=t._toolbar.getLocalization("measure"),n=i.title;t._title=n,t._dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),t._dialog.addClass("oskari-measurement");var a=[],r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(i.close),a.push(r),t._buttons=a,t._dialogShown=!1,t._content=null},{handleRequest:function(e,t){e.getSandbox();this._showMeasurementResults(t.getValue())},getValue:function(){return this._value},_showMeasurementResults:function(e){var t=this,i=t._dialog;if(t._toolbar.conf.hasContentContainer)t._showResultsInPlugin(e);else{if(!t._dialogShown){i.show(t._title,"",t._buttons);var n=t._buttons[0];n.setHandler(function(){t._dialogShown=!1;var e=t._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();t._toolbar.getSandbox().request(t._toolbar,e),t._dialog.close(!0)}),i.moveTo("#toolbar div.toolrow[tbgroup=default-basictools]","top"),t._content=jQuery("<div></div>"),i.setContent(t._content),t._dialogShown=!0}t._content.html(e)}},_showResultsInPlugin:function(e){var t,i=this;if(!i.toolContentDivData){var n=i._buttons[0];n.setHandler(function(){var e=i._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();i._toolbar.getSandbox().request(i._toolbar,e),i._hideResultsInPlugin(!0)}),i.toolContentDivData={className:"measureline",title:i._title,content:jQuery("<div></div>"),buttons:i._buttons},t=i._toolbar.getSandbox().getRequestBuilder("Toolbar.ToolContainerRequest")("set",i.toolContentDivData),i._toolbar.getSandbox().request(i._toolbar,t)}i.toolContentDivData.content.html(e)},_hideResultsInPlugin:function(){var e=this,t=e._toolbar.getSandbox().getRequestBuilder("Toolbar.ToolContainerRequest")("reset",e.toolContentDivData);e._toolbar.getSandbox().request(e._toolbar,t),e.toolContentDivData=null}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/toolbar/request/ShowMapMeasurementRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.event.ToolSelectedEvent",function(e,t){this._toolId=e,this._groupId=t},{__name:"Toolbar.ToolSelectedEvent",getName:function(){return this.__name},getToolId:function(){return this._toolId},getGroupId:function(){return this._groupId}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/toolbar/event/ToolSelectedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.event.ToolLoadedEvent",function(){},{__name:"Toolbar.ToolbarLoadedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/toolbar/event/ToolbarLoadedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolbarRequest",function(e,t,i){this._id=e,this._op=t,this._data=i},{__name:"Toolbar.ToolbarRequest",getName:function(){return this.__name},getId:function(){return this._id},getOp:function(){return this._op},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/toolbar/request/ToolbarRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolbarRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){var i=(e.getSandbox(),t.getOp());"add"===i?this._toolbar._addToolbar(t.getId(),t.getData()):"show"===i?this._toolbar._showToolbar(t.getId()):"hide"===i?this._toolbar._hideToolbar(t.getId()):"remove"===i?this._toolbar._removeToolbar(t.getId()):"changeName"===i&&this._toolbar.changeMenuToolbarTitle(t.getData())},_handleAdd:function(e,t){this._toolbar.addToolButton(t.getId(),t.getGroup(),t.getConfig())},_handleRemove:function(e,t){this._toolbar.removeToolButton(t.getId(),t.getGroup())},_handleState:function(e,t){this._toolbar.changeToolButtonState(t.getId(),t.getGroup(),t.getState())},_handleClick:function(e,t){this._toolbar._clickButton(t.getId(),t.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/toolbar/request/ToolbarRequestHandler",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/toolbar/css/toolbar.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"hy",key:"Toolbar",value:{buttons:{link:{tooltip:"Հղում",ok:"OK",title:"Քարտեզի դիտման հղում"},print:{tooltip:"Տպել"},history:{reset:"Վերադառնալ բազային պատկերին",back:"Հետ",next:"Առաջ"},pan:"Համայնապատկերային քարտեզի դիտում",zoom:"Մեծացնել",measure:{line:"Չափման հեռավորություն",area:"Չափման տարածք"}},measure:{title:"Չափումներ",close:"Դադարեցնել",guidance:{measureline:"Չափել քարտեզի նշված գիծը:Կրկնակի սեղմել չափումը դադարեցնելու համար",measurearea:"Չափել քարտեզի նշված տարածքը:Կրկնակի սեղմել չափումը դադարեցնելու համար"}}}}),define("bundles/framework/bundle/toolbar/locale/hy",function(){}),Oskari.registerLocalization({lang:"cs",key:"Toolbar",value:{buttons:{link:{tooltip:"Odkaz",ok:"Ok",title:"Odkaz na zobrazení mapy"},print:{tooltip:"Tisk"},history:{reset:"Návrat do defaultního zobrazení",back:"Zpět",next:"Další"},pan:"Posunout zobrazení mapy",zoom:"Přiblížit",measure:{line:"Měřit vzdálenost",area:"Měřit plochu"}},measure:{title:"Měření",close:"Storno",guidance:{measureline:"Změřit délku na mapě. Měření ukončíte dvojklikem.",measurearea:"Změřit plochu na mapě. Měření ukončíte dvojklikem."}}}}),define("bundles/framework/bundle/toolbar/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link til kortvisning"},print:{tooltip:"Print"},history:{reset:"Tilbage til standardvisning",back:"Tilbage",next:"Næste"},pan:"Pannorér kortvisning",zoom:"Zoom ind",measure:{line:"Mål afstand",area:"Mål område"}},measure:{title:"Mål",close:"Annullér",guidance:{measureline:"Mål en linje på kortet. Dobbeltklik for at stoppe måling.",measurearea:"Mål et område på kortet. Dobbeltklik for at stoppe måling."}}}}),define("bundles/framework/bundle/toolbar/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link zur Kartenansicht"},print:{tooltip:"Drucken"},history:{reset:"Zurück zur Standardansicht",back:"Zurück",next:"Weiter"},pan:"Kartenauschnitt verschieben",zoom:"Hereinzoomen",measure:{line:"Entfernung messen",area:"Fläche messen"}},measure:{title:"Messfunktionen",close:"Abbrechen",guidance:{measureline:"Messen Sie eine Linie auf der Karte. Doppelklicken, um die Messung zu beenden.",measurearea:"Messen Sie eine Fläche auf der Karte. Doppelklicken, um die Messung zu beenden."}}}}),define("bundles/framework/bundle/toolbar/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"OK",title:"Make a link to the map view."},print:{tooltip:"Print out the map view."},history:{reset:"Return to the default map view.",back:"Return to the previous map view.",next:"Move to the next map view."},pan:"Pan the map view by dragging mouse on the map.",zoom:"Zoom in the map view.",measure:{line:"Measure a line on the map.",area:"Measure an area on the map."}},measure:{title:"Measurement Results",close:"Cancel",guidance:{measureline:"Draw a line and measure its distance on the map. Click the start point of the line to start measuring. After that click all breakpoints of the line. Double-click the end point of the line to stop measuring.",measurearea:"Draw an area and measure it on the map. Click the start point of the area's border line to start measuring. After that click all breakpoints of the border line. Double-click the end point of the border line to stop measuring."}}}}),define("bundles/framework/bundle/toolbar/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"Toolbar",value:{buttons:{link:{tooltip:"Enlace",ok:"Hecho",title:"Enlace a una vista"},print:{tooltip:"Imprimir"},history:{reset:"Volver a la vista inicial",back:"Atrás",next:"Siguiente"},pan:"Desplazar la vista",zoom:"Acercar",measure:{line:"Medir distancia",area:"Medir área"}},measure:{title:"Mediciones",close:"Cancelar",guidance:{measureline:"Medir una línea en el mapa. Doble click para finalizar la medición.",measurearea:"Medir un área en el mapa. Doble click para finalizar la medición."}}}}),define("bundles/framework/bundle/toolbar/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link kaardivaatesse"},print:{tooltip:"Prindi"},history:{reset:"Tagasipöördumine vaikevaatesse",back:"Tagasi",next:"Järgmine"},pan:"Liigu kaardivaates",zoom:"Suumi sisse",measure:{line:"Mõõda vahemaa",area:"Mõõda pind"}},measure:{title:"Mõõtmised",close:"Tühista",guidance:{measureline:"Mõõda joon kaardil. Topeltklõps lõpetab mõõtmise.",measurearea:"Mõõda pindala kaardil. Topeltkklõps lõpetab mõõtmise."}}}}),define("bundles/framework/bundle/toolbar/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"Toolbar",value:{buttons:{link:{tooltip:"Tee linkki karttanäkymään.",ok:"OK",title:"Linkki karttanäkymään"},print:{tooltip:"Tulosta karttanäkymä."},history:{reset:"Siirry oletusnäkymään.",back:"Siirry edelliseen karttanäkymään.",next:"Siirry seuraavaan karttanäkymään."},pan:"Siirrä karttaa hiirellä raahaamalla.",zoom:"Lähennä karttaa.",measure:{line:"Mittaa etäisyys pisteiden välillä.",area:"Mittaa alueen pinta-ala."}},measure:{title:"Mittaustulokset",close:"Lopeta",guidance:{measureline:"Piirrä mitattava etäisyys klikkaamalla viivamaisen kohteen taitepisteitä hiirellä. Lopeta piirtäminen kaksoisklikkaamalla karttaa loppupisteessä.",measurearea:"Piirrä mitattava alue klikkaamalla alueen kulmapisteitä hiirellä. Lopeta piirtäminen kaksoisklikkaamalla karttaa alkupisteessä."}}}}),define("bundles/framework/bundle/toolbar/locale/fi",function(){}),Oskari.registerLocalization({lang:"hr",key:"Toolbar",value:{buttons:{link:{tooltip:"Poveznica",ok:"Ok",title:"Poveznica na prikaz karte"},print:{tooltip:"Ispis"},history:{reset:"Povratak na zadani prikaz",back:"Natrag",next:"Dalje"},pan:"Pomakni prikaz karte",zoom:"Uvećaj",measure:{line:"Izmjeri udaljenost",area:"Izmjeri površinu"}},measure:{title:"Mjerenja",close:"Poništi",guidance:{measureline:"Izmjeri liniju na karti. Dvostruki klik za prekid mjerenja.",measurearea:"Izmjeri površinu na karti. Dvostruki klik za prekid mjerenja."}}}}),define("bundles/framework/bundle/toolbar/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Térképnézet link"},print:{tooltip:"Nyomtatás"},history:{reset:"Vissza az alapértelmezett nézethez",back:"Vissza",next:"Következő"},pan:"Térképnézet eltolása",zoom:"Nagyítás",measure:{line:"Távolságmérés",area:"Területmérés"}},measure:{title:"Mérések",close:"Mégsem",guidance:{measureline:"Vonal mérése a térképen. Mérés befejezése dupla kattintással.",measurearea:"Terület mérése a térképen. Mérés befejezése dupla kattintással."}}}}),define("bundles/framework/bundle/toolbar/locale/hu",function(){}),Oskari.registerLocalization({lang:"lv",key:"Toolbar",value:{buttons:{link:{tooltip:"Saite",ok:"Labi",title:"Saite uz kartes skatu"},print:{tooltip:"Drukāt"},history:{reset:"Atgriezties pie noklusējuma skata",back:"Atpakaļ",next:"Nākamais"},pan:"Bīdīt kartes skatu",zoom:"Tuvināt",measure:{line:"Mērīt attālumu",area:"Mērīt laukumu"}},measure:{title:"Mērījumi",close:"Atcelt",guidance:{measureline:"Mērīt līniju uz kartes. Dubultklikšķis, lai apturētu mērīšanu.",measurearea:"Mērīt laukumu uz kartes. Dubultklikšķis, lai apturētu mērīšanu."}}}}),define("bundles/framework/bundle/toolbar/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link naar de kaartweergave"},print:{tooltip:"Print"},history:{reset:"Terug naar standaardweergave",back:"Terug ",next:"Verder"},pan:"Verschuif kaartweergave",zoom:"Vergroten",measure:{line:"Meet afstand",area:"Meet gebied"}},measure:{title:"Metingen",close:"Annuleren",guidance:{measureline:"Meet een lijn in de kaart. Dubbelklik om te stoppen met meten.",measurearea:"Meet een gebied in de kaart. Dubbelklik om te stoppen met meten."}}}}),define("bundles/framework/bundle/toolbar/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link do widoku mapy"},print:{tooltip:"Drukuj"},history:{reset:"Powrót do domyślnego widoku",back:"Cofnij",next:"Następny"},pan:"NOT TRANSLATED",zoom:"Przybliż",measure:{line:"Pomiar odległości",area:"Pomiar powierzchni"}},measure:{title:"Pomiary",close:"Anuluj",guidance:{measureline:"Zmierz linię na mapie. Podwójne kliknięcie wstrzymuje pomiar.",measurearea:"Zmierz powierzchnię mapy.Podwójne kliknięcie wstrzymuje pomiar."}}}}),define("bundles/framework/bundle/toolbar/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"Toolbar",value:{buttons:{link:{tooltip:"Ligação",ok:"Ok",title:"Ligação à vista da carta"},print:{tooltip:"Imprimir"},history:{reset:"Voltar à vista padrão",back:"Voltar",next:"Seguinte"},pan:"Vista panorâmica",zoom:"Ampliar",measure:{line:"Medir distância",area:"Medir área"}},measure:{title:"Medições",close:"Cancelar",guidance:{measureline:"Medir uma linha na carta. Duplo-clique para parar",measurearea:"Medir uma área na carta. Duplo-clique para parar"}}}}),define("bundles/framework/bundle/toolbar/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link către vizualizare hartă"},print:{tooltip:"Imprimare"},history:{reset:"Revenire la vederea implicită",back:"Înapoi",next:"Următorul"},pan:"Deplasare hartă",zoom:"Mărire",measure:{line:"Măsurare distanţă",area:"Măsurare suprafaţă"}},measure:{title:"Măsurători",close:"Anulare",guidance:{measureline:"Măsurare linie pe hartă. Dublu-click pentru a încheia măsurătoarea",measurearea:"Măsurare suprafaţă pe hartă. Dublu-click pentru a încheia măsurătoarea"}}}}),define("bundles/framework/bundle/toolbar/locale/ro",function(){}),Oskari.registerLocalization({lang:"sr",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Potvrdi",title:"Link ka prikazu mape"},print:{tooltip:"Štampa"},history:{reset:"Povratak na početni prikaz",back:"Nazad",next:"Sledeći"},pan:"Pomeri prikaz na karti",zoom:"Uvećaj prikaz",measure:{line:"Izmeri dužinu",area:"Izmeri površinu"}},measure:{title:"Merenja",close:"Odustani",guidance:{measureline:"Merenje linije na mapi. Dupli klik za kraj merenja.",measurearea:"Merenje površine na mapi. Dupli klik za kraj merenja."}}}}),define("bundles/framework/bundle/toolbar/locale/sr",function(){}),Oskari.registerLocalization({lang:"sl",key:"Toolbar",value:{buttons:{link:{tooltip:"Povezava",ok:"V redu",title:"Povezava na pogled karte"},print:{tooltip:"Natisni"},history:{reset:"Vrnitev na privzet pogled",back:"Nazaj",next:"Naprej"},pan:"Premakni pogled karte",zoom:"Povečaj",measure:{line:"Izmeri razdaljo",area:"Izmeri površino"}},measure:{title:"Meritve",close:"Prekliči",guidance:{measureline:"Izmeri linijo na karti. Dvoklikni za končanje merjenja.",measurearea:"Izmeri površino na karti. Dvoklikni za končanje merjenja."}}}}),define("bundles/framework/bundle/toolbar/locale/sl",function(){}),Oskari.registerLocalization({lang:"sk",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link k zobrazeniu mapy"},print:{tooltip:"Tlač"},history:{reset:"Návrat k predvolenému zobrazeniu",back:"Späť",next:"Ďalej"},pan:"Posunutie zobrazenia mapy",zoom:"Priblížiť",measure:{line:"Merať vzdialenosti",area:"Merať plochy"}},measure:{title:"Meranie",close:"Zrušiť",guidance:{measureline:"Merať líniu na mape. Dvojklik na skončenie merania.",measurearea:"Merať plochu na mape. Dvojklik na skončenie merania."}}}}),define("bundles/framework/bundle/toolbar/locale/sk",function(){}),Oskari.registerLocalization({lang:"sq",key:"Toolbar",value:{buttons:{link:{tooltip:"Linku",ok:"Ok (prano)",title:"Linku për pamje të hartës"},print:{tooltip:"Shtyp"},history:{reset:"Kthehu në shikimin automatik/të parazgjedhur",back:"Kthehu prapa",next:"Shko përpara"},pan:"Lëviz pamjen në hartë",zoom:"Zmadho",measure:{line:"Matje e distancës",area:"Matje e sipërfaqes"}},measure:{title:"Matjet",close:"Anulo",guidance:{measureline:"Mat një vijë në hartë. Kliko dy herë për ta ndalur matjen.",measurearea:"Mat një sipërfaqe në hartë. Kliko dy herë për ta ndalur matjen."}}}}),define("bundles/framework/bundle/toolbar/locale/sq",function(){}),Oskari.registerLocalization({lang:"sv",key:"Toolbar",value:{buttons:{link:{tooltip:"Länk",ok:"Ok",title:"Länk till kartvyn"},print:{tooltip:"Skriv ut"},history:{reset:"Tillbaka till standardvyn",back:"Föregående",next:"Nästa"},pan:"Flytta kartan",zoom:"Zooma in",measure:{line:"Mät avstånd",area:"Mät areal"}},measure:{title:"Mätningsresultat",close:"Avbryt",guidance:{measureline:"Peka ut sträckan som ska mätas på kartan. Sluta mätningen genom att dubbelklicka.",measurearea:"Peka ut området som ska mätas på kartan. Sluta mätningen genom att dubbelklicka."}}}}),define("bundles/framework/bundle/toolbar/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"Toolbar",value:{buttons:{link:{tooltip:"Посилання",ok:"Ок",title:"Посилання на вигляд карти"},print:{tooltip:"Друк"},history:{reset:"Повернутись до початкового вигляду",back:"Попередній вигляд",next:"Наступний вигляд"},pan:"Панорамування",zoom:"Збільшити",measure:{line:"Виміряти відстань",area:"Виміряти площу"}},measure:{title:"Вимірювання",close:"Скасувати",guidance:{measureline:"Вимірювання лінії на карті. Подвійний клік закінчує вимірювання.",measurearea:"Вимірювання площі на карті. Подвійний клік закінчує вимірювання."}}}}),define("bundles/framework/bundle/toolbar/locale/uk",function(){}),define("src/framework/toolbar/module",["oskari","jquery","bundles/framework/bundle/toolbar/instance","bundles/framework/bundle/toolbar/button-methods","bundles/framework/bundle/toolbar/default-buttons","bundles/framework/bundle/toolbar/request/AddToolButtonRequest","bundles/framework/bundle/toolbar/request/RemoveToolButtonRequest","bundles/framework/bundle/toolbar/request/ToolButtonStateRequest","bundles/framework/bundle/toolbar/request/SelectToolButtonRequest","bundles/framework/bundle/toolbar/request/ToolButtonRequestHandler","bundles/framework/bundle/toolbar/request/ShowMapMeasurementRequestHandler","bundles/framework/bundle/toolbar/event/ToolSelectedEvent","bundles/framework/bundle/toolbar/event/ToolbarLoadedEvent","bundles/framework/bundle/toolbar/request/ToolbarRequest","bundles/framework/bundle/toolbar/request/ToolbarRequestHandler","css!resources/framework/bundle/toolbar/css/toolbar.css","bundles/framework/bundle/toolbar/locale/hy","bundles/framework/bundle/toolbar/locale/cs","bundles/framework/bundle/toolbar/locale/da","bundles/framework/bundle/toolbar/locale/de","bundles/framework/bundle/toolbar/locale/en","bundles/framework/bundle/toolbar/locale/es","bundles/framework/bundle/toolbar/locale/et","bundles/framework/bundle/toolbar/locale/fi","bundles/framework/bundle/toolbar/locale/hr","bundles/framework/bundle/toolbar/locale/hu","bundles/framework/bundle/toolbar/locale/lv","bundles/framework/bundle/toolbar/locale/nl","bundles/framework/bundle/toolbar/locale/pl","bundles/framework/bundle/toolbar/locale/pt","bundles/framework/bundle/toolbar/locale/ro","bundles/framework/bundle/toolbar/locale/sr","bundles/framework/bundle/toolbar/locale/sl","bundles/framework/bundle/toolbar/locale/sk","bundles/framework/bundle/toolbar/locale/sq","bundles/framework/bundle/toolbar/locale/sv","bundles/framework/bundle/toolbar/locale/uk"],function(e){return e.bundleCls("toolbar").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance");return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance",function(){this._localization=null,this._pluginInstances={},this._startupState=null,this._historyPollingInterval=1500,this._historyTimer=null,this._historyPrevious=[],this._historyNext=[],this._historyEnabled=!0,this._defaultViewId=1,this._currentViewId="undefined"!=typeof window.viewId?window.viewId:this._defaultViewId},{__name:"StateHandler",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=this.conf,n=(i?i.sandbox:null)||"sandbox",a=Oskari.getSandbox(n),r=i?i.sessionLength:0;e.sandbox=a,a.register(e);for(t in e.eventHandlers)e.eventHandlers.hasOwnProperty(t)&&a.registerForEventByName(e,t);var s=a.getAjaxUrl(),o=Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",s);this.registerPlugin(o),this.startPlugin(o),a.addRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler),a.addRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler),this.getSandbox().getUser().isLoggedIn()&&r>0&&this.setSessionExpiring(r)}},update:function(){},stop:function(){var e,t=this.sandbox();t.removeRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler),t.removeRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler);var i=t.getRequestBuilder("MapControls.ToolButtonRequest");i&&t.request(this,i(this.toolbar.config,"remove"));for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);this.sandbox.unregister(this),this.started=!1},init:function(){var e=this.sandbox;return this.requestHandlers={setStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",e,this),saveStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",e,this)},null},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapMoveEvent:function(){this._pushState()},AfterMapLayerAddEvent:function(){this._pushState()},AfterMapLayerRemoveEvent:function(){this._pushState()},AfterChangeMapLayerStyleEvent:function(){this._pushState()},MapLayerVisibilityChangedEvent:function(){this._pushState()},AfterAddMarkerEvent:function(){this._pushState()},AfterRemoveMarkersEvent:function(){this._pushState()}},registerPlugin:function(e){e.setHandler(this);var t=e.getName();this.sandbox.printDebug("["+this.getName()+"] Registering "+t),this._pluginInstances[t]=e},unregisterPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"] Unregistering "+t),this._pluginInstances[t]=void 0,e.setHandler(null)},startPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"] Starting "+t),e.startPlugin(this.sandbox)},stopPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"] Starting "+t),e.stopPlugin(this.sandbox)},setCurrentViewId:function(e){this._currentViewId=e},getCurrentViewId:function(){return this._currentViewId},_stateComparators:[{rule:"nohistory",cmp:function(e){return e?void 0:!0}},{rule:"location",cmp:function(e,t){return e.east!==t.east||e.north!==t.north?!0:e.zoom!==t.zoom?!0:void 0}},{rule:"layers",cmp:function(e,t){var i,n,a,r=this,s=e.selectedLayers,o=t.selectedLayers;if(s.length!==o.length)return!0;for(i=0;i<o.length;i+=1){if(n=s[i],a=o[i],r.sandbox.printDebug("[StateHandler] comparing layer state "+n.id+" vs "+a.id),n.id!==a.id)return!0;if(n.opacity!==a.opacity)return!0;if(n.hidden!==a.hidden)return!0;if(n.style!==a.style)return!0}return!1}},{rule:"plugins",cmp:function(e,t){var i=e.plugins.MainMapModuleMarkersPlugin,n=t.plugins.MainMapModuleMarkersPlugin,a=i?i.markers:[],r=n?n.markers:[];return i&&!n||!i&&n?!0:a.length!==r.length?!0:JSON.stringify(a)!==JSON.stringify(r)}}],_compareState:function(e,t,i){var n,a,r={result:!1,rule:null,rulesMatched:{}},s=this;for(n=0;n<s._stateComparators.length;n+=1)if(a=s._stateComparators[n],s.sandbox.printDebug("[StateHandler] comparing state "+a.rule),a.cmp.apply(this,[e,t])&&(s.sandbox.printDebug("[StateHandler] comparing state MATCH "+a.rule),r.result=!0,r.rule=a.rule,r.rulesMatched[a.rule]=a.rule,i))return r;return r},_logState:function(){var e=this,t=e.conf.logUrl+"?"+e.sandbox.generateMapLinkParameters();jQuery.ajax({type:"GET",url:t})},_pushState:function(){var e=this;if(e._historyEnabled){var t=e._historyPrevious,i=e._getMapState(),n=0===t.length?null:t[t.length-1],a=e._compareState(n,i,!0);a.result&&(e.sandbox.printDebug("[StateHandler] PUSHING state"),i.rule=a.rule,e._historyPrevious.push(i),e._historyNext=[],e.conf&&e.conf.logUrl&&e._logState())
}},historyMoveNext:function(){var e=this.getSandbox();if(this._historyNext.length>0){var t=this._historyNext.pop();this._historyPrevious.push(t);var i=e.findRegisteredModuleInstance("MainMapModule");this._historyEnabled=!1;var n=this._getMapState();this._setMapState(i,t,n),this._historyEnabled=!0}},historyMovePrevious:function(){var e=this.getSandbox();switch(this._historyPrevious.length){case 0:break;case 1:var t=this._historyNext;this.resetState(),this._historyNext=t;break;default:var i=this._historyPrevious.pop();this._historyNext.push(i);var n=this._historyPrevious[this._historyPrevious.length-1],a=e.findRegisteredModuleInstance("MainMapModule"),r=this._getMapState();this._historyEnabled=!1,this._setMapState(a,n,r),this._historyEnabled=!0}},_getMapState:function(){return this.getSandbox().getStatefulComponents().mapfull.getState()},_setMapState:function(e,t,i){var n=this.getSandbox(),a=this._compareState(i,t,!1);a.result&&this.getSandbox().getStatefulComponents().mapfull.setState(t),n.syncMapState(!0)},_teardownState:function(e){var t,i=this.getSandbox(),n=i.findAllSelectedMapLayers(),a=i.getRequestBuilder("RemoveMapLayerRequest");for(t=0;t<n.length;t+=1)i.request(e.getName(),a(n[t].getId()))}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/statehandler/instance",function(){}),Oskari.clazz.category("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance","state-methods",{useState:function(e){if(!e)return[];var t,i=jQuery.extend(!0,{},e),n=this.sandbox.getStatefulComponents(),a=[];for(t in i)i.hasOwnProperty(t)&&(n[t]&&n[t].setState&&n[t].setState(i[t].state),a.push(t));return a},resetState:function(){var e,t,i=this;i._historyEnabled=!1,i._historyPrevious=[],i._historyNext=[];for(e in i._pluginInstances)i._pluginInstances.hasOwnProperty(e)&&(i.sandbox.printDebug("["+i.getName()+"] resetting state on "+e),i._pluginInstances[e].resetState());i._currentViewId=i._defaultViewId,t=i._getStartupState(),t?i._resetComponentsWithNoStateData(i.useState(t)):jQuery.ajax({dataType:"json",type:"GET",url:i.sandbox.getAjaxUrl()+"action_route=GetAppSetup&noSavedState=true",success:function(e){e&&e.configuration?(i._setStartupState(e.configuration),i._resetComponentsWithNoStateData(i.useState(i._getStartupState())),i._historyEnabled=!0):alert("error in getting configuration")},error:function(){alert("error loading conf"),i._historyEnabled=!0},complete:function(){i._historyEnabled=!0}}),i._historyEnabled=!0},_getStartupState:function(){var e;return e=this._startupState?jQuery.extend(!0,{},this._startupState):this._startupState},_setStartupState:function(e){this._startupState=jQuery.extend(!0,{},e)},_resetComponentsWithNoStateData:function(e){var t,i,n,a=this.sandbox.getStatefulComponents();for(t in a)if(a.hasOwnProperty(t)){for(i=!1,n=0;n<e.length;n+=1)if(t===e[n]){i=!0;break}i||a[t].setState()}},saveState:function(e,t){var i;if(t)this.sandbox.printDebug("["+this.getName()+"] saving state with "+t),this._pluginInstances[t].saveState(e);else for(i in this._pluginInstances)this._pluginInstances.hasOwnProperty(i)&&this.saveState(e,i)},getCurrentState:function(){var e,t={},i=this.sandbox.getStatefulComponents();for(e in i)i.hasOwnProperty(e)&&(i[e].getState?t[e]={state:i[e].getState()}:this.sandbox.printWarn("Stateful component "+e+" doesnt have getState()"));return t},getSavedState:function(e){return this._pluginInstances[e].getState()}}),define("bundles/framework/bundle/statehandler/state-methods",function(){}),Oskari.clazz.category("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance","state-methods",{setSessionExpiring:function(e){if(e){var t=this.getSandbox(),i=this._createNotificationDialog(e);t.setSessionExpiring(e-1,function(){i.show()})}},_createNotificationDialog:function(e){var t,i=this,n=this.getLocalization("session"),a=this.getSandbox(),r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button"),o=n.expiring.extend,l=n.expiring.title,u=n.expiring.message,c=n.expired.title,d=n.expired.message;return u=u.replace("{extend}",'"'+o+'"'),s.addClass("primary"),s.setTitle(o),s.setHandler(function(){a.extendSession(function(){r.show(c,d),r.makeModal()}),clearTimeout(t),i.setSessionExpiring(e),r.close(!0)}),{show:function(){r.show(l,u,[s]),t=setTimeout(function(){r.show(c,d),r.makeModal()},6e4)}}}}),define("bundles/framework/bundle/statehandler/session-methods",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.Plugin",function(){throw"Oskari.mapframework.bundle.statehandler.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setHandler:function(){throw"Implement your own"},startPlugin:function(){throw"Implement your own"},stopPlugin:function(){throw"Implement your own"},getState:function(){throw"Implement your own"},resetState:function(){throw"Implement your own"},saveState:function(){throw"Implement your own"}}),define("bundles/framework/bundle/statehandler/plugin/Plugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",function(e){this.handler=null,this.pluginName=null,this._sandbox=null,this._ajaxUrl=e},{__name:"statehandler.SaveViewPlugin",getName:function(){return this.pluginName},getHandler:function(){return this.handler},setHandler:function(e){this.handler=e,this.pluginName=e.getName()+this.__name},getState:function(){},resetState:function(){},saveState:function(e,t){var i=t,n=this;i||(i=this.handler.getCurrentState());var a={currentViewId:n.handler.getCurrentViewId(),viewData:i};e&&(a.viewName=e.name,a.viewDescription=e.description);var r=n._sandbox.getEventBuilder("StateSavedEvent"),s=r(a.viewName,i);jQuery.cookie.json=!0;var o=7;jQuery.cookie("oskaristate",a,{expires:o}),a.viewData=JSON.stringify(a.viewData),jQuery.ajax({type:"POST",url:this._ajaxUrl+"action_route=AddView",data:a,success:function(e){n._sandbox.notifyAll(s),n.handler.setCurrentViewId(e.id)},error:function(){a.viewName&&(s.setError(!0),n._sandbox.notifyAll(s))}})},serializeJSON:function(e){var t=this,i=typeof e;if("object"!==i||null===e)return"string"===i&&(e='"'+e+'"'),String(e);var n=[],a=e&&e.constructor==Array;return jQuery.each(e,function(e,r){i=typeof r,"string"===i?r='"'+r+'"':"object"===i&&null!==r&&(r=t.serializeJSON(r)),n.push((a?"":'"'+e+'":')+String(r))}),(a?"[":"{")+String(n)+(a?"]":"}")},startPlugin:function(e){this._sandbox=e;var t=this;jQuery(document).ready(function(){jQuery(window).on("beforeunload",function(){t.saveState()})})},stopPlugin:function(){this._sandbox=null}},{protocol:["Oskari.mapframework.bundle.statehandler.plugin.Plugin"]}),define("bundles/framework/bundle/statehandler/plugin/SaveViewPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequest",function(e){this._creator=null,this._state=e,this._currentViewId=1},{__name:"StateHandler.SetStateRequest",getName:function(){return this.__name},getState:function(){return this._state},getCurrentViewId:function(){return this._currentViewId},setCurrentViewId:function(e){this.currentViewId=e}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/statehandler/request/SetStateRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",function(e,t){this.sandbox=e,this.statehandler=t},{handleRequest:function(e,t){t.getState()?(this.statehandler.setCurrentViewId(t.getCurrentViewId()),this.statehandler.useState(t.getState())):this.statehandler.resetState()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/statehandler/request/SetStateRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.event.StateSavedEvent",function(e,t){this._name=e,this._state=t,this._error=!1},{__name:"StateSavedEvent",getName:function(){return this.__name},getViewName:function(){return this._name},getState:function(){return this._state},isError:function(){return this._error},setError:function(e){this._error=1==e}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/statehandler/event/StateSavedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequest",function(e,t){this._viewName=e,this._viewDescription=t},{__name:"StateHandler.SaveStateRequest",getName:function(){return this.__name},getViewName:function(){return this._viewName},getViewDescription:function(){return this._viewDescription}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/statehandler/request/SaveStateRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",function(e,t){this.sandbox=e,this.statehandler=t},{handleRequest:function(e,t){this.statehandler.saveState({name:t.getViewName(),description:t.getViewDescription()})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/statehandler/request/SaveStateRequestHandler",function(){}),Oskari.registerLocalization({lang:"en",key:"StateHandler",value:{session:{expiring:{title:"Your session is about to expire",message:"Your session is about to expire. Please click {extend} to stay logged in.",extend:"Continue session"},expired:{title:"Your session has expired",message:"Your session has expired. Please reload the page to login again."}}}}),define("bundles/framework/bundle/statehandler/locale/en",function(){}),Oskari.registerLocalization({lang:"sv",key:"StateHandler",value:{session:{expiring:{title:"Din session håller på att gå ut",message:"Din session håller på att gå ut. Klicka {extend} för att förbli inloggad.",extend:"Fortsätt sessionen"},expired:{title:"Din session har gått ut",message:"Din session har gått ut. Ladda om sidan för att logga in på nytt."}}}}),define("bundles/framework/bundle/statehandler/locale/sv",function(){}),Oskari.registerLocalization({lang:"fi",key:"StateHandler",value:{session:{expiring:{title:"Istuntosi on vanhenemassa",message:"Istuntosi on vanhenemassa. Klikkaa {extend} pysyäksesi kirjautuneena.",extend:"Jatka istuntoa"},expired:{title:"Istuntosi on vanhentunut",message:"Istuntosi on vanhentunut. Lataa sivu uudelleen kirjautuaksesi takaisin palveluun."}}}}),define("bundles/framework/bundle/statehandler/locale/fi",function(){}),define("src/framework/statehandler/module",["oskari","jquery","bundles/framework/bundle/statehandler/instance","libraries/jquery/plugins/jquery.cookie","bundles/framework/bundle/statehandler/state-methods","bundles/framework/bundle/statehandler/session-methods","bundles/framework/bundle/statehandler/plugin/Plugin","bundles/framework/bundle/statehandler/plugin/SaveViewPlugin","bundles/framework/bundle/statehandler/request/SetStateRequest","bundles/framework/bundle/statehandler/request/SetStateRequestHandler","bundles/framework/bundle/statehandler/event/StateSavedEvent","bundles/framework/bundle/statehandler/request/SaveStateRequest","bundles/framework/bundle/statehandler/request/SaveStateRequestHandler","bundles/framework/bundle/statehandler/locale/en","bundles/framework/bundle/statehandler/locale/sv","bundles/framework/bundle/statehandler/locale/fi"],function(e){return e.bundleCls("statehandler").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance")},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance",function(){this.sandbox=null,this.started=!1,this.mediator=null},{__name:"Infobox",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");t.register(e),e.setSandbox(t);for(var i in e.eventHandlers)i&&t.registerForEventByName(e,i);var n=t.findRegisteredModuleInstance("MainMapModule");n.registerPlugin(this.popupPlugin),n.startPlugin(this.popupPlugin),t.addRequestHandler("InfoBox.ShowInfoBoxRequest",this.requestHandlers.showInfoHandler),t.addRequestHandler("InfoBox.HideInfoBoxRequest",this.requestHandlers.hideInfoHandler),t.addRequestHandler("InfoBox.RefreshInfoBoxRequest",this.requestHandlers.refreshInfoHandler)}},init:function(){var e=this.conf&&this.conf.adaptable===!0;return this.popupPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin"),this.popupPlugin.setAdaptable(e),this.requestHandlers={showInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",this.popupPlugin),hideInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",this.popupPlugin),refreshInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.RefreshInfoBoxRequestHandler",this.popupPlugin)},null},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},eventHandlers:{MapClickedEvent:function(){}},stop:function(){var e=this,t=this.sandbox;for(var i in e.eventHandlers)i&&t.unregisterFromEventByName(e,i);e.sandbox.unregister(e),e.started=!1},setState:function(e){if(e&&e.popups){this.popupPlugin.close();for(var t=0;t<e.popups.length;++t){var i=e.popups[t];this.popupPlugin.popup(i.id,i.title,i.data,i.lonlat)}}},getState:function(){var e={popups:[]},t=this.popupPlugin.getPopups();for(var i in t){var n=t[i],a={id:i,title:n.title,data:n.contentData,lonlat:n.lonlat};e.popups.push(a)}return e}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/infobox/instance",function(){}),jQuery.fn.outerHTML=function(e){var t;return this.length?e?(jQuery.each(this,function(t,i){var n,a=i,r=i.outerHTML?"outerHTML":"innerHTML";i.outerHTML||(i=jQuery(i).wrap("<div>").parent()[0]),jQuery.isFunction(e)?(n=e.call(a,t,i[r]))!==!1&&(i[r]=n):i[r]=e,i.outerHTML||jQuery(i).children().unwrap()}),this):this[0].outerHTML||(t=this.wrap("<div>").parent().html(),this.unwrap(),t):void 0===val||null===val?this:null},Oskari.clazz.define("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._popups={}},{__name:"OpenLayersPopupPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},init:function(){var e=this;e._arrow=jQuery('<div class="popupHeaderArrow"></div>'),e._header=jQuery("<div></div>"),e._headerWrapper=jQuery('<div class="popupHeader"></div>'),e._headerCloseButton=jQuery('<div class="olPopupCloseBox icon-close-white" style="position: absolute; top: 12px;"></div>'),e._contentDiv=jQuery('<div class="popupContent"></div>'),e._contentWrapper=jQuery('<div class="contentWrapper"></div>'),e._actionLink=jQuery('<span class="infoboxActionLinks"><a href="#"></a></span>'),e._actionButton=jQuery('<span class="infoboxActionLinks"><input type="button" /></span>'),e._contentSeparator=jQuery('<div class="infoboxLine">separator</div>')},popup:function(e,t,i,n,a,r){if(!_.isEmpty(i)){var s=this._popups[e],o=s&&s.lonlat.lon===n.lon&&s.lonlat.lat===n.lat;o&&(i=this._getChangedContentData(s.contentData.slice(),i.slice()),s.contentData=i),this._renderPopup(e,i,t,n,a,r,o)}},_renderPopup:function(e,t,i,n,a,r,s){var o,l=this,u=l._renderContentData(e,t),c=l._renderPopupContent(e,i,u);s?(o=l._popups[e].popup,o.setContentHTML(c)):(o=new OpenLayers.Popup(e,n,new OpenLayers.Size(400,300),c,!1),l._popups[e]={title:i,contentData:t,lonlat:n,popup:o,colourScheme:a,font:r},o.moveTo=function(e){if(null!==e&&void 0!==e&&null!==this.div&&void 0!==this.div){this.div.style.left=e.x+"px";var t=e.y-20;this.div.style.top=t+"px"}},l.getMapModule().getMap().addPopup(o)),l.adaptable&&l._adaptPopupSize(e,s),l._panMapToShowPopup(n),l._setClickEvent(e,o,t),o.setBackgroundColor("transparent"),jQuery(o.div).css("overflow","visible"),jQuery(o.groupDiv).css("overflow","visible");var d=jQuery("#"+e);a&&l._changeColourScheme(a,d,e),r&&l._changeFont(r,d,e);var h=d.find(".contentWrapper input, .contentWrapper textarea");"function"==typeof h.placeholder&&h.placeholder()},_renderPopupContent:function(e,t,i){var n,a=this._arrow.clone(),r=this._header.clone(),s=this._headerWrapper.clone(),o=this._headerCloseButton.clone();return o.attr("id","oskari_"+e+"_headerCloseButton"),r.append(t),s.append(r),s.append(o),n=a.outerHTML()+s.outerHTML()+i.outerHTML()},_renderContentData:function(e,t){var i=this;return _.foldl(t,function(t,n,a){var r,s,o,l,u=n.useButtons===!0,c=n.primaryButton,d=i._contentWrapper.clone();d.append(n.html),d.attr("id","oskari_"+e+"_contentWrapper");for(r in n.actions)u?(s=i._actionButton.clone(),o=s.find("input"),o.attr({contentdata:a,value:r}),r==c&&o.addClass("primary")):(s=i._actionLink.clone(),l=s.find("a"),l.attr("contentdata",a),l.attr("id","oskari_"+e+"_actionLink"),l.append(r)),d.append(s);return t.append(d),t},i._contentDiv.clone())},_setClickEvent:function(e,t,i){var n=this;t.events.un({click:t.onclick,scope:t}),t.events.on({click:function(t){var a=jQuery(t.target||t.srcElement);if(a.hasClass("olPopupCloseBox"))n.close(e);else{var r=a.attr("contentdata"),s=a.attr("value");s||(s=a.html()),i[r]&&i[r].actions&&i[r].actions[s]&&i[r].actions[s]()}},scope:t})},_getChangedContentData:function(e,t){var i,n,a;for(n=0,oLen=e.length;oLen>n;++n)for(a=0,nLen=t.length;nLen>a;++a)if(t[a].layerId&&t[a].layerId===e[n].layerId){e[n]=t[a],t.splice(a,1);break}return i=e.concat(t)},removeContentData:function(e,t){var i,n,a,r=this.getPopups(e),s=!1;if(r){for(i=r.contentData,a=0,cLen=i.length;cLen>a;++a)if(n=i[a],n.layerId&&""+n.layerId==""+t){i.splice(a,1),s=!0;break}s&&(0===i.length?this.close(e):this._renderPopup(e,i,r.title,r.lonlat,r.colourScheme,r.font,!0))}},setAdaptable:function(e){this.adaptable=e},_adaptPopupSize:function(e,t){var i=jQuery(this.getMapModule().getMapViewPortDiv()),n=jQuery("#"+e),a=parseFloat(n.css("left"));t||(a+=10),n.find(".popupHeaderArrow").css({"margin-left":"-10px"});var r=(n.find(".popupHeader").css("width","100%"),.7*i.width()),s=.7*i.height(),o=n.find(".popupContent").css({"margin-left":"0",padding:"5px 20px 5px 20px","max-height":s-40+"px"});n.find(".olPopupContent").css({width:"100%",height:"100%"});var l=o.find(".contentWrapper");if(n.css({height:"auto",width:"auto","min-width":"300px","max-width":r+"px","min-height":"200px",left:a+"px","z-index":"16000"}),jQuery.browser.msie)l.css({"padding-bottom":"5px"});else{var u=l.height();u=u>s?s+30+"px":"auto",o.css({height:u})}},_panMapToShowPopup:function(e){var t=this._map.getViewPortPxFromLonLat(e),i=this._map.getCurrentSize(),n=i.w,a=i.h,r=0,s=0,o=jQuery(".olPopup"),l=o.width()+128,u=o.height()+128;t.x+l>n&&(r=n-(t.x+l)),t.y+u>a?s=a-(t.y+u):t.y<25&&(s=25),(0!==r||0!==s)&&this.getMapModule().panMapByPixels(-r,-s)},_changeColourScheme:function(e,t,i){if(t=t||jQuery("div#"+i),e&&t){var n=t.find("div.popupHeaderArrow"),a=t.find("div.popupHeader"),r=t.find("div.popupTitle"),s=t.find("div.getinforesult_header"),o=t.find("h3.myplaces_header"),l=t.find("div.olPopupCloseBox");n.css({"border-right-color":e.bgColour}),a.css({"background-color":e.bgColour,color:e.titleColour}),r.css({color:e.titleColour}),s.css({"background-color":e.bgColour}),s.find("div.getinforesult_header_title").css({color:e.titleColour}),o.css({color:e.headerColour}),e.iconCls&&l.removeClass("icon-close-white icon-close").addClass(e.iconCls)}},_changeFont:function(e,t,i){if(t=t||jQuery("div#"+i),t&&e){var n,a=[];for(a.push(t),a.push(t.find("table.getinforesult_table")),j=0;j<a.length;j++)n=a[j],n.removeClass(function(){var e,t="",i=this.className.split(" ");for(e=0;e<i.length;++e)/oskari-publisher-font-/.test(i[e])&&(t+=i[e]+" ");return t}),n.addClass("oskari-publisher-font-"+e)}},close:function(e,t){if(e)this._popups[e]&&(this._popups[e].popup&&this._popups[e].popup.destroy(),delete this._popups[e]);else{var i,n;for(i in this._popups)n=this._popups[i],t&&t.lon===n.lonlat.lon&&t.lat===n.lonlat.lat||(n.popup.destroy(),delete this._popups[i])}},getPopups:function(e){return e?this._popups[e]:this._popups},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/infobox/plugin/openlayerspopup/OpenlayersPopupPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequest",function(e,t,i,n,a,r,s){this._creator=null,this._id=e,this._title=t,this._content=i,this._position=n,this._hidePrevious=1==a,this._colourScheme=r,this._font=s},{__name:"InfoBox.ShowInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getTitle:function(){return this._title},getContent:function(){return this._content},getPosition:function(){return this._position},getHidePrevious:function(){return this._hidePrevious},getColourScheme:function(){return this._colourScheme},getFont:function(){return this._font}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/infobox/request/ShowInfoBoxRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){t.getHidePrevious()&&this.popupPlugin.close(void 0,t.getPosition()),this.popupPlugin.popup(t.getId(),t.getTitle(),t.getContent(),t.getPosition(),t.getColourScheme(),t.getFont())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/infobox/request/ShowInfoBoxRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequest",function(e){this._creator=null,this._id=e},{__name:"InfoBox.HideInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/infobox/request/HideInfoBoxRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){this.popupPlugin.close(t.getId())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/infobox/request/HideInfoBoxRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.RefreshInfoBoxRequest",function(e,t,i){this._creator=null,this._id=e,this._operation=t,this._contentId=i},{__name:"InfoBox.RefreshInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getOperation:function(){return this._operation},getContentId:function(){return this._contentId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/infobox/request/RefreshInfoBoxRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.RefreshInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){var i,n,a=this.popupPlugin._sandbox,r=t.getId(),s=t.getOperation(),o=t.getContentId(),l=this.popupPlugin.getPopups(r);l&&("remove"===s?this.popupPlugin.removeContentData(r,o):(i=a.getEventBuilder("InfoBox.InfoBoxEvent"),n=i(r,!0,o),a.notifyAll(n)))}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/infobox/request/RefreshInfoBoxRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.event.InfoBoxEvent",function(e,t,i){this._popupId=e,this._isOpen=t,this._contentId=i},{__name:"InfoBox.InfoBoxEvent",getName:function(){return this.__name},getId:function(){return this._popupId},isOpen:function(){return this._isOpen},getContentId:function(){return this._contentId}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/infobox/event/InfoBoxEvent",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/infobox/css/infobox.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,define("src/framework/infobox/module",["oskari","jquery","bundles/framework/bundle/infobox/instance","bundles/framework/bundle/infobox/plugin/openlayerspopup/OpenlayersPopupPlugin","bundles/framework/bundle/infobox/request/ShowInfoBoxRequest","bundles/framework/bundle/infobox/request/ShowInfoBoxRequestHandler","bundles/framework/bundle/infobox/request/HideInfoBoxRequest","bundles/framework/bundle/infobox/request/HideInfoBoxRequestHandler","bundles/framework/bundle/infobox/request/RefreshInfoBoxRequest","bundles/framework/bundle/infobox/request/RefreshInfoBoxRequestHandler","bundles/framework/bundle/infobox/event/InfoBoxEvent","css!resources/framework/bundle/infobox/css/infobox.css"],function(e){return e.bundleCls("infobox").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance");return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.search.SearchBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.service=null,this.tabPriority=1,this.disableDefault=!1,this.safeChars=!1},{__name:"Search",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e&&this._localization[e]?this._localization[e]:this.localization?this._localization:{}},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,this.localization=Oskari.getLocalization(this.getName());var a=null;a=this.conf&&this.conf.url?this.conf.url:n.getAjaxUrl()+"action_route=GetSearchResult",this.conf&&"number"==typeof this.conf.priority&&(this.tabPriority=this.conf.priority),this.conf&&this.conf.disableDefault===!0&&(this.disableDefault=!0),this.conf&&this.conf.safeChars===!0&&(this.safeChars=!0);var r="Oskari.mapframework.bundle.search.service.SearchService";this.service=Oskari.clazz.create(r,a),n.register(e);var s;for(s in e.eventHandlers)e.eventHandlers.hasOwnProperty(s)&&n.registerForEventByName(e,s);var o="userinterface.AddExtensionRequest",l=n.getRequestBuilder(o),u=l(this);n.request(this,u),n.registerAsStateful(this.mediator.bundleId,this),e.createUi(),this.requestHandlers={addTabRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.search.request.AddTabRequestHandler",n,this.plugins["Oskari.userinterface.Flyout"]),addSearchResultActionRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.search.request.SearchResultActionRequestHandler",n,this.plugins["Oskari.userinterface.Flyout"])},n.addRequestHandler("Search.AddTabRequest",this.requestHandlers.addTabRequestHandler),n.addRequestHandler("Search.AddSearchResultActionRequest",this.requestHandlers.addSearchResultActionRequestHandler),n.addRequestHandler("Search.RemoveSearchResultActionRequest",this.requestHandlers.addSearchResultActionRequestHandler)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i="userinterface.RemoveExtensionRequest",n=t.getRequestBuilder(i),a=n(this);t.request(this,a),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/search/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateResultTable=null,this.templateResultTableHeader=null,this.templateResultTableRow=null,this.resultHeaders=[],this.lastResult=null,this.lastSort=null,this.resultActions={},this._searchContainer=null,this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer")},{getName:function(){return"Oskari.mapframework.bundle.search.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("search")||jQuery(this.container).addClass("search")},startPlugin:function(){this.template=jQuery('<div class="searchContainer"><div class="searchDescription"></div><div class="controls"></div><div><br></div><div class="info"></div><div><br></div><div class="resultList"></div></div>'),this.templateResultTable=jQuery('<table class="search_result oskari-grid"><thead><tr></tr></thead><tbody></tbody></table>'),this.templateResultTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>'),this.templateResultTableRow=jQuery('<tr><td><a href="JavaScript:void(0);"></a></td><td></td><td></td></tr>'),this.resultHeaders=[{title:this.instance.getLocalization("grid").name,prop:"name"},{title:this.instance.getLocalization("grid").village,prop:"village"},{title:this.instance.getLocalization("grid").type,prop:"type"}]},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getTabTitle:function(){return this.instance.getLocalization("tabTitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state?this.state:{}},createUi:function(){if(!this.instance.disableDefault){var e=this,t=e.instance.getSandbox(),i=jQuery(e.container);i.empty();var n=e.template.clone();e._searchContainer=n;var a=n.find("div.searchDescription");a.html(e.instance.getLocalization("searchDescription"));var r=Oskari.clazz.create("Oskari.userinterface.component.FormInput");if(r.setPlaceholder(e.instance.getLocalization("searchAssistance")),r.setIds("oskari_search_forminput","oskari_search_forminput_searchassistance"),e.instance.safeChars){var s=/[\s\w\d\.\,\?\!\-äöåÄÖÅ]*\*?$/;r.setContentCheck(!0,e.instance.getLocalization("invalid_characters"),s)}r.bindChange(function(){null===e.state&&(e.state={});var i=r.getValue();if(e.state.searchtext=i,!i){var a=n.find("div.info");a.empty();var s=n.find("div.resultList");s.empty();var o=t.getRequestBuilder("MapModulePlugin.RemoveMarkersRequest");o&&t.request(e.instance.getName(),o())}}),r.addClearButton("oskari_search_forminput_clearbutton");var o=Oskari.clazz.create("Oskari.userinterface.component.Button");o.setTitle(this.instance.getLocalization("searchButton")),o.setId("oskari_search_button_search");var l=function(){r.setEnabled(!1),o.setEnabled(!1);var t=n.find("div.resultList");t.empty();var i=n.find("div.info");i.empty();var a=r.getValue(e.instance.safeChars);return e._validateSearchKey(r.getValue(!1))?void e.instance.service.doSearch(a,function(t){r.setEnabled(!0),o.setEnabled(!0),e._renderResults(t,a)
},function(t){r.setEnabled(!0),o.setEnabled(!0);var i=t?t.responseText:null,n=e.instance.getLocalization("searchservice_search_not_found_anything_text");i&&e.instance.getLocalization(i)&&(n=e.instance.getLocalization(i)),e._showError(n)}):(r.setEnabled(!0),void o.setEnabled(!0))};o.setHandler(l),r.bindEnterKey(l);var u=n.find("div.controls");u.append(r.getField()),u.append(o.getElement()),i.append(n)}},_validateSearchKey:function(e){var t=this;return null===e||void 0===e||0===e.length?(t._showError(t.instance.getLocalization("cannot_be_empty")),!1):(e.match(/\*/g)||[]).length>1?(t._showError(t.instance.getLocalization("too_many_stars")),!1):e.indexOf("*")>-1&&e.length<5?(t._showError(t.instance.getLocalization("too_short")),!1):t.instance.safeChars&&!/^[a-zåäöA-ZÅÄÖ \.,\?\!0-9]+\**$/.test(e)?(t._showError(t.instance.getLocalization("invalid_characters")),!1):!0},_showError:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton("OK");t.setId("oskari_search_error_popup"),t.show(this.instance.getLocalization("searchservice_search_alert_title"),e,[i])},_renderResults:function(e,t){if(e&&"number"==typeof e.totalCount){var i=this,n=i._searchContainer.find("div.resultList");n.empty(),i.lastResult=e;var a=i._searchContainer.find("div.info");a.empty();var r=i.instance;if(-1===e.totalCount)return void n.append(this.instance.getLocalization("searchservice_search_alert_title")+this.instance.getLocalization(e.errorText));if(0===e.totalCount){var s="searchservice_search_alert_title",o=r.getLocalization(s),l="searchservice_search_not_found_anything_text",u=r.getLocalization(l);return void n.append(o+":"+u)}a.append(this.instance.getLocalization("searchResultCount")+" "+e.totalCount+" "+this.instance.getLocalization("searchResultCount2")),a.append("<br/>"),e.hasMore&&(a.append(this.instance.getLocalization("searchResultDescriptionMoreResults")),a.append("<br/>")),a.append(this.instance.getLocalization("searchResultDescriptionOrdering")),1===e.totalCount&&(i._resultClicked(e.locations[0]),r.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[i.instance,"close"]));var c,d,h,p=this.templateResultTable.clone(),f=p.find("thead tr"),m=p.find("tbody"),g=function(e){return function(){m.empty();var t=!1;i.lastSort&&i.lastSort.attr===e.prop&&(t=!i.lastSort.descending),i._sortResults(e.prop,t),i._populateResultTable(m);var n=f.find("a:contains("+e.title+")");return f.find("th").removeClass("asc"),f.find("th").removeClass("desc"),n.parent().addClass(t?"desc":"asc"),!1}};for(c=0;c<this.resultHeaders.length;++c)d=this.templateResultTableHeader.clone(),h=d.find("a"),h.append(this.resultHeaders[c].title),h.bind("click",g(this.resultHeaders[c])),f.append(d);this._populateResultTable(m),n.append("<div><h3>"+this.instance.getLocalization("searchResults")+" "+e.totalCount+" "+this.instance.getLocalization("searchResultsDescription")+" "+t+"</h3></div>"),n.append(p)}},_populateResultTable:function(e){var t,i,n,a,r,s,o=this,l=function(e){return function(){return o._resultClicked(e),!1}},u=this.lastResult.locations;for(t=0;t<u.length;++t)i=u[t],n=this.templateResultTableRow.clone(),a=n.find("td"),r=jQuery(a[0]),s=r.find("a"),s.append(i.name),s.bind("click",l(i)),jQuery(a[1]).append(i.village),jQuery(a[2]).append(i.type),e.append(n)},_resultClicked:function(e){var t=this,i="searchResultPopup",n=this.instance,a=n.sandbox,r=a.getRequestBuilder("MapMoveRequest");a.request(t.instance.getName(),r(e.lon,e.lat,e.zoomLevel,!1));var s,o=this.instance.getLocalization("resultBox"),l={};for(var u in this.resultActions)this.resultActions.hasOwnProperty(u)&&(s=this.resultActions[u],l[u]=s(e));var c={html:"<h3>"+e.name+"</h3><p>"+e.village+"<br/>"+e.type+"</p>",actions:l},d=[c];c.actions[o.close]=function(){var e="InfoBox.HideInfoBoxRequest",n=a.getRequestBuilder(e),r=n(i);a.request(t.instance.getName(),r)};var h="InfoBox.ShowInfoBoxRequest",p=a.getRequestBuilder(h),f=p(i,o.title,d,new OpenLayers.LonLat(e.lon,e.lat),!0);a.request(this.instance.getName(),f)},_sortResults:function(e,t){var i=this;this.lastResult&&(this.lastSort={attr:e,descending:t},this.lastResult.locations.sort(function(n,a){return i._searchResultComparator(n,a,e,t)}))},_searchResultComparator:function(e,t,i,n){var a=e[i].toLowerCase(),r=t[i].toLowerCase(),s=0;return(a===r||"name"===i)&&(a=e.id,r=t.id),r>a?s=-1:a>r&&(s=1),n&&(s=-1*s),s},addTab:function(e){var t=this,i=jQuery(t.container);if(0===t.tabsContainer.panels.length&&(t.tabsContainer.insertTo(i),t.instance.disableDefault!==!0)){var n=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),a=jQuery("div.searchContainer");n.setTitle(t.getTabTitle(),"oskari_search_tabpanel_header"),n.setContent(a),n.setPriority(t.instance.tabPriority),t.tabsContainer.addPanel(n)}var r=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");r.setTitle(e.title,e.id),r.setContent(e.content),r.setPriority(e.priority),t.tabsContainer.addPanel(r)},addSearchResultAction:function(e){this.resultActions[e.name]=e.callback},removeSearchResultAction:function(e){delete this.resultActions[e]}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/search/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.search.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){var e=this,t=e.instance,i=this.container,n=(this.template,t.getSandbox(),i.children(".oskari-tile-title"));n.attr("id","oskari_search_tile_title")}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/search/Tile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.request.AddTabRequest",function(e,t,i,n){this._title=e,this._content=t,this._priority=i,this._id=n},{__name:"Search.AddTabRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getContent:function(){return this._content},getPriority:function(){return this._priority},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/search/request/AddTabRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.request.AddTabRequestHandler",function(e,t){this.sandbox=e,this.search=t},{handleRequest:function(e,t){this.search.addTab({title:t.getTitle(),content:t.getContent(),priority:t.getPriority(),id:t.getId()})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/search/request/AddTabRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.request.AddSearchResultActionRequest",function(e,t){this._linkName=e,this._callback=t},{__name:"Search.AddSearchResultActionRequest",getName:function(){return this.__name},getLinkName:function(){return this._linkName},getCallback:function(){return this._callback}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/search/request/AddSearchResultActionRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.request.RemoveSearchResultActionRequest",function(e){this._linkName=e},{__name:"Search.RemoveSearchResultActionRequest",getName:function(){return this.__name},getLinkName:function(){return this._linkName}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/search/request/RemoveSearchResultActionRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.search.request.SearchResultActionRequestHandler",function(e,t){this.sandbox=e,this.search=t},{handleRequest:function(e,t){"Search.AddSearchResultActionRequest"===t.getName()?this.search.addSearchResultAction({name:t.getLinkName(),callback:t.getCallback()}):"Search.RemoveSearchResultActionRequest"===t.getName()&&this.search.removeSearchResultAction(t.getLinkName())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/search/request/SearchResultActionRequestHandler",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/search/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"hy",key:"Search",value:{title:"Տեղանքի որոնում",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Որոնում տեղանքի անվամբ, հասցեով կամ անշարժ գույքի միավորի նույնականացման տվյալներով",searchButton:"Որոնում",searchResultCount:"Որոնման արդյունքներ",searchResultCount2:"Արդյունքներ",searchResultDescriptionMoreResults:"Մասնավորեցնել որոնումը արդյունքների քանակը նվազեցնելու համար",searchResultDescriptionOrdering:"Հնարավոր է ստանալ ստորև ներկայացված աղյուսակում նշված արդյունքները `սեղմերով սյունակի վերնագրերին",searchResults:"Արդյունքներ`",searchResultsDescription:"Որոնման արդյունքներ",searchservice_search_alert_title:"Սխալ`",searchservice_search_not_found_anything_text:"Որոնումն արդյունք չտվեց",too_short:"Որոնման ժամկետը շատ կարճ է",cannot_be_empty:"Որոնման ժամկետի նշումը պարտադիր է",too_many_stars:"Աստղանիշերը շատ են(*)",grid:{name:"Անվանում",village:"Համայնք",type:"Տեսակ"},resultBox:{close:"Փակել",title:"Որոնման արդյունքներ"}}}),define("bundles/framework/bundle/search/locale/hy",function(){}),Oskari.registerLocalization({lang:"bg",key:"Search",value:{title:"Търсене по местоположение",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Търсене по име на място, адрес или идентификатор на недвижим имот.",searchButton:"Търсене",searchResultCount:"Връщане на търсенето",searchResultCount2:"резултати",searchResultDescriptionMoreResults:"Задайте повече критерии в търсенето, за да намалите броя на резултатите",searchResultDescriptionOrdering:"Може да зададете също резултати в таблицата по - долу като щракнете върху заглавията на колоните",searchResults:"Резултати:",searchResultsDescription:"Резултати от търсенето",searchservice_search_alert_title:"Грешка :",searchservice_search_not_found_anything_text:"Търсенето не върна резултати.",too_short:"Вашите критерии за търсене са твърде кратки",cannot_be_empty:"Полето за търсене не трябва да е празно",too_many_stars:"Твърде много звездички ( * )",grid:{name:"Име",village:"Община",type:"Тип"},resultBox:{close:"Затваряне",title:"Резултати от търсенето"}}}),define("bundles/framework/bundle/search/locale/bg",function(){}),Oskari.registerLocalization({lang:"cs",key:"Search",value:{title:"Vyhledávání umístění",desc:"",invalid_characters:"Search term contains illegal characters.",searchDescription:"vyhledávání podle jména místa, adresy nebo identifikátoru budovy.",searchButton:"Vyhledat",searchResultCount:"Vyhledávání vrátilo ",searchResultCount2:" výsledky.",searchResultDescriptionMoreResults:"Specifikujte podrobněji dotaz, abyste snížili počet výsledků.",searchResultDescriptionOrdering:"Kliknutím na hlavičku sloupce můžete výsledky vyhledávání seřadit.",searchResults:"Výsledky: ",searchResultsDescription:" výsledky vyhledávání ",searchservice_search_alert_title:"Chyba: ",searchservice_search_not_found_anything_text:"Vyhledávání nevrátilo žádný výsledek.",too_short:"Vámi vyhledávaný řetězec je příliš krátký.",cannot_be_empty:"Vyhledáváný řetězec nesmí být prázdný.",too_many_stars:"Příliš mnoho hvězdiček (*).",grid:{name:"Jméno",village:"Obec",type:"Typ"},resultBox:{close:"Zavřít",title:"Výsledky vyhledávání"}}}),define("bundles/framework/bundle/search/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"Search",value:{title:"Søg efter placering",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Søg efter navn, adresse eller matrikelnummer",searchButton:"Søg",searchResultCount:"Søgningen gav følgende",searchResultCount2:"resultater",searchResultDescriptionMoreResults:"Uddyb søgning for at reducere antallet af resultater",searchResultDescriptionOrdering:"Du kan også bestille resultater i tabellen herunder ved at klikke på kolonneoverskrifterne",searchResults:"Resultater:",searchResultsDescription:"søgeresultater",searchservice_search_alert_title:"Fejl:",searchservice_search_not_found_anything_text:"Søgningen gav ingen resultater.",too_short:"Dit søgeord er for kort.",cannot_be_empty:"Søgefeltet må ikke være tomt",too_many_stars:"For mange stjerner (*)",grid:{name:"Navn",village:"Kommune",type:"Type"},resultBox:{close:"Luk",title:"Søgeresultater"}}}),define("bundles/framework/bundle/search/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"Search",value:{title:"Ortssuche",desc:"",invalid_characters:"Search term contains illegal characters.",searchDescription:"Suche nach Ortsname, Adresse oder Kennzahl.",searchButton:"Suche",searchResultCount:"Die Suche ergab ",searchResultCount2:" Treffer.",searchResultDescriptionMoreResults:"Verfeinern Sie die Suche, um die Anzahl der Treffer zu verringern.",searchResultDescriptionOrdering:"Sie können die Suchergebnisse in der Tabelle durch Anklicken der Spaltenüberschriften sortieren.",searchResults:"Ergebnisse: ",searchResultsDescription:" Treffer ",searchservice_search_alert_title:"Fehler: ",searchservice_search_not_found_anything_text:"Die Suche ergab keine Treffer.",too_short:"Ihr Suchbegriff ist zu kurz.",cannot_be_empty:"Der Suchbegriff darf nicht leer sein",too_many_stars:"Zu viele Platzhalter (*)",grid:{name:"Name",village:"Gemeinde",type:"Typ"},resultBox:{close:"Schließen",title:"Suchergebnisse"}}}),define("bundles/framework/bundle/search/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"Search",value:{title:"Search",desc:"",tabTitle:"Location Search",invalid_characters:"Search term contains illegal characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces, question marks (?), stars (*) and hyphens (-).",searchDescription:"Search location by place name, address or real estate unit identifier.",searchButton:"Search",searchAssistance:"Write the search term.",searchResultCount:"Your search returned",searchResultCount2:"results.",searchResultDescriptionMoreResults:"Define the search to decrease the number of results.",searchResultDescriptionOrdering:"You can also order results in the table below by clicking the column headings.",searchResults:"Search results:",searchResultsDescription:"results by search term",searchservice_search_alert_title:"Error:",searchservice_search_not_found_anything_text:"No results found.",too_short:"The search term is too short.",cannot_be_empty:"The search term must contain at least one character. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens.",too_many_stars:"The search term contains too many stars (*-characters). It may contain at most N *-characters.",grid:{name:"Place name",village:"Municipality",type:"Type"},resultBox:{close:"Close",title:"Search Results"}}}),define("bundles/framework/bundle/search/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"Search",value:{title:"Localizar",desc:"",invalid_characters:"Search term contains illegal characters.",searchDescription:"Búsqueda de un lugar, dirección o identificador de un inmueble",searchButton:"Búsqueda",searchResultCount:"La búsqueda devolvió",searchResultCount2:"resultados",searchResultDescriptionMoreResults:"Defina la búsqueda para reducir el número de resultados",searchResultDescriptionOrdering:"Puedes ordenar los resultados de la siguiente tabla, pulsando en la cabecera de la columna",searchResults:"Resultados:",searchResultsDescription:"resultados de la búsqueda",searchservice_search_alert_title:"Error:",searchservice_search_not_found_anything_text:"La búsqueda no ha devuelto resultados.",too_short:"El término de la búsqueda es demasiado corto",cannot_be_empty:"El término de la búsqueda no puede ser vacío",too_many_stars:"Demasiados asteriscos (*)",grid:{name:"Nombre",village:"Municipio",type:"Tipo"},resultBox:{close:"Cerrar",title:"Resultados de la búsqueda"}}}),define("bundles/framework/bundle/search/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"Search",value:{title:"Asukoha otsing",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Otsi kohanime, aadressi või kinnistu tunnuse järgi.",searchButton:"Otsi",searchResultCount:"Otsing andis ",searchResultCount2:" tulemust.",searchResultDescriptionMoreResults:"Otsingutulemuste arvu vähendamiseks täpsusta otsingut.",searchResultDescriptionOrdering:"Otsingutulemusi võib tabelis järjestada klikkides veeru päisel.",searchResults:"Tulemused: ",searchResultsDescription:" otsingutulemused ",searchservice_search_alert_title:"Viga: ",searchservice_search_not_found_anything_text:"Otsing ei andnud tulemusi.",too_short:"Otsingufraas on liiga lühike.",cannot_be_empty:"Otsingufraas ei või olla tühi.",too_many_stars:"Liiga palju tärne (*).",grid:{name:"Nimi",village:"Omavalitsus",type:"Tüüp"},resultBox:{close:"Sulge",title:"Otsingutulemused"}}}),define("bundles/framework/bundle/search/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"Search",value:{title:"Haku",desc:"",tabTitle:"Paikkahaku",invalid_characters:"Hakusanassa on kiellettyjä merkkejä. Sallittuja merkkejä ovat aakkoset (A-Ö, a-ö), numerot (0-9), piste (.), pilkku (,), yhdysviiva (-) ja huutomerkki (!). Lisäksi sallittuja ovat kysymysmerkki (?), jolla voi korvata sanasta yhden merkin, ja jokerimerkki (*), jolla voi korvata sanan loppuosan. Jokerimerkki voi olla ainoastaan sanan lopussa.",searchDescription:"Hae paikannimeä, osoitetta tai kiinteistötunnusta.",searchButton:"Hae",searchAssistance:"Kirjoita hakusana tähän.",searchResultCount:"Antamallasi hakusanalla löytyi",searchResultCount2:"hakutulosta.",searchResultDescriptionMoreResults:"Tarkentamalla hakusanaa voit rajata hakutulosten määrää.",searchResultDescriptionOrdering:"Voit järjestää hakutulokset klikkaamalla valitsemasi sarakkeen otsikkoa alla olevassa taulukossa.",searchResults:"Tulokset:",searchResultsDescription:"hakutulosta hakusanalla",searchservice_search_alert_title:"Virhe:",searchservice_search_not_found_anything_text:"Antamallasi hakusanalla ei löytynyt yhtään hakutulosta. Tarkista hakusanasi oikeinkirjoitus. Jos hakusanassasi on jokerimerkki (*), hakusanassa on oltava vähintään neljä muuta merkkiä.",too_short:"Antamasi hakusana on liian lyhyt. Hakusanassa on oltava vähintään yksi merkki. Poikkeus: Jos hakusanassasi on jokerimerkki (*), hakusanassa on oltava vähintään neljä muuta merkkiä.",cannot_be_empty:"Antamasi hakusana on tyhjä. Hakusanassa on oltava vähintään yksi merkki.",too_many_stars:"Antamassasi hakusanassa on liian monta jokerimerkkiä (*). Hakusanassa saa olla enintään yksi jokerimerkki ja sen tulee olla sanan lopussa.",grid:{name:"Nimi",village:"Kunta",type:"Kohteen tyyppi"},resultBox:{close:"Sulje",title:"Paikkahaun tulokset"}}}),define("bundles/framework/bundle/search/locale/fi",function(){}),Oskari.registerLocalization({lang:"hr",key:"Search",value:{title:"Pretraživanje lokacije",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Pretraživanje po nazivu mjesta, adresi ili oznaci nekretnine..",searchButton:"Pretraživanje",searchResultCount:"Pretraživanje je dalo ",searchResultCount2:" rezultati.",searchResultDescriptionMoreResults:"Definiraj pretragu kako bi se smanjio broj rezultata.",searchResultDescriptionOrdering:"Rezultate u tablici možete poredati i klikom na naziv stupca.",searchResults:"Rezultati: ",searchResultsDescription:" rezultati pretraživanja ",searchservice_search_alert_title:"Greška: ",searchservice_search_not_found_anything_text:"Pretraživanje nije dalo rezultate.",too_short:"Pojam za pretraživanje je prekratak.",cannot_be_empty:"Potrebno je unijeti pojam za pretraživanje.",too_many_stars:"Previše zvjezdica (*).",grid:{name:"Ime",village:"Općina",type:"Tip"},resultBox:{close:"Zatvaranje",title:"Rezultati pretraživanja"}}}),define("bundles/framework/bundle/search/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"Search",value:{title:"Keresés helye",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Keresés a hely neve, címe vagy ingatlan-nyílvántartási azonosítója alapján.",searchButton:"Keresés",searchResultCount:"A keresés",searchResultCount2:"eredményt adott",searchResultDescriptionMoreResults:"Finomítsa a keresést a találatok számának csökkentéséhez.",searchResultDescriptionOrdering:"A táblázat oszlopainak fejlécére kattintva is rendezheti az eredményeket.",searchResults:"Erdmények:",searchResultsDescription:"keresési eredmény",searchservice_search_alert_title:"Hiba:",searchservice_search_not_found_anything_text:"A keresés nem járt eredménnyel.",too_short:"A keresési kifejezés túl rövid",cannot_be_empty:"A keresési kifejezés nem lehet üres",too_many_stars:"Túl sok csillag (*)",grid:{name:"Név",village:"Település",type:"Típus"},resultBox:{close:"Bezárás",title:"Keresési eredmények"}}}),define("bundles/framework/bundle/search/locale/hu",function(){}),Oskari.registerLocalization({lang:"lv",key:"Search",value:{title:"Atrašanās vietas meklēšana",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Meklēt pēc vietas nosaukuma, adreses vai nekustamā īpašuma vienības identifikatora",searchButton:"Meklēšana",searchResultCount:"Atrastie ieraksti",searchResultCount2:"rezultāti",searchResultDescriptionMoreResults:"Precizējiet meklēšanas kritērijus, lai samazinātu rezultātu skaitu",searchResultDescriptionOrdering:"Jūs varat arī sakārtot rezultātus zemāk esošajā tabulā klikšķinot uz kolonnas virsrakstiem",searchResults:"Rezultāti:",searchResultsDescription:"meklēšanas rezultāti",searchservice_search_alert_title:"Kļūda:",searchservice_search_not_found_anything_text:"Meklēšana nedeva nekādus rezultātus",too_short:"Jūsu meklēšanas nosacījums ir pārāk īss",cannot_be_empty:"Meklēšanas nosacījums nevar būt tukšs",too_many_stars:"Pārāk daudz zvaigznīšu (*)",grid:{name:"Nosaukums",village:"Pašvaldība",type:"Tips"},resultBox:{close:"Aizvērt",title:"Meklēšanas rezultāti"}}}),define("bundles/framework/bundle/search/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"Search",value:{title:"Locatie zoeken",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Zoek op plaatsnaam, adres of vastgoedobject ID",searchButton:"Zoek",searchResultCount:"De zoekopdracht is klaar ",searchResultCount2:" resultaten.",searchResultDescriptionMoreResults:"Verfijn de zoekopdracht om het aantal resultaten te verlagen.",searchResultDescriptionOrdering:"U kunt ook de resultaten in de tabel hieronder sorteren door te klikken op de kolomkoppen.",searchResults:"Resultaten: ",searchResultsDescription:" zoek resultaten ",searchservice_search_alert_title:"Fout: ",searchservice_search_not_found_anything_text:"De zoekopdracht heeft geen resultaten opgeleverd.",too_short:"Uw zoekterm is te kort.",cannot_be_empty:"Het zoekveld kan niet leeg zijn.",too_many_stars:"Te veel sterren (*).",grid:{name:"Naam",village:"Gemeente",type:"Type"},resultBox:{close:"Sluiten",title:"Zoekresultaten"}}}),define("bundles/framework/bundle/search/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"Search",value:{title:"Wyszukaj Lokalizację",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Wyszukaj przez nazwę, adres, identyfikator nieruchomości.",searchButton:"Wyszukaj",searchResultCount:"Rezultat wyszukiwania ",searchResultCount2:" wyniki.",searchResultDescriptionMoreResults:"Zdefiniuj wyszukiwanie w celu zmniejszenia liczby wyników.",searchResultDescriptionOrdering:"Możesz również ustawić w kolejności rezultaty w tabeli poniżej poprzez kliknięcie nagłównków kolumn.",searchResults:"Wyniki: ",searchResultsDescription:" wyniki wyszukiwania ",searchservice_search_alert_title:"Błąd: ",searchservice_search_not_found_anything_text:"Wyszukiwanie nie dało wyników.",too_short:"Wyszukiwany wyraz jest za krótki.",cannot_be_empty:"Pole wyszukiwania nie może być puste.",too_many_stars:"Za dużo gwiazdek (*).",grid:{name:"Nazwa",village:"Gmina",type:"Typ"},resultBox:{close:"Zamknij",title:"Wyniki Wyszukiwania"}}}),define("bundles/framework/bundle/search/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"Search",value:{title:"Pesquisar lugar",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Pesquisar lugar por nome, endereço ou identificação predial",searchButton:"Pesquisar",searchResultCount:"Resultado da pesquisa",searchResultCount2:"resultados",searchResultDescriptionMoreResults:"Restringir a pesquisa para diminuir o número de resultados",searchResultDescriptionOrdering:"Pode ordenar os resultados na tabela, fazendo clique nos cabeçalhos das colunas",searchResults:"Resultados:",searchResultsDescription:"resultados da pesquisa",searchservice_search_alert_title:"Erro:",searchservice_search_not_found_anything_text:"A pesquisa é nula",too_short:"Os termos da pesquisa são insuficientes",cannot_be_empty:"O campo de pesquisa não pode estar vazio",too_many_stars:"Excesso de asteriscos (*)",grid:{name:"Nome",village:"Concelho",type:"Tipo"},resultBox:{close:"Fechar",title:"Resultados da pesquisa"}}}),define("bundles/framework/bundle/search/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"Search",value:{title:"Căutare locaţie",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Căutare după nume, adresă sau identificator al imobilului",searchButton:"Căutare",searchResultCount:"Căutarea a returnat",searchResultCount2:"rezultate",searchResultDescriptionMoreResults:"Definire căutare pentru a micşora numărul de rezultate",searchResultDescriptionOrdering:"Rezultatele se pot ordona în tabelul de mai jos dacă se face click pe capul de coloană",searchResults:"Rezultate:",searchResultsDescription:"căutare rezultate",searchservice_search_alert_title:"Eroare:",searchservice_search_not_found_anything_text:"Căutarea nu a returnat rezultate",too_short:"Criteriul de căutare este prea scurt",cannot_be_empty:"Criteriul de căutare nu poate fi nul",too_many_stars:"Prea multe steluţe (*)",grid:{name:"Nume",village:"Municipalitate",type:"Tip"},resultBox:{close:"Închidere",title:"Căutare Rezultate"}}}),define("bundles/framework/bundle/search/locale/ro",function(){}),Oskari.registerLocalization({lang:"sr",key:"Search",value:{title:"Pretraga po lokaciji",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Pretraga po imenu mesta, adresi ili jedinstvenom identifikatoru nepokretnosti",searchButton:"Pretraži",searchResultCount:"Rezultat pretrage",searchResultCount2:"rezultati",searchResultDescriptionMoreResults:"Precizirajte kriteriujum pretrage, da se smanji broj rezultata",searchResultDescriptionOrdering:"Možete sortirati rezultate u tabeli ispod, klikom na naslov kolone",searchResults:"Rezultati:",searchResultsDescription:"rezultati pretrage",searchservice_search_alert_title:"Greška:",searchservice_search_not_found_anything_text:"Nema rezultata",too_short:"Zahtev za pretragu je nedovoljan",cannot_be_empty:"Zahtev za pretragu ne može biti prazan",too_many_stars:"Previše zvezdica (*)",grid:{name:"Ime",village:"Opština",type:"Tip"},resultBox:{close:"Zatvori",title:"Rezultati pretrage"}}}),define("bundles/framework/bundle/search/locale/sr",function(){}),Oskari.registerLocalization({lang:"sl",key:"Search",value:{title:"Iskanje lokacije",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Išči po imenu kraja, naslovu ali po identifikatorju enote nepremičnine.",searchButton:"Išči",searchResultCount:"Rezultati iskanja",searchResultCount2:"rezultati",searchResultDescriptionMoreResults:"Opredeli iskalne pojme za omejitev rezultatov iskanja",searchResultDescriptionOrdering:"Iskalne rezultate lahko tudi razvrstiš s klikom na vrh stolpca",searchResults:"Rezultati:",searchResultsDescription:"rezultati iskanja",searchservice_search_alert_title:"Napaka:",searchservice_search_not_found_anything_text:"Iskanje ni vrnilo rezultatov.",too_short:"Iskalni pojem je prekratek.",cannot_be_empty:"Iskalni pojem ne sme biti prazen",too_many_stars:"Preveč zvezdic (*)",grid:{name:"Ime",village:"Občina",type:"Tip"},resultBox:{close:"Zapri",title:"Rezultati iskanja"}}}),define("bundles/framework/bundle/search/locale/sl",function(){}),Oskari.registerLocalization({lang:"sk",key:"Search",value:{title:"Vyhľadať umiestnenie",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Vyhľadať podľa názvu miesta, adresy alebo identifikátora jednotiek nehnuteľností",searchButton:"Vyhľadať",searchResultCount:"Vyhľadávanie vrátilo",searchResultCount2:"výsledky",searchResultDescriptionMoreResults:"Zadefinovať vyhľadávanie na zníženie počtu výsledkov",searchResultDescriptionOrdering:"Takisto si môžete objednať výsledky v tabuľke kliknutím na záhlavia stĺpca",searchResults:"Výsledky:",searchResultsDescription:"vyhľadať výsledky",searchservice_search_alert_title:"Chyba:",searchservice_search_not_found_anything_text:"Nanašli sa žiadne výsledky.",too_short:"Hľadaný výraz je príliš krátky",cannot_be_empty:"Hľadaný výraz nesmie byť prázdny",too_many_stars:"Príliš veľa hviezdičiek (*)",grid:{name:"Názov",village:"Obec",type:"Typ"},resultBox:{close:"Zatvoriť",title:"Vyhľadať Výsledky"}}}),define("bundles/framework/bundle/search/locale/sk",function(){}),Oskari.registerLocalization({lang:"sq",key:"Search",value:{title:"Kërko lokacionin",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Kërko sipas emrit të vendit, adresës apo identifikuesit të njësisë së pronës së paluajtshme",searchButton:"Kërko",searchResultCount:"Kërkimi është kthyer",searchResultCount2:"rezultatet",searchResultDescriptionMoreResults:"Përcakto kërkimin për të ulur numrin e rezultateve",searchResultDescriptionOrdering:"Ju gjithashtu mund të kërkoni rezultate në tabelën më poshtë duke klikuar në titujt e kolonave",searchResults:"Rezultatet:",searchResultsDescription:"kërko rezultatet",searchservice_search_alert_title:"Gabim:",searchservice_search_not_found_anything_text:"Kërkimi nuk ka sjellur asnjë rezultat",too_short:"Afati i kërkimit tuaj është shumë i shkurtë",cannot_be_empty:"Afati i kërkimit nuk mund të zbrazet",too_many_stars:"Shumë yje (*)",grid:{name:"Emri",village:"Komuna",type:"Lloji"},resultBox:{close:"Mbyll",title:"Rezultatet e kërkimit"}}}),define("bundles/framework/bundle/search/locale/sq",function(){}),Oskari.registerLocalization({lang:"sv",key:"Search",value:{title:"Sökning",desc:"",tabTitle:"Ortnamnssökning",invalid_characters:"Sökterm innehåller otillåtna tecken.",searchDescription:"Sök ortnamn, adress eller fastighetsbeteckning.",searchButton:"Sök",searchAssistance:" ",searchResultCount:"Sökningen gav ",searchResultCount2:" resultat.",searchResultDescriptionMoreResults:"Precisera sökningen för mera kompakta resultat.",searchResultDescriptionOrdering:"Du kan även ordna resultaten i tabellen nedan genom att klicka på kolumnrubrikerna.",searchResults:"Resultat: ",searchResultsDescription:" sökresultat ",searchservice_search_alert_title:"Fel: ",searchservice_search_not_found_anything_text:"Sökningen gav inga resultat.",too_short:"Sökordet är för kort.",cannot_be_empty:"Sökordet kan inte vara tomt.",too_many_stars:"För många *-tecken.",grid:{name:"Namn",village:"Kommun",type:"Typ"},resultBox:{close:"Stäng",title:"Sökresultat"}}}),define("bundles/framework/bundle/search/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"Search",value:{title:"Пошук місцеположення",desc:"",invalid_characters:"NOT TRANSLATED",searchDescription:"Пошук за власною назвою, адресою чи ідентифікатором об'єкта нерухомості.",searchButton:"Пошук",searchResultCount:"Отримано",searchResultCount2:"результати пошуку",searchResultDescriptionMoreResults:"Уточніть параметри пошуку для зменшення кількості результатів",searchResultDescriptionOrdering:"Ви можете впорядкувати результати пошуку клацнувши на заголовок колонки",searchResults:"Результати:",searchResultsDescription:"пошук результатів",searchservice_search_alert_title:"Помилка:",searchservice_search_not_found_anything_text:"Нічого не знайдено.",too_short:"Пошукове слово дуже коротке",cannot_be_empty:"Пошукове слово не може бути пустим",too_many_stars:"Забагато зірочок (*)",grid:{name:"Назва",village:"Муніципалітет",type:"Тип"},resultBox:{close:"Закрити",title:"Результати пошуку"}}}),define("bundles/framework/bundle/search/locale/uk",function(){}),define("src/framework/search/module",["oskari","jquery","bundles/framework/bundle/search/service/searchservice","bundles/framework/bundle/search/instance","bundles/framework/bundle/search/Flyout","bundles/framework/bundle/search/Tile","bundles/framework/bundle/search/request/AddTabRequest","bundles/framework/bundle/search/request/AddTabRequestHandler","bundles/framework/bundle/search/request/AddSearchResultActionRequest","bundles/framework/bundle/search/request/RemoveSearchResultActionRequest","bundles/framework/bundle/search/request/SearchResultActionRequestHandler","css!resources/framework/bundle/search/css/style.css","bundles/framework/bundle/search/locale/hy","bundles/framework/bundle/search/locale/bg","bundles/framework/bundle/search/locale/cs","bundles/framework/bundle/search/locale/da","bundles/framework/bundle/search/locale/de","bundles/framework/bundle/search/locale/en","bundles/framework/bundle/search/locale/es","bundles/framework/bundle/search/locale/et","bundles/framework/bundle/search/locale/fi","bundles/framework/bundle/search/locale/hr","bundles/framework/bundle/search/locale/hu","bundles/framework/bundle/search/locale/lv","bundles/framework/bundle/search/locale/nl","bundles/framework/bundle/search/locale/pl","bundles/framework/bundle/search/locale/pt","bundles/framework/bundle/search/locale/ro","bundles/framework/bundle/search/locale/sr","bundles/framework/bundle/search/locale/sl","bundles/framework/bundle/search/locale/sk","bundles/framework/bundle/search/locale/sq","bundles/framework/bundle/search/locale/sv","bundles/framework/bundle/search/locale/uk"],function(e){return e.bundleCls("search").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.search.SearchBundleInstance");
return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"LayerSelector",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e,t,i,n,a,r=this,s=r.conf,o=s?s.sandbox:"sandbox",l=Oskari.getSandbox(o);if(!r.started){r.started=!0,r.sandbox=l,l.register(r);for(a in r.eventHandlers)r.eventHandlers.hasOwnProperty(a)&&l.registerForEventByName(r,a);e=l.getRequestBuilder("userinterface.AddExtensionRequest")(r),l.request(r,e),r.createUi(),t=r.sandbox.getService("Oskari.mapframework.service.MapLayerService"),l.registerAsStateful(r.mediator.bundleId,r),i=function(){},n=function(){alert(r.getLocalization("errors").loadFailed)},t.loadAllLayersAjax(i,n)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!1)},AfterMapLayerAddEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!0)},MapLayerEvent:function(e){var t,i=this,n=i.sandbox.getService("Oskari.mapframework.service.MapLayerService"),a=e.getLayerId();"update"===e.getOperation()?(t=n.findMapLayer(a),i.plugins["Oskari.userinterface.Flyout"].handleLayerModified(t)):"add"===e.getOperation()?(t=n.findMapLayer(a),i.plugins["Oskari.userinterface.Flyout"].handleLayerAdded(t),i.plugins["Oskari.userinterface.Tile"].refresh()):"remove"===e.getOperation()?(i.plugins["Oskari.userinterface.Flyout"].handleLayerRemoved(a),i.plugins["Oskari.userinterface.Tile"].refresh()):"sticky"===e.getOperation()&&(t=n.findMapLayer(a),i.plugins["Oskari.userinterface.Flyout"].handleLayerSticky(t),i.plugins["Oskari.userinterface.Tile"].refresh())},"BackendStatus.BackendStatusChangedEvent":function(e){var t,i=e.getLayerId(),n=(e.getStatus(),this.sandbox.getService("Oskari.mapframework.service.MapLayerService"));null===i||void 0===i?this.plugins["Oskari.userinterface.Flyout"].populateLayers():(t=n.findMapLayer(i),this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(t))}},stop:function(){var e,t,i=this,n=i.sandbox();for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&n.unregisterFromEventByName(i,t);e=n.getRequestBuilder("userinterface.RemoveExtensionRequest")(this),n.request(i,e),i.sandbox.unregisterStateful(i.mediator.bundleId),i.sandbox.unregister(i),i.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var e=this;e.plugins["Oskari.userinterface.Flyout"].createUi(),e.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/layerselector2/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Flyout",function(e){this.instance=e,this.container=null,this.template=null,this.state=null,this.layerTabs=[]},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("layerselector2")||jQuery(this.container).addClass("layerselector2")},startPlugin:function(){var e,t,i,n=this,a=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.LayersTab",n.instance,n.instance.getLocalization("filter").inspire,"oskari_layerselector2_tabpanel_inspiretab"),r=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.LayersTab",n.instance,n.instance.getLocalization("filter").organization,"oskari_layerselector2_tabpanel_orgtab");n.template=jQuery('<div class="allLayersTabContent"></div>'),a.groupingMethod="getInspireName",r.groupingMethod="getOrganizationName",n.layerTabs.push(a),n.layerTabs.push(r),n.instance.conf&&n.instance.conf.showPublishedTab===!0&&(e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.PublishedLayersTab",n.instance,n.instance.getLocalization("filter").published),this.layerTabs.push(e)),t=this.container.parentElement.parentElement,i=jQuery(t).find(".oskari-flyouttoolbar").find(".oskari-flyouttools").find(".oskari-flyouttool-close"),i.attr("id","oskari_layerselector2_flyout_oskari_flyouttool_close")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},setContentState:function(e){var t,i;for(e||(e={}),t=0;t<this.layerTabs.length;t+=1)i=this.layerTabs[t],i.getTitle()===e.tab&&(this.tabContainer.select(i.getTabPanel()),i.setState(e))},getContentState:function(){var e,t,i={};for(e=0;e<this.layerTabs.length;e+=1)if(t=this.layerTabs[e],this.tabContainer.isSelected(t.getTabPanel())){i=t.getState();break}return i},createUi:function(){var e,t,i=this,n=jQuery(this.container);for(n.empty(),i.tabContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer"),i.tabContainer.insertTo(n),e=0;e<i.layerTabs.length;e+=1)t=i.layerTabs[e],i.tabContainer.addPanel(t.getTabPanel());i.populateLayers()},populateLayers:function(){var e,t,i,n,a=this.instance.getSandbox(),r=a.getService("Oskari.mapframework.service.MapLayerService"),s=r.getAllLayers();for(e=0;e<this.layerTabs.length;e+=1)t=this.layerTabs[e],t.groupingMethod&&(i=s.slice(0),n=this._getLayerGroups(i,t.groupingMethod),t.showLayerGroups(n))},_getLayerGroups:function(e,t){var i,n,a,r=this,s=[],o=null;for(e.sort(function(e,i){return r._layerListComparator(e,i,t)}),i=0;i<e.length;i+=1)n=e[i],n.getMetaType&&"published"===n.getMetaType()||(a=n[t](),o&&o.getTitle()===a||(o=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",a),s.push(o)),o.addLayer(n));return s},_layerListComparator:function(e,t,i){var n=e[i]().toLowerCase(),a=t[i]().toLowerCase();return n===a&&e.getName()&&t.getName()&&(n=e.getName().toLowerCase(),a=t.getName().toLowerCase()),a>n?-1:n>a?1:0},handleLayerSelectionChanged:function(e,t){var i,n;for(i=0;i<this.layerTabs.length;i+=1)n=this.layerTabs[i],n.setLayerSelected(e.getId(),t)},handleLayerModified:function(e){var t,i,n=this;for(t=0;t<n.layerTabs.length;t+=1)i=n.layerTabs[t],i.updateLayerContent(e.getId(),e)},handleLayerSticky:function(e){var t,i,n=this;for(t=0;t<n.layerTabs.length;t+=1)i=n.layerTabs[t],i.updateLayerContent(e.getId(),e)},handleLayerAdded:function(){var e=this;e.populateLayers()},handleLayerRemoved:function(){var e=this;e.populateLayers()}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/layerselector2/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){var e=this,t=e.instance,i=this.container,n=(this.template,t.getSandbox(),i.children(".oskari-tile-title"));n.attr("id","oskari_layerselector2_tile_title")}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/layerselector2/Tile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",function(e){this.name=e,this.layers=[],this.searchIndex={}},{setTitle:function(e){this.name=e},getTitle:function(){return this.name},addLayer:function(e){this.layers.push(e),this.searchIndex[e.getId()]=this._getSearchIndex(e)},getLayers:function(){return this.layers},_getSearchIndex:function(e){var t=e.getName()+" "+e.getInspireName()+" "+e.getOrganizationName();return t.toLowerCase()},matchesKeyword:function(e,t){var i=this.searchIndex[e];return-1!==i.indexOf(t.toLowerCase())}}),define("bundles/framework/bundle/layerselector2/model/LayerGroup",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.Layer",function(e,t,i){this.sandbox=t,this.localization=i,this.layer=e,this.backendStatus="OK",this.ui=this._createLayerContainer(e)},{__template:'<div class="layer"><input type="checkbox" /> <div class="layer-tools"><div class="layer-backendstatus-icon backendstatus-ok"></div><div class="layer-icon"></div><div class="layer-info"></div></div><div class="layer-title"></div></div>',getId:function(){return this.layer.getId()},setVisible:function(e){e?this.ui.show():this.ui.hide()},setSelected:function(e){this.ui.find("input").attr("checked",!!e)},updateLayerContent:function(e){var t=e.getName(),i=this.backendStatus,n=e.getBackendStatus(),a=this.localization.backendStatus,r=i?a.prevBackendStatus:null,s=n?a.currBackendStatus:null,o=r?r.iconClass:null,l=s?s.iconClass:null,u=r?r.tooltip:null,c=s?s.tooltip:null,d=this.ui.find(".layer-backendstatus-icon");this.ui.find(".layer-title").html(t),e.isSticky()&&this.ui.find("input").attr("disabled","disabled"),o&&o!==l&&d.removeClass(o),l&&o!==l&&d.addClass(l),c?u!==c&&d.attr("title",c):u&&d.attr("title",""),this.backendStatus=n},getContainer:function(){return this.ui},_createLayerContainer:function(e){var t,i,n,a,r,s,o,l,u,c,d,h=this,p=h.sandbox,f=jQuery(this.__template),m=this.localization.tooltip,g=jQuery(f).find("div.layer-tools"),v=g.find("div.layer-icon");if(v.addClass(e.getIconClassname()),e.isBaseLayer()?v.attr("title",m["type-base"]):e.isLayerOfType("WMS")?v.attr("title",m["type-wms"]):e.isLayerOfType("WMTS")?v.attr("title",m["type-wms"]):e.isLayerOfType("WFS")?v.attr("title",m["type-wfs"]):e.isLayerOfType("VECTOR")&&v.attr("title",m["type-wms"]),!e.getMetadataIdentifier()&&(r=e.getSubLayers(),subLmeta=!1,r&&r.length>0))for(subLmeta=!0,s=0;s<r.length;s+=1)if(o=r[s].getMetadataIdentifier(),!o||""===o){subLmeta=!1;break}return(e.getMetadataIdentifier()||subLmeta)&&(d=g.find("div.layer-info"),d.addClass("icon-info"),d.click(function(){if(t="catalogue.ShowMetadataRequest",i=e.getMetadataIdentifier(),n=[],a={},a[i]=!0,r=e.getSubLayers(),r&&r.length>0)for(s=0;s<r.length;s+=1)o=r[s].getMetadataIdentifier(),o&&""!==o&&!a[o]&&(a[o]=!0,n.push({uuid:o}));p.postRequestByName(t,[{uuid:i},n])})),f.attr("layer_id",e.getId()),f.find("input").attr("id","oskari_layerselector2_layerlist_checkbox_layerid_"+e.getId()),f.find(".layer-title").append(e.getName()),f.find("input").change(function(){l=jQuery(this),l.is(":checked")?p.postRequestByName("AddMapLayerRequest",[e.getId(),!1,e.isBaseLayer()]):p.postRequestByName("RemoveMapLayerRequest",[e.getId()])}),e.isSticky()&&f.find("input").attr("disabled","disabled"),u=g.find(".layer-backendstatus-icon"),u.click(function(){c=e.getId(),p.postRequestByName("ShowMapLayerInfoRequest",[c])}),f}},{protocol:["Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/layerselector2/view/Layer",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.LayersTab",function(e,t,i){this.instance=e,this.title=t,this.id=i,this.showSearchSuggestions=e.conf&&e.conf.showSearchSuggestions===!0,this.layerGroups=[],this.layerContainers={},this.templates={spinner:'<span class="spinner-text"></span>',shortDescription:'<div class="field-description"></div>',description:'<div><h4 class="indicator-msg-popup"></h4><p></p></div>',relatedKeywords:'<div class="related-keywords"></div>',keywordsTitle:'<div class="keywords-title"></div>',keywordContainer:'<a href="#"class="keyword-cont"><span class="keyword"></span></a>',keywordType:'<div class="type"></div>'},this._createUI(i)},{getTitle:function(){return this.title},getTabPanel:function(){return this.tabPanel},getState:function(){var e={tab:this.getTitle(),filter:this.filterField.getValue(),groups:[]};return e},setState:function(e){e&&(e.filter||(this.filterField.setValue(e.filter),this.filterLayers(e.filter)))},_createInfoIcon:function(e){var t=this,i=jQuery('<div class="icon-info"></div>'),n=e.find(".field-description");n.find(".icon-info").remove(),n.append(i),i.click(function(){var e=jQuery(t.templates.description),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button");e.find("p").text(t._locale.filter.description),n.setTitle(t._locale.buttons.ok),n.addClass("primary"),n.setHandler(function(){i.close(!0)}),i.show(t._locale.filter.text,e,[n])})},_createUI:function(e){var t,i=this;i._locale=i.instance._localization,i.tabPanel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),i.tabPanel.setTitle(i.title,i.id),t=i.getFilterField().getField(),i.showSearchSuggestions&&(t.append(jQuery(i.templates.spinner).text(i._locale.loading)),t.append(jQuery(i.templates.relatedKeywords))),t.append(jQuery(i.templates.shortDescription).text(i._locale.filter.shortDescription)),i._createInfoIcon(t),i.tabPanel.getContainer().append(t),t.find(".spinner-text").hide(),t.find("input").attr("id","oskari_layerselector2_search_input_tab_"+e),i.accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion"),i.accordion.insertTo(i.tabPanel.getContainer())},getFilterField:function(){var e,t=this,i=0;return t.filterField?t.filterField:(e=Oskari.clazz.create("Oskari.userinterface.component.FormInput"),e.setPlaceholder(t.instance.getLocalization("filter").text),e.addClearButton(),e.bindChange(function(n){n.stopPropagation();var a=n;i&&clearTimeout(i),i=setTimeout(function(){t._fireFiltering(e.getValue(),a,t),i=null},300)},!0),t.filterField=e,e)},_fireFiltering:function(e,t,i){i.filterLayers(e),i.showSearchSuggestions&&(i.clearRelatedKeywordsPopup(e,jQuery(t.currentTarget).parents(".oskarifield")),i._relatedKeywordsPopup(e,t,i))},showLayerGroups:function(e){var t,i,n,a,r,s,o,l,u,c,d,h,p=this,f=e.length;for(p.accordion.removeAllPanels(),p.layerContainers={},p.layerGroups=e,a=p.instance.getLocalization(),t=0;f>t;t+=1){for(i=e[t],n=i.getLayers(),o=n.length,r=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),r.setTitle(i.getTitle()+" ("+o+")"),r.setId("oskari_layerselector2_accordionPanel_"+i.getTitle().replace(/[^a-z0-9\-_:\.]/gi,"-")),i.layerListPanel=r,s=r.getContainer(),l=0;o>l;l+=1)u=n[l],c=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.Layer",u,p.instance.sandbox,a),d=c.getContainer(),s.append(d),p.layerContainers[u.getId()]=c;p.accordion.addPanel(r)}for(h=p.instance.sandbox.findAllSelectedMapLayers(),o=h.length,t=0;o>t;t+=1)p.setLayerSelected(h[t].getId(),!0);p.filterLayers(p.filterField.getValue())},filterLayers:function(e,t){var i,n,a,r,s,o,l,u,c,d,h=this,p=0;if(t||h.sentKeyword!==e||(t=h.ontologyLayers),h.accordion.showPanels(),!e||0===e.length)return void h._showAllLayers();for(n=0;n<h.layerGroups.length;n+=1){for(r=h.layerGroups[n],o=r.getLayers(),i=0,a=0;a<o.length;a+=1)s=o[a],l=s.getId(),u=h.layerContainers[l],c=r.matchesKeyword(l,e)||h.showSearchSuggestions&&t&&h._arrayContains(t,l),u.setVisible(c),c&&(i+=1,r.layerListPanel.open());r.layerListPanel.setVisible(i>0),r.layerListPanel.isVisible()&&(p+=1),r.layerListPanel.setTitle(r.getTitle()+" ("+i+"/"+o.length+")")}0===p?(d=h.instance.getLocalization("errors"),h.accordion.showMessage(d.noResults),jQuery(h.accordion.ui).find(".accordionmsg").attr("id","oskari_layerselector2_inspiretab_search_no-result")):h.accordion.removeMessage()},clearRelatedKeywordsPopup:function(e,t){this.sentKeyword&&this.sentKeyword!==e&&t.find(".related-keywords").html("").hide()},_relatedKeywordsPopup:function(e,t,i){var n,a,r=jQuery(t.currentTarget).parents(".oskarifield");return e&&0!==e.length?e.length<4?void r.find(".related-keywords").hide():(n=r.find(".spinner-text").show(),i.sentKeyword=e,a=this.instance.sandbox.getAjaxUrl(),void jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:a+"action_route=SearchKeywords&keyword="+encodeURIComponent(e)+"&lang="+Oskari.getLang(),success:function(t){i.relatedKeywords=t,i._showRelatedKeywords(e,t,r),n.hide()},error:function(){var e=i.instance.getLocalization("errors");i.accordion.showMessage(e.generic),n.hide()}})):void this._showAllLayers()},_arrayContains:function(e,t){var i;if(e.indexOf)return e.indexOf(t)>-1;for(i=0;i<e.length;i+=1)if(e[i]===t)return!0;return!1},_concatNew:function(e,t){var i,n=this;for(i=t.length-1;i>=0;i-=1)n._arrayContains(e,t[i])||e.push(t[i])},_isDefined:function(e){return"undefined"!=typeof e&&null!==e&&""!==e},_containsIgnoreCase:function(e,t){var i=this;return i._isDefined(e)&&i._isDefined(t)&&e.toLowerCase().indexOf(t.toLowerCase())>-1},_matchesIgnoreCase:function(e,t){var i=this;return i._isDefined(e)&&i._isDefined(t)&&e.toLowerCase()===t.toLowerCase()},_showRelatedKeywords:function(e,t,i){var n,a,r,s=this,o=s.getFilterField().getField().find(".related-keywords"),l=[],u=[];if(s.clearRelatedKeywordsPopup(null,i),t.length>0)for(n=0;n<t.length;n+=1)a=t[n],a.layers.length>0&&(s._matchesIgnoreCase(a.type,"syn")||!s._isDefined(a.type)&&s._containsIgnoreCase(a.keyword,e)?0===u.size?u.concat(a.layers):s._concatNew(u,a.layers):l.push({idx:n,count:a.layers.length}));for(l.length>0&&o.prepend(jQuery(s.templates.keywordsTitle).text(s._locale.filter.didYouMean)),l.sort(function(e,t){return e.count<t.count}),n=0;n<l.length&&3>n;n+=1)a=t[l[n].idx],r=jQuery(s.templates.keywordContainer),r.attr("data-id",a.id).attr("data-keyword",a.keyword).find(".keyword").text(a.keyword.toLowerCase()+" ("+a.layers.length+")"),o.append(r);l.length&&o.show(),s.ontologyLayers=u,s.filterLayers(e,u),o.find(".keyword-cont").on("click",function(e){var t=jQuery(e.currentTarget).attr("data-keyword");s.getFilterField().setValue(t),s._fireFiltering(t,e,s)})},_showAllLayers:function(){var e,t,i,n,a,r,s;for(e=0;e<this.layerGroups.length;e+=1){for(t=this.layerGroups[e],i=t.getLayers(),n=0;n<i.length;n+=1)a=i[n],r=a.getId(),s=this.layerContainers[r],s.setVisible(!0);t.layerListPanel.setVisible(!0),t.layerListPanel.close(),t.layerListPanel.setTitle(t.getTitle()+" ("+i.length+")")}this.accordion.removeMessage()},setLayerSelected:function(e,t){var i=this.layerContainers[e];i&&i.setSelected(t)},updateLayerContent:function(e,t){var i=this.layerContainers[e];i&&i.updateLayerContent(t)}}),define("bundles/framework/bundle/layerselector2/view/LayersTab",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.PublishedLayersTab",function(e,t){this.instance=e,this.title=t,this.layerGroups=[],this.layerContainers={},this._createUI()},{getTitle:function(){return this.title},getTabPanel:function(){return this.tabPanel},getState:function(){var e={tab:this.getTitle(),filter:this.filterField.getValue(),groups:[]};return e},setState:function(e){e&&(e.filter||(this.filterField.setValue(e.filter),this.filterLayers(e.filter)))},_createUI:function(){var e=this;e.tabPanel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),e.tabPanel.setTitle(this.title),e.tabPanel.setSelectionHandler(function(t){t?e.tabSelected():e.tabUnselected()}),e.tabPanel.getContainer().append(this.getFilterField().getField()),e.accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion"),e.accordion.insertTo(this.tabPanel.getContainer())},getFilterField:function(){if(this.filterField)return this.filterField;var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.FormInput");return t.setPlaceholder(e.instance.getLocalization("filter").text),t.addClearButton(),t.bindChange(function(){e._searchTrigger(t.getValue())},!0),t.bindEnterKey(function(){e._relatedSearchTrigger(t.getValue())}),this.filterField=t,t},_searchTrigger:function(e){var t=this;t.searchTimer&&clearTimeout(t.searchTimer),e&&0!==e.length?t.searchTimer=setTimeout(function(){t._search(e),t.searchTimer=void 0},500):t._search(e)},_relatedSearchTrigger:function(){var e=this;e.searchTimer&&clearTimeout(e.searchTimer)},tabSelected:function(){if(0===this.layerGroups.length){this.accordion.showMessage(this.instance.getLocalization("loading"));var e=this,t=this.instance.sandbox.getAjaxUrl();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:t+"action_route=GetPublishedMyPlaceLayers",success:function(t){e._populateLayerGroups(t),e.showLayerGroups(e.layerGroups)},error:function(){var t=e.instance.getLocalization("errors");e.accordion.showMessage(t.generic)}})}},tabUnselected:function(){},_populateLayerGroups:function(e){var t,i,n,a,r,s=this,o=s.instance.getSandbox(),l=o.getService("Oskari.mapframework.service.MapLayerService"),u=o.getUser().getUuid(),c=null;for(this.layerGroups=[],t=0;t<e.length;t+=1)for(i=e[t],c&&c.getTitle()===i.name||(c=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",i.name),this.layerGroups.push(c)),n=0;n<i.layers.length;n+=1)a=i.layers[n],r=this._getPublishedLayer(a,l,u===i.id),r.setDescription(i.name),c.addLayer(r)},_getPublishedLayer:function(e,t,i){var n,a=this._getMapLayerJsonBase();if(a.wmsUrl="/karttatiili/myplaces?myCat="+e.id+"&",a.name=e.name,a.id="myplaces_"+e.id,a.permissions=i?{publish:"publication_permission_ok"}:{publish:"no_publication_permission"},n=t.createMapLayer(a),!i)try{t.addLayer(n)}catch(r){}return n},_getMapLayerJsonBase:function(){var e=this.instance.getLocalization("published"),t={wmsName:"ows:my_places_categories",type:"wmslayer",isQueryable:!0,opacity:50,metaType:"published",orgName:e.organization,inspire:e.inspire};return t},showLayerGroups:function(e){var t,i,n,a,r,s,o,l,u,c,d,h=this;for(h.accordion.removeAllPanels(),h.layerContainers=void 0,h.layerContainers={},h.layerGroups=e,t=0;t<e.length;t+=1){for(i=e[t],n=i.getLayers(),r=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),r.setTitle(i.getTitle()+" ("+n.length+")"),i.layerListPanel=r,a=r.getContainer(),s=0;s<n.length;s+=1)o=n[s],l=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.Layer",o,h.instance.sandbox,h.instance.getLocalization()),u=l.getContainer(),a.append(u),h.layerContainers[o.getId()]=l;h.accordion.addPanel(r)}if(0===h.layerGroups.length)c=h.instance.getLocalization("errors"),h.accordion.showMessage(c.noResults);else for(d=h.instance.sandbox.findAllSelectedMapLayers(),t=0;t<d.length;t+=1)h.setLayerSelected(d[t].getId(),!0)},_search:function(e){var t=this;return e&&0!==e.length?(t.showLayerGroups([]),t.accordion.showMessage(this.instance.getLocalization("loading")),void jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:{searchKey:e},url:ajaxUrl+"action_route=FreeFindFromMyPlaceLayers",success:function(e){t._populateLayerGroups(e),t.showLayerGroups(t.layerGroups)},error:function(){var e=t.instance.getLocalization("errors");t.accordion.showMessage(e.generic)}})):void t.updateLayerContent()},setLayerSelected:function(e,t){var i=this.layerContainers[e];i&&i.setSelected(t)},updateLayerContent:function(){this.accordion.removeMessage(),this.showLayerGroups([]),this.tabSelected()}}),define("bundles/framework/bundle/layerselector2/view/PublishedLayersTab",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/layerselector2/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"hy",key:"LayerSelector",value:{title:"Քարտեզի շերտեր",desc:"",errors:{title:"Սխալ",generic:"Համակարգի սխալ/ փորձեք ավելի ուշ",loadFailed:"Քարտեզի շերտերը ներբեռնելու սխալ/ կրկին բեռնել էջը և ընտրել քարտեզի շերտը",noResults:"Ապարդյուն որոնում",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Ներբեռնում",filter:{text:"Քարտեզի շերտի որոնում",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Թեմայով",organization:"Տվյալների պրովայդերով",published:"Օգտագործողներով",didYouMean:"NOT TRANSLATED"},published:{organization:"Հրապարակված քարտեզի շերտ",inspire:"Հրապարակված քարտեզի շերտ"},tooltip:{"type-base":"Ֆոնային քարտեզ","type-wms":"Քարտեզի շերտ","type-wfs":"Արտադրանքի տվյալներ"},backendStatus:{OK:{tooltip:"Քարտեզի շերտը ժամանակավորապես հասանելի է",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Քարտեզի շերտը ժամանակավորապես անհասանելի է",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Քարտեզի շերտը պարբերաբար անհասանելի կլինի հաջորդ մի քանի օրվա ընթացքում",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/hy",function(){}),Oskari.registerLocalization({lang:"bg",key:"LayerSelector",value:{title:"Картни слоеве",desc:"",errors:{title:"Грешка!",generic:"Системна грешка| Моля, опитайте по - късно",loadFailed:"Грешка при зареждането на картните слоеве| Презаредете страницата в браузъра Ви и изберете картни слоеве",noResults:"Търсенето не върна резултати",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Зареждане...",filter:{text:"Търсене на картни слоеве",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"По тема",organization:"По доставчици на данни",published:"Потребители",didYouMean:"NOT TRANSLATED"},published:{organization:"Публикуван картен слой",inspire:"Публикуван картен слой"},tooltip:{"type-base":"Карта - фон","type-wms":"Картен слой","type-wfs":"Продуктови данни"},backendStatus:{OK:{tooltip:"В момента картният слой е достъпен",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"В момента картният слой е недостъпен",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Картният слой периодично може да е недостъпен през следващите няколко дни",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/bg",function(){}),Oskari.registerLocalization({lang:"cs",key:"LayerSelector",value:{title:"Mapové vrstvy",desc:"Vyberte mapové vrstvy",errors:{title:"Chyba!",generic:"Systémová chyba. Prosím, zkuste to později.",loadFailed:"Chyba při nahrávání mapových vrstvev. Načtěte stránku ve svém prohlížeči znovu a vyberte mapové vrstvy.",noResults:"Vyhledávání nevrátilo žádný výsledek.",noResultsForKeyword:"Vyhledávání nevrátilo žádný výsledek.",minChars:"Minimum length is 4 characters."},loading:"Nahrávám...",filter:{text:"Prohledat mapové vrstvy",keywordsTitle:"Keywords:",shortDescription:"Prohledat mapové vrstvy.",description:"You can search map layers by writing a part of the name or producer of the layer. By writing at 4 least characters and pushing enter key you can also search for keywords that are related to the layers. The number after the keyword in the list tells you how many map layers are related to it.",inspire:"Podle tématu",organization:"Podle poskytovatele dat",published:"Uživatelé",didYouMean:"Did you mean:"},published:{organization:"Publikovaná mapová vrstva",inspire:"Publikovaná mapová vrstva"},tooltip:{"type-base":"Mapa pozadí","type-wms":"Mapová vrstva","type-wfs":"Datový produkt"},backendStatus:{OK:{tooltip:"Mapový vrstva je nyní dostupná.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"V současnosti není mapová vrstva dostupná.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"V následujících dnech může být mapová vrstva nedostupná.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"Informace o stavu mapové vrstvy je nedostupná",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"Synonymum",lk:"Související koncepce",vk:"Koordinovat koncept",ak:"Podřízený pojem",yk:"Nadřazené koncepce"}}}),define("bundles/framework/bundle/layerselector2/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"LayerSelector",value:{title:"Kortlag",desc:"",errors:{title:"Fejl!",generic:"Systemfejl| Prøv venligst igen senere",loadFailed:"Fejl i indlæsning af kortlag| Genindlæs siden i din browser og vælg kortlag",noResults:"Søgningen gav intet resultat",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Indlæser…",filter:{text:"Søg kortlag",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Efter tema",organization:"Efter dataudbydere",published:"Brugere",didYouMean:"NOT TRANSLATED"},published:{organization:"Udgivet kortlag",inspire:"Udgivet kortlag"},tooltip:{"type-base":"Baggrundskort","type-wms":"Kortlag","type-wfs":"Dataprodukt"},backendStatus:{OK:{tooltip:"Kortlaget er tilgængeligt",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Kortlaget er ikke tilgængeligt",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Kortlaget vil være lejlighedsvis utilgængeligt i de kommende dage",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"LayerSelector",value:{title:"Kartenebenen",desc:"Wähle Kartenebenen",errors:{title:"Fehler!",generic:"Systemfehler. Bitte versuchen Sie es später noch einmal.",loadFailed:"Fehler beim Laden der Kartenebenen. Laden Sie die Webseite Ihres Browsers erneut und wählen Sie die Kartenebenen.",noResults:"Die Suche ergab keine Treffer.",noResultsForKeyword:"Die Suche ergab keine Stichworte.",minChars:"Minimum 4 Zeichen lang sein."},loading:"Lade...",filter:{text:"Suche Kartenebenen",keywordsTitle:"Stichworte:",shortDescription:"Suche Kartenebenen nach Name, Hersteller oder Stichworten.",description:"You can search map layers by writing a part of the name or producer of the layer. By writing at 4 least characters and pushing enter key you can also search for keywords that are related to the layers. The number after the keyword in the list tells you how many map layers are related to it.",inspire:"Nach Thema",organization:"Nach Datenanbieter",published:"Benutzer",didYouMean:"Meinten Sie:"},published:{organization:"Veröffentlichte Kartenebene",inspire:"Veröffentlichte Kartenebene"},tooltip:{"type-base":"Hintergrundkarte","type-wms":"Kartenebene","type-wfs":"Datenprodukt"},backendStatus:{OK:{tooltip:"Die Kartenebene ist derzeitig verfügbar.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Die Kartenebene ist derzeitig nicht verfügbar.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Die Kartenebene könnte in den nächsten Tagen teilweise nicht verfügbar sein..",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"Die Informationen zur Verfügbarkeit der Kartenebene liegen nicht vor.",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"Synonym",lk:"Verwandte Konzept",vk:"Koordinieren Konzept",ak:"Untergeordnete Konzept",yk:"Ûbergeordnete Konzept"}}}),define("bundles/framework/bundle/layerselector2/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"LayerSelector",value:{title:"Map Layers",desc:"",errors:{title:"Error!",generic:"The system error occurred. Please try again later.",loadFailed:"The error in loading the map layers occurred. Reload the webpage in your browser and select map layers again.",noResults:"No results found.",noResultsForKeyword:"No map layers found by this keyword.",minChars:"Write at least four characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens."},loading:"Searching...",filter:{text:"Search map layers.",keywordsTitle:"Keywords:",shortDescription:"Search map layers by the name of the map layer, the name of the data producer or the keyword describing the map layer.",description:"Write a part of the name of the map layer, the name of the data producer or the keyword describing the map layer. The keyword search starts up when at least four characters has been written. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens.",inspire:"By Theme",organization:"By Data Provider",published:"Users",didYouMean:"Did you mean:"},published:{organization:"Published map layer",inspire:"Published map layer"},tooltip:{"type-base":"Background map","type-wms":"Map layer (WMS, WMTS)","type-wfs":"Data product (WFS)"},backendStatus:{OK:{tooltip:"The map layer is currently available.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"The map layer is not currently available.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"The map layer may be periodically not available during the next few days.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"Synonym",lk:"Related concept",vk:"Coordinate concept",ak:"Subordinate concept",yk:"Superordinate concept"}}}),define("bundles/framework/bundle/layerselector2/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"LayerSelector",value:{title:"Capas",desc:"",errors:{title:"¡Error!",generic:"¡Error del sistema! Por favor, inténtelo más tarde",loadFailed:"¡Error cargando capas! Recargue la página en su navegador y seleccione las capas",noResults:"La búsqueda no ha devuelto ningún resultado",noResultsForKeyword:"La búsqueda no ha devuelto ningún resultado",minChars:"La longitud mínima es de 4 caracteres."},loading:"Cargando…",filter:{text:"Buscar capas",keywordsTitle:"Keywords:",shortDescription:"Search map layers by name, producer or keyword.",description:"You can search map layers by writing a part of the name or producer of the layer. By writing at 4 least characters and pushing enter key you can also search for keywords that are related to the layers. The number after the keyword in the list tells you how many map layers are related to it.",inspire:"Por temas",organization:"Por proveedores de datos",published:"Usuarios",didYouMean:"Quiso decir:"},published:{organization:"Capa publicada",inspire:"Capa publicada"},tooltip:{"type-base":"Mapa de fondo","type-wms":"Capa","type-wfs":"Producto"},backendStatus:{OK:{tooltip:"La capa está actualmente disponible",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"La capa no está actualmente disponible",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"La capa puede no estar disponible de manera intermitente durante los próximos días",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"OK"},types:{syn:"Sinónimo",lk:"Concepto Relacionados",vk:"Coordinar Concepto",ak:"Concepto Subordinado",yk:"Concepto de Orden Superior"}}}),define("bundles/framework/bundle/layerselector2/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"LayerSelector",value:{title:"Kaardikihid",desc:"",errors:{title:"Viga!",generic:"Süsteemi viga! Palun proovi hiljem uuesti.",loadFailed:"Viga kaardikihtide laadimisel. Laadi lehekülg oma brauseris uuesti ning vali kaardikihid.",noResults:"Otsingutulemusi ei leitud.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"NOT TRANSLATED",filter:{text:"Otsi kaardikihte",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Teemade järgi",organization:"Andmete tarnijate järgi",published:"Kasutajad",didYouMean:"NOT TRANSLATED"},published:{organization:"Avaldatud kaardikiht",inspire:"Avaldatud kaardikiht"},tooltip:{"type-base":"Aluskaart","type-wms":"Kaardikiht","type-wfs":"Andmetoode"},backendStatus:{OK:{tooltip:"Kaardikiht on hetkel kättesaadav.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Kaardikiht pole hetkel kättesaadav.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Lähipäevadel võib kaardikiht olla aegajalt kättesaamatu.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"Kaardikihi oleku info pole kättesaadav.",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"LayerSelector",value:{title:"Karttatasot",desc:"",errors:{title:"Virhe!",generic:"Järjestelmässä tapahtui virhe. Yritä myöhemmin uudelleen.",loadFailed:"Karttatasojen lataaminen epäonnistui. Päivitä sivu selaimessasi ja valitse karttatasot uudelleen.",noResults:"Antamallasi hakusanalla ei löytynyt yhtään karttatasoa.",noResultsForKeyword:"Antamallasi hakusanalla ei löytynyt yhtään karttatasoa.",minChars:"Antamasi hakusana on liian lyhyt. Hakusanassa on oltava vähintään neljä merkkiä."},loading:"Haetaan...",filter:{text:"Hae karttatasoja",keywordsTitle:"Avainsanat:",shortDescription:"Hae karttatasoa karttatason nimen, tiedontuottajan nimen tai avainsanan perusteella.",description:"Voi hakea karttatasoa karttatason nimen, tiedontuottajan nimen tai avainsanan perusteella. Voit kirjoittaa nimen kokonaan tai vain osan nimestä. Hakusanassa on oltava vähintään neljä merkkiä.",inspire:"Aiheittain",organization:"Tiedontuottajittain",published:"Käyttäjät",didYouMean:"Tarkoititko:"},published:{organization:"Julkaistu taso",inspire:"Julkaistu taso"},tooltip:{"type-base":"Taustakartta","type-wms":"Karttataso","type-wfs":"Tietotuote"},backendStatus:{OK:{tooltip:"Karttataso on saatavilla tällä hetkellä.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Karttataso ei ole saatavilla tällä hetkellä.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Karttatason saatavuudessa on tiedossa käyttökatkoja lähipäivinä.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"Synonyymi",lk:"Lähikäsite",vk:"Vieruskäsite",ak:"Alakäsite",yk:"Yläkäsite"}}}),define("bundles/framework/bundle/layerselector2/locale/fi",function(){}),Oskari.registerLocalization({lang:"ka",key:"LayerSelector",value:{title:"რუკის ფენები",desc:"",errors:{title:"შეცდომა",generic:"სისტემის შეცდომა / სცადეთ მოგვიანებით",loadFailed:"შეცდომა ფენების ჩატვირთვისას/ ხელახლა ჩატვირთეთ გვერდი თქვენს ბრაუზერში და შეარჩიეთ ფენა",noResults:"ძებნა დასრულდა უშედეგოდ",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"ჩატვირთვა...",filter:{text:"ფენების ძებნა",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"თემების მიხედვით",organization:"მონაცემების მიმწოდებლების მიხედვით",published:"მომხმარებლები",didYouMean:"NOT TRANSLATED"},published:{organization:"გამოქვეყნებული ფენა",inspire:"გამოქვეყნებული ფენა"},tooltip:{"type-base":"ფონური რუკა","type-wms":"რუკის ფენა","type-wfs":"მონაცემთა პროდუქტი"},backendStatus:{OK:{tooltip:"ფენა ამჟამად მისაწვდომია",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"ფენა ამჟამად მიუწვდომელია",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"ფენა შეიძლება პერიოდულად მიუწვდომელი იყოს რამდენიმე დღის განმავლობაში",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/ka",function(){}),Oskari.registerLocalization({lang:"el",key:"LayerSelector",value:{title:"Επίπεδα χάρτη",desc:"",errors:{title:"Σφάλμα!",generic:"Σφάλμα συστήματος. Παρακαλώ δοκιμάστε αργότερα.",loadFailed:"Σφάλμα κατά την φόρτωση των επιπέδων χάρτη. Ανανεώστε την ιστοσελίδα και επιλέξτε επίπεδα χάρτη.",noResults:"Η αναζήτηση δεν απέφερε αποτελέσματα.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"NOT TRANSLATED",filter:{text:"Αναζήτηση επιπέδων χάρτη",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Κατά αντικείμενο/θέμα",organization:"Κατά παρόχους δεδομένων",published:"Χρήστες",didYouMean:"NOT TRANSLATED"},published:{organization:"Δημοσιευμένο επίπεδο χάρτη",inspire:"Δημοσιευμένο επίπεδο χάρτη"},tooltip:{"type-base":"Υπόβαθρο","type-wms":"Επίπεδο χάρτη","type-wfs":"Δεδομένα"},backendStatus:{OK:{tooltip:"Το επίπεδο χάρτη είναι προσωρινά διαθέσιμο.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Το επίπεδο χάρτη είναι προσωρινά μη διαθέσιμο.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Το επίπεδο χάρτη μπορεί να είναι περιοδικά μη διαθέσιμο για τις επόμενες ημέρες.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"Πληροφορίες για την κατάσταση του επιπέδου του χάρτη δεν διατίθενται,.",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/el",function(){}),Oskari.registerLocalization({lang:"hr",key:"LayerSelector",value:{title:"Slojevi karte",desc:"",errors:{title:"Greška!",generic:"Greška sustava! Pokušajte ponovno kasnije.",loadFailed:"Greška u učitavanju slojeva karte! Osvježite stranice u pregledniku i odaberite slojeve karte.",noResults:"Pretraga nije dala rezultate.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Učitavanje...",filter:{text:"Pretraži slojeve karte",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Po temi",organization:"Po pružateljima podataka",published:"Korisnici",didYouMean:"NOT TRANSLATED"},published:{organization:"Objavljeni sloj karte",inspire:"Objavljeni sloj karte"},tooltip:{"type-base":"Pozadinska karta","type-wms":"Sloj karte","type-wfs":"Podatkovni proizvod"},backendStatus:{OK:{tooltip:"Sloj karte trenutno je dostupan.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Sloj karte trenutno nije dostupan.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Sloj karte možda povremeno neće biti dostupan tijekom sljedećih par dana.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"Informacija o statusu sloja karte nije dostupna.",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"LayerSelector",value:{title:"Térképrétegek",desc:"",errors:{title:"Hiba!",generic:"Rendszerhiba! Kérjük próbálja újra később.",loadFailed:"Nem sikerült betölteni a térképrétegeket.Töltse le újra az oldalt a böngészőben és válassza ki a térképrétegeket.",noResults:"A keresés nem járt eredménnyel.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Betöltés…",filter:{text:"Térképrétegek keresése",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Téma szerint",organization:"Adatszolgáltatók szerint",published:"Felhasználók",didYouMean:"NOT TRANSLATED"},published:{organization:"Közzétett térképréteg",inspire:"Közzétett térképréteg"},tooltip:{"type-base":"Háttértérkép","type-wms":"Térképréteg","type-wfs":"Adattermék"},backendStatus:{OK:{tooltip:"A térképréteg jelenleg elérhető.",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"A térképréteg jelenleg nem érhető el.",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Előfordulhat, hogy a térképréteg ideiglenesen nem lesz elérhető következő néhány napban.",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/hu",function(){}),Oskari.registerLocalization({lang:"lv",key:"LayerSelector",value:{title:"Kartes slāņi",desc:"",errors:{title:"Kļūda!",generic:"Sistēmas kļūda| Lūdzu mēģiniet vēlāk vēlreiz",loadFailed:"Kļūda ielādējot kartes slāņus| Ielādējiet atkārtoti lapu savā pārlūkā un izvēlieties kartes slāni",noResults:"Nekas netika atrasts",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Notiek ielāde…",filter:{text:"Meklēt kartes slāņus",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Pēc tēmas",organization:"Pēc datu sniedzēja",published:"Lietotāji",didYouMean:"NOT TRANSLATED"},published:{organization:"Publicētais kartes slānis",inspire:"Publicētais kartes slānis"},tooltip:{"type-base":"Fona karte","type-wms":"Kartes slānis","type-wfs":"Datu produkts"},backendStatus:{OK:{tooltip:"Kartes slānis šobrīd ir pieejams",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Kartes slānis šobrīd nav pieejams",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Kartes slānis var nebūt periodiski pieejams dažu tuvāko dienu laikā",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"LayerSelector",value:{title:"Kaartlagen",desc:"",errors:{title:"Fout!",generic:"Systeem fout. Probeer het later opnieuw.",loadFailed:"Fout bij het ​​laden van kaartlagen. Vernieuw de pagina in uw browser en selecteer kaartlagen.",noResults:"De zoekopdracht heeft geen resultaten opgeleverd.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"NOT TRANSLATED",filter:{text:"Zoek kaartlagen",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Op thema",organization:"Op dataleverancier",published:"Gebruikers",didYouMean:"NOT TRANSLATED"},published:{organization:"Gepubliceerde kaartlaag",inspire:"Gepubliceerde kaartlaag"},tooltip:{"type-base":"Achergrondkaart","type-wms":"Kaartlaag","type-wfs":"Productgegevens"},backendStatus:{OK:{tooltip:"De kaartlaag is momenteel beschikbaar.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"De kaartlaag is momenteel niet beschikbaar.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"De kaartlaag kan tijdens de komende dagen periodiek niet beschikbaar zijn.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"De statusinformatie van de kaartlaag is niet beschikbaar",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"LayerSelector",value:{title:"Warstwy mapy",desc:"",errors:{title:"Błąd!",generic:"Błąd systemu Proszę spróbować później.",loadFailed:"Błąd wczytywania warstw mapy. Odśwież stronę w wyszukiwarce i wybierz warstwy mapy.",noResults:"Brak rezultatóws.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"NOT TRANSLATED",filter:{text:"Wyszukiwanie warstw mapy",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"poprzez temat",organization:"poprzez dostawców danych",published:"Użytkownicy",didYouMean:"NOT TRANSLATED"},published:{organization:"Opublikowane warstwy mapy",inspire:"Opublikowane warstwy mapy"},tooltip:{"type-base":"Mapa żródłowa","type-wms":"Warstwa mapy","type-wfs":"Produkt"},backendStatus:{OK:{tooltip:"Warstwa mapy jest obecnie dostępna.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Warstwa mapy jest obecnie niedostępna.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Warstwa mapy może być okresowo niedostęna.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"Informacja o statusie warstwy mapy jest niedostępna.",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"LayerSelector",value:{title:"Camadas",desc:"",errors:{title:"Erro!",generic:"Erro de sistema| Por favor tente mais tarde",loadFailed:"Erro no carregamento de camadas| Recarregue a página e selecione camadas",noResults:"A pesquisa é vazia",noResultsForKeyword:"A pesquisa é vazia.",minChars:"NOT TRANSLATED"},loading:"A carregar...",filter:{text:"Pesquisa por camadas",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Por tema",organization:"Por fornecedores",published:"Utilizadores",didYouMean:"NOT TRANSLATED"},published:{organization:"Camada publicada",inspire:"Camada publicada"},tooltip:{"type-base":"Carta de fundo","type-wms":"Camada","type-wfs":"Produto"},backendStatus:{OK:{tooltip:"A camada está disponível",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"A camada não está disponível",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"A camada pode não estar disponível por alguns momentos nos próximos dias",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"OK"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/pt",function(){}),Oskari.registerLocalization({lang:"sr",key:"LayerSelector",value:{title:"Slojevi",desc:"",errors:{title:"Greška!",generic:"Sistemska greška. Molimo, pokušajte ponovo kasnije.",loadFailed:"Greška u učitavanju slojeva. Ponovo učitajte stranu u vašem internet pretraživaču i odaberite slojeve.",noResults:"Nema rezultata",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Učitavanje...",filter:{text:"Izbor slojeva",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Po temi",organization:"Po provajderu",published:"Korisnici",didYouMean:"NOT TRANSLATED"},published:{organization:"Publikovani slojevi",inspire:"Publikovani slojevi"},tooltip:{"type-base":"Osnovna mapa","type-wms":"Sloj","type-wfs":"Podaci sa atributima"},backendStatus:{OK:{tooltip:"Sloj je dostupan",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Sloj nije dostupan",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Sloj može biti povrenemo nedostupan nekoliko sledećih dana",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/sr",function(){}),Oskari.registerLocalization({lang:"sl",key:"LayerSelector",value:{title:"Sloji karte",desc:"",errors:{title:"Napaka!",generic:"Sistemska napaka! Prosim poskusi kasneje.",loadFailed:"Napaka v nalaganju slojev karte. Osveži stran v brskalniku in izberi sloje karte.",noResults:"Iskanje ni vrnilo rezultatov.",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Nalaganje...",filter:{text:"Išči sloje karte",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Po temi",organization:"Po ponudniku podatkov",published:"Uporabniki",didYouMean:"NOT TRANSLATED"},published:{organization:"Objavljen sloj karte",inspire:"Objavljen sloj karte"},tooltip:{"type-base":"Karta za ozadje","type-wms":"Sloj karte","type-wfs":"Podatkovni poizvod"},backendStatus:{OK:{tooltip:"Sloj karte je trenutno na voljo",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Sloj karte trenutno ni na voljo",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Sloj karte v naslednjih dneh občasno ne bo na voljo",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/sl",function(){}),Oskari.registerLocalization({lang:"sk",key:"LayerSelector",value:{title:"Mapové vrstvy",desc:"",errors:{title:"Chyba!",generic:"Chyba systému| Skúste neskôr, prosím",loadFailed:"Chyba pri načítavaní mapových vrstiev| Obnovte stránku Vášho prehliadača a vyberte mapové vrstvy",noResults:"Nenašli sa požadované výsledky",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Načítavanie...",filter:{text:"Hľadať mapové vrstvy",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Podľa motívu",organization:"Podľa poskytovateľov údajov",published:"Používatelia",didYouMean:"NOT TRANSLATED"},published:{organization:"Zverejnená mapová vrstva",inspire:"Zverejnená mapová vrstva"},tooltip:{"type-base":"Podkladová mapa","type-wms":"Mapová vrstva","type-wfs":"Údaje o produkte"},backendStatus:{OK:{tooltip:"Mapová vrstva je momentálne dostupná",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Mapová vrstva je momentálne nedostupná",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"V nasledujúcich dňoch môže byť mapová vrstva pravidelne nedostupná",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/sk",function(){}),Oskari.registerLocalization({lang:"sq",key:"LayerSelector",value:{title:"Shtresa e hartës",desc:"",errors:{title:"Gabim!",generic:"Gabim i sistemit! Ju lutem provoni më vonë",loadFailed:"Gabim në ngrakimin e shtresave të hartësI Ringarko faqen në shfletuesin tuaj dhe zgjedh shtresat e hartës",noResults:"Kërkimi u përfundua pa rezultate",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Ngarkim...",filter:{text:"Kërko në shtresat e hartës",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"Sipas temës (subjektit)",organization:"Sipas ofruesve të të dhënave",published:"Përdoruesit",didYouMean:"NOT TRANSLATED"},published:{organization:"Shtresa e hartës së publikuar",inspire:"Shtresa e hartës së publikuar"},tooltip:{"type-base":"Harta në sfond","type-wms":"Shtresa e hartës","type-wfs":"Produkti i të dhënave"},backendStatus:{OK:{tooltip:"Shtresa e hartës aktualisht është në dispozicion",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"Shtresa e hartës aktualisht nuk është në dispozicion",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Shtresa e hartës gjatë disa ditëve të ardhshme herë pas here mund të mos jetë në dispozicion",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/sq",function(){}),Oskari.registerLocalization({lang:"sv",key:"LayerSelector",value:{title:"Kartlager",desc:"",errors:{title:"Fel!",generic:"Systemfel. Försök på nytt senare.",loadFailed:"Fel i laddningen av kartlager. Ladda ned sidan på nytt i din läsare och välj kartlagren.",noResults:"ökningen gav inga resultat.",noResultsForKeyword:"Ökningen gav inga nyckelorden.",minChars:"Minsta längd är 4 bokstäver."},loading:"Söker...",filter:{text:"Sök kartlager",keywordsTitle:"Nyckerord:",shortDescription:"Sök kartlager efter namn, producent och nyckelord.",description:"Du kan söka kartlager genom att skriva några bokstäver som ingår i namnet, producent eller beskrivande nyckelord av den dataprodukt. Nyckelordsök börjär när du har skrivit minst 4 bokstäver.",inspire:"Enligt tema",organization:"Enligt dataproducent",published:"Användare",didYouMean:"Menade du:"},published:{organization:"Publicerad kartlager",inspire:"Publicerad kartlager"},tooltip:{"type-base":"Bakgrundskarta","type-wms":"kartlager","type-wfs":"Dataprodukt"},backendStatus:{OK:{tooltip:"Kartlagret är tillgängligt just nu.",iconClass:"backendstatus-ok"},DOWN:{tooltip:"Kartlagret är inte tillgängligt just nu.",iconClass:"backendstatus-down"},MAINTENANCE:{tooltip:"Avbrott i kartlagrets tillgänglighet är att vänta inom de närmaste dagarna.",iconClass:"backendstatus-maintenance"},UNKNOWN:{tooltip:"",iconClass:"backendstatus-ok"}},buttons:{ok:"OK"},types:{syn:"Synonym",lk:"Relaterat begrepp",vk:"Sidobegrepp",ak:"Underordnad begrepp",yk:"Överordnad begrepp"}}}),define("bundles/framework/bundle/layerselector2/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"LayerSelector",value:{title:"Шари карти",desc:"",errors:{title:"Помилка!",generic:"Системна помилка| Будь ласка, спробуйте ще раз пізніше",loadFailed:"Помилка при завантаженні шарів карти| Перезавантажте сторінку і оберіть шари",noResults:"Нічого не знайдено",noResultsForKeyword:"NOT TRANSLATED",minChars:"NOT TRANSLATED"},loading:"Завантаження…",filter:{text:"Пошук шарів карти",keywordsTitle:"NOT TRANSLATED",shortDescription:"NOT TRANSLATED",description:"NOT TRANSLATED",inspire:"За темою",organization:"За постачальником",published:"Користувачі",didYouMean:"NOT TRANSLATED"},published:{organization:"Опубліковані шари карти",inspire:"Опубліковані шари карти"},tooltip:{"type-base":"Основна карта","type-wms":"Шар карти","type-wfs":"Продукт"},backendStatus:{OK:{tooltip:"Шар карти доступний",iconClass:"NOT TRANSLATED"},DOWN:{tooltip:"На даний момент шар карти недоступний",iconClass:"NOT TRANSLATED"},MAINTENANCE:{tooltip:"Шар карти може бути тимчасово недоступний протягом наступних декількох днів",iconClass:"NOT TRANSLATED"},UNKNOWN:{tooltip:"",iconClass:"NOT TRANSLATED"}},buttons:{ok:"NOT TRANSLATED"},types:{syn:"NOT TRANSLATED",lk:"NOT TRANSLATED",vk:"NOT TRANSLATED",ak:"NOT TRANSLATED",yk:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/layerselector2/locale/uk",function(){}),define("src/framework/layerselector2/module",["oskari","jquery","bundles/framework/bundle/layerselector2/instance","bundles/framework/bundle/layerselector2/Flyout","bundles/framework/bundle/layerselector2/Tile","bundles/framework/bundle/layerselector2/model/LayerGroup","bundles/framework/bundle/layerselector2/view/Layer","bundles/framework/bundle/layerselector2/view/LayersTab","bundles/framework/bundle/layerselector2/view/PublishedLayersTab","css!resources/framework/bundle/layerselector2/css/style.css","bundles/framework/bundle/layerselector2/locale/hy","bundles/framework/bundle/layerselector2/locale/bg","bundles/framework/bundle/layerselector2/locale/cs","bundles/framework/bundle/layerselector2/locale/da","bundles/framework/bundle/layerselector2/locale/de","bundles/framework/bundle/layerselector2/locale/en","bundles/framework/bundle/layerselector2/locale/es","bundles/framework/bundle/layerselector2/locale/et","bundles/framework/bundle/layerselector2/locale/fi","bundles/framework/bundle/layerselector2/locale/ka","bundles/framework/bundle/layerselector2/locale/el","bundles/framework/bundle/layerselector2/locale/hr","bundles/framework/bundle/layerselector2/locale/hu","bundles/framework/bundle/layerselector2/locale/lv","bundles/framework/bundle/layerselector2/locale/nl","bundles/framework/bundle/layerselector2/locale/pl","bundles/framework/bundle/layerselector2/locale/pt","bundles/framework/bundle/layerselector2/locale/sr","bundles/framework/bundle/layerselector2/locale/sl","bundles/framework/bundle/layerselector2/locale/sk","bundles/framework/bundle/layerselector2/locale/sq","bundles/framework/bundle/layerselector2/locale/sv","bundles/framework/bundle/layerselector2/locale/uk"],function(e){return e.bundleCls("layerselector2").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance");
return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"LayerSelection",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=this.conf,n=(i?i.sandbox:null)||"sandbox",a=Oskari.getSandbox(n);e.sandbox=a,this.localization=Oskari.getLocalization(this.getName()),a.register(e);for(t in e.eventHandlers)e.eventHandlers.hasOwnProperty(t)&&a.registerForEventByName(e,t);var r=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,r),e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!1)},AfterMapLayerAddEvent:function(e){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!0,e.getKeepLayersOrder())},MapLayerEvent:function(e){var t,i=this.sandbox.getService("Oskari.mapframework.service.MapLayerService"),n=e.getLayerId();"update"===e.getOperation()?(t=i.findMapLayer(n),this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(t)):"sticky"===e.getOperation()&&(t=i.findMapLayer(n),this.plugins["Oskari.userinterface.Flyout"].handleLayerSticky(t))},MapLayerVisibilityChangedEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerVisibilityChanged(e.getMapLayer(),e.isInScale(),e.isGeometryMatch())},AfterChangeMapLayerOpacityEvent:function(e){e._creator!==this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerOpacityChanged(e.getMapLayer())},AfterChangeMapLayerStyleEvent:function(e){e._creator!==this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerStyleChanged(e.getMapLayer())},AfterRearrangeSelectedMapLayerEvent:function(e){e._creator!==this.getName()&&(this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerOrderChanged(e._movedMapLayer,e._fromPosition,e._toPosition))},"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()===t.getName()){"close"!==e.getViewState()}}},stop:function(){var e,t=this.sandbox;for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/layerselection2/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateLayer=null,this.templateLayerTools=null,this.templateLayerOutOfScale=null,this.templateLayerOutOfContentArea=null,this.sortableBinded=!1,this._sliders={},this.WFS_TYPE="WFS",this.ANALYSIS_TYPE="ANALYSIS"},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("layerselection2")||jQuery(this.container).addClass("layerselection2")},startPlugin:function(){var e,t,i=this.instance.getLocalization("layer");this.template=jQuery('<ul class="selectedLayersList sortable" data-sortable=\'{itemCss: "li.layer.selected", handleCss: "div.layer-title" }\'></ul>'),this.templateLayer=jQuery('<li class="layerselection2 layer selected"><div class="layer-info"><div class="layer-icon"></div><div class="layer-tool-remove"></div><div class="layer-title"><h4></h4></div></div><div class="stylesel"><label for="style">'+i.style+'</label><select name="style"></select></div><div class="layer-tools volatile"></div></li>'),this.templateLayerFooterTools=jQuery('<div class="right-tools"><div class="layer-rights"></div><div class="object-data"></div><div class="layer-description"><div class="icon-info"></div></div><div class="layer-filter"></div></div><div class="left-tools"><div class="layer-visibility"><a href="JavaScript:void(0);">'+i.hide+'</a>&nbsp;<span class="temphidden" style="display: none;">'+i.hidden+'</span></div><div class="oskariui layer-opacity"><div class="layout-slider" id="layout-slider"></div> <div class="opacity-slider" style="display:inline-block"><input type="text" name="opacity-slider" class="opacity-slider opacity" id="opacity-slider" />%</div></div></div>'),this.templateLayerFooterHidden=jQuery('<p class="layer-msg"><a href="JavaScript:void(0);">'+i.show+"</a> "+i.hidden+"</p>"),this.templateLayerFooterOutOfScale=jQuery('<p class="layer-msg">'+i["out-of-scale"]+' <a href="JavaScript:void(0);">'+i["move-to-scale"]+"</a></p>"),this.templateLayerFooterOutOfContentArea=jQuery('<p class="layer-msg">'+i["out-of-content-area"]+' <a href="JavaScript:void(0);">'+i["move-to-content-area"]+"</a></p>"),e=this.container.parentElement.parentElement,t=jQuery(e).find(".oskari-flyouttoolbar").find(".oskari-flyouttools").find(".oskari-flyouttool-close"),t.attr("id","oskari_layerselection2_flyout_oskari_flyouttool_close")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=this.template.clone();t.append(i);var n,a,r,s=e.instance.getSandbox(),o=s.findAllSelectedMapLayers(),l=s.getMap().getScale();for(n=o.length-1;n>=0;--n)a=o[n],r=this._createLayerContainer(a),i.append(r),this._appendLayerFooter(r,a,a.isInScale(l),!0);i.sortable({stop:function(t,i){var n=i.item;e._layerOrderChanged(n)}}),this.sortableBinded||(this.sortableBinded=!0)},_appendLayerFooter:function(e,t,i,n){var a=e.find("div.layer-tools"),r=this._createLayerFooter(t,e);if(t.isVisible())if(i)if(n)r.css("display","");else{var s=this._createLayerFooterOutOfContentArea(t);a.addClass("out-of-content"),r.css("display","none"),a.append(s)}else{var o=this._createLayerFooterOutOfScale(t);a.addClass("out-of-scale"),r.css("display","none"),a.append(o)}else a.addClass("hidden-layer"),r.css("display","none"),a.append(this._createLayerFooterHidden(t));a.append(r);{var l=e.find("div.layer-opacity input.opacity");this._addSlider(t,e,l)}},_addSlider:function(e,t,i){var n=this,a=e.getId(),r=e.getOpacity(),s=t.find(".layout-slider"),o=s.slider({min:0,max:100,value:r,slide:function(t,i){n._layerOpacityChanged(e,i.value)},stop:function(t,i){n._layerOpacityChanged(e,i.value)}});return n._sliders[a]=o,i&&(i.attr("value",e.getOpacity()),i.on("change paste keyup",function(){n._layerOpacityChanged(e,jQuery(this).val())})),o},_layerOrderChanged:function(e){var t=jQuery(this.container).find(".selectedLayersList li.layerselection2"),i=e.attr("layer_id"),n=-1;if(t.each(function(e){return $(this).attr("layer_id")==i?(n=e,!1):!0}),n>-1){n=t.length-1-n;var a=this.instance.getSandbox(),r="RearrangeSelectedMapLayerRequest",s=a.getRequestBuilder(r),o=s(i,n);a.request(this.instance.getName(),o)}},_updateStyles:function(e,t){var i=this,n=i.instance.getSandbox(),a=t.find("div.stylesel");if(a.hide(),e.getStyles&&e.getStyles().length>1){var r,s,o=!1,l=e.getStyles(),u=a.find("select");for(u.empty(),r=0;r<l.length;r++)s=jQuery('<option value="'+l[r].getName()+'">'+l[r].getTitle()+"</option>"),u.append(s),o=!0;u.hasClass("binded")||(u.change(function(){var t=u.find("option:selected").val();e.selectStyle(t);var a=n.getRequestBuilder("ChangeMapLayerStyleRequest"),r=a(e.getId(),t);n.request(i.instance.getName(),r)}),u.addClass("binded")),o&&(e.getCurrentStyle()&&u.val(e.getCurrentStyle().getName()),u.trigger("change"),a.show())}},_createLayerContainer:function(e){var t=this,i=t.instance.getSandbox(),n="ChangeMapLayerOpacityRequest",a=(i.getRequestBuilder(n),e.getId()),r=(e.getOpacity(),this.templateLayer.clone());r.attr("layer_id",a),r.find("div.layer-title h4").append(e.getName()),r.find("div.layer-title").append(e.getDescription()),this._updateStyles(e,r);var s=this.instance.getLocalization("layer").tooltip,o=r.find("div.layer-icon");return o.addClass(e.getIconClassname()),e.isBaseLayer()?o.attr("title",s["type-base"]):e.isLayerOfType("WMS")?o.attr("title",s["type-wms"]):e.isLayerOfType("WMTS")?o.attr("title",s["type-wms"]):e.isLayerOfType("WFS")?o.attr("title",s["type-wfs"]):e.isLayerOfType("VECTOR")&&o.attr("title",s["type-wms"]),e.isSticky()||(r.find("div.layer-tool-remove").addClass("icon-close"),r.find(".layer-tool-remove").attr("id","oskari_layerselection_layercontainer_icon_close_layerId"+a),r.find("div.layer-tool-remove").bind("click",function(){var n="RemoveMapLayerRequest",a=i.getRequestBuilder(n),r=a(e.getId());i.request(t.instance.getName(),r)})),r},handleLayerOrderChanged:function(e,t,i){if(!e)throw"handleLayerOrderChanged: No layer provided";if(isNaN(t))throw"handleLayerOrderChanged: fromPosition is Not a Number: "+t;if(isNaN(i))throw"handleLayerOrderChanged: toPosition is Not a Number: "+i;if(t!==i){var n=this,a=jQuery(n.container).find("ul.selectedLayersList"),r=a.find("> li").length,s=r-t,o=r-i,l=a.find("> li:nth-child("+s+")").detach();1===o?a.prepend(l):o===r?a.append(l):a.find("> li:nth-child("+o+")").before(l)}},handleLayerVisibilityChanged:function(e,t,i){var n=this,a=(n.instance.getSandbox(),"li.layerselection2.layer.selected[layer_id="+e.getId()+"]"),r=jQuery(this.container).find(a),s=(this.instance.getLocalization("layer"),r.find("div.layer-tools"));s.empty(),r.removeClass("hidden-layer"),r.removeClass("out-of-scale"),r.removeClass("out-of-content"),this._sliders[e.getId()]=null,this._appendLayerFooter(r,e,t,i)},_layerOpacityChanged:function(e,t){var i=this.instance.getSandbox(),n="ChangeMapLayerOpacityRequest",a=i.getRequestBuilder(n),r=a(e.getId(),t);i.request(this.instance.getName(),r),this._changeOpacityInput(e)},_changeOpacityInput:function(e){var t="li.layerselection2.layer.selected[layer_id="+e.getId()+"]",i=jQuery(this.container).find(t),n=i.find("div.layer-opacity input.opacity"),a=i.find(".layout-slider");n.attr("value",e.getOpacity()),a.slider("value",e.getOpacity())},handleLayerOpacityChanged:function(e){this._sliders[e.getId()]&&(this._sliders[e.getId()].slider("value",e.getOpacity()),this._changeOpacityInput(e))},handleLayerStyleChanged:function(e){var t="li.layer.selected[layer_id="+e.getId()+"]",i=jQuery(this.container).find(t),n=i.find("div.stylesel select");n.val(e.getCurrentStyle().getName())},_createLayerFooterOutOfScale:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterOutOfScale.clone();n.addClass("layer-msg-for-outofscale");var a="MapModulePlugin.MapMoveByLayerContentRequest",r=i.getRequestBuilder(a);return n.find("a").bind("click",function(){var n=r(e.getId());return i.request(t.instance.getName(),n),!1}),n},_createLayerFooterHidden:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterHidden.clone();n.addClass("layer-msg-for-hidden");var a="MapModulePlugin.MapLayerVisibilityRequest",r=i.getRequestBuilder(a);return n.find("a").bind("click",function(){var n=r(e.getId(),!0);return i.request(t.instance.getName(),n),!1}),n},_createLayerFooterOutOfContentArea:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterOutOfContentArea.clone();n.addClass("layer-msg-for-outofcontentarea");var a="MapModulePlugin.MapMoveByLayerContentRequest",r=i.getRequestBuilder(a);return n.find("a").bind("click",function(){var n=r(e.getId());return i.request(t.instance.getName(),n),!1}),n},_createLayerFooter:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterTools.clone(),a=this.instance.getLocalization("layer"),r="MapModulePlugin.MapLayerVisibilityRequest",s=i.getRequestBuilder(r);e.isSticky()&&n.find("div.layer-visibility").hide(),n.find("div.layer-visibility a").bind("click",function(){var n=s(e.getId(),!1);return i.request(t.instance.getName(),n),!1});var o=!1;if(!e.getMetadataIdentifier()){var l=e.getSubLayers();if(l&&l.length>0)for(o=!0,h=0;h<l.length;h+=1)if(subUuid=l[h].getMetadataIdentifier(),!subUuid||""===subUuid){o=!1;break}o||n.find("div.layer-description").hide()}if((e.getMetadataIdentifier()||o)&&n.find("div.icon-info").bind("click",function(){var t="catalogue.ShowMetadataRequest",n=e.getMetadataIdentifier(),a=[],r={};r[n]=!0;var s,o,l=e.getSubLayers();if(l&&l.length>0)for(s=0;s<l.length;s++)o=l[s].getMetadataIdentifier(),o&&""!==o&&!r[o]&&(r[o]=!0,a.push({uuid:o}));i.postRequestByName(t,[{uuid:n},a])}),e.isLayerOfType(t.WFS_TYPE)||e.isLayerOfType(t.ANALYSIS_TYPE)){var u={bboxSelection:!0,clickedFeaturesSelection:!1},c=Oskari.clazz.create("Oskari.userinterface.component.FilterDialog",a,u),d=n.find("div.layer-filter");d.addClass("icon-funnel"),d.bind("click",function(){var i=jQuery(this);i.hasClass("icon-funnel")&&(c.createFilterDialog(e),c.setUpdateButtonHandler(function(i){var n=t.instance.sandbox.getEventBuilder("WFSSetPropertyFilter")(i,e.getId());t.instance.sandbox.notifyAll(n)}))})}var h,p,f,m=function(e){return function(){return e.getCallback()(),!1}},g=e.getTools();for(h=0;h<g.length;h++)p=g[h],p&&(p.getIconCls()?(f=jQuery("<div></div>"),f.addClass(p.getIconCls()),f.attr("title",p.getTooltip()),n.find("div.object-data").append(f),f.bind("click",m(p))):(f=jQuery('<a href="JavaScript:void(0);"></a>'),f.append(p.getTitle()),n.find("div.object-data").append(f),f.bind("click",m(p))));return this._updatePublishPermissionText(e,n),n},_updatePublishPermissionText:function(e,t){var i=this.instance.getSandbox(),n=this.instance.getLocalization("layer"),a=e.getPermission("publish");"publication_permission_ok"==a&&i.getUser().isLoggedIn()&&(t.find("div.layer-rights").html(n.rights.can_be_published_map_user.label),t.find("div.layer-rights").attr("title",n.rights.can_be_published_map_user.tooltip))},handleLayerSelectionChanged:function(e,t,i){if(t){var n=this,a=n.instance.getSandbox(),r=a.getMap().getScale(),s=jQuery("ul.selectedLayersList"),o=this._createLayerContainer(e),l=(o.find("div.layer-tools"),[]);l=s.find(e.isBaseLayer()&&!i?"li.layerselection2[layer_id^=base_]":".layerselection2.layer.selected"),l.length>0?e.isBaseLayer()&&!i?l.last().after(o):l.first().before(o):s.append(o),this._appendLayerFooter(o,e,e.isInScale(r),!0)}else{var u=jQuery(this.container).find("li.layerselection2[layer_id="+e.getId()+"]");u&&(this._sliders[e.getId()]=null,u.remove())}},handleLayerModified:function(e){var t=this,i=jQuery(t.container).find("li.layerselection2[layer_id="+e.getId()+"]"),n=this.instance.getSandbox().getMap().getScale();newDiv=this._createLayerContainer(e),i.replaceWith(newDiv),this._appendLayerFooter(newDiv,e,e.isInScale(n),!0)},handleLayerSticky:function(e){var t=this,i=jQuery(t.container).find("li.layerselection2[layer_id="+e.getId()+"]");i.find("div.layer-tool-remove").removeClass("icon-close")},refresh:function(){var e,t,i=this,n=i.instance.getSandbox(),a=n.findAllSelectedMapLayers();for(e=a.length-1;e>=0;--e)t=a[e],this.handleLayerOpacityChanged(t)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/layerselection2/Flyout",function(){}),define("src/framework/layerselection2/Flyout",["jquery","bundles/framework/bundle/layerselection2/Flyout"],function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Tile",function(e){this.instance=e,this.container=null,this.template=null,this.shownLayerCount=null},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},notifyUser:function(){var e=this.container.children(".oskari-tile-status");e.stop(),this._blink(e,2)},_blink:function(e,t){var i=this;e&&(t||(t=1),e.animate({opacity:.25},500,function(){e.animate({opacity:1},500,function(){t>1&&i._blink(e,--t)})}))},refresh:function(){var e=this,t=e.instance,i=this.container,n=(this.template,t.getSandbox()),a=n.findAllSelectedMapLayers(),r=a.length,s=this.container.children(".oskari-tile-status");s.addClass("icon-bubble-right"),s.attr("id","oskari_layerselection2_tile_countselectedlayers"),s.html(r);var o=i.children(".oskari-tile-title");o.attr("id","oskari_layerselection2_tile_title"),this.notifyUser()}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/layerselection2/Tile",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/layerselection2/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"LayerSelection",value:{title:"Valitut tasot",desc:"",layer:{style:"Tyyli",show:"Näytä",hide:"Piilota",hidden:"Karttataso on tilapäisesti piilotettu.","out-of-scale":"Karttatasoa ei voida näyttää valitulla mittakaavatasolla.","move-to-scale":"Siirry sopivalle mittakaavatasolle.","out-of-content-area":"Tällä karttatasolla ei ole aineistoa tässä sijainnissa","move-to-content-area":"Paikanna",description:"Kuvaus","object-data":"Kohdetiedot",rights:{notavailable:"Ei julkaistavissa",guest:"Kirjaudu sisään julkaistaksesi karttatason",loggedin:"Julkaistavissa",official:"Julkaistavissa viranomaiskäyttöön.","need-login":"Karttatason voi julkaista upotetussa kartassa ainoastaan viranomaiskäyttöön. Mikäli olet viranomainen, ota yhteyttä Paikkatietoikkunan tukipalveluun ja pyydä julkaisuoikeuksia.",can_be_published_by_provider:{label:"Julkaistavissa tiedontuottajana",tooltip:"Ainoastaan tiedontuottajat voivat julkaista karttatason upotetussa kartassa. Mikäli olet tiedontuottaja, ota yhteyttä Paikkatietoikkunan tukipalveluun ja pyydä julkaisuoikeuksia."},can_be_published:{label:"Julkaistavissa",tooltip:"Karttatason voi julkaista upotetussa kartassa ilman käyttömäärärajoituksia."},can_be_published_map_user:{label:"Julkaistavissa",tooltip:"Karttatason voi julkaista upotetussa kartassa. Viikoittainen käyttömäärä voi olla rajoitettu."},no_publication_permission:{label:"Ei julkaistavissa",tooltip:"Karttatasoa ei voi julkaista upotetussa kartassa, koska julkaisulle ei ole tiedontuottajan lupaa."},can_be_published_by_authority:{label:"Julkaistavissa",tooltip:"Karttatason voi julkaista upotetussa kartassa ilman käyttömäärärajoituksia."}},tooltip:{"type-base":"Taustakartta","type-wms":"Karttataso","type-wfs":"Tietotuote"},filter:{title:"Suodatus",description:"Valitse kohteet tasolta:",cancelButton:"Poistu",clearButton:"Tyhjennä suodatin",refreshButton:"Päivitä suodatin",addFilter:"Lisää uusi suodatin.",removeFilter:"Poista suodatin.",bbox:{title:"Ikkunarajaus",on:"Ota mukaan vain kartalla näkyvät kohteet.",off:"Ota mukaan kaikki kohteet."},clickedFeatures:{title:"Kohderajaus",label:"Ota mukaan vain kartalta valitut kohteet."},values:{title:"Suodata kohteet ominaisuustietojen perusteella",placeholders:{"case-sensitive":"Kirjainkoko vaikuttaa valintoihin.",attribute:"Ominaisuustieto","boolean":"Looginen operaattori",operator:"Operaattori","attribute-value":"Arvo"},equals:"on yhtäsuuri kuin",like:"on likimäärin yhtäsuuri kuin",notEquals:"on erisuuri kuin",notLike:"on likimäärin erisuuri kuin",greaterThan:"on suurempi kuin",lessThan:"on pienempi kuin",greaterThanOrEqualTo:"on suurempi tai yhtä suuri kuin",lessThanOrEqualTo:"on pienempi tai yhtä pieni kuin"},validation:{title:"Seuraavat virheet estivät suodattimen päivityksen:",attribute_missing:"Ominaisuustieto puuttuu.",operator_missing:"Operaattori puuttuu.",value_missing:"Arvo puuttuu.",boolean_operator_missing:"Looginen operaattori puuttuu."}}}}}),define("bundles/framework/bundle/layerselection2/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"LayerSelection",value:{title:"Valda kartlager",desc:"",layer:{style:"Stil",show:"Visa",hide:"Göm",hidden:"Kartan är tillfälligt gömd.","out-of-scale":"Data som ingår i detta kartlager kan inte visas på den valda skalnivån.","move-to-scale":"Gå till en lämplig skalnivå.","out-of-content-area":"Detta kartlager saknar innehåll vid dessa koordinater.","move-to-content-area":"Lokalisera",description:"Beskrivning","object-data":"Objektuppgifter",rights:{notavailable:"Får inte publiceras.",guest:"Logga in för att avskilja och inbädda detta kartlager.",loggedin:"Får publiceras",official:"Får publiceras för myndighetsbruk.","need-login":"Du måste logga in.",can_be_published_by_provider:{label:"Får publiceras av dataproducenter",tooltip:"För att publicera detta kartlager krävs dataproducenträttigheter. Om du är dataproducent, kontakta Paikkatietoikkunas stödtjänst och be om publiceringsrättigheter."},can_be_published:{label:"Får publiceras",tooltip:"Kartlagret får publiceras i ett inbäddat kartfönster utan att begränsa antalet användare."},can_be_published_map_user:{label:"Får publiceras",tooltip:"Kartlagret får publiceras i ett inbäddat kartfönster. Antalet användare per vecka kan vara begränsat."},no_publication_permission:{label:"Får inte publiceras.",tooltip:"Dataproducenten har inte beviljat tillstånd att publicera kartlagret i ett inbäddat kartfönster."},can_be_published_by_authority:{label:"Får publiceras",tooltip:"Kartlagret får publiceras i ett inbäddat kartfönster utan användningsbegränsningar."}},tooltip:{"type-base":"Bakgrundskarta","type-wms":"Kartlager","type-wfs":"Dataprodukt"}}}}),define("bundles/framework/bundle/layerselection2/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"LayerSelection",value:{title:"Selected Layers",desc:"",layer:{style:"Style",show:"Show",hide:"Hide",hidden:"The map layer has been temporarily hidden.","out-of-scale":"The map layer cannot be shown at this scale level.","move-to-scale":"Please move to a suitable scale level.","out-of-content-area":"The map layer contains no data at this location.","move-to-content-area":"Please move to a suitable location.",description:"Description","object-data":"Feature data",rights:{notavailable:"Publication prohibited.",guest:"Please log in to publish the map layer in an embedded map.",loggedin:"Publication permitted",official:"Publication permitted only for use by authorities.","need-login":"You need to log in to publish the map level in an embedded map.",can_be_published_by_provider:{label:"Publication permitted as a data provider",tooltip:"Only the data provider can publish the map layer in an embedded map.  If you are a data provider, please contact the support service of Paikkatietoikkuna."},can_be_published:{label:"Publication permitted",tooltip:"The map layer can be published in an embedded map. The limit of the usage is not limited."},can_be_published_map_user:{label:"Publication permitted",tooltip:"The map layer can be published in an embedded map. The limit of the usage may be limited."},no_publication_permission:{label:"Publication prohibited",tooltip:"The map layer cannot be published in an embedded map. The data provider has not granted permission to that."},can_be_published_by_authority:{label:"Publication permitted",tooltip:"The map layer can be published in an embedded map. The limit of the usage is not limited."}},tooltip:{"type-base":"Background map","type-wms":"Map layer","type-wfs":"Data product"}}}}),define("bundles/framework/bundle/layerselection2/locale/en",function(){}),Oskari.registerLocalization({lang:"cs",key:"LayerSelection",value:{title:"Vybrané vrstvy",desc:"",layer:{style:"Styl",show:"Zobrazit",hide:"Skrýt",hidden:"Mapa byla dočasně skryta.","out-of-scale":"Data této mapové vrstvy nemohou být zobrazena ve zvolené úrovni měřítka.","move-to-scale":"Přibliž do vhodné úrovně měřítka.","out-of-content-area":"V této lokalitě neobsahuje mapová vrstva žádná data.","move-to-content-area":"Přesuň do středu plochy rozsahu.",description:"Popis","object-data":"Objektová data",rights:{notavailable:"Publikace zakázána",guest:"Pro publikaci této mapové vrstvy se přihlaste.",loggedin:"Publikace povolena",official:"Publikace povolena pro použití úřady.","need-login":"Musíte se přihlásit.",can_be_published_by_provider:{label:"Publikace povolena pro poskytovatele dat.",tooltip:"Pro publikaci této mapové vrstvy potřebujete práva poskytovatelů dat. Pokud jste poskytovatel dat, kontaktujte prosím podporu a požadujte práva pro publikaci."},can_be_published:{label:"Publikace povolena",tooltip:"Mapová vrstva může být publikována ve vloženém mapovém okně bez omezení počtu uživatelů."},can_be_published_map_user:{label:"Publikace povolena",tooltip:"Mapová vrstva může být publikována ve vloženém mapovém okně a počet uživatelů za týden může být omezen."},no_publication_permission:{label:"Publikace zakázána",tooltip:"Poskytovatel dat nepovolil publikaci této mapové vrstvy ve vloženém mapovém okně."},can_be_published_by_authority:{label:"Publikace povolena",tooltip:"Mapová vrstva může být publikována ve vloženém mapovém okně bez omezení."}},tooltip:{"type-base":"Mapa pozadí","type-wms":"Mapová vrstva","type-wfs":"Datový produkt"}}}}),define("bundles/framework/bundle/layerselection2/locale/cs",function(){}),Oskari.registerLocalization({lang:"de",key:"LayerSelection",value:{title:"Ausgewählte Ebenen",desc:"",layer:{style:"Ansicht",show:"Zeige",hide:"Verberge",hidden:"Diese Karte wurde vorübergehend ausgeblendet.","out-of-scale":"Die Daten der Kartenebenen können in diesem Maßstab nicht angezeigt werden.","move-to-scale":"Zu einem geeigneten Maßstab wechseln.","out-of-content-area":"Die Kartenebene enthält an dieser Position keine Daten.","move-to-content-area":"Direkt zum Mittelpunkt der Daten begeben.",description:"Beschreibung","object-data":"Objektdaten",rights:{notavailable:"Veröffentlichung untersagt.",guest:"Melden Sie sich an, um diese Kartenebene zu veröffentlichen.",loggedin:"Veröffentlichung erlaubt",official:"Veröffentlichung für die Nutzung durch Behörden zulässig.","need-login":"Sie müssen sich anmelden.",can_be_published_by_provider:{label:"Veröffentlichung erlaubt für Datenanbieter.",tooltip:"Es werden Datenanbieter-Rechte benötigt, um diese Kartenebene zu veröffentlichen. Sollten Sie ein Datenanbieter sein, kontaktieren Sie bitte den Support-Service und fordern Sie die Veröffentlichungsrechte an."},can_be_published:{label:"Veröffentlichung erlaubt",tooltip:"Die Kartenebene darf ohne eine Begrenzung der Nutzeranzahl in einem eingebundenen Kartenfenster veröffentlicht werden."},can_be_published_map_user:{label:"Veröffentlichung erlaubt",tooltip:"Die Kartenebene darf mit einer eventuellen Begrenzung der Nutzeranzahl pro Woche in einem eingebundenen Kartenfenster veröffentlicht werden."},no_publication_permission:{label:"Veröffentlichung untersagt",tooltip:"Der Datenanbieter hat keine Genehmigung zur Veröffentlichung der Kartenebene in einem eingebundenen Kartenfenster gegeben."},can_be_published_by_authority:{label:"Veröffentlichung erlaubt",tooltip:"Die Kartenebene darf in einem eingebundenen Kartenfenster ohne Nutzungsbeschränkungen veröffentlicht werden."}},tooltip:{"type-base":"Hintergrundkarte","type-wms":"Kartenebene","type-wfs":"Datenprodukt"}}}}),define("bundles/framework/bundle/layerselection2/locale/de",function(){}),Oskari.registerLocalization({lang:"es",key:"LayerSelection",value:{title:"Capas seleccionadas",desc:"",layer:{style:"Estilo",show:"Mostrar",hide:"Ocultar",hidden:"Se ha ocultado el mapa temporalmente","out-of-scale":"No pueden mostrarse los datos de esta capa a la escala seleccionada","move-to-scale":"Ir a un nivel de escala adecuado","out-of-content-area":"La capa no contiene datos para esta localización","move-to-content-area":"Moverse al centro del área del contenido",description:"Descripción","object-data":"Datos del objeto",rights:{notavailable:"Publicación no permitida",guest:"Identificarse para publicar esta capa",loggedin:"Publicación permitida",official:"Publicación permitida para el uso mediante autorización","need-login":"Debe identificarse",can_be_published_by_provider:{label:"Publicación permitida para proveedores de datos",tooltip:"Se requieren derechos de proveedor de datos para publicar esta capa. Si es un proveedor de datos, por favor, contacte con el servicio de soporte y solicite los derechos para publicar"},can_be_published:{label:"Publicación permitida",tooltip:"La capa puede publicarse en un visualizador incorporado sin límite en el número de usuarios"},can_be_published_map_user:{label:"Publicación permitida",tooltip:"La capa puede publicarse en un visualizador incorporado y el número de usuarios semanales puede limitarse"},no_publication_permission:{label:"Publicación no permitida",tooltip:"El proveedor de datos no ha concedido el permiso para publicar esta capa en un visualizador incorporado"},can_be_published_by_authority:{label:"Publicación permitida",tooltip:"La capa puede publicarse en un visualizador incrustado sin limitaciones de uso"}},tooltip:{"type-base":"Mapa de fondo","type-wms":"Capa","type-wfs":"Producto"}}}}),define("bundles/framework/bundle/layerselection2/locale/es",function(){}),define("src/framework/layerselection2/module",["oskari","jquery","bundles/framework/bundle/layerselection2/instance","./Flyout","bundles/framework/bundle/layerselection2/Tile","css!resources/framework/bundle/layerselection2/css/style.css","bundles/framework/bundle/layerselection2/locale/fi","bundles/framework/bundle/layerselection2/locale/sv","bundles/framework/bundle/layerselection2/locale/en","bundles/framework/bundle/layerselection2/locale/cs","bundles/framework/bundle/layerselection2/locale/de","bundles/framework/bundle/layerselection2/locale/es"],function(e){return e.bundleCls("layerselection2").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance");return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.MapLegendBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"maplegend",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=this.conf,n=(i?i.sandbox:null)||"sandbox",a=Oskari.getSandbox(n);e.sandbox=a,a.register(e);for(t in e.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&a.registerForEventByName(e,t);var r=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,r),e.createUi(),a.registerAsStateful(this.mediator.bundleId,this)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];
if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},AfterMapLayerAddEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},AfterChangeMapLayerStyleEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},AfterRearrangeSelectedMapLayerEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},MapLayerEvent:function(e){"update"===e.getOperation()&&this.plugins["Oskari.userinterface.Flyout"].refresh()}},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.maplegend.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.maplegend.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/maplegend/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.Flyout",function(e){this.instance=e,this.container=null,this.templateLayer=null,this.templateLayerLegend=null,this.state=null},{getName:function(){return"Oskari.mapframework.bundle.maplegend.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("maplegend")||jQuery(this.container).addClass("maplegend")},startPlugin:function(){var e=this;e.templateLayer=jQuery('<div class="maplegend-layer"><div class="maplegend-tools"><div class="layer-description"><div class="icon-info"></div></div></div></div>'),e.templateLayerLegend=jQuery('<div class="maplegend-legend"><img /></div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},setContentState:function(){},getContentState:function(){return{}},createUi:function(){this.refresh()},refresh:function(){this._populateLayerList()},_populateLayerList:function(){var e=this,t=jQuery(this.container);t.empty();var i=Oskari.clazz.create("Oskari.userinterface.component.Accordion");i.insertTo(t);var n,a,r,s,o,l=this.instance.getSandbox(),u=l.findAllSelectedMapLayers().slice(0);for(n=u.length-1;n>=0;n-=1)a=u[n],r=a.getName(),s=this._createLayerContainer(a),o=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),o.open(),o.setTitle(a.getName()),o.getContainer().append(e._createLayerContainer(a)),i.addPanel(o)},_createLayerContainer:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayer.clone(),a={},r=t._createLegendDiv(e,a);r&&n.append(r);var s,o,l,u=e.getSubLayers?e.getSubLayers():null;if(u)for(s=0;s<u.length;s+=1)o=u[s],l=t._createLegendDiv(o,a),l&&n.append(l);var c=e.getMetadataIdentifier(),d=n.find(".maplegend-tools");return c?d.find("div.icon-info").bind("click",function(){var e="catalogue.ShowMetadataRequest";i.postRequestByName(e,[{uuid:c}])}):d.find("div.layer-description").hide(),n},_createLegendDiv:function(e,t){var i=this,n=e.getLegendImage?e.getLegendImage():null;if(n&&""!==n&&!t[n]){var a=i.templateLayerLegend.clone(),r=a.find("img");t[n]=!0;var s=new Image;return s.onload=function(){r.attr("src",n),s.onload=null},s.src=n,a}}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/maplegend/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.maplegend.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/maplegend/Tile",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/maplegend/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"hy",key:"maplegend",value:{title:"Բացատրական մաս",desc:""}}),define("bundles/framework/bundle/maplegend/locale/hy",function(){}),Oskari.registerLocalization({lang:"bg",key:"maplegend",value:{title:"Легенди",desc:""}}),define("bundles/framework/bundle/maplegend/locale/bg",function(){}),Oskari.registerLocalization({lang:"cs",key:"maplegend",value:{title:"Legendy",desc:"Ukázat legendy"}}),define("bundles/framework/bundle/maplegend/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"maplegend",value:{title:"Tegnforklaringer",desc:""}}),define("bundles/framework/bundle/maplegend/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"maplegend",value:{title:"Legendenansicht",desc:"Zeige Legendenansicht"}}),define("bundles/framework/bundle/maplegend/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"maplegend",value:{title:"Map legends",desc:""}}),define("bundles/framework/bundle/maplegend/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"maplegend",value:{title:"Leyenda",desc:""}}),define("bundles/framework/bundle/maplegend/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"maplegend",value:{title:"Legendid",desc:""}}),define("bundles/framework/bundle/maplegend/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"maplegend",value:{title:"Karttaselitteet",desc:""}}),define("bundles/framework/bundle/maplegend/locale/fi",function(){}),Oskari.registerLocalization({lang:"ka",key:"maplegend",value:{title:"ლეგენდები",desc:""}}),define("bundles/framework/bundle/maplegend/locale/ka",function(){}),Oskari.registerLocalization({lang:"el",key:"maplegend",value:{title:"Υπομνήματα",desc:""}}),define("bundles/framework/bundle/maplegend/locale/el",function(){}),Oskari.registerLocalization({lang:"hr",key:"maplegend",value:{title:"Legende",desc:"Prikaži legende karte"}}),define("bundles/framework/bundle/maplegend/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"maplegend",value:{title:"Jelmagyarázatok",desc:""}}),define("bundles/framework/bundle/maplegend/locale/hu",function(){}),Oskari.registerLocalization({lang:"lv",key:"maplegend",value:{title:"Apzīmējumi",desc:""}}),define("bundles/framework/bundle/maplegend/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"maplegend",value:{title:"Legenda's",desc:""}}),define("bundles/framework/bundle/maplegend/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"maplegend",value:{title:"Legenda",desc:""}}),define("bundles/framework/bundle/maplegend/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"maplegend",value:{title:"Legendas",desc:""}}),define("bundles/framework/bundle/maplegend/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"maplegend",value:{title:"Legende",desc:""}}),define("bundles/framework/bundle/maplegend/locale/ro",function(){}),Oskari.registerLocalization({lang:"sr",key:"maplegend",value:{title:"Legenda",desc:""}}),define("bundles/framework/bundle/maplegend/locale/sr",function(){}),Oskari.registerLocalization({lang:"sl",key:"maplegend",value:{title:"Legende",desc:""}}),define("bundles/framework/bundle/maplegend/locale/sl",function(){}),Oskari.registerLocalization({lang:"sk",key:"maplegend",value:{title:"Legendy",desc:""}}),define("bundles/framework/bundle/maplegend/locale/sk",function(){}),Oskari.registerLocalization({lang:"sq",key:"maplegend",value:{title:"Legjenda",desc:""}}),define("bundles/framework/bundle/maplegend/locale/sq",function(){}),Oskari.registerLocalization({lang:"sv",key:"maplegend",value:{title:"Förklaringar",desc:""}}),define("bundles/framework/bundle/maplegend/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"maplegend",value:{title:"Умовні знаки",desc:""}}),define("bundles/framework/bundle/maplegend/locale/uk",function(){}),define("src/framework/maplegend/module",["oskari","jquery","bundles/framework/bundle/maplegend/instance","bundles/framework/bundle/maplegend/Flyout","bundles/framework/bundle/maplegend/Tile","css!resources/framework/bundle/maplegend/css/style.css","bundles/framework/bundle/maplegend/locale/hy","bundles/framework/bundle/maplegend/locale/bg","bundles/framework/bundle/maplegend/locale/cs","bundles/framework/bundle/maplegend/locale/da","bundles/framework/bundle/maplegend/locale/de","bundles/framework/bundle/maplegend/locale/en","bundles/framework/bundle/maplegend/locale/es","bundles/framework/bundle/maplegend/locale/et","bundles/framework/bundle/maplegend/locale/fi","bundles/framework/bundle/maplegend/locale/ka","bundles/framework/bundle/maplegend/locale/el","bundles/framework/bundle/maplegend/locale/hr","bundles/framework/bundle/maplegend/locale/hu","bundles/framework/bundle/maplegend/locale/lv","bundles/framework/bundle/maplegend/locale/nl","bundles/framework/bundle/maplegend/locale/pl","bundles/framework/bundle/maplegend/locale/pt","bundles/framework/bundle/maplegend/locale/ro","bundles/framework/bundle/maplegend/locale/sr","bundles/framework/bundle/maplegend/locale/sl","bundles/framework/bundle/maplegend/locale/sk","bundles/framework/bundle/maplegend/locale/sq","bundles/framework/bundle/maplegend/locale/sv","bundles/framework/bundle/maplegend/locale/uk"],function(e){return e.bundleCls("maplegend").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.maplegend.MapLegendBundleInstance");return t},update:function(){}})}),function(){function e(e,t,i,n,a,r){t[e]&&(i.push(e),(t[e]===!0||1===t[e])&&n.push(a+e+"/"+r))}function t(e,t,i,n,a){var r=n+t+"/"+a;require._fileExists(e.toUrl(r+".js"))&&i.push(r)}function i(e,t,n){var a;for(a in t)!t.hasOwnProperty(a)||e.hasOwnProperty(a)&&!n?"object"==typeof t[a]&&(!e[a]&&t[a]&&(e[a]={}),i(e[a],t[a],n)):e[a]=t[a]}var n=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(a){var r=a.config?a.config():{};return{version:"2.0.4",load:function(a,s,o,l){l=l||{},l.locale&&(r.locale=l.locale);var u,c,d,h=n.exec(a),p=h[1],f=h[4],m=h[5],g=f.split("-"),v=[],y={},b="";if(h[5]?(p=h[1],u=p+m):(u=a,m=h[4],f=r.locale,f||(f=r.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),g=f.split("-")),l.isBuild){for(v.push(u),t(s,"root",v,p,m),c=0;c<g.length;c++)d=g[c],b+=(b?"-":"")+d,t(s,b,v,p,m);s(v,function(){o()})}else s([u],function(t){var n,a=[];for(e("root",t,a,v,p,m),c=0;c<g.length;c++)n=g[c],b+=(b?"-":"")+n,e(b,t,a,v,p,m);s(v,function(){var e,n,r;for(e=a.length-1;e>-1&&a[e];e--)r=a[e],n=t[r],(n===!0||1===n)&&(n=s(p+r+"/"+m)),i(y,n);o(y)})})}}})}(),define("src/framework/guidedtour/nls/locale",{root:{button:{next:"Next",previous:"Previous",start:"Start",finish:"Finish",close:"Close"},title:"Welcome",desc:"",tourseen:{label:"Do not show this message again"},page1:{title:"Welcome to the Paikkatietoikkuna map window",message:"If this is your first visit to the Paikkatietoikkuna map service, our quick start guide will help you to get started."},page2:{title:"Search",message:"Use the search function to move the map view directly to the place you are looking for.",openLink:"Show search",closeLink:"Hide search",tileText:"Search"},page3:{title:"Map layers",message:"You can select the data products to be shown on the map by selecting map layers. Click a category to open it and select a layer or write a few letters that are included in the name of the data product you are looking for in the search field.",openLink:"Show map layers",closeLink:"Hide map layers",tileText:"Map layers"},page4:{title:"Selected map layers",message:"You can change the order in which map layers are displayed by clicking and draging, as well as change their transparency. Changes are shown in the map window.",openLink:"Show selected map layers",closeLink:"Hide selected map layers",tileText:"Selected map layers"},page5:{title:"My data",message:"All of the places which you have marked on the map, your saved map views and embedded maps are displayed here when you are logged in to the service.",openLink:"Show my data",closeLink:"Hide my data",tileText:"My data"},page6:{title:"Create map",message:"You can easily embed a map you have created on your webite. Simply definte the size and user interface of your map and copy and paste a line of HTML-code on your webpage",openLink:"Show create map",closeLink:"Hide create map",tileText:"Create map"},page7:{title:"Tools",message:"Use the tools to add places, save a map view, share a link to a map view or return to an earlier map view. Keep your mouse pointer on top of a tool for a moment to see its tool tip."},page8:{title:"Pan the map view",message:"You can move the view on the map by clicking and dragging or with the panning controls. Return to the default view by clicking the button in the middle of the panning controls. Tip: You can also pan the map with the arrow keys on your keyboard."},page9:{title:"Zoom in and zoom out",message:"You can zoom in and out on the map using the scale scrollbar or the plus and minus buttons next to the scrollbar. Tip: You can also zoom using the plus and minus keys on your keyboard or zoom in by double-clicking the map. It is also possible to zoom with the scroll wheel of your mouse."}},fi:!0,sv:!0}),Oskari.clazz.define("Oskari.framework.bundle.guidedtour.GuidedTourBundleInstance",function(e){this.sandbox=null,this._localization=e,this.mediator=null,this.guideStep=0},{__name:"GuidedTour",getName:function(){return this.__name},getTitle:function(){return this._localization.title},getDescription:function(){return this._localization.desc},getSandbox:function(){return this.sandbox},update:function(){},start:function(){if(this._localization||(this._localization=Oskari.getLocalization(this.getName())),"1"!==jQuery.cookie("pti_tour_seen")){var e=this,t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,n.register(e),e._startGuide()}},_startGuide:function(){var e=this,t="Oskari.userinterface.component.Popup",i=Oskari.clazz.create(t);e.guideStep=0,i.makeDraggable(),i.addClass("guidedtour"),e._showGuideContentForStep(e.guideStep,i)},_guideSteps:[{appendTourSeenCheckbox:!0,setScope:function(e){this.ref=e},getTitle:function(){return this.ref._localization.page1.title},getContent:function(){var e=jQuery("<div></div>");return e.append(this.ref._localization.page1.message),e}},{setScope:function(e){this.ref=e},getTitle:function(){return""+this.ref._localization.page2.title+"<span>1/8</span>"},getContent:function(){var e=this.ref;e._openExtension("Search");var t=e._localization.page2,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),a=n.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("Search"),a.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("Search"),a.show(),r.hide()}),i.append("<br /><br />"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page3.title;return e+"<span>2/8</span>"},getContent:function(){var e=this.ref;e._openExtension("LayerSelector");var t=e._localization.page3,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),a=n.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("LayerSelector"),a.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("LayerSelector"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page4.title;return e+"<span>3/8</span>"},getContent:function(){var e=this.ref;e._openExtension("LayerSelection");var t=e._localization.page4,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),a=n.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("LayerSelection"),a.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("LayerSelection"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page5.title;return e+"<span>4/8</span>"},getContent:function(){var e=this.ref;e._openExtension("PersonalData");var t=e._localization.page5,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),a=n.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("PersonalData"),a.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("PersonalData"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page6.title;return e+"<span>5/8</span>"},getContent:function(){var e=this.ref;e._openExtension("Publisher");var t=e._localization.page6,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),a=n.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("Publisher"),a.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("Publisher"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page7.title;return e+"<span>6/8</span>"},getContent:function(){var e=this.ref;e._closeExtension("Publisher");var t=e._localization.page7,i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery("#toolbar")},positionAlign:"right"},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page8.title;return e+"<span>7/8</span>"},getContent:function(){var e=this.ref,t=e._localization.page8,i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery(".panbuttonDiv")},positionAlign:"left"},{appendTourSeenCheckbox:!0,setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page9.title;return e+"<span>8/8</span>"},getContent:function(){var e=this.ref,t=e._localization.page9,i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery(".pzbDiv")},positionAlign:"left"}],_showGuideContentForStep:function(e,t){var i=this._guideSteps[e];i.setScope(this);var n=this._getDialogButton(t),a=i.getTitle(),r=i.getContent();if(i.appendTourSeenCheckbox){r.append("<br><br>");var s=jQuery('<input type="checkbox" name="pti_tour_seen" id="pti_tour_seen" value="1">'),o=s.clone(),l=jQuery('<label for="pti_tour_seen"></label>'),u=l.clone();u.append(this._localization.tourseen.label),o.bind("change",function(){jQuery(this).attr("checked")?jQuery.cookie("pti_tour_seen","1",{expires:365}):jQuery.cookie("pti_tour_seen","0",{expires:1})}),r.append(o),r.append("&nbsp;"),r.append(u)}t.show(a,r,n),i.getPositionRef?t.moveTo(i.getPositionRef(),i.positionAlign):t.resetPosition()},_getFakeExtension:function(e){return{getName:function(){return e}}},_openExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.sandbox.postRequestByName(i,[t,"attach"])},_closeExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.sandbox.postRequestByName(i,[t,"close"])},_getDialogButton:function(e){var t,i=this,n=[],a=i._localization.button.close,r=e.createCloseButton(a);if(n.push(r),this.guideStep>1){t="Oskari.userinterface.component.Button";var s=Oskari.clazz.create(t),o=i._localization.button.previous;s.setTitle(o),s.setHandler(function(){i.guideStep--,i._showGuideContentForStep(i.guideStep,e)}),n.push(s)}if(0===this.guideStep){t="Oskari.userinterface.component.Button";var l=Oskari.clazz.create(t),u=i._localization.button.start;l.setTitle(u),l.setHandler(function(){i.guideStep++,i._showGuideContentForStep(i.guideStep,e)}),n.push(l)}else if(this.guideStep<this._guideSteps.length-1){t="Oskari.userinterface.component.Button";var c=Oskari.clazz.create(t),d=i._localization.button.next;c.setTitle(d),c.setHandler(function(){i.guideStep++,i._showGuideContentForStep(i.guideStep,e)}),n.push(c),e.addClass("bluetitle")}else if(this.guideStep===this._guideSteps.length-1){var h=i._localization.button.finish,p=e.createCloseButton(h);n.push(p)}return n},init:function(){return null},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];if(!i){var n=i.apply(this,[e]);if(n)return n}return null},eventHandlers:{},stop:function(){{var e=this;e.sandbox()}e.sandbox.unregister(e)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/guidedtour/instance",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/guidedtour/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,define("src/framework/guidedtour/module",["oskari","i18n!./nls/locale","jquery","bundles/framework/bundle/guidedtour/instance","libraries/jquery/plugins/jquery.cookie","css!resources/framework/bundle/guidedtour/css/style.css"],function(e,t){return e.bundleCls("guidedtour").category({create:function(){var i=e.clazz.create("Oskari.framework.bundle.guidedtour.GuidedTourBundleInstance",t);return i},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.promote.PromoteBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.userInterfaceLanguage=null,this.service=null},{__name:"Promote",getName:function(){return this.conf.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this.conf&&this.conf[e]?this.conf[e][this.userInterfaceLanguage]:(this._localization||(this._localization=Oskari.getLocalization(this.__name)),e&&this._localization[e]?this._localization[e]:this.localization?this._localization:{})},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,e.userInterfaceLanguage=Oskari.getLang(),this.localization=Oskari.getLocalization(this.getName()),n.register(e);var a="userinterface.AddExtensionRequest",r=n.getRequestBuilder(a),s=r(this);if(n.request(this,s),e.createUi(),this.conf&&this.conf.toolbarButtons){r=n.getRequestBuilder("Toolbar.AddToolButtonRequest");for(var o in this.conf.toolbarButtons)for(var l in this.conf.toolbarButtons[o]){var u=this.conf.toolbarButtons[o][l];u.tooltip=u.tooltip[e.userInterfaceLanguage],u.disabled=!0,u.callback=function(){},n.request(e,r(l,o,u))}}}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e=this.sandbox,t="userinterface.RemoveExtensionRequest",i=e.getRequestBuilder(t),n=i(this);e.request(this,n),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.promote.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.promote.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/promote/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.promote.Flyout",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.promote.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("promote")||jQuery(this.container).addClass("promote")},startPlugin:function(){this.template=jQuery('<div class="promoteContainer"><div class="promoteDescription"></div><div><a class="promoteSignup"></a></div><div><a class="promoteRegister"></a></div></div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},createUi:function(){var e=this,t=(e.instance.getSandbox(),jQuery(this.container));t.empty();var i=this.template.clone(),n=i.find("div.promoteDescription");if(n.html(this.instance.getLocalization("desc")),e.instance.conf.signup){var a=i.find("a.promoteSignup");a.attr("href",this.instance.getLocalization("signupUrl")),a.append(this.instance.getLocalization("signup"))}if(e.instance.conf.register){var r=i.find("a.promoteRegister");r.attr("href",this.instance.getLocalization("registerUrl")),r.append(this.instance.getLocalization("register"))}t.append(i)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/promote/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.promote.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.promote.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},refresh:function(){{var e=this,t=e.instance,i=this.container;this.template,t.getSandbox(),i.children(".oskari-tile-status")}}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/promote/Tile",function(){}),Oskari.registerLocalization({lang:"fi",key:"Promote",value:{title:"Sisäänkirjautuneille",desc:"Sisäänkirjautuneena saat lisää toiminnallisuuksia."}}),define("bundles/framework/bundle/promote/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"Promote",value:{title:"Inskrivna användare",desc:"Inskrivna användare har tillgång till flera ägenskaper."}}),define("bundles/framework/bundle/promote/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"Promote",value:{title:"Logged-in users",desc:"If you log in, you get more functionalities."}}),define("bundles/framework/bundle/promote/locale/en",function(){}),define("src/framework/promote/module",["oskari","jquery","bundles/framework/bundle/promote/instance","bundles/framework/bundle/promote/Flyout","bundles/framework/bundle/promote/Tile","bundles/framework/bundle/promote/locale/fi","bundles/framework/bundle/promote/locale/sv","bundles/framework/bundle/promote/locale/en"],function(e){return e.bundleCls("promote").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.promote.PromoteBundleInstance");return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance",function(){this.sandbox=null,this.started=!1,this._localization=null},{__name:"coordinatedisplay",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.setSandbox(n);var a=n.findRegisteredModuleInstance("MainMapModule");t={};var r=this.getLocalization("display"),s=Oskari.clazz.create("Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",t,r);a.registerPlugin(s),a.startPlugin(s),this.plugin=s}},stop:function(){this.sandbox=null,this.started=!1}},{protocol:["Oskari.bundle.BundleInstance"]}),define("bundles/framework/bundle/coordinatedisplay/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",function(e,t){this._locale=t,this._clazz="Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",this._defaultLocation="top right",this._index=4,this._name="CoordinatesPlugin"},{_createControlElement:function(){var e=this,t=e._locale,i=e.getMapModule().getProjection(),n=t.crs[i]||i,a=jQuery('<div class="mapplugin coordinates">    <div>'+n+"</div>    <div>      <div>"+t.compass.N+"</div>      <div></div>    </div>    <div>      <div>"+t.compass.E+"</div>      <div></div>    </div></div>");return a.mousedown(function(e){e.stopPropagation()}),e._latEl=a.find("div > div:last-child")[0],e._lonEl=a.find("div > div:last-child")[1],a},refresh:function(e){var t=this;if(!e||!e.latlon){var i=t._sandbox.getMap();e={latlon:{lat:Math.floor(i.getY()),lon:Math.floor(i.getX())}}}t._latEl&&t._lonEl&&(t._latEl.innerHTML=Math.floor(e.latlon.lat),t._lonEl.innerHTML=Math.floor(e.latlon.lon))},_createEventHandlers:function(){return{MouseHoverEvent:function(e){this.refresh({latlon:{lat:Math.floor(e.getLat()),lon:Math.floor(e.getLon())}})},AfterMapMoveEvent:function(){this.refresh()}}}},{extend:["Oskari.mapping.mapmodule.plugin.BasicMapModulePlugin"],protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/coordinatedisplay/plugin/CoordinatesPlugin",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/coordinatedisplay/css/coordinatedisplay.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"bg",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"С",E:"И"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/bg",function(){}),Oskari.registerLocalization({lang:"cs",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N: ",E:"E: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N:",E:"E:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N: ",E:"O: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN","EPSG:3575":"North Pole LAEA Europe"},compass:{N:"N:",E:"E:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N:",E:"E:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N: ",E:"E: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN","EPSG:3575":"North Pole LAEA Europe"},compass:{N:"P:",E:"I:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/fi",function(){}),Oskari.registerLocalization({lang:"el",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"Β: ",E:"Αν: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/el",function(){}),Oskari.registerLocalization({lang:"hr",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"S: ",E:"I: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/hr",function(){}),Oskari.registerLocalization({lang:"lv",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N:",E:"E:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N: ",E:"O: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N: ",E:"E: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N:",E:"E:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"N:",E:"E:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/ro",function(){}),Oskari.registerLocalization({lang:"sl",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"S:",E:"V:"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/sl",function(){}),Oskari.registerLocalization({lang:"sv",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN","EPSG:3575":"North Pole LAEA Europe"},compass:{N:"N: ",E:"E: "}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"coordinatedisplay",value:{title:"",desc:"",display:{crs:{"EPSG:3067":"ETRS89-TM35FIN"},compass:{N:"x",E:"y"}}}}),define("bundles/framework/bundle/coordinatedisplay/locale/uk",function(){}),define("src/framework/coordinatedisplay/module",["oskari","jquery","src/mapping/mapmodule/plugin/AbstractMapModulePlugin","src/mapping/mapmodule/plugin/BasicMapModulePlugin","bundles/framework/bundle/coordinatedisplay/instance","bundles/framework/bundle/coordinatedisplay/plugin/CoordinatesPlugin","css!resources/framework/bundle/coordinatedisplay/css/coordinatedisplay.css","bundles/framework/bundle/coordinatedisplay/locale/bg","bundles/framework/bundle/coordinatedisplay/locale/cs","bundles/framework/bundle/coordinatedisplay/locale/da","bundles/framework/bundle/coordinatedisplay/locale/de","bundles/framework/bundle/coordinatedisplay/locale/en","bundles/framework/bundle/coordinatedisplay/locale/es","bundles/framework/bundle/coordinatedisplay/locale/et","bundles/framework/bundle/coordinatedisplay/locale/fi","bundles/framework/bundle/coordinatedisplay/locale/el","bundles/framework/bundle/coordinatedisplay/locale/hr","bundles/framework/bundle/coordinatedisplay/locale/lv","bundles/framework/bundle/coordinatedisplay/locale/nl","bundles/framework/bundle/coordinatedisplay/locale/pl","bundles/framework/bundle/coordinatedisplay/locale/pt","bundles/framework/bundle/coordinatedisplay/locale/ro","bundles/framework/bundle/coordinatedisplay/locale/sl","bundles/framework/bundle/coordinatedisplay/locale/sv","bundles/framework/bundle/coordinatedisplay/locale/uk"],function(e){return e.bundleCls("coordinatedisplay").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance");
return t},update:function(){}})}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.StatsGridBundleInstance",function(){this.defaultConf={name:"StatsGrid",sandbox:"sandbox",stateful:!0,tileClazz:"Oskari.statistics.bundle.statsgrid.Tile",viewClazz:"Oskari.statistics.bundle.statsgrid.StatsView"},this.state={indicators:[],layerId:null}},{afterStart:function(e){var t=this,i=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.request.TooltipContentRequestHandler",this);e.addRequestHandler("StatsGrid.TooltipContentRequest",i);var n=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.request.IndicatorsRequestHandler",this);e.addRequestHandler("StatsGrid.IndicatorsRequest",n);var a=t.getLocalization(),r=e.findRegisteredModuleInstance("MainMapModule");this.mapModule=r;var s=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.StatisticsService",t);e.registerService(s),this.statsService=s;var o=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.UserIndicatorsService",t);e.registerService(o),o.init(),this.userIndicatorsService=o;var l={state:t.getState(),statistics:[{id:"min",visible:!0},{id:"max",visible:!0},{id:"avg",visible:!0},{id:"mde",visible:!0},{id:"mdn",visible:!0},{id:"std",visible:!0},{id:"sum",visible:!0}]},u=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.plugin.ManageStatsPlugin",l,a);r.registerPlugin(u),r.startPlugin(u),this.gridPlugin=u;var c=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.plugin.ManageClassificationPlugin",{state:t.getState()},a);r.registerPlugin(c),r.startPlugin(c),this.classifyPlugin=c;var d=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.request.DataSourceRequestHandler",this.gridPlugin);if(e.addRequestHandler("StatsGrid.AddDataSourceRequest",d),e.getUser().isLoggedIn()){var h=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.UserIndicatorsTab",this,a.tab);this.userIndicatorsTab=h}this.setState(this.state),this._enableTile()},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=this,i=this.getView();if(e.getExtension().getName()===t.getName()&&this._isLayerPresent()){var n="close"!==e.getViewState();i.prepareMode(n,null,!0)}},"MapStats.StatsVisualizationChangeEvent":function(e){this._afterStatsVisualizationChangeEvent(e)},AfterMapMoveEvent:function(){var e=this.getView();e.isVisible&&e._layer&&this._createPrintParams(e._layer)},AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},MapLayerEvent:function(){this._enableTile()}},_enableTile:function(){var e=this._isLayerPresent(),t=this.plugins["Oskari.userinterface.Tile"];e&&t&&t.enable()},isLayerVisible:function(){var e,t=this.sandbox.findMapLayerFromSelectedMapLayers(this.conf.defaultLayerId);return e=null!==t&&void 0!==t},_isLayerPresent:function(){var e=this.sandbox.getService("Oskari.mapframework.service.MapLayerService");if(this.conf&&this.conf.defaultLayerId){var t=e.findMapLayer(this.conf.defaultLayerId);return null!==t&&void 0!==t&&t.isLayerOfType("STATS")}var i=e.getLayersOfType("STATS");return i&&i.length>0?(this.conf.defaultLayerId=i[0].getId(),!0):!1},getUserIndicatorsService:function(){return this.userIndicatorsService},addUserIndicator:function(e){var t=this,i=t.getView(),n=t.getState();n.indicators=n.indicators||[],n.indicators.push(e),i.isVisible||i.prepareMode(!0,null,!0),i.isVisible?window.setTimeout(function(){t.gridPlugin.changeGridRegion(e.category),t.gridPlugin.addIndicatorDataToGrid(null,e.id,e.gender,e.year,e.data,e.meta),t.gridPlugin.addIndicatorMeta(e)},1e3):(n.layerId=e.layerId||n.layerId,n.regionCategory=e.category,t.setState(n))},setState:function(e){if(this.state=jQuery.extend({},{indicators:[],layerId:null},e),this.gridPlugin.setState(this.state),this.classifyPlugin.setState(this.state),this.classifyPlugin.resetUI(this.state),e.isActive){var t=this.getView(),i=this.state.layerId,n=null;null!==i&&void 0!==i&&(n=this.sandbox.getService("Oskari.mapframework.service.MapLayerService").findMapLayer(i)),t.prepareMode(!0,n,!1)}},getState:function(){return this.state},getStateParameters:function(){var e=this,t=e.getView(),i=e.state;if(!t||!t.isVisible)return null;if(!i||jQuery.isEmptyObject(i))return null;var n,a=null,r=null,s=null,o="statsgrid=",l="+",u=",",c=null,d=null,h=null,p=i.colors||{},f=["layerId","currentColumn","methodId","numberOfClasses","classificationMode","manualBreaksInput","allowClassification"],m=["set","index","flipped"],g=i.indicators||[];for(a=0,r=f.length,s=r-1;r>a;a++)n=i[f[a]],null!==n&&void 0!==n&&(c+=n),a!==s&&(c+=l);for(a=0,r=g.length,s=r-1;r>a;a++)(null===g[a].id||void 0===g[a].id)&&(g[a].id=g[a].indicator),d+=g[a].id,d+=l,d+=g[a].year,d+=l,d+=g[a].gender,a!==s&&(d+=u);var v,y=[];for(p.flipped=p.flipped===!0,a=0,r=m.length;r>a;++a)v=m[a],p.hasOwnProperty(v)&&null!==p[v]&&void 0!==p[v]&&y.push(p[v]);3===y.length&&(h=y.join(","));var b=null;return c&&d&&(b=o+c+"-"+d+"-",h&&(b+=h),b+=t&&t.isVisible?"-1":"-0"),b},getView:function(){return this.plugins["Oskari.userinterface.View"]},getSandbox:function(){return this.sandbox},getGridIndicators:function(){return this.gridPlugin?this.gridPlugin.indicatorsMeta:null},_createPrintParams:function(e){if(e){var t=this.mapModule.getOLMapLayers(e.getId());if(t){var i,n,a={},r=_.first(t),s={bbox:r.maxExtent.toArray(),url:r.getURL(r.getExtent())};a[e.getId()]=[],a[e.getId()].push(s),this.printEvent?(i=!0,this.printEvent.setLayer(e),this.printEvent.setTileData(a)):(i=!1,n=this.sandbox.getEventBuilder("Printout.PrintableContentEvent"),n&&(this.printEvent=n(this.getName(),e,a))),this.printEvent&&this.sandbox.notifyAll(this.printEvent,i)}}},_afterStatsVisualizationChangeEvent:function(e){var t=this,i=e.getParams(),n=e.getLayer();t.state.methodId=i.methodId,t.state.numberOfClasses=i.numberOfClasses,t.state.manualBreaksInput=i.manualBreaksInput,t.state.colors=i.colors,t.state.classificationMode=i.classificationMode,t._createPrintParams(n)},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer(),i=t.getId(),n=this.getView();n._layer&&i===n._layer.getId()&&n.prepareMode(!1)}},{extend:["Oskari.userinterface.extension.DefaultExtension"]}),define("bundles/statistics/bundle/statsgrid/instance",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.statistics.bundle.statsgrid.Tile"},setEl:function(e){this.container=jQuery(e),this.disable()},startPlugin:function(){},stopPlugin:function(){this.container&&this.container.empty&&this.container.empty()},getTitle:function(){return this.instance.getLocalization().tile.title},refresh:function(){},disable:function(){this.container.addClass("disabled")},enable:function(){this.container.removeClass("disabled")},isEnabled:function(){return!this.container.hasClass("disabled")}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/statistics/bundle/statsgrid/Tile",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.StatsView",function(){},{showContent:function(e){e?(this.getLeftColumn().addClass("statsgrid_100"),this.getLeftColumn().append(this.getEl())):(this.getLeftColumn().removeClass("statsgrid_100"),this.getEl().empty(),this.getEl().remove())}},{protocol:["Oskari.userinterface.View"],extend:["Oskari.statistics.bundle.statsgrid.GridModeView"]}),define("bundles/statistics/bundle/statsgrid/StatsView",function(){}),define("src/statistics/statsgrid/GridModeView",["jquery"],function(e){Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.GridModeView",function(){},{startPlugin:function(){var e=this,t=e.instance.getSandbox();this.toolbar=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.StatsToolbar",{title:e.getTitle()},this.instance),this.requestHandler=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.request.StatsGridRequestHandler",e),t.addRequestHandler("StatsGrid.StatsGridRequest",this.requestHandler);var i=e.getEl();i.addClass("statsgrid")},prepareMode:function(e,t,i){var n=this;if(!n.isVisible||!e){n.isVisible=1==e,(t&&(null===n._layer||void 0===n._layer)||t&&n._layer.getId()+""!=t.getId()+"")&&(n._layer=t,n.instance.gridPlugin.setLayer(t),n.instance.state.layerId=n._layer.getId(),n.toolbar.changeName(n.instance.getLocalization("tile").title+" - "+n._layer.getName()));var a=n.isVisible&&null===n._layer||void 0===n._layer;a?(n._layer=n.instance.sandbox.findMapLayerFromSelectedMapLayers(n.instance.conf.defaultLayerId),n._layer||(n._layer=n.instance.sandbox.findMapLayerFromAllAvailable(n.instance.conf.defaultLayerId),n._layer&&n.instance.sandbox.postRequestByName("AddMapLayerRequest",[n._layer.getId(),!1,n._layer.isBaseLayer()])),n._layer&&(n.instance.gridPlugin.setLayer(n._layer),n.instance.state.layerId=n._layer.getId(),n.toolbar.changeName(n.instance.getLocalization("tile").title+" - "+n._layer.getName()))):!n.isVisible&&n._layer&&(n._layer=null);var r=function(){n.showMode(e,i),n.showContent(e),e&&n.instance.gridPlugin.createStatsOut(n.getEl());var t=n.instance.getSandbox().getEventBuilder("StatsGrid.ModeChangedEvent");if(t){var a=t(n.isVisible);n.instance.getSandbox().notifyAll(a)}};(n._layer||!e)&&(a?window.setTimeout(r,50):r())}},showMode:function(t,i){var n=this,a=this.instance.getSandbox();this.toolbar.show(t);var r=this.instance.getSandbox().findRegisteredModuleInstance("MainMapModule"),s=r.getMap(),o=this.getCenterColumn(),l=this.getLeftColumn();if(t){var u=new OpenLayers.LonLat(52e4,725e4);r.centerMap(u,0),e("#contentMap").addClass("statsgrid-contentMap"),e(".oskariui-mode-content").addClass("statsgrid-mode");var c=40;o.removeClass("span12"),o.width(100-c+"%"),e("#mapdiv").height(e(window).height()-e("#contentMap").find(".oskariui-menutoolbar").height()),l.empty(),l.removeClass("oskari-closed"),l.width(c+"%"),l.resizable({minWidth:450,handles:"e",resize:function(){o.width(e(".row-fluid").width()-l.width()),n.instance.gridPlugin.grid.resizeCanvas()},stop:function(t,i){var n=i.size.width-i.originalSize.width,a=e("div.slick-header-columns");a.width(a.width()+n),s.updateSize()}}),s.updateSize()}else{if(e("#contentMap").removeClass("statsgrid-contentMap"),e(".oskariui-mode-content").removeClass("statsgrid-mode"),o.width("").addClass("span12"),e("#mapdiv").height(e(window).height()),l.resizable().resizable("destroy"),l.addClass("oskari-closed"),l.width(""),l.empty(),!i){var d=a.getRequestBuilder("userinterface.UpdateExtensionRequest")(this.instance,"close",this.instance.getName());a.request(this.instance.getName(),d)}s.updateSize()}},getLeftColumn:function(){return e(".oskariui-left")},getCenterColumn:function(){return e(".oskariui-center")},getRightColumn:function(){return e(".oskariui-right")},stopPlugin:function(){this.toolbar.destroy(),sandbox.removeRequestHandler("StatsGrid.StatsGridRequest",this.requestHandler)}},{protocol:["Oskari.userinterface.View"],extend:["Oskari.userinterface.extension.DefaultView"]})}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.StatsToolbar",function(e,t){this.toolbarId="statsgrid",this.instance=t,this.localization=e},{show:function(e){e?this.addToolButton():this.removeToolButton()},destroy:function(){var e=this.instance.getSandbox();e.requestByName(this.instance,"Toolbar.ToolbarRequest",[this.toolbarId,"remove"])},changeName:function(e){var t=this.instance.getSandbox();t.requestByName(this.instance,"Toolbar.ToolbarRequest",[this.toolbarId,"changeName",e])},_createUI:function(){var e=this.instance.plugins["Oskari.userinterface.View"],t=this,i=this.instance.getSandbox();i.requestByName(this.instance,"Toolbar.ToolbarRequest",[this.toolbarId,"add",{title:t.localization.title,show:!1,closeBoxCallback:function(){e.prepareMode(!1)}}]);var n,a="statsgrid-tools",r={selectAreas:{toolbarid:t.toolbarId,iconCls:"selection-square",tooltip:this.instance._localization.showSelected,sticky:!1,toggleSelection:!0,callback:function(){var i,n,a=e.instance.gridPlugin,r=a.toggleSelectMunicipalitiesMode();r?(a.unselectAllAreas(!0),i=t.instance.getSandbox().getEventBuilder("StatsGrid.SelectHilightsModeEvent"),i&&(n=i(a.selectedMunicipalities),t.instance.getSandbox().notifyAll(n))):(a.grid.scrollRowToTop(0),i=t.instance.getSandbox().getEventBuilder("StatsGrid.ClearHilightsEvent"),i&&(n=i(t.isVisible),t.instance.getSandbox().notifyAll(n)))}}},s=this.instance,o=i.getRequestBuilder("Toolbar.AddToolButtonRequest");for(n in r)r.hasOwnProperty(n)&&i.request(s,o(n,a,r[n]))},addToolButton:function(){var e,t=this,i=t.instance,n=(i.plugins["Oskari.userinterface.View"],i.getSandbox()),a="statsgrid-tools",r={selectAreas:{iconCls:"selection-square",tooltip:i._localization.showSelected,sticky:!1,toggleSelection:!0,callback:function(){var e,a,r=i.gridPlugin,s=r.toggleSelectMunicipalitiesMode();s?(r.unselectAllAreas(!0),e=i.getSandbox().getEventBuilder("StatsGrid.SelectHilightsModeEvent"),e&&(a=e(r.selectedMunicipalities),n.notifyAll(a))):(r.grid.scrollRowToTop(0),e=n.getEventBuilder("StatsGrid.ClearHilightsEvent"),e&&(a=e(t.isVisible),n.notifyAll(a)))}}},s=n.getRequestBuilder("Toolbar.AddToolButtonRequest");for(e in r)r.hasOwnProperty(e)&&n.request(i,s(e,a,r[e]))},removeToolButton:function(){var e=this.instance,t=e.getSandbox(),i=t.getRequestBuilder("Toolbar.RemoveToolButtonRequest");i&&t.request(e,i("selectAreas","statsgrid-tools"))}}),define("bundles/statistics/bundle/statsgrid/StatsToolbar",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.AddOwnIndicatorForm",function(e,t,i,n,a,r){this.sandbox=e,this.localization=t,this.regions=i,this.layerWMSName=n,this.layerId=a,this.regionCategory=r,this.municipalityCategory="kunta",this.templates={main:'<form class="add-indicator">    <h2></h2>    <fieldset class="form-meta">        <legend></legend>        <label for="indicator_title"></label><input type="text" id="indicator_title" required>        <label for="indicator_sources"></label><input type="text" id="indicator_sources" required>        <label for="indicator_description"></label><input type="text" id="indicator_description" required>        <label for="indicator_year"></label><input type="text" id="indicator_year" required>        <label for="indicator_publicity"></label><input type="checkbox" id="indicator_publicity">    </fieldset>    <fieldset class="form-import">        <legend></legend>        <label for="indicator_reference-layer"></label><select id="indicator_reference-layer"></select>        <label for="indicator_text-import"></label><textarea class="import-textarea" id="indicator_text-import"></textarea>        <button class="start-import primary" title=""></button><button class="clear-import" title=""></button>    </fieldset>    <fieldset class="form-municipalities">        <legend></legend><hr>        <ul class="municipalities"></ul>    </fieldset>    <fieldset class="form-submit">        <button class="cancel-form-button"></button><button class="submit-form-button primary" title=""></button><button class="clear-form-button"></button>    </fieldset></form>',municipalityRow:'<li class="municipality-row"><label class="municipality-row"></label><input type="text"></li>'}},{createUI:function(e,t){var i=this,n=jQuery(i.templates.main),a=i.sandbox.findMapLayerFromAllAvailable(i.layerId);i.container=e,n.find("h2").append(i.localization.addDataTitle),n.find("fieldset.form-meta > legend").append(i.localization.baseInfoTitle);var r=n.find("#indicator_title");r.prev().append(i.localization.addDataMetaTitle),r.attr("placeholder",i.localization.addDataMetaTitlePH),r=n.find("#indicator_sources"),r.prev().append(i.localization.addDataMetaSources),r.attr("placeholder",i.localization.addDataMetaSourcesPH),r=n.find("#indicator_description"),r.prev().append(i.localization.addDataMetaDescription),r.attr("placeholder",i.localization.addDataMetaDescriptionPH),r=n.find("#indicator_year"),r.prev().append(i.localization.addDataMetaYear),r.attr("placeholder",i.localization.addDataMetaYear),r.blur(function(e){i.validateYear(this.value,e)}),r.keypress(function(e){i.validateYear(this.value,e)}),n.find("#indicator_publicity").prev().append(i.localization.addDataMetaPublicity),n.find("fieldset.form-import > legend").append(i.localization.addDataTitle),r=n.find("#indicator_reference-layer"),r.prev().append(i.localization.addDataMetaReferenceLayer);var s=a.getCategoryMappings().categories;_.each(s,function(e){var t=jQuery("<option></option>");t.val(e).html(i.localization.regionCategories[e]),i.regionCategory===e&&t.attr("selected","selected"),r.append(t)}),r.change(function(e){i.regionCategory=e.target.value,i._createRegionInputs(n,i.regions[e.target.value])}),n.find("fieldset.form-import textarea").attr("placeholder",i.localization.importDataDescription).prev().html(i.localization.dataRows),r=n.find("button.clear-import"),r.append(i.localization.clearImportDataButton),r.click(function(e){e.preventDefault(),n.find("fieldset.form-import textarea").val("")}),r=n.find("button.start-import"),r.append(i.localization.importDataButton),r.click(function(e){e.preventDefault(),i._parseData(e,i,n.find("fieldset.form-import"))}),r=n.find(".cancel-form-button"),r.append(i.localization.formCancel),r.click(function(e){e.preventDefault(),i._handleCancel(e,i)}),r=n.find(".clear-form-button"),r.append(i.localization.formEmpty),r.click(function(e){e.preventDefault(),i._clearValues()}),r=n.find(".submit-form-button"),r.append(i.localization.formSubmit),r.click(function(e){e.preventDefault(),i._handleSubmit(e,i,t)}),i._createRegionInputs(n,i.regions[i.regionCategory]),e.append(n)},_createRegionInputs:function(e,t){var i,n,a=this,r=e.find(".form-municipalities legend"),s=e.find(".municipalities");r.html(a.localization.regionCategories[a.regionCategory]),s.empty(),_.each(t,function(e){i=jQuery(a.templates.municipalityRow).clone(),n=e.municipality.toLowerCase(),a.regionCategory.toLowerCase()===a.municipalityCategory&&(n=n.split(" ")[0]),i.attr("data-name",n).attr("data-code",e.code).attr("data-id",e.id).find("label").attr("for","municipality_"+n).append(e.municipality+" ("+e.code+")"),i.find("input").attr("id","municipality_"+n).attr("placeholder",a.localization.municipalityPlaceHolder),s.append(i)})},_handleCancel:function(e,t){t.container.find("form.add-indicator").remove(),t.container.find(".selectors-container").show(),t.container.find(".data-source-select").show(),t.container.find("#municipalGrid").show()},_handleSubmit:function(e,t,i){var n=this.sandbox.getService("Oskari.statistics.bundle.statsgrid.UserIndicatorsService"),a=t._gatherData();null!==a&&void 0!==a&&null!==n&&void 0!==n&&(this.sandbox&&this.sandbox.getUser().isLoggedIn()?n.saveUserIndicator(a,function(n){t._handleCancel(e,t),null!==n.id&&void 0!==n.id&&(a.indicatorId="user_"+n.id,i(a))},function(){alert(t.localization.connectionProblem)}):(t._handleCancel(e,t),a.indicatorId="user_"+(new Date).getTime(),i(a)))},_parseData:function(e,t){var i=jQuery(e.target).parents("form.add-indicator"),n=i.find("textarea"),a=n.val(),r=function(e,i){var n;return/^\d+$/.test(e)?(t.regionCategory.toLowerCase()===t.municipalityCategory&&(1===e.length&&(e="00"+e),2===e.length&&(e="0"+e)),n=t.container.find(".municipality-row[data-code="+e+"]")):(t.regionCategory.toLowerCase()===t.municipalityCategory&&(e=e.split(" ")[0]),n=t.container.find(".municipality-row[data-name="+e.toLowerCase()+"]")),n&&n.length?(n.find("input").val(i),n.appendTo(n.parent()),!0):!1},s=a.match(/[^\r\n]+/g),o=0;unrecognized=[],_.each(s,function(e){var t,i,n=e.match(/([^\t:,]+) *[\t:,]+ *(.*)/);n&&3===n.length&&(t=n[1],i=(n[2]||"").replace(",",".")),r(jQuery.trim(t),jQuery.trim(i))?o++:i&&i.length>0&&unrecognized.push({region:t,value:i})});var l=t.container.find(".clear-import"),u="";unrecognized.length>0&&(u="<br>"+t.localization.parsedDataUnrecognized+": "+unrecognized.length);var c=t.localization.parsedDataInfo+': <span class="import-indicator-bold">'+o+"</span> "+u;l.tooltip({content:c,position:{my:"right-10 center",at:"left center"}}),l.tooltip("open"),n.val("")},_gatherData:function(){var e=this,t={},i=[];"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var n=e.container.find("#indicator_title").val();(null===n||void 0===n||""===n.trim())&&i.push(e.container.find("#indicator_title").prev().text()),t.title=JSON.stringify({fi:n});var a=e.container.find("#indicator_sources").val();(null===a||void 0===a||""===a.trim())&&i.push(e.container.find("#indicator_sources").prev().text()),t.source=JSON.stringify({fi:a});var r=e.container.find("#indicator_description").val();(null===r||void 0===r||""===r.trim())&&i.push(e.container.find("#indicator_description").prev().text()),t.description=JSON.stringify({fi:r});var s=e.container.find("#indicator_year").val(),o=/^[0-9]+$/,l=(new Date).getFullYear();if((null===s||void 0===s||""===s.trim()||""!==s&&!o.test(s)||4!=s.length||1900>s||s>l)&&i.push(e.container.find("#indicator_year").prev().text()),t.year=s,t.material=e.layerId,t.published=e.container.find("#indicator_publicity").prop("checked"),t.category=e.regionCategory,t.data=[],i.length>0){var u=e.container.find(".submit-form-button"),c=e.localization.failedSubmit+"<br>"+i.join(", ");return u.attr("title",c),u.tooltip({content:c,position:{my:"right bottom-10",at:"right top"}}),u.tooltip("open"),setTimeout(function(){u.tooltip("destroy"),u.attr("title","")},1500),null}var d,h=e.container.find(".municipality-row");for(d=0;d<h.length;d++){var p=jQuery(h[d]),f=p.find("input"),m=f.val();null!==m&&void 0!==m&&""!==m.trim()&&t.data.push({region:p.attr("data-id"),"primary value":m})}return t.data=JSON.stringify(t.data),t},_clearValues:function(){this.container.find("input[type=text]").val(""),this.container.find("#indicator_publicity").prop("checked",!1)},validateYear:function(e,t){var i=/^[0-9]+$/;if(("blur"==t.type||4===e.length&&8!==t.keyCode&&46!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode)&&0!==e&&"0"!==e){var n=jQuery(t.target);if(""!==e&&!i.test(e))return n.css({color:"#ff0000"}),!1;if(4!=e.length)return n.css({color:"#ff0000"}),!1;var a=(new Date).getFullYear();return 1900>e||e>a?(n.css({color:"#ff0000"}),!1):(n.css({color:"#878787"}),!0)}}}),define("bundles/statistics/bundle/statsgrid/AddOwnIndicatorForm",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.plugin.ManageClassificationPlugin",function(e,t){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=void 0,this.conf=e,this._state=null,this._locale=t||Oskari.getLocalization("StatsGrid"),this.initialSetup=!0,this.colorsets_div=null,this.colorsets_seq=null,this.colorsets_qual=null,this.content=null,this.dialog=null,this.colorsetIndex=0,this.currentColorSet="seq",this.curCol=null,this._layer=null,this._params=null,this.minClassNum=2,this.maxClassNum=9,this.numberOfClasses=5,this.isSelectHilightedMode=!1,this.templates={block:'<div class="block"></div>',classificationGuide:'<p class="classification-guide"></p>'}},{__name:"ManageClassificationPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){this.classify_temp=jQuery('<div class=\'mapplugin manageClassificationPlugin\'><div class="classheader"><div class="header-icon icon-arrow-white-right"></div></div><div class="content"></div></div>'),this.templateContent=jQuery("<div></div>"),this.templateInstructions2=jQuery("<div class='instructions2' style= 'padding: 20px 0px 0px 0px;'></div>"),this.setColors()},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i),this._state=this.conf.state||{};for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(i,t);i.statsService=i._sandbox.getService("Oskari.statistics.bundle.statsgrid.StatisticsService"),i._initState(),i._createUI()},_initState:function(){(null===this._state.methodId||void 0===this._state.methodId||this._state.methodId<1)&&(this._state.methodId="1");var e=this._state.classificationMode;(null===e||void 0===e)&&(e=""),(null===this._state.numberOfClasses||void 0===this._state.numberOfClasses)&&(this._state.numberOfClasses=5),this._state.numberOfClasses<3&&(this._state.numberOfClasses=2),(null===this._state.filterMethod||"undefined"==typeof this._state.filterMethod)&&(this._state.filterMethod=""),(null===this._state.filterInput||"undefined"==typeof this._state.filterInput)&&(this._state.filterInput=[]),(null===this._state.filterRegion||"undefined"==typeof this._state.filterRegion)&&(this._state.filterRegion=[]),(null===this._state.municipalities||"undefined"==typeof this._state.municipalities)&&(this._state.municipalities=[])},stopPlugin:function(){var e,t=this;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t.element&&(t.element.remove(),t.element=void 0,delete t.element)},start:function(){},stop:function(){},eventHandlers:{MapLayerEvent:function(){var e,t,i=this._sandbox.findAllSelectedMapLayers();for(e=i.length-1;e>=0;--e)if(t=i[e],"STATS"===t._layerType&&!t.isBaseLayer()){t.isVisible()?this._visibilityOn():this._visibilityOff();break}},AfterMapLayerRemoveEvent:function(e){"STATS"===e.getMapLayer()._layerType&&this.resetUI()},AfterMapLayerAddEvent:function(e){"STATS"===e.getMapLayer()._layerType&&this._visibilityOn()},MapLayerVisibilityChangedEvent:function(e){if("STATS"===e.getMapLayer()._layerType){var t=e.getMapLayer().isVisible();t?this._visibilityOn():this._visibilityOff()}},AfterMapMoveEvent:function(){},"StatsGrid.SelectHilightsModeEvent":function(){this.isSelectHilightedMode=!0},"StatsGrid.ClearHilightsEvent":function(){this.isSelectHilightedMode=!1},"StatsGrid.StatsDataChangedEvent":function(e){this._layer=e.getLayer(),this._params=e.getParams(),this._params&&this._params.COL_VALUES&&0===this._params.COL_VALUES.length?this.sendEmptyValues(e):this.classifyData(e)}},setState:function(e){this._state=e,this._initState()},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},classifyData:function(){var e=this;if(e._layer){this._initState();var t,i,n,a,r,s,o=this._layer,l=this._params,u=l.CUR_COL,c=[],d=!1,h=[],p=!1,f=!0;if(u&&!(u&&u.field.indexOf("indicator")<0)){if(l.COL_VALUES.length<2&&(r=e.element.find(".classifications"),r.find(".block").remove(),a=jQuery(e.templates.block),a.append(jQuery(e.templates.classificationGuide).text(this._locale.select4Municipalities)),r.append(a),this.element.find("div.content").show()),t=e._state.methodId,e._hasNonNumericValues(l.COL_VALUES)?(p=!0,this._hideClassificationOptions(this.element)):(p=!1,this._showClassificationOptions(this.element)),e._state.numberOfClasses>l.COL_VALUES.length){var m=Math.max(2,l.COL_VALUES.length);this.rangeSlider.slider("option","value",m),jQuery("input#amount_class").val(m),e._state.numberOfClasses=m}var g=parseInt(e._state.numberOfClasses,10),v=l.COL_VALUES;v=v.slice(0);var y=l.VIS_CODES,b=new geostats(v),k=l.COL_VALUES;if(p)for(h=b.getUniqueValues(),g=h.length,_.times(g,function(){c.push([])}),n=0,s=k.length;s>n;n++)for(i=0;g>i;i++)h[i]===k[n]&&c[i].push(y[n]);else if("1"===t)h=b.getJenks(g);else if("2"===t){for(h=b.getQuantile(g),i=0;i<h.length;i++)if("undefined"==typeof h[i]){f=!1;break}}else if("3"===t)h=b.getEqInterval(g);else if("4"===t){if(h=this.setManualBreaks(b),!h)return;g=h.length-1}if(!f)return r=e.element.find(".classifications"),r.find(".block").remove(),a=jQuery(e.templates.block),a.append(""),r.append(a),void this.element.find("div.content").show();if(!p){for(i=0;g>i;i++)c[i]=[];for(n=0;n<k.length;n++){for(i=0;i<c.length;i++){if(parseFloat(k[n])>=h[i]&&parseFloat(k[n])<=h[i+1]){c[i].push(y[n]),d=!0;break}if(parseFloat(k[n])==h[i]&&parseFloat(k[n])==h[i+1]){c[i].push(y[n]),d=!0;break}}d?d=!1:c[c.length-1].push(y[n])}}var w=_.map(c,function(e){return e.join(",")}).join("|"),L=e._getColors(this.currentColorSet,e.colorsetIndex,g-2);e.colorsFlipped&&(L=L.split(",").reverse().join(","));var x=L.split(",");for(i=0;i<x.length;i++)x[i]="#"+x[i];b.setColors(x),e._state.manualBreaksInput=null!==e._state.manualBreaksInput&&void 0!==e._state.manualBreaksInput?e._state.manualBreaksInput.toString():"",L=L.replace(/,/g,"|");var S=e._state.classificationMode,O={methodId:t,numberOfClasses:g,manualBreaksInput:e._state.manualBreaksInput,colors:{set:e.currentColorSet,index:e.colorsetIndex,flipped:e.colorsFlipped},classificationMode:S,VIS_ID:-1,VIS_NAME:l.VIS_NAME,VIS_ATTR:l.VIS_ATTR,VIS_CLASSES:w,VIS_COLORS:"choro:"+L};if(this.statsService.sendVisualizationData(o,O),l.COL_VALUES.length>=2){var T=function(e){var t;return t=isNaN(e)||e%1===0?e:Math.round(10*e)/10},C=b.getHtmlLegend(null,u.name,!0,T,S);r=e.element.find(".classifications"),r.find(".block").remove(),a=jQuery(e.templates.block).clone(),a.append(C),r.append(a),this.element.find("div.content").show()}this._visibilityOn()}}},sendEmptyValues:function(e){var t=e.getLayer(),i=e.getParams();this.statsService.sendVisualizationData(t,{VIS_ID:-1,VIS_NAME:i.VIS_NAME,VIS_ATTR:i.VIS_ATTR,VIS_CLASSES:"",VIS_COLORS:"choro:"}),this.resetUI()},_hasNonNumericValues:function(e){var t,i,n;for(t=0,n=e.length;n>t;++t)if(i=e[t],void 0!==i&&isNaN(i))return!0;return!1},_hideClassificationOptions:function(e){e.find("div.classificationMethod").hide(),e.find("div.classCount").hide(),e.find("div.classificationMode").hide()},_showClassificationOptions:function(e){e.find("div.classificationMethod").show(),e.find("div.classCount").show(),e.find("div.classificationMode").show()},resetUI:function(){this.element=null,this._createUI()},_createUI:function(){var e=this;jQuery("div.manageClassificationPlugin").remove(),this.element=this.classify_temp.clone();var t=this.element.find("div.classheader");t.append(this._locale.classify.classify);var i,n,a=e.element.find("div.content"),r=jQuery('<div class="classifications">    <div class="classificationOptions">        <div class="classificationMethod"></div>        <div class="classCount">            <div class="countSlider"></div>            <div class="manualBreaks"></div>        </div>        <div class="classificationMode"></div>        <div class="classificationColors"></div>    </div></div>'),s=r.find(".classificationOptions"),o=[this._locale.classify.jenks,this._locale.classify.quantile,this._locale.classify.eqinterval,this._locale.classify.manual];if(e._state.allowClassification!==!1){s.find("div.classificationMethod").append(this._locale.classify.classifymethod+'<br><select class="method"></select><br>');var l=s.find("select.method");for(i=0;i<o.length;i++)n=jQuery('<option value="'+(i+1)+'">'+o[i]+"</option>"),l.append(n);l.change(function(){e._state.methodId=jQuery(this).val(),"4"===e._state.methodId?(jQuery(".countSlider").hide(),jQuery(".manualBreaks").show()):(jQuery(".manualBreaks").hide(),jQuery(".countSlider").show(),e.classifyData())});var u=s.find("div.classCount div.countSlider");u.append(this._locale.classify.classes).append('<input type="text" id="amount_class" readonly="readonly" value="5" /><div id="slider-range-max"></div>');var c=u.find("#slider-range-max").slider({range:"min",min:e.minClassNum,max:e.maxClassNum,value:e._state.numberOfClasses,slide:function(t,i){var n=i.value;n>e._params.COL_VALUES.length-1&&(n=Math.max(2,e._params.COL_VALUES.length-1)),e._state.numberOfClasses=n,jQuery("input#amount_class").val(n),e.classifyData(t)},stop:function(){jQuery(this).slider("option","value",e._state.numberOfClasses)}});this.rangeSlider=c;var d=s.find("div.manualBreaks");d.append('<input type="text" name="breaksInput" placeholder="'+this._locale.classify.manualPlaceholder+'"></input>').append('<div class="icon-info"></div>'),d.find("input[type=button]").click(function(){e._createColorDialog()}),d.find("input[name=breaksInput]").keypress(function(t){13===t.which&&(e._state.manualBreaksInput=e.element.find(".manualBreaks").find("input[name=breaksInput]").val(),e.classifyData())
}).focus(function(){e._sandbox.postRequestByName("DisableMapKeyboardMovementRequest")}).blur(function(){e._sandbox.postRequestByName("EnableMapKeyboardMovementRequest")}),d.find(".icon-info").click(function(){var t="<p>"+e._locale.classify.info+"</p>";e.showMessage(e._locale.classify.infoTitle,t)}),d.hide();var h=jQuery("<div>"+this._locale.classify.mode+'<br /><select class="classification-mode"></select><br /></div>'),p=["distinct","discontinuous"];jQuery.each(p,function(t,i){h.find("select.classification-mode").append('<option value="'+i+'">'+e._locale.classify.modes[i]+"</option>")}),h.find("select.classification-mode").change(function(t){e._state.classificationMode=jQuery(t.target).val(),e.classifyData()});var f=jQuery('<input type="button" value="'+e._locale.colorset.button+'" />');f.click(function(){e._createColorDialog()});var m=jQuery('<input type="button" value="'+e._locale.colorset.flipButton+'" />');m.click(function(){e._flipCurrentColors()}),s.find("div.classificationMode").append(h),s.find("div.classificationColors").append(f),s.find("div.classificationColors").append(m)}a.append(r),e._loadStateVariables(),t.click(function(){a.animate({height:"toggle"},500)});var g=jQuery(this._map.div),v=g.find("div");v&&0!==v.length?v.first().before(this.element):g.append(this.element),a.hide(),this._visibilityOff()},showMessage:function(e,t){var i=this;if(!this._published)if(i.messageDialog)i.messageDialog.close(!0),i.messageDialog=null;else{var n=this._locale,a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(n.buttons.ok),r.addClass("primary"),r.setHandler(function(){a.close(!0),i.messageDialog=null}),a.show(e,t,[r]),i.messageDialog=a}},setManualBreaks:function(e){var t,i,n=this,a=[],r=this._state.manualBreaksInput.split(",");return r.length-1<this.minClassNum||r.length-1>this.maxClassNum?(t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=this._locale.classify.manualRangeError.replace(/\{min\}/,this.minClassNum+1).replace(/\{max\}/,this.maxClassNum+1),t.show(null,i),t.fadeout(),null):(jQuery.each(r,function(e,r){var s=Number(r);return isNaN(s)?(t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=n._locale.classify.nanError,t.show(null,i),t.fadeout(),null):void a.push(s)}),e.bounds=a,e.setRanges(),a)},setColors:function(){this.colorsets_div=[{colorname:"BrBG",type:"div",colors:["d8b365,5ab4ac","d8b365,f5f5f5,5ab4ac","a6611a,dfc27d,80cdc1,018571","a6611a,dfc27d,f5f5f5,80cdc1,018571","8c510a,d8b365,f6e8c3,c7eae5,5ab4ac,01665e","8c510a,d8b365,f6e8c3,f5f5f5,c7eae5,5ab4ac,01665e","8c510a,bf812d,dfc27d,f6e8c3,c7eae5,80cdc1,35978f,01665e","8c510a,bf812d,dfc27d,f6e8c3,f5f5f5,c7eae5,80cdc1,35978f,01665e","543005,8c510a,bf812d,dfc27d,f6e8c3,c7eae5,80cdc1,35978f,01665e,003c30","543005,8c510a,bf812d,dfc27d,f6e8c3,f5f5f5,c7eae5,80cdc1,35978f,01665e,003c30"]},{colorname:"PiYG",type:"div",colors:["e9a3c9,a1d76a","e9a3c9,f7f7f7,a1d76a","d01c8b,f1b6da,b8e186,4dac26","d01c8b,f1b6da,f7f7f7,b8e186,4dac26","c51b7d,e9a3c9,fde0ef,e6f5d0,a1d76a,4d9221","c51b7d,e9a3c9,fde0ef,f7f7f7,e6f5d0,a1d76a,4d9221","c51b7d,de77ae,f1b6da,fde0ef,e6f5d0,b8e186,7fbc41,4d9221","c51b7d,de77ae,f1b6da,fde0ef,f7f7f7,e6f5d0,b8e186,7fbc41,4d9221","8e0152,c51b7d,de77ae,f1b6da,fde0ef,e6f5d0,b8e186,7fbc41,4d9221,276419","8e0152,c51b7d,de77ae,f1b6da,fde0ef,f7f7f7,e6f5d0,b8e186,7fbc41,4d9221,276419"]},{colorname:"PRGn",type:"div",colors:["af8dc3,7fbf7b","af8dc3,f7f7f7,7fbf7b","7b3294,c2a5cf,a6dba0,008837","7b3294,c2a5cf,f7f7f7,a6dba0,008837","762a83,af8dc3,e7d4e8,d9f0d3,7fbf7b,1b7837","762a83,af8dc3,e7d4e8,f7f7f7,d9f0d3,7fbf7b,1b7837","762a83,9970ab,c2a5cf,e7d4e8,d9f0d3,a6dba0,5aae61,1b7837","762a83,9970ab,c2a5cf,e7d4e8,f7f7f7,d9f0d3,a6dba0,5aae61,1b7837","40004b,762a83,9970ab,c2a5cf,e7d4e8,d9f0d3,a6dba0,5aae61,1b7837,00441b","40004b,762a83,9970ab,c2a5cf,e7d4e8,f7f7f7,d9f0d3,a6dba0,5aae61,1b7837,00441b"]},{colorname:"PuOr",type:"div",colors:["f1a340,998ec3","f1a340,f7f7f7,998ec3","e66101,fdb863,b2abd2,5e3c99","e66101,fdb863,f7f7f7,b2abd2,5e3c99","b35806,f1a340,fee0b6,d8daeb,998ec3,542788","b35806,f1a340,fee0b6,f7f7f7,d8daeb,998ec3,542788","b35806,e08214,fdb863,fee0b6,d8daeb,b2abd2,8073ac,542788","b35806,e08214,fdb863,fee0b6,f7f7f7,d8daeb,b2abd2,8073ac,542788","7f3b08,b35806,e08214,fdb863,fee0b6,d8daeb,b2abd2,8073ac,542788,2d004b","7f3b08,b35806,e08214,fdb863,fee0b6,f7f7f7,d8daeb,b2abd2,8073ac,542788,2d004b"]},{colorname:"RdBu",type:"div",colors:["ef8a62,67a9cf","ef8a62,f7f7f7,67a9cf","ca0020,f4a582,92c5de,0571b0","ca0020,f4a582,f7f7f7,92c5de,0571b0","b2182b,ef8a62,fddbc7,d1e5f0,67a9cf,2166ac","b2182b,ef8a62,fddbc7,f7f7f7,d1e5f0,67a9cf,2166ac","b2182b,d6604d,f4a582,fddbc7,d1e5f0,92c5de,4393c3,2166ac","b2182b,d6604d,f4a582,fddbc7,f7f7f7,d1e5f0,92c5de,4393c3,2166ac","67001f,b2182b,d6604d,f4a582,fddbc7,d1e5f0,92c5de,4393c3,2166ac,053061","67001f,b2182b,d6604d,f4a582,fddbc7,f7f7f7,d1e5f0,92c5de,4393c3,2166ac,053061"]},{colorname:"RdGy",type:"div",colors:["ef8a62,999999","ef8a62,ffffff,999999","ca0020,f4a582,bababa,404040","ca0020,f4a582,ffffff,bababa,404040","b2182b,ef8a62,fddbc7,e0e0e0,999999,4d4d4d","b2182b,ef8a62,fddbc7,ffffff,e0e0e0,999999,4d4d4d","b2182b,d6604d,f4a582,fddbc7,e0e0e0,bababa,878787,4d4d4d","b2182b,d6604d,f4a582,fddbc7,ffffff,e0e0e0,bababa,878787,4d4d4d","67001f,b2182b,d6604d,f4a582,fddbc7,e0e0e0,bababa,878787,4d4d4d,1a1a1a","67001f,b2182b,d6604d,f4a582,fddbc7,ffffff,e0e0e0,bababa,878787,4d4d4d,1a1a1a"]},{colorname:"RdYlBu",type:"div",colors:["fc8d59,91bfdb","fc8d59,ffffbf,91bfdb","d7191c,fdae61,abd9e9,2c7bb6","d7191c,fdae61,ffffbf,abd9e9,2c7bb6","d73027,fc8d59,fee090,e0f3f8,91bfdb,4575b4","d73027,fc8d59,fee090,ffffbf,e0f3f8,91bfdb,4575b4","d73027,f46d43,fdae61,fee090,e0f3f8,abd9e9,74add1,4575b4","d73027,f46d43,fdae61,fee090,ffffbf,e0f3f8,abd9e9,74add1,4575b4","a50026,d73027,f46d43,fdae61,fee090,e0f3f8,abd9e9,74add1,4575b4,313695","a50026,d73027,f46d43,fdae61,fee090,ffffbf,e0f3f8,abd9e9,74add1,4575b4,313695"]},{colorname:"RdYlGn",type:"div",colors:["fc8d59,91cf60","fc8d59,ffffbf,91cf60","d7191c,fdae61,a6d96a,1a9641","d7191c,fdae61,ffffbf,a6d96a,1a9641","d73027,fc8d59,fee08b,d9ef8b,91cf60,1a9850","d73027,fc8d59,fee08b,ffffbf,d9ef8b,91cf60,1a9850","d73027,f46d43,fdae61,fee08b,d9ef8b,a6d96a,66bd63,1a9850","d73027,f46d43,fdae61,fee08b,ffffbf,d9ef8b,a6d96a,66bd63,1a9850","a50026,d73027,f46d43,fdae61,fee08b,d9ef8b,a6d96a,66bd63,1a9850,006837","a50026,d73027,f46d43,fdae61,fee08b,ffffbf,d9ef8b,a6d96a,66bd63,1a9850,006837"]},{colorname:"Spectral",type:"div",colors:["fc8d59,99d594","fc8d59,ffffbf,99d594","d7191c,fdae61,abdda4,2b83ba","d7191c,fdae61,ffffbf,abdda4,2b83ba","d53e4f,fc8d59,fee08b,e6f598,99d594,3288bd","d53e4f,fc8d59,fee08b,ffffbf,e6f598,99d594,3288bd","d53e4f,f46d43,fdae61,fee08b,e6f598,abdda4,66c2a5,3288bd","d53e4f,f46d43,fdae61,fee08b,ffffbf,e6f598,abdda4,66c2a5,3288bd","9e0142,d53e4f,f46d43,fdae61,fee08b,e6f598,abdda4,66c2a5,3288bd,5e4fa2","9e0142,d53e4f,f46d43,fdae61,fee08b,ffffbf,e6f598,abdda4,66c2a5,3288bd,5e4fa2"]}],this.colorsets_seq=[{colorname:"Blues",type:"seq",colors:["deebf7,3182bd","deebf7,9ecae1,3182bd","eff3ff,bdd7e7,6baed6,2171b5","eff3ff,bdd7e7,6baed6,3182bd,08519c","eff3ff,c6dbef,9ecae1,6baed6,3182bd,08519c","eff3ff,c6dbef,9ecae1,6baed6,4292c6,2171b5,084594","f7fbff,deebf7,c6dbef,9ecae1,6baed6,4292c6,2171b5,084594","f7fbff,deebf7,c6dbef,9ecae1,6baed6,4292c6,2171b5,08519c,08306b"]},{colorname:"BuGn",type:"seq",colors:["e5f5f9,2ca25f","e5f5f9,99d8c9,2ca25f","edf8fb,b2e2e2,66c2a4,238b45","edf8fb,b2e2e2,66c2a4,2ca25f,006d2c","edf8fb,ccece6,99d8c9,66c2a4,2ca25f,006d2c","edf8fb,ccece6,99d8c9,66c2a4,41ae76,238b45,005824","f7fcfd,e5f5f9,ccece6,99d8c9,66c2a4,41ae76,238b45,005824","f7fcfd,e5f5f9,ccece6,99d8c9,66c2a4,41ae76,238b45,006d2c,00441b"]},{colorname:"BuPu",type:"seq",colors:["e0ecf4,8856a7","e0ecf4,9ebcda,8856a7","edf8fb,b3cde3,8c96c6,88419d","edf8fb,b3cde3,8c96c6,8856a7,810f7c","edf8fb,bfd3e6,9ebcda,8c96c6,8856a7,810f7c","edf8fb,bfd3e6,9ebcda,8c96c6,8c6bb1,88419d,6e016b","f7fcfd,e0ecf4,bfd3e6,9ebcda,8c96c6,8c6bb1,88419d,6e016b","f7fcfd,e0ecf4,bfd3e6,9ebcda,8c96c6,8c6bb1,88419d,810f7c,4d004b"]},{colorname:"GnBu",type:"seq",colors:["e0f3db,43a2ca","e0f3db,a8ddb5,43a2ca","f0f9e8,bae4bc,7bccc4,2b8cbe","f0f9e8,bae4bc,7bccc4,43a2ca,0868ac","f0f9e8,ccebc5,a8ddb5,7bccc4,43a2ca,0868ac","f0f9e8,ccebc5,a8ddb5,7bccc4,4eb3d3,2b8cbe,08589e","f7fcf0,e0f3db,ccebc5,a8ddb5,7bccc4,4eb3d3,2b8cbe,08589e","f7fcf0,e0f3db,ccebc5,a8ddb5,7bccc4,4eb3d3,2b8cbe,0868ac,084081"]},{colorname:"Greens",type:"seq",colors:["e5f5e0,31a354","e5f5e0,a1d99b,31a354","edf8e9,bae4b3,74c476,238b45","edf8e9,bae4b3,74c476,31a354,006d2c","edf8e9,c7e9c0,a1d99b,74c476,31a354,006d2c","edf8e9,c7e9c0,a1d99b,74c476,41ab5d,238b45,005a32","f7fcf5,e5f5e0,c7e9c0,a1d99b,74c476,41ab5d,238b45,005a32","f7fcf5,e5f5e0,c7e9c0,a1d99b,74c476,41ab5d,238b45,006d2c,00441b"]},{colorname:"Greys",type:"seq",colors:["f0f0f0,636363","f0f0f0,bdbdbd,636363","f7f7f7,cccccc,969696,525252","f7f7f7,cccccc,969696,636363,252525","f7f7f7,d9d9d9,bdbdbd,969696,636363,252525","f7f7f7,d9d9d9,bdbdbd,969696,737373,525252,252525","ffffff,f0f0f0,d9d9d9,bdbdbd,969696,737373,525252,252525","ffffff,f0f0f0,d9d9d9,bdbdbd,969696,737373,525252,252525,000000"]},{colorname:"Oranges",type:"seq",colors:["fee6ce,e6550d","fee6ce,fdae6b,e6550d","feedde,fdbe85,fd8d3c,d94701","feedde,fdbe85,fd8d3c,e6550d,a63603","feedde,fdd0a2,fdae6b,fd8d3c,e6550d,a63603","feedde,fdd0a2,fdae6b,fd8d3c,f16913,d94801,8c2d04","fff5eb,fee6ce,fdd0a2,fdae6b,fd8d3c,f16913,d94801,8c2d04","fff5eb,fee6ce,fdd0a2,fdae6b,fd8d3c,f16913,d94801,a63603,7f2704"]},{colorname:"OrRd",type:"seq",colors:["fee8c8,e34a33","fee8c8,fdbb84,e34a33","fef0d9,fdcc8a,fc8d59,d7301f","fef0d9,fdcc8a,fc8d59,e34a33,b30000","fef0d9,fdd49e,fdbb84,fc8d59,e34a33,b30000","fef0d9,fdd49e,fdbb84,fc8d59,ef6548,d7301f,990000","fff7ec,fee8c8,fdd49e,fdbb84,fc8d59,ef6548,d7301f,990000","fff7ec,fee8c8,fdd49e,fdbb84,fc8d59,ef6548,d7301f,b30000,7f0000"]},{colorname:"PuBu",type:"seq",colors:["ece7f2,2b8cbe","ece7f2,a6bddb,2b8cbe","f1eef6,bdc9e1,74a9cf,0570b0","f1eef6,bdc9e1,74a9cf,2b8cbe,045a8d","f1eef6,d0d1e6,a6bddb,74a9cf,2b8cbe,045a8d","f1eef6,d0d1e6,a6bddb,74a9cf,3690c0,0570b0,034e7b","fff7fb,ece7f2,d0d1e6,a6bddb,74a9cf,3690c0,0570b0,034e7b","fff7fb,ece7f2,d0d1e6,a6bddb,74a9cf,3690c0,0570b0,045a8d,023858"]},{colorname:"PuBuGn",type:"seq",colors:["ece2f0,1c9099","ece2f0,a6bddb,1c9099","f6eff7,bdc9e1,67a9cf,02818a","f6eff7,bdc9e1,67a9cf,1c9099,016c59","f6eff7,d0d1e6,a6bddb,67a9cf,1c9099,016c59","f6eff7,d0d1e6,a6bddb,67a9cf,3690c0,02818a,016450","fff7fb,ece2f0,d0d1e6,a6bddb,67a9cf,3690c0,02818a,016450","fff7fb,ece2f0,d0d1e6,a6bddb,67a9cf,3690c0,02818a,016c59,014636"]},{colorname:"PuRd",type:"seq",colors:["e7e1ef,dd1c77","e7e1ef,c994c7,dd1c77","f1eef6,d7b5d8,df65b0,ce1256","f1eef6,d7b5d8,df65b0,dd1c77,980043","f1eef6,d4b9da,c994c7,df65b0,dd1c77,980043","f1eef6,d4b9da,c994c7,df65b0,e7298a,ce1256,91003f","f7f4f9,e7e1ef,d4b9da,c994c7,df65b0,e7298a,ce1256,91003f","f7f4f9,e7e1ef,d4b9da,c994c7,df65b0,e7298a,ce1256,980043,67001f"]},{colorname:"Purples",type:"seq",colors:["efedf5,756bb1","efedf5,bcbddc,756bb1","f2f0f7,cbc9e2,9e9ac8,6a51a3","f2f0f7,cbc9e2,9e9ac8,756bb1,54278f","f2f0f7,dadaeb,bcbddc,9e9ac8,756bb1,54278f","f2f0f7,dadaeb,bcbddc,9e9ac8,807dba,6a51a3,4a1486","fcfbfd,efedf5,dadaeb,bcbddc,9e9ac8,807dba,6a51a3,4a1486","fcfbfd,efedf5,dadaeb,bcbddc,9e9ac8,807dba,6a51a3,54278f,3f007d"]},{colorname:"RdPu",type:"seq",colors:["fde0dd,c51b8a","fde0dd,fa9fb5,c51b8a","feebe2,fbb4b9,f768a1,ae017e","feebe2,fbb4b9,f768a1,c51b8a,7a0177","feebe2,fcc5c0,fa9fb5,f768a1,c51b8a,7a0177","feebe2,fcc5c0,fa9fb5,f768a1,dd3497,ae017e,7a0177","fff7f3,fde0dd,fcc5c0,fa9fb5,f768a1,dd3497,ae017e,7a0177","fff7f3,fde0dd,fcc5c0,fa9fb5,f768a1,dd3497,ae017e,7a0177,49006a"]},{colorname:"Reds",type:"seq",colors:["fee0d2,de2d26","fee0d2,fc9272,de2d26","fee5d9,fcae91,fb6a4a,cb181d","fee5d9,fcae91,fb6a4a,de2d26,a50f15","fee5d9,fcbba1,fc9272,fb6a4a,de2d26,a50f15","fee5d9,fcbba1,fc9272,fb6a4a,ef3b2c,cb181d,99000d","fff5f0,fee0d2,fcbba1,fc9272,fb6a4a,ef3b2c,cb181d,99000d","fff5f0,fee0d2,fcbba1,fc9272,fb6a4a,ef3b2c,cb181d,a50f15,67000d"]},{colorname:"YlGn",type:"seq",colors:["f7fcb9,31a354","f7fcb9,addd8e,31a354","ffffcc,c2e699,78c679,238443","ffffcc,c2e699,78c679,31a354,006837","ffffcc,d9f0a3,addd8e,78c679,31a354,006837","ffffcc,d9f0a3,addd8e,78c679,41ab5d,238443,005a32","ffffe5,f7fcb9,d9f0a3,addd8e,78c679,41ab5d,238443,005a32","ffffe5,f7fcb9,d9f0a3,addd8e,78c679,41ab5d,238443,006837,004529"]},{colorname:"YlGnBu",type:"seq",colors:["edf8b1,2c7fb8","edf8b1,7fcdbb,2c7fb8","ffffcc,a1dab4,41b6c4,225ea8","ffffcc,a1dab4,41b6c4,2c7fb8,253494","ffffcc,c7e9b4,7fcdbb,41b6c4,2c7fb8,253494","ffffcc,c7e9b4,7fcdbb,41b6c4,1d91c0,225ea8,0c2c84","ffffd9,edf8b1,c7e9b4,7fcdbb,41b6c4,1d91c0,225ea8,0c2c84","ffffd9,edf8b1,c7e9b4,7fcdbb,41b6c4,1d91c0,225ea8,253494,081d58"]},{colorname:"YlOrBr",type:"seq",colors:["fff7bc,d95f0e","fff7bc,fec44f,d95f0e","ffffd4,fed98e,fe9929,cc4c02","ffffd4,fed98e,fe9929,d95f0e,993404","ffffd4,fee391,fec44f,fe9929,d95f0e,993404","ffffd4,fee391,fec44f,fe9929,ec7014,cc4c02,8c2d04","ffffe5,fff7bc,fee391,fec44f,fe9929,ec7014,cc4c02,8c2d04","ffffe5,fff7bc,fee391,fec44f,fe9929,ec7014,cc4c02,993404,662506"]},{colorname:"YlOrRd",type:"seq",colors:["ffeda0,f03b20","ffeda0,feb24c,f03b20","ffffb2,fecc5c,fd8d3c,e31a1c","ffffb2,fecc5c,fd8d3c,f03b20,bd0026","ffffb2,fed976,feb24c,fd8d3c,f03b20,bd0026","ffffb2,fed976,feb24c,fd8d3c,fc4e2a,e31a1c,b10026","ffffcc,ffeda0,fed976,feb24c,fd8d3c,fc4e2a,e31a1c,b10026","ffffcc,ffeda0,fed976,feb24c,fd8d3c,fc4e2a,e31a1c,bd0026,800026"]}],this.colorsets_qual=[{colorname:"Accent",type:"qual",colors:["7fc97f,fdc086","7fc97f,beaed4,fdc086","7fc97f,beaed4,fdc086,ffff99","7fc97f,beaed4,fdc086,ffff99,386cb0","7fc97f,beaed4,fdc086,ffff99,386cb0,f0027f","7fc97f,beaed4,fdc086,ffff99,386cb0,f0027f,bf5b17","7fc97f,beaed4,fdc086,ffff99,386cb0,f0027f,bf5b17,666666"]},{colorname:"Dark2",type:"qual",colors:["1b9e77,7570b3","1b9e77,d95f02,7570b3","1b9e77,d95f02,7570b3,e7298a","1b9e77,d95f02,7570b3,e7298a,66a61e","1b9e77,d95f02,7570b3,e7298a,66a61e,e6ab02","1b9e77,d95f02,7570b3,e7298a,66a61e,e6ab02,a6761d","1b9e77,d95f02,7570b3,e7298a,66a61e,e6ab02,a6761d,666666"]},{colorname:"Paired",type:"qual",colors:["a6cee3,b2df8a","a6cee3,1f78b4,b2df8a","a6cee3,1f78b4,b2df8a,33a02c","a6cee3,1f78b4,b2df8a,33a02c,fb9a99","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c,fdbf6f","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c,fdbf6f,ff7f00","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c,fdbf6f,ff7f00,cab2d6","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c,fdbf6f,ff7f00,cab2d6,6a3d9a","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c,fdbf6f,ff7f00,cab2d6,6a3d9a,ffff99","a6cee3,1f78b4,b2df8a,33a02c,fb9a99,e31a1c,fdbf6f,ff7f00,cab2d6,6a3d9a,ffff99,b15928"]},{colorname:"Pastel1",type:"qual",colors:["bb4ae,ccebc5","bb4ae,b3cde3,ccebc5","fbb4ae,b3cde3,ccebc5,decbe4","fbb4ae,b3cde3,ccebc5,decbe4,fed9a6","fbb4ae,b3cde3,ccebc5,decbe4,fed9a6,ffffcc","fbb4ae,b3cde3,ccebc5,decbe4,fed9a6,ffffcc,e5d8bd","fbb4ae,b3cde3,ccebc5,decbe4,fed9a6,ffffcc,e5d8bd,fddaec","fbb4ae,b3cde3,ccebc5,decbe4,fed9a6,ffffcc,e5d8bd,fddaec,f2f2f2"]},{colorname:"Pastel2",type:"qual",colors:["b3e2cd,cbd5e8","b3e2cd,fdcdac,cbd5e8","b3e2cd,fdcdac,cbd5e8,f4cae4","b3e2cd,fdcdac,cbd5e8,f4cae4,e6f5c9","b3e2cd,fdcdac,cbd5e8,f4cae4,e6f5c9,fff2ae","b3e2cd,fdcdac,cbd5e8,f4cae4,e6f5c9,fff2ae,f1e2cc","b3e2cd,fdcdac,cbd5e8,f4cae4,e6f5c9,fff2ae,f1e2cc,cccccc"]},{colorname:"Set1",type:"qual",colors:["e41a1c,4daf4a","e41a1c,377eb8,4daf4a","e41a1c,377eb8,4daf4a,984ea3","e41a1c,377eb8,4daf4a,984ea3,ff7f00","e41a1c,377eb8,4daf4a,984ea3,ff7f00,ffff33","e41a1c,377eb8,4daf4a,984ea3,ff7f00,ffff33,a65628","e41a1c,377eb8,4daf4a,984ea3,ff7f00,ffff33,a65628,f781bf","e41a1c,377eb8,4daf4a,984ea3,ff7f00,ffff33,a65628,f781bf,999999"]},{colorname:"Set2",type:"qual",colors:["66c2a5,8da0cb","66c2a5,fc8d62,8da0cb","66c2a5,fc8d62,8da0cb,e78ac3","66c2a5,fc8d62,8da0cb,e78ac3,a6d854","66c2a5,fc8d62,8da0cb,e78ac3,a6d854,ffd92f","66c2a5,fc8d62,8da0cb,e78ac3,a6d854,ffd92f,e5c494","66c2a5,fc8d62,8da0cb,e78ac3,a6d854,ffd92f,e5c494,b3b3b3"]},{colorname:"Set3",type:"qual",colors:["8dd3c7,bebada","8dd3c7,ffffb3,bebada","8dd3c7,ffffb3,bebada,fb8072","8dd3c7,ffffb3,bebada,fb8072,80b1d3","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462,b3de69","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462,b3de69,fccde5","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462,b3de69,fccde5,d9d9d9","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462,b3de69,fccde5,d9d9d9,bc80bd","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462,b3de69,fccde5,d9d9d9,bc80bd,ccebc5","8dd3c7,ffffb3,bebada,fb8072,80b1d3,fdb462,b3de69,fccde5,d9d9d9,bc80bd,ccebc5,ffed6f"]}]},_getColors:function(e,t,i){var n=null;return n="div"===e?this.colorsets_div[t].colors[i]:"qual"===e?this.colorsets_qual[t].colors[i]:this.colorsets_seq[t].colors[i]},_visibilityOn:function(){this.element.show()},_visibilityOff:function(){this.element.hide()},_createColorDialog:function(){var e=this;if(e.dialog)return e.dialog.close(!0),void(e.dialog=null);e.dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),e.content=e.templateContent.clone();var t=jQuery('<div class="colorset_stats"><br>'+this._locale.colorset.setselection+'<br><select id="colo_set"></select><br></div>');e.content.append(t);var i=t.find("select"),n=jQuery('<option value="seq">'+this._locale.colorset.sequential+"</option>");i.append(n),n=jQuery('<option value="qual">'+this._locale.colorset.qualitative+"</option>"),i.append(n),n=jQuery('<option value="div">'+this._locale.colorset.divergent+"</option>"),i.append(n),i.change(function(){e._colorTableChanged()}),i.attr("value",e.currentColorSet),e.content.append(i);var a=e.templateInstructions2.clone(),r=Oskari.clazz.create("Oskari.userinterface.component.Button");a.append(this._locale.colorset.info2),e.content.append(a),e.content.append(e._createColorTable()),e._hiliSelectedColors(),r.setTitle(this._locale.colorset.cancel),r.addClass("primary"),r.setHandler(function(){e.dialog.close(!0),e.dialog=null}),e.dialog.addClass("tools_selection"),e.dialog.show(this._locale.colorset.themeselection,e.content,[r])},_createColorTable:function(){var e=this,t=jQuery('<table class="colo_table1"></table>'),i=5,n=null,a=3;"div"===e.currentColorSet?(i=this.colorsets_div.length,n=e.colorsets_div):"qual"===e.currentColorSet?(i=e.colorsets_qual.length,n=this.colorsets_qual):(i=e.colorsets_seq.length,n=e.colorsets_seq);var r,s,o,l,u,c,d,h=5,p=jQuery("<tbody></tbody>"),f=function(){var t=jQuery(this).attr("data-colorIdx");e._selectedColors(t)},m=function(){jQuery(this).removeClass("hover")},g=function(){jQuery(this).hasClass("selected")||jQuery(this).addClass("hover")};for(r=0;i>r;r++){for(s=jQuery("<td></td>"),s.attr("data-colorIdx",r),o=n[r].colors[a],l=o.split(","),u=jQuery("<div></div>"),c=0;h>c;c++)d=u.clone(),d.css("background-color","#"+l[c]),s.append(d);s.mouseover(g),s.mouseout(m),s.click(f),p.append(s)}return t.append(p),t},_selectedColors:function(e){var t=this;t.colorsetIndex=e,t._hiliSelectedColors(),t.currentColorSet=t.content.find("select#colo_set").val(),t.classifyData()},_hiliSelectedColors:function(){var e,t=this;t.content&&(e="div"===t.currentColorSet?t.colorsets_div.length:"qual"===t.currentColorSet?t.colorsets_qual.length:t.colorsets_seq.length,t.content.find("td").removeClass("selected"),t.content.find("td[data-colorIdx="+t.colorsetIndex.toString()+"]").addClass("selected"))},_hoverZoomColorTable:function(e){var t=e.clone();t.find("div").width("18px");var i=jQuery('<table class="table_temp"></table>'),n=jQuery("<tbody></tbody>");n.append(t),i.append(n);var a=jQuery('<div id="pop-up_06052013">  </div>');a.append(i),e.append(a),a.hide(),e.hover(function(){jQuery(this).find("div#pop-up_06052013").fadeIn("slow")},function(){jQuery(this).find("div#pop-up_06052013").fadeOut("slow")})},_colorTableChanged:function(){var e=this;if(e.content){e.currentColorSet=e.content.find("select#colo_set").val(),e.content.find(".colo_table1").remove();var t=e._createColorTable(),i=5,n=2,a=9;"div"===e.currentColorSet?(i=this.colorsets_div.length,a=11):"qual"===e.currentColorSet?(i=e.colorsets_qual.length,a=8):i=e.colorsets_seq.length,e.colorsetIndex>i&&(e.colorsetIndex=i-1);var r=Number(e.element.find(".classificationMethod").find(".classCount").find("#amount_class").val());r>a&&(r=a,e.element.find(".classificationMethod").find(".classCount").find("#amount_class").attr("value",a));var s=e.element.find(".classificationMethod").find(".classCount");s.find("#slider-range-max").remove();var o=jQuery('<div id="slider-range-max"></div>');s.append(o),s.find("#slider-range-max").slider({range:"min",min:n,max:a,value:r,slide:function(t,i){jQuery("input#amount_class").val(i.value),jQuery(this).slider("option","value",i.value),e.classifyData()}}),e.content.find(".instructions2").append(t),e._hiliSelectedColors()}},_flipCurrentColors:function(){this.colorsFlipped=this.colorsFlipped?!1:!0,this.classifyData()},_adjustClassificationSlider:function(e){var t=jQuery("#slider-range-max"),i=t.slider("option","value"),n=this._checkClassCount(e,i),a=n.max;return i=n.val,t.slider("option","min",2),t.slider("option","max",a),t.slider("option","value",i),3>a?t.slider("option","disabled",!0):t.slider("option","disabled",!1),jQuery("input#amount_class").val(i),t},_checkClassCount:function(e,t){var i=2,n=e<this.maxClassNum?e>2?e:3:this.maxClassNum;n--;var a=Math.max(i,Math.min(t,n));return{min:i,max:n,value:a}},_loadStateVariables:function(){var e=this,t=this._state;if(t.colors&&(e.currentColorSet=t.colors.set,e.colorsetIndex=t.colors.index,e.colorsFlipped=t.colors.flipped),e._state.allowClassification!==!1){if(t.classificationMode){var i=e.element.find(".classification-mode");i.val(t.classificationMode)}if(null!==t.methodId&&void 0!==t.methodId&&t.methodId>0){var n=e.element.find(".classificationMethod").find(".method");if(n.val(t.methodId),"4"===t.methodId&&t.manualBreaksInput){var a=e.element.find(".manualBreaks").find("input[name=breaksInput]");a.val(t.manualBreaksInput),e.element.find(".countSlider").hide(),e.element.find(".manualBreaks").show()}}if(null!==t.numberOfClasses&&void 0!==t.numberOfClasses&&t.numberOfClasses>0){var r=e.rangeSlider;null!==r&&void 0!==r&&(r.slider("value",t.numberOfClasses),r.parent().find("input#amount_class").val(t.numberOfClasses))}}},showClassificationOptions:function(e){this._state.allowClassification=e,this.resetUI(),this.classifyData(),this._visibilityOn()}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/statistics/bundle/statsgrid/plugin/ManageClassificationPlugin",function(){}),define("src/statistics/statsgrid/plugin/ManageClassificationPlugin",["jquery-ui","bundles/statistics/bundle/statsgrid/plugin/ManageClassificationPlugin"],function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.plugin.ManageStatsPlugin",function(e,t){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._layer=null,this._state=null,this.element=void 0,this.statsService=null,this.userIndicatorsService=void 0,this.indicators=[],this.stateIndicatorsLoaded=!1,this.indicatorsData={},this.indicatorsMeta={},this.selectedMunicipalities={},this.popups=[];var i={statistics:[{id:"min",visible:!0},{id:"max",visible:!0},{id:"avg",visible:!0},{id:"mde",visible:!0},{id:"mdn",visible:!0},{id:"std",visible:!0},{id:"sum",visible:!0}]};this.conf=jQuery.extend(!0,e,i),this._locale=t||{},this.templates={csvButton:'<button class="statsgrid-csv-button">csv</button>',statsgridTotalsVar:'<span class="statsgrid-variable"></span>',subHeader:'<span class="statsgrid-grid-subheader"></span>',gridHeaderMenu:'<li><input type="checkbox" /><label></label></li>',groupingHeader:'<span style="color:green"></span>',toolbarButton:'<button class="statsgrid-select-municipalities"></button>',filterPopup:'<div class="indicator-filter-popup"><p class="filter-desc"></p><div class="filter-container"></div></div>',filterRow:'<div class="filter-row"><div class="filter-label"></div><div class="filter-value"></div></div>',filterSelect:'<div><select class="filter-select"></select><div class="filter-inputs-container"></div></div>',filterOption:"<option></option>",filterInputs:'<input type="text" class="filter-input filter-input1" /><span class="filter-between" style="display:none;">-</span><input type="text" class="filter-input filter-input2" style="display:none;" />',filterLink:'<a href="javascript:void(0);"></a>',filterByRegion:'<div id="statsgrid-filter-by-region"><p class="filter-desc"></p><div class="filter-container"></div></div>',regionCatSelect:'<div class="filter-region-category-select"><select></select></div>',regionSelect:'<div class="filter-region-select"><select class="filter-region-select" multiple tabindex="3"></select></div>',addOwnIndicator:'<div class="new-indicator-cont"><input type="button"/></div>',cannotDisplayIndicator:'<p class="cannot-display-indicator"></p>'},this.regionCategories={},this._selectedRegionCategory=void 0,this._defaultRegionCategory="KUNTA",this._dataSources={}},{__name:"ManageStatsPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},register:function(){},unregister:function(){},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this.statsService=e.getService("Oskari.statistics.bundle.statsgrid.StatisticsService"),this.userIndicatorsService=e.getService("Oskari.statistics.bundle.statsgrid.UserIndicatorsService"),this._published=this.conf.published||!1,this._state=this.conf.state||{},this._layer=this.conf.layer||null,this.selectMunicipalitiesMode=!1},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this.element&&(this.element.remove(),this.element=void 0,delete this.element)},eventHandlers:{"MapStats.FeatureHighlightedEvent":function(e){this.selectMunicipalitiesMode?this._featureSelectedEvent(e):this._featureHighlightedEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},getLayer:function(){return this._layer},setLayer:function(e){this._layer=e},setState:function(e){this._state=e},getState:function(){return this._state},createStatsOut:function(e){var t=this.getLayer();null!==t&&void 0!==t&&(this._acceptedRegionCategories=t.getCategoryMappings().categories,this.prepareIndicatorParams(e),e.on("keyup",function(e){e.stopPropagation()}),e.on("keydown",function(e){e.stopPropagation()}))},prepareIndicatorParams:function(e){if(!this._published){e.append(this.createDataSourceSelect(e)),e.find(".selectors-container").remove();var t=jQuery('<div class="selectors-container"></div>');e.append(t);var i=this;if(i.conf.csvDownload){var n=jQuery(i.templates.csvButton);t.append(n),n.click(function(){if(i.dataView){var e=i.dataView.getItems();i.downloadJSON2CSV(e)}})}this.getStatsIndicators(e)}this.getStatsRegionData(e)},createDataSourceSelect:function(e){var t=this,i=jQuery('<div class="data-source-select clearfix"><div class="selector-cont"><label for="statsgrid-data-source-select"></label><select id="statsgrid-data-source-select" class="indi"></select></div></div>'),n=i.find("select");return i.find("label").text(this._locale.tab.grid.organization),_.each(this._dataSources,function(e,i){t._renderDataSourcesToList(i,e.name,!1,n)}),n.on("change",function(i){t.changeDataSource(i.target.value,e)}),n.css({width:"191px"}),n.chosen({no_results_text:this._locale.noDataSource,placeholder_text:this._locale.selectDataSource}),i},addDataSource:function(e,t,i,n,a){this._dataSources[e]={data:i,name:t},this._renderDataSourcesToList(e,t,n,a)},updateDataSource:function(e,t){var i,n=this._dataSources[e];n&&(n.data.push(t),i=jQuery("#indi"),i.trigger("liszt:update"))},_renderDataSourcesToList:function(e,t,i,n){var a,r=n||jQuery("#statsgrid-data-source-select");r.length&&(a=jQuery("<option></option>"),a.val(e).text(t),i===!0&&a.prop("selected",!0),r.append(a),r.trigger("liszt:updated"))},changeDataSource:function(e,t){var i=this._dataSources[e];void 0!==i&&null!==i&&(t.find(".selectors-container").empty(),this.createIndicatorsSelect(t,i.data),this.createDemographicsSelects(t,null))},getStatsRegionData:function(e){var t=this;t.statsService.fetchStatsData(t._sandbox.getAjaxUrl()+"action_route=GetSotkaData&action=regions&version=1.1",function(i){i?(t.setRegionCategories(i),t.createMunicipalitySlickGrid(e,i),t._state&&t.loadStateIndicators(t._state,e)):t.showMessage(t._locale.stats.errorTitle,t._locale.stats.regionDataError)},function(){t.showMessage(t._locale.stats.errorTitle,t._locale.stats.regionDataXHRError)})},setRegionCategories:function(e){var t=this,i=Oskari.getLang(),n=t._acceptedRegionCategories;this.regionCategories=_.foldl(e,function(e,t){return _.contains(n,t.category)&&(e[t.category]||(e[t.category]=[]),e[t.category].push({id:t.id,code:t.code,title:t.title[i],municipality:t.title[i],memberOf:t.memberOf})),e},this.regionCategories||{})},createMunicipalitySlickGrid:function(e,t){var i,n,a=this,r=jQuery('<div id="municipalGrid" class="municipal-grid"></div>');e.find(".municipal-grid").remove(),e.append(r),this._selectedRegionCategory=this._state.regionCategory||this._defaultRegionCategory,this._setLayerToCategory(this._selectedRegionCategory),n=new Slick.CheckboxSelectColumn2({cssClass:"slick-cell-checkboxsel"}),this.checkboxSelector=n;var s=[a.checkboxSelector.getColumnDefinition(),{id:"municipality",name:this._locale.regionCategories[this._selectedRegionCategory],field:"municipality",sortable:!0}],o={enableCellNavigation:!0,enableColumnReorder:!0,multiColumnSort:!0,showHeaderRow:!0,headerRowHeight:152},l=_.foldl(t,function(e,t){return t.category===a._selectedRegionCategory&&e.push({id:t.id,code:t.code,municipality:t.title[Oskari.getLang()],memberOf:t.memberOf,sel:"checked"}),e},[]),u=new Slick.Data.GroupItemMetadataProvider,c=new Slick.Data.DataView({groupItemMetadataProvider:u,inlineFilters:!0});c.onRowsChanged.subscribe(function(e,t){i.invalidateRows(t.rows),i.render(),i.updateRowCount(),i.resizeCanvas()}),c.setGrouping({getter:"sel",comparer:function(e,t){var i=-1;return"checked"===e.groupingKey&&e.groupingKey===t.groupingKey?i=0:e.groupingKey<t.groupingKey&&(i=1),i},formatter:function(e){var t=("checked"===e.groupingKey?a._locale.included:a._locale.not_included)+" ("+e.count+")";return'<span style="color:green">'+t+"</span>"},aggregateCollapsed:!1}),i=new Slick.Grid(r,c,s,o);i.onSort.subscribe(function(e,t){var n=jQuery(e.target);if(n.hasClass("slick-header-menubutton")||n.parent().hasClass("slick-header-menubutton"))return!1;var r=t.sortCols;c.sort(function(e,t){var i,n,s,o,l,u;for(i=0,u=r.length;u>i;i++){if(n=r[i].sortCol.field,s=r[i].sortAsc?1:-1,o=a._numerizeValue(e[n]),l=a._numerizeValue(t[n]),null===o||void 0===o)return 1;if(null===l||void 0===l)return-1;var c=(o===l?0:o>l?1:-1)*s;if(0!==c)return c}return 0}),i.invalidate(),i.render()}),i.onHeaderClick.subscribe(function(e,t){return t.column.id===a._state.currentColumn?!1:void a.sendStatsData(t.column)}),i.onHeaderRowCellRendered.subscribe(function(e,t){jQuery(t.node).empty(),jQuery(a.templates.subHeader).appendTo(t.node)}),i.onColumnsReordered.subscribe(function(){a.dataView.refresh()}),i.registerPlugin(n),i.registerPlugin(u),n.onSelectRowClicked.subscribe(function(e,t){var i=t.grid.getData(),n=i.getItem(t.row),r=i.getGroups().length;n.sel=jQuery(e.target).is(":checked")?"checked":"empty",i.updateItem(n.id,n);var s=i.getGroups();if(s.length>1){var o,l;for(o=0;o<s.length;o++)l=s[o],"empty"===l.groupingKey&&l.count<2&&1===r&&i.collapseGroup("empty")}var u=a._getColumnById(a._state.currentColumn);a.sendStatsData(u),t.grid.setColumns(t.grid.getColumns()),i.refresh()
}),n.onSelectHeaderRowClicked.subscribe(function(){var e=a._getColumnById(a._state.currentColumn);a.sendStatsData(e)}),a._initHeaderPlugin(s,i);var d=new Slick.Plugins.HeaderButtons;i.registerPlugin(d),c.beginUpdate(),c.setItems(l),c.endUpdate(),i.invalidate(),i.render(),a.grid=i,a.dataView=c,s=i.getColumns(),s[1].width=318,a.setGridHeight();var h;jQuery(window).resize(function(){clearTimeout(h),h=setTimeout(function(){a.setGridHeight()},100)}),jQuery(".slick-header-columns").children().eq(1).trigger("click")},setGridHeight:function(){var e=jQuery("#municipalGrid"),t=e.parent(),i=t.find(".selectors-container"),n=0;i.length>0&&(n=i.outerHeight()),e.height(t.height()-n),this.grid.resizeCanvas()},getIdxByCode:function(e){var t=this.getItemByCode(e);if(t){var i=this.dataView.getRowById(t.id);return i||-1}return null},getItemByCode:function(e){var t=this.dataView?this.dataView.getItems():[];return _.find(t,function(t){return e===t.code})},getStatsIndicators:function(e){var t=this,i=t._sandbox;t.statsService.fetchStatsData(i.getAjaxUrl()+"action_route=GetSotkaData&action=indicators&version=1.1",function(i){i?(t.addDataSource("sotkanet","SOTKAnet",i,!0),t.createIndicatorsSelect(e,i),t.createDemographicsSelects(e,null)):t.showMessage(t._locale.stats.errorTitle,t._locale.stats.indicatorsDataError)},function(){t.showMessage(t._locale.stats.errorTitle,t._locale.stats.indicatorsDataXHRError)})},createIndicatorsSelect:function(e,t){var i,n,a,r,s,o=this,l=jQuery('<div class="indicator-cont"><div class="indisel selector-cont"><label for="indi">'+this._locale.indicators+'</label><select id="indi" name="indi" class="indi"><option value="" selected="selected"></option></select></div></div>'),u=l.find("select");for(i=0;i<t.length;i++)n=t[i],n.hasOwnProperty("id")&&(a=n.id,r=n.title[Oskari.getLang()],n.titlename=r,s=jQuery('<option value="'+a+'">'+r+"</option>"),s.attr("data-isOwnIndicator",!!n.ownIndicator),u.append(s));u.change(function(){var t=u.find("option:selected"),i=t.val(),n=t.attr("data-isOwnIndicator");"true"===n?o.getUserIndicator(i):(o.deleteIndicatorInfoButton(e),o.deleteDemographicsSelect(e),o.getStatsIndicatorMeta(e,i))}),u.css({width:"205px"});var c=e.find(".selectors-container");c.append(l).append('<div class="parameters-cont clearfix"></div>');c.find(".parameters-cont");o._addOwnIndicatorButton(e.find(".data-source-select"),e),u.chosen({no_results_text:this._locale.noMatch,placeholder_text:this._locale.selectIndicator}),jQuery(".chzn-drop").css("width","298px"),jQuery(".chzn-search input").css("width","263px")},_addOwnIndicatorButton:function(e,t){var i=this,n=jQuery(i.templates.addOwnIndicator);t.find(".new-indicator-cont").remove(),n.find("input").val(i._locale.addDataButton),e.append(n),n.find("input").click(function(){if(i._sandbox&&i._sandbox.getUser().isLoggedIn())i.createIndicatorForm(t);else{var e=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.buttons.OkButton");n.setPrimary(!0),n.setHandler(function(){e.close(!0),i.createIndicatorForm(t)}),e.show(i._locale.addDataTitle,i._locale.loginToSaveIndicator,[n])}})},getUserIndicator:function(e){var t=this;this.userIndicatorsService.getUserIndicator(e,function(e){t.changeGridRegion(e.category),t.addIndicatorDataToGrid(null,e.id,e.gender,e.year,e.data,e.meta),t.addIndicatorMeta(e)},function(){})},createIndicatorForm:function(e){var t=this,i=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.AddOwnIndicatorForm",t._sandbox,t._locale,t.regionCategories,t._layer.getWmsName(),t._layer.getId(),t._selectedRegionCategory);e.find(".selectors-container").hide(),e.find(".data-source-select").hide(),e.find("#municipalGrid").hide(),i.createUI(e,function(i){t._addUserIndicatorToGrid(i,e,t)})},_addUserIndicatorToGrid:function(e,t,i){var n={};n.title=JSON.parse(e.title),n.organization={title:{fi:"Käyttäjän tuomaa dataa"}},n.description=JSON.parse(e.title),e.data=JSON.parse(e.data);var a=i.getState(),r={id:e.indicatorId,gender:"total",year:e.year,data:e.data,title:JSON.parse(e.title),description:JSON.parse(e.description),organization:{title:JSON.parse(e.source)},category:e.category,"public":e.published,ownIndicator:!0};(a.indicators=a.indicators||[]).push(r),this.updateDataSource("userIndicators",r),i._selectedRegionCategory!==e.category&&i.changeGridRegion(e.category),i.addIndicatorDataToGrid(t,e.indicatorId,"total",e.year,e.data,n)},getStatsIndicatorMeta:function(e,t){var i=this,n=i._sandbox;i.statsService.fetchStatsData(n.getAjaxUrl()+"action_route=GetSotkaData&action=indicator_metadata&indicator="+t+"&version=1.1",function(t){t?(i.createIndicatorInfoButton(e,t),i._hasRegionCategoryValues(t)?i.createDemographicsSelects(e,t):i._warnOfInvalidIndicator(e,t)):i.showMessage(i._locale.stats.errorTitle,i._locale.stats.indicatorMetaError)},function(){i.showMessage(i._locale.stats.errorTitle,i._locale.stats.indicatorMetaXHRError)})},_hasRegionCategoryValues:function(e){var t=e.classifications;t=t&&t.region,t=t&&t.values,t=t||[];var i,n=t.length,a=this._selectedRegionCategory.toLowerCase();for(i=0;n>i;++i)if(t[i].toLowerCase()===a)return!0;return!1},_warnOfInvalidIndicator:function(e,t){var i=t.classifications,n=this._locale.cannotDisplayIndicator;i=i&&i.region,i=i&&i.title,i=i&&i[Oskari.getLang()],i&&(n+=this._locale.availableRegions+i),this.disableDemographicsSelect(e),this.showMessage(this._locale.indicators,n,null)},createIndicatorInfoButton:function(e,t){var i=this,n=jQuery('<div class="icon-info"></div>'),a=e.find(".indicator-cont");a.find(".icon-info").remove(),a.append(n),n.click(function(){var e=Oskari.getLang(),n='<h4 class="indicator-msg-popup">'+i._locale.stats.descriptionTitle+"</h4><p>"+t.description[e]+'</p><br/><h4 class="indicator-msg-popup">'+i._locale.stats.sourceTitle+"</h4><p>"+t.organization.title[e]+"</p>";i.showMessage(t.title[e],n)})},deleteIndicatorInfoButton:function(e){e.find(".indicator-cont").find(".icon-info").remove()},createDemographicsSelects:function(e,t){var i,n,a,r,s=this,o=e.find(".selectors-container"),l=o.find(".parameters-cont"),u=null,c=null;t?(s.indicators.push(t),null!==t.range&&void 0!==t.range&&(s.updateYearSelectorValues(l.find("select.year"),t.range.start,t.range.end),u=t.range.end),t.classifications&&t.classifications.sex&&(s.updateGenderSelectorValues(l.find("select.gender"),t.classifications.sex.values),c=t.classifications.sex.values[t.classifications.sex.values.length-1]),c=null!==c&&void 0!==c?c:"total",i=s._getIndicatorColumnId(t.id,c,u),n=this.isIndicatorInGrid(i),a=l.find("button.fetch-data"),a.prop("disabled",""),r=l.find("button.remove-data"),n?(a.addClass("hidden"),r.removeClass("hidden")):(r.addClass("hidden"),a.removeClass("hidden"))):(n=!1,a=jQuery('<button class="fetch-data'+(n?" hidden":"")+' selector-button primary">'+this._locale.addColumn+"</button>"),r=jQuery('<button class="remove-data'+(n?"":" hidden")+' selector-button">'+this._locale.removeColumn+"</button>"),l.prepend(r),l.prepend(a),l.prepend(s.getGenderSelectorHTML([])),l.prepend(s.getYearSelectorHTML(0,-1)),l.find("select.year").prop("disabled","disabled"),l.find("select.gender").prop("disabled","disabled"),o.find(".indicator-cont").after(l)),t?(a.unbind("click"),a.click(function(i){var n=(jQuery(i.currentTarget),jQuery(".statsgrid").find(".yearsel").find(".year").val()),a=jQuery(".statsgrid").find(".gendersel").find(".gender").val();a=null!==a&&void 0!==a?a:"total";s._getIndicatorColumnId(t.id,a,n);s.getStatsIndicatorData(e,t.id,a,n,function(){s.addIndicatorMeta(t)})}),r.unbind("click"),r.click(function(){var e=jQuery(".statsgrid").find(".yearsel").find(".year").val(),i=jQuery(".statsgrid").find(".gendersel").find(".gender").val();i=null!==i&&void 0!==i?i:"total";s._getIndicatorColumnId(t.id,i,e);s.removeIndicatorDataFromGrid(t.id,i,e)})):l.find("button.fetch-data").prop("disabled","disabled")},disableDemographicsSelect:function(e){var t=e.find(".parameters-cont");t.find("button.fetch-data").prop("disabled","disabled"),t.find("select.year").prop("disabled","disabled"),t.find("select.gender").prop("disabled","disabled")},deleteDemographicsSelect:function(e){e.find(".parameters-cont").find("select.year").empty(),e.find(".parameters-cont").find(".select.gender").empty()},updateDemographicsButtons:function(e,t,i){e=e||jQuery(".statsgrid").find(".indisel ").find("option:selected").val(),t=t||jQuery(".statsgrid").find(".gendersel").find(".gender").val(),t=null!==t&&void 0!==t?t:"total",i=i||jQuery(".statsgrid").find(".yearsel").find(".year").val();var n="indicator"+e+i+t,a=this.isIndicatorInGrid(n);a?(jQuery(".statsgrid").find(".fetch-data").addClass("hidden"),jQuery(".statsgrid").find(".remove-data").removeClass("hidden")):(jQuery(".statsgrid").find(".fetch-data").removeClass("hidden"),jQuery(".statsgrid").find(".remove-data").addClass("hidden"))},isIndicatorInGrid:function(e){var t,i,n=this.grid.getColumns();for(t=0,i=n.length;i>t;t++)if(e===n[t].id)return!0;return!1},getStatsIndicatorData:function(e,t,i,n,a){var r=this,s=null!==i&&void 0!==i?i:"total";r.statsService.fetchStatsData(r._sandbox.getAjaxUrl()+"action_route=GetSotkaData&action=data&version=1.0&indicator="+t+"&years="+n+"&genders="+s,function(i){i?(a&&"function"==typeof a&&a(),(null===r._state.indicators||void 0===r._state.indicators)&&(r._state.indicators=[]),r._state.indicators.push({id:t,year:n,gender:s}),r.addIndicatorDataToGrid(e,t,s,n,i,r.indicators[r.indicators.length-1])):r.showMessage(r._locale.stats.errorTitle,r._locale.stats.indicatorDataError)},function(){r.showMessage(r._locale.stats.errorTitle,r._locale.stats.indicatorDataXHRError)})},_getIndicatorColumnId:function(e,t,i){var n="indicator"+e+i+t;return n},addIndicatorDataToGrid:function(e,t,i,n,a,r,s){var o=this,l=o._getIndicatorColumnId(t,i,n),u=o.grid.getColumns(),c=r.title[Oskari.getLang()]||r.title;if(o.isIndicatorInGrid(l))return!1;var d=[{cssClass:"icon-close-dark statsgrid-remove-indicator",tooltip:o._locale.removeColumn,handler:function(){o.removeIndicatorDataFromGrid(t,i,n)}}],h=c+"/"+n+"/"+i;u.push({id:l,name:h,field:l,toolTip:h,sortable:!0,header:{menu:{items:[{element:jQuery("<div></div>").text(o._locale.filter)},{element:jQuery(o.templates.filterLink).text(o._locale.filterByValue),command:"filter",actionType:"link"},{element:jQuery(o.templates.filterLink).text(o._locale.filterByRegion),command:"filterByRegion",actionType:"link"}]},icon:"icon-funnel",buttons:this.conf&&this.conf.published?null:d},formatter:function(e,t,i,n){var a,r=Number(i);return a=isNaN(r)||null===n.decimals||void 0===n.decimals?i:r.toFixed(n.decimals)},groupTotalsFormatter:function(e,t){var i,n,a="",r=0,s=e.group.rows;for(n=0;n<s.length;n++)i=s[n],null!==i[t.field]&&void 0!==i[t.field]&&r++;return a=r+" "+o._locale.values}}),o.grid.setColumns(u),o.indicatorsData[l]=a,o._updateIndicatorDataToGrid(l,a,u),o.autosizeColumns(),s&&o.sendStatsData(u[u.length-1]),o.updateDemographicsButtons(t,i,n),o.grid.setSortColumn(o._state.currentColumn,!0)},_updateIndicatorDataToGrid:function(e,t,i){var n,a,r,s,o,l,u=this,c=!0,d=u._getColumnById(e);t=t||u.indicatorsData[e],i=i||u.grid.getColumns(),u.dataView.beginUpdate();var h,p,f,m,g=0,v=function(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),i=0;return t&&(i=Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0))),i};for(n=0;n<t.length;n++)h=t[n],p=h.region,f=h["primary value"].replace(",","."),null!==p&&void 0!==p&&(m=u.dataView.getItemById(p),m&&(c=!1,l=Number(f),isNaN(l)?m[e]=f:(g=Math.max(g,v(l)),m[e]=l),u.dataView.updateItem(m.id,m)));d.decimals=g,d.header&&d.header.buttons&&(u._addHeaderWarning(c,d.header.buttons),u.grid.setColumns(i));var y=[];for(n=0;n<i.length;n++){var b=i[n].id;y.push(new Slick.Data.Aggregators.Avg(b)),y.push(new Slick.Data.Aggregators.Std(b)),y.push(new Slick.Data.Aggregators.Mdn(b)),y.push(new Slick.Data.Aggregators.Mde(b)),y.push(new Slick.Data.Aggregators.Sum(b)),y.push(new Slick.Data.Aggregators.Max(b)),y.push(new Slick.Data.Aggregators.Min(b))}u.dataView.setAggregators(y,!0),u.dataView.setTotalsCallback(function(e){u._updateTotals(e)}),u.dataView.endUpdate(),u.dataView.refresh(),u.grid.invalidateAllRows(),u.grid.render(),a||u.sendStatsData(i[i.length-1]),u.updateDemographicsButtons(r,s,o),u.grid.setSortColumn(u._state.currentColumn,!0)},_addHeaderWarning:function(e,t){var i=_.any(t,function(e){return"no-data-warning"===e.id});if(e&&!i)t.push({id:"no-data-warning",cssClass:"statsgrid-no-indicator-data backendstatus-maintenance-pending",tooltip:this._locale.noIndicatorData});else if(i)for(var n=0,a=t.length;a>n;++n)if("no-data-warning"===t[n].id){t.splice(n,1);break}},removeIndicatorDataFromGrid:function(e,t,i){var n=this._getIndicatorColumnId(e,t,i),a=this.grid.getColumns(),r=[],s=!1,o=0,l=0,u=0;for(o=0,l=a.length,u=0;l>o;o++)n===a[o].id?s=!0:(r[u]=a[o],u++);if(s&&(2===r.length&&(r[1].width=318),this.grid.setColumns(r),this.grid.render(),this.dataView.refresh(),2!==r.length&&this.autosizeColumns()),this._state.indicators)for(o=0,l=this._state.indicators.length;l>o;o++){var c=this._state.indicators[o];if(e===c.id&&i===c.year&&t===c.gender){this._state.indicators.splice(o,1);break}}this.removeIndicatorMeta(e),delete this.indicatorsData[n],this.updateDemographicsButtons(e,t,i),this.sendStatsData(void 0)},resetLayer:function(){(!this.grid||this.grid.getColumns().length<3)&&this._sandbox.postRequestByName("RemoveMapLayerRequest",[this._layer.getId()])},autosizeColumns:function(){var e=this.grid,t=e.getColumns();_.each(t,function(e){"_checkbox_selector"!==e.id&&(e.width=80)}),e.autosizeColumns()},getYearSelectorHTML:function(e,t){var i=this,n=jQuery('<div class="yearsel selector-cont"><label for="year">'+this._locale.year+'</label><select name="year" class="year"></select></div>'),a=n.find("select");return i.updateYearSelectorValues(a,e,t),a.change(function(e){i.updateDemographicsButtons(null,null,e.target.value)}),n},updateYearSelectorValues:function(e,t,i){var n,a;for(e.empty(),n=t;i>=n;n++)a=jQuery('<option value="'+n+'">'+n+"</option>"),e.append(a);e.val(i),e.prop("disabled","")},getGenderSelectorHTML:function(e){var t=this,i=jQuery('<div class="gendersel selector-cont"><label for="gender">'+this._locale.gender+'</label><select name="gender" class="gender"></select></div>'),n=i.find("select");return e&&e.length&&t.updateGenderSelectorValues(n,e),n.change(function(e){t.updateDemographicsButtons(null,e.target.value,null)}),i},updateGenderSelectorValues:function(e,t){var i,n;for(e.empty(),i=0;i<t.length;i++)n=jQuery('<option value="'+t[i]+'">'+this._locale.genders[t[i]]+"</option>"),e.append(n);e.val(t[t.length-1]),e.prop("disabled","")},sendStatsData:function(e){if(!(e&&e.field.indexOf("indicator")<0)&&this.stateIndicatorsLoaded){var t,i=this,n=[],a=[],r=i._state.municipalities=[];i._state.currentColumn=e?e.id:void 0;var s=this.dataView.getItems();if(e)for(t=0;t<s.length;t++){var o=s[t];"checked"===o.sel&&(r.push(o.id),null!==o[e.field]&&void 0!==o[e.field]&&(n.push(o[e.field]),a.push(o.code)))}i.statsService.sendStatsData(i._layer,{CHECKED_COUNT:this.getItemsByGroupingKey("checked").length,CUR_COL:e,VIS_NAME:i._layer.getWmsName(),VIS_ATTR:i._layer.getFilterPropertyName(),VIS_CODES:a,COL_VALUES:n}),this._setLayerVisibility(!0)}},_setLayerVisibility:function(e){if(this._layer._visible!==e){var t=this._sandbox,i=t.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest");if(i){var n=i(this._layer.getId(),e);t.request(this,n)}}},getStatsIndicatorsMeta:function(e,t,i){var n,a=this,r=0;for(a.indicators=[],n=0;n<t.length;n++){var s=t[n],o=s.id;(null===o||void 0===o)&&(o=s.indicator),a.statsService.fetchStatsData(a._sandbox.getAjaxUrl()+"action_route=GetSotkaData&action=indicator_metadata&indicator="+o+"&version=1.1",function(e){if(r++,e){a.addIndicatorMeta(e);var n;for(n=0;n<t.length;n++)(null===t[n].id||void 0===t[n].id)&&(t[n].id=t[n].indicator),t[n].id+""==e.id+""&&(a.indicators[n]=e);r>=t.length&&i()}else a.showMessage(a._locale.stats.errorTitle,a._locale.stats.indicatorDataError)},function(){a.showMessage(a._locale.stats.errorTitle,a._locale.stats.indicatorDataXHRError),r++})}},getStatsIndicatorsData:function(e,t,i){var n,a=this,r=0,s={};for(n=0;n<t.length;n++){var o=t[n],l=o.id,u=o.year,c=o.gender||"total";(null===l||void 0===l)&&(l=o.indicator),a.statsService.fetchStatsData(a._sandbox.getAjaxUrl()+"action_route=GetSotkaData&action=data&version=1.0&indicator="+l+"&years="+u+"&genders="+c,function(n){if(r++,n){var o,l,u;for(o=0;o<t.length;o++)l=t[o],(null===l.id||void 0===l.id)&&(l.id=l.indicator),l.id==n[0].indicator&&l.year==n[0].year&&l.gender===n[0].gender&&(u=a._getIndicatorColumnId(l.id,l.gender,l.year),s[u]=n);if(r>=t.length){for(o=0;o<t.length;o++)if(l=t[o],(null===l.id||void 0===l.id)&&(l.id=l.indicator),l){u=a._getIndicatorColumnId(l.id,l.gender,l.year);var c=s[u];a.addIndicatorDataToGrid(e,l.id,l.gender,l.year,c,a.indicators[o],!0)}i()}}else a.showMessage(a._locale.stats.errorTitle,a._locale.stats.indicatorDataError)},function(){a.showMessage(a._locale.stats.errorTitle,a._locale.stats.indicatorDataXHRError),r++})}},clearDataFromGrid:function(){if(this.grid){var e,t=this.grid.getColumns(),i=[],n=0;for(e=0;e<t.length;e++){var a=t[e].id;("id"===a||"municipality"===a||"code"===a||"_checkbox_selector"===a)&&(i[n]=t[e],n++)}this.grid.setColumns(i),this.grid.render(),this.dataView.refresh()}},showMessage:function(e,t,i){if(!this._published){if(this.dialog)return this.dialog.close(!0),void(this.dialog=null);var n=this,a=this._locale,r=Oskari.clazz.create("Oskari.userinterface.component.Popup");if(i)r.show(e,t,i);else{var s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(a.buttons.ok),s.addClass("primary"),s.setHandler(function(){r.close(!0),n.dialog=null}),r.show(e,t,[s]),n.dialog=r}}},loadStateIndicators:function(e,t){{var i=this;this._sandbox.findRegisteredModuleInstance("MainMapModuleManageClassificationPlugin")}i.clearDataFromGrid();var n=_.groupBy(e.indicators||[],function(e){return e.ownIndicator?"user":"sotka"});_.each(n.user,function(e){i.addIndicatorDataToGrid(null,e.id,e.gender,e.year,e.data,{title:e.title}),i.addIndicatorMeta(e)}),n.sotka&&n.sotka.length>0?i.getStatsIndicatorsMeta(t,n.sotka,function(){i.getStatsIndicatorsData(t,n.sotka,function(){i._afterStateIndicatorsLoaded(e)})}):i._afterStateIndicatorsLoaded(e)},_afterStateIndicatorsLoaded:function(e){if(this.stateIndicatorsLoaded=!0,null!==e.currentColumn&&void 0!==e.currentColumn){e.municipalities&&e.municipalities.length&&this._showSelectedAreas(e.municipalities);var t=this._getColumnById(e.currentColumn);null!==e.filterMethod&&"undefined"!=typeof e.filterMethod&&null!==e.filterInput&&"undefined"!=typeof e.filterInput&&e.filterInput.length>0&&(this.filterColumn(t,e.filterMethod,e.filterInput),e.filterInput=[]),null!==e.filterRegion&&"undefined"!=typeof e.filterRegion&&e.filterRegion.length>0&&(this.filterColumnByRegion(t,e.filterRegion),e.filterRegion=[]),this.sendStatsData(t),this.grid.setSortColumn(e.currentColumn,!0)}},_updateTotals:function(e){if(e){var t,i,n=this.grid.getColumns();for(i=0;i<n.length;i++){t=n[i];var a,r,s=e[0];for(a in e)e.hasOwnProperty(a)&&(r=e[a],"checked"===r.groupingKey&&(s=r));var o,l,u=s.totals,c=jQuery(this.templates.subHeader),d=0;for(o=0;o<this.conf.statistics.length;o++)l=this.conf.statistics[o],l.visible&&(c.append(this._getStatistic(u,t.id,l.id)),d++);var h=jQuery(this.grid.getHeaderRowColumn(t.id)).empty(),p=this.grid.getOptions(),f=h.css("line-height");f=f?f.split("px")[0]:12,p.headerRowHeight=d*f+7,this.grid.setOptions(p),c.appendTo(h)}}},_getStatistic:function(e,t,i){var n,a={},r=null,s=e[i],o=this._getColumnById(t).decimals;for(n in s)if(s.hasOwnProperty(n)){if(a[n]||(a[n]={}),n.indexOf("indicator")>=0&&n===t){a[n][i]=s[n],r=jQuery(this.templates.statsgridTotalsVar);var l=a[t][i];isNaN(l)||this._isInt(l)||(l=l.toFixed&&null!==o&&void 0!==o?l.toFixed(o):l),_.isNaN(l)&&(l="-"),r.addClass("statsgrid-"+i).text(l);break}if("municipality"===t){r=jQuery(this.templates.statsgridTotalsVar),r.attr("title",this._locale.statistic.tooltip[i]),r.addClass("statsgrid-totals-label").text(this._locale.statistic[i]);break}}return r},_isInt:function(e){return e%1===0},_initHeaderPlugin:function(e,t){var i,n=this;for(i=0;i<e.length;i++){var a=e[i];"municipality"===a.id&&(a.header={menu:{items:[]}})}n.headerMenuPlugin=new Slick.Plugins.HeaderMenu2({}),n.headerMenuPlugin.onBeforeMenuShow.subscribe(function(e,t){var i,a,r=t.menu;if("municipality"===t.column.id){for(r.items=[],r.items.push({element:'<div class="header-menu-subheading">'+n._locale.regionCategories.title+"</div>",disabled:!0}),_.each(n._acceptedRegionCategories,function(e){var t=jQuery('<li><input type="radio" name="categorySelector"></input><label></label></li>');t.find("input").attr({id:"category_"+e,checked:e===n._selectedRegionCategory?"checked":!1}).end().find("label").attr({"for":"category_"+e}).html(n._locale.regionCategories[e]),r.items.push({element:t,command:"category_"+e})}),r.items.push({element:'<div class="header-menu-subheading subheading-middle">'+n._locale.statistic.title+"</div>",disabled:!0}),i=0;i<n.conf.statistics.length;i++){var s=n.conf.statistics[i],o=jQuery(n.templates.gridHeaderMenu).addClass("statsgrid-show-total-selects");a=o.find("input").attr({id:"statistics_"+s.id}),s.visible&&a.attr({checked:"checked"}),o.find("label").attr("for","statistics_"+s.id).text(n._locale.statistic[s.id]),r.items.push({element:o,command:s.id})}var l=t.grid.getColumns(),u=!1;for(i=0;i<l.length;i++){var c=l[i];"sel"===c.field&&(u=!0)}var d=jQuery(n.templates.gridHeaderMenu).addClass("statsgrid-show-row-selects");a=d.find("input").attr({id:"statsgrid-show-row-selects"}),u&&a.attr("checked","checked"),d.find("label").attr("for","statsgrid-show-row-selects").text(n._locale.selectRows),r.items.push({element:d,command:"selectRows"})}}),n.headerMenuPlugin.onCommand.subscribe(function(e,t){var i;if("selectRows"===t.command){var a=t.grid.getColumns(),r=[],s=!0;for(i=0;i<a.length;i++){var o=a[i];"sel"!==o.field&&r.push(o),"sel"!==o.field||jQuery(e.target).is(":checked")||(s=!1)}s&&r.unshift(n.checkboxSelector.getColumnDefinition()),t.grid.setColumns(r)}else if(/^category_/.test(t.command))n.changeGridRegion(_.last(t.command.split("_")));else if("filter"===t.command)n._createFilterPopup(t.column,this);else if("filterByRegion"===t.command)n._createFilterByRegionPopup(t.column,this);else{for(i=0;i<n.conf.statistics.length;i++){var l=n.conf.statistics[i];if(l.id==t.command){l.visible=!l.visible;break}}n.dataView.refresh(),n.grid.setColumns(n.grid.getColumns()),n.dataView.refresh()}}),t.registerPlugin(n.headerMenuPlugin)},changeGridRegion:function(e){var t,i=this,n=this.dataView,a=this.grid,r=this.regionCategories[e];_.each(r,function(e){e.sel="checked"}),this._setSelectedRegionCategory(e),n.beginUpdate(),n.setItems([]),a.invalidateAllRows(),n.setItems(r),n.endUpdate(),a.invalidate(),a.render(),_.each(a.getColumns(),function(e){e.id.indexOf("indicator")>=0&&i._updateIndicatorDataToGrid(e.id)}),i._setLayerToCategory(e),i._state.currentColumn&&(t=i._getColumnById(i._state.currentColumn)),i.sendStatsData(t)},_setLayerToCategory:function(e){var t=this.getLayer(),i=t.getCategoryMappings();t.setWmsName(i.wmsNames[e]),t.setFilterPropertyName(i.filterProperties[e])},_setSelectedRegionCategory:function(e){var t=this._getColumnById("municipality"),i=this.grid.getColumns(),n=this._locale.regionCategories[e];this._state.regionCategory=e,this._selectedRegionCategory=e,t.name=n,this.grid.setColumns(i)},_createFilterPopup:function(e,t){var i=this,n=jQuery(i.templates.filterPopup);i._destroyPopup("filterPopup"),n.find(".filter-desc").text(i._locale.indicatorFilterDesc);var a=jQuery(i.templates.filterRow);a.find(".filter-label").text(i._locale.filterIndicator),a.find(".filter-value").text(e.name),n.find(".filter-container").append(a);var r=jQuery(i.templates.filterRow);r.find(".filter-label").text(i._locale.filterCondition);var s=jQuery(i.templates.filterSelect),o=s.find(".filter-select");o.append(jQuery(i.templates.filterOption).val("").text(i._locale.filterSelectCondition)),o.append(jQuery(i.templates.filterOption).val(">").text(i._locale.filterGT)),o.append(jQuery(i.templates.filterOption).val(">=").text(i._locale.filterGTOE)),o.append(jQuery(i.templates.filterOption).val("=").text(i._locale.filterE)),o.append(jQuery(i.templates.filterOption).val("<=").text(i._locale.filterLTOE)),o.append(jQuery(i.templates.filterOption).val("<").text(i._locale.filterLT)),o.append(jQuery(i.templates.filterOption).val("...").text(i._locale.filterBetween)),r.find(".filter-value").append(s),o.change(function(e){var t=jQuery(e.target),i=t.val(),n=t.parents(".filter-value");"..."===i?(n.find(".filter-between").css("display","block"),n.find(".filter-input2").css("display","block")):(n.find(".filter-input2").css("display","none"),n.find(".filter-between").css("display","none"))}),n.find(".filter-container").append(r);var l=jQuery(i.templates.filterInputs);n.find(".filter-inputs-container").append(l);var u=Oskari.clazz.create("Oskari.userinterface.component.Popup"),c=Oskari.clazz.create("Oskari.userinterface.component.Button");c.setTitle(i._locale.buttons.cancel),c.setHandler(function(){t.hide(),i._destroyPopup("filterPopup")});var d=Oskari.clazz.create("Oskari.userinterface.component.Button");d.setTitle(i._locale.buttons.filter),d.addClass("primary"),d.setHandler(function(n){var a=[],r=jQuery(n.target).parents(".divmanazerpopup"),s=r.find(".filter-input1");if(a.push(s.val()),"..."===o.val()){var l=r.find(".filter-input2");a.push(l.val())}i.filterColumn(e,o.val(),a),t.hide(),i._destroyPopup("filterPopup")}),u.show(i._locale.filterTitle,n,[c,d]),n.on("keydown",function(e){e.stopPropagation()}),i.popups.push({name:"filterPopup",popup:u,content:n})},_getPopupIndex:function(e){var t,i=null;for(t=0;t<this.popups.length;t++)if(this.popups[t].name===e){i=t;break}return i},_destroyPopup:function(e){var t=this._getPopupIndex(e),i=null===t?null:this.popups[t];i&&(i.content.off(),i.popup.close(!0),this.popups.splice(t,1))},_createFilterByRegionPopup:function(e,t){var i,n,a,r,s=this,o=Oskari.clazz.create("Oskari.userinterface.component.Popup"),l=s._locale.filterTitle,u=Oskari.clazz.create("Oskari.userinterface.component.Button"),c=s._locale.buttons.cancel,d=Oskari.clazz.create("Oskari.userinterface.component.Button"),h=s._locale.buttons.filter,p=jQuery(s.templates.filterByRegion).clone(),f=jQuery(s.templates.filterRow).clone(),m=jQuery(s.templates.regionCatSelect).clone(),g=jQuery(s.templates.filterRow).clone();s._destroyPopup("filterByRegionPopup"),u.setTitle(c),u.setHandler(function(){t.hide(),s._destroyPopup("filterByRegionPopup")}),d.setTitle(h),d.addClass("primary"),d.setHandler(function(){i=p.find("div.filter-region-select select").val(),s.filterColumnByRegion(e,i),t.hide(),s._destroyPopup("filterByRegionPopup")}),p.find(".filter-desc").text(s._locale.indicatorFilterDesc),g.find(".filter-label").text(s._locale.filterIndicator),g.find(".filter-value").text(e.name),p.find(".filter-container").append(g),a=jQuery(s.templates.filterOption).clone(),r=s._locale.regionCatPlaceholder,a.val("").text(r),m.find("select").append(a);for(n in s.regionCategories)s.regionCategories.hasOwnProperty(n)&&(a=jQuery(s.templates.filterOption).clone(),r=s._locale.regionCategories[n],a.val(n).text(r),m.find("select").append(a));f.find(".filter-label").text(s._locale.selectRegionCategory),f.find(".filter-value").append(m),p.find(".filter-container").append(f),m.change(function(e){s._createFilterByRegionSelect(p,e.target.value)}),o.show(l,p,[u,d]),s.popups.push({name:"filterByRegionPopup",popup:o,content:p})},destroyPopups:function(){this.headerMenuPlugin&&this.headerMenuPlugin.hide();var e,t;for(e=0;e<this.popups.length;e++)t=this.popups[e],t.content.off(),t.popup.close(!0);this.popups=[]},_createFilterByRegionSelect:function(e,t){if(e.find(".filter-region-container").remove(),!t)return null;var i,n,a,r=jQuery(this.templates.filterRow).clone(),s=jQuery(this.templates.regionSelect).clone(),o=this.regionCategories[t],l=o.length;for(r.addClass("filter-region-container"),a=0;l>a;++a)n=o[a],i=jQuery(this.templates.filterOption).clone(),i.val(n.id).text(n.title),s.find("select").append(i);r.find(".filter-label").text(this._locale.selectRegion),r.find(".filter-value").append(s),e.find(".filter-container").append(r),e.find("div.filter-region-select select").chosen({width:"90%",no_results_text:this._locale.noRegionFound,placeholder_text:this._locale.chosenRegionText})},filterColumn:function(e,t,i){var n,a,r,s=this.grid.getData(),o=s.getItems();for(i=_.map(i,this._numerizeValue),r=0;r<o.length;r++)if(n=o[r],"checked"===n.sel){if(a=n[e.id],null===a||void 0===a)n.sel="empty";else switch(t){case">":a<=i[0]&&(n.sel="empty");break;case">=":a<i[0]&&(n.sel="empty");break;case"=":a!==i[0]&&(n.sel="empty");break;case"<=":a>i[0]&&(n.sel="empty");break;case"<":a>=i[0]&&(n.sel="empty");break;case"...":(i[0]>=a||a>=i[1])&&(n.sel="empty")}s.updateItem(n.id,n)}this.dataView.refresh(),s.collapseGroup("empty"),this.sendStatsData(e),this.grid.updateRowCount(),this.grid.resizeCanvas(),this.grid.scrollRowToTop(0)},filterColumnByRegion:function(e,t){if(t&&0!==t.length){var i,n,a=this,r=a.grid.getData(),s=r.getItems();for(n=0;n<s.length;n++)i=s[n],"checked"===i.sel&&(null===i[e.id]||void 0===i[e.id]?i.sel="empty":this._itemBelongsToAnyRegions(i,t)||(i.sel="empty"),r.updateItem(i.id,i));a.dataView.refresh(),r.collapseGroup("empty"),a.sendStatsData(e),a.grid.updateRowCount(),a.grid.resizeCanvas(),a.grid.scrollRowToTop(0)}},_itemBelongsToAnyRegions:function(e,t){var i,n;for(i=0;i<t.length;++i)if(n=Number(t[i]),e.memberOf.indexOf(n)>-1)return!0;return!1},downloadJSON2CSV:function(e){var t,i,n,a="object"!=typeof e?JSON.parse(e):e,r="";for(i=0;i<a.length;i++){t="";for(n in a[i])a[i].hasOwnProperty(n)&&(t+=a[i][n]+",");t.slice(0,t.Length-1),r+=t+"\r\n"}window.open("data:text/csv;charset=utf-8,"+escape(r))},_featureHighlightedEvent:function(e){var t=e.getFeature().attributes,i=e.isHighlighted(),n=this._getHilightPropertyName(),a=this.getIdxByCode(t[n]),r="highlight-row-"+t[n],s={};this.grid&&a&&this.getItemsByGroupingKey("checked").length>0&&(this.selectedMunicipalities[t[n]]=i,i?-1!==a&&(this.grid.scrollRowToTop(a),s[a]={municipality:"statsgrid-highlight-row"},this.grid.addCellCssStyles(r,s),this.dataView.syncGridCellCssStyles(this.grid,r)):(this.grid.removeCellCssStyles(r),this.dataView.syncGridCellCssStyles(this.grid,r)))},_featureSelectedEvent:function(e){var t=e.getFeature().attributes,i=e.isHighlighted(),n=this._getHilightPropertyName(),a=this.getItemByCode(t[n]);if(this.grid&&a){this.selectedMunicipalities[t[n]]=i,a.sel=i?"checked":"empty";var r=this.grid.getData();r.updateItem(a.id,a);var s=this._getColumnById(this._state.currentColumn);this.sendStatsData(s)}},_getHilightPropertyName:function(){var e=this.getLayer(),t=e.getCategoryMappings()||{},i=t.filterProperties||{},n=i[this._selectedRegionCategory||"KUNTA"];return n||"kuntakoodi"},getItemsByGroupingKey:function(e){var t,i,n=this.grid.getData().getItems(),a=[];for(i=0;i<n.length;i++)t=n[i],t.sel===e&&a.push(e);return a},_showSelectedAreas:function(e){var t,i,n,a,r=this.grid.getData(),s=r.getItems();for(i=0;i<s.length;i++){for(t=s[i],t.sel="empty",n=0;n<e.length;n++)a=e[n],t.id==a&&(t.sel="checked");r.updateItem(t.id,t)}r.collapseGroup("empty"),r.refresh()},unselectAllAreas:function(e){var t,i,n=this.grid,a=n.getData(),r=n.getData().getItems();for(i=0;i<r.length;i++)t=r[i],t.sel=e&&this.selectedMunicipalities[t.code]?"checked":"empty";a.collapseGroup("empty");var s=this._getColumnById(this._state.currentColumn);this.sendStatsData(s),a.setItems(r),a.refresh(),n.invalidateAllRows(),n.render()},_getColumnById:function(e){var t,i,n=this.grid.getColumns();for(i=0;i<n.length;i++)if(t=n[i],t.id===e)return t;return null},sendTooltipData:function(e){var t,i=e.attributes,n=this._sandbox.getEventBuilder("MapStats.HoverTooltipContentEvent"),a=this._state.currentColumn,r=this._getHilightPropertyName(),s=this.getItemByCode(i[r]);
if((null===s||void 0===s)&&this._sandbox.printWarn("sendTooltipData: item not found for",i[r],"in",this.dataView.getItems()),t="<p>"+s.municipality,t+=a&&null!==s[a]&&void 0!==s[a]?"<br />"+s[a]:"",t+="</p>",n){var o=n(t);this._sandbox.notifyAll(o)}},toggleSelectMunicipalitiesMode:function(){return this.selectMunicipalitiesMode=!this.selectMunicipalitiesMode,this.selectMunicipalitiesMode},addIndicatorMeta:function(e){var t=this,i=Oskari.getLang(),n=e.id,a=t.indicatorsMeta[n];a?a.count+=1:t.indicatorsMeta[n]={count:1,title:e.title[i],organization:e.organization.title[i]}},removeIndicatorMeta:function(e){var t=this.indicatorsMeta[e];t&&(t.count-=1,0===t.count&&delete this.indicatorsMeta[e])},_numerizeValue:function(e){var t=e;return null!==e&&void 0!==e&&(e.replace&&(t=e.replace(",",".")),t=Number(t)),isNaN(t)&&(t=e),t}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/statistics/bundle/statsgrid/plugin/ManageStatsPlugin",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.event.StatsDataChangedEvent",function(e,t){this._layer=e,this._params=t},{getName:function(){return"StatsGrid.StatsDataChangedEvent"},getLayer:function(){return this._layer},getParams:function(){return this._params}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/statistics/bundle/statsgrid/event/StatsDataChangedEvent",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.event.ModeChangedEvent",function(e){this._modeVisible=e},{getName:function(){return"StatsGrid.ModeChangedEvent"},isModeVisible:function(){return this._modeVisible}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/statistics/bundle/statsgrid/event/ModeChangedEvent",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.event.ClearHilightsEvent",function(){},{getName:function(){return"StatsGrid.ClearHilightsEvent"}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/statistics/bundle/statsgrid/event/ClearHilightsEvent",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.event.SelectHilightsModeEvent",function(e){this._codes=e},{getName:function(){return"StatsGrid.SelectHilightsModeEvent"},getCodes:function(){return this._codes}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/statistics/bundle/statsgrid/event/SelectHilightsModeEvent",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.event.IndicatorsEvent",function(e){this._indicators=e},{getName:function(){return"StatsGrid.IndicatorsEvent"},getIndicators:function(){return this._indicators}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/statistics/bundle/statsgrid/event/IndicatorsEvent",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.event.UserIndicatorEvent",function(e,t){this._type=e,this._indicator=t},{getName:function(){return"StatsGrid.UserIndicatorEvent"},getType:function(){return this._type},getIndicator:function(){return this._indicator}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/statistics/bundle/statsgrid/event/UserIndicatorEvent",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.StatsGridRequest",function(e,t){this._enable=e===!0,this._layer=t},{__name:"StatsGrid.StatsGridRequest",getName:function(){return this.__name},getLayer:function(){return this._layer},isEnabled:function(){return this._enable}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/statistics/bundle/statsgrid/request/StatsGridRequest",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.StatsGridRequestHandler",function(e){this.view=e},{handleRequest:function(e,t){"StatsGrid.StatsGridRequest"===t.getName()&&this.view.prepareMode(t.isEnabled(),t.getLayer())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/statistics/bundle/statsgrid/request/StatsGridRequestHandler",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.TooltipContentRequest",function(e){this._feature=e},{__name:"StatsGrid.TooltipContentRequest",getName:function(){return this.__name},getFeature:function(){return this._feature}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/statistics/bundle/statsgrid/request/TooltipContentRequest",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.TooltipContentRequestHandler",function(e){this.instance=e},{handleRequest:function(e,t){"StatsGrid.TooltipContentRequest"===t.getName()&&this.instance.gridPlugin.sendTooltipData(t.getFeature())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/statistics/bundle/statsgrid/request/TooltipContentRequestHandler",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.IndicatorsRequest",function(){},{__name:"StatsGrid.IndicatorsRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/statistics/bundle/statsgrid/request/IndicatorsRequest",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.IndicatorsRequestHandler",function(e){this.instance=e},{handleRequest:function(e,t){if("StatsGrid.IndicatorsRequest"===t.getName()){var i,n=this.instance.getSandbox(),a=n.getEventBuilder("StatsGrid.IndicatorsEvent"),r=[];this.instance.isLayerVisible()&&(r=this.instance.getGridIndicators()),a&&(i=a(r),n.notifyAll(i))}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/statistics/bundle/statsgrid/request/IndicatorsRequestHandler",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.AddDataSourceRequest",function(e,t,i){this._dataSourceId=e,this._dataSourceName=t,this._data=i},{__name:"StatsGrid.AddDataSourceRequest",getName:function(){return this.__name},getDataSourceId:function(){return this._dataSourceId},getDataSourceName:function(){return this._dataSourceName},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/statistics/bundle/statsgrid/request/AddDataSourceRequest",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.request.DataSourceRequestHandler",function(e){this.plugin=e},{handleRequest:function(e,t){if("StatsGrid.AddDataSourceRequest"===t.getName()){var i=t.getDataSourceId(),n=t.getDataSourceName(),a=t.getData();this.plugin.addDataSource(i,n,a)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/statistics/bundle/statsgrid/request/DataSourceRequestHandler",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.StatisticsService",function(e){this.instance=e,this.sandbox=e.sandbox,this.cache={},this.cacheSize=0},{__name:"StatsGrid.StatisticsService",__qname:"Oskari.statistics.bundle.statsgrid.StatisticsService",getQName:function(){return this.__qname},getName:function(){return this.__name},init:function(){},sendStatsData:function(e,t){var i=this,n=i.sandbox.getEventBuilder("StatsGrid.StatsDataChangedEvent");if(n){var a=n(e,t);i.sandbox.notifyAll(a)}},sendVisualizationData:function(e,t){var i=this,n=i.sandbox.getEventBuilder("MapStats.StatsVisualizationChangeEvent");if(n){var a=n(e,t);i.sandbox.notifyAll(a)}},_cacheStatsData:function(e,t){this.cache[e]={accessed:(new Date).getTime(),data:t},this.cacheSize++,this._pruneCache(20)},_pruneCache:function(e){if(this.cacheSize>e){var t,i,n=this.cacheSize-e,a=[],r=[],s=function(e,t){return e.accessed<t.accessed?-1:e.accessed>t.accessed?1:0};for(i in this.cache)this.cache.hasOwnProperty(i)&&a.push({accessed:this.cache[i].accessed,url:i});for(a.sort(s),t=0;n>t;t++)r.push(a[t].url);for(t=0;t<r.length;t++)delete this.cache[r[t]];this.cacheSize=e}},_getStatsDataFromCache:function(e){var t=this.cache[e],i=null;return t&&(t.accessed=(new Date).getTime(),i=t.data),i},fetchStatsData:function(e,t,i,n){var a=this;if(!n){var r=a._getStatsDataFromCache(e);if(r)return void(t&&t(r))}jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:e,success:function(i){a._cacheStatsData(e,i),t&&t(i)},error:function(e,t){i&&0!==e.status&&i(e,t)}})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/statistics/bundle/statsgrid/service/StatisticsService",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.UserIndicatorsService",function(e){this.instance=e,this.sandbox=e.sandbox,this.eventName="StatsGrid.UserIndicatorEvent"},{__name:"StatsGrid.UserIndicatorsService",__qname:"Oskari.statistics.bundle.statsgrid.UserIndicatorsService",getQName:function(){return this.__qname},getName:function(){return this.__name},init:function(){},getUserIndicators:function(e,t){var i=this.sandbox.getAjaxUrl()+"action_route=GetUserIndicators";this._get(i,e,t)},getUserIndicator:function(e,t,i){var n=this.sandbox.getAjaxUrl()+"action_route=GetUserIndicators&id="+e,a=this._normalizeIndicator,r=function(e){t(a(e))};this._get(n,r,i)},saveUserIndicator:function(e,t,i){var n=this,a=this.sandbox.getAjaxUrl()+"action_route=SaveUserIndicator",r=this.sandbox,s=this.eventName,o=function(i){var a=r.getEventBuilder(s);if(a){var o=a("create",n._objectifyIndicator(e,i));r.notifyAll(o)}t(i)};this._post(a,e,o,i)},deleteUserIndicator:function(e,t,i){var n=this.sandbox.getAjaxUrl()+"action_route=DeleteUserIndicator&id="+e;this._get(n,t,i)},_get:function(e,t,i){this._ajax("GET",e,t,i)},_post:function(e,t,i,n){this._ajax("POST",e,i,n,t)},_ajax:function(e,t,i,n,a){var r={url:t,type:e,dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){"function"==typeof i&&i(e)},error:function(e,t){"function"==typeof n&&0!==e.status&&n(e,t)}};a&&(r.data=a),jQuery.ajax(r)},_objectifyIndicator:function(e,t){var i={id:t.id,title:JSON.parse(e.title),description:JSON.parse(e.description),organization:JSON.parse(e.source),year:e.year};return i},_normalizeIndicator:function(e){var t=_.clone(e,!0);return t.ownIndicator=!0,t.gender="total",t.organization={title:t.organization},t.meta={title:t.title},t}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/statistics/bundle/statsgrid/service/UserIndicatorsService",function(){}),Oskari.clazz.define("Oskari.statistics.bundle.statsgrid.UserIndicatorsTab",function(e,t){this.instance=e,this.loc=t,this.visibleFields=["name","description","organization","year","delete"],this.grid=null,this.container=null,this.template=jQuery('<div class="userIndicatorsList"><div class="indicatorsGrid"></div></div>'),this.init()},{getName:function(){return"StatsGrid.UserIndicatorsTab"},getTitle:function(){return this.loc.title},getContent:function(){return this.container},eventHandlers:{"StatsGrid.UserIndicatorEvent":function(e){var t=e.getType(),i=e.getIndicator();"create"===t&&this._addIndicatorToGrid(i)}},init:function(){var e=this;this.bindEvents(),this.container=this.template.clone();var t=this.instance.getUserIndicatorsService();t.getUserIndicators(function(t){e._renderIndicators(t),e._addDataSource(t)},function(){e.showMessage(e.loc.error.title,e.loc.error.indicatorsError)})},_requestToAddTab:function(){var e,t=this.getTitle(),i=this.getContent(),n=this.instance.getSandbox(),a=n.getRequestBuilder("PersonalData.AddTabRequest");a&&(e=a(t,i),n.request(this.instance,e))},_createUserIndicatorsGrid:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Grid");return i.setVisibleFields(this.visibleFields),i.setDataModel(e),i.setColumnValueRenderer("name",function(e,i){return jQuery('<div class="indicator-name-link"></div>').html(e).click(function(){t._showUserIndicator(i.id)})}),i.setColumnValueRenderer("delete",function(e,i){return jQuery('<div class="indicator-name-link"></div>').html(t.loc.destroyIndicator).click(function(){t._displayDeleteConfirmation(i)})}),_.each(this.visibleFields,function(e){i.setColumnUIName(e,t.loc.grid[e])}),i},_renderIndicators:function(e){var t=this,i=(Oskari.getLang(),Oskari.clazz.create("Oskari.userinterface.component.GridModel"));i.setIdField("id"),_.each(e,function(e){t._addIndicatorData.call(t,i,e)}),this.grid=this._createUserIndicatorsGrid(i),this.grid.renderTo(this.container.find("div.indicatorsGrid")),this._requestToAddTab()},_addIndicatorData:function(e,t){e.addData({id:t.id,name:this._retrieveValue(t.title),description:this._retrieveValue(t.description),organization:this._retrieveValue(t.organization),year:t.year||""})},_retrieveValue:function(e){var t=" ",i=Oskari.getLang(),n="en";return _.isObject(e)&&(t=e[i]||e[n]||_.chain(e).values().first().value()||" "),t},_showUserIndicator:function(e){var t=this,i=this.instance;service=i.getUserIndicatorsService(),service.getUserIndicator(e,function(e){e.id="user_"+e.id,i.addUserIndicator(e)},function(){t.showMessage(t.loc.error.title,t.loc.error.indicatorError)})},_displayDeleteConfirmation:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button"),a=i.createCloseButton(t.loc.cancelDelete),r=t.loc.deleteTitle,s=t.loc.confirmDelete+e.name;n.setTitle(t.loc.destroyIndicator),n.addClass("primary"),n.setHandler(function(){i.close(),t._deleteUserIndicator(e.id)}),i.show(r,s,[a,n]),i.makeModal()},_deleteUserIndicator:function(e){var t=this,i=this.instance;service=i.getUserIndicatorsService(),service.deleteUserIndicator(e,function(){t._removeIndicatorFromGrid(e)},function(){t.showMessage(t.loc.error.title,t.loc.error.indicatorDeleteError)})},_removeIndicatorFromGrid:function(e){var t,i,n=this.grid.getDataModel(),a=n.getData()||[],r=null;for(t=0,i=a.length;i>t;++t)if(a[t].id===e){r=t;break}null!==r&&a.splice(r,1),this.grid.renderTo(this.container.find("div.indicatorsGrid"))},_addIndicatorToGrid:function(e){var t=this.grid.getDataModel();this._addIndicatorData(t,e),this.grid.renderTo(this.container.find("div.indicatorsGrid"))},_bindAddNewIndicator:function(e){var t=this,i=e.find("button#createNewIndicator");i.click(function(){t._showAddIndicatorForm()})},_addDataSource:function(e){var t,i=this.instance.getSandbox(),n=this.instance.getLocalization("tab").description,a=i.getRequestBuilder("StatsGrid.AddDataSourceRequest"),r=_.map(e,function(e){return e.ownIndicator=!0,e});a&&(t=a("userIndicators",n,r),i.request(this.instance,t))},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},bindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.registerForEventByName(this,e)},unbindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.unregisterFromEventByName(this,e)},showMessage:function(e,t){var i=this.instance.getLocalization(),n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=Oskari.clazz.create("Oskari.userinterface.component.Button");a.setTitle(i.buttons.ok),a.addClass("primary"),a.setHandler(function(){n.close(!0)}),n.show(e,t,[a])}}),define("bundles/statistics/bundle/statsgrid/UserIndicatorsTab",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/statistics/bundle/statsgrid/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/statistics/bundle/statsgrid/css/classifyplugin.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("libraries/slickgrid/css/slick.grid.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("libraries/slickgrid/css/municipality.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("libraries/slickgrid/css/slick-default-theme.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,function(e){e.fn.drag=function(t,i,n){var a="string"==typeof t?t:"",r=e.isFunction(t)?t:e.isFunction(i)?i:null;return 0!==a.indexOf("drag")&&(a="drag"+a),n=(t==r?i:n)||{},r?this.bind(a,n,r):this.trigger(a)};var t=e.event,i=t.special,n=i.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",livekey:"livedrag",add:function(i){var a=e.data(this,n.datakey),r=i.data||{};a.related+=1,!a.live&&i.selector&&(a.live=!0,t.add(this,"draginit."+n.livekey,n.delegate)),e.each(n.defaults,function(e){void 0!==r[e]&&(a[e]=r[e])})},remove:function(){e.data(this,n.datakey).related-=1},setup:function(){if(!e.data(this,n.datakey)){var i=e.extend({related:0},n.defaults);e.data(this,n.datakey,i),t.add(this,"mousedown",n.init,i),this.attachEvent&&this.attachEvent("ondragstart",n.dontstart)}},teardown:function(){e.data(this,n.datakey).related||(e.removeData(this,n.datakey),t.remove(this,"mousedown",n.init),t.remove(this,"draginit",n.delegate),n.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",n.dontstart))},init:function(a){var r,s=a.data;return s.which>0&&a.which!=s.which||e(a.target).is(s.not)||s.handle&&!e(a.target).closest(s.handle,a.currentTarget).length||(s.propagates=1,s.interactions=[n.interaction(this,s)],s.target=a.target,s.pageX=a.pageX,s.pageY=a.pageY,s.dragging=null,r=n.hijack(a,"draginit",s),!s.propagates)?void 0:((r=n.flatten(r))&&r.length&&(s.interactions=[],e.each(r,function(){s.interactions.push(n.interaction(this,s))})),s.propagates=s.interactions.length,s.drop!==!1&&i.drop&&i.drop.handler(a,s),n.textselect(!1),t.add(document,"mousemove mouseup",n.handler,s),!1)},interaction:function(t,i){return{drag:t,callback:new n.callback,droppable:[],offset:e(t)[i.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(e){var a=e.data;switch(e.type){case!a.dragging&&"mousemove":if(Math.pow(e.pageX-a.pageX,2)+Math.pow(e.pageY-a.pageY,2)<Math.pow(a.distance,2))break;e.target=a.target,n.hijack(e,"dragstart",a),a.propagates&&(a.dragging=!0);case"mousemove":if(a.dragging){if(n.hijack(e,"drag",a),a.propagates){a.drop!==!1&&i.drop&&i.drop.handler(e,a);break}e.type="mouseup"}case"mouseup":t.remove(document,"mousemove mouseup",n.handler),a.dragging&&(a.drop!==!1&&i.drop&&i.drop.handler(e,a),n.hijack(e,"dragend",a)),n.textselect(!0),a.click===!1&&a.dragging&&(jQuery.event.triggered=!0,setTimeout(function(){jQuery.event.triggered=!1},20),a.dragging=!1)}},delegate:function(i){var a,r=[],s=e.data(this,"events")||{};return e.each(s.live||[],function(s,o){0===o.preType.indexOf("drag")&&(a=e(i.target).closest(o.selector,i.currentTarget)[0])&&(t.add(a,o.origType+"."+n.livekey,o.origHandler,o.data),e.inArray(a,r)<0&&r.push(a))}),r.length?e(r).bind("dragend."+n.livekey,function(){t.remove(this,"."+n.livekey)}):!1},hijack:function(i,a,r,s,o){if(r){var l,u,c,d={event:i.originalEvent,type:i.type},h=a.indexOf("drop")?"drag":"drop",p=s||0;s=isNaN(s)?r.interactions.length:s,i.type=a,i.originalEvent=null,r.results=[];do(u=r.interactions[p])&&("dragend"!==a&&u.cancelled||(c=n.properties(i,r,u),u.results=[],e(o||u[h]||r.droppable).each(function(s,o){return l=(c.target=o)?t.handle.call(o,i,c):null,l===!1?("drag"==h&&(u.cancelled=!0,r.propagates-=1),"drop"==a&&(u[h][s]=null)):"dropinit"==a&&u.droppable.push(n.element(l)||o),"dragstart"==a&&(u.proxy=e(n.element(l)||u.drag)[0]),u.results.push(l),delete i.result,"dropinit"!==a?l:void 0}),r.results[p]=n.flatten(u.results),"dropinit"==a&&(u.droppable=n.flatten(u.droppable)),"dragstart"==a&&!u.cancelled&&c.update()));while(++p<s);return i.type=d.type,i.originalEvent=d.event,n.flatten(r.results)}},properties:function(e,t,i){var a=i.callback;return a.drag=i.drag,a.proxy=i.proxy||i.drag,a.startX=t.pageX,a.startY=t.pageY,a.deltaX=e.pageX-t.pageX,a.deltaY=e.pageY-t.pageY,a.originalX=i.offset.left,a.originalY=i.offset.top,a.offsetX=e.pageX-(t.pageX-a.originalX),a.offsetY=e.pageY-(t.pageY-a.originalY),a.drop=n.flatten((i.drop||[]).slice()),a.available=n.flatten((i.droppable||[]).slice()),a},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?n.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",n.dontstart).attr("unselectable",t?"off":"on").css("MozUserSelect",t?"":"none")},dontstart:function(){return!1},callback:function(){}};n.callback.prototype={update:function(){i.drop&&this.available.length&&e.each(this.available,function(e){i.drop.locate(this,e)})}},i.draginit=i.dragstart=i.dragend=n}(jQuery),define("libraries/jquery/jquery.event.drag-2.0.min",function(){}),function(e){function t(){var e=!1,t=!1;this.stopPropagation=function(){e=!0},this.isPropagationStopped=function(){return e},this.stopImmediatePropagation=function(){t=!0},this.isImmediatePropagationStopped=function(){return t}}function i(){var e=[];this.subscribe=function(t){e.push(t)},this.unsubscribe=function(t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},this.notify=function(i,n,a){n=n||new t,a=a||this;for(var r,s=0;s<e.length&&!n.isPropagationStopped()&&!n.isImmediatePropagationStopped();s++)r=e[s].call(a,n,i);return r}}function n(){var e=[];this.subscribe=function(t,i){return e.push({event:t,handler:i}),t.subscribe(i),this},this.unsubscribe=function(t,i){for(var n=e.length;n--;)if(e[n].event===t&&e[n].handler===i)return e.splice(n,1),void t.unsubscribe(i);return this},this.unsubscribeAll=function(){for(var t=e.length;t--;)e[t].event.unsubscribe(e[t].handler);return e=[],this}}function a(e,t,i,n){void 0===i&&void 0===n&&(i=e,n=t),this.fromRow=Math.min(e,i),this.fromCell=Math.min(t,n),this.toRow=Math.max(e,i),this.toCell=Math.max(t,n),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(e,t){return e>=this.fromRow&&e<=this.toRow&&t>=this.fromCell&&t<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}function r(){this.__nonDataRow=!0}function s(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function o(){this.__groupTotals=!0,this.group=null}function l(){var e=null;this.isActive=function(t){return t?e===t:null!==e},this.activate=function(t){if(t!==e){if(null!==e)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!t.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!t.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";e=t}},this.deactivate=function(t){if(e!==t)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";e=null},this.commitCurrentEdit=function(){return e?e.commitCurrentEdit():!0},this.cancelCurrentEdit=function(){return e?e.cancelCurrentEdit():!0}}e.extend(!0,window,{Slick:{Event:i,EventData:t,EventHandler:n,Range:a,NonDataRow:r,Group:s,GroupTotals:o,EditorLock:l,GlobalEditorLock:new l}}),s.prototype=new r,s.prototype.equals=function(e){return this.value===e.value&&this.count===e.count&&this.collapsed===e.collapsed},o.prototype=new r}(jQuery),define("libraries/slickgrid/slick.core",function(){}),function(e){function t(e,t,i){return null===i||void 0===i||""===i?"-":50>i?"<span style='color:red;font-weight:bold;'>"+i+"%</span>":"<span style='color:green'>"+i+"%</span>"}function i(e,t,i){if(null===i||void 0===i||""===i)return"";var n;return n=30>i?"red":70>i?"silver":"green","<span class='percent-complete-bar' style='background:"+n+";width:"+i+"%'></span>"}function n(e,t,i){return i?"Yes":"No"}function a(e,t,i){return i?"<img src='../images/tick.png'>":""}e.extend(!0,window,{Slick:{Formatters:{PercentComplete:t,PercentCompleteBar:i,YesNo:n,Checkmark:a}}})}(jQuery),define("libraries/slickgrid/slick.formatters",function(){}),function(e){function t(t){var i,n;this.init=function(){i=e("<INPUT type=text class='editor-text' />").appendTo(t.container).bind("keydown.nav",function(t){(t.keyCode===e.ui.keyCode.LEFT||t.keyCode===e.ui.keyCode.RIGHT)&&t.stopImmediatePropagation()}).focus().select()},this.destroy=function(){i.remove()},this.focus=function(){i.focus()},this.getValue=function(){return i.val()},this.setValue=function(e){i.val(e)},this.loadValue=function(e){n=e[t.column.field]||"",i.val(n),i[0].defaultValue=n,i.select()},this.serializeValue=function(){return i.val()},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return!(""==i.val()&&null==n)&&i.val()!=n},this.validate=function(){if(t.column.validator){var e=t.column.validator(i.val());if(!e.valid)return e}return{valid:!0,msg:null}},this.init()}function i(t){var i,n;this.init=function(){i=e("<INPUT type=text class='editor-text' />"),i.bind("keydown.nav",function(t){(t.keyCode===e.ui.keyCode.LEFT||t.keyCode===e.ui.keyCode.RIGHT)&&t.stopImmediatePropagation()}),i.appendTo(t.container),i.focus().select()},this.destroy=function(){i.remove()},this.focus=function(){i.focus()},this.loadValue=function(e){n=e[t.column.field],i.val(n),i[0].defaultValue=n,i.select()},this.serializeValue=function(){return parseInt(i.val(),10)||0},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return!(""==i.val()&&null==n)&&i.val()!=n},this.validate=function(){return isNaN(i.val())?{valid:!1,msg:"Please enter a valid integer"}:{valid:!0,msg:null}},this.init()}function n(t){var i,n,a=!1;this.init=function(){i=e("<INPUT type=text class='editor-text' />"),i.appendTo(t.container),i.focus().select(),i.datepicker({showOn:"button",buttonImageOnly:!0,buttonImage:"../images/calendar.gif",beforeShow:function(){a=!0},onClose:function(){a=!1}}),i.width(i.width()-18)},this.destroy=function(){e.datepicker.dpDiv.stop(!0,!0),i.datepicker("hide"),i.datepicker("destroy"),i.remove()},this.show=function(){a&&e.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){a&&e.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(t){a&&e.datepicker.dpDiv.css("top",t.top+30).css("left",t.left)},this.focus=function(){i.focus()},this.loadValue=function(e){n=e[t.column.field],i.val(n),i[0].defaultValue=n,i.select()},this.serializeValue=function(){return i.val()},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return!(""==i.val()&&null==n)&&i.val()!=n},this.validate=function(){return{valid:!0,msg:null}},this.init()}function a(t){var i,n;this.init=function(){i=e("<SELECT tabIndex='0' class='editor-yesno'><OPTION value='yes'>Yes</OPTION><OPTION value='no'>No</OPTION></SELECT>"),i.appendTo(t.container),i.focus()},this.destroy=function(){i.remove()},this.focus=function(){i.focus()},this.loadValue=function(e){i.val((n=e[t.column.field])?"yes":"no"),i.select()},this.serializeValue=function(){return"yes"==i.val()},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return i.val()!=n},this.validate=function(){return{valid:!0,msg:null}},this.init()}function r(t){var i,n;this.init=function(){i=e("<INPUT type=checkbox value='true' class='editor-checkbox' hideFocus>"),i.appendTo(t.container),i.focus()},this.destroy=function(){i.remove()},this.focus=function(){i.focus()},this.loadValue=function(e){n=!!e[t.column.field],n?i.attr("checked","checked"):i.removeAttr("checked")},this.serializeValue=function(){return!!i.attr("checked")},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return this.serializeValue()!==n},this.validate=function(){return{valid:!0,msg:null}},this.init()}function s(t){var i,n,a;this.init=function(){i=e("<INPUT type=text class='editor-percentcomplete' />"),i.width(e(t.container).innerWidth()-25),i.appendTo(t.container),n=e("<div class='editor-percentcomplete-picker' />").appendTo(t.container),n.append("<div class='editor-percentcomplete-helper'><div class='editor-percentcomplete-wrapper'><div class='editor-percentcomplete-slider' /><div class='editor-percentcomplete-buttons' /></div></div>"),n.find(".editor-percentcomplete-buttons").append("<button val=0>Not started</button><br/><button val=50>In Progress</button><br/><button val=100>Complete</button>"),i.focus().select(),n.find(".editor-percentcomplete-slider").slider({orientation:"vertical",range:"min",value:a,slide:function(e,t){i.val(t.value)}}),n.find(".editor-percentcomplete-buttons button").bind("click",function(){i.val(e(this).attr("val")),n.find(".editor-percentcomplete-slider").slider("value",e(this).attr("val"))})},this.destroy=function(){i.remove(),n.remove()},this.focus=function(){i.focus()},this.loadValue=function(e){i.val(a=e[t.column.field]),i.select()},this.serializeValue=function(){return parseInt(i.val(),10)||0},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return!(""==i.val()&&null==a)&&(parseInt(i.val(),10)||0)!=a},this.validate=function(){return isNaN(parseInt(i.val(),10))?{valid:!1,msg:"Please enter a valid positive number"}:{valid:!0,msg:null}},this.init()}function o(t){var i,n,a,r=this;this.init=function(){var a=e("body");n=e("<DIV style='z-index:10000;position:absolute;background:white;padding:5px;border:3px solid gray; -moz-border-radius:10px; border-radius:10px;'/>").appendTo(a),i=e("<TEXTAREA hidefocus rows=5 style='backround:white;width:250px;height:80px;border:0;outline:0'>").appendTo(n),e("<DIV style='text-align:right'><BUTTON>Save</BUTTON><BUTTON>Cancel</BUTTON></DIV>").appendTo(n),n.find("button:first").bind("click",this.save),n.find("button:last").bind("click",this.cancel),i.bind("keydown",this.handleKeyDown),r.position(t.position),i.focus().select()},this.handleKeyDown=function(i){i.which==e.ui.keyCode.ENTER&&i.ctrlKey?r.save():i.which==e.ui.keyCode.ESCAPE?(i.preventDefault(),r.cancel()):i.which==e.ui.keyCode.TAB&&i.shiftKey?(i.preventDefault(),t.grid.navigatePrev()):i.which==e.ui.keyCode.TAB&&(i.preventDefault(),t.grid.navigateNext())},this.save=function(){t.commitChanges()},this.cancel=function(){i.val(a),t.cancelChanges()},this.hide=function(){n.hide()},this.show=function(){n.show()},this.position=function(e){n.css("top",e.top-5).css("left",e.left-5)},this.destroy=function(){n.remove()},this.focus=function(){i.focus()},this.loadValue=function(e){i.val(a=e[t.column.field]),i.select()},this.serializeValue=function(){return i.val()},this.applyValue=function(e,i){e[t.column.field]=i},this.isValueChanged=function(){return!(""==i.val()&&null==a)&&i.val()!=a},this.validate=function(){return{valid:!0,msg:null}},this.init()}e.extend(!0,window,{Slick:{Editors:{Text:t,Integer:i,Date:n,YesNoSelect:a,Checkbox:r,PercentComplete:s,LongText:o}}})}(jQuery),define("libraries/slickgrid/slick.editors",function(){}),function(e){function t(t,i){function n(n){r||(r=e("<div></div>",{css:i.selectionCss}).css("position","absolute").appendTo(t.getCanvasNode()));var a=t.getCellNodeBox(n.fromRow,n.fromCell),s=t.getCellNodeBox(n.toRow,n.toCell);return r.css({top:a.top-1,left:a.left-1,height:s.bottom-a.top-2,width:s.right-a.left-2}),r}function a(){r&&(r.remove(),r=null)}var r,s={selectionCss:{zIndex:"9999",border:"2px dashed red"}};i=e.extend(!0,{},s,i),e.extend(this,{show:n,hide:a})}e.extend(!0,window,{Slick:{CellRangeDecorator:t}})}(jQuery),define("libraries/slickgrid/plugins/slick.cellrangedecorator",function(){}),function(e){function t(t){function i(i){t=e.extend(!0,{},f,t),d=new Slick.CellRangeDecorator(i,t),l=i,u=l.getCanvasNode(),p.subscribe(l.onDragInit,a).subscribe(l.onDragStart,r).subscribe(l.onDrag,s).subscribe(l.onDragEnd,o)}function n(){p.unsubscribeAll()}function a(e){e.stopImmediatePropagation()}function r(t,i){var n=l.getCellFromEvent(t);
if(h.onBeforeCellRangeSelected.notify(n)!==!1&&l.canCellBeSelected(n.row,n.cell)&&(c=!0,t.stopImmediatePropagation()),c){var a=l.getCellFromPoint(i.startX-e(u).offset().left,i.startY-e(u).offset().top);return i.range={start:a,end:{}},d.show(new Slick.Range(a.row,a.cell))}}function s(t,i){if(c){t.stopImmediatePropagation();var n=l.getCellFromPoint(t.pageX-e(u).offset().left,t.pageY-e(u).offset().top);l.canCellBeSelected(n.row,n.cell)&&(i.range.end=n,d.show(new Slick.Range(i.range.start.row,i.range.start.cell,n.row,n.cell)))}}function o(e,t){c&&(c=!1,e.stopImmediatePropagation(),d.hide(),h.onCellRangeSelected.notify({range:new Slick.Range(t.range.start.row,t.range.start.cell,t.range.end.row,t.range.end.cell)}))}var l,u,c,d,h=this,p=new Slick.EventHandler,f={selectionCss:{border:"2px dashed blue"}};e.extend(this,{init:i,destroy:n,onBeforeCellRangeSelected:new Slick.Event,onCellRangeSelected:new Slick.Event})}e.extend(!0,window,{Slick:{CellRangeSelector:t}})}(jQuery),define("libraries/slickgrid/plugins/slick.cellrangeselector",function(){}),function(e){function t(t){function i(i){p=e.extend(!0,{},v,t),d=i,h=d.getCanvasNode(),d.onActiveCellChanged.subscribe(u),d.onKeyDown.subscribe(c),i.registerPlugin(g),g.onCellRangeSelected.subscribe(l),g.onBeforeCellRangeSelected.subscribe(o)}function n(){d.onActiveCellChanged.unsubscribe(u),d.onKeyDown.unsubscribe(c),g.onCellRangeSelected.unsubscribe(l),g.onBeforeCellRangeSelected.unsubscribe(o),d.unregisterPlugin(g)}function a(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];d.canCellBeSelected(n.fromRow,n.fromCell)&&d.canCellBeSelected(n.toRow,n.toCell)&&t.push(n)}return t}function r(e){f=a(e),m.onSelectedRangesChanged.notify(f)}function s(){return f}function o(e){return d.getEditorLock().isActive()?(e.stopPropagation(),!1):void 0}function l(e,t){r([t.range])}function u(e,t){p.selectActiveCell&&null!=t.row&&null!=t.cell&&r([new Slick.Range(t.row,t.cell)])}function c(e){var t,i,n=d.getActiveCell();if(n&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&(37==e.which||39==e.which||38==e.which||40==e.which)){t=s(),t.length||t.push(new Slick.Range(n.row,n.cell)),i=t.pop(),i.contains(n.row,n.cell)||(i=new Slick.Range(n.row,n.cell));var o=i.toRow-i.fromRow,l=i.toCell-i.fromCell,u=n.row==i.fromRow?1:-1,c=n.cell==i.fromCell?1:-1;37==e.which?l-=c:39==e.which?l+=c:38==e.which?o-=u:40==e.which&&(o+=u);var h=new Slick.Range(n.row,n.cell,n.row+u*o,n.cell+c*l);a([h]).length?(t.push(h),d.scrollRowIntoView(u>0?h.toRow:h.fromRow),d.scrollCellIntoView(h.fromRow,c>0?h.toCell:h.fromCell)):t.push(i),r(t),e.preventDefault(),e.stopPropagation()}}var d,h,p,f=[],m=this,g=new Slick.CellRangeSelector({selectionCss:{border:"2px solid black"}}),v={selectActiveCell:!0};e.extend(this,{getSelectedRanges:s,setSelectedRanges:r,init:i,destroy:n,onSelectedRangesChanged:new Slick.Event})}e.extend(!0,window,{Slick:{CellSelectionModel:t}})}(jQuery),define("libraries/slickgrid/plugins/slick.cellselectionmodel",function(){}),function(e){function t(t){function i(i){t=e.extend(!0,{},m,t),c=i,f.subscribe(c.onHeaderCellRendered,s).subscribe(c.onBeforeHeaderCellDestroy,o),c.setColumns(c.getColumns())}function n(){f.unsubscribeAll(),e(document.body).unbind("mousedown",a)}function a(t){d&&d[0]!=t.target&&!e.contains(d[0],t.target)&&r()}function r(){d&&(d.remove(),d=null,h.removeClass("slick-header-column-active"))}function s(i,n){var a=n.column,r=a.header&&a.header.menu;if(r){var s=e("<div></div>").addClass("slick-header-menubutton").data("column",a).data("menu",r);t.buttonCssClass&&s.addClass(t.buttonCssClass),a.header.icon?s.append(e("<div></div>").addClass(a.header.icon)):t.buttonImage&&s.append(e("<div></div>").css({"background-image":"url("+t.buttonImage+")",width:"16px",height:"16px","background-position":"center"})),r.tooltip&&s.attr("title",r.tooltip),s.bind("click",l).appendTo(n.node)}}function o(t,i){var n=i.column;n.header&&n.header.menu&&e(i.node).find(".slick-header-menubutton").remove()}function l(t){var i=e(this),n=i.data("menu"),a=i.data("column");if(null!=h&&h.hasClass("slick-header-column-active"))return void r();if(0!=p.onBeforeMenuShow.notify({grid:c,column:a,menu:n},t,p)){d||(d=e("<div class='slick-header-menu'></div>").appendTo(document.body)),d.empty();for(var s=0;s<n.items.length;s++){var o=n.items[s],l=e("<div class='slick-header-menuitem'></div>").data("command",o.command||"").data("column",a).appendTo(d);o.actionType&&"link"==o.actionType?l.bind("click",u):l.bind("change",u),o.tooltip&&l.attr("title",o.tooltip),e(o.element).appendTo(l)}d.css("top",e(this).offset().top+e(this).height()+7).css("left",e(this).offset().left),h=i.closest(".slick-header-column"),h.addClass("slick-header-column-active")}}function u(t){var i=e(this).data("command"),n=e(this).data("column");null!=i&&""!=i&&p.onCommand.notify({grid:c,column:n,command:i},t,p),t.preventDefault(),t.stopPropagation()}var c,d,h,p=this,f=new Slick.EventHandler,m={buttonCssClass:null,buttonImage:"/Oskari/libraries/slickgrid/images/down.gif"};e.extend(this,{init:i,destroy:n,hide:r,onBeforeMenuShow:new Slick.Event,onCommand:new Slick.Event})}e.extend(!0,window,{Slick:{Plugins:{HeaderMenu2:t}}})}(jQuery),define("libraries/slickgrid/plugins/slick.headermenu2",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("libraries/slickgrid/plugins/slick.headermenu2.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,function(e){function t(t){function i(i){t=e.extend(!0,{},c,t),o=i,u.subscribe(o.onHeaderCellRendered,a).subscribe(o.onBeforeHeaderCellDestroy,r),o.setColumns(o.getColumns())}function n(){u.unsubscribeAll()}function a(i,n){var a=n.column;if(a.header&&a.header.buttons)for(var r=a.header.buttons.length;r--;){var o=a.header.buttons[r],l=e("<div></div>").addClass(t.buttonCssClass).data("column",a).data("button",o);o.showOnHover&&l.addClass("slick-header-button-hidden"),o.image&&l.css("backgroundImage","url("+o.image+")"),o.cssClass&&l.addClass(o.cssClass),o.tooltip&&l.attr("title",o.tooltip),o.command&&l.data("command",o.command),o.handler&&l.bind("click",o.handler),l.bind("click",s).appendTo(n.node)}}function r(i,n){var a=n.column;a.header&&a.header.buttons&&e(n.node).find("."+t.buttonCssClass).remove()}function s(t){var i=e(this).data("command"),n=e(this).data("column"),a=e(this).data("button");null!=i&&(l.onCommand.notify({grid:o,column:n,command:i,button:a},t,l),o.updateColumnHeader(n.id)),t.preventDefault(),t.stopPropagation()}var o,l=this,u=new Slick.EventHandler,c={buttonCssClass:"slick-header-button"};e.extend(this,{init:i,destroy:n,onCommand:new Slick.Event})}e.extend(!0,window,{Slick:{Plugins:{HeaderButtons:t}}})}(jQuery),define("libraries/slickgrid/plugins/slick.headerbuttons",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("libraries/slickgrid/plugins/slick.headerbuttons.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,function(e){function t(t){function i(i){v=e.extend(!0,{},_,t),m=i,k.subscribe(m.onActiveCellChanged,a(h)),k.subscribe(m.onKeyDown,a(p)),k.subscribe(m.onClick,a(f))}function n(){k.unsubscribeAll()}function a(e){return function(){g||(g=!0,e.apply(this,arguments),g=!1)}}function r(e){for(var t=[],i=0;i<e.length;i++)for(var n=e[i].fromRow;n<=e[i].toRow;n++)t.push(n);return t}function s(e){for(var t=[],i=m.getColumns().length-1,n=0;n<e.length;n++)t.push(new Slick.Range(e[n],0,e[n],i));return t}function o(e,t){var i,n=[];for(i=e;t>=i;i++)n.push(i);for(i=t;e>i;i++)n.push(i);return n}function l(){return r(y)}function u(e){c(s(e))}function c(e){y=e,b.onSelectedRangesChanged.notify(y)}function d(){return y}function h(e,t){v.selectActiveRow&&null!=t.row&&c([new Slick.Range(t.row,0,t.row,m.getColumns().length-1)])}function p(e){var t=m.getActiveCell();if(t&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38==e.which||40==e.which)){var i=l();i.sort(function(e,t){return e-t}),i.length||(i=[t.row]);var n,a=i[0],r=i[i.length-1];n=40==e.which?t.row<r||a==r?++r:++a:t.row<r?--r:--a,n>=0&&n<m.getDataLength()&&(m.scrollRowIntoView(n),y=s(o(a,r)),c(y)),e.preventDefault(),e.stopPropagation()}}function f(t){var i=m.getCellFromEvent(t);if(!i||!m.canCellBeActive(i.row,i.cell))return!1;var n=r(y),a=e.inArray(i.row,n);if(!(t.ctrlKey||t.shiftKey||t.metaKey))return!1;if(m.getOptions().multiSelect)if(-1===a&&(t.ctrlKey||t.metaKey))n.push(i.row),m.setActiveCell(i.row,i.cell);else if(-1!==a&&(t.ctrlKey||t.metaKey))n=e.grep(n,function(e){return e!==i.row}),m.setActiveCell(i.row,i.cell);else if(n.length&&t.shiftKey){var o=n.pop(),l=Math.min(i.row,o),u=Math.max(i.row,o);n=[];for(var d=l;u>=d;d++)d!==o&&n.push(d);n.push(o),m.setActiveCell(i.row,i.cell)}return y=s(n),c(y),t.stopImmediatePropagation(),!0}var m,g,v,y=[],b=this,k=new Slick.EventHandler,_={selectActiveRow:!0};e.extend(this,{getSelectedRows:l,setSelectedRows:u,getSelectedRanges:d,setSelectedRanges:c,init:i,destroy:n,onSelectedRangesChanged:new Slick.Event})}e.extend(!0,window,{Slick:{RowSelectionModel:t}})}(jQuery),define("libraries/slickgrid/plugins/slick.rowselectionmodel",function(){}),function(e){function t(t){function i(e){u=e,d.subscribe(u.onClick,r).subscribe(u.onHeaderClick,s).subscribe(u.onKeyDown,a)}function n(){d.unsubscribeAll()}function a(e,t){32==e.which&&u.getColumns()[t.cell].id===p.columnId&&((!u.getEditorLock().isActive()||u.getEditorLock().commitCurrentEdit())&&toggleRowSelection(t.row),e.preventDefault(),e.stopImmediatePropagation())}function r(t,i){if(u.getColumns()[i.cell].id===p.columnId&&e(t.target).is(":checkbox")){if(u.getEditorLock().isActive()&&!u.getEditorLock().commitCurrentEdit())return t.preventDefault(),void t.stopImmediatePropagation();c.onSelectRowClicked.notify(i,t,c);var n=u.getData(),a=n.getGroups(),r=n.getItems().length,s=!1;for(var o in a){var l=a[o];if(l.count==r&&e(t.target).is(":checked")){u.updateColumnHeader(p.columnId,"<input type='checkbox' checked='checked'>",p.toolTip),s=!0;break}}s||u.updateColumnHeader(p.columnId,"<input type='checkbox'>",p.toolTip),u.getData().refresh(),u.invalidateAllRows(),u.render(),t.stopPropagation(),t.stopImmediatePropagation()}}function s(t,i){if(i.column.id==p.columnId&&e(t.target).is(":checkbox")){if(u.getEditorLock().isActive()&&!u.getEditorLock().commitCurrentEdit())return t.preventDefault(),void t.stopImmediatePropagation();var n=u.getData().getItems();if(e(t.target).is(":checked"))for(var a=0;a<n.length;a++){var r=n[a];r.sel="checked"}else for(var a=0;a<n.length;a++){var r=n[a];r.sel="empty"}c.onSelectHeaderRowClicked.notify(i,t,c),u.getData().setItems(n),u.getData().refresh(),u.invalidateAllRows(),u.render(),t.stopPropagation(),t.stopImmediatePropagation()}}function o(){return{id:p.columnId,name:"<input type='checkbox'>",toolTip:p.toolTip,field:"sel",width:p.width,resizable:!1,sortable:!1,cssClass:p.cssClass,formatter:l}}function l(e,t,i,n,a){return a?"checked"==a.sel?"<input type='checkbox' checked='checked'>":"<input type='checkbox'>":null}var u,c=this,d=new Slick.EventHandler,h={columnId:"_checkbox_selector",cssClass:null,toolTip:"Select/Deselect All",width:30},p=e.extend(!0,{},h,t);e.extend(this,{init:i,destroy:n,onSelectRowClicked:new Slick.Event,onSelectHeaderRowClicked:new Slick.Event,getColumnDefinition:o})}e.extend(!0,window,{Slick:{CheckboxSelectColumn2:t}})}(jQuery),define("libraries/slickgrid/plugins/slick.checkboxselectcolumn2",function(){}),"undefined"==typeof jQuery)throw"SlickGrid requires jquery module to be loaded";if(!jQuery.fn.drag)throw"SlickGrid requires jquery.event.drag module to be loaded";if("undefined"==typeof Slick)throw"slick.core.js not loaded";!function($){function SlickGrid(container,data,columns,options){function init(){if($container=$(container),$container.length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,columnsById={};for(var e=0;e<columns.length;e++){var t=columns[e]=$.extend({},columnDefaults,columns[e]);columnsById[t.id]=e,t.minWidth&&t.width<t.minWidth&&(t.width=t.minWidth),t.maxWidth&&t.width>t.maxWidth&&(t.width=t.maxWidth)}if(options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller),$headers.width(getHeadersWidth()),$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller),$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller),$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),$canvas=$("<div class='grid-canvas' />").appendTo($viewport),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,viewportW=parseFloat($.css($container[0],"width",!0)),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.bind("selectstart.ui",function(e){return $(e.target).is("input,textarea")}),updateColumnCaches(),createColumnHeaders(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.bind("resize.slickgrid",resizeCanvas),$viewport.bind("scroll",handleScroll),$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave),$headerRowScroller.bind("scroll",handleHeaderRowScroll),$focusSink.add($focusSink2).bind("keydown",handleKeyDown),$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave))}function registerPlugin(e){plugins.unshift(e),e.init(self)}function unregisterPlugin(e){for(var t=plugins.length;t>=0;t--)if(plugins[t]===e){plugins[t].destroy&&plugins[t].destroy(),plugins.splice(t,1);break}}function setSelectionModel(e){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),selectionModel=e,selectionModel&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var e=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight};return e.remove(),t}function getHeadersWidth(){for(var e=0,t=0,i=columns.length;i>t;t++){var n=columns[t].width;e+=n}return e+=scrollbarDimensions.width,Math.max(e,viewportW)+1e3}function getCanvasWidth(){for(var e=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,t=0,i=columns.length;i--;)t+=columns[i].width;return options.fullWidthRows?Math.max(t,e):t}function updateCanvasWidth(e){var t=canvasWidth;canvasWidth=getCanvasWidth(),canvasWidth!=t&&($canvas.width(canvasWidth),$headerRow.width(canvasWidth),$headers.width(getHeadersWidth()),viewportHasHScroll=canvasWidth>viewportW-scrollbarDimensions.width),$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),(canvasWidth!=t||e)&&applyColumnWidths()}function disableSelection(e){e&&e.jquery&&e.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var e=1e6,t=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,i=$("<div style='display:none' />").appendTo(document.body);;){var n=2*e;if(i.css("height",n),n>t||i.height()!==n)break;e=n}return i.remove(),e}function bindAncestorScrollEvents(){for(var e=$canvas[0];(e=e.parentNode)!=document.body&&null!=e;)if(e==$viewport[0]||e.scrollWidth!=e.clientWidth||e.scrollHeight!=e.clientHeight){var t=$(e);$boundAncestors=$boundAncestors?$boundAncestors.add(t):t,t.bind("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.unbind("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(e,t,i){if(initialized){var n=getColumnIndex(e);if(null!=n){var a=columns[n],r=$headers.children().eq(n);r&&(void 0!==t&&(columns[n].name=t),void 0!==i&&(columns[n].toolTip=i),trigger(self.onBeforeHeaderCellDestroy,{node:r[0],column:a}),r.attr("title",i||"").children().eq(0).html(t),trigger(self.onHeaderCellRendered,{node:r[0],column:a}))}}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(e){var t=getColumnIndex(e),i=$headerRow.children().eq(t);return i&&i[0]}function createColumnHeaders(){function e(){$(this).addClass("ui-state-hover")}function t(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var e=$(this).data("column");e&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:e})}),$headers.empty(),$headers.width(getHeadersWidth()),$headerRow.find(".slick-headerrow-column").each(function(){var e=$(this).data("column");e&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:e})}),$headerRow.empty();for(var i=0;i<columns.length;i++){var n=columns[i],a=$("<div class='ui-state-default slick-header-column' id='"+uid+n.id+"' />").html("<span class='slick-column-name'>"+n.name+"</span>").width(n.width-headerColumnWidthDiff).attr("title",n.toolTip||"").data("column",n).addClass(n.headerCssClass||"").appendTo($headers);if((options.enableColumnReorder||n.sortable)&&a.on("mouseenter",e).on("mouseleave",t),n.sortable&&(a.addClass("slick-header-sortable"),a.append("<span class='slick-sort-indicator' />")),trigger(self.onHeaderCellRendered,{node:a[0],column:n}),options.showHeaderRow){var r=$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").data("column",n).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:r[0],column:n})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&setupColumnReorder()}function setupColumnSort(){$headers.click(function(e){if(e.metaKey=e.metaKey||e.ctrlKey,!$(e.target).hasClass("slick-resizable-handle")){var t=$(e.target).closest(".slick-header-column");if(t.length){var i=t.data("column");if(i.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var n=null,a=0;a<sortColumns.length;a++)if(sortColumns[a].columnId==i.id){n=sortColumns[a],n.sortAsc=!n.sortAsc;break}e.metaKey&&options.multiColumnSort?n&&sortColumns.splice(a,1):((e.shiftKey||e.metaKey)&&options.multiColumnSort||(sortColumns=[]),n?0==sortColumns.length&&sortColumns.push(n):(n={columnId:i.id,sortAsc:i.defaultSortAsc},sortColumns.push(n))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(e){return{sortCol:columns[getColumnIndex(e.columnId)],sortAsc:e.sortAsc}})},e):trigger(self.onSort,{multiColumnSort:!1,sortCol:i,sortAsc:n.sortAsc},e)}}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy"),$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:!0,start:function(e,t){$(t.helper).addClass("slick-header-column-active")},beforeStop:function(e,t){$(t.helper).removeClass("slick-header-column-active")},stop:function(e){if(!getEditorLock().commitCurrentEdit())return void $(this).sortable("cancel");for(var t=$headers.sortable("toArray"),i=[],n=0;n<t.length;n++)i.push(columns[getColumnIndex(t[n].replace(uid,""))]);setColumns(i),trigger(self.onColumnsReordered,{}),e.stopPropagation(),setupColumnResize()}})}function setupColumnResize(){var e,t,i,n,a,r,s,o,l;a=$headers.children(),a.find(".slick-resizable-handle").remove(),a.each(function(e){columns[e].resizable&&(void 0===o&&(o=e),l=e)}),void 0!==o&&a.each(function(u,c){o>u||options.forceFitColumns&&u>=l||(e=$(c),$("<div class='slick-resizable-handle' />").appendTo(c).bind("dragstart",function(e){if(!getEditorLock().commitCurrentEdit())return!1;n=e.pageX,$(this).parent().addClass("slick-header-column-active");var o=null,l=null;if(a.each(function(e,t){columns[e].previousWidth=$(t).outerWidth()}),options.forceFitColumns)for(o=0,l=0,t=u+1;t<a.length;t++)i=columns[t],i.resizable&&(null!==l&&(i.maxWidth?l+=i.maxWidth-i.previousWidth:l=null),o+=i.previousWidth-Math.max(i.minWidth||0,absoluteColumnMinWidth));var c=0,d=0;for(t=0;u>=t;t++)i=columns[t],i.resizable&&(null!==d&&(i.maxWidth?d+=i.maxWidth-i.previousWidth:d=null),c+=i.previousWidth-Math.max(i.minWidth||0,absoluteColumnMinWidth));null===o&&(o=1e5),null===c&&(c=1e5),null===l&&(l=1e5),null===d&&(d=1e5),s=n+Math.min(o,d),r=n-Math.min(c,l)}).bind("drag",function(e){var o,l,c=Math.min(s,Math.max(r,e.pageX))-n;if(0>c){for(l=c,t=u;t>=0;t--)i=columns[t],i.resizable&&(o=Math.max(i.minWidth||0,absoluteColumnMinWidth),l&&i.previousWidth+l<o?(l+=i.previousWidth-o,i.width=o):(i.width=i.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-c,t=u+1;t<a.length;t++)i=columns[t],i.resizable&&(l&&i.maxWidth&&i.maxWidth-i.previousWidth<l?(l-=i.maxWidth-i.previousWidth,i.width=i.maxWidth):(i.width=i.previousWidth+l,l=0))}else{for(l=c,t=u;t>=0;t--)i=columns[t],i.resizable&&(l&&i.maxWidth&&i.maxWidth-i.previousWidth<l?(l-=i.maxWidth-i.previousWidth,i.width=i.maxWidth):(i.width=i.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-c,t=u+1;t<a.length;t++)i=columns[t],i.resizable&&(o=Math.max(i.minWidth||0,absoluteColumnMinWidth),l&&i.previousWidth+l<o?(l+=i.previousWidth-o,i.width=o):(i.width=i.previousWidth+l,l=0))}applyColumnHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths()}).bind("dragend",function(){var e;for($(this).parent().removeClass("slick-header-column-active"),t=0;t<a.length;t++)i=columns[t],e=$(a[t]).outerWidth(),i.previousWidth!==e&&i.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{})}))})}function getVBoxDelta(e){var t=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],i=0;return $.each(t,function(t,n){i+=parseFloat(e.css(n))||0}),i}function measureCellPaddingAndBorder(){var e,t=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],i=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];e=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,$.each(t,function(t,i){headerColumnWidthDiff+=parseFloat(e.css(i))||0}),$.each(i,function(t,i){headerColumnHeightDiff+=parseFloat(e.css(i))||0}),e.remove();var n=$("<div class='slick-row' />").appendTo($canvas);e=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(n),cellWidthDiff=cellHeightDiff=0,$.each(t,function(t,i){cellWidthDiff+=parseFloat(e.css(i))||0}),$.each(i,function(t,i){cellHeightDiff+=parseFloat(e.css(i))||0}),n.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));for(var e=options.rowHeight-cellHeightDiff,t=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+e+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],i=0;i<columns.length;i++)t.push("."+uid+" .l"+i+" { }"),t.push("."+uid+" .r"+i+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=t.join(" "):$style[0].appendChild(document.createTextNode(t.join(" ")))}function getColumnCssRules(e){if(!stylesheet){for(var t=document.styleSheets,i=0;i<t.length;i++)if((t[i].ownerNode||t[i].owningElement)==$style[0]){stylesheet=t[i];break}if(!stylesheet)throw new Error("Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];for(var n,a,r=stylesheet.cssRules||stylesheet.rules,i=0;i<r.length;i++){var s=r[i].selectorText;(n=/\.l\d+/.exec(s))?(a=parseInt(n[0].substr(2,n[0].length-2),10),columnCssRulesL[a]=r[i]):(n=/\.r\d+/.exec(s))&&(a=parseInt(n[0].substr(2,n[0].length-2),10),columnCssRulesR[a]=r[i])}}return{left:columnCssRulesL[e],right:columnCssRulesR[e]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{});for(var e=plugins.length;e--;)unregisterPlugin(plugins[e]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.unbind(".slickgrid"),removeCssRules(),$canvas.unbind("draginit dragstart dragend drag"),$container.empty().removeClass(uid)}function trigger(e,t,i){return i=i||new Slick.EventData,t=t||{},t.grid=self,e.notify(t,i,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(e){return columnsById[e]}function autosizeColumns(){var e,t,i,n=[],a=0,r=0,s=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(e=0;e<columns.length;e++)t=columns[e],n.push(t.width),r+=t.width,t.resizable&&(a+=t.width-Math.max(t.minWidth,absoluteColumnMinWidth));for(i=r;r>s&&a;){var o=(r-s)/a;for(e=0;e<columns.length&&r>s;e++){t=columns[e];var l=n[e];if(!(!t.resizable||l<=t.minWidth||absoluteColumnMinWidth>=l)){var u=Math.max(t.minWidth,absoluteColumnMinWidth),c=Math.floor(o*(l-u))||1;c=Math.min(c,l-u),r-=c,a-=c,n[e]-=c}}if(i==r)break;i=r}for(i=r;s>r;){var d=s/r;for(e=0;e<columns.length&&s>r;e++)if(t=columns[e],t.resizable&&!(t.maxWidth<=t.width)){var h=Math.min(Math.floor(d*t.width)-t.width,t.maxWidth-t.width||1e6)||1;r+=h,n[e]+=h}if(i==r)break;i=r}var p=!1;for(e=0;e<columns.length;e++)columns[e].rerenderOnResize&&columns[e].width!=n[e]&&(p=!0),columns[e].width=n[e];applyColumnHeaderWidths(),updateCanvasWidth(!0),p&&(invalidateAllRows(),render())}function applyColumnHeaderWidths(){if(initialized){for(var e,t=0,i=$headers.children(),n=i.length;n>t;t++)e=$(i[t]),e.width()!==columns[t].width-headerColumnWidthDiff&&e.width(columns[t].width-headerColumnWidthDiff);updateColumnCaches()}}function applyColumnWidths(){for(var e,t,i=0,n=0;n<columns.length;n++)e=columns[n].width,t=getColumnCssRules(n),t.left.style.left=i+"px",t.right.style.right=canvasWidth-i-e+"px",i+=columns[n].width}function setSortColumn(e,t){setSortColumns([{columnId:e,sortAsc:t}])}function setSortColumns(e){sortColumns=e;var t=$headers.children();t.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),$.each(sortColumns,function(e,i){null==i.sortAsc&&(i.sortAsc=!0);var n=getColumnIndex(i.columnId);null!=n&&t.eq(n).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(i.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,t){selectedRows=[];for(var i={},n=0;n<t.length;n++)for(var a=t[n].fromRow;a<=t[n].toRow;a++){i[a]||(selectedRows.push(a),i[a]={});for(var r=t[n].fromCell;r<=t[n].toCell;r++)canCellBeSelected(a,r)&&(i[a][columns[r].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,i),trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var e=0,t=0,i=columns.length;i>t;t++)columnPosLeft[t]=e,columnPosRight[t]=e+columns[t].width,e+=columns[t].width}function setColumns(e){columns=e,columnsById={};for(var t=0;t<columns.length;t++){var i=columns[t]=$.extend({},columnDefaults,columns[t]);columnsById[i.id]=t,i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth)}updateColumnCaches(),initialized&&(invalidateAllRows(),createColumnHeaders(),removeCssRules(),createCssRules(),resizeCanvas(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(e){getEditorLock().commitCurrentEdit()&&(makeActiveCellNormal(),options.enableAddRow!==e.enableAddRow&&invalidateRow(getDataLength()),options=$.extend(options,e),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),render())}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1)}function setData(e,t){data=e,invalidateAllRows(),updateRowCount(),t&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data.length}function getDataItem(e){return data.getItem?data.getItem(e):data[e]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(e){options.showTopPanel!=e&&(options.showTopPanel=e,e?$topPanelScroller.slideDown("fast",resizeCanvas):$topPanelScroller.slideUp("fast",resizeCanvas))}function setHeaderRowVisibility(e){options.showHeaderRow!=e&&(options.showHeaderRow=e,e?$headerRowScroller.slideDown("fast",resizeCanvas):$headerRowScroller.slideUp("fast",resizeCanvas))}function getRowTop(e){return options.rowHeight*e-offset}function getRowFromPosition(e){return Math.floor((e+offset)/options.rowHeight)}function scrollTo(e){e=Math.max(e,0),e=Math.min(e,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var t=offset;page=Math.min(n-1,Math.floor(e/ph)),offset=Math.round(page*cj);var i=e-offset;if(offset!=t){var a=getVisibleRange(i);cleanupRows(a),updateRowPositions()}prevScrollTop!=i&&(vScrollDir=i+offset>prevScrollTop+t?1:-1,$viewport[0].scrollTop=lastRenderedScrollTop=scrollTop=prevScrollTop=i,trigger(self.onViewportChanged,{}))}function defaultFormatter(e,t,i){return null==i?"":(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(e,t){var i=data.getItemMetadata&&data.getItemMetadata(e),n=i&&i.columns&&(i.columns[t.id]||i.columns[getColumnIndex(t.id)]);return n&&n.formatter||i&&i.formatter||t.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(t)||options.defaultFormatter}function getEditor(e,t){var i=columns[t],n=data.getItemMetadata&&data.getItemMetadata(e),a=n&&n.columns;return a&&a[i.id]&&void 0!==a[i.id].editor?a[i.id].editor:a&&a[t]&&void 0!==a[t].editor?a[t].editor:i.editor||options.editorFactory&&options.editorFactory.getEditor(i)
}function getDataItemValueForColumn(e,t){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(e,t):e[t.field]}function appendRowHtml(e,t,i){var n=getDataItem(t),a=t<getDataLength()&&!n,r="slick-row"+(a?" loading":"")+(t===activeRow?" active":"")+(t%2==1?" odd":" even"),s=data.getItemMetadata&&data.getItemMetadata(t);s&&s.cssClasses&&(r+=" "+s.cssClasses),e.push("<div class='ui-widget-content "+r+"' style='top:"+getRowTop(t)+"px'>");for(var o,l,u=0,c=columns.length;c>u;u++){if(l=columns[u],o=1,s&&s.columns){var d=s.columns[l.id]||s.columns[u];o=d&&d.colspan||1,"*"===o&&(o=c-u)}if(columnPosRight[Math.min(c-1,u+o-1)]>i.leftPx){if(columnPosLeft[u]>i.rightPx)break;appendCellHtml(e,t,u,o)}o>1&&(u+=o-1)}e.push("</div>")}function appendCellHtml(e,t,i,n){var a=columns[i],r=getDataItem(t),s="slick-cell l"+i+" r"+Math.min(columns.length-1,i+n-1)+(a.cssClass?" "+a.cssClass:"");t===activeRow&&i===activeCell&&(s+=" active");for(var o in cellCssClasses)cellCssClasses[o][t]&&cellCssClasses[o][t][a.id]&&(s+=" "+cellCssClasses[o][t][a.id]);if(e.push("<div class='"+s+"'>"),r){var l=getDataItemValueForColumn(r,a);e.push(getFormatter(t,a)(t,i,l,a,r))}e.push("</div>"),rowsCache[t].cellRenderQueue.push(i),rowsCache[t].cellColSpans[i]=n}function cleanupRows(e){for(var t in rowsCache)(t=parseInt(t,10))!==activeRow&&(t<e.top||t>e.bottom)&&removeRowFromCache(t)}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){currentEditor&&makeActiveCellNormal();for(var e in rowsCache)removeRowFromCache(e)}function removeRowFromCache(e){var t=rowsCache[e];t&&($canvas[0].removeChild(t.rowNode),delete rowsCache[e],delete postProcessedRows[e],renderedRows--,counter_rows_removed++)}function invalidateRows(e){var t,i;if(e&&e.length)for(vScrollDir=0,t=0,i=e.length;i>t;t++)currentEditor&&activeRow===e[t]&&makeActiveCellNormal(),rowsCache[e[t]]&&removeRowFromCache(e[t])}function invalidateRow(e){invalidateRows([e])}function updateCell(e,t){var i=getCellNode(e,t);if(i){var n=columns[t],a=getDataItem(e);currentEditor&&activeRow===e&&activeCell===t?currentEditor.loadValue(a):(i.innerHTML=a?getFormatter(e,n)(e,t,getDataItemValueForColumn(a,n),n,a):"",invalidatePostProcessingResults(e))}}function updateRow(e){var t=rowsCache[e];if(t){ensureCellNodesInRowsCache(e);for(var i in t.cellNodesByColumnIdx)if(t.cellNodesByColumnIdx.hasOwnProperty(i)){i=0|i;var n=columns[i],a=getDataItem(e),r=t.cellNodesByColumnIdx[i];e===activeRow&&i===activeCell&&currentEditor?currentEditor.loadValue(a):r.innerHTML=a?getFormatter(e,n)(e,i,getDataItemValueForColumn(a,n),n,a):""}invalidatePostProcessingResults(e)}}function getViewportHeight(){return parseFloat($.css($container[0],"height",!0))-parseFloat($.css($container[0],"paddingTop",!0))-parseFloat($.css($container[0],"paddingBottom",!0))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function resizeCanvas(){initialized&&(viewportH=options.autoHeight?options.rowHeight*(getDataLength()+(options.enableAddRow?1:0)):getViewportHeight(),numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportW=parseFloat($.css($container[0],"width",!0)),options.autoHeight||$viewport.height(viewportH),options.forceFitColumns&&autosizeColumns(),updateRowCount(),handleScroll(),render())}function updateRowCount(){if(initialized){numberOfRows=getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var e=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&numberOfRows*options.rowHeight>viewportH;var t=options.enableAddRow?getDataLength():getDataLength()-1;for(var i in rowsCache)i>=t&&removeRowFromCache(i);activeCellNode&&activeRow>t&&resetActiveCell();var a=h;th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height),maxSupportedCssHeight>th?(h=ph=th,n=1,cj=0):(h=maxSupportedCssHeight,ph=h/100,n=Math.floor(th/ph),cj=(th-h)/(n-1)),h!==a&&($canvas.css("height",h),scrollTop=$viewport[0].scrollTop);var r=th-viewportH>=scrollTop+offset;0==th||0==scrollTop?page=offset=0:scrollTo(r?scrollTop+offset:th-viewportH),h!=a&&options.autoHeight&&resizeCanvas(),options.forceFitColumns&&e!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(e,t){return null==e&&(e=scrollTop),null==t&&(t=scrollLeft),{top:getRowFromPosition(e),bottom:getRowFromPosition(e+viewportH)+1,leftPx:t,rightPx:t+viewportW}}function getRenderedRange(e,t){var i=getVisibleRange(e,t),n=Math.round(viewportH/options.rowHeight),a=3;return-1==vScrollDir?(i.top-=n,i.bottom+=a):1==vScrollDir?(i.top-=a,i.bottom+=n):(i.top-=a,i.bottom+=a),i.top=Math.max(0,i.top),i.bottom=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,i.bottom),i.leftPx-=viewportW,i.rightPx+=viewportW,i.leftPx=Math.max(0,i.leftPx),i.rightPx=Math.min(canvasWidth,i.rightPx),i}function ensureCellNodesInRowsCache(e){var t=rowsCache[e];if(t&&t.cellRenderQueue.length)for(var i=t.rowNode.lastChild;t.cellRenderQueue.length;){var n=t.cellRenderQueue.pop();t.cellNodesByColumnIdx[n]=i,i=i.previousSibling}}function cleanUpCells(e,t){var i=0,n=rowsCache[t],a=[];for(var r in n.cellNodesByColumnIdx)if(n.cellNodesByColumnIdx.hasOwnProperty(r)){r=0|r;var s=n.cellColSpans[r];(columnPosLeft[r]>e.rightPx||columnPosRight[Math.min(columns.length-1,r+s-1)]<e.leftPx)&&(t!=activeRow||r!=activeCell)&&a.push(r)}for(var o;null!=(o=a.pop());)n.rowNode.removeChild(n.cellNodesByColumnIdx[o]),delete n.cellColSpans[o],delete n.cellNodesByColumnIdx[o],postProcessedRows[t]&&delete postProcessedRows[t][o],i++}function cleanUpAndRenderCells(e){for(var t,i,n,a=[],r=[],s=0,o=e.top;o<=e.bottom;o++)if(t=rowsCache[o]){ensureCellNodesInRowsCache(o),cleanUpCells(e,o),i=0;var l=data.getItemMetadata&&data.getItemMetadata(o);l=l&&l.columns;for(var u=0,c=columns.length;c>u&&!(columnPosLeft[u]>e.rightPx);u++)if(null==(n=t.cellColSpans[u])){if(n=1,l){var d=l[columns[u].id]||l[u];n=d&&d.colspan||1,"*"===n&&(n=c-u)}columnPosRight[Math.min(c-1,u+n-1)]>e.leftPx&&(appendCellHtml(a,o,u,n),i++),u+=n>1?n-1:0}else u+=n>1?n-1:0;i&&(s+=i,r.push(o))}if(a.length){var h=document.createElement("div");h.innerHTML=a.join("");for(var p,f;null!=(p=r.pop());){t=rowsCache[p];for(var m;null!=(m=t.cellRenderQueue.pop());)f=h.lastChild,t.rowNode.appendChild(f),t.cellNodesByColumnIdx[m]=f}}}function renderRows(e){for(var t=$canvas[0],i=[],n=[],a=!1,r=e.top;r<=e.bottom;r++)rowsCache[r]||(renderedRows++,n.push(r),rowsCache[r]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(i,r,e),activeCellNode&&activeRow===r&&(a=!0),counter_rows_rendered++);if(n.length){var s=document.createElement("div");s.innerHTML=i.join("");for(var r=0,o=n.length;o>r;r++)rowsCache[n[r]].rowNode=t.appendChild(s.firstChild);a&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function invalidatePostProcessingResults(e){delete postProcessedRows[e],postProcessFromRow=Math.min(postProcessFromRow,e),postProcessToRow=Math.max(postProcessToRow,e),startPostProcessing()}function updateRowPositions(){for(var e in rowsCache)rowsCache[e].rowNode.style.top=getRowTop(e)+"px"}function render(){if(initialized){var e=getVisibleRange(),t=getRenderedRange();cleanupRows(t),lastRenderedScrollLeft!=scrollLeft&&cleanUpAndRenderCells(t),renderRows(t),postProcessFromRow=e.top,postProcessToRow=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,e.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,h_render=null}}function handleHeaderRowScroll(){var e=$headerRowScroller[0].scrollLeft;e!=$viewport[0].scrollLeft&&($viewport[0].scrollLeft=e)}function handleScroll(){scrollTop=$viewport[0].scrollTop,scrollLeft=$viewport[0].scrollLeft;var e=Math.abs(scrollTop-prevScrollTop),t=Math.abs(scrollLeft-prevScrollLeft);if(t&&(prevScrollLeft=scrollLeft,$headerScroller[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScroller[0].scrollLeft=scrollLeft),e)if(vScrollDir=scrollTop>prevScrollTop?1:-1,prevScrollTop=scrollTop,viewportH>e)scrollTo(scrollTop+offset);else{var i=offset;page=h==viewportH?0:Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),offset=Math.round(page*cj),i!=offset&&invalidateAllRows()}(t||e)&&(h_render&&clearTimeout(h_render),(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20)&&(options.forceSyncScrolling||Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW?render():h_render=setTimeout(render,50),trigger(self.onViewportChanged,{}))),trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){for(;postProcessToRow>=postProcessFromRow;){var e=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,t=rowsCache[e];if(t&&!(e>=getDataLength())){postProcessedRows[e]||(postProcessedRows[e]={}),ensureCellNodesInRowsCache(e);for(var i in t.cellNodesByColumnIdx)if(t.cellNodesByColumnIdx.hasOwnProperty(i)){i=0|i;var n=columns[i];if(n.asyncPostRender&&!postProcessedRows[e][i]){var a=t.cellNodesByColumnIdx[i];a&&n.asyncPostRender(a,e,getDataItem(e),n),postProcessedRows[e][i]=!0}}return void(h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}}}function updateCellCssStylesOnRenderedRows(e,t){var i,n,a,r;for(var s in rowsCache){if(r=t&&t[s],a=e&&e[s],r)for(n in r)a&&r[n]==a[n]||(i=getCellNode(s,getColumnIndex(n)),i&&$(i).removeClass(r[n]));if(a)for(n in a)r&&r[n]==a[n]||(i=getCellNode(s,getColumnIndex(n)),i&&$(i).addClass(a[n]))}}function addCellCssStyles(e,t){if(cellCssClasses[e])throw"addCellCssStyles: cell CSS hash with key '"+e+"' already exists.";cellCssClasses[e]=t,updateCellCssStylesOnRenderedRows(t,null),trigger(self.onCellCssStylesChanged,{key:e,hash:t})}function removeCellCssStyles(e){cellCssClasses[e]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[e]),delete cellCssClasses[e],trigger(self.onCellCssStylesChanged,{key:e,hash:null}))}function setCellCssStyles(e,t){var i=cellCssClasses[e];cellCssClasses[e]=t,updateCellCssStylesOnRenderedRows(t,i),trigger(self.onCellCssStylesChanged,{key:e,hash:t})}function getCellCssStyles(e){return cellCssClasses[e]}function flashCell(e,t,i){function n(e){e&&setTimeout(function(){a.queue(function(){a.toggleClass(options.cellFlashingCssClass).dequeue(),n(e-1)})},i)}if(i=i||100,rowsCache[e]){var a=$(getCellNode(e,t));n(4)}}function handleDragInit(e,t){var i=getCellFromEvent(e);if(!i||!cellExists(i.row,i.cell))return!1;var n=trigger(self.onDragInit,t,e);return e.isImmediatePropagationStopped()?n:!1}function handleDragStart(e,t){var i=getCellFromEvent(e);if(!i||!cellExists(i.row,i.cell))return!1;var n=trigger(self.onDragStart,t,e);return e.isImmediatePropagationStopped()?n:!1}function handleDrag(e,t){return trigger(self.onDrag,t,e)}function handleDragEnd(e,t){trigger(self.onDragEnd,t,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},e);var t=e.isImmediatePropagationStopped();if(!t)if(e.shiftKey||e.altKey||e.ctrlKey)9!=e.which||!e.shiftKey||e.ctrlKey||e.altKey||(t=navigatePrev());else if(27==e.which){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else 37==e.which?t=navigateLeft():39==e.which?t=navigateRight():38==e.which?t=navigateUp():40==e.which?t=navigateDown():9==e.which?t=navigateNext():13==e.which&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable()),t=!0);if(t){e.stopPropagation(),e.preventDefault();try{e.originalEvent.keyCode=0}catch(i){}}}function handleClick(e){currentEditor||e.target!=document.activeElement&&setFocus();var t=getCellFromEvent(e);!t||null!==currentEditor&&activeRow==t.row&&activeCell==t.cell||(trigger(self.onClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped()||activeCell==t.cell&&activeRow==t.row||!canCellBeActive(t.row,t.cell)||(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit())&&(scrollRowIntoView(t.row,!1),setActiveCellInternal(getCellNode(t.row,t.cell),t.row===getDataLength()||options.autoEdit)))}function handleContextMenu(e){var t=$(e.target).closest(".slick-cell",$canvas);0!==t.length&&(activeCellNode!==t[0]||null===currentEditor)&&trigger(self.onContextMenu,{},e)}function handleDblClick(e){var t=getCellFromEvent(e);!t||null!==currentEditor&&activeRow==t.row&&activeCell==t.cell||(trigger(self.onDblClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped()||options.editable&&gotoCell(t.row,t.cell,!0))}function handleHeaderMouseEnter(e){trigger(self.onHeaderMouseEnter,{column:$(this).data("column")},e)}function handleHeaderMouseLeave(e){trigger(self.onHeaderMouseLeave,{column:$(this).data("column")},e)}function handleHeaderContextMenu(e){var t=$(e.target).closest(".slick-header-column",".slick-header-columns"),i=t&&t.data("column");trigger(self.onHeaderContextMenu,{column:i},e)}function handleHeaderClick(e){var t=$(e.target).closest(".slick-header-column",".slick-header-columns"),i=t&&t.data("column");i&&trigger(self.onHeaderClick,{column:i},e)}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(e,t){return!(0>e||e>=getDataLength()||0>t||t>=columns.length)}function getCellFromPoint(e,t){for(var i=getRowFromPosition(t),n=0,a=0,r=0;r<columns.length&&e>a;r++)a+=columns[r].width,n++;return 0>n&&(n=0),{row:i,cell:n-1}}function getCellFromNode(e){var t=/l\d+/.exec(e.className);if(!t)throw"getCellFromNode: cannot get cell - "+e.className;return parseInt(t[0].substr(1,t[0].length-1),10)}function getRowFromNode(e){for(var t in rowsCache)if(rowsCache[t].rowNode===e)return 0|t;return null}function getCellFromEvent(e){var t=$(e.target).closest(".slick-cell",$canvas);if(!t.length)return null;var i=getRowFromNode(t[0].parentNode),n=getCellFromNode(t[0]);return null==i||null==n?null:{row:i,cell:n}}function getCellNodeBox(e,t){if(!cellExists(e,t))return null;for(var i=getRowTop(e),n=i+options.rowHeight-1,a=0,r=0;t>r;r++)a+=columns[r].width;var s=a+columns[t].width;return{top:i,left:a,bottom:n,right:s}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){-1==tabbingDirection?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(e,t,i){scrollRowIntoView(e,i);var n=getColspan(e,t),a=columnPosLeft[t],r=columnPosRight[t+(n>1?n-1:0)],s=scrollLeft+viewportW;scrollLeft>a?($viewport.scrollLeft(a),handleScroll(),render()):r>s&&($viewport.scrollLeft(Math.min(a,r-$viewport[0].clientWidth)),handleScroll(),render())}function setActiveCellInternal(e,t){null!==activeCellNode&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active"));var i=activeCellNode!==e;activeCellNode=e,null!=activeCellNode?(activeRow=getRowFromNode(activeCellNode.parentNode),activeCell=activePosX=getCellFromNode(activeCellNode),$(activeCellNode).addClass("active"),$(rowsCache[activeRow].rowNode).addClass("active"),options.editable&&t&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay):makeActiveCellEditable())):activeRow=activeCell=null,i&&trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}}function isCellPotentiallyEditable(e,t){return e<getDataLength()&&!getDataItem(e)?!1:columns[t].cannotTriggerInsert&&e>=getDataLength()?!1:getEditor(e,t)?!0:!1}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor}),currentEditor.destroy(),currentEditor=null,activeCellNode){var e=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),e){var t=columns[activeCell],i=getFormatter(activeRow,t);activeCellNode.innerHTML=i(activeRow,activeCell,getDataItemValueForColumn(e,t),t,getDataItem(activeRow)),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(e){if(activeCellNode){if(!options.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";if(clearTimeout(h_editorLoader),isCellPotentiallyEditable(activeRow,activeCell)){var t=columns[activeCell],i=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:i,column:t})===!1)return void setFocus();getEditorLock().activate(editController),$(activeCellNode).addClass("editable"),e||(activeCellNode.innerHTML=""),currentEditor=new(e||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:t,item:i||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),i&&currentEditor.loadValue(i),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(e){var t={top:e.offsetTop,left:e.offsetLeft,bottom:0,right:0,width:$(e).outerWidth(),height:$(e).outerHeight(),visible:!0};t.bottom=t.top+t.height,t.right=t.left+t.width;for(var i=e.offsetParent;(e=e.parentNode)!=document.body;)t.visible&&e.scrollHeight!=e.offsetHeight&&"visible"!=$(e).css("overflowY")&&(t.visible=t.bottom>e.scrollTop&&t.top<e.scrollTop+e.clientHeight),t.visible&&e.scrollWidth!=e.offsetWidth&&"visible"!=$(e).css("overflowX")&&(t.visible=t.right>e.scrollLeft&&t.left<e.scrollLeft+e.clientWidth),t.left-=e.scrollLeft,t.top-=e.scrollTop,e===i&&(t.left+=e.offsetLeft,t.top+=e.offsetTop,i=e.offsetParent),t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{}),currentEditor)){var e=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(e.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(e)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(e,t){var i=e*options.rowHeight,n=(e+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);(e+1)*options.rowHeight>scrollTop+viewportH+offset?(scrollTo(t?i:n),render()):e*options.rowHeight<scrollTop+offset&&(scrollTo(t?n:i),render())}function scrollRowToTop(e){scrollTo(e*options.rowHeight),render()}function getColspan(e,t){var i=data.getItemMetadata&&data.getItemMetadata(e);if(!i||!i.columns)return 1;var n=i.columns[columns[t].id]||i.columns[t],a=n&&n.colspan;return a="*"===a?columns.length-t:a||1}function findFirstFocusableCell(e){for(var t=0;t<columns.length;){if(canCellBeActive(e,t))return t;t+=getColspan(e,t)}return null}function findLastFocusableCell(e){for(var t=0,i=null;t<columns.length;)canCellBeActive(e,t)&&(i=t),t+=getColspan(e,t);return i}function gotoRight(e,t){if(t>=columns.length)return null;do t+=getColspan(e,t);while(t<columns.length&&!canCellBeActive(e,t));return t<columns.length?{row:e,cell:t,posX:t}:null}function gotoLeft(e,t){if(0>=t)return null;var i=findFirstFocusableCell(e);if(null===i||i>=t)return null;for(var n,a={row:e,cell:i,posX:i};;){if(n=gotoRight(a.row,a.cell,a.posX),!n)return null;if(n.cell>=t)return a;a=n}}function gotoDown(e,t,i){for(var n;;){if(++e>=getDataLength()+(options.enableAddRow?1:0))return null;for(n=t=0;i>=t;)n=t,t+=getColspan(e,t);if(canCellBeActive(e,n))return{row:e,cell:n,posX:i}}}function gotoUp(e,t,i){for(var n;;){if(--e<0)return null;for(n=t=0;i>=t;)n=t,t+=getColspan(e,t);if(canCellBeActive(e,n))return{row:e,cell:n,posX:i}}}function gotoNext(e,t,i){if(null==e&&null==t&&(e=t=i=0,canCellBeActive(e,t)))return{row:e,cell:t,posX:t};var n=gotoRight(e,t,i);if(n)return n;for(var a=null;++e<getDataLength()+(options.enableAddRow?1:0);)if(a=findFirstFocusableCell(e),null!==a)return{row:e,cell:a,posX:a};return null}function gotoPrev(e,t,i){if(null==e&&null==t&&(e=getDataLength()+(options.enableAddRow?1:0)-1,t=i=columns.length-1,canCellBeActive(e,t)))return{row:e,cell:t,posX:t};for(var n,a;!n&&!(n=gotoLeft(e,t,i));){if(--e<0)return null;t=0,a=findLastFocusableCell(e),null!==a&&(n={row:e,cell:a,posX:a})}return n}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(e){if(!options.enableCellNavigation)return!1;if(!activeCellNode&&"prev"!=e&&"next"!=e)return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();var t={up:-1,down:1,left:-1,right:1,prev:-1,next:1};tabbingDirection=t[e];var i={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext},n=i[e],a=n(activeRow,activeCell,activePosX);if(a){var r=a.row==getDataLength();return scrollCellIntoView(a.row,a.cell,!r),setActiveCellInternal(getCellNode(a.row,a.cell),r||options.autoEdit),activePosX=a.posX,!0}return setActiveCellInternal(getCellNode(activeRow,activeCell),activeRow==getDataLength()||options.autoEdit),!1}function getCellNode(e,t){return rowsCache[e]?(ensureCellNodesInRowsCache(e),rowsCache[e].cellNodesByColumnIdx[t]):null}function setActiveCell(e,t){initialized&&(e>getDataLength()||0>e||t>=columns.length||0>t||options.enableCellNavigation&&(scrollCellIntoView(e,t,!1),setActiveCellInternal(getCellNode(e,t),!1)))}function canCellBeActive(e,t){if(!options.enableCellNavigation||e>=getDataLength()+(options.enableAddRow?1:0)||0>e||t>=columns.length||0>t)return!1;var i=data.getItemMetadata&&data.getItemMetadata(e);if(i&&"boolean"==typeof i.focusable)return i.focusable;var n=i&&i.columns;return n&&n[columns[t].id]&&"boolean"==typeof n[columns[t].id].focusable?n[columns[t].id].focusable:n&&n[t]&&"boolean"==typeof n[t].focusable?n[t].focusable:columns[t].focusable}function canCellBeSelected(e,t){if(e>=getDataLength()||0>e||t>=columns.length||0>t)return!1;var i=data.getItemMetadata&&data.getItemMetadata(e);if(i&&"boolean"==typeof i.selectable)return i.selectable;var n=i&&i.columns&&(i.columns[columns[t].id]||i.columns[t]);return n&&"boolean"==typeof n.selectable?n.selectable:columns[t].selectable}function gotoCell(e,t,i){if(initialized&&canCellBeActive(e,t)&&getEditorLock().commitCurrentEdit()){scrollCellIntoView(e,t,!1);var n=getCellNode(e,t);setActiveCellInternal(n,i||e===getDataLength()||options.autoEdit),currentEditor||setFocus()}}function commitCurrentEdit(){var e=getDataItem(activeRow),t=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var i=currentEditor.validate();if(i.valid){if(activeRow<getDataLength()){var n={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(e,this.serializedValue),updateRow(this.row)},undo:function(){this.editor.applyValue(e,this.prevSerializedValue),updateRow(this.row)}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(e,t,n)):(n.execute(),makeActiveCellNormal()),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:e})}else{var a={};currentEditor.applyValue(a,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:a,column:t})}return!getEditorLock().isActive()}return $(activeCellNode).addClass("invalid"),$(activeCellNode).stop(!0,!0).effect("highlight",{color:"red"},300),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:i,row:activeRow,cell:activeCell,column:t}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(e){for(var t=[],i=columns.length-1,n=0;n<e.length;n++)t.push(new Slick.Range(e[n],0,e[n],i));return t}function getSelectedRows(){if(!selectionModel)throw"Selection model is not set";return selectedRows}function setSelectedRows(e){if(!selectionModel)throw"Selection model is not set";selectionModel.setSelectedRanges(rowsToRanges(e))}var defaults={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:defaultFormatter,forceSyncScrolling:!1},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2,$headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacer,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,absoluteColumnMinWidth,numberOfRows=0,tabbingDirection=1,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],h_editorLoader=null,h_render=null,h_postrender=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,counter_rows_rendered=0,counter_rows_removed=0;this.debug=function(){var e="";e+="\ncounter_rows_rendered:  "+counter_rows_rendered,e+="\ncounter_rows_removed:  "+counter_rows_removed,e+="\nrenderedRows:  "+renderedRows,e+="\nnumVisibleRows:  "+numVisibleRows,e+="\nmaxSupportedCssHeight:  "+maxSupportedCssHeight,e+="\nn(umber of pages):  "+n,e+="\n(current) page:  "+page,e+="\npage height (ph):  "+ph,e+="\nvScrollDir:  "+vScrollDir,alert(e)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController}),init()}$.extend(!0,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions,maxSupportedCssHeight}(jQuery),define("libraries/slickgrid/slick.grid",function(){}),function(e){function t(t){function i(e,i,n,a,r){if(!t.enableExpandCollapse)return r.title;var s=15*r.level+"px";return"<span class='"+t.toggleCssClass+" "+(r.collapsed?t.toggleCollapsedCssClass:t.toggleExpandedCssClass)+"' style='margin-left:"+s+"'></span><span class='"+t.groupTitleCssClass+"' level='"+r.level+"'>"+r.title+"</span>"}function n(e,t,i,n,a){return n.groupTotalsFormatter&&n.groupTotalsFormatter(a,n)||""}function a(e){c=e,c.onClick.subscribe(s),c.onKeyDown.subscribe(o)}function r(){c&&(c.onClick.unsubscribe(s),c.onKeyDown.unsubscribe(o))}function s(i,n){var a=this.getDataItem(n.row);a&&a instanceof Slick.Group&&e(i.target).hasClass(t.toggleCssClass)&&(a.collapsed?this.getData().expandGroup(a.groupingKey):this.getData().collapseGroup(a.groupingKey),i.stopImmediatePropagation(),i.preventDefault())}function o(i){if(t.enableExpandCollapse&&i.which==e.ui.keyCode.SPACE){var n=this.getActiveCell();if(n){var a=this.getDataItem(n.row);a&&a instanceof Slick.Group&&(a.collapsed?this.getData().expandGroup(a.groupingKey):this.getData().collapseGroup(a.groupingKey),i.stopImmediatePropagation(),i.preventDefault())}}}function l(){return{selectable:!1,focusable:t.groupFocusable,cssClasses:t.groupCssClass,columns:{0:{colspan:"*",formatter:i,editor:null}}}
}function u(){return{selectable:!1,focusable:t.totalsFocusable,cssClasses:t.totalsCssClass,formatter:n,editor:null}}var c,d={groupCssClass:"slick-group",groupTitleCssClass:"slick-group-title",totalsCssClass:"slick-group-totals",groupFocusable:!0,totalsFocusable:!1,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:!0};return t=e.extend(!0,{},d,t),{init:a,destroy:r,getGroupRowMetadata:l,getTotalsRowMetadata:u}}e.extend(!0,window,{Slick:{Data:{GroupItemMetadataProvider:t}}})}(jQuery),define("libraries/slickgrid/slick.groupitemmetadataprovider",function(){}),function(e){function t(t){function i(){bt=!0}function n(){bt=!1,tt()}function a(e){_t=e}function r(e){ot=e}function s(e){e=e||0;for(var t,i=e,n=pt.length;n>i;i++){if(t=pt[i][ht],void 0===t)throw"Each data element must implement a unique 'id' property";mt[t]=i}}function o(){for(var e,t=0,i=pt.length;i>t;t++)if(e=pt[t][ht],void 0===e||mt[e]!==t)throw"Each data element must implement a unique 'id' property"}function l(){return pt}function u(e,t){void 0!==t&&(ht=t),pt=Lt=e,mt={},s(),o(),tt()}function c(e){void 0!=e.pageSize&&(Nt=e.pageSize,Et=Nt?Math.min(Et,Math.max(0,Math.ceil(zt/Nt)-1)):0),void 0!=e.pageNum&&(Et=Math.min(e.pageNum,Math.max(0,Math.ceil(zt/Nt)-1))),Rt.notify(d(),null,ct),tt()}function d(){var e=Nt?Math.max(1,Math.ceil(zt/Nt)):1;return{pageSize:Nt,pageNum:Et,totalRows:zt,totalPages:e}}function h(e,t){kt=t,st=e,rt=null,t===!1&&pt.reverse(),pt.sort(e),t===!1&&pt.reverse(),mt={},s(),tt()}function p(e,t){kt=t,rt=e,st=null;var i=Object.prototype.toString;Object.prototype.toString="function"==typeof e?e:function(){return this[e]},t===!1&&pt.reverse(),pt.sort(),Object.prototype.toString=i,t===!1&&pt.reverse(),mt={},s(),tt()}function f(){st?h(st,kt):rt&&p(rt,kt)}function m(e){vt=e,t.inlineFilters&&(lt=K(),ut=X()),tt()}function g(){return Ot}function v(i){t.groupItemMetadataProvider||(t.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider),Tt=[],Ct=[],i=i||[],Ot=i instanceof Array?i:[i];for(var n=0;n<Ot.length;n++){var a=Ot[n]=e.extend(!0,{},St,Ot[n]);a.getterIsAFn="function"==typeof a.getter,a.compiledAccumulators=[];for(var r=a.aggregators.length;r--;)a.compiledAccumulators[r]=Q(a.aggregators[r]);Ct[n]={}}tt()}function y(e,t,i){return null==e?void v([]):void v({getter:e,formatter:t,comparer:i})}function b(e,t){if(!Ot.length)throw new Error("At least one grouping must be specified before calling setAggregators().");Ot[0].aggregators=e,Ot[0].aggregateCollapsed=t,v(Ot)}function k(e){return pt[e]}function _(e){return mt[e]}function w(){if(!gt){gt={};for(var e=0,t=ft.length;t>e;e++)gt[ft[e][ht]]=e}}function L(e){return w(),gt[e]}function x(e){return pt[mt[e]]}function S(e){var t=[];w();for(var i=0;i<e.length;i++){var n=gt[e[i]];null!=n&&(t[t.length]=n)}return t}function O(e){for(var t=[],i=0;i<e.length;i++)e[i]<ft.length&&(t[t.length]=ft[e[i]][ht]);return t}function T(e,t){if(void 0===mt[e]||e!==t[ht])throw"Invalid or non-matching id";pt[mt[e]]=t,yt||(yt={}),yt[e]=!0,tt()}function C(e,t){pt.splice(e,0,t),s(e),tt()}function M(e){pt.push(e),s(pt.length-1),tt()}function N(e){var t=mt[e];if(void 0===t)throw"Invalid id";delete mt[e],pt.splice(t,1),s(t),tt()}function E(){return ft.length}function z(e){return ft[e]}function P(e){var i=ft[e];return void 0===i?null:i.__group?t.groupItemMetadataProvider.getGroupRowMetadata(i):i.__groupTotals?t.groupItemMetadataProvider.getTotalsRowMetadata(i):null}function A(e,t){if(null==e)for(var i=0;i<Ot.length;i++)Ct[i]={},Ot[i].collapsed=t;else Ct[e]={},Ot[e].collapsed=t;tt()}function R(e){A(e,!0)}function I(e){A(e,!1)}function D(e,t,i){Ct[e][t]=Ot[e].collapsed^i,tt()}function j(){var e=Array.prototype.slice.call(arguments),t=e[0];1==e.length&&-1!=t.indexOf(Mt)?D(t.split(Mt).length-1,t,!0):D(e.length-1,e.join(Mt),!0)}function F(){var e=Array.prototype.slice.call(arguments),t=e[0];1==e.length&&-1!=t.indexOf(Mt)?D(t.split(Mt).length-1,t,!1):D(e.length-1,e.join(Mt),!1)}function q(){return Tt}function B(e,t){for(var i,n,a,r=[],s=[],o=t?t.level+1:0,l=Ot[o],u=0,c=l.predefinedValues.length;c>u;u++)n=l.predefinedValues[u],i=s[n],i||(i=new Slick.Group,i.value=n,i.level=o,i.groupingKey=(t?t.groupingKey+Mt:"")+n,r[r.length]=i,s[n]=i);for(var u=0,c=e.length;c>u;u++)a=e[u],n=l.getterIsAFn?l.getter(a):a[l.getter],i=s[n],i||(i=new Slick.Group,i.value=n,i.level=o,i.groupingKey=(t?t.groupingKey+Mt:"")+n,r[r.length]=i,s[n]=i),i.rows[i.count++]=a;if(o<Ot.length-1)for(var u=0;u<r.length;u++)i=r[u],i.groups=B(i.rows,i);return r.sort(Ot[o].comparer),r}function H(e){for(var t,i=Ot[e.level],n=e.level==Ot.length,a=new Slick.GroupTotals,r=i.aggregators.length;r--;)t=i.aggregators[r],t.init(),i.compiledAccumulators[r].call(t,!n&&i.aggregateChildGroups?e.groups:e.rows),t.storeResult(a);a.group=e,e.totals=a}function U(e,t){t=t||0;for(var i,n=Ot[t],a=e.length;a--;)i=e[a],(!i.collapsed||n.aggregateCollapsed)&&(i.groups&&U(i.groups,t+1),n.aggregators.length&&(n.aggregateEmpty||i.rows.length||i.groups&&i.groups.length)&&H(i))}function G(e,t){t=t||0;for(var i,n=Ot[t],a=n.collapsed,r=Ct[t],s=e.length;s--;)i=e[s],i.collapsed=a^r[i.groupingKey],i.title=n.formatter?n.formatter(i):i.value,i.groups&&(G(i.groups,t+1),i.rows=[])}function V(e,t){t=t||0;for(var i,n,a=Ot[t],r=[],s=0,o=0,l=e.length;l>o;o++){if(n=e[o],r[s++]=n,!n.collapsed){i=n.groups?V(n.groups,t+1):n.rows;for(var u=0,c=i.length;c>u;u++)r[s++]=i[u]}n.totals&&a.displayTotalsRow&&(!n.collapsed||a.aggregateCollapsed)&&(r[s++]=n.totals)}return r}function W(e){var t=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/,i=e.toString().match(t);return{params:i[1].split(","),body:i[2]}}function Q(e){var t=W(e.accumulate),i=new Function("_items","for (var "+t.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+t.params[0]+" = _items[_i]; "+t.body+"}");return i.displayName=i.name="compiledAccumulatorLoop",i}function K(){var e=W(vt),t=e.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }"),i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,t),i=i.replace(/\$item\$/gi,e.params[0]),i=i.replace(/\$args\$/gi,e.params[1]);var n=new Function("_items,_args",i);return n.displayName=n.name="compiledFilter",n}function X(){var e=W(vt),t=e.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }"),i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,t),i=i.replace(/\$item\$/gi,e.params[0]),i=i.replace(/\$args\$/gi,e.params[1]);var n=new Function("_items,_args,_cache",i);return n.displayName=n.name="compiledFilterWithCaching",n}function $(e,t){for(var i=[],n=0,a=0,r=e.length;r>a;a++)vt(e[a],t)&&(i[n++]=e[a]);return i}function Y(e,t,i){for(var n,a=[],r=0,s=0,o=e.length;o>s;s++)n=e[s],i[s]?a[r++]=n:vt(n,t)&&(a[r++]=n,i[s]=!0);return a}function Z(e){if(vt){var i=t.inlineFilters?lt:$,n=t.inlineFilters?ut:Y;_t.isFilterNarrowing?Lt=i(Lt,ot):_t.isFilterExpanding?Lt=n(e,ot,xt):_t.isFilterUnchanged||(Lt=i(e,ot))}else Lt=Nt?e:e.concat();var a;return Nt?(Lt.length<Et*Nt&&(Et=Math.floor(Lt.length/Nt)),a=Lt.slice(Nt*Et,Nt*Et+Nt)):a=Lt,{totalRows:Lt.length,rows:a}}function J(e,t){var i,n,a,r=[],s=0,o=t.length;_t&&_t.ignoreDiffsBefore&&(s=Math.max(0,Math.min(t.length,_t.ignoreDiffsBefore))),_t&&_t.ignoreDiffsAfter&&(o=Math.min(t.length,Math.max(0,_t.ignoreDiffsAfter)));for(var l=s,u=e.length;o>l;l++)l>=u?r[r.length]=l:(i=t[l],n=e[l],(Ot.length&&(a=i.__nonDataRow||n.__nonDataRow)&&i.__group!==n.__group||i.__group&&!i.equals(n)||a&&(i.__groupTotals||n.__groupTotals)||i[ht]!=n[ht]||yt&&yt[i[ht]])&&(r[r.length]=l));return r}function et(e){gt=null,(_t.isFilterNarrowing!=wt.isFilterNarrowing||_t.isFilterExpanding!=wt.isFilterExpanding)&&(xt=[]);var t=Z(e);zt=t.totalRows;var i=t.rows;Tt=[],Ot.length&&(Tt=B(i),Tt.length&&(U(Tt),G(Tt),i=V(Tt)));var n=J(ft,i);return ft=i,n}function tt(){if(!bt){var t=ft.length,i=zt,n=et(pt,vt);if(Nt&&Et*Nt>zt&&(Et=Math.max(0,Math.ceil(zt/Nt)-1),n=et(pt,vt)),yt=null,wt=_t,_t={},i!=zt&&Rt.notify(d(),null,ct),t!=ft.length&&Pt.notify({previous:t,current:ft.length},null,ct),n.length>0&&At.notify({rows:n},null,ct),ct.totalsCallback){var a=e.extend(!0,{},Tt);ct.totalsCallback(a)}}}function it(e){ct.totalsCallback=e}function nt(e,t){function i(){if(r.length>0){n=!0;var i=a.mapIdsToRows(r);t||(r=a.mapRowsToIds(i)),e.setSelectedRows(i),n=!1}}var n,a=this,r=a.mapRowsToIds(e.getSelectedRows());e.onSelectedRowsChanged.subscribe(function(){n||(r=a.mapRowsToIds(e.getSelectedRows()))}),this.onRowsChanged.subscribe(i),this.onRowCountChanged.subscribe(i)}function at(e,t){function i(e){a={};for(var t in e){var i=ft[t][ht];a[i]=e[t]}}function n(){if(a){r=!0,w();var i={};for(var n in a){var s=gt[n];void 0!=s&&(i[s]=a[n])}e.setCellCssStyles(t,i),r=!1}}var a,r;i(e.getCellCssStyles(t)),e.onCellCssStylesChanged.subscribe(function(e,n){r||t==n.key&&i(n.hash)}),this.onRowsChanged.subscribe(n),this.onRowCountChanged.subscribe(n)}var rt,st,ot,lt,ut,ct=this,dt={groupItemMetadataProvider:null,inlineFilters:!1},ht="id",pt=[],ft=[],mt={},gt=null,vt=null,yt=null,bt=!1,kt=!0,_t={},wt={},Lt=[],xt=[],St={getter:null,formatter:null,comparer:function(e,t){return e.value-t.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0},Ot=[],Tt=[],Ct=[],Mt=":|:",Nt=0,Et=0,zt=0,Pt=new Slick.Event,At=new Slick.Event,Rt=new Slick.Event;return t=e.extend(!0,{},dt,t),{beginUpdate:i,endUpdate:n,setPagingOptions:c,getPagingInfo:d,getItems:l,setItems:u,setFilter:m,sort:h,fastSort:p,reSort:f,setGrouping:v,getGrouping:g,groupBy:y,setAggregators:b,collapseAllGroups:R,expandAllGroups:I,collapseGroup:j,expandGroup:F,getGroups:q,getIdxById:_,getRowById:L,getItemById:x,getItemByIdx:k,mapRowsToIds:O,mapIdsToRows:S,setRefreshHints:a,setFilterArgs:r,refresh:tt,updateItem:T,insertItem:C,addItem:M,deleteItem:N,syncGridSelection:nt,syncGridCellCssStyles:at,setTotalsCallback:it,getLength:E,getItem:z,getItemMetadata:P,onRowCountChanged:Pt,onRowsChanged:At,onPagingInfoChanged:Rt}}function i(e){this.field_=e,this.init=function(){this.count_=0,this.nonNullCount_=0,this.sum_=0},this.accumulate=function(e){var t=e[this.field_];this.count_++,null!=t&&""!==t&&0/0!==t&&(this.nonNullCount_++,this.sum_+=parseFloat(t))},this.storeResult=function(e){e.avg||(e.avg={}),0!=this.nonNullCount_&&(e.avg[this.field_]=this.sum_/this.nonNullCount_)}}function n(e){this.field_=e,this.init=function(){this.min_=null},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(null==this.min_||t<this.min_)&&(this.min_=t)},this.storeResult=function(e){e.min||(e.min={}),e.min[this.field_]=this.min_}}function a(e){this.field_=e,this.init=function(){this.max_=null},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(null==this.max_||t>this.max_)&&(this.max_=t)},this.storeResult=function(e){e.max||(e.max={}),e.max[this.field_]=this.max_}}function r(e){this.field_=e,this.init=function(){this.sum_=null},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(this.sum_+=parseFloat(t))},this.storeResult=function(e){e.sum||(e.sum={}),e.sum[this.field_]=this.sum_}}function s(e){this.field_=e,this.init=function(){this.pairs_=[]},this.accumulate=function(e){var t=e[this.field_],i=!1;if(null!=t&&""!==t&&0/0!==t){for(var n=0;n<this.pairs_.length;n++)if(this.pairs_[n].value==t){this.pairs_[n].count++,i=!0;break}i||this.pairs_.push({value:t,count:1})}},this.storeResult=function(e){e.mde||(e.mde={});for(var t=0,i=0;i<this.pairs_.length;i++)(this.pairs_[i].count>this.pairs_[t].count||this.pairs_[i].count===this.pairs_[t].count&&this.pairs_[i].value<this.pairs_[t].value)&&(t=i);"undefined"!=typeof this.pairs_[t]&&(e.mde[this.field_]=this.pairs_[t].value)}}function o(e){this.field_=e,this.init=function(){this.sorted_=[]},this.accumulate=function(e){var t=e[this.field_],i=!1;if(null!=t&&""!==t&&0/0!==t){for(var n=0;n<this.sorted_.length;n++)if(t<this.sorted_[n]){this.sorted_.splice(n,0,t),i=!0;break}i||this.sorted_.push(t)}},this.storeResult=function(e){e.mdn||(e.mdn={});var t=this.sorted_.length;if(t%2==1)e.mdn[this.field_]=this.sorted_[(t-1)/2];else{var i=t/2;e.mdn[this.field_]=.5*(this.sorted_[i]+this.sorted_[i-1])}}}function l(e){this.field_=e,this.init=function(){this.nonNullCount_=0,this.Mk_=null,this.Qk_=0},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(this.nonNullCount_++,null!=this.Mk_?(this.Qk_=this.Qk_+(this.nonNullCount_-1)*Math.pow(t-this.Mk_,2)/this.nonNullCount_,this.Mk_=this.Mk_+(t-this.Mk_)/this.nonNullCount_):this.Mk_=t)},this.storeResult=function(e){e.std||(e.std={}),0!=this.nonNullCount_&&(e.std[this.field_]=Math.sqrt(this.Qk_/this.nonNullCount_))}}e.extend(!0,window,{Slick:{Data:{DataView:t,Aggregators:{Avg:i,Mde:s,Mdn:o,Min:n,Max:a,Sum:r,Std:l}}}})}(jQuery),define("libraries/slickgrid/slick.dataview",function(){}),function(e){function t(t,i,n){function a(){t.onPagingInfoChanged.subscribe(function(e,t){h(t)}),d(),h(t.getPagingInfo())}function r(){var e=!Slick.GlobalEditorLock.commitCurrentEdit(),i=t.getPagingInfo(),n=i.totalPages-1;return{canGotoFirst:!e&&0!=i.pageSize&&i.pageNum>0,canGotoLast:!e&&0!=i.pageSize&&i.pageNum!=n,canGotoPrev:!e&&0!=i.pageSize&&i.pageNum>0,canGotoNext:!e&&0!=i.pageSize&&i.pageNum<n,pagingInfo:i}}function s(e){t.setRefreshHints({isFilterUnchanged:!0}),t.setPagingOptions({pageSize:e})}function o(){r().canGotoFirst&&t.setPagingOptions({pageNum:0})}function l(){var e=r();e.canGotoLast&&t.setPagingOptions({pageNum:e.pagingInfo.totalPages-1})}function u(){var e=r();e.canGotoPrev&&t.setPagingOptions({pageNum:e.pagingInfo.pageNum-1})}function c(){var e=r();e.canGotoNext&&t.setPagingOptions({pageNum:e.pagingInfo.pageNum+1})}function d(){n.empty();var t=e("<span class='slick-pager-nav' />").appendTo(n),a=e("<span class='slick-pager-settings' />").appendTo(n);p=e("<span class='slick-pager-status' />").appendTo(n),a.append("<span class='slick-pager-settings-expanded' style='display:none'>Show: <a data=0>All</a><a data='-1'>Auto</a><a data=25>25</a><a data=50>50</a><a data=100>100</a></span>"),a.find("a[data]").click(function(t){var n=e(t.target).attr("data");if(void 0!=n)if(-1==n){var a=i.getViewport();s(a.bottom-a.top)}else s(parseInt(n))});var r="<span class='ui-state-default ui-corner-all ui-icon-container'><span class='ui-icon ",d="' /></span>";e(r+"ui-icon-lightbulb"+d).click(function(){e(".slick-pager-settings-expanded").toggle()}).appendTo(a),e(r+"ui-icon-seek-first"+d).click(o).appendTo(t),e(r+"ui-icon-seek-prev"+d).click(u).appendTo(t),e(r+"ui-icon-seek-next"+d).click(c).appendTo(t),e(r+"ui-icon-seek-end"+d).click(l).appendTo(t),n.find(".ui-icon-container").hover(function(){e(this).toggleClass("ui-state-hover")}),n.children().wrapAll("<div class='slick-pager' />")}function h(e){var t=r();n.find(".slick-pager-nav span").removeClass("ui-state-disabled"),t.canGotoFirst||n.find(".ui-icon-seek-first").addClass("ui-state-disabled"),t.canGotoLast||n.find(".ui-icon-seek-end").addClass("ui-state-disabled"),t.canGotoNext||n.find(".ui-icon-seek-next").addClass("ui-state-disabled"),t.canGotoPrev||n.find(".ui-icon-seek-prev").addClass("ui-state-disabled"),p.text(0==e.pageSize?"Showing all "+e.totalRows+" rows":"Showing page "+(e.pageNum+1)+" of "+e.totalPages)}var p;a()}e.extend(!0,window,{Slick:{Controls:{Pager:t}}})}(jQuery),define("libraries/slickgrid/controls/slick.pager",function(){}),function(e){function t(t,i,n){function a(){i.onHeaderContextMenu.subscribe(r),i.onColumnsReordered.subscribe(s),n=e.extend({},d,n),u=e("<span class='slick-columnpicker' style='display:none;position:absolute;z-index:20;' />").appendTo(document.body),u.bind("mouseleave",function(){e(this).fadeOut(n.fadeSpeed)}),u.bind("click",o)}function r(a){a.preventDefault(),u.empty(),s(),c=[];for(var r,o,l=0;l<t.length;l++)r=e("<li />").appendTo(u),o=e("<input type='checkbox' />").data("column-id",t[l].id),c.push(o),null!=i.getColumnIndex(t[l].id)&&o.attr("checked","checked"),e("<label />").text(t[l].name).prepend(o).appendTo(r);e("<hr/>").appendTo(u),r=e("<li />").appendTo(u),o=e("<input type='checkbox' />").data("option","autoresize"),e("<label />").text("Force fit columns").prepend(o).appendTo(r),i.getOptions().forceFitColumns&&o.attr("checked","checked"),r=e("<li />").appendTo(u),o=e("<input type='checkbox' />").data("option","syncresize"),e("<label />").text("Synchronous resize").prepend(o).appendTo(r),i.getOptions().syncColumnCellResize&&o.attr("checked","checked"),u.css("top",a.pageY-10).css("left",a.pageX-10).fadeIn(n.fadeSpeed)}function s(){for(var e=i.getColumns().slice(0),n=new Array(t.length),a=0;a<n.length;a++)n[a]=void 0===i.getColumnIndex(t[a].id)?t[a]:e.shift();t=n}function o(n){if("autoresize"==e(n.target).data("option"))return void(n.target.checked?(i.setOptions({forceFitColumns:!0}),i.autosizeColumns()):i.setOptions({forceFitColumns:!1}));if("syncresize"==e(n.target).data("option"))return void i.setOptions(n.target.checked?{syncColumnCellResize:!0}:{syncColumnCellResize:!1});if(e(n.target).is(":checkbox")){var a=[];if(e.each(c,function(i){e(this).is(":checked")&&a.push(t[i])}),!a.length)return void e(n.target).attr("checked","checked");i.setColumns(a)}}function l(){return t}var u,c,d={fadeSpeed:250};return a(),{getAllColumns:l}}e.extend(!0,window,{Slick:{Controls:{ColumnPicker:t}}})}(jQuery),define("libraries/slickgrid/controls/slick.columnpicker",function(){}),function(){var e;e=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName.toUpperCase()?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,i,n,a,r,s;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:e.label,children:0,disabled:e.disabled}),r=e.childNodes,s=[],n=0,a=r.length;a>n;n++)i=r[n],s.push(this.add_option(i,t,e.disabled));return s},e.prototype.add_option=function(e,t,i){return"OPTION"===e.nodeName.toUpperCase()?(""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:i===!0?i:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},e}(),e.select_to_array=function(t){var i,n,a,r,s;for(n=new e,s=t.childNodes,a=0,r=s.length;r>a;a++)i=s[a],n.add_node(i);return n.parsed},this.SelectParser=e}.call(this),function(){var e,t;t=this,e=function(){function e(e,t){this.form_field=e,this.options=null!=t?t:{},this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.finish_setup()}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.search_contains=this.options.search_contains||!1,this.choices=0,this.single_backstroke_delete=this.options.single_backstroke_delete||!1,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1},e.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||"Select Some Options":this.options.placeholder_text_single||this.options.placeholder_text||"Select an Option",this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||"No results match"},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(){var e=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return e.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},e.prototype.input_blur=function(){var e=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return e.blur_test()},100))},e.prototype.result_add_option=function(e){var t,i;return e.disabled?"":(e.dom_id=this.container_id+"_o_"+e.array_index,t=e.selected&&this.is_multiple?[]:["active-result"],e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),i=""!==e.style.cssText?' style="'+e.style+'"':"",'<li id="'+e.dom_id+'" class="'+t.join(" ")+'"'+i+">"+e.html+"</li>")},e.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.result_single_selected=null,this.results_build()},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.keyup_checker=function(e){var t,i;switch(t=null!=(i=e.which)?i:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},e.prototype.generate_field_id=function(){var e;return e=this.generate_random_id(),this.form_field.id=e,e},e.prototype.generate_random_char=function(){var e,t,i;return e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=Math.floor(Math.random()*e.length),t=e.substring(i,i+1)},e}(),t.AbstractChosen=e}.call(this),function(){var e,t,i,n,a={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};n=this,e=jQuery,e.fn.extend({chosen:function(i){var n,a,r;return r=navigator.userAgent.toLowerCase(),a=/(msie) ([\w.]+)/.exec(r)||[],n={name:a[1]||"",version:a[2]||"0"},"msie"===n.name&&("6.0"===n.version||"7.0"===n.version&&7===document.documentMode)?this:this.each(function(){var n;return n=e(this),n.hasClass("chzn-done")?void 0:n.data("chosen",new t(this,i))})}}),t=function(t){function a(){return a.__super__.constructor.apply(this,arguments)}return r(a,t),a.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_value=this.form_field_jq.val(),this.is_rtl=this.form_field_jq.hasClass("chzn-rtl")},a.prototype.finish_setup=function(){return this.form_field_jq.addClass("chzn-done")},a.prototype.set_up_html=function(){var t,n,a,r,s,o;return this.container_id=this.form_field.id.length?this.form_field.id.replace(/[^\w]/g,"_"):this.generate_field_id(),this.container_id+="_chzn",t=["chzn-container"],t.push("chzn-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chzn-rtl"),this.f_width=this.form_field_jq.outerWidth(),a={id:this.container_id,"class":t.join(" "),style:"width: "+this.f_width+"px;",title:this.form_field.title},n=e("<div />",a),n.html(this.is_multiple?'<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>':'<a href="javascript:void(0)" class="chzn-single chzn-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>'),this.form_field_jq.hide().after(n),this.container=n,this.dropdown=this.container.find("div.chzn-drop").first(),r=this.container.height(),s=this.f_width-i(this.dropdown),this.dropdown.css({width:s+"px",top:r+"px"}),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chzn-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chzn-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chzn-search").first(),this.selected_item=this.container.find(".chzn-single").first(),o=s-i(this.search_container)-i(this.search_field),this.search_field.css({width:o+"px"})),this.results_build(),this.set_tab_index(),this.form_field_jq.trigger("liszt:ready",{chosen:this})},a.prototype.register_observers=function(){var e=this;return this.container.mousedown(function(t){e.container_mousedown(t)}),this.container.mouseup(function(t){e.container_mouseup(t)}),this.container.mouseenter(function(t){e.mouse_enter(t)}),this.container.mouseleave(function(t){e.mouse_leave(t)}),this.search_results.mouseup(function(t){e.search_results_mouseup(t)}),this.search_results.mouseover(function(t){e.search_results_mouseover(t)}),this.search_results.mouseout(function(t){e.search_results_mouseout(t)}),this.form_field_jq.bind("liszt:updated",function(t){e.results_update_field(t)}),this.form_field_jq.bind("liszt:activate",function(t){e.activate_field(t)}),this.form_field_jq.bind("liszt:open",function(t){e.container_mousedown(t)}),this.search_field.blur(function(t){e.input_blur(t)}),this.search_field.keyup(function(t){e.keyup_checker(t)}),this.search_field.keydown(function(t){e.keydown_checker(t)}),this.search_field.focus(function(t){e.input_focus(t)}),this.is_multiple?this.search_choices.click(function(t){e.choices_click(t)}):this.container.click(function(e){e.preventDefault()})},a.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chzn-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus",this.activate_action),this.close_field()):(this.container.removeClass("chzn-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus",this.activate_action))},a.prototype.container_mousedown=function(t){var i;return this.is_disabled?void 0:(i=null!=t?e(t.target).hasClass("search-choice-close"):!1,t&&"mousedown"===t.type&&!this.results_showing&&t.preventDefault(),this.pending_destroy_click||i?this.pending_destroy_click=!1:(this.active_field?this.is_multiple||!t||e(t.target)[0]!==this.selected_item[0]&&!e(t.target).parents("a.chzn-single").length||(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(document).click(this.click_test_action),this.results_show()),this.activate_field()))},a.prototype.container_mouseup=function(e){return"ABBR"!==e.target.nodeName||this.is_disabled?void 0:this.results_reset(e)},a.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chzn-container-active")?this.close_field():void 0},a.prototype.close_field=function(){return e(document).unbind("click",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chzn-container-active"),this.winnow_results_clear(),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},a.prototype.activate_field=function(){return this.container.addClass("chzn-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},a.prototype.test_active_click=function(t){return e(t.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()},a.prototype.results_build=function(){var e,t,i,a,r;for(this.parsing=!0,this.results_data=n.SelectParser.select_to_array(this.form_field),this.is_multiple&&this.choices>0?(this.search_choices.find("li.search-choice").remove(),this.choices=0):this.is_multiple||(this.selected_item.addClass("chzn-default").find("span").text(this.default_text),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?this.container.addClass("chzn-container-single-nosearch"):this.container.removeClass("chzn-container-single-nosearch")),e="",r=this.results_data,i=0,a=r.length;a>i;i++)t=r[i],t.group?e+=this.result_add_group(t):t.empty||(e+=this.result_add_option(t),t.selected&&this.is_multiple?this.choice_build(t):t.selected&&!this.is_multiple&&(this.selected_item.removeClass("chzn-default").find("span").text(t.text),this.allow_single_deselect&&this.single_deselect_control_build()));return this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.search_results.html(e),this.parsing=!1},a.prototype.result_add_group=function(t){return t.disabled?"":(t.dom_id=this.container_id+"_g_"+t.array_index,'<li id="'+t.dom_id+'" class="group-result">'+e("<div />").text(t.label).html()+"</li>")},a.prototype.result_do_highlight=function(e){var t,i,n,a,r;if(e.length){if(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),n=parseInt(this.search_results.css("maxHeight"),10),r=this.search_results.scrollTop(),a=n+r,i=this.result_highlight.position().top+this.search_results.scrollTop(),t=i+this.result_highlight.outerHeight(),t>=a)return this.search_results.scrollTop(t-n>0?t-n:0);if(r>i)return this.search_results.scrollTop(i)}},a.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},a.prototype.results_show=function(){var e;if(this.is_multiple){if(this.max_selected_options<=this.choices)return this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1}else this.selected_item.addClass("chzn-single-with-drop"),this.result_single_selected&&this.result_do_highlight(this.result_single_selected);return e=this.is_multiple?this.container.height():this.container.height()-1,this.form_field_jq.trigger("liszt:showing_dropdown",{chosen:this}),this.dropdown.css({top:e+"px",left:0}),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results()},a.prototype.results_hide=function(){return this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop"),this.result_clear_highlight(),this.form_field_jq.trigger("liszt:hiding_dropdown",{chosen:this}),this.dropdown.css({left:"-9000px"}),this.results_showing=!1
},a.prototype.set_tab_index=function(){var e;return this.form_field_jq.attr("tabindex")?(e=this.form_field_jq.attr("tabindex"),this.form_field_jq.attr("tabindex",-1),this.search_field.attr("tabindex",e)):void 0},a.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},a.prototype.search_results_mouseup=function(t){var i;return i=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),i.length?(this.result_highlight=i,this.result_select(t),this.search_field.focus()):void 0},a.prototype.search_results_mouseover=function(t){var i;return i=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),i?this.result_do_highlight(i):void 0},a.prototype.search_results_mouseout=function(t){return e(t.target).hasClass("active-result")?this.result_clear_highlight():void 0},a.prototype.choices_click=function(t){return t.preventDefault(),!this.active_field||e(t.target).hasClass("search-choice")||this.results_showing?void 0:this.results_show()},a.prototype.choice_build=function(t){var i,n,a,r=this;return this.is_multiple&&this.max_selected_options<=this.choices?(this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1):(i=this.container_id+"_c_"+t.array_index,this.choices+=1,n=t.disabled?'<li class="search-choice search-choice-disabled" id="'+i+'"><span>'+t.html+"</span></li>":'<li class="search-choice" id="'+i+'"><span>'+t.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+t.array_index+'"></a></li>',this.search_container.before(n),a=e("#"+i).find("a").first(),a.click(function(e){return r.choice_destroy_link_click(e)}))},a.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),this.is_disabled?t.stopPropagation:(this.pending_destroy_click=!0,this.choice_destroy(e(t.target)))},a.prototype.choice_destroy=function(e){return this.result_deselect(e.attr("rel"))?(this.choices-=1,this.show_search_field_default(),this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()):void 0},a.prototype.results_reset=function(){return this.form_field.options[0].selected=!0,this.selected_item.find("span").text(this.default_text),this.is_multiple||this.selected_item.addClass("chzn-default"),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},a.prototype.results_reset_cleanup=function(){return this.current_value=this.form_field_jq.val(),this.selected_item.find("abbr").remove()},a.prototype.result_select=function(e){var t,i,n,a;return this.result_highlight?(t=this.result_highlight,i=t.attr("id"),this.result_clear_highlight(),this.is_multiple?this.result_deactivate(t):(this.search_results.find(".result-selected").removeClass("result-selected"),this.result_single_selected=t,this.selected_item.removeClass("chzn-default")),t.addClass("result-selected"),a=i.substr(i.lastIndexOf("_")+1),n=this.results_data[a],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.is_multiple?this.choice_build(n):(this.selected_item.find("span").first().text(n.text),this.allow_single_deselect&&this.single_deselect_control_build()),(e.metaKey||e.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field_jq.val()!==this.current_value)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_value=this.form_field_jq.val(),this.search_field_scale()):void 0},a.prototype.result_activate=function(e){return e.addClass("active-result")},a.prototype.result_deactivate=function(e){return e.removeClass("active-result")},a.prototype.result_deselect=function(t){var i,n;return n=this.results_data[t],this.form_field.options[n.options_index].disabled?!1:(n.selected=!1,this.form_field.options[n.options_index].selected=!1,i=e("#"+this.container_id+"_o_"+t),i.removeClass("result-selected").addClass("active-result").show(),this.result_clear_highlight(),this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[n.options_index].value}),this.search_field_scale(),!0)},a.prototype.single_deselect_control_build=function(){return this.allow_single_deselect&&this.selected_item.find("abbr").length<1?this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'):void 0},a.prototype.winnow_results=function(){var t,i,n,a,r,s,o,l,u,c,d,h,p,f,m,g,v,y;for(this.no_results_clear(),u=0,c=this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html(),s=this.search_contains?"":"^",r=new RegExp(s+c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),p=new RegExp(c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),y=this.results_data,f=0,g=y.length;g>f;f++)if(i=y[f],!i.disabled&&!i.empty)if(i.group)e("#"+i.dom_id).css("display","none");else if(!this.is_multiple||!i.selected){if(t=!1,l=i.dom_id,o=e("#"+l),r.test(i.html))t=!0,u+=1;else if(this.enable_split_word_search&&(i.html.indexOf(" ")>=0||0===i.html.indexOf("["))&&(a=i.html.replace(/\[|\]/g,"").split(" "),a.length))for(m=0,v=a.length;v>m;m++)n=a[m],r.test(n)&&(t=!0,u+=1);t?(c.length?(d=i.html.search(p),h=i.html.substr(0,d+c.length)+"</em>"+i.html.substr(d+c.length),h=h.substr(0,d)+"<em>"+h.substr(d)):h=i.html,o.html(h),this.result_activate(o),null!=i.group_array_index&&e("#"+this.results_data[i.group_array_index].dom_id).css("display","list-item")):(this.result_highlight&&l===this.result_highlight.attr("id")&&this.result_clear_highlight(),this.result_deactivate(o))}return 1>u&&c.length?this.no_results(c):this.winnow_results_set_highlight()},a.prototype.winnow_results_clear=function(){var t,i,n,a,r;for(this.search_field.val(""),i=this.search_results.find("li"),r=[],n=0,a=i.length;a>n;n++)t=i[n],t=e(t),r.push(t.hasClass("group-result")?t.css("display","auto"):this.is_multiple&&t.hasClass("result-selected")?void 0:this.result_activate(t));return r},a.prototype.winnow_results_set_highlight=function(){var e,t;return this.result_highlight||(t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first(),null==e)?void 0:this.result_do_highlight(e)},a.prototype.no_results=function(t){var i;return i=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),i.find("span").first().html(t),this.search_results.append(i)},a.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},a.prototype.keydown_arrow=function(){var t,i;return this.result_highlight?this.results_showing&&(i=this.result_highlight.nextAll("li.active-result").first(),i&&this.result_do_highlight(i)):(t=this.search_results.find("li.active-result").first(),t&&this.result_do_highlight(e(t))),this.results_showing?void 0:this.results_show()},a.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},a.prototype.keydown_backstroke=function(){var e;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(e=this.search_container.siblings("li.search-choice").last(),e.length&&!e.hasClass("search-choice-disabled")?(this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},a.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},a.prototype.keydown_checker=function(e){var t,i;switch(t=null!=(i=e.which)?i:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:this.keydown_arrow()}},a.prototype.search_field_scale=function(){var t,i,n,a,r,s,o,l,u;if(this.is_multiple){for(n=0,o=0,r="position:absolute; left: -1000px; top: -1000px; display:none;",s=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],l=0,u=s.length;u>l;l++)a=s[l],r+=a+":"+this.search_field.css(a)+";";return i=e("<div />",{style:r}),i.text(this.search_field.val()),e("body").append(i),o=i.width()+25,i.remove(),o>this.f_width-10&&(o=this.f_width-10),this.search_field.css({width:o+"px"}),t=this.container.height(),this.dropdown.css({top:t+"px"})}},a.prototype.generate_random_id=function(){var t;for(t="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();e("#"+t).length>0;)t+=this.generate_random_char();return t},a}(AbstractChosen),n.Chosen=t,i=function(e){var t;return t=e.outerWidth()-e.width()},n.get_side_border_padding=i}.call(this),define("libraries/chosen/chosen.jquery",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("libraries/chosen/chosen.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"StatsGrid",value:{title:"Patio",desc:"",tile:{title:"Teemakartat"},view:{title:"Patio",message:"patiopoc"},tab:{title:"Indikaattorit",description:"Omat indikaattorit",grid:{name:"Otsikko",description:"Kuvaus",organization:"Tietolähde",year:"Vuosi","delete":"Poista"},deleteTitle:"Indikaattorin poistaminen",destroyIndicator:"Poista",cancelDelete:"Peruuta",confirmDelete:"Haluatko varmasti poistaa indikaattorin",newIndicator:"Uusi indikaattori",error:{title:"Virhe",indicatorsError:"Virhe indikaattorien latauksessa. Yritä myöhemmin uudelleen",indicatorError:"Virhe indikaattorin latauksessa. Yritä myöhemmin uudelleen",indicatorDeleteError:"Virhe indikaattorin poistossa. Yritä myöhemmin uudelleen"}},gender:"Sukupuoli",genders:{male:"miehet",female:"naiset",total:"yhteensä"},addColumn:"Hae aineisto",removeColumn:"Poista",indicators:"Indikaattori",cannotDisplayIndicator:"Indikaattorilla ei ole arvoja valitsemallasi aluejaolla, joten sitä ei voida näyttää taulukossa.",availableRegions:"Arvot löytyvät seuraaville aluejaoille:",year:"Vuosi",buttons:{ok:"OK",cancel:"Peruuta",filter:"Suodata"},stats:{municipality:"Kunta",code:"Koodi",errorTitle:"Virhe",regionDataError:"Kuntatietojen haussa tapahtui virhe. Yritä myöhemmin uudelleen.",regionDataXHRError:"Aineistoon ei saatu yhteyttä. Yritä myöhemmin uudelleen.",indicatorsDataError:"Indikaattorin haussa tapahtui virhe. Yritä myöhemmin uudelleen.",indicatorsDataXHRError:"Aineistoon ei saatu yhteyttä. Yritä myöhemmin uudelleen.",indicatorMetaError:"Indikaattorin metatietojen haussa tapahtu virhe. Yritä myöhemmin uudelleen.",indicatorMetaXHRError:"Aineistoon ei saatu yhteyttä. Yritä myöhemmin uudelleen.",indicatorDataError:"Indikaattorin tietojen haussa tapahtui virhe. Yritä myöhemmin uudelleen.",indicatorDataXHRError:"Aineistoon ei saatu yhteyttä. Yritä myöhemmin uudelleen.",descriptionTitle:"Indikaattorin kuvaus",sourceTitle:"Indikaattorin lähde"},classify:{classify:"Luokittelu",classifymethod:"Luokittelutapa",classes:"Luokkajako",jenks:"Luonnolliset välit",quantile:"Kvantiilit",eqinterval:"Tasavälit",manual:"Luokittelu käsin",manualPlaceholder:"Erota luvut pilkuilla.",manualRangeError:"Luokkarajojen tulee olla lukuja välillä {min} - {max}.  Anna luokkarajat uudelleen pilkulla erotettuina lukuina. Desimaalierottimena toimii piste.",nanError:"Antamasi arvo ei ole luku. Anna luokkarajat uudelleen pilkulla erotettuina lukuina. Desimaalierottimena toimii piste.",infoTitle:"Luokittelu käsin",info:'Anna luokkarajat lukuina erotettuna pilkulla toisistaan. Desimaalierottimena toimii piste. Esimerkiksi syöttämällä "0, 10.5, 24, 30.2, 57, 73.1" saat viisi luokkaa, joiden arvot ovat välillä "0-10,5", "10,5-24", "24-30,2", "30,2-57" ja "57-73,1". Indikaattorin arvoja, jotka ovat pienempiä kuin alin luokkaraja (esimerkissä 0) tai suurempia kuin ylin luokkaraja (73,1), ei näytetä kartalla. Luokkarajojen on oltava indikaattorin pienimmän ja suurimman arvon välillä.',mode:"Luokkarajojen jatkuvuus",modes:{distinct:"Jatkuva",discontinuous:"Epäjatkuva"}},colorset:{button:"Värit",flipButton:"Käännä värit",themeselection:"Luokkien värien valinta",setselection:"Jakauman tyyppi",sequential:"Kvantitatiivinen",qualitative:"Kvalitatiivinen",divergent:"Jakautuva",info2:"Valitse värit klikkaamalla hiirellä haluamaasi väriryhmää",cancel:"Poistu"},statistic:{title:"Tunnusluvut",avg:"Keskiarvo",max:"Suurin arvo",mde:"Moodi",mdn:"Mediaani",min:"Pienin arvo",std:"Keskihajonta",sum:"Summa",tooltip:{avg:"Keskiarvo indikaattorissa esiintyvistä arvoista.",max:"Suurin indikaattorissa esiintyvä arvo.",mde:"Yleisin indikaattorissa esiintyvä arvo.",mdn:"Järjestyksessä keskimmäinen arvo indikaattorissa esiintyvistä arvoista.",min:"Pienin indikaattorissa esiintyvä arvo.",std:"Indikaattorin arvojen keskimääräinen poikkeama keskiarvosta.",sum:"Indikaattorin arvojen yhteenlaskettu summa."}},baseInfoTitle:"Tunnistetiedot",dataTitle:"Aineisto",noIndicatorData:"Indikaattoria ei voi tarkastella tässä aluejaossa.",values:"arvoa",included:"Arvot",municipality:"Kunnat",selectRows:"Valitse rivit",select4Municipalities:"Valitse vähintään kaksi aluetta tarkasteluun.",showSelected:"Näytä vain valitut alueet taulukossa",not_included:"Ei valittuna",noMatch:"Indikaattoria ei löytynyt.",selectIndicator:"Valitse indikaattori",noDataSource:"Tietolähdettä ei löytynyt",selectDataSource:"Valitse tietolähde",filterTitle:"Suodata sarakkeen arvoja",indicatorFilterDesc:"Suodattamalla halutut tilastoyksiköt korostuvat taulukossa. Voit asettaa suodatuksen jokaiselle sarakkeelle erikseen.",filterIndicator:"Muuttuja:",filterCondition:"Ehto:",filterSelectCondition:"Valitse ehto",filterGT:"Suurempi kuin (>)",filterGTOE:"Suurempi tai yhtäsuuri kuin (>=)",filterE:"Yhtäsuuri kuin (=)",filterLTOE:"Pienempi tai yhtäsuuri kuin (<=)",filterLT:"Pienempi kuin (<)",filterBetween:"Arvoväli (poissulkeva)",filter:"Suodata",filterByValue:"Arvoilla",filterByRegion:"Alueilla",selectRegionCategory:"Aluejako:",regionCatPlaceholder:"Valitse aluejako",selectRegion:"Alue:",chosenRegionText:"Valitse alueita",noRegionFound:"Aluetta ei löytynyt",regionCategories:{title:"Aluejaot",ERVA:"ERVA-alueet","ELY-KESKUS":"ELY-alueet",KUNTA:"Kunta",ALUEHALLINTOVIRASTO:"Aluehallintovirasto",MAAKUNTA:"Maakunta",NUTS1:"Manner-Suomi ja Ahvenanmaa",SAIRAANHOITOPIIRI:"Sairaanhoitopiiri",SEUTUKUNTA:"Seutukunta",SUURALUE:"Suuralue"},addDataButton:"Lisää uusi",addDataTitle:"Lisää uusi indikaattori",openImportDialogTip:"Tuo arvot leikepöydältä.",openImportDataButton:"Tuo arvot",addDataMetaTitle:"Otsikko",addDataMetaTitlePH:"Indikaattorin otsikko",addDataMetaSources:"Lähde",addDataMetaSourcesPH:"Datan lähdeviittaus",addDataMetaDescription:"Kuvaus",addDataMetaDescriptionPH:"Kuvaus",addDataMetaReferenceLayer:"Aluejako",addDataMetaYear:"Vuosi",addDataMetaYearPH:"Tiedot ovat vuodelta",addDataMetaPublicity:"Julkaistavissa",municipalityHeader:"Kunnat",dataRows:"Indikaattorin arvot alueittain",municipalityPlaceHolder:"Anna arvo",formEmpty:"Tyhjennä",formCancel:"Peruuta",formSubmit:"Tallenna",cancelButton:"Peruuta",clearImportDataButton:"Tyhjennä aineistorivit",importDataButton:"Lisää",popupTitle:"Tuo arvot",importDataDescription:"Kopioi alueet (nimi tai tunnus) sekä niitä vastaavat arvot alla olevaan tekstikenttään. Erota kunta ja arvo toisistaan joko tabulaattorilla, kaksoispisteellä tai pilkulla. Kirjaa jokainen kunta omalle rivilleen.  \r\nEsimerkki 1: Alajärvi, 1234 \r\nEsimerkki 2: 009   2100",failedSubmit:"Lisää indikaattorin metatiedot:",connectionProblem:"Antamiasi tietoja ei voitu tallentaa yhteysongelmien takia.",parsedDataInfo:"Tuotuja alueita oli yhteensä",parsedDataUnrecognized:"Tunnistamattomia alueita",loginToSaveIndicator:"Tallentaaksesi oman indikaattorin sinun on kirjauduttava sisään palveluun."}}),define("bundles/statistics/bundle/statsgrid/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"StatsGrid",value:{title:"patiopoc",desc:"",tile:{title:"Tematiska kartor"},view:{title:"patiopoc",message:"patiopoc"},tab:{title:"Indikatorer",description:"Egen indikatorer",grid:{name:"Titeln",description:"Beskrivning",organization:"Upphov",year:"År","delete":"Ta bort"},deleteTitle:"NOT TRANSLATED",destroyIndicator:"Radera",cancelDelete:"Avsluta",confirmDelete:"NOT TRANSLATED",newIndicator:"Ny indikator",error:{title:"Fel",indicatorsError:"Laddning av indikatorer misslyckades. Försök igen senare.",indicatorError:"Laddning av indikatoren misslyckades. Försök igen senare.",indicatorDeleteError:"Radering av indikatoren misslyckades. Försök igen senare."}},gender:"Kön",genders:{male:"män",female:"kvinnor",total:"totalt"},addColumn:"Sök indikator",removeColumn:"Radera",indicators:"Indikator",cannotDisplayIndicator:"Indikatorn har inga värde på din utval regional indelning. Så det kan inte visas på tabellen.",availableRegions:"Värde finns till följande regionala indelningar:",year:"År",buttons:{ok:"OK",cancel:"Avbryta",filter:"Filter"},stats:{municipality:"Kommun",code:"Kod",errorTitle:"Fel",regionDataError:"Fel att få  regionen data.",regionDataXHRError:"Fel vid laddning av regionen data",indicatorsDataError:"Fel att få indikatorer.",indicatorsDataXHRError:"Fel vid laddning av indikatorer.",indicatorMetaError:"Fel att få indikator metadata",indicatorMetaXHRError:"Fel vid laddning av indikator metadata",indicatorDataError:"Fel att få indikator data",indicatorDataXHRError:"Fel vid laddning av indikator data",descriptionTitle:"Beskrivning",sourceTitle:"Upphov"},classify:{classify:"Klassificera",classifymethod:"Metod",classes:"Klasser",jenks:"Jenks intervall",quantile:"Quantile intervall",eqinterval:"Eqintervall",manual:"Manuell klassificering",manualPlaceholder:"Ange siffrorna, separerade med kommatecken.",manualRangeError:"Det bör vara minst {min} och högst {max} siffror!",nanError:"Ett värde var inte ett nummer!",infoTitle:"Manuell klassificering",info:'Ange siffrorna separerade med kommatecken. Punkt fungerar som ett decimaltecken. Först in den nedre gränsen, då gränserna klass och slutligen den övre gränsen. T.ex. genom att skriva "0, 10,5, 24, 30,2, 57, 73,1" du får fem klasser med nedre och övre gränsen satt till 0 och 73,1 och klass gränser mellan dem. Värden kvar utanför gränserna kommer att uteslutas.',mode:"Klass gränsen",modes:{distinct:"Kontinuerlig",discontinuous:"Diskontinuerlig"}},colorset:{button:"Färger",flipButton:"Vända färger",themeselection:"Välj färgtema",setselection:"Välj färgset",sequential:"Kvantitiv",qualitative:"Kvalitativ",divergent:"Divergent",info2:"Vända färger - använd muspekaren för att välja en färg från sekvensen färgskalan",cancel:"Avsluta"},statistic:{title:"Nyckeltal",avg:"Medelvärde",max:"Maximivärde",mde:"Modus",mdn:"Median",min:"Minimivärde",std:"Standardavvikelse",sum:"Summa",tooltip:{avg:"Medelvärde",max:"Det största av indikatorens värde.",mde:"Det mest allmänna av indikatorens värde.",mdn:"Det mellersta av indikatorens ordnade värde.",min:"Det minsta av indikatorens värde.",std:"En genomsnittlig avvikelse av indikatorens medelvärde.",sum:"Totalt summa av indikatorens värde."}},baseInfoTitle:"Identifierare information",dataTitle:"Datamängd",noIndicatorData:"Indikatoren kan inte visas på den här regionindelningen.",values:"värden",included:"Värden",municipality:"Kommuner",selectRows:"Markera rader",select4Municipalities:"Välj minst två områden",showSelected:"Visa endast utvalda områden på nätet",not_included:"Inte inlcuded",noMatch:"Inga matchade indikatorer",selectIndicator:"Välja en indikator",noDataSource:"Inga matchade informationskällor",selectDataSource:"Välja en informationskälla",filterTitle:"Filtrera kolumndata",indicatorFilterDesc:"Filtrerade värdena kommer att väljas i tabellen. Du kan ställa in filtrering separat för varje kolumn.",filterIndicator:"Indikator:",filterCondition:"Filter:",filterSelectCondition:"välj filter",filterGT:"Större (>)",filterGTOE:"Större än eller lika med (>=)",filterE:"Lika med (=)",filterLTOE:"Mindre än eller lika med (<=)",filterLT:"Mindre (<)",filterBetween:"Värdeintervallet (exklusivt)",filter:"Filter",filterByValue:"Med värde",filterByRegion:"Med regioner",selectRegionCategory:"Regional indelning:",regionCatPlaceholder:"Välj en regional indelning",selectRegion:"Region:",chosenRegionText:"Välj regioner",noRegionFound:"Regionen hittades inte.",regionCategories:{title:"Regionindelningar",ERVA:"Specialupptagningsområde","ELY-KESKUS":"NTM-regioner",KUNTA:"Kommuner",ALUEHALLINTOVIRASTO:"Regionförvaltningsverken",MAAKUNTA:"Landskap",NUTS1:"Fasta Finland och Åland",SAIRAANHOITOPIIRI:"Sjukvårdsdistrikter",SEUTUKUNTA:"Samkommuner",SUURALUE:"Storområden"},addDataButton:"Ladda egen",addDataTitle:"Ladda egen indikator",openImportDialogTip:"Ladda värde från urklippet",openImportDataButton:"Ladda värde",addDataMetaTitle:"Titel",addDataMetaTitlePH:"Titeln av indikator",addDataMetaSources:"Källa",addDataMetaSourcesPH:"Datakälla",addDataMetaDescription:"Beskrivning",addDataMetaDescriptionPH:"Beskrivning",addDataMetaReferenceLayer:"Regional indelning:",addDataMetaYear:"År",addDataMetaYearPH:"Information är från år",addDataMetaPublicity:"Publicerande",municipalityHeader:"Kommuner",dataRows:"Indikators värde på regioner",municipalityPlaceHolder:"Ge ett värde",formEmpty:"Töm",formCancel:"Avbryta",formSubmit:"Lagra",cancelButton:"Avbryta",clearImportDataButton:"Töm datarader",importDataButton:"Tilllägg",popupTitle:"Ladda värde",importDataDescription:"Kopiera regioner (namn eller id) och motsvarande värde till nedanstående textfältet. Skilja kommun och värde med tabulator, kolon eller prick. Skriv varje kommun på sin egen rad.  \r\nExempel 1: Alajärvi, 1234 \r\nExempel 2: 009   2100",failedSubmit:"Tilllägg metadata för indikatoren:",connectionProblem:"Data kunde inte lagras för nättförbindelseproblemens skull.",parsedDataInfo:"Laddade regioner finns totalt",parsedDataUnrecognized:"Obekanta regioner",loginToSaveIndicator:"Att lagra din egen indikator måste du logga in."}}),define("bundles/statistics/bundle/statsgrid/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"StatsGrid",value:{title:"Patio",desc:"",tile:{title:"Thematic maps"},view:{title:"Patio",message:"patiopoc"},tab:{title:"Indicators",description:"Own indicators",grid:{name:"Title",description:"Description",organization:"Data source",year:"Year","delete":"Delete"},deleteTitle:"Delete indicator",destroyIndicator:"Delete",cancelDelete:"Cancel",confirmDelete:"Are you sure you want to delete indicator",newIndicator:"New indicator",error:{title:"Error",indicatorsError:"Error occurred whilst loading the indicators. Please try again later",indicatorError:"Error occurred whilst loading an indicator. Please try again later",indicatorDeleteError:"Error occurred whilst removing an indicator. Please try again later"}},gender:"Gender",genders:{male:"men",female:"women",total:"total"},addColumn:"Get data",removeColumn:"Remove",indicators:"Indicator",cannotDisplayIndicator:"The indicator does not have values on the selected regional classification. So it cannot be displayed in the grid.",availableRegions:"Values are found for the following regional classifications:",year:"Year",buttons:{ok:"OK",cancel:"Cancel",filter:"Filter"},stats:{municipality:"Municipality",code:"Code",errorTitle:"Error",regionDataError:"The municipal data could not be found. Try again later.",regionDataXHRError:"The indicator could not be loaded. Try again later.",indicatorsDataError:"The indicator could not be found. Try again later.",indicatorsDataXHRError:"The indicator could not be loaded. Try again later.",indicatorMetaError:"Metadata for the indicator could not be found. Try again later.",indicatorMetaXHRError:"The indicator could not be loaded. Try again later.",indicatorDataError:"Data for the indicator could not be found. Try again later.",indicatorDataXHRError:"The indicator could not be loaded. Try again later.",descriptionTitle:"Description",sourceTitle:"Data source"},classify:{classify:"Classification",classifymethod:"Classification method",classes:"Classes",jenks:"Natural breaks",quantile:"Quantiles",eqinterval:"Equal intervals",manual:"Own classes",manualPlaceholder:"Input numbers separated with a comma.",manualRangeError:"The class breaks should be numbers between {min} and {max}. Input numbers separated with a comma.  Decimal are separated with a dot.",nanError:"The given value is not a number. Input class breaks again as numbers separated with a comma. Decimal are separated with a dot.",infoTitle:"Own classes",info:'Input class breaks again as numbers separated with a comma. Decimal are separated with a dot. For example by inputting ""0, 10.5, 24, 30.2, 57, 73.1" you get five classes which have values between  "0-10,5", "10,5-24", "24-30,2", "30,2-57" ja "57-73,1". The indicator\'s values smaller than the minimum value (0) or larger than the maximum value (73,1) are not shown on the map. The class breaks should be numbers between {min} and {max}.',mode:"Class breaks",modes:{distinct:"Continuous",discontinuous:"Discrete"}},colorset:{button:"Colors",flipButton:"Flip colors",themeselection:"Color theme selection",setselection:"Color set selection",sequential:"Quantitative",qualitative:"Qualitative",divergent:"Divisible",info2:"Select the colors by clicking the color group",cancel:"Cancel"},statistic:{title:"Statistical variables",avg:"Average",max:"Maximum value",mde:"Mode",mdn:"Median",min:"Minimum value",std:"Standard deviation",sum:"Sum",tooltip:{avg:"The average value of the values in the indicator.",max:"The largest value of the values in the indicator.",mde:"The most common value of the values in the indicator.",mdn:"The middle value of of the values in the indicator after sorting them by a value.",min:"The smallest value of the values in the indicator.",std:"The standard deviation of the values in the indicator.",sum:"The total sum of the values in the indicator."}},baseInfoTitle:"Identification data",dataTitle:"Indicator",noIndicatorData:"The indicator cannot be displayed in this regional classification.",values:"values",included:"Values",municipality:"Municipalities",selectRows:"Select rows",select4Municipalities:"Select at least two areas.",showSelected:"Show only selected areas on the grid.",not_included:"Not included",noMatch:"No results found.",selectIndicator:"Select an indicator.",noDataSource:"No data source found.",selectDataSource:"Select a data source.",filterTitle:"Filter the values",indicatorFilterDesc:"Selected statistical units are highlighted in the grid. You can filter every column separately.",filterIndicator:"Indicator:",filterCondition:"Condition:",filterSelectCondition:"Select condition",filterGT:"Greater than (>)",filterGTOE:"Greater than or equal to (>=)",filterE:"Equal (=)",filterLTOE:"Less than or equal to (<=)",filterLT:"Less than (<)",filterBetween:"In between (exclusive)",filter:"Filter",filterByValue:"By value",filterByRegion:"By region",selectRegionCategory:"Regional classification:",regionCatPlaceholder:"Choose a regional classification",selectRegion:"Region:",chosenRegionText:"Select the regions",noRegionFound:"The region could not be found.",regionCategories:{title:"Regional classifications",ERVA:"ERVA area (Special responsibility area)","ELY-KESKUS":"ELY centre (Centre for Economic Development, Transport and the Environment)",KUNTA:"Municipality",ALUEHALLINTOVIRASTO:"Regional State Administrative Agency",MAAKUNTA:"Region",NUTS1:"Mainland Finland and Åland",SAIRAANHOITOPIIRI:"Hospital district",SEUTUKUNTA:"Subregion",SUURALUE:"Major region"},addDataButton:"Add indicator",addDataTitle:"Add a new indicator.",openImportDialogTip:"Import data from the clipboard.",openImportDataButton:"Import data",addDataMetaTitle:"Title",addDataMetaTitlePH:"Indicator's title",addDataMetaSources:"Data source",addDataMetaSourcesPH:"Data source for the indicator",addDataMetaDescription:"Description",addDataMetaDescriptionPH:"Description",addDataMetaReferenceLayer:"Regional classification",addDataMetaYear:"Year",addDataMetaYearPH:"Data has been produced in the year",addDataMetaPublicity:"Publishable",municipalityHeader:"Municipalities",dataRows:"Indicator values by region",municipalityPlaceHolder:"Give value",formEmpty:"Clear",formCancel:"Cancel",formSubmit:"Submit",cancelButton:"Cancel",clearImportDataButton:"Clear the data rows",importDataButton:"Add",popupTitle:"Import data",importDataDescription:"Copy the regions (name or identifier) and the corresponsing values to the text area below. Input the region and its value separated with a tabulator, a colon or a comma. Input every region to the separate row.  \r\nExample 1: Alajärvi, 1234 \r\nExample 2: 009   2100",failedSubmit:"Add metadata for the indicator:",connectionProblem:"The given data could not be saved because of connection problems.",parsedDataInfo:"The total amount of the imported regions",parsedDataUnrecognized:"Unknown regions",loginToSaveIndicator:"For saving your own indicator you have to log in."}}),define("bundles/statistics/bundle/statsgrid/locale/en",function(){}),define("src/statistics/statsgrid/module",["src/oskari/oskari","jquery","bundles/statistics/bundle/statsgrid/instance","bundles/statistics/bundle/statsgrid/Tile","bundles/statistics/bundle/statsgrid/StatsView","./GridModeView","bundles/statistics/bundle/statsgrid/StatsToolbar","bundles/statistics/bundle/statsgrid/AddOwnIndicatorForm","./plugin/ManageClassificationPlugin","bundles/statistics/bundle/statsgrid/plugin/ManageStatsPlugin","bundles/statistics/bundle/statsgrid/event/StatsDataChangedEvent","bundles/statistics/bundle/statsgrid/event/ModeChangedEvent","bundles/statistics/bundle/statsgrid/event/ClearHilightsEvent","bundles/statistics/bundle/statsgrid/event/SelectHilightsModeEvent","bundles/statistics/bundle/statsgrid/event/IndicatorsEvent","bundles/statistics/bundle/statsgrid/event/UserIndicatorEvent","bundles/statistics/bundle/statsgrid/request/StatsGridRequest","bundles/statistics/bundle/statsgrid/request/StatsGridRequestHandler","bundles/statistics/bundle/statsgrid/request/TooltipContentRequest","bundles/statistics/bundle/statsgrid/request/TooltipContentRequestHandler","bundles/statistics/bundle/statsgrid/request/IndicatorsRequest","bundles/statistics/bundle/statsgrid/request/IndicatorsRequestHandler","bundles/statistics/bundle/statsgrid/request/AddDataSourceRequest","bundles/statistics/bundle/statsgrid/request/DataSourceRequestHandler","bundles/statistics/bundle/statsgrid/service/StatisticsService","bundles/statistics/bundle/statsgrid/service/UserIndicatorsService","bundles/statistics/bundle/statsgrid/UserIndicatorsTab","css!resources/statistics/bundle/statsgrid/css/style.css","css!resources/statistics/bundle/statsgrid/css/classifyplugin.css","css!libraries/slickgrid/css/slick.grid.css","css!libraries/slickgrid/css/municipality.css","css!libraries/slickgrid/css/slick-default-theme.css","libraries/jquery/jquery.event.drag-2.0.min","libraries/slickgrid/slick.core","libraries/slickgrid/slick.formatters","libraries/slickgrid/slick.editors","libraries/slickgrid/plugins/slick.cellrangedecorator","libraries/slickgrid/plugins/slick.cellrangeselector","libraries/slickgrid/plugins/slick.cellselectionmodel","libraries/slickgrid/plugins/slick.headermenu2","css!libraries/slickgrid/plugins/slick.headermenu2.css","libraries/slickgrid/plugins/slick.headerbuttons","css!libraries/slickgrid/plugins/slick.headerbuttons.css","libraries/slickgrid/plugins/slick.rowselectionmodel","libraries/slickgrid/plugins/slick.checkboxselectcolumn2","libraries/slickgrid/slick.grid","libraries/slickgrid/slick.groupitemmetadataprovider","libraries/slickgrid/slick.dataview","libraries/slickgrid/controls/slick.pager","libraries/slickgrid/controls/slick.columnpicker","libraries/chosen/chosen.jquery","css!libraries/chosen/chosen.css","bundles/statistics/bundle/statsgrid/locale/fi","bundles/statistics/bundle/statsgrid/locale/sv","bundles/statistics/bundle/statsgrid/locale/en"],function(e){return e.bundleCls("statsgrid").category({create:function(){return e.clazz.create("Oskari.statistics.bundle.statsgrid.StatsGridBundleInstance","statsgrid")
},update:function(){}})}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance",function(){this.map=null,this.core=null,this.sandbox=null,this.mapmodule=null,this.started=!1,this.plugins={},this._locale=null,this._requestHandlers={},this.loader=null,this.layerPlugin=null,this.layer=null},{__name:"catalogue.bundle.metadataflyout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocale:function(){return this._locale},getLoader:function(){return this.loader},layerSpec:{text:"",name:"Metadata",wmsName:"1",type:"vectorlayer",styles:{title:"Trains",legend:"",name:"1"},descriptionLink:"",orgName:"Metadata",inspire:"Metadata",legendImage:"",info:"",isQueryable:!0,formats:{value:"text/html"},id:"catalogue_metadataflyout_layer",minScale:36e6,maxScale:1,style:"",dataUrl:"",wmsUrl:"x",opacity:60,checked:"false",styledLayerDescriptor:'<StyledLayerDescriptor version="1.0.0" xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"     xmlns="http://www.opengis.net/sld"     xmlns:ogc="http://www.opengis.net/ogc"     xmlns:xlink="http://www.w3.org/1999/xlink"     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">   <NamedLayer>     <Name>Simple point with stroke</Name>    <UserStyle><Title>GeoServer SLD Cook Book: Simple point with stroke</Title>     <FeatureTypeStyle><Rule><PolygonSymbolizer> <Graphic><Mark><WellKnownName>circle</WellKnownName><Fill>        <CssParameter name="fill">#000040</CssParameter>       </Fill><Stroke>          <CssParameter name="stroke">#000040</CssParameter>           <CssParameter name="stroke-width">2</CssParameter>          </Stroke></Mark><Size>12</Size></Graphic>     </PolygonSymbolizer><TextSymbolizer><Label><ogc:PropertyName>title</ogc:PropertyName></Label><Fill><CssParameter name="fill">#000000</CssParameter></Fill></TextSymbolizer></Rule></FeatureTypeStyle></UserStyle></NamedLayer></StyledLayerDescriptor>'},start:function(){if(!this.started){this.started=!0,this._locale=Oskari.getLocalization(this.getName());var e,t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);this.sandbox=n,this.loader=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.service.MetadataLoader",this.getLocale().loader,n),n.register(this);for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&n.registerForEventByName(this,e);this._requestHandlers["catalogue.ShowMetadataRequest"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",n,this),n.addRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);var a=n.getRequestBuilder("userinterface.AddExtensionRequest")(this);n.request(this,a),n.registerAsStateful(this.mediator.bundleId,this)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerAddEvent:function(){},AfterMapLayerRemoveEvent:function(){},AfterMapMoveEvent:function(){}},stop:function(){var e,t=this.sandbox;t.removeRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),t.unregisterStateful(this.mediator.bundleId),t.unregister(this),this.started=!1},setSandbox:function(){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.Flyout",this,this.getLocale().flyout,this.getLoader())},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getTitle:function(){return this.getLocale().title},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},scheduleShowMetadata:function(e){this.plugins["Oskari.userinterface.Flyout"].scheduleShowMetadata(e),this.getSandbox().requestByName(this,"userinterface.UpdateExtensionRequest",[this,"detach"])},showExtentOnMap:function(e,t,i){var n=this;if(t){var a,r,s,o,l,u=[];for(a=0;a<t.length;a+=1)r=t[a],s=new OpenLayers.Bounds(r.westBoundLongitude,r.southBoundLatitude,r.eastBoundLongitude,r.northBoundLatitude),o=s.toGeometry(),l=new OpenLayers.Feature.Vector(o),l.attributes=i||l.attributes,u.push(l);var c=n.getSandbox().getEventBuilder("FeaturesAvailableEvent")(this.layer,u,"application/nlsfi-x-openlayers-feature",Oskari.getSandbox().getMap().getSrsName(),"replace");n.sandbox.notifyAll(c)}},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/catalogue/bundle/metadataflyout/instance",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.service.MetadataLoader",function(e,t){this.urls=e,this.sandbox=t,this.dev=!1},{getURLForView:function(e,t){var i=this.urls[e],n=i+"uuid="+t;if(this.dev){var a={"abstract":"abstract",jhs:"jhs158",inspire:"inspire",json:"json"}[e];null!==a&&void 0!==a&&(n=a)}return n},loadMetadata:function(e,t,i,n,a,r){var s=this.getURLForView(e,t,i,n);this.sandbox.printDebug("loadMetadata "+s),null!==s&&void 0!==s&&jQuery.ajax({url:s,dataType:r||"xml",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType(r&&"json"===r?"application/json":"text/html")},success:function(e){a(e,!0)},error:function(){a(null,!1)}})},loadGeonetworkAjaxHTML:function(e,t,i,n,a){{var r=this.getURLForView(t,i,n,a);OpenLayers.Request.GET({url:r,callback:e})}},openMetadata:function(e,t,i,n,a,r,s){{var o=this.getURLForView(e,t,i,n);window.open(o,s,"resizable=yes,scrollbars=yes,status=yes")}this.sandbox.printDebug("openMetadata "+o)}}),define("bundles/catalogue/bundle/metadataflyout/service/MetadataLoader",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.view.MetadataPage",function(e,t){this.instance=e,this.locale=t,this._tabs={},this._browseGraphicUrl=null,this.state=null,this._initialContentState={title:"…",metadata:{uuid:null,RS_Identifier_Code:null,RS_Identifier_CodeSpace:null},view:"abstract",metadataJson:null},this._contentState=jQuery.extend({},this._initialContentState),this._tabContainer=null},{templates:{browseGraphic:'<div class="browseGraphic"></div>'},_views:["abstract","jhs","inspire"],_links:["xml","pdf"],init:function(){var e,t,i=this,n=i.locale;i._tabContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer"),i._tabContainer.insertTo(i.getContainer()),i._tabContainer.addTabChangeListener(function(e,t){i.showMetadataView(t.viewId)}),i._views.forEach(function(e){t=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),t.setTitle(n[e]),t.viewId=e,i._tabContainer.addPanel(t),i._tabs[e]=t});var a=function(){i.openMetadataView(jQuery(this).attr("data-type"))};i._links.forEach(function(i){t=jQuery("<a />"),t.html(n[i]),t.attr("data-type",i),t.attr("href","#"),t.click(a),e=e?e.add(t):t}),i._tabContainer.setExtra(e),i.setTitle(this._contentState.title)},setState:function(e){this.state=e},openMetadataView:function(e,t){var i,n=this;n._contentState&&(i=n._contentState.metadata,this.instance.getLoader().openMetadata(e,i.uuid,i.RS_Identifier_Code,i.RS_Identifier_CodeSpace,function(){},null,t))},showMetadataView:function(e){this.instance.getSandbox().printDebug("ShowMetadataView "+e),this._contentState.view=e,this._loadMetadataForState()},_loadMetadataForState:function(){function e(e){var n;n=200===e.status?t._getFormattedContent(e.responseText):t._getErrorContent(),t._tabs[i].setContent(jQuery(t.templates.browseGraphic)),t._tabs[i].getContainer().append(n),t._resetBrowseGraphic(t._browseGraphicUrl),t._updatePanelTitle()}var t=this;if(!t._contentState||!t._contentState.metadata||!t._contentState.metadata.uuid)return!1;var i=t._contentState.view,n=t._contentState.metadata;t.instance.getLoader().loadGeonetworkAjaxHTML(e,i,n.uuid,n.RS_Identifier_Code,n.RS_Identifier_CodeSpace)},_getFormattedContent:function(e){var t=this,i=jQuery("<div />");i.html(e),jQuery.each(i.find("td.metadataContent"),function(e,i){var n=jQuery(i),a=n.parent(),r=jQuery('<td class="metadataContent"/>');n.hasClass("MD_DigitalTransferOptions")&&r.addClass("MD_DigitalTransferOptions");var s=n.text().split(".\n");jQuery.each(s,function(e,t){var i=jQuery.trim(t);if(0!==i.length){var n=jQuery('<div class="metadataflyout_content_section"/>');n.text(s.length>1?i+".":i),r.append(n)}}),n.remove(),a.append(r),t._linkify(r)});var n=i.find("a[href]"),a=new RegExp("^\\?.*");return jQuery.each(n,function(e,i){var n=jQuery(i),r=n.attr("href");if(r&&a.test(r)){var s=r.split("&"),o={};jQuery.each(s,function(e,t){var i=t.split("=");o[i[0]]=i[1]}),n.attr("href",null),n.click({viewId:viewId,uuid:o.uuid},function(e){var i=e.data,n=i.uuid;t.showMetadata(n)})}}),i},_getErrorContent:function(){var e=jQuery("<div />");return e.html(this.locale.notFound),e},_resetBrowseGraphic:function(e){var t,i=jQuery("<img />");e||(this._browseGraphicUrl=null),i.attr("src",e),this.getContainer().find(".browseGraphic").each(function(){t=jQuery(this),t.empty(),e&&t.append(i.clone())})},processJSON:function(e){var t=this,i=e.browseGraphic,n=e.env;if(t._resetBrowseGraphic(),i){var a=new Image,r=null;r=t.instance.getLoader().dev?"espoo_johtokartta_s.png":i,a.onload=function(){t._browseGraphicUrl=r,t._resetBrowseGraphic(r),a.onload=null},a.src=r}n&&t.instance.showExtentOnMap(t._contentState.metadata.uuid,n,e),t._contentState.metadataJson=e,t._updatePanelTitle()},_updatePanelTitle:function(){var e,t=this,i=t._contentState.metadataJson;i&&(e=i.title,e&&t.setTitle(e))},loadMetadataJSONForState:function(){var e,t=this;return t._contentState&&t._contentState.metadata&&t._contentState.metadata.uuid?(e=t._contentState.metadata,t.instance.getLoader().loadMetadata("json",e.uuid,e.RS_Identifier_Code,e.RS_Identifier_CodeSpace,function(e){if(e&&e.mdcs&&e.mdcs.length&&0!==e.mdcs.length){var i=e.mdcs[0];t.processJSON(i)}},"json"),!0):!1},showMetadata:function(e,t,i){this._contentState=jQuery.extend({},this._initialContentState),this._contentState.metadata.uuid=e,this._contentState.metadata.RS_Identifier_Code=t,this._contentState.metadata.RS_Identifier_CodeSpace=i,this.instance.getSandbox().printDebug("showMetadata { uuid="+e+", view="+this._contentState.view+"}"),this.loadMetadataJSONForState(),this.showMetadataView(this._contentState.view)},scheduleShowMetadata:function(e,t,i){this.showMetadata(e,t,i)},_linkify:function(e){var t=e.html(),i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,n=t.replace(i,'<a href="$1" target="_blank">$1</a>'),a=/(^|[^\/])(www\.[\S]+(\b|$))/gim;n=n.replace(a,'$1<a href="http://$2" target="_blank">$2</a>'),e.html(n)},destroy:function(){this._tabContainer.destroy(),this.html.remove()}},{extend:["Oskari.userinterface.component.AccordionPanel"]}),define("bundles/catalogue/bundle/metadataflyout/view/MetadataPage",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Flyout",function(e,t){this.instance=e,this.locale=t,this.container=null,this.accordion=null,this.pages={}},{getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Flyout"},setEl:function(e){this.container=jQuery(e),this.container.addClass("metadataflyout")},startPlugin:function(){var e=this,t=(e.locale,Oskari.clazz.create("Oskari.userinterface.component.Accordion"));e.accordion=t,t.insertTo(e.container)},stopPlugin:function(){var e;for(e in this.pages)this.pages.hasOwnProperty(e)&&(this.pages[e].destroy(),delete this.pages[e]);this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},scheduleShowMetadata:function(e){var t,i,n,a,r,s=this.accordion;for(t in this.pages)this.pages.hasOwnProperty(t)&&(i=this.pages[t],i&&(this.pages[t]=null,i.page.destroy(),s.removePanel(i.panel)));for(n=0;n<e.length;n+=1)a=e[n],r=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.view.MetadataPage",this.instance,this.locale),r.init(),s.addPanel(r),0===n&&r.open(),this.pages[a.uuid||a.RS_Identifier_CodeSpace+":"+a.RS_Identifier_Code]={page:r,panel:r,data:a};for(t in this.pages)this.pages.hasOwnProperty(t)&&(i=this.pages[t],i&&(a=i.data,r=i.page,r.scheduleShowMetadata(a.uuid,a.RS_Identifier_Code,a.RS_Identifier_CodeSpace)))},setContentState:function(e){this.contentState=e},getContentState:function(){return this.contentState},resetContentState:function(){this.contentState={}}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/catalogue/bundle/metadataflyout/Flyout",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Tile",function(e,t){this.instance=e,this.locale=t,this.container=null,this.template=null},{getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Tile"},setEl:function(e){this.container=$(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/catalogue/bundle/metadataflyout/Tile",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequest",function(e,t){if(this._creator=null,this._uuid=e.uuid,this._RS_Identifier_Code=e.RS_Identifier_Code,this._RS_Identifier_CodeSpace=e.RS_Identifier_CodeSpace,this._additionalMetadata=t,this._allMetadata=[],(void 0!==e.uuid||void 0!==e.RS_Identifier_Code||void 0!==e.RS_Identifier_CodeSpace)&&this._allMetadata.push(e),t){this._additionalMetadata=t;var i;for(i=0;i<t.length;i+=1)this._allMetadata.push(t[i])}},{__name:"catalogue.ShowMetadataRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getRS_Identifier_Code:function(){return this._RS_Identifier_Code},getRS_Identifier_CodeSpace:function(){return this._RS_Identifier_CodeSpace},getAdditionalMetadata:function(){return this._additionalMetadata},getAllMetadata:function(){return this._allMetadata}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequest",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.instance.scheduleShowMetadata(t.getAllMetadata())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequestHandler",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/catalogue/bundle/metadataflyout/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"catalogue.bundle.metadataflyout",value:{title:"Metatieto",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/fi/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/fi/metadata.show.portti?",jhs:"/geonetwork/srv/fi/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=fi&title=METATIETOTULOSTE&metadataresource",xml:"/geonetwork/srv/fi/iso19139.xml?",schemas:"/geonetwork/srv/fi/metadata.show.portti.skeemat?"},layer:{name:"Metatieto",description:"",orgName:"Paikkatietohakemisto",inspire:"Metatieto"},flyout:{title:"Metatieto","abstract":"Perustiedot",inspire:"Inspire-metatiedot",jhs:"JHS 158-metatiedot",xml:"ISO 19139 XML-tiedosto",map:"Kattavuus",pdf:"Tuloste",select_metadata_prompt:"Valitse metatieto kuvakkeista painamalla.",metadata_printout_title:"METATIETOKUVAUS",linkto:"Metatietolinkki",notFound:"Metadata was not found"},tile:{title:"Metatieto",tooltip:"Metatieto on tietoa tiedosta, tässä tapauksessa joko paikkatietoaineistosta, -aineistosarjasta tai -palvelusta. Metatiedoista selviää mm. kyseisen tietoresurssin käyttöehdot ja saatavuus."}}}),define("bundles/catalogue/bundle/metadataflyout/locale/fi",function(){}),Oskari.registerLocalization({lang:"en",key:"catalogue.bundle.metadataflyout",value:{title:"Metadata",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/en/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/en/metadata.show.portti?",jhs:"/geonetwork/srv/en/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=sv&title=METADATAPRINTOUT&metadataresource",xml:"/geonetwork/srv/en/iso19139.xml?",schemas:"/geonetwork/srv/en/metadata.show.portti.skeemat?"},layer:{name:"Metadata",description:"",orgName:"Metadata catalogue",inspire:"Metadata"},flyout:{title:"Metadata","abstract":"Basic information",inspire:"Inspire metadata",jhs:"ISO 19115 metadata",xml:"ISO 19139 XML file",map:"Geographic extent",pdf:"Printout",select_metadata_prompt:"Select metadata by clicking the icons.",metadata_printout_title:"METADATA PRINTOUT",linkto:"Link to this metadata",notFound:"Metadata was not found"},tile:{title:"Metadata",tooltip:"The terms of use and the availability of the dataset are documented in the metadata description."}}}),define("bundles/catalogue/bundle/metadataflyout/locale/en",function(){}),Oskari.registerLocalization({lang:"sv",key:"catalogue.bundle.metadataflyout",value:{title:"Metadata",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/sv/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/sv/metadata.show.portti?",jhs:"/geonetwork/srv/sv/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=sv&title=METADATAUTSKRIFT&metadataresource",xml:"/geonetwork/srv/sv/iso19139.xml?",schemas:"/geonetwork/srv/sv/metadata.show.portti.skeemat?"},layer:{name:"Metadata",description:"",orgName:"Metadata",inspire:"Metadata"},flyout:{title:"Metadata","abstract":"Abstrakt",inspire:"INSPIRE",jhs:"ISO 19115",xml:"XML",map:"Omfattning",pdf:"Utskrift",select_metadata_prompt:"Välj metadata genom att klicka på ikonerna",metadata_printout_title:"METADATA UTSKRIFT",linkto:"Metadatalänk",notFound:"Metadata hittades inte"},tile:{title:"Metadata",tooltip:"Metadata innehåller uppgifter om användningsvillkor och tillgång till datamaterial."}}}),define("bundles/catalogue/bundle/metadataflyout/locale/sv",function(){}),define("src/catalogue/metadataflyout/module",["oskari","jquery","bundles/catalogue/bundle/metadataflyout/instance","bundles/catalogue/bundle/metadataflyout/service/MetadataLoader","bundles/catalogue/bundle/metadataflyout/view/MetadataPage","bundles/catalogue/bundle/metadataflyout/Flyout","bundles/catalogue/bundle/metadataflyout/Tile","bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequest","bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequestHandler","css!resources/catalogue/bundle/metadataflyout/css/style.css","bundles/catalogue/bundle/metadataflyout/locale/fi","bundles/catalogue/bundle/metadataflyout/locale/en","bundles/catalogue/bundle/metadataflyout/locale/sv"],function(e){return e.bundleCls("metadataflyout").category({create:function(){return e.clazz.create("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance")},start:function(){},stop:function(){},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.routesearch.RouteSearchBundleInstance",function(){},{getName:function(){return"RouteSearch"},startPlugin:function(){this.setDefaultTile(this.getLocalization("tile").title)},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=this,i="close"!==e.getViewState();e.getExtension().getName()===t.getName()&&(i||this.plugins["Oskari.userinterface.Flyout"].disableMapClick())}},registerMapClickHandler:function(){this.eventHandlers.MapClickedEvent||(this.eventHandlers.MapClickedEvent=function(e){this.plugins["Oskari.userinterface.Flyout"].onMapClick(e.getLonLat())},this.sandbox.registerForEventByName(this,"MapClickedEvent"))},unregisterMapClickHandler:function(){delete this.eventHandlers.MapClickedEvent,this.sandbox.unregisterFromEventByName(this,"MapClickedEvent")}},{extend:["Oskari.userinterface.extension.DefaultExtension"]}),define("bundles/framework/bundle/routesearch/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.routesearch.Flyout",function(){this.fields=["from","to"],this.state={},this.services=[],this._templates={},this._templates.main="<div></div><div>    <strong></strong>    <ul></ul></div><div></div>",this.mapEl=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule").getMapEl()},{getName:function(){return"Oskari.mapframework.bundle.routesearch.Flyout"},_getSearchSuggestions:function(e,t,i){var n=this,a=e.element[0].name;n.state[a]={name:t.term},n._updateRoutingLinks(),t.term&&t.term.length&&n.service.doSearch(t.term,function(e){i(e&&e.totalCount?e.locations:[])},function(){})},_setSearchLocation:function(e,t,i){var n=this,a=e.attr("name"),r=jQuery("<a>"),s={name:r.html(i.item.name).text(),village:r.html(i.item.village).text()};n.state[a]=s,e.val(s.name+", "+s.village),n._updateRoutingLinks()},_reverseGeoCode:function(){},disableMapClick:function(){var e=this;delete e.state.field,e.mapEl.removeClass("cursor-crosshair"),e.instance.unregisterMapClickHandler()},onMapClick:function(e){var t=this;t.state.field&&(t._reverseGeoCode(t.state.field,e),t.disableMapClick())},_fromMapButtonHandler:function(e){var t=this;t.state.field===e?t.disableMapClick():(t.state.field=e,t.instance.registerMapClickHandler(),t.mapEl.addClass("cursor-crosshair"))},startPlugin:function(){var e,t,i,n=this,a=null,r=n.getEl().addClass("routesearch"),s=jQuery(n._templates.main),o=n.fields;for(a=n.instance.conf&&n.instance.conf.url?n.instance.conf.url:n.getSandbox().getAjaxUrl()+"action_route=GetSearchResult",n.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",a),s.eq(1).find("strong").html(n.locale.routingService),e=0;e<o.length;e++)t=o[e],i=Oskari.clazz.create("Oskari.userinterface.component.FormInput",t),i.addClearButton(),i.setLabel(n.locale[t]),i.getField().find("input[type=text]").autocomplete({delay:300,minLength:0,select:function(e,t){e.preventDefault(),n._setSearchLocation(jQuery(this),e,t)},source:function(e,t){n._getSearchSuggestions(this,e,t)}}).data("autocomplete")._renderItem=function(e,t){var i=jQuery("<li>"),n=jQuery('<a href="#">');return n.html(t.name+", "+t.village),i.append(n),e.append(i),i},s.eq(0).append(i.getField()),i=Oskari.clazz.create("Oskari.userinterface.component.Button"),i.setTitle(n.locale.fromMap),i.setHandler(function(e){n._fromMapButtonHandler(t,e)});r.append(s),n._initRoutingServices(),n._updateRoutingLinks(!0)},_initRoutingServices:function(){var e=this;e.services.push(e._routingService("Matka.fi","#1A88CC",function(e,t){var i="http://www.matka.fi/fi/?keya=";return i+=e.name,e.village&&(i+="%2C+"+e.village),i+="&keyb="+t.name,t.village&&(i+="%2C+"+t.village),i=i.replace("Å","%C5").replace("å","%E5").replace("Ä","%C4").replace("ä","%E4").replace("Ö","%D6").replace("ö","%F6").replace("é","%E9").replace("É","%C9").replace("ü","%FC").replace("Ü","%DC").replace("'","%27").replace(",","%2C")})),e.services.push(e._routingService("Google Maps","#88BE44",function(e,t){var i="https://www.google.fi/maps/dir/";return i+=encodeURIComponent(e.name),e.village&&(i+=",+"+encodeURIComponent(e.village)),i+=",+Finland",i+="/"+encodeURIComponent(t.name),t.village&&(i+=",+"+encodeURIComponent(t.village)),i+=",+Finland"})),e.services.push(e._routingService("HERE","#124191",function(e,t){var i="http://here.com/directions/drive/";return i+=e.name.replace(" ","_"),e.village&&(i+=",_"+e.village.replace(" ","_")),i+=",_Finland",i+="/"+t.name.replace(" ","_"),t.village&&(i+=",_"+t.village.replace(" ","_")),i+=",_Finland"}))},_routingService:function(e,t,i){var n=this,a={name:e,color:t,urlBuilder:i,getButton:function(e,t){var i=this.el;return i||(i=jQuery('<a class="button">'+this.name+"</a>"),this.el=i),e&&e.name&&t&&t.name?i.attr("href",this.urlBuilder(e,t)).attr("target","_blank").removeClass("disabled").css("background-color",this.color).prop("title",this.name).unbind("click"):i.attr("href","#").removeAttr("target").addClass("disabled").css("background-color","").prop("title",n.locale.selectLocations).click(function(e){return e.preventDefault(),!1}),i}};return a},_updateRoutingLinks:function(e){var t,i,n,a=this,r=[];for(n=0;n<a.fields.length;n++)r.push(a.state[a.fields[n]]);for(n=0;n<a.services.length;n++)i=a.services[n],t=i.getButton.apply(i,r),e&&a.getEl().find("ul").append(jQuery("<li>").append(t))}},{extend:["Oskari.userinterface.extension.DefaultFlyout"]}),define("bundles/framework/bundle/routesearch/Flyout",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/routesearch/css/routesearch.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"en",key:"RouteSearch",value:{title:"Route Search",desc:"",flyout:{title:"Route Search",description:"",from:"From",to:"To",fromMap:"Select location from map",routingService:"Routing Service",fetchRoute:"Fetch route",selectLocations:"Please select both locations"},tile:{title:"Route Search",description:""}}}),define("bundles/framework/bundle/routesearch/locale/en",function(){}),Oskari.registerLocalization({lang:"fi",key:"RouteSearch",value:{title:"Reittihaku",desc:"",flyout:{title:"Reittihaku",description:"",from:"Mistä",to:"Mihin",fromMap:"Valitse paikka kartalta",routingService:"Reitityspalvelu",fetchRoute:"Hae reitti",selectLocations:"Valitse molemmat paikat"},tile:{title:"Reittihaku",description:""}}}),define("bundles/framework/bundle/routesearch/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"RouteSearch",value:{title:"Ruttsök",desc:"",flyout:{title:"Ruttsök",description:"",from:"Från",to:"Till",fromMap:"Välj en plats på kartan",routingService:"Routningstjänst",fetchRoute:"Sök rutt",selectLocations:"Välj båda platserna"},tile:{title:"Ruttsök",description:""}}}),define("bundles/framework/bundle/routesearch/locale/sv",function(){}),define("src/framework/routesearch/module",["oskari","jquery","bundles/framework/bundle/routesearch/instance","bundles/framework/bundle/routesearch/Flyout","bundles/framework/bundle/search/service/searchservice","css!resources/framework/bundle/routesearch/css/routesearch.css","bundles/framework/bundle/routesearch/locale/en","bundles/framework/bundle/routesearch/locale/fi","bundles/framework/bundle/routesearch/locale/sv"],function(e){return e.bundleCls("routesearch").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.routesearch.RouteSearchBundleInstance")},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance",function(){this._requestHandlers={},this.attachedToDefault=!1,this.helper=null,this.isContentLoaded=!1,this.defaultConf={name:"userinterface.UserGuide",tileClazz:"Oskari.userinterface.extension.DefaultTile",flyoutClazz:"Oskari.mapframework.bundle.userguide.Flyout"}},{afterStart:function(e){var t=(this.getLocalization("title"),this.conf),i=(t?t.sandbox:null)||"sandbox",e=Oskari.getSandbox(i);this._requestHandlers["userguide.ShowUserGuideRequest"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",e,this),e.addRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]),this.plugins["Oskari.userinterface.Flyout"].createUi();var n=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",e);this.helper=n},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()===t.getName()){var i="close"!==e.getViewState();t.displayContent(i)}}},displayContent:function(e){function t(e){return function(t,i){var n=i,s="error.generic";a.getLocalization("error")&&a.getLocalization("error").generic&&(s=a.getLocalization("error").generic),t?n[r]&&(n=n[r]):n=s,a.plugins["Oskari.userinterface.Flyout"].setContent(n,e),a.isContentLoaded=!0}}var i,n,a=this;if(e&&!a.isContentLoaded){var r="help.contentPart";a.getLocalization("help")&&a.getLocalization("help").contentPart&&(r=a.getLocalization("help").contentPart);var s=a.plugins["Oskari.userinterface.Flyout"].getUserGuideTabs();if(a.getLocalization("tabs"))for(n=0;n<s.length;n+=1)i=s[n],a.helper.getHelpArticle(i.tags,t(i.tags));else a.tagsTxt=a.getLocalization("help").tags,a.helper.getHelpArticle(a.tagsTxt,t(a.tagsTxt))}},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);t.removeRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregister(this),this.started=!1}},{extend:["Oskari.userinterface.extension.DefaultExtension"]}),define("bundles/framework/bundle/userguide/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequest",function(e){var t=e||{};this._creator=null,this._el=t.el,this._context=t.context,this._extension=t.extension,this._toggle=t.toggle,this._placement=t.placement,this._content=t.content},{__name:"userguide.ShowUserGuideRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getContext:function(){return this._context},getExtension:function(){return this._extension},getEl:function(){return this._el},isToggle:function(){return this._toggle},getPlacement:function(){return this._placement},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/userguide/request/ShowUserGuideRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler] Show UserGuide: "+t.getUuid()),this.instance.scheduleShowUserGuide(t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Flyout",function(){this.userGuideTabs=[]},{startPlugin:function(){this.userGuideTabs=this.instance.getLocalization("tabs")||[]},createUi:function(){var e,t,i,n=this;if(n.cel=jQuery(n.container),n.cel.empty(),this.userGuideTabs=this.instance.getLocalization("tabs")||[],this.instance.getLocalization("tabs")){for(n.tabContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer"),e=0;e<n.userGuideTabs.length;e+=1)t=n.userGuideTabs[e],i=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),i.setTitle(t.title),i.setContent(n.getLocalization("help").loadingtxt),i.tagsTxt=t.tags,n.tabContainer.addPanel(i);n.tabContainer.insertTo(n.cel)}},getUserGuideTabs:function(){return this.userGuideTabs},setContent:function(e,t){var i=this;if(this.instance.getLocalization("tabs")){var n,a,r=i.tabContainer.panels;for(n=0;n<r.length;n+=1)a=r[n],t===a.tagsTxt&&a.setContent(e)}else i.cel.append(e)}},{extend:["Oskari.userinterface.extension.DefaultFlyout"]}),define("bundles/framework/bundle/userguide/Flyout",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/userguide/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"hy",key:"userinterface.UserGuide",value:{title:"Օգնել",desc:"",flyout:{title:"Oskari օգտագործողի ուղեցույց",loadingtxt:"NOT TRANSLATED"},tile:{title:"Քարտեզի օգտագործողի ուղեցույց"},error:{title:"Սխալ",generic:"Օգտագործողի ուղեցույցի ներբեռնման ձախողում.կրկին փորձել"},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/hy",function(){}),Oskari.registerLocalization({lang:"cs",key:"userinterface.UserGuide",value:{title:"Nápověda",desc:"",flyout:{title:"Uživatelská příručka Paikkatietoikkuna",loadingtxt:"NOT TRANSLATED"},tile:{title:"Uživatelská příručka mapy"},error:{title:"Chyba!",generic:"Nahrávání uživatelské příručky selhalo. Zkuste to prosím později."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"userinterface.UserGuide",value:{title:"Hjælp",desc:"",flyout:{title:"Oskari brugervejledning",loadingtxt:"NOT TRANSLATED"},tile:{title:"Kortbrugervejledning"},error:{title:"Fejl!",generic:"Fejl ved indlæsning af brugervejledning. Prøv venligst igen senere."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"userinterface.UserGuide",value:{title:"Hilfe",desc:"",flyout:{title:"Paikkatietoikkuna Benutzerhandbuch",loadingtxt:"NOT TRANSLATED"},tile:{title:"Kartennutzerhandbuch"},error:{title:"Fehler!",generic:"Fehler beim Laden des Benutzerhandbuchs. Bitte versuchen Sie es später noch einmal."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"userinterface.UserGuide",value:{title:"Help",desc:"",flyout:{title:"User Guide",loadingtxt:"<p>Loading the guide...</p>"},tile:{title:"User Guide"},error:{title:"Error!",generic:"Loading user guide failed. Please try again later."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"userinterface.UserGuide",value:{title:"Ayuda",desc:"",flyout:{title:"Guía de usuario de Oskari",loadingtxt:"NOT TRANSLATED"},tile:{title:"Guía de usuario del mapa"},error:{title:"¡Error!",generic:"Fallo al cargar la guía de usuario. Por favor, inténtelo más tarde."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"userinterface.UserGuide",value:{title:"Abi",desc:"",flyout:{title:"Oskari kasutusjuhend",loadingtxt:"NOT TRANSLATED"},tile:{title:"Kaardi kasutusjuhend"},error:{title:"Viga!",generic:"Kasutusjuhendi laadimine ebaõnnestus. Palun proovi hiljem uuesti."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"userinterface.UserGuide",value:{title:"Ohje",desc:"",flyout:{title:"Käyttöohje",loadingtxt:"<p>ladataan sisältöä</p>"},tile:{title:"Käyttöohje"},error:{title:"Virhe!",generic:"Ohjeen lataaminen epäonnistui. Yritä myöhemmin uudelleen."},tabs:[{title:"Karttaikkuna",tags:"ohje_karttaikkuna"},{title:"Kartan julkaisu",tags:"ohje_karttajulkaisu"},{title:"Teemakartat",tags:"ohje_teemakartat"},{title:"Analyysi",tags:"ohje_analyysi"}],help:{tags:"karttaikkuna,pikaohje",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/fi",function(){}),Oskari.registerLocalization({lang:"el",key:"userinterface.UserGuide",value:{title:"Βοήθεια",desc:"",flyout:{title:"Οδηγός χρήστη OSKARI",loadingtxt:"NOT TRANSLATED"},tile:{title:"Οδηγός χρήστη χάρτη"},error:{title:"Σφάλμα!",generic:"Η φόρτωση του οδηγού χρήστη απέτυχε. Παρακαλούμε δοκιμάστε πάλι αργότερα."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/el",function(){}),Oskari.registerLocalization({lang:"hr",key:"userinterface.UserGuide",value:{title:"Pomoć",desc:"",flyout:{title:"Oskari vodič za upotrebu",loadingtxt:"NOT TRANSLATED"},tile:{title:"Vodič za upotrebu karte"},error:{title:"Greška!",generic:"Greška u učitavanju vodiča za upotrebu. Pokušajte kasnije."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"userinterface.UserGuide",value:{title:"Segítség",desc:"",flyout:{title:"Oskari használati útmutató",loadingtxt:"NOT TRANSLATED"},tile:{title:"Térképkezelési útmutató"},error:{title:"Hiba!",generic:"Használati útmutató betöltése sikertelen. Kérem próbálja később."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/hu",function(){}),Oskari.registerLocalization({lang:"lv",key:"userinterface.UserGuide",value:{title:"Palīdzība",desc:"",flyout:{title:'"Oskari" lietotāja rokasgrāmata',loadingtxt:"NOT TRANSLATED"},tile:{title:"Kartes lietotāja rokasgrāmata"},error:{title:"Kļūda!",generic:"Lietotāja rokasgrāmatu atvērt neizdevās. Lūdzu mēģiniet vēlāk."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"userinterface.UserGuide",value:{title:"Help",desc:"",flyout:{title:"Oskari gebruikershandleiding",loadingtxt:"NOT TRANSLATED"},tile:{title:"Kaart gebruikershandleiding"},error:{title:"Fout!",generic:"Laden gebruikershandleiding is mislukt. Probeer het later opnieuw."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"userinterface.UserGuide",value:{title:"Pomoc",desc:"",flyout:{title:"Oskari instrukcja użytkownika",loadingtxt:"NOT TRANSLATED"},tile:{title:"Instrukcja korzystania z mapy"},error:{title:"Błąd!",generic:"Pobranie instrukcji użytkownika nie powiodło się. Spróbuj ponownie później."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"userinterface.UserGuide",value:{title:"Ajuda",desc:"",flyout:{title:"Guia do utilizador do Oskari",loadingtxt:"NOT TRANSLATED"},tile:{title:"Guia do utilizador da cartografia"},error:{title:"Erro!",generic:"Falha no carregamento do guia do utilizador. Por favor tente mais tarde"},help:{tags:"vista, guia do utilizador",contentPart:"corpo"}}}),define("bundles/framework/bundle/userguide/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"userinterface.UserGuide",value:{title:"Ajutor",desc:"",flyout:{title:"Ghid utilizator Oskari",loadingtxt:"NOT TRANSLATED"},tile:{title:"Ghid utilizator Hartă"},error:{title:"Eroare!",generic:"Încărcare ghid utilizator eşuată. Vă rugăm încercaţi mai târziu."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/ro",function(){}),Oskari.registerLocalization({lang:"sl",key:"userinterface.UserGuide",value:{title:"Pomoč",desc:"",flyout:{title:"Oskari uporabniški priročnik",loadingtxt:"NOT TRANSLATED"},tile:{title:"Uporabniški priročnik za karto"},error:{title:"Napaka!",generic:"Nalaganje uporabniškega priročnika ni uspelo. Prosim poskusi kasneje."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/sl",function(){}),Oskari.registerLocalization({lang:"sk",key:"userinterface.UserGuide",value:{title:"Pomocník",desc:"",flyout:{title:"Návod na obsluhu pre Oskari",loadingtxt:"NOT TRANSLATED"},tile:{title:"Návod na obsluhu pre mapu"},error:{title:"Chyba!",generic:"Načítavanie návodu na obsluhu zlyhalo. Skúste neskôr, prosím."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/sk",function(){}),Oskari.registerLocalization({lang:"sq",key:"userinterface.UserGuide",value:{title:"Ndihmë",desc:"",flyout:{title:"Udhëzues i përdoruesit Oskari",loadingtxt:"NOT TRANSLATED"},tile:{title:"Harta udhëzuese të përdoruesit"},error:{title:"Gabim!",generic:"Dështoi ngarkimi i udhëzuesit të përdoruesit. Ju lutem provoni më vonë."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/sq",function(){}),Oskari.registerLocalization({lang:"sr",key:"userinterface.UserGuide",value:{title:"Pomoć",desc:"",flyout:{title:"OSKARI uputstvo za korisnike",loadingtxt:"NOT TRANSLATED"},tile:{title:"Uputstvo za korisnike"},error:{title:"Greška!",generic:"Učitavanje uputstva za korisnike je neuspeštno. Molimo, pokušajte ponovo."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/sr",function(){}),Oskari.registerLocalization({lang:"sv",key:"userinterface.UserGuide",value:{title:"Hjälp",desc:"",flyout:{title:"Så här använder du Paikkatietoikkuna",loadingtxt:"NOT TRANSLATED"},tile:{title:"Bruksanvisningar"},error:{title:"Fel!",generic:"Laddningen av anvisningarna misslyckades. Försök på nytt senare."},help:{tags:"kartfönstret,snappguide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"userinterface.UserGuide",value:{title:"Довідка",desc:"",flyout:{title:"Інструкція користувача Oskari",loadingtxt:"NOT TRANSLATED"},tile:{title:"Інструкція користувача карти"},error:{title:"Помилка!",generic:"Сталася помилка при завантаження інструкції користувача. Будь-ласка, спробуйте пізніше"},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}}),define("bundles/framework/bundle/userguide/locale/uk",function(){}),define("src/framework/userguide/module",["oskari","jquery","bundles/framework/bundle/userguide/instance","bundles/framework/bundle/userguide/request/ShowUserGuideRequest","bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler","bundles/framework/bundle/userguide/Flyout","css!resources/framework/bundle/userguide/css/style.css","bundles/framework/bundle/userguide/locale/hy","bundles/framework/bundle/userguide/locale/cs","bundles/framework/bundle/userguide/locale/da","bundles/framework/bundle/userguide/locale/de","bundles/framework/bundle/userguide/locale/en","bundles/framework/bundle/userguide/locale/es","bundles/framework/bundle/userguide/locale/et","bundles/framework/bundle/userguide/locale/fi","bundles/framework/bundle/userguide/locale/el","bundles/framework/bundle/userguide/locale/hr","bundles/framework/bundle/userguide/locale/hu","bundles/framework/bundle/userguide/locale/lv","bundles/framework/bundle/userguide/locale/nl","bundles/framework/bundle/userguide/locale/pl","bundles/framework/bundle/userguide/locale/pt","bundles/framework/bundle/userguide/locale/ro","bundles/framework/bundle/userguide/locale/sl","bundles/framework/bundle/userguide/locale/sk","bundles/framework/bundle/userguide/locale/sq","bundles/framework/bundle/userguide/locale/sr","bundles/framework/bundle/userguide/locale/sv","bundles/framework/bundle/userguide/locale/uk"],function(e){return e.bundleCls("userguide").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance")
},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.backendstatus.BackendStatusBundleInstance",function(){this._localization=null,this._sandbox=null,this._started=!1,this._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null},this.timeInterval=this.ajaxSettings.defaultTimeThreshold,this.backendStatus={},this.backendExtendedStatus={},this.gotStartupEvent=!1,this.gotStartupTimeoutEvent=!1,this.gotStartupProcessCall=!1,this._mapLayerService=null},{ajaxSettings:{defaultTimeThreshold:15e3},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},__name:"BackendStatus",getName:function(){return this.__name},setSandbox:function(e){this._sandbox=e},getSandbox:function(){return this._sandbox},getAjaxUrl:function(e,t){var i=this.getSandbox().getAjaxUrl(),n=null;return n=t?i+"action_route=GetBackendStatus&Subset=AllKnown":i+"action_route=GetBackendStatus&Subset=Alert"},start:function(){var e=this;if(!e._started){e._started=!0;var t,i=e.conf,n=(i?i.sandbox:null)||"sandbox",a=Oskari.getSandbox(n);e._sandbox=a,e._mapLayerService=a.getService("Oskari.mapframework.service.MapLayerService"),a.register(e);for(t in e.eventHandlers)e.eventHandlers.hasOwnProperty(t)&&a.registerForEventByName(e,t);e._mapLayerService.isAllLayersLoaded()&&!e.gotStartupProcessCall&&e.updateBackendStatus(!0)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},extensionsByName:{LayerSelector:!0},extensionStatesByName:{attach:!0,detach:!0},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=e.getExtension();if(t){var i=t.getName();if(i&&this.extensionsByName[i]){var n=e.getViewState();this.extensionStatesByName[n]&&this.updateBackendStatus()}}},AfterShowMapLayerInfoEvent:function(e){var t=e.getMapLayer(),i=t.getId(),n=(t.getBackendStatus(),this.backendExtendedStatus[i]);if(!n)return void this.showFeedbackDialog("missing_backendstatus_information");var a=n.infourl;return a?void this.openURLinWindow(a):void this.showFeedbackDialog("missing_backendstatus_infourl")},MapLayerEvent:function(e){if((null===e.getLayerId()||void 0===e.getLayerId())&&"add"===e.getOperation()){var t=this;t.gotStartupEvent=!0,window.setTimeout(function(){t.gotStartupTimeoutEvent=!0,t.updateBackendStatus(!0)},15)}}},showFeedbackDialog:function(e){var t=this.getLocalization("feedback")[e],i=Oskari.clazz.create("Oskari.userinterface.component.Popup");i.show(t.title,t.message),i.fadeout()},openURLinWindow:function(e){var t="location=1,status=1,scrollbars=1,width=850,height=1200",i=e;window.open(i,"BackendStatus",t)},stop:function(){var e,t=this,i=t._sandbox;t._cancelAjaxRequest();for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&i.unregisterFromEventByName(this,e);i.unregister(this),this._started=!1,this._sandbox=null},getTitle:function(){return"Backend Status"},getDescription:function(){return"Backend Status"},_cancelAjaxRequest:function(){var e=this;if(e._pendingAjaxQuery.busy){var t=e._pendingAjaxQuery.jqhr;e._pendingAjaxQuery.jqhr=null,t&&(this._sandbox.printDebug("[BackendStatus] Abort jqhr ajax request"),t.abort(),t=null,e._pendingAjaxQuery.busy=!1)}},_startAjaxRequest:function(e){var t=this;t._pendingAjaxQuery.busy=!0,t._pendingAjaxQuery.timestamp=e},_finishAjaxRequest:function(){var e=this;e._pendingAjaxQuery.busy=!1,e._pendingAjaxQuery.jqhr=null,this._sandbox.printDebug("[BackendStatus] finished jqhr ajax request")},_notifyAjaxFailure:function(){var e=this;e._sandbox.printDebug("[BackendStatus] BackendStatus AJAX failed"),e._processResponse({backendstatus:[]})},_isAjaxRequestBusy:function(){var e=this;return e._pendingAjaxQuery.busy},updateBackendStatus:function(e){var t=this;t.gotStartupProcessCall=t.gotStartupProcessCall||e;var i=t._sandbox;if(!e&&t._pendingAjaxQuery.busy)return void i.printDebug("[BackendStatus] updateBackendStatus NOT SENT previous query is busy");var n=new Date,a=n.getTime();if(!e&&t._pendingAjaxQuery.timestamp&&a-t._pendingAjaxQuery.timestamp<t.timeInterval)return void i.printDebug("[BackendStatus] updateBackendStatus NOT SENT (time difference < "+t.timeInterval+"ms)");t._cancelAjaxRequest(),t._startAjaxRequest(a);var r=t.getAjaxUrl(null,e);jQuery.ajax({beforeSend:function(e){t._pendingAjaxQuery.jqhr=e,e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(i){t._finishAjaxRequest(),t._processResponse(i,e)},error:function(){t._finishAjaxRequest(),t._notifyAjaxFailure()},always:function(){t._finishAjaxRequest()},complete:function(){t._finishAjaxRequest()},data:{},type:"POST",dataType:"json",url:r})},_processResponse:function(e,t){var i=this,n=this._sandbox;if(!e)return void n.printDebug("[BackendStatus] empty data from server");var a=e.backendstatus;if(!a||void 0===a.length)return void n.printDebug("[BackendStatus] backendStatus NO data");var r,s,o,l,u=n.getEventBuilder("BackendStatus.BackendStatusChangedEvent"),c={},d=t?{}:this.backendExtendedStatus;for(r=0;r<a.length;r+=1)s=a[r],o=s.maplayer_id,this.backendStatus[o]?this.backendStatus[o].status!==s.status?(c[o]={status:s.status,changed:!0},d[o]=s):(c[o]={status:s.status,changed:!1},d[o]=s):(c[o]={status:s.status,changed:!0},d[o]=s);for(l in i.backendStatus)i.backendStatus.hasOwnProperty(l)&&(c[l]||null===this.backendStatus[l].status||void 0===this.backendStatus[l].status||(c[l]={status:null,changed:!0}));this.backendExtendedStatus=d;var h,p=[];for(l in c)if(c.hasOwnProperty(l)){this.backendStatus[l]=c[l];var f=n.findMapLayerFromAllAvailable(l);f&&(f.setBackendStatus(this.backendStatus[l].status),(c[l].changed||"DOWN"===f.getBackendStatus())&&(n.isLayerAlreadySelected(f.getId())?(evt=u(f.getId(),f.getBackendStatus()),n.notifyAll(evt)):p.push({layerId:f.getId(),status:f.getBackendStatus()})))}if(t)i._pendingAjaxQuery.timestamp=null,i.backendStatus={};else if(h=p.length,h>100)evt=u(),n.notifyAll(evt);else for(l=0;h>l;++l)evt=u(p[l].layerId,p[l].status),n.notifyAll(evt)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/backendstatus/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.backendstatus.event.BackendStatusChangedEvent",function(e,t){this._layerId=e,this._status=t},{__name:"BackendStatus.BackendStatusChangedEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getStatus:function(){return this._status}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/backendstatus/event/BackendStatusChangedEvent",function(){}),Oskari.registerLocalization({lang:"fi",key:"BackendStatus",value:{title:"NOT TRANSLATED",desc:"",feedback:{missing_backendstatus_status:{title:"Karttatasot",message:"Tilatietoa ei ole saatavilla tälle karttatasolle."},missing_backendstatus_information:{title:"Karttatasot",message:"Tilatietoa ei ole saatavilla tälle karttatasolle."},missing_backendstatus_infourl:{title:"Karttatasot",message:"Tilatietoa ei ole saatavilla tälle karttatasolle."}}}}),define("bundles/framework/bundle/backendstatus/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"BackendStatus",value:{title:"",desc:"",feedback:{missing_backendstatus_status:{title:"Kartlager",message:"Kartlagrets tillgänglighetinformation finns ej"},missing_backendstatus_information:{title:"Kartlager",message:"Kartlagrets tillgänglighetinformation finns ej"},missing_backendstatus_infourl:{title:"Kartlager",message:"Kartlagrets tillgänglighetinformation finns ej"}}}}),define("bundles/framework/bundle/backendstatus/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"BackendStatus",value:{title:"Backend Status",desc:"",feedback:{missing_backendstatus_status:{title:"Map layers",message:"The status information for this map layer is not available."},missing_backendstatus_information:{title:"Map layers",message:"The status information for this map layer is not available."},missing_backendstatus_infourl:{title:"Map layers",message:"The status information for this map layer is not available."}}}}),define("bundles/framework/bundle/backendstatus/locale/en",function(){}),define("src/framework/backendstatus/module",["oskari","jquery","bundles/framework/bundle/backendstatus/instance","bundles/framework/bundle/backendstatus/event/BackendStatusChangedEvent","bundles/framework/bundle/backendstatus/locale/fi","bundles/framework/bundle/backendstatus/locale/sv","bundles/framework/bundle/backendstatus/locale/en"],function(e){return e.bundleCls("backendstatus").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.backendstatus.BackendStatusBundleInstance");return t},update:function(){}})}),function(e,t){var i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(n){function a(){var t=e(h),i=e(p);l&&(p.length?l.reject(c,t,i):l.resolve(c)),e.isFunction(n)&&n.call(o,c,t,i)}function r(e){s(e.target,"error"===e.type)}function s(t,n){t.src!==i&&-1===e.inArray(t,d)&&(d.push(t),n?p.push(t):h.push(t),e.data(t,"imagesLoaded",{isBroken:n,src:t.src}),u&&l.notifyWith(e(t),[n,c,e(h),e(p)]),c.length===d.length&&(setTimeout(a),c.unbind(".imagesLoaded",r)))}var o=this,l=e.isFunction(e.Deferred)?e.Deferred():0,u=e.isFunction(l.notify),c=o.find("img").add(o.filter("img")),d=[],h=[],p=[];return e.isPlainObject(n)&&e.each(n,function(e,t){"callback"===e?n=t:l&&l[e](t)}),c.length?c.bind("load.imagesLoaded error.imagesLoaded",r).each(function(n,a){var r=a.src,o=e.data(a,"imagesLoaded");return o&&o.src===r?void s(a,o.isBroken):a.complete&&a.naturalWidth!==t?void s(a,0===a.naturalWidth||0===a.naturalHeight):void((a.readyState||a.complete)&&(a.src=i,a.src=r))}):a(),l?l.promise(o):o}}(jQuery),define("bundles/framework/bundle/printout/jquery.imagesLoaded",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.PrintoutBundleInstance",function(){this.sandbox=void 0,this.started=!1,this.plugins={},this.localization=void 0,this.printout=void 0,this.buttonGroup="viewtools",this.ignoreEvents=!1,this.dialog=void 0,this.printoutHandler=void 0,this.isMapStateChanged=!0,this.state=void 0,this.geoJson=void 0,this.tableJson=void 0,this.tileData=void 0,this.printService=void 0,this.legendPlugin=void 0,this.backendConfiguration={formatProducers:{"application/pdf":"","image/png":""}}},{__name:"Printout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=this.conf,n=(i?i.sandbox:null)||"sandbox",a=Oskari.getSandbox(n);e.sandbox=a,this.localization=Oskari.getLocalization(this.getName()),a.register(e);for(t in e.eventHandlers)e.eventHandlers.hasOwnProperty(t)&&a.registerForEventByName(e,t);e.backendConfiguration.formatProducers["application/pdf"]=(i?i.backendConfiguration.formatProducers["application/pdf"]:null)||"",e.backendConfiguration.formatProducers["image/png"]=(i?i.backendConfiguration.formatProducers["image/png"]:null)||"",this.printoutHandler=Oskari.clazz.create("Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler",a,function(){e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"attach"])}),a.addRequestHandler("printout.PrintMapRequest",this.printoutHandler);var r,s=a.getRequestBuilder("Toolbar.AddToolButtonRequest"),o={print:{iconCls:"tool-print",tooltip:this.localization.btnTooltip,sticky:!0,callback:function(){e.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e,"attach"])}}};for(r in o)i.buttons&&i.buttons[r]===!1||o.hasOwnProperty(r)&&a.request(this,s(r,this.buttonGroup,o[r]));var l=Oskari.clazz.create("Oskari.mapframework.bundle.printout.service.PrintService",e);a.registerService(l),this.printService=l;var u=e.getLocalization(),c=a.findRegisteredModuleInstance("MainMapModule"),d=this.conf.legend,h=Oskari.clazz.create("Oskari.mapframework.bundle.printout.plugin.LegendPlugin",e,d,u);c.registerPlugin(h),c.startPlugin(h),this.legendPlugin=h;var p=a.getRequestBuilder("userinterface.AddExtensionRequest")(this);a.request(this,p),e._createUi(),a.registerAsStateful(this.mediator.bundleId,this),this.tileData={}}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{MapLayerVisibilityChangedEvent:function(){this.printout&&this.printout.isEnabled&&this.isMapStateChanged&&(this.isMapStateChanged=!1,this.getSandbox().printDebug("PRINTOUT REFRESH"),this.printout.refresh(!0))},AfterMapMoveEvent:function(){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1),this.isMapStateChanged=!0},AfterMapLayerAddEvent:function(){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},AfterMapLayerRemoveEvent:function(){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},AfterChangeMapLayerStyleEvent:function(){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()===t.getName()){var i="close"!==e.getViewState();t.displayContent(i)}},"Printout.PrintableContentEvent":function(e){var t=(e.getContentId(),e.getLayer()),i=t&&t.getId?t.getId():null,n=e.getTileData(),a=e.getGeoJsonData();a&&(this.geoJson=a),n&&i&&(this.tileData[i]=n)},"Printout.PrintWithoutUIEvent":function(e){var t=this,i=(e.getContentId(),e.getPrintParams()),n=e.getGeoJsonData();if(n&&(t.geoJson=n),!t.printout){var a=jQuery("#contentMap");t.printout=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.BasicPrintout",this,this.getLocalization("BasicView"),this.backendConfiguration),t.printout.render(a),t.printout.setEnabled(!1),t.printout.hide()}t.printout.printMap(i)},"Printout.PrintWithParcelUIEvent":function(e){var t=this,i=(e.getContentId(),e.getPrintParams()),n=e.getGeoJsonData(),a=e.getTableData();n&&(t.geoJson=n),a&&(t.tableJson=a),t.setPublishMode(!0),t.printout.modifyUIConfig4Parcel(i),t.printout.setLayoutParams(i)}},stop:function(){this.printout&&(this.printout.destroy(),this.printout=void 0),this.geoJson=null,this.tileData=null;var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);t.removeRequestHandler("printout.PrintMapRequest",this.printoutHandler),this.printoutHandler=null;var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.printout.Flyout",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},_createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi()},setPublishMode:function(e){var t,i,n,a=this,r=jQuery("#contentMap"),s=(jQuery("#maptools"),a.sandbox.findAllSelectedMapLayers());for(t=0;t<s.length;t+=1)if(i=s[t],"stats"===i.getLayerType()){n=a.sandbox.getRequestBuilder("StatsGrid.StatsGridRequest")(!1,i),a.sandbox.request(a.getName(),n);break}e?(r.addClass("mapPrintoutMode"),a.sandbox.mapMode="mapPrintoutMode",jQuery(a.plugins["Oskari.userinterface.Flyout"].container).parent().parent().css("display","none"),this.printout||(this.printout=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.BasicPrintout",this,this.getLocalization("BasicView"),this.backendConfiguration),this.printout.render(r)),this.state&&this.state.form&&this.printout.setState(this.state.form),this.printout.show(),this.printout.setEnabled(!0),this.printout.refresh(!1),this.printout.refresh(!0)):(r.removeClass("mapPrintoutMode"),"mapPrintoutMode"===a.sandbox._mapMode&&delete a.sandbox._mapMode,this.printout&&(jQuery(a.plugins["Oskari.userinterface.Flyout"].container).parent().parent().css("display",""),n=a.sandbox.getRequestBuilder("userinterface.UpdateExtensionRequest")(a,"close",a.getName()),a.sandbox.request(a.getName(),n),this.printout.setEnabled(!1),this.printout.hide(),this.printout&&this.legendPlugin.clearLegendLayers()))},sendCanceledEvent:function(e){var t=this,i=t.sandbox.getEventBuilder("Printout.PrintCanceledEvent");if(i){var n=i(e);t.sandbox.notifyAll(n)}},displayContent:function(e){e&&this.plugins["Oskari.userinterface.Flyout"].refresh()},setState:function(e){this.state=e},getState:function(){var e=this.state||{};if(this.printout){var t=this.printout.getState();e.form=t}return e}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension","Oskari.userinterface.Stateful"]}),define("bundles/framework/bundle/printout/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.view=null},{getName:function(){return"Oskari.mapframework.bundle.printout.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("printout")||jQuery(this.container).addClass("printout")},startPlugin:function(){this.template=jQuery("<div></div>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("flyouttitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){jQuery(this.container);this.view=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.StartView",this.instance,this.instance.getLocalization("StartView"))},refresh:function(){var e=jQuery(this.container);e.empty(),this.view.render(e)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/printout/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.printout.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/printout/Tile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.plugin.LegendPlugin",function(e,t,i){this.instance=e,this.sandbox=e.sandbox,this.mapModule=null,this.pluginName=null,this.conf=t,this.conf||(this.conf={}),this.locale=i,this.headerLayer=null,this.printAreaLayer=null,this.boxesLayer=null,this._map=null},{__name:"LegendPlugin",__qname:"Oskari.mapframework.bundle.printout.plugin.LegendPlugin",getQName:function(){return this.__qname},getName:function(){return this.pluginName},getMap:function(){return this._map},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this)},stopPlugin:function(e){e.unregister(this)},start:function(){},stop:function(){},init:function(){var e=new OpenLayers.StyleMap({"default":this.conf.printAreaDefault});this.printAreaLayer=new OpenLayers.Layer.Vector("PrintArea",{styleMap:e});var t=new OpenLayers.StyleMap({"default":this.conf.legendBoxDefault});this.headerLayer=new OpenLayers.Layer.Vector("LegendHeader",{styleMap:t});var i=new OpenLayers.StyleMap({"default":this.conf.colorBoxDefault});this.boxesLayer=new OpenLayers.Layer.Vector("LegendBoxes",{styleMap:i})},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},plotLegend:function(e,t,i,n){var a=this.getMapModule().getMap();-1===a.getLayerIndex(this.printAreaLayer)?(a.addLayer(this.printAreaLayer),a.setLayerIndex(this.printAreaLayer,10004)):a.raiseLayer(this.printAreaLayer,101),-1===a.getLayerIndex(this.headerLayer)?(a.addLayer(this.headerLayer),a.setLayerIndex(this.headerLayer,10005)):a.raiseLayer(this.headerLayer,102),a.getLayerIndex(-1===this.boxesLayer)?(a.addLayer(this.boxesLayer),a.setLayerIndex(this.boxesLayer,10006)):a.raiseLayer(this.boxesLayer,103),this.clearLegendLayers();var r=this._getLegendGeom(e,t,i,n);return this._plotLegendHeader(e,t,r),this._plotLegendBoxes(e,t,r),this._createPrintGeoJSON()},_maxLayerIndex:function(){var e,t=0,i=this.instance.getSandbox().findAllSelectedMapLayers();for(e=0;e<i.length;e++)this.getMapModule().getMap().getLayerIndex(i[e])>t&&(t=this.getMapModule().getMap().getLayerIndex(i[e]));return t},_getLegendGeom:function(e,t,i,n){var a,r=i.features[0].properties,s=(r.targetWidth,r.targetHeight,i.features[0].geometry.coordinates[0]),o=Number(s[1][0])-Number(s[0][0]),l=Number(s[2][1])-Number(s[1][1]),u=[];if(e.length>this.conf.general.charsInrow){var c=e.split(" "),d="";for(a=0;a<c.length;a++)d.length+c[a].length+1<this.conf.general.charsInrow?d=d+c[a]+" ":(u.push(d),d=c[a]);d.length>0&&u.push(d)}else u.push(e);var h=o;l>o&&(h=l);var p=this.conf.general.legendRowHeight*h*(t.length+u.length+1),f=this.conf.general.legendWidth*h,m=p/(t.length+u.length+1),g=[];"LL"===n?(g.push(new OpenLayers.Geometry.Point(s[0][0],s[0][1]+p)),g.push(new OpenLayers.Geometry.Point(s[0][0]+f,s[0][1]+p)),g.push(new OpenLayers.Geometry.Point(s[0][0]+f,s[0][1])),g.push(new OpenLayers.Geometry.Point(s[0][0],s[0][1]))):"LU"===n?(g.push(new OpenLayers.Geometry.Point(s[0][0],s[3][1])),g.push(new OpenLayers.Geometry.Point(s[0][0]+f,s[3][1])),g.push(new OpenLayers.Geometry.Point(s[0][0]+f,s[3][1]-p)),g.push(new OpenLayers.Geometry.Point(s[0][0],s[3][1]-p))):"RU"===n?(g.push(new OpenLayers.Geometry.Point(s[2][0]-f,s[2][1])),g.push(new OpenLayers.Geometry.Point(s[2][0],s[2][1])),g.push(new OpenLayers.Geometry.Point(s[2][0],s[2][1]-p)),g.push(new OpenLayers.Geometry.Point(s[2][0]-f,s[2][1]-p))):"RL"===n&&(g.push(new OpenLayers.Geometry.Point(s[1][0]-f,s[1][1]+p)),g.push(new OpenLayers.Geometry.Point(s[1][0],s[1][1]+p)),g.push(new OpenLayers.Geometry.Point(s[1][0],s[1][1])),g.push(new OpenLayers.Geometry.Point(s[1][0]-f,s[1][1])));var v,y=[];for(a=0;v=s[a++];)y.push(new OpenLayers.Geometry.Point(v[0],v[1]));var b={print_area:y,bbox:g,rangebox_size:m,properties:r,titles:u};return b},clearLegendLayers:function(){this.headerLayer&&this.headerLayer.removeAllFeatures(),this.boxesLayer&&this.boxesLayer.removeAllFeatures(),this.printAreaLayer&&this.printAreaLayer.removeAllFeatures()},_plotLegendHeader:function(e,t,i){var n=this,a=i.bbox,r=a,s=new OpenLayers.Geometry.LinearRing(r),o=new OpenLayers.Geometry.Polygon([s]),l="\x00",u={color:"#FFFFFF",name:l},c=new OpenLayers.Geometry.LineString(i.print_area),d=new OpenLayers.Feature.Vector(c,null);n.printAreaLayer.addFeatures([d]),n.printAreaLayer.redraw();var h=new OpenLayers.Feature.Vector(o,u);n.headerLayer.addFeatures([h]);var p,f=i.titles;for(p=0;p<f.length;p++){var m=a[0].clone(),g=new OpenLayers.Geometry.Point(m.x+.2*i.rangebox_size,m.y-(p*i.rangebox_size+i.rangebox_size/2)),v={name:f[p]},y=new OpenLayers.Feature.Vector(g,v);n.headerLayer.addFeatures([y])}n.headerLayer.redraw()},_plotLegendBoxes:function(e,t,i){var n,a=this,r="\x00",s=i.bbox,o=i.titles,l=i.rangebox_size,u=.8*i.rangebox_size,c=s[0].clone(),d=c.x+.2*l,h=c.y-l*o.length;for(n=0;n<t.length;n++){var p=t[n],f="#FFFFFF";p.boxcolor.split(":").length>1&&(f=p.boxcolor.split(":")[1].replace(/^\s+|\s+$/g,""));var m=d,g=h,v=[new OpenLayers.Geometry.Point(m,g),new OpenLayers.Geometry.Point(m+u,g),new OpenLayers.Geometry.Point(m+u,g-u),new OpenLayers.Geometry.Point(m,g-u)],y=new OpenLayers.Geometry.LinearRing(v),b=new OpenLayers.Geometry.Polygon([y]),k={color:f,name:r},_=new OpenLayers.Feature.Vector(b,k);a.boxesLayer.addFeatures([_]),c=new OpenLayers.Geometry.Point(m+l,g-u);var w={name:p.range},L=new OpenLayers.Feature.Vector(c,w);a.boxesLayer.addFeatures([L]),h-=l}a.boxesLayer.redraw()},_createPrintGeoJSON:function(){var e=new OpenLayers.Format.GeoJSON,t=[],i=JSON.parse(e.write(this.headerLayer.features)),n={type:"geojson",name:this.headerLayer.name,id:this.headerLayer.name,data:{type:"FeatureCollection",features:i.features},styles:[]};n.styles.push(this._getDefaultStyle(this.headerLayer.styleMap)),t.push(n);var a=JSON.parse(e.write(this.boxesLayer.features));return n={type:"geojson",name:this.boxesLayer.name,id:this.boxesLayer.name,data:{type:"FeatureCollection",features:a.features},styles:[]},n.styles.push(this._getDefaultStyle(this.boxesLayer.styleMap)),t.push(n),t},_getDefaultStyle:function(e){var t=e.styles["default"].defaultStyle,i=e.styles["default"].id,n={title:"Standard",name:i,styleMap:{"default":{}}};return n.styleMap["default"]=this._cleanStyle(t,["labelXOffset","labelYOffset"]),n},_cleanStyle:function(e,t){var i,n=jQuery.extend(!0,{},e);for(i=0;i<t.length;i++){var a=t[i];n[a]&&n[a].toString().indexOf("${delta")>-1&&delete n[a]}return n},protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/printout/plugin/LegendPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.service.PrintService",function(e){this.instance=e,this.sandbox=e.sandbox},{__name:"Printout.PrintService",__qname:"Oskari.mapframework.bundle.printout.service.PrintService",getQName:function(){return this.__qname},getName:function(){return this.__name},init:function(){},fetchPrintMapData:function(e,t,i){jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:e,success:function(e){t&&t(e)},error:function(e,t){i&&0!==e.status&&i(e,t)}})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/printout/service/PrintService",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.view.StartView",function(e,t){this.instance=e,this.template=jQuery("<div class='startview'><div class='content'></div><div class='buttons'></div></div>"),this.templateError=jQuery('<div class="error"><ul></ul></div>'),this.templateInfo=jQuery("<div class='icon-info'></div>"),this.loc=t,this.content=void 0,this.buttons={},this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert")},{_isTooManyLayers:function(){var e=this.instance.getSandbox().findAllSelectedMapLayers().length,t=e>7;return t},_isManyLayers:function(){var e=this.instance.getSandbox().findAllSelectedMapLayers().length,t=e>2;return t},render:function(e){var t=this,i=this.template.clone();this.content=i,e.append(i),this.alert.insertTo(e);var n=this._isTooManyLayers(),a=this._isManyLayers();if(n?this.alert.setContent(this.loc.info.maxLayers,"error"):a?this.alert.setContent(this.loc.info.printoutProcessingTime,"info"):this.alert.setContent(this.loc.text,"default"),!n){var r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.addClass("primary"),r.setTitle(this.loc.buttons["continue"]),r.setHandler(function(){t.instance.setPublishMode(!0)}),this.buttons["continue"]=r,r.insertTo(i.find("div.buttons"))}var s=Oskari.clazz.create("Oskari.userinterface.component.Button");n&&s.addClass("primary"),s.setTitle(this.loc.buttons.cancel),s.setHandler(function(){t.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[t.instance,"close"])}),this.buttons.cancel=s,s.insertTo(i.find("div.buttons"))}}),define("bundles/framework/bundle/printout/view/StartView",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.view.BasicPrintout",function(e,t,i){this.isEnabled=!1,this.instance=e,this.loc=t,this.backendConfiguration=i,this.legendInProcess=!1,this.isParcelMode=!1,this.template={};var n,a,r;for(n in this.__templates)this.__templates.hasOwnProperty(n)&&(this.template[n]=jQuery(this.__templates[n]));for(this.layoutParams={},this.sizeOptions=this.loc.size.options,this.sizeOptionsMap={},a=0;a<this.sizeOptions.length;a++)this.sizeOptionsMap[this.sizeOptions[a].id]=this.sizeOptions[a];for(this.formatOptions=this.loc.format.options,this.formatOptionsMap={},r=0;r<this.formatOptions.length;r++)this.formatOptionsMap[this.formatOptions[r].id]=this.formatOptions[r];for(this.contentOptions=this.loc.content.options,this.contentOptionsMap={},r=0;r<this.contentOptions.length;r++)this.contentOptionsMap[this.contentOptions[r].id]=this.contentOptions[r];for(this.legendOptions=this.loc.legend.options,this.legendOptionsMap={},r=0;r<this.legendOptions.length;r++)this.legendOptionsMap[this.legendOptions[r].id]=this.legendOptions[r];this.accordion=null,this.mainPanel=null,this.sizePanel=null,this.backBtn=null,this.progressSpinner=Oskari.clazz.create("Oskari.userinterface.component.ProgressSpinner"),this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert"),this.previewContent=null,this.previewImgDiv=null,this.contentOptionDivs={}},{__templates:{preview:'<div class="preview"><img /><span></span></div>',previewNotes:'<div class="previewNotes"><span></span></div>',location:'<div class="location"></div>',tool:'<div class="tool "><input type="checkbox"/><label></label></div>',buttons:'<div class="buttons"></div>',help:'<div class="help icon-info"></div>',main:'<div class="basic_printout"><div class="header"><div class="icon-close"></div><h3></h3></div><div class="content"></div><form method="post" target="map_popup_111" id="oskari_print_formID" style="display:none" action="" ><input name="geojson" type="hidden" value="" id="oskari_geojson"/><input name="tiles" type="hidden" value="" id="oskari_tiles"/><input name="tabledata" type="hidden" value="" id="oskari_print_tabledata"/></form></div>',format:'<div class="printout_format_cont printout_settings_cont"><div class="printout_format_label"></div></div>',formatOptionTool:'<div class="tool "><input type="radio" name="format" /><label></label></div>',legend:'<div class="printout_legend_cont printout_settings_cont"><div class="printout_legend_label"></div></div>',legendOptionTool:'<div class="tool "><input type="radio" name="legend" /><label></label></div>',title:'<div class="printout_title_cont printout_settings_cont"><div class="printout_title_label"></div><input class="printout_title_field" type="text"></div>',option:'<div class="printout_option_cont printout_settings_cont"><input type="checkbox" /><label></label></div>',sizeOptionTool:'<div class="tool "><input type="radio" name="size" /><label></label></div>'},render:function(e){var t=this,i=this.template.main.clone();this.mainPanel=i,i.find("div.header h3").append(this.loc.title),e.append(i);var n=i.find("div.content");this.alert.insertTo(n);var a=Oskari.clazz.create("Oskari.userinterface.component.Accordion");this.accordion=a,this.sizePanel=this._createSizePanel(),this.sizePanel.open(),a.addPanel(this.sizePanel);var r=this._createSettingsPanel();a.addPanel(r);var s=this._createPreviewPanel();s.open(),a.addPanel(s),a.insertTo(n),this._setLegendVisibility(),e.find("div.header div.icon-close").bind("click",function(){t.instance.setPublishMode(!1)}),n.append(this._getButtons());var o=this.mainPanel.find("input[type=text]");o.focus(function(){t.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest")}),o.blur(function(){t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var l=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",this.instance.sandbox);l.processHelpLinks(this.loc.help,i,this.loc.error.title,this.loc.error.nohelp)},_createSizePanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");
t.setTitle(this.loc.size.label);var i,n=t.getContainer(),a=this.template.help.clone();a.attr("title",this.loc.size.tooltip),n.append(a);var r=function(t){return function(){{var i;n.find("input[name=size]:checked").val()}for(i=0;i<e.sizeOptions.length;++i)e.sizeOptions[i].selected=!1;t.selected=!0,e._cleanMapPreview(),e._updateMapPreview(),e._createLegend()}};for(i=0;i<this.sizeOptions.length;++i){var s=this.sizeOptions[i],o=this.template.sizeOptionTool.clone(),l=s.label;s.width&&s.height&&(l=l+" ("+s.width+" x "+s.height+"px)"),o.find("label").append(l).attr({"for":s.id,"class":"printout_radiolabel"}),s.selected&&o.find("input").attr("checked","checked"),n.append(o),o.find("input").attr({value:s.id,name:"size",id:s.id}),o.find("input").change(r(s))}return t},_createSettingsPanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.settings.label);var i=t.getContainer(),n=this.template.help.clone();n.attr("title",this.loc.settings.tooltip),i.append(n);var a,r,s,o,l,u=function(t){return function(){{var n;i.find("input[name=format]:checked").val()}for(n=0;n<e.formatOptions.length;++n)e.formatOptions[n].selected=!1;t.selected=!0}},c=this.template.format.clone();for(c.find(".printout_format_label").html(this.loc.format.label),a=0;a<this.formatOptions.length;++a)s=this.formatOptions[a],o=this.template.formatOptionTool.clone(),l=s.label,o.find("label").append(l).attr({"for":s.id,"class":"printout_radiolabel"}),s.selected&&o.find("input").attr("checked","checked"),c.append(o),o.find("input").attr({value:s.format,name:"format",id:s.id}),o.find("input").change(u(s));i.append(c);var d=this.template.title.clone();for(d.find(".printout_title_label").html(this.loc.mapTitle.label),d.find(".printout_title_field").attr({value:"",placeholder:this.loc.mapTitle.label}),i.append(d),r=0;r<this.contentOptions.length;r++){var h=this.contentOptions[r],p=this.template.option.clone();p.find("input").attr({id:h.id,checked:h.checked}),p.find("label").html(h.label).attr({"for":h.id,"class":"printout_checklabel"}),this.contentOptionDivs[h.id]=p,i.append(p)}var f=function(t){return function(){{var n;i.find("input[name=legend]:checked").val()}for(n=0;n<e.legendOptions.length;++n)e.legendOptions[n].selected=!1;t.selected=!0}},m=this.template.legend.clone();for(m.find(".printout_legend_label").html(this.loc.legend.label),a=0;a<this.legendOptions.length;++a)s=this.legendOptions[a],o=this.template.legendOptionTool.clone(),l=s.label,o.find("label").append(l).attr({"for":s.id,"class":"printout_radiolabel"}),s.selected&&o.find("input").attr("checked","checked"),m.append(o),o.find("input").attr({value:s.loca,name:"location",id:s.id}),o.find("input").change(f(s)),o.find('input[name="location"]').click(function(){e._createLegend()});return i.append(m),t},_createPreviewPanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.preview.label);var i=t.getContainer(),n=this.template.help.clone();n.attr("title",this.loc.preview.tooltip),i.append(n);var a=this.template.preview.clone();i.append(a),e.progressSpinner.insertTo(a);var r=a.find("img");r.click(function(){e.showFullScaleMapPreview()});var s=a.find("span");this.previewContent=a,this.previewImgDiv=r,this.previewSpan=s;var o;for(o in this.loc.preview.notes)if(this.loc.preview.notes.hasOwnProperty(o)){var l=this.template.previewNotes.clone();l.find("span").text(this.loc.preview.notes[o]),i.append(l)}return t},_createLocationAndScalePanel:function(){var e=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");e.setTitle(this.loc.location.label);var t=e.getContainer(),i=this.template.help.clone();i.attr("title",this.loc.location.tooltip),t.append(i);var n=this.template.location.clone();return t.append(n),e},_cleanMapPreview:function(){var e=this.loc,t=this.previewImgDiv,i=this.previewSpan;t.hide(),i.text(e.preview.pending)},_updateMapPreview:function(){var e=this,t=this._gatherSelections("image/png"),i=this.backendConfiguration.formatProducers[t.format],n=t.maplinkArgs,a="&pageSize="+t.pageSize,r="&scaledWidth=200",s=i+n+a+r;this.previewContent.removeClass("preview-portrait"),this.previewContent.removeClass("preview-landscape"),this.previewContent.addClass(this.sizeOptionsMap[t.pageSize].classForPreview);var o=this.previewImgDiv,l=this.previewSpan;e.progressSpinner.start(),window.setTimeout(function(){o.imagesLoaded(function(){l.text(""),o.fadeIn("slow",function(){e.progressSpinner.stop()})}),o.attr("src",s)},100)},showFullScaleMapPreview:function(){var e=this._gatherSelections("image/png"),t=this.backendConfiguration.formatProducers[e.format],i=e.maplinkArgs,n="&pageSize="+e.pageSize,a=t+i+n;this.openURLinWindow(a,e)},_getButtons:function(){var e=this,t=this.template.buttons.clone(),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(this.loc.buttons.cancel),i.setHandler(function(){e.instance.setPublishMode(!1),e.instance.sendCanceledEvent("cancel")}),i.insertTo(t),e.backBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),e.backBtn.setTitle(this.loc.buttons.back),e.backBtn.setHandler(function(){e.instance.setPublishMode(!1),e.instance.sendCanceledEvent("previous")}),e.backBtn.insertTo(t),e.backBtn.hide();var n=Oskari.clazz.create("Oskari.userinterface.component.Button");return n.setTitle(this.loc.buttons.save),n.addClass("primary"),n.setHandler(function(){var t=e.instance.sandbox.getMap(),i=void 0===t.geojs||null===t.geojs?null:t.geojs,n=e._gatherSelections();n&&e._printMap(n,i)}),n.insertTo(t),t},_gatherSelections:function(e){var t,i=this.mainPanel,n=this.instance.getSandbox(),a=i.find("input[name=size]:checked").val(),r=null!==e&&void 0!==e?e:i.find("input[name=format]:checked").val(),s=i.find(".printout_title_field").val(),o=n.generateMapLinkParameters(),l={pageTitle:s,pageSize:a,maplinkArgs:o,format:r||"application/pdf"};for(t in this.contentOptionsMap)this.contentOptionsMap.hasOwnProperty(t)&&(l[t]=this.contentOptionDivs[t].find("input").prop("checked"));return l},openURLinWindow:function(e,t){var i="location=1,status=1,scrollbars=1,width=850,height=1200";this._isLandscape(t)&&(i="location=1,status=1,scrollbars=1,width=1200,height=850");var n=e;window.open(n,"BasicPrintout",i)},openPostURLinWindow:function(e,t,i,n,a){var r=this,s="location=1,status=1,scrollbars=1,width=850,height=1200";this._isLandscape(a)&&(s="location=1,status=1,scrollbars=1,width=1200,height=850");var o=n;if(r.mainPanel.find("#oskari_print_formID").attr("action",o),e){var l=unescape(encodeURIComponent(e));r.mainPanel.find("input[name=geojson]").val(jQuery.base64.encode(l))}t&&r.mainPanel.find("input[name=tiles]").val(t),i&&r.mainPanel.find("input[name=tabledata]").val(i),r.isParcelMode||window.open("about:blank","map_popup_111",s),r.mainPanel.find("#oskari_print_formID").submit()},printMap:function(e){var t=this;t._printMap(e,null)},_printMap:function(e){var t=this,i=this.instance.getSandbox(),n=i.getAjaxUrl(),a=(this.backendConfiguration.formatProducers[e.format],e.maplinkArgs),r="&pageSize="+e.pageSize,s="&pageTitle="+encodeURIComponent(e.pageTitle),o="";e.saveFile&&(o="&saveFile="+e.saveFile);var l,u=t._getLayoutParams(e.pageSize),c=[];for(l in this.contentOptionsMap)this.contentOptionsMap.hasOwnProperty(l)&&e[l]&&c.push("&"+l+"=true");var d=c.join(""),h="&format="+e.format,p=a+"&action_route=GetPreview"+r+s+d+h+o+u;if(n+=p,this.instance.geoJson||!jQuery.isEmptyObject(this.instance.tileData)||this.instance.tableJson){var f=this._stringifyGeoJson(this.instance.geoJson),m=this._stringifyTileData(this.instance.tileData),g=this._stringifyTableData(this.instance.tableJson);this.instance.getSandbox().printDebug("PRINT POST URL "+n),this.openPostURLinWindow(f,m,g,n,e)}else this.instance.getSandbox().printDebug("PRINT URL "+n),this.openURLinWindow(n,e)},modifyUIConfig4Parcel:function(e){var t=this,i=t.mainPanel;t.isParcelMode=!0,i.find("div.header h3").empty(),i.find("div.header h3").append(t.loc.title+" (3/3)"),i.find(".printout_title_field").attr("value",e.pageTitle),t.sizePanel&&t.sizePanel.close(),i.find("div.accordion_panel").first().next().hide(),t.backBtn.show()},setLayoutParams:function(e){var t=this;t.layoutParams=e},_getLayoutParams:function(e){var t="",i=this._getPageMapRectInd(e);return this.layoutParams.pageTemplate&&(t="&pageTemplate="+this.layoutParams.pageTemplate+"_"+e+".pdf"),this.layoutParams.pageMapRect&&i<this.layoutParams.pageMapRect.length&&(t=t+"&pageMapRect="+this.layoutParams.pageMapRect[i]),this.layoutParams.tableTemplate&&(t=t+"&tableTemplate="+this.layoutParams.tableTemplate+"_"+e),t},_isLandscape:function(e){var t=!1;return this.sizeOptionsMap[e.pageSize].id.indexOf("Land")>-1&&(t=!0),t},_stringifyGeoJson:function(e){var t=null;return e&&(t=JSON.stringify(e).replace('"','"')),t},_stringifyTileData:function(e){if(!jQuery.isEmptyObject(e)){var t,i,n=[];for(i in e)e.hasOwnProperty(i)&&n.push(e[i]);return t=[].concat.apply([],n),JSON.stringify(t)}return null},_stringifyTableData:function(e){return jQuery.isEmptyObject(e)?null:JSON.stringify(e)},_setLegendVisibility:function(){var e=this.mainPanel;this._hasStatsLayers()?e.find(".printout_legend_cont").show():e.find(".printout_legend_cont").hide()},_hasStatsLayers:function(){var e,t=this.instance.getSandbox().findAllSelectedMapLayers();for(e=0;e<t.length;e++)if(t[e].isLayerOfType("STATS")&&t[e].isVisible())return!0;return!1},_createLegend:function(){var e=this;if(e._setLegendVisibility(),e._hasStatsLayers()){var t=(this.instance.sandbox.getMap(),this.mainPanel),i=jQuery("#contentMap"),n=t.find("input[name=location]:checked").val();if("NO"===n)e.instance.getSandbox().getMap().GeoJSON&&(e.instance.getSandbox().getMap().GeoJSON=null),e.instance.legendPlugin.clearLegendLayers();else{var a=i.find("div.geostats-legend");if(a.length>0){if(e.legendInProcess)return;e.legendInProcess=!0,this._printMapInfo(a,function(t){var i=a.find(".geostats-legend-title").html(),r=[];a.find("div").each(function(){var e=jQuery(this).attr("class");if(void 0===e||null===e){var t={boxcolor:jQuery(this).find(".geostats-legend-block").attr("style"),range:jQuery(this).text()};r.push(t)}});var s=e.instance.legendPlugin.plotLegend(i,r,t,n);e.instance.geoJson=s,e.legendInProcess=!1})}}}},_getPageMapRectInd:function(e){var t=0;return"A4_Landscape"===e&&(t=1),"A3"===e&&(t=2),"A3_Landscape"===e&&(t=3),t},_printMapInfo:function(e,t){var i,n=this,a=n._gatherSelections(),r=this.instance.getSandbox(),s=r.getAjaxUrl(),o=(this.backendConfiguration.formatProducers[a.format],a.maplinkArgs),l="&pageSize="+a.pageSize,u="&pageTitle="+encodeURIComponent(a.pageTitle),c=[];for(i in this.contentOptionsMap)this.contentOptionsMap.hasOwnProperty(i)&&a[i]&&c.push("&"+i+"=true");var d=c.join(""),h="&format="+a.format,p=o+"&action_route=GetProxyRequest&serviceId=print"+l+u+d+h;s+=p,n.instance.printService.fetchPrintMapData(s,function(e){e?t(e):alert("Error to fetch print info: ")},function(){alert("Error to fetch print info: ")})},destroy:function(){this.mainPanel.remove()},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},setEnabled:function(e){this.isEnabled=e},getEnabled:function(){return this.isEnabled},refresh:function(e){e?this._updateMapPreview():this._cleanMapPreview(),this._createLegend()},getState:function(){return this._gatherSelections()},setState:function(){}}),define("bundles/framework/bundle/printout/view/BasicPrintout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.request.PrintMapRequest",function(e){this._creator=null,this._selections=e},{__name:"printout.PrintMapRequest",getName:function(){return this.__name},getSelections:function(){return this._selections}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/printout/request/PrintMapRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler",function(e,t){this.sandbox=e,this.cb=t},{handleRequest:function(e,t){var i=t.getSelections();this.sandbox.printDebug("[Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler] printout requested"),this.cb(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/printout/request/PrintMapRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintableContentEvent",function(e,t,i,n){this._contentId=e,this._layer=t,this._tileData=i,this._geojsonData=n},{getName:function(){return"Printout.PrintableContentEvent"},getContentId:function(){return this._contentId},getLayer:function(){return this._layer},setLayer:function(e){this._layer=e},getTileData:function(){return this._tileData},setTileData:function(e){this._tileData=e},getGeoJsonData:function(){return this._geojsonData},setGeoJsonData:function(e){this._geojsonData=e}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/printout/event/PrintableContentEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintWithoutUIEvent",function(e,t,i){this._contentId=e,this._printParams=t,this._geojsonData=i},{getName:function(){return"Printout.PrintWithoutUIEvent"},getContentId:function(){return this._contentId},getPrintParams:function(){return this._printParams},getGeoJsonData:function(){return this._geojsonData}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/printout/event/PrintWithoutUIEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintWithParcelUIEvent",function(e,t,i,n){this._contentId=e,this._printParams=t,this._geojsonData=i,this._tableData=n},{getName:function(){return"Printout.PrintWithParcelUIEvent"},getContentId:function(){return this._contentId},getPrintParams:function(){return this._printParams},getGeoJsonData:function(){return this._geojsonData},getTableData:function(){return this._tableData}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/printout/event/PrintWithParcelUIEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintCanceledEvent",function(e){this._state=e},{getName:function(){return"Printout.PrintCanceledEvent"},getState:function(){return this._state}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/printout/event/PrintCanceledEvent",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/printout/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"hy",key:"Printout",value:{title:"Տպել դիտվող քարտեզը",flyouttitle:"Տպել դիտվող քարտեզը",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Տպել դիտվող քարտեզը",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Չափ",tooltip:"Ընտրել տպվող չափը/քարտեզի նախադիտումը համապատասխանաբար թարմացվում է",options:[{id:"A4",label:"A4 ուղղահայաց",classForPreview:"Ուղղահայաց նախադիտում",selected:"Ճիշտ է"},{id:"A4 հորիզոնական",label:"A4 հորիզոնական",classForPreview:"Հորիզոնական նախադիտում"},{id:"A3",label:"A3 ուղղահայաց",classForPreview:"Ուղղահայաց նախադիտում"},{id:"A3 հորիզոնական",label:"A3 հորիզոնական",classForPreview:"Հորիզոնական նախադիտում"}]},preview:{label:"Նախադիտում",tooltip:"Սեղմել նախադիտման փոքր պատուհանը բացելու համար նախադիտման մեծ պատուհանը",pending:"Նախադիտումը արագ թարմացվում է",notes:{extent:"Նախադիտումը կարող է օգտագործվել տպելու ժամանակ քարտեզի չափերը նշելու համար",restriction:"Քարտեզի ոչ բոլոր շերտերն են ցուցադրված նախադիտման մեջ"}},buttons:{save:"Տպել",ok:"OK",back:"NOT TRANSLATED",cancel:"Դադարեցնել"},location:{label:"Տեղանքը և մեծացման մակարդակը",tooltip:"Տպման մասշտաբը համապատասխանում է բրաուզերում քարտեզի մասշտաբին",zoomlevel:"Մեծացման մակարդակ"},settings:{label:"Նոր պարամետրեր",tooltip:"Ավելացնել հավելյալ պարամետրեր, ինչպես օրինակ ձևաչափ, վերնագիր և մասշտաբ"},format:{label:"Ձևաչափ",tooltip:"Ընտրել ֆայլի ձևաչափը",options:[{id:"png",format:"Պատկեր/png",label:"PNG պատկեր"},{id:"pdf",format:"Կիրառում/pdf",selected:"Ճիշտ է",label:"PDF փաստաթուղթ"}]},mapTitle:{label:"Ավելացնել վերնագիր",tooltip:"Ավելացնել վերնագիր քարտեզի համար"},content:{options:[{id:"Էջի պատկերանիշ",label:"Ավելացնել OSKARI պատկերանիշ",tooltip:"Անհրաժեշտության դեպքում հնարավոր է թաքցնել պատկերանիշը",checked:"Ստուգված"},{id:"Էջի մասշտաբ",label:"Քարտեզին ավելացնել մասշտաբ",tooltip:"Քարտեզին ավելացնել մասշտաբ",checked:"Ստուգված"},{id:"Էջի տվյալներ",label:"Ավելացնել տվյալներ",tooltip:"Տպման ժամանակ ամսաթիվ ավելացնելու հնարավորություն",checked:"Ստուգված"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Օգնություն",error:{title:"Սխալ",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Օգնությունը հասանելի չէ",saveFailed:"Քարտեզի տպումը ձախողված է/կրկին փորձեք",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Հնարավոր է տպել հենց նոր ձեր կողմից ստեղծված քարտեզը",info:{maxLayers:"Հնարավոր է տպել մինչև 8 շերտ միաժամանակ",printoutProcessingTime:"Բազմակի շերտերի ընտրության դեպքում տպելու գործընթացը կարող է որոշ ժամանակ տևել"},buttons:{"continue":"Շարունակել",cancel:"Դադարեցնել"}}}}),define("bundles/framework/bundle/printout/locale/hy",function(){}),Oskari.registerLocalization({lang:"bg",key:"Printout",value:{title:"Принтиране изгледа на картата",flyouttitle:"Принтиране изгледа на картата",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Принтиране изгледа на картата",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Размер",tooltip:"Избиране оформлението при принтиране / Съответно се актуализира прегледа на картата",options:[{id:"А4",label:"А4 вертикално",classForPreview:"Преглед на вертикален изглед",selected:"Вярно"},{id:"А4 хоризонтално",label:"А4 хоризонтално",classForPreview:"Преглед на хоризонтален изглед"},{id:"А3",label:"А3 вертикално",classForPreview:"Преглед на вертикален изглед"},{id:"А3 хоризонтално",label:"А3 хоризонтално",classForPreview:"Преглед на хоризонтален изглед"}]},preview:{label:"Преглед",tooltip:"Щракнете на малкия преглед, за да отворите по - голям преглед",pending:"Прегледът ще бъде актуализиран скоро",notes:{extent:"Прегледът може да бъде използван за решаване размера на картата при принтиране",restriction:"Не всички картни слоеве са показани в прегледа"}},buttons:{save:"Принтиране",ok:"ОК",back:"NOT TRANSLATED",cancel:"Отказ / Отмяна"},location:{label:"Местоположение и мащаб",tooltip:"Мащабът при принтиране да съответства на мащаба на картата в браузъра",zoomlevel:"Мащаб"},settings:{label:"Повече настройки",tooltip:"Направете допълнителни настройки, като формат, заглавие и мащаб"},format:{label:"Формат",tooltip:"Изберете формат",options:[{id:"png",format:"NOT TRANSLATED",label:"NOT TRANSLATED"},{id:"NOT TRANSLATED",format:"NOT TRANSLATED",selected:"Вярно",label:"PDF документ"}]},mapTitle:{label:"Добавяне на заглавие",tooltip:"Добавяне заглавие на картата"},content:{options:[{id:"Лого на страницата",label:"Добавяне логото на Oskari",tooltip:"Може да скриете логото, ако е необходимо",checked:"Проверено"},{id:"Мащаб на страницата",label:"Добавяне мащаб на картата",tooltip:"Добавяне мащаб на картата",checked:"Проверено"},{id:"Дата на страницата",label:"Добавете дата",tooltip:"Може да добавите дата при принтиране",checked:"проверено"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Помощ",error:{title:"Грешка",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Помощта не е на разположение",saveFailed:"Принтирането на картата е неуспешно| Опитайте по - късно",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Може да принтирате изгледа на картата, който току що създадохте",info:{maxLayers:"Може да принтирате максимум 8 слоя наведнъж",printoutProcessingTime:"Процесът на принтиране отнема известно време, когато са избрани много слоеве"},buttons:{"continue":"Продължаване",cancel:"Отказ"}}}}),define("bundles/framework/bundle/printout/locale/bg",function(){}),Oskari.registerLocalization({lang:"cs",key:"Printout",value:{title:"Tisknout zobrazení mapy",flyouttitle:"Tisknout zobrazení mapy",desc:"",btnTooltip:"Tisk",BasicView:{title:"Tisknout zobrazení mapy",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Jazyk",options:{fi:"finština",sv:"švédština",en:"angličtina",de:"němčina",es:"španělština",cs:"čeština"},tooltip:"Select the language of the map interface and map data."},size:{label:"Velikost",tooltip:"Vyberte rozložení tisku| Současně je aktualizován náhled mapy.",options:[{id:"A4",label:"A4 na výšku",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 na šířku",classForPreview:"preview-landscape"},{id:"A3",label:"A3 na výšku",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 na šířku",classForPreview:"preview-landscape"}]},preview:{label:"Náhled",tooltip:"Klikněte na malý náhled pro zvětšení",pending:"Náhled bude rychle aktualizován",notes:{extent:"Náhled lze použít pro výpočet rozsahu mapy výtisku",restriction:"V náhledu nejsou zobrazeny všechny mapové vrstvy"}},buttons:{save:"Získat výtisk",ok:"OK",back:"NOT TRANSLATED",cancel:"Storno"},location:{label:"Umístění a úroveň přiblížení",tooltip:"Měřítko výtisku odpovídá měřítku mapy v prohlížeči.",zoomlevel:"Úroveň přiblížení"},settings:{label:"Více nastavení",tooltip:"Provést dodatečná nastavení jako formát, titul a měřítko"},format:{label:"Format",tooltip:"Vyberte formát souboru",options:[{id:"png",format:"image/png",label:"Obrázek PNG"},{id:"pdf",format:"application/pdf",selected:!0,label:"Dokument PDF"}]},mapTitle:{label:"Vložit název",tooltip:"vložit název mapy"},content:{options:[{id:"pageLogo",label:"Přidat logo Paikkatietoikkuna",tooltip:"Je-li to nezbytné, lze logo skrýt",checked:"checked"},{id:"pageScale",label:"Vložit do mapy měřítko",tooltip:"Vložit do mapy měřítko",checked:"checked"},{id:"pageDate",label:"Vložit datum",tooltip:"Do výtisku lze vložit datum",checked:"checked"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Nápověda",error:{title:"Chyba",size:"Error in size definitions",name:"Name is required information",nohelp:"Nápověda není dostupná",saveFailed:"Tisk mapy selhal. Zkuste to později.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens."}},StartView:{text:"Zobrazení mapy, které jste právě vytvořili, lze vytisknout.",info:{maxLayers:"Najednou lze vytisknout maximálně 8 vrstev.",printoutProcessingTime:"Pokud je vybrán soutisk více vrstev, tisk trvá déle."},buttons:{"continue":"Pokračuj",cancel:"Storno"}}}}),define("bundles/framework/bundle/printout/locale/cs",function(){}),Oskari.registerLocalization({lang:"da",key:"Printout",value:{title:"Udskriv kortvisning",flyouttitle:"Udskriv kortvisning",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Udskriv kortvisning",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Størrelse",tooltip:"Vælg udskriftslayout │Forhåndsvisning af kort opdateres i overensstemmelse hermed",options:[{id:"A4",label:"A4 portræt",classForPreview:"forhåndsvisning af portræt",selected:"Filename"},{id:"A4_Landscape",label:"A4 landskab",classForPreview:"forhåndsvisning af landskab"},{id:"A3",label:"A3 portræt",classForPreview:"forhåndsvisning af portræt"},{id:"A3_Landscape",label:"A3 landskab",classForPreview:"forhåndsvisning af landskab"}]},preview:{label:"Forhåndsvisning",tooltip:"Klik på den lille forhåndsvisning for at åbne en større forhåndsvisning",pending:"Forhåndsvisning opdateres inden længe",notes:{extent:"Forhåndsvisning kan bruges til at bedømme kortstørrelsen til udskrift",restriction:"Ikke alle kortlag vises i forhåndsvisning"}},buttons:{save:"Foretag udskrift",ok:"OK",back:"NOT TRANSLATED",cancel:"Annullér"},location:{label:"Placering og zoomniveau",tooltip:"Udskriftsskalering svarer til skaleringen af kortet i browseren",zoomlevel:"Zoomniveau"},settings:{label:"Flere indstillinger",tooltip:"Foretag yderligere indstillinger såsom format, titel og skalering"},format:{label:"Format",tooltip:"Vælg filformat",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:"Filename",label:"PDF document"}]},mapTitle:{label:"Tilføj titel",tooltip:"tilføj en titel til kortet"},content:{options:[{id:"sideLogo",label:"Tilføj Oskari logo",tooltip:"Det er muligt at skjule logoet om nødvendigt",checked:"afkrydset"},{id:"sideSkalering",label:"Tilføj skalering til kortet",tooltip:"Tilføj skalering til kortet",checked:"afkrydset"},{id:"sideDato",label:"Tilføj dato",tooltip:"Du kan tilføje dato på udskriften",checked:"afkrydset"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Hjælp",error:{title:"Fejl",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Ingen hjælp tilgængelig",saveFailed:"Kortudskrift mislykket│Prøv igen senere",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Du kan udskrive den kortvisning, du lige har lavet",info:{maxLayers:"Du kan maksimalt udskrive 8 lag på én gang",printoutProcessingTime:"Udskrivning tager lægere tid når der er valgt flere lag"},buttons:{"continue":"Fortsæt",cancel:"Annullér"}}}}),define("bundles/framework/bundle/printout/locale/da",function(){}),Oskari.registerLocalization({lang:"de",key:"Printout",value:{title:"Kartenansicht drucken",flyouttitle:"Kartenansicht drucken",desc:"",btnTooltip:"Drucken",BasicView:{title:"Kartenansicht drucken",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Sprache",options:{fi:"Finnisch",sv:"Schwedisch",en:"Englisch",de:"Deutsch",es:"Spanisch",cs:"Tschechisch"},tooltip:"Select the language of the map interface and map data."},size:{label:"Größe",tooltip:"Wählen Sie das Druck-Layout. Die Vorschau wird entsprechend aktualisiert.",options:[{id:"A4",label:"A4 Hochformat",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 Querformat",classForPreview:"preview-landscape"},{id:"A3",label:"A3 Hochformat",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 Querformat",classForPreview:"preview-landscape"}]},preview:{label:"Vorschau",tooltip:"Klicken Sie auf die Vorschau, um eine vergrößerte Ansicht zu erhalten.",pending:"Die Vorschau wird in Kürze aktualisiert",notes:{extent:"Die Vorschau kann verwendet werden, um die Größe des Druckbereichs festzustellen.",restriction:"Es werden nicht alle Kartenebenen in der Vorschau angezeigt."}},buttons:{save:"Ausdruck erstellen",ok:"OK",back:"NOT TRANSLATED",cancel:"Abbrechen"},location:{label:"Ort und Zoomstufe",tooltip:"Der Maßstab des Ausdrucks entspricht dem der Karte im Browser.",zoomlevel:"Zoomstufe"},settings:{label:"Weitere Einstellungen",tooltip:"Geben Sie weitere Einstellungen ein: Format, Titel und Maßstab"},format:{label:"Format",tooltip:"Dateiformat auswählen",options:[{id:"png",format:"image/png",label:"PNG-Bild"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF-Dokument"}]},mapTitle:{label:"Titel hinzufügen",tooltip:"Fügen Sie der Karte einen Titel hinzu"},content:{options:[{id:"pageLogo",label:"Paikkatietoikkuna-Logo hinzufügen",tooltip:"Sie können das Logo bei Bedarf verbergen",checked:"checked"},{id:"pageScale",label:"Maßstab zur Karte hinzufügen",tooltip:"Maßstab zur Karte hinzufügen",checked:"checked"},{id:"pageDate",label:"Datum hinzufügen",tooltip:"Sie können dem Ausdruck ein Datum hinzufügen",checked:"checked"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Hilfe",error:{title:"Fehler",size:"Error in size definitions",name:"Name is required information",nohelp:"Keine Hilfe verfügbar",saveFailed:"Ausdrucken der Karte fehlgeschlagen. Bitte versuchen Sie es später noch mal.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens."}},StartView:{text:"Sie können die gerade von Ihnen erzeugte Kartenansicht ausdrucken.",info:{maxLayers:"Sie können maximal 8 Kartenebenen gleichzeitg drucken.",printoutProcessingTime:"Das Ausdrucken nimmt etwas mehr Zeit in Anspruch, wenn mehrere Kartenebenen ausgewählt sind."},buttons:{"continue":"Weiter",cancel:"Abbrechen"}}}}),define("bundles/framework/bundle/printout/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"Printout",value:{title:"Print the Map view",flyouttitle:"Print the Map view",desc:"",btnTooltip:"Print",BasicView:{title:"Print the Map view",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Language",options:{fi:"Finnish",sv:"Swedish",en:"English"},tooltip:"Select the language to be used in the print. Please note the language of the the user interface and the data set."},size:{label:"Size",tooltip:"Choose the print size. Updates are shown in the preview image.",options:[{id:"A4",label:"A4 portrait",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portrait",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"Preview",tooltip:"You can largen the preview image by clicking it.",pending:"Preview will be updated shortly.",notes:{extent:"You can check the map extent for the printout in the preview image.",restriction:"Not all map layers are shown in the preview."}},buttons:{save:"Get Printout",ok:"OK",back:"Previous",cancel:"Cancel"},location:{label:"Location and zoom level",tooltip:"Printout scale matches the scale of the map in browser.",zoomlevel:"Printout scale"},settings:{label:"More settings",tooltip:"Choose a file format, a title, a scale and a date for the map printout."},format:{label:"File format",tooltip:"Select the file format",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF document"}]},mapTitle:{label:"Map Title",tooltip:"Add a title for the map."},content:{options:[{id:"pageLogo",label:"Show Finnish geoportal Paikkatietoikkuna's logo in the printout.",tooltip:"You can hide Finnish geoportal Paikkatietoikkuna's logo if necessary.",checked:"checked"},{id:"pageScale",label:"Add a scale to the map printout.",tooltip:"Add a scale to the map, if you want.",checked:"checked"},{id:"pageDate",label:"Show a date in the map printout.",tooltip:"You can add a date to the printout.",checked:"checked"}]},legend:{label:"Map legend",tooltip:"Select a position for the map legend. If any position is not selected, a map legend is not shown in the map printout.",options:[{id:"oskari_legend_NO",loca:"NO",label:"No map legend",tooltip:"The map legend is not shown in the map printout.",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner",tooltip:"The map legend is shown in the left lower corner of the printout."},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner",tooltip:"The map legend is shown in the left upper corner of the printout."},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner",tooltip:"The map legend is shown in the right upper corner of the printout."},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner",tooltip:"The map legend is shown in the right upper corner of the printout."}]},help:"Help",error:{title:"Error",size:"Error in size definitions",name:"Name is required information",nohelp:"There is no help available.",saveFailed:"Printing the map view not succeeded. Please try again later.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens."}},StartView:{text:"You can print out the Map view you just created as a PNG image or a PDF file.",info:{maxLayers:"You can use at most eight map layers in the printout.",printoutProcessingTime:"Printing out the map view may take some time when multiple layers are selected."},buttons:{"continue":"Continue",cancel:"Cancel"}}}}),define("bundles/framework/bundle/printout/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"Printout",value:{title:"Imprimir vista",flyouttitle:"Imprimir vista",desc:"",btnTooltip:"Imprimir",BasicView:{title:"Imprimir vista",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Tamaño",tooltip:"Seleccione el modelo de impresión| La previsualización del mapa está actualizada correctamente",options:[{id:"A4",label:"A4 vertical",classForPreview:"Previsualización vertical",selected:"verdadero"},{id:"A4_Landscape",label:"A4 apaisado",classForPreview:"Previsualización apaisada"},{id:"A3",label:"A3 vertical",classForPreview:"Previsualización vertical"},{id:"A3_Landscape",label:"A3 apaisado",classForPreview:"Previsualización apaisada"}]},preview:{label:"Previsualización",tooltip:"Pulse la previsualización pequeña para abrir una agrandada",pending:"La previsualización se actualizará en breve",notes:{extent:"La previsualización puede usarse para calcular la extensión del mapa para la impresión",restriction:"No se muestran todas las capas en la previsualización"}},buttons:{save:"Imprimir",ok:"Hecho",back:"NOT TRANSLATED",cancel:"Cancelar"},location:{label:"Localización y nivel de zoom",tooltip:"La escala de impresión coincide con la escala del mapa en el navegador",zoomlevel:"Nivel de zoom"},settings:{label:"Más configuraciones",tooltip:"Realizar configuraciones adicionales como el formato, el título y la escala"},format:{label:"Formato",tooltip:"Seleccionar el formato del fichero",options:[{id:"png",format:"image/png",label:"Imagen PNG"},{id:"pdf",format:"application/pdf",selected:"verdadero",label:"documento PDF"}]},mapTitle:{label:"Añadir título",tooltip:"añadir un título para el mapa"},content:{options:[{id:"pageLogo",label:"Añadir el logo de Oskari",tooltip:"Si es necesario, puede ocultar el logo",checked:"comprobado"},{id:"pageScale",label:"Añadir la escala al mapa",tooltip:"Añadir la escala al mapa",checked:"comprobado"},{id:"pageDate",label:"Añadir fecha",tooltip:"Puede añadir la fecha a la impresión",checked:"comprobado"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Ayuda",error:{title:"Error",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"No hay ayuda disponible",saveFailed:"La impresión del mapa ha fallado | Inténtelo más tarde",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Puede imprimir la vista que has creado",info:{maxLayers:"Puede imprimir un máximo de ocho capas de una vez",printoutProcessingTime:"El proceso de impresión tarda cuando se seleccionan varias capas"},buttons:{"continue":"Continuar",cancel:"Cancelar"}}}}),define("bundles/framework/bundle/printout/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"Printout",value:{title:"Prindi kaardivaade",flyouttitle:"Prindi kaardivaade",desc:"",btnTooltip:"Prindi",BasicView:{title:"Prindi kaardivaade",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Keel",options:{fi:"Soome",sv:"Rootsi",en:"Inglise"},tooltip:"Vali kaardiliidese ja kaardiandmete keel."},size:{label:"Suurus",tooltip:"Vali trükimall. Vastavalt uuendatakse kaardi eelvaadet.",options:[{id:"A4",label:"A4 püstformaat",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 põikformaat",classForPreview:"preview-landscape"},{id:"A3",label:"A3 püstformaat",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 põikformaat",classForPreview:"preview-landscape"}]},preview:{label:"Eelvaade",tooltip:"Suurema eelvaate avamiseks kliki väiksel eelvaatel",pending:"Eelvaade uuendatakse kohe",notes:{extent:"Kaardi ulatust väljastuseks saab hinnata eelvaadel",restriction:"Eelvaade ei näita kõiki kaardikihte"}},buttons:{save:"Tee väljatrükk",ok:"OK",back:"NOT TRANSLATED",cancel:"Tühista"},location:{label:"Asukoht ja suumi tase ",tooltip:"Väljatrüki mõõtkava vastab kaardi mõõtkavale lehitsejas.",zoomlevel:"Suumi tase"},settings:{label:"Veel seadeid",tooltip:"Määra lisaseaded nagu formaat, pealkiri ja mõõtkava"},format:{label:"Formaat",tooltip:"Vali failiformaat ",options:[{id:"png",format:"image/png",label:"PNG kujutis"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF dokument"}]},mapTitle:{label:"Lisa pealkiri",tooltip:"lisa kaardi pealkiri"},content:{options:[{id:"pageLogo",label:"Lisa Oskari logo",tooltip:"Vajadusel saab logo peita",checked:"checked"},{id:"pageScale",label:"Lisa kaardile mõõtkava",tooltip:"Lisa kaardile mõõtkava",checked:"checked"},{id:"pageDate",label:"Lisa kuupäev",tooltip:"Võid lisada väljatrükile kuupäeva",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Abi",error:{title:"Viga",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Abi pole saadaval",saveFailed:"Kaardi väljatrükk ebaõnnestus. Proovi hiljem uuesti.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Võid just loodud kaardivaate printida.",info:{maxLayers:"Võid korraga printida kuni 8 kihti",printoutProcessingTime:"Väljatrüki tegemine võtab aega kui on valitud mitu kihti."},buttons:{"continue":"Jätka",cancel:"Tühista"}}}}),define("bundles/framework/bundle/printout/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"Printout",value:{title:"Tulosta näkymä",flyouttitle:"Siirry tulostamaan",desc:"",btnTooltip:"Tulosta",BasicView:{title:"Tulosta nykyinen karttanäkymä.",name:{label:"Kartan nimi",placeholder:"pakollinen",tooltip:"Anna näkymälle kuvaileva nimi. Huomioi käyttöliittymän kieli."},language:{label:"Kieli",options:{fi:"Suomi",sv:"Ruotsi",en:"Englanti"},tooltip:"Valitse kieli, jota käytetään tulosteella. Huomioi käyttöliittymän ja aineiston kieli."},size:{label:"Koko",tooltip:"Valitse arkkikoko. Näet karttanäkymän valitussa koossa esikatselukuvassa.",options:[{id:"A4",label:"A4-tuloste",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4-vaakatuloste",classForPreview:"preview-landscape"},{id:"A3",label:"A3-tuloste",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3-vaakatuloste",classForPreview:"preview-landscape"}]},preview:{label:"Esikatselu",tooltip:"Voit suurentaa esikatselukuvaa klikkaamalla kuvaa hiirellä.",pending:"Esikatselukuva päivitetään hetken kuluttua.",notes:{extent:"Esikatselukuvasta voit tarkistaa tulosteen kattavuusalueen.",restriction:"Esikatselukuvassa ei näytetä kaikkia karttatasoja."}},buttons:{save:"Hae tuloste",ok:"OK",back:"Edellinen",cancel:"Peruuta"},location:{label:"Sijainti ja mittakaavataso",tooltip:"Mittakaavataso vastaa selaimessa näkyvän karttanäkymän mittakaavaa.",zoomlevel:"Mittakaavataso"},settings:{label:"Lisäasetukset",tooltip:"Valitse karttatulosteelle tiedostomuoto, otsikko, mittakaava ja päivämäärä."},format:{label:"Tiedostomuoto",tooltip:"Valitse tulosteen tiedostomuoto",options:[{id:"png",format:"image/png",label:"PNG-kuva"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF-dokumentti"}]},mapTitle:{label:"Kartan otsikko",tooltip:"Anna karttatulosteelle otsikko."},content:{options:[{id:"pageLogo",label:"Näytä paikkatietoikkunan logo tulosteessa.",tooltip:"Voit halutessasi piilottaa Paikkatietoikkunan logon tulosteesta.",checked:"checked"},{id:"pageScale",label:"Näytä mittakaava",tooltip:"Voit halutessasi näyttää tulosteessa kartan mittakaavan.",checked:"checked"},{id:"pageDate",label:"Näytä päivämäärä",tooltip:"Voit halutessasi lisätä tulosteeseen päivämäärän.",checked:"checked"}]},legend:{label:"Karttaselite",tooltip:"Valitse karttaselitteelle paikka. Karttaselitettä ei näytetä tulosteessa, jos paikkaa ei valittuna.",options:[{id:"oskari_legend_NO",loca:"NO",label:"Ei karttaselitettä.",tooltip:"Karttaselitettä ei näytetä tulosteessa.",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Vasen alanurkka",tooltip:"Karttaselite näytetään tulosteen vasemmassa alanurkassa."},{id:"oskari_legend_LU",loca:"LU",label:"Vasen ylänurkka",tooltip:"Karttaselite näytetään tulosteen vasemmassa ylänurkassa."},{id:"oskari_legend_RU",loca:"RU",label:"Oikea ylänurkka",tooltip:"Karttaselite näytetään tulosteen oikeassa ylänurkassa."},{id:"oskari_legend_RL",loca:"RL",label:"Oikea alanurkka",tooltip:"Karttaselite näytetään tulosteen oikeassa alanurkassa."}]},help:"Ohje",error:{title:"Virhe",size:"Tulosteen koko on virheellinen.",name:"Kartan nimi on pakollinen tieto.",nohelp:"Ohjetta ei löytynyt.",saveFailed:"Karttanäkymän tulostus epäonnistui. Yritä myöhemmin uudelleen.",nameIllegalCharacters:"Kartan nimessä on luvattomia merkkejä. Sallittuja merkkejä ovat kaikki suomen kielen aakkoset, numerot sekä välilyönti ja yhdysmerkki."}},StartView:{text:"Voit tulostaa tekemäsi karttanäkymän PNG-kuvaksi tai PDF-tulosteeksi.",info:{maxLayers:"Tulosteessa voi olla enintään kahdeksan karttatasoa.",printoutProcessingTime:"Kartan tulostus voi kestää hetken, jos useita karttatasoja on valittuna."},buttons:{"continue":"Jatka",cancel:"Peruuta"}}}}),define("bundles/framework/bundle/printout/locale/fi",function(){}),Oskari.registerLocalization({lang:"el",key:"Printout",value:{title:"Print Map view",flyouttitle:"Εκτύπωση χάρτη",desc:"",btnTooltip:"Εκτύπωση",BasicView:{title:"Εκτύπωση χάρτη",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Γλώσσα",options:{fi:"Φινλανδικά",sv:"Σουηδικά",en:"Αγγλικά"},tooltip:"Επιλέξτε την γλώσσα του interface του χάρτη και των δεδομένων"},size:{label:"Μέγεθος",tooltip:"Επιλέξτε διάταξη εκτύπωσης (print layout). Η προεπισκόπηση χάρτη ανανεώνεται ανάλογα.",options:[{id:"A4",label:"Α4 πορτρετο",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 πορτρέτο",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"Προεπισκόπιση",tooltip:"Κάντε κλικ στην μικρή προεπισκόπιση για να ανοίξει μεγαλύτερο παράθυρο",pending:"Η προεπισκόπιση θα ανανεωθεί σε λίγο",notes:{extent:"Η προεπισκόπιση μπορεί να χρησιμοποιηθεί για να καθορίσετε το πλαίσια του χάρτη για εκτύπωση",restriction:"Δεν εμφανίζονται όλα τα επίπεδα χάρτη στην προεπισκόπιση"}},buttons:{save:"Λήψη εκτύπωσης",ok:"OK",back:"NOT TRANSLATED",cancel:"Ακύρωση"},location:{label:"Τοποθεσία και επίπεδο μεγέθυνσης",tooltip:"Η κλίμακα εκτύπωσης ταιριάζει με την κλίμακα του χα΄ρτη στον browser.",zoomlevel:"Επίπεδο μεγέθυνσης"},settings:{label:"Περισσότερες ρυθμίσεις",tooltip:"Κάντε περισσότερες ρυθμίσεις όπως format, τιτλος και κλίμακα"},format:{label:"Format",tooltip:"Επιλέξτε το format του αρχείου",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:!0,label:"Έγγραφο PDF"}]},mapTitle:{label:"Πρόσθεση τίτλου",tooltip:"προσθέστε τίτλο του χάρτη"},content:{options:[{id:"pageLogo",label:"Προσθέστε τιο λογότυπο του OSKARI",tooltip:"Μπορείτε να αποκρύψετε το λογότυπο αν χρειαστεί",checked:"checked"},{id:"pageScale",label:"Προσθέστε κλίμακα στον χάρτη",tooltip:"Προσθέστε κλίμακα στον χάρτη",checked:"checked"},{id:"pageDate",label:"Προσθέστε ημερομηνία",tooltip:"Μπορείτε να προσθέσετε ημερομηνία στην εκτύπωση",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Βοήθεια",error:{title:"Σφάλμα",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Δεν διατίθεται βοήθεια",saveFailed:"Η εκτύπωση του χάρτη απέτυχε. Δοκιμάστε πάλι αργότερα.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Μπορείτε να εκτυπώσετε τον χάρτη που μόλις δημιουργήσατε.",info:{maxLayers:"Μπορείτε να εκτυπώσετε το μέγιστο 8 επίπεδα χάρτη κάθε φορά",printoutProcessingTime:"Η εκτύπωση διαρκεί για λίγο όταν επιλέγονται πολλά επίπεδα για εκτύπωση."},buttons:{"continue":"Συνέχεια",cancel:"Ακύρωση"}}}}),define("bundles/framework/bundle/printout/locale/el",function(){}),Oskari.registerLocalization({lang:"hr",key:"Printout",value:{title:"Ispis prikaza karte",flyouttitle:"Ispis prikaza karte",desc:"",btnTooltip:"Ispis",BasicView:{title:"Ispis prikaza karte",name:{label:"Naziv karte",placeholder:"NOT TRANSLATED",tooltip:"Dajte karti opisni naziv. Jezik korisničkog sučelja"},language:{label:"Jezik",options:{fi:"Finski",sv:"Švedski",en:"Engleski"},tooltip:"Odaberi jezik sučelja karte i podataka o karti"},size:{label:"Veličina",tooltip:"Odabir izgleda ispisa Prethodni pregled se ažurira.",options:[{id:"A4",label:"A4 portret",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 pejzaž",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portret",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 pejzaž",classForPreview:"preview-landscape"}]},preview:{label:"Pregled",tooltip:"Klikni na mali pregled za otvaranje velikog pregleda",pending:"Pregled će se uskoro ažurirati.",notes:{extent:"Pregled može poslužiti za ocjenu veličine karte koja se ispisuje",restriction:"Svi slojevi karte se ne prikazuju u pregledniku."}},buttons:{save:"Ispiši",ok:"OK",back:"NOT TRANSLATED",cancel:"Poništi"},location:{label:"Lokacija i stupanj zumiranja",tooltip:"Razmjer ispisa odgovara razmjeru karte u pregledniku.",zoomlevel:"Stupanj zumiranja"},settings:{label:"Daljnje postavke",tooltip:"Dodatne postavke poput formata, naziva i razmjera"},format:{label:"Format",tooltip:"Odabir formata datoteke",options:[{id:"png",format:"image/png",label:"PNG slika"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF dokument"}]},mapTitle:{label:"Dodaj naziv",tooltip:"dodaj naziv karte"},content:{options:[{id:"pageLogo",label:"Dodaj logo Oskari",tooltip:"Ako je potrebno, logo se može sakriti",checked:"checked"},{id:"pageScale",label:"Dodaj mjerilo na kartu",tooltip:"Dodaj mjerilo na kartu",checked:"checked"},{id:"pageDate",label:"Dodaj datum",tooltip:"Možete dodati datum ispisu",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoć",error:{title:"Greška",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Nema dostupne pomoći",saveFailed:"Greška u ispisu karte Pokušajte ponovno kasnije",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Možete ispisati kartu koju ste upravo izradili.",info:{maxLayers:"Odjednom možete ispisati najviše 8 slojeva",printoutProcessingTime:"Kod odabira nekoliko slojeva obrada ispisa traje dulje."},buttons:{"continue":"Nastavi",cancel:"Poništi"}}}}),define("bundles/framework/bundle/printout/locale/hr",function(){}),Oskari.registerLocalization({lang:"hu",key:"Printout",value:{title:"Nyomtatási térképnézet",flyouttitle:"Nyomtatási térképnézet",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Nyomtatási térképnézet",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Méret",tooltip:"Nyomtatási elrendezés kiválasztsa. Az előnézet ennek megfelelően frissül.",options:[{id:"A4",label:"A4 álló",classForPreview:"Előnézet-álló",selected:"Filename"},{id:"A4_Fekvő",label:"A4 fekvő",classForPreview:"előnézet-fekvő"},{id:"A3",label:"A3 álló",classForPreview:"Előnézet-álló"},{id:"A3_Fekvő",label:"A3 fekvő",classForPreview:"előnézet-fekvő"}]},preview:{label:"Előnézet",tooltip:"Kattintson a kis előnézetre egy nagyobb méretű előnézethez.",pending:"Az előnézet hamarosan frissülni fog.",notes:{extent:"Az előnézetet a nyomtatási méretének beállításához használhatjuk.",restriction:"Nem minden térképréteg jelenik meg az előnézetben."}},buttons:{save:"Nyomtatási kép mentése",ok:"OK",back:"NOT TRANSLATED",cancel:"Mégse"},location:{label:"Helyzet és nagyítási szint",tooltip:"A nyomtatási méretarány megegyezik a böngészőben beállított méretaránnyal.",zoomlevel:"Nagyítási szint"},settings:{label:"További beállítások",tooltip:"Alkalmazzon további beállításokat, úgymint formátum, cím és méretarány."},format:{label:"Formátum",tooltip:"Válassza ki a fájlformátumot.",options:[{id:"png",format:"image/png",label:"PNG kép"},{id:"pdf",format:"application/pdf",selected:"Filename",label:"PDF dokumentum"}]},mapTitle:{label:"Cím hozzáadása",tooltip:"adjon címet a térképnek"},content:{options:[{id:"pageLogo",label:"Oskari logo hozzáadása",tooltip:"A logót elrejtheti, ha szükséges.",checked:"ellenőrzött"},{id:"pageScale",label:"Méretarány megadása.",tooltip:"Adja meg a térkép méretarányát.",checked:"ellenőrzött"},{id:"pageDate",label:"Dátum megadása",tooltip:"Megadhat dátumot is a nyomtatáshoz.",checked:"ellenőrzött"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Segítség",error:{title:"Hiba",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Segítség nem áll rendelkezésre.",saveFailed:"Térképnyomtatási hiba. Probálja meg később.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"A most elkészített térképnézetet kinyomtathatja.",info:{maxLayers:"Maximum 8 réteget nyomtathat egyszerre.",printoutProcessingTime:"A nyomtatás feldolgozása némi időt vesz igénybe, amikor több réteget jelölünk ki."},buttons:{"continue":"Folytatás",cancel:"Mégsem"}}}}),define("bundles/framework/bundle/printout/locale/hu",function(){}),Oskari.registerLocalization({lang:"lv",key:"Printout",value:{title:"Drukāt kartes skatu",flyouttitle:"Drukāt kartes skatu",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Drukāt kartes skatu",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Izmērs",tooltip:"Izvēlēties drukas izkārtojumu| Priekšskatījuma karte tiek atbilstoši atjaunota",options:[{id:"A4",label:"A4 portrets",classForPreview:"Portretorientācija",selected:"patiess"},{id:"A4_Landscape",label:"A4 ainava",classForPreview:"Ainavorientācija"},{id:"A3",label:"A3 portrets",classForPreview:"Portretorientācija"},{id:"A3_Landscape",label:"A3 ainava",classForPreview:"Ainavorientācija"}]},preview:{label:"Priekšskatījums",tooltip:"Klikšķiniet uz mazā priekšskatījuma, lai to atvērtu lielāku",pending:"Priekšskatījums drīzumā tiks atjaunināts",notes:{extent:"Priekšskatījums var tikt izmantots, lai noskaidrotu kartes izmērus izdrukai",restriction:"Priekšskatījumā nav attēloti visi kartes slāņi"}},buttons:{save:"Saņemt izdruku",ok:"Labi",back:"NOT TRANSLATED",cancel:"Atcelt"},location:{label:"Novietojums un tālummaiņas līmenis",tooltip:"Izdrukas mērogs atbilst kartes mērogam pārlūkā",zoomlevel:"Tālummaiņas līmenis"},settings:{label:"Vairāk iestatījumu",tooltip:"Izveidot tādus papildus iestatījumus, kā formāts, nosaukums un mērogs"},format:{label:"Formāts",tooltip:"Izvēlēties datnes formātu",options:[{id:"png",format:"attēls/png",label:"PNG attēls"},{id:"pdf",format:"lietotne/pdf",selected:"patiess",label:"PDF dokuments"}]},mapTitle:{label:"Pievienot nosaukumu",tooltip:"pievienot nosaukumu kartei"},content:{options:[{id:"lapasLogotips",label:'Pievienot "Oskari" logotipu',tooltip:"Jūs varat paslēpt logotipu, ja nepieciešams",checked:"pārbaudīts"},{id:"lapasMērogs",label:"Pievienot mērogu kartei",tooltip:"Pievienot mērogu kartei",checked:"pārbaudīts"},{id:"lapasDatums",label:"Pievienot datumu",tooltip:"Jūs varat pievienot datumu izdrukai",checked:"pārbaudīts"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Palīdzība",error:{title:"Kļūda",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Palīdzība nav pieejama",saveFailed:"Karti izdrukāt neizdevās| Mēģiniet vēlreiz vēlāk",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Jūs varat izdrukāt kartes skatu, ko tikko izveidojāt",info:{maxLayers:"Vienā reizē Jūs varat izdrukāt ne vairāk kā 8 slāņus",printoutProcessingTime:"Izdrukas apstrāde aizņem ilgāku laiku, kad izvēlēti vairāki slāņi"},buttons:{"continue":"Turpināt",cancel:"Atcelt"}}}}),define("bundles/framework/bundle/printout/locale/lv",function(){}),Oskari.registerLocalization({lang:"nl",key:"Printout",value:{title:"Print kaartbeeld",flyouttitle:"Print kaartbeeld",desc:"",btnTooltip:"Print",BasicView:{title:"Print kaartbeeld",name:{label:"Kaartnaam",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Taal",options:{fi:"Fins",sv:"Zweeds",en:"Engels"},tooltip:"Kies de taal van de kaartinterface en kaartgegevens."},size:{label:"Grootte",tooltip:"Kies afdrukindeling| Voorbeeldkaart wordt dienovereenkomstig aangepast.",options:[{id:"A4",label:"A4 staand",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 liggend",classForPreview:"preview-landscape"},{id:"A3",label:"A3 staand",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 liggend",classForPreview:"preview-landscape"}]},preview:{label:"Voorbeeld",tooltip:"Klik op het kleine voorbeeld om een groter voorbeeld te openen",pending:"Voorbeeld zal binnenkort worden bijgewerkt",notes:{extent:"Voorbeeld kan worden gebruikt om er achter te komen wat de kaartomvang is voor de afdruk",restriction:"Niet alle kaartlagen worden getoond in het voorbeeld"}},buttons:{save:"Krijg afdruk",ok:"OK",back:"NOT TRANSLATED",cancel:"Annuleren"},location:{label:"Locatie en het zoomniveau",tooltip:"Afdruk schaal komt overeen met de schaal van de kaart in de browser.",zoomlevel:"Zoomniveau"},settings:{label:"Meer instellingen",tooltip:"Maak extra instellingen, zoals formaat, titel en de schaal"},format:{label:"Formaat",tooltip:"Selecteer bestandsformaat",options:[{id:"png",format:"image/png",label:"PNG afbeelding"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF document"}]},mapTitle:{label:"Voeg titel toe",tooltip:"Voeg een titel toe aan de kaart"},content:{options:[{id:"pageLogo",label:"Voeg het Oskari logo toe",tooltip:"U kunt het logo indien nodig verbergen",checked:"checked"},{id:"pageScale",label:"Voeg schaal toe aan de kaart",tooltip:"Voeg schaal toe aan de kaart",checked:"checked"},{id:"pageDate",label:"Voeg datum toe",tooltip:"U kunt de datum toevoegen aan de afdruk",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Help",error:{title:"Fout",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Er is geen hulp beschikbaar",saveFailed:"Kaart uitpinten mislukt. Probeer het later opnieuw.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"U kunt de kaartweergave die u zojuist gemaakt heeft gemaakt printen.",info:{maxLayers:"U kunt maximaal 8 lagen in één keer uitprinten",printoutProcessingTime:"Verwerking van de afdruk zal enige tijd duren wanneer meerdere lagen geselecteerd zijn."},buttons:{"continue":"Doorgaan",cancel:"Annuleren"}}}}),define("bundles/framework/bundle/printout/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"Printout",value:{title:"Widok wydruku mapy",flyouttitle:"Widok wydruku mapy",desc:"",btnTooltip:"Drukuj",BasicView:{title:"Widok wydruku mapy",name:{label:"Nazwa mapy",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Język",options:{fi:"Fiński",sv:"Szwedzki",en:"Angielski"},tooltip:"Wybierz język interfejsu i danych mapy."},size:{label:"Rozmiar",tooltip:"Wybierz układ drukowania Podgląd mapy jest odpowiednio zaktualizowany.",options:[{id:"A4",label:"A4 portret",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portret",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"Podgląd",tooltip:"Kliknij mały podgląd aby otworzyć duży podgląd",pending:"Podgląd będzie aktualizowany wkrótce",notes:{extent:"Z podglądu można wywnioskować zakres mapy do wydruku",restriction:"Nie wszystkie warstwy mapy są widoczne w podglądzie"}},buttons:{save:"Wydruk",ok:"OK",back:"NOT TRANSLATED",cancel:"Anuluj"},location:{label:"Lokalizacja i powiększenie",tooltip:"Wydruk skali odpowiada skali mapy w przeglądarce.",zoomlevel:"Poziom powiększenia"},settings:{label:"Więcej ustawień",tooltip:"Stwórz dodatkowe ustawienia jak format, tytuł i skala"},format:{label:"Format",tooltip:"wybierz format pliku",options:[{id:"png",format:"image/png",label:"obraz PNG"},{id:"pdf",format:"application/pdf",selected:!0,label:"dokument PDF"}]},mapTitle:{label:"dodaj tytuł",tooltip:"dodaj tytuł mapy"},content:{options:[{id:"pageLogo",label:"Dodaj logo Oskari",tooltip:"Możesz ukryć logo w razie potrzeby",checked:"checked"},{id:"pageScale",label:"Dodaj skalę mapy",tooltip:"Dodaj skalę mapy",checked:"checked"},{id:"pageDate",label:"Dodaj datę",tooltip:"Możesz dodać datę do wydruku",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoc",error:{title:"Błąd",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Brak dostępnej pomocy",saveFailed:"Wydruk mapy nie powiódł się. Spróbuj ponownie później.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Możesz wydrukować widok Mapy, który właśnie utworzyłeś.",info:{maxLayers:"Możesz wydrukować maksymalnie 8 warstw jednocześnie",printoutProcessingTime:"Wydruk może trochę potrwać gdy wybranych jest kilka warstw."},buttons:{"continue":"Kontynuuj",cancel:"Anuluj"}}}}),define("bundles/framework/bundle/printout/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"Printout",value:{title:"Imprimir vista",flyouttitle:"Imprimir Vista",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Imprimir vista",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Dimensão",tooltip:"Escolher aspeto da impressão| Pré-visualização é atualizada em consonância",options:[{id:"A4",label:"A4 retrato",classForPreview:"Pré-visualização retrato",selected:"verdadeiro"},{id:"A4_Landscape",label:"A4 paisagem",classForPreview:"pré-visualização paisagem"},{id:"A3",label:"A3 retrato",classForPreview:"Pré-visualização retrato"},{id:"A3_Landscape",label:"A3 paisagem",classForPreview:"pré-visualização paisagem"}]},preview:{label:"Pré-visualização",tooltip:"Clique na pré-visualização menor para abrir uma maior",pending:"Pré-visualização vai ser atualizada em breve",notes:{extent:"Pré-visualização pode ser usada para ter noção do conteúdo da carta na impressão",restriction:"Nem todas as camadas aparecem na pré-visualização"}},buttons:{save:"Obter impressão",ok:"OK",back:"NOT TRANSLATED",cancel:"Cancelar"},location:{label:"Localização e nível de ampliação",tooltip:"Escala de impressão coincide com escala da carta no navegador web",zoomlevel:"Nível de ampliação"},settings:{label:"Mais definições",tooltip:"Atribuir definições adicionais como formato, título e escala"},format:{label:"Formato",tooltip:"Selecionar formato do ficheiro",options:[{id:"png",format:"imagem/png",label:"Imagem PNG"},{id:"pdf",format:"aplicação/pdf",selected:"verdadeiro",label:"Documento pdf"}]},mapTitle:{label:"Adicionar título",tooltip:"Adicionar título à carta"},content:{options:[{id:"Logótipo",label:"Adicionar o logótipo Oskari",tooltip:"Pode esconder o logótipo se necessário",checked:"verificado"},{id:"Escala da página",label:"Adicionar escala à carta",tooltip:"Adicionar escala à carta",checked:"verificado"},{id:"data da página",label:"Adicionar data",tooltip:"Pode adicionar data à impressão",checked:"verificado"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Ajuda",error:{title:"Erro",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Ajuda indisponível",saveFailed:"Falha na impressão| Tente mais tarde",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Pode imprimir a vista que criou",info:{maxLayers:"Pode imprimir até 8 camadas em simultâneo",printoutProcessingTime:"Processo de impressão é demorado quando se seleciona várias camadas"},buttons:{"continue":"Continuar",cancel:"Cancelar"}}}}),define("bundles/framework/bundle/printout/locale/pt",function(){}),Oskari.registerLocalization({lang:"ro",key:"Printout",value:{title:"Imprimare vedere hartă",flyouttitle:"Imprimare vedere hartă",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Imprimare vedere hartă",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Dimensiune",tooltip:"Alegere format de imprimare",options:[{id:"A4",label:"A4 portret",classForPreview:"previzualizare-portret",selected:"Adevărat"},{id:"A4_peisaj",label:"A4 peisaj",classForPreview:"previzualizare_peisaj"},{id:"A3",label:"A3 portret",classForPreview:"previzualizare-portret"},{id:"A3_peisaj",label:"A3 peisaj",classForPreview:"previzualizare-peisaj"}]},preview:{label:"Previzualizare",tooltip:"Click pe previzualizarea mică pentru a deschide o previzualizare mai mare",pending:"Previzualizarea va fi actualizată imediat",notes:{extent:"Previzualizarea poate fi folosită pentru a determina dimensiunea hărţii de imprimat",restriction:"Nu toate straturile hărţii sunt afişate în previzualizare"}},buttons:{save:"Imprimare",ok:"OK",back:"NOT TRANSLATED",cancel:"Anulare"},location:{label:"Localizare şi nivel de mărire/micşorare",tooltip:"Scara hărţii imprimate se potriveşte cu scara hărţii în browser",zoomlevel:"Nivel de mărire/micşorare"},settings:{label:"Mai multe setări",tooltip:"Realizare setări adiţionale precum format, titlu, scară"},format:{label:"Format",tooltip:"Selectare format fişier",options:[{id:"png",format:"image/png",label:"imagine PNG"},{id:"pdf",format:"application/pdf",selected:"adevărat",label:"document PDF"}]},mapTitle:{label:"Adăugare titlu",tooltip:"adăugare titlu hartă"},content:{options:[{id:"Siglăpagină",label:"Adăugare siglă Oskari",tooltip:"Puteţi ascunde sigla dacă este necesar",checked:"verificat"},{id:"Scară",label:"Adăugare scară hartă",tooltip:"Adăugare scară hartă",checked:"verificat"},{id:"Data",label:"Adăugare dată",tooltip:"Puteţi adăuga data pe harta tipărită",checked:"verificat"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Ajutor",error:{title:"Eroare",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Nu există asistenă disponibilă",saveFailed:"Imprimare hartă nereuşită | Încercaţi mai târziu",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Puteţi imprima vederea Hărţii pe care aţi creat-o",info:{maxLayers:"Puteţi imprima maximum 8 straturi la un moment dat",printoutProcessingTime:"Procesul de imprimare durează mai mult când sunt selectate mai multe straturi"},buttons:{"continue":"Continuare",cancel:"Anulare"}}}}),define("bundles/framework/bundle/printout/locale/ro",function(){}),Oskari.registerLocalization({lang:"sr",key:"Printout",value:{title:"Prikaz mape za štampu",flyouttitle:"Prikaz mape za štampu",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Prikaz mape za štampu",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Veličina",tooltip:"Izaberi prikaz štampe. Prikaz je ažuriran",options:[{id:"A4",label:"A4 uspravno",classForPreview:"prikaz-uspravno",selected:"ispravno"},{id:"A4 položeno",label:"A4 položeno",classForPreview:"prikaz-položeno"},{id:"A3",label:"A3 uspravno",classForPreview:"prikaz-uspravno"},{id:"A3 uspravno",label:"A3 položeno",classForPreview:"prikaz-položeno"}]},preview:{label:"Prikaz",tooltip:"Klik na mali prikaz da otvorite veliki prikaz",pending:"Prikaz se ažurira",notes:{extent:"Prikaz se koristiti za pregled područja za štampu",restriction:"Nisu svi slojevi prikazani"}},buttons:{save:"Prihvati podešavanja štampe",ok:"Potvrdi",back:"NOT TRANSLATED",cancel:"Odustani"},location:{label:"Područje i razmera",tooltip:"Razmera štampe odgovara razmeri u kartografskom pregledu",zoomlevel:"Razmera"},settings:{label:"Dodatna podešavanja",tooltip:"Zadavanje dodatnih podešavanja kao format, naslov i razmera"},format:{label:"Format",tooltip:"Izaberi format datoteke",options:[{id:"png",format:"image/png",label:"PNG slika"},{id:"pdf",format:"application/pdf",selected:"ispravno",label:"PDF dokument"}]},mapTitle:{label:"Dodaj naslov",tooltip:"Dodaj naslov za mapu"},content:{options:[{id:"Logo",label:"Dodaj OSKARI logo",tooltip:"Možete sakriti logo ako je potrebno",checked:"provereno"},{id:"razmera",label:"Dodaj razmeru na mapu",tooltip:"Dodavanje razmere na mapu",checked:"provereno"},{id:"datum",label:"Dodati datum",tooltip:"Možete dodati datum za štampu",checked:"provereno"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoć",error:{title:"Greška",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Pomoć nije dostupna",saveFailed:"Greška. Probajte kasnije",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Možete odštampati mapu koju ste napravili",info:{maxLayers:"Možete odštampati najviše 8 slojeva istovremeno",printoutProcessingTime:"Priprema za štampu može potrajiti za više slojeva"},buttons:{"continue":"Nastavi",cancel:"Odustani"}}}}),define("bundles/framework/bundle/printout/locale/sr",function(){}),Oskari.registerLocalization({lang:"sl",key:"Printout",value:{title:"Natisni kartni pogled",flyouttitle:"Natisni kartni pogled",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Natisni kartni pogled",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Velikost",tooltip:"Izberi nastavitve strani tiskanja| Predogled karte je potrebno posodobiti,",options:[{id:"A4",label:"A4 stoječe",classForPreview:"predogled-stoječe",selected:"pravilno"},{id:"A4_Landscape",label:"A4 ležeče",classForPreview:"predogled-ležeče"},{id:"A3",label:"A3 stoječe",classForPreview:"predogled-stoječe"},{id:"A3_Landscape",label:"A3 ležeče",classForPreview:"predogled-ležeče"}]},preview:{label:"Predogled",tooltip:"Za odprtje večjega predogleda klikni na majhen predogled",pending:"Predogled bo kmalu osvežen",notes:{extent:"Predogled se lahko uporablja, da ugotovimo kolikšen je obseg karte na natisu",restriction:"V predogledu niso vidi vsi sloji karte"}},buttons:{save:"Natisni",ok:"V redu",back:"NOT TRANSLATED",cancel:"Prekini"},location:{label:"Lokacija in povečava",tooltip:"Merilo natis se ujema z merilo na karti in v brskalniku",zoomlevel:"Povečava"},settings:{label:"Več nastavitev",tooltip:"Naredi dodatne nastavitve kot so format, naslov in lestvica"},format:{label:"Format",tooltip:"Izberi format",options:[{id:"png",format:"slika/png",label:"PNG slika"},{id:"pdf",format:"aplikacija/pdf",selected:"pravilno",label:"PDF dokument"}]},mapTitle:{label:"Dodaj naslov",tooltip:"dodaj naslov za karto"},content:{options:[{id:"Logo strani",label:"Dodaj Oskari logo",tooltip:"Po potrebi lahko logo skriješ",checked:"preverjeno"},{id:"stranMerilo",label:"Dodaj merilo na karto",tooltip:"Dodaj merilo na karto",checked:"preverjeno"},{id:"stranDatum",label:"Dodaj datum",tooltip:"Natisu lahko dodaš datum",checked:"preverjeno"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoč",error:{title:"Napaka",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Pomoč ni na voljo.",saveFailed:"Natis karte ni uspel| Poskusi kasneje.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Izdelan kartni pogled lahko natisneš",info:{maxLayers:"Natisneš lahko največ 8 slojev na enkrat",printoutProcessingTime:"Pri izbiri več slojev na enkrat postopek natisa traja malo dlje"},buttons:{"continue":"Nadaljuj",cancel:"Prekini"}}}}),define("bundles/framework/bundle/printout/locale/sl",function(){}),Oskari.registerLocalization({lang:"sk",key:"Printout",value:{title:"Vytlačiť zobrazenie mapy",flyouttitle:"Vytlačiť zobrazenie mapy",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Vytlačiť zobrazenie mapy",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Veľkosť",tooltip:"Vybrať rozvrhnutie tlače| Náhľad mapy sa priebežne aktualizuje",options:[{id:"A4",label:"A4 na výšku",classForPreview:"náhľad-na výšku",selected:"dobre"},{id:"A4_Landscape",label:"A4 na šírku",classForPreview:"náhľad-na šírku"},{id:"A3",label:"A3 na výšku",classForPreview:"náhľad-na výšku"},{id:"A3_Landscape",label:"A3 na šírku",classForPreview:"náhľad-na šírku"}]},preview:{label:"Náhľad",tooltip:"Kliknite na malý náhľad aby sa otvoril väčší náhľad",pending:"Náhľad sa o chvíľu aktualizuje",notes:{extent:"Náhľad sa môže použiť na vypočítanie rozsahu mapy pre tlač",restriction:"Nie všetky mapové vrstvy sú v náhľade zobrazené"}},buttons:{save:"Vytlačte to",ok:"OK",back:"NOT TRANSLATED",cancel:"Zrušiť"},location:{label:"Úroveň umiestnenia a priblíženia",tooltip:"Mierka výtlačku sa zhoduje s mierkou mapy v prehliadači",zoomlevel:"Úroveň priblíženia"},settings:{label:"Viac nastavení",tooltip:"Vytvoriť dodatočné nastavenia ako formát, názov a mierka"},format:{label:"Formát",tooltip:"Vyberte formát súboru",options:[{id:"png",format:"obrázok/png",label:"PNG obrázok"},{id:"pdf",format:"aplikácia/pdf",selected:"správnosť",label:"PDF dokument"}]},mapTitle:{label:"Pridať názov",tooltip:"pridať názov k mape"},content:{options:[{id:"logoStránky",label:"Pridať logo Oskari",tooltip:"Ak je to nutné, môžete skryť logo",checked:"skontrolované"},{id:"stránkaMierka",label:"Pridať mierku k mape",tooltip:"Pridať mierku k mape",checked:"skontrolované"},{id:"stránkaDátum",label:"Pridať dátum",tooltip:"Môžete pridať dátum k výtlačku",checked:"skontrolované"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoc",error:{title:"Chyba",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Pomoc nie je k dispozícii",saveFailed:"Tlačenie mapy zlyhalo| Skúste neskôr",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Môžete vytlačiť Zobrazenie mapy, ktoré ste práve vytvorili",info:{maxLayers:"Môžete vytlačiť maximálne 8 vrstiev naraz",printoutProcessingTime:"Proces tlačenia trvá dlhšie ak sa vybralo viacero vrstiev"},buttons:{"continue":"Pokračovať",cancel:"Zrušiť"}}}}),define("bundles/framework/bundle/printout/locale/sk",function(){}),Oskari.registerLocalization({lang:"sq",key:"Printout",value:{title:"Shtyp pamjen e hartës",flyouttitle:"Shtyp pamjen e hartës",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Shtyp pamjen e hartës",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Madhësia",tooltip:"Zgjidh formën (modelin) e shtypjes I",options:[{id:"A4",label:"A4 Vertikal (portrait)",classForPreview:"parapamje për shtypje vertikale",selected:"e vërtetë"},{id:"A4_Landscape",label:"A4 Horizontal (landscape)",classForPreview:"parapamje për shtypje horizontale"},{id:"A3",label:"A3 Vertikal (portrait)",classForPreview:"parapamje për shtypje vertikale"},{id:"A3_Landscape",label:"A3 Horizontal (landscape)",classForPreview:"parapamje për shtypje horizontale"}]},preview:{label:"Parapamje për shtypje",tooltip:"Kliko në parapamjen e vogël për shtypje për të hapur parapamjen e madhe për shtypje",pending:"Parapamja për shtypje do të azhurnohet së shpejti",notes:{extent:"Parapamja për shtypje mund të përdoret për të vendosur për shtrirjen e hartës për shtypje",restriction:"Jo të gjitha shtresat e hartës janë paraqitur në parapamjen për shtypje"}},buttons:{save:"Merr shtypjen (printout)",ok:"OK (prano)",back:"NOT TRANSLATED",cancel:"Anulo"},location:{label:"Lokacioni dhe niveli i zmadhimit",tooltip:"Shkalla e shtypjes përputhet me shkallën e hartës në shfletues",zoomlevel:"Niveli i zmadhimit"},settings:{label:"Më shumë panele (settings)",tooltip:"Bëjë më shumë panele (settings) siç janë formati, titulli dhe shkalla"},format:{label:"Formati",tooltip:"Përzgjedh formatin e skedarit",options:[{id:"png",format:"imazh/png",label:"PNG imazh"},{id:"pdf",format:"aplikacion/pdf",selected:"e vërtetë",label:"PDF dokument"}]},mapTitle:{label:"Shto titullin",tooltip:"Shto titullin për hartën"},content:{options:[{id:"Llogoja e hartës",label:"Shto llogon Oskari",tooltip:"Ju mund ta fshihni llogon nëse është e nevojshme",checked:"E kontrolluar"},{id:"Shkalla e faqes",label:"Shto hartës shkallët",tooltip:"Shto hartës shkallët",checked:"E kontrolluar"},{id:"Data e faqës",label:"Shto datën",tooltip:"Ju mund t'ia shtoni datën shtypjes",checked:"E kontrolluar"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Ndihmë",error:{title:"Gabim",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Nuk ka ndihmë në dispozicion",saveFailed:"Dështoi shtypja e hartës I Ju lutem provoni më vonë",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Ju mund ta shtypni pajmen në hartë të cilën sapo e keni krijuar",info:{maxLayers:"Ju mund të shtypni maksimum 8 shtresa përnjëherë",printoutProcessingTime:"Procesimi i shtypjes merr pak kohë kur disa shtresa janë zgjedhur"},buttons:{"continue":"Vazhdo",cancel:"Anulo"}}}}),define("bundles/framework/bundle/printout/locale/sq",function(){}),Oskari.registerLocalization({lang:"sv",key:"Printout",value:{title:"Skriv ut kartvyn",flyouttitle:"Skriv ut kartvyn",desc:"",btnTooltip:"Skriv ut",BasicView:{title:"Skriv ut kartvyn",name:{label:"Kartans namn",placeholder:"obligatorisk uppgift",tooltip:"Ge kartan ett beskrivande namn. Observera användargränssnittets språk"},language:{label:"Språk",options:{fi:"Finska",sv:"Svenska",en:"Engelska"},tooltip:"Välj språk för kartmaterial och användargränssnitt."},size:{label:"Storlek",tooltip:"Välj storleken på kartan. Kartan förhandsvisas i den valda storleken.",options:[{id:"A4",label:"A4",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4-horisontell",classForPreview:"preview-landscape"},{id:"A3",label:"A3",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3-horisontell",classForPreview:"preview-landscape"}]},preview:{label:"Förhandsgransningsvy",tooltip:"Klicka på den lilla förhandsgransningsvyn för att öppna en större förhandsgransningsvy",pending:"Förhandsgransningsvyn uppdateras om en stund",notes:{extent:"Förhandsgransningsvy visar kartans läge",restriction:"Inte alla maplager visas i förhandsgransningsvyn"}},buttons:{save:"Ladda ned utskriften",ok:"OK",back:"föregående",cancel:"Avbryt"},location:{label:"Läge och skalnivå.",tooltip:"Utskriftens skalnivå motsvarar skalnivån i webbläsaren.",zoomlevel:"Skalnivå"},settings:{label:"Övriga inställningar",tooltip:"Gör övriga inställningar såsom format, rubrik, och skala"},format:{label:"Format",tooltip:"Välj fil format",options:[{id:"png",format:"image/png",label:"PNG bild"},{id:"pdf",format:"application/pdf",label:"PDF dokument",selected:!0}]},mapTitle:{label:"Lägg till rubrik",tooltip:"Lägg till rubrik för kartan"},content:{options:[{id:"pageLogo",label:"Lägg till Paikkatietoikkunas logo",tooltip:"Det är möjligt att gömma logon ifall det behövs",checked:"checked"},{id:"pageScale",label:"Lägg till skala till kartan",tooltip:"Lägg till skala till kartan",checked:"checked"},{id:"pageDate",label:"Lägg till datum",tooltip:"Det är möjligt att lägga till datumet till utskriften",checked:"checked"}]},legend:{label:"Legend",tooltip:"Väljä legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"Ingen legend ",tooltip:"Ingen legend print",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Vänster nere hörn ",tooltip:"Legend position i vänster nere hörn"},{id:"oskari_legend_LU",loca:"LU",label:"Vänster uppe hörn ",tooltip:"Legend position i vänster uppe hörn"},{id:"oskari_legend_RU",loca:"RU",label:"Höger uppe hörn ",tooltip:"Legend position i höger uppe hörn"},{id:"oskari_legend_RL",loca:"RL",label:"Höger nere hörn ",tooltip:"Legend position i höger nere hörn"}]},help:"Anvisning",error:{title:"Fel",size:"Fel i storleksdefinitionerna",name:"Namnet är en nödvändig uppgift",nohelp:"Ingen anvisning",saveFailed:"Avskiljandet av kartan misslyckades. Försök på nytt senare.",nameIllegalCharacters:"I namnet ingår otillåtna tecken. Tillåtna är alla bokstäver i det svenska alfabetet, siffror, mellanslag och bindestreck."}},StartView:{text:"Du kan skriva ut den kartvy som du definierat till PDF-utskrift eller PNG-bildfilen",info:{maxLayers:"Högst 8 kartlager kan skrivs ut",printoutProcessingTime:"Det tar en stund att skriva ut kartvyn med många kartlager."},buttons:{"continue":"Fortsätt",cancel:"Tillbaka"}}}}),define("bundles/framework/bundle/printout/locale/sv",function(){}),Oskari.registerLocalization({lang:"uk",key:"Printout",value:{title:"Друкувати вигляд карти",flyouttitle:"Друкувати вигляд карти",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Друкувати вигляд карти",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Розмір",tooltip:"Обрати макет друку| Попередній перегляд оновлюється відповідно",options:[{id:"А4",label:"А4 Книжкова",classForPreview:"preview-portrait",selected:"true"},{id:"A4_Landscape",label:"А4 Альбомна",classForPreview:"preview-landscape"},{id:"А3",label:"А3 Книжкова",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"А3 Альбомна",classForPreview:"preview-landscape"}]},preview:{label:"Попередній перегляд",tooltip:"Калцніть на зображення попереднього перегляду щоб відкрити його у великому вікні",pending:"Попередній перегляд зараз оновиться",notes:{extent:"Використовуйте попередній перегляд щоб встановити межі друку",restriction:"Не всі шари карти відображаються у вікні попереднього перегляду"}},buttons:{save:"Друк",ok:"ОК",back:"NOT TRANSLATED",cancel:"Скасувати"},location:{label:"Місцеположення та масштаб",tooltip:"Масштаб друку співпадає з масштабом карти у вікні браузера",zoomlevel:"Масштаб"},settings:{label:"Додаткові налаштування",tooltip:"Додаткові налаштування такі як формат файлу, заголовок та масштаб"},format:{label:"Формат",tooltip:"Оберіть формат файлу",options:[{id:"png",format:"image/png",label:"PNG зображення"},{id:"pdf",format:"application/pdf",selected:"true",label:"PDF документ"}]},mapTitle:{label:"Додати заголовок",tooltip:"Додати заголовок на карту"},content:{options:[{id:"pageLogo",label:"Додати логотип Oskari",tooltip:"Ви можете приховати логотип, якщо це необхідно",checked:"checked"},{id:"pageScale",label:"Додати масштаб на карту",tooltip:"Додати масштаб на карту",checked:"checked"},{id:"pageDate",label:"Додати дату",tooltip:"Ви можете також додати дату до роздруківки",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Довідка",error:{title:"Помилка",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Немає доступних довідок",saveFailed:"Друк карти не виконано| Спробуйте пізніше",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Ви можете роздрукувати вигляд щойно створеної карти",info:{maxLayers:"За один раз можна надрукувати максимум 8 шарів",printoutProcessingTime:"Підготовка до друку займає певний час якщо обрано декілька шарів"},buttons:{"continue":"Продовжити",cancel:"Скасувати"}}}}),define("bundles/framework/bundle/printout/locale/uk",function(){}),define("src/framework/printout/module",["oskari","jquery","bundles/framework/bundle/printout/jquery.imagesLoaded","bundles/framework/bundle/printout/instance","bundles/framework/bundle/printout/Flyout","bundles/framework/bundle/printout/Tile","bundles/framework/bundle/printout/plugin/LegendPlugin","bundles/framework/bundle/printout/service/PrintService","bundles/framework/bundle/printout/view/StartView","bundles/framework/bundle/printout/view/BasicPrintout","bundles/framework/bundle/printout/request/PrintMapRequest","bundles/framework/bundle/printout/request/PrintMapRequestHandler","bundles/framework/bundle/printout/event/PrintableContentEvent","bundles/framework/bundle/printout/event/PrintWithoutUIEvent","bundles/framework/bundle/printout/event/PrintWithParcelUIEvent","bundles/framework/bundle/printout/event/PrintCanceledEvent","css!resources/framework/bundle/printout/css/style.css","bundles/framework/bundle/printout/locale/hy","bundles/framework/bundle/printout/locale/bg","bundles/framework/bundle/printout/locale/cs","bundles/framework/bundle/printout/locale/da","bundles/framework/bundle/printout/locale/de","bundles/framework/bundle/printout/locale/en","bundles/framework/bundle/printout/locale/es","bundles/framework/bundle/printout/locale/et","bundles/framework/bundle/printout/locale/fi","bundles/framework/bundle/printout/locale/el","bundles/framework/bundle/printout/locale/hr","bundles/framework/bundle/printout/locale/hu","bundles/framework/bundle/printout/locale/lv","bundles/framework/bundle/printout/locale/nl","bundles/framework/bundle/printout/locale/pl","bundles/framework/bundle/printout/locale/pt","bundles/framework/bundle/printout/locale/ro","bundles/framework/bundle/printout/locale/sr","bundles/framework/bundle/printout/locale/sl","bundles/framework/bundle/printout/locale/sk","bundles/framework/bundle/printout/locale/sq","bundles/framework/bundle/printout/locale/sv","bundles/framework/bundle/printout/locale/uk"],function(e){return e.bundleCls("printout").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.printout.PrintoutBundleInstance");
return t},update:function(){}})}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.FeatureDataBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.popupHandler=null,this.selectionPlugin=null},{__name:"FeatureData2",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=(this.conf?this.conf.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,this.localization=Oskari.getLocalization(this.getName()),n.register(e);for(t in e.eventHandlers)n.registerForEventByName(e,t);var a=n.getRequestBuilder("userinterface.AddExtensionRequest");if(a){var r=a(this);n.request(this,r)}e.createUi();var s=this.getLocalization("popup");if(this.conf&&this.conf.selectionTools===!0){this.popupHandler=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata2.PopupHandler",this);var o=n.getRequestBuilder("Toolbar.AddToolButtonRequest"),l={iconCls:"tool-feature-selection",tooltip:s.tools.select.tooltip,sticky:!1,callback:function(){e.popupHandler.showSelectionTools(e.conf.singleSelection)}};n.request(this,o("dialog","selectiontools",l))}var u,c=n.findAllSelectedMapLayers();for(u=0;u<c.length;++u)c[u].hasFeatureData()&&(this.plugin.refresh(),this.plugins["Oskari.userinterface.Flyout"].layerAdded(c[u]));n.addRequestHandler("ShowFeatureDataRequest",this.requestHandlers.showFeatureHandler)}},init:function(){var e=this;return this.requestHandlers={showFeatureHandler:Oskari.clazz.create("Oskari.mapframework.bundle.featuredata2.request.ShowFeatureDataRequestHandler",e)},null},getSelectionPlugin:function(){return this.selectionPlugin},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){e.getMapLayer().hasFeatureData()&&(this.plugin.refresh(),this.plugins["Oskari.userinterface.Flyout"].layerRemoved(e.getMapLayer()))},AfterMapLayerAddEvent:function(e){e.getMapLayer().hasFeatureData()&&(this.plugin.refresh(),this.plugins["Oskari.userinterface.Flyout"].layerAdded(e.getMapLayer()))},WFSPropertiesEvent:function(e){var t=e.getLayer();this.plugins["Oskari.userinterface.Flyout"].updateData(t)},WFSFeatureEvent:function(e){var t=e.getLayer();this.plugins["Oskari.userinterface.Flyout"].updateData(t)},WFSFeaturesSelectedEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].featureSelected(e)},"userinterface.ExtensionUpdatedEvent":function(e){var t=this.plugins["Oskari.userinterface.Flyout"];e.getExtension().getName()===this.getName()&&t.setEnabled("close"===e.getViewState()?!1:!0)},"FeatureData.FinishedDrawingEvent":function(){if(this.conf.singleSelection){var e=this.selectionPlugin.getFeaturesAsGeoJSON();this.selectionPlugin.stopDrawing(),this.popupHandler.showSelectionTools(!0);var t=this.sandbox.getEventBuilder("WFSSetFilter")(e);this.sandbox.notifyAll(t),this.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[this,"detach"])}}},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata2.Flyout",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi();var e=this.sandbox.findRegisteredModuleInstance("MainMapModule"),t=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata2.plugin.FeaturedataPlugin",{instance:this});e.registerPlugin(t),e.startPlugin(t),this.plugin=t;var i={id:"FeatureData"};this.selectionPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata2.plugin.MapSelectionPlugin",i),e.registerPlugin(this.selectionPlugin),e.startPlugin(this.selectionPlugin)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/featuredata2/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.PopupHandler",function(e){this.instance=e,this.localization=e.getLocalization("popup");var t,i=this,n=i.instance.getSelectionPlugin();this.buttons={point:{iconCls:"selection-point",tooltip:i.localization.tools.point.tooltip,sticky:!1,callback:function(){n.startDrawing({drawMode:"point"})}},line:{iconCls:"selection-line",tooltip:i.localization.tools.line.tooltip,sticky:!1,callback:function(){n.startDrawing({drawMode:"line"})}},polygon:{iconCls:"selection-area",tooltip:i.localization.tools.polygon.tooltip,sticky:!1,callback:function(){n.startDrawing({drawMode:"polygon"})}},square:{iconCls:"selection-square",tooltip:i.localization.tools.square.tooltip,sticky:!1,callback:function(){n.startDrawing({drawMode:"square"})}},circle:{iconCls:"selection-circle",tooltip:i.localization.tools.circle.tooltip,sticky:!1,callback:function(){n.startDrawing({drawMode:"circle"})}}},this.template={};for(t in this.__templates)this.__templates.hasOwnProperty(t)&&(this.template[t]=jQuery(this.__templates[t]))},{__templates:{wrapper:"<div></div>",toolsButton:'<div style= "display: inline-block; border: 1px solid;"></div>',instructions:'<div class="instructions" style="padding: 20px 0px 0px 0px;"></div>',link:'<div class="link"><a href="javascript:void(0);"></a></div></div>'},showSelectionTools:function(e){var t=this;t.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[t.instance,"close"]);var i,n=function(i){return function(){t.buttons[i].callback(),a.close(),e||t._selectionStarted()}},a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=this.localization.title,s=t.template.wrapper.clone();for(i in this.buttons){var o=t.template.toolsButton.clone(),l=this.buttons[i];o.attr("title",l.tooltip),o.addClass(l.iconCls),o.bind("click",n(i)),s.append(o)}var u=t.template.instructions.clone();u.append(this.localization.instructions),s.append(u);var c=[],d=Oskari.clazz.create("Oskari.userinterface.component.Button");d.setTitle(this.localization.button.empty),d.setHandler(function(){for(var e=t.instance.getSandbox(),i=e.findAllSelectedMapLayers(),n=0;n<i.length;++n)if(i[n].hasFeatureData()){var a=e.getEventBuilder("WFSFeaturesSelectedEvent"),r=a([],i[n],!1);e.notifyAll(r)}this.blur()}),c.push(d);var h=Oskari.clazz.create("Oskari.userinterface.component.Button");h.setTitle(this.localization.button.cancel),h.setHandler(function(){a.close(!0)}),h.addClass("primary"),c.push(h),a.addClass("tools_selection"),a.show(r,s,c),a.moveTo("#toolbar div.toolrow[tbgroup=default-selectiontools]","top")},_selectionStarted:function(){var e=this,t=(e._sandbox,Oskari.clazz.create("Oskari.userinterface.component.Popup")),i=e.localization.title,n=e.template.wrapper.clone(),a=e.template.wrapper.clone(),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(e.localization.button.edit),r.setHandler(function(){t.close(),e.showSelectionTools(),e.instance.getSelectionPlugin().startDrawing({drawMode:"modify"})}),a.append(r.getElement());var s=t.createCloseButton(e.localization.button.close);a.append(s.getElement()),s.setHandler(function(){t.close(),e.instance.getSelectionPlugin().stopDrawing(),e.showSelectionTools()}),n.append(a);var o=e.template.link.clone();o.append(e.localization.link.title),o.bind("click",function(){t.close(),e.showSelectionTools()}),n.append(o);var l=Oskari.clazz.create("Oskari.userinterface.component.Button");l.setTitle(e.localization.button.show),l.addClass("primary showSelection"),l.setHandler(function(){var i=e.instance.getSelectionPlugin().getFeaturesAsGeoJSON();e.instance.getSelectionPlugin().stopDrawing();var n=e.instance.sandbox.getEventBuilder("WFSSetFilter")(i);e.instance.sandbox.notifyAll(n),e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"detach"]),t.close()});var u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.setTitle(e.localization.button.cancel),u.setHandler(function(){t.close(),e.instance.getSelectionPlugin().stopDrawing()}),t.show(i,n,[u,l]),t.moveTo("#toolbar div.toolrow[tbgroup=default-selectiontools]","top")}}),define("bundles/framework/bundle/featuredata2/PopupHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.plugin.MapSelectionPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.drawControls=null,this.drawLayer=null,this.editMode=!1,this.listeners=[],this.currentDrawMode=null,this.prefix="Default.",e&&e.id&&(this.prefix=e.id+"."),e&&e.graphicFill&&(this.graphicFill=e.graphicFill),this.multipart=e&&e.multipart===!0},{__name:"MapSelectionPlugin",getName:function(){return this.prefix+this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},addListener:function(e){this.listeners.push(e)},startDrawing:function(e){if(e.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else if(e.geometry){this.editMode=!0;var t=[new OpenLayers.Feature.Vector(e.geometry)];this.drawLayer.addFeatures(t),this.drawControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this._toggleControl(e.drawMode)},stopDrawing:function(){this._toggleControl(),this.drawLayer.removeAllFeatures()},setDrawing:function(e){var t=[new OpenLayers.Feature.Vector(e)];this.drawLayer.addFeatures(t)},forceFinishDraw:function(){this._finishedDrawing(!0)},_finishedDrawing:function(e){if((!this.multipart||e)&&this._toggleControl(),!this.editMode){var t=this.drawLayer.features.length-1;this.drawControls.select.select(this.drawLayer.features[t])}var i;!this.multipart||e?(i=this._sandbox.getEventBuilder(this.prefix+"FinishedDrawingEvent")(this.getDrawing(),this.editMode),this._sandbox.notifyAll(i)):(i=this._sandbox.getEventBuilder(this.prefix+"AddedFeatureEvent")(this.getDrawing(),this.currentDrawMode),this._sandbox.notifyAll(i))},_toggleControl:function(e){var t,i;this.currentDrawMode=e;for(t in this.drawControls)this.drawControls.hasOwnProperty(t)&&(i=this.drawControls[t],e===t?i.activate():i.deactivate())},init:function(){var e=this;if(this.drawLayer=new OpenLayers.Layer.Vector(this.prefix+"FeatureData Draw Layer",{eventListeners:{featuresadded:function(){e._finishedDrawing()}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.Path),polygon:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.Polygon),square:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}}),circle:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:40}}),modify:new OpenLayers.Control.ModifyFeature(e.drawLayer,{standalone:!0}),select:new OpenLayers.Control.SelectFeature(e.drawLayer)},void 0!==this.drawControls.select.handlers?this.drawControls.select.handlers.feature.stopDown=!1:void 0!==this.drawControls.select.handler&&(this.drawControls.select.handler.stopDown=!1,this.drawControls.select.handler.stopUp=!1),null!==this.graphicFill&&void 0!==this.graphicFill){var t,i=this.graphicFill,n=new OpenLayers.Format.SLD,a=n.read(i);if(a&&a.namedLayers)for(t in a.namedLayers)if(a.namedLayers.hasOwnProperty(t)){this.drawLayer.styleMap.styles["default"]=a.namedLayers[t].userStyles[0],this.drawLayer.redraw();break}}this._map.addLayers([e.drawLayer]);var r;for(r in this.drawControls)this.drawControls.hasOwnProperty(r)&&this._map.addControl(this.drawControls[r]);this.geojson_format=new OpenLayers.Format.GeoJSON},getDrawing:function(){if(0===this.drawLayer.features.length)return null;var e=this.drawLayer.features[0].geometry.CLASS_NAME;if("OpenLayers.Geometry.MultiPoint"===e||"OpenLayers.Geometry.MultiLineString"===e||"OpenLayers.Geometry.MultiPolygon"===e)return this.drawLayer.features[0].geometry;var t,i=null,n=[];for(t=0;t<this.drawLayer.features.length;t++)n.push(this.drawLayer.features[t].geometry);switch(e){case"OpenLayers.Geometry.Point":i=new OpenLayers.Geometry.MultiPoint(n);break;case"OpenLayers.Geometry.LineString":i=new OpenLayers.Geometry.MultiLineString(n);break;case"OpenLayers.Geometry.Polygon":i=new OpenLayers.Geometry.MultiPolygon(n)}return i},getFeatures:function(){return this.drawLayer.features},getFeaturesAsGeoJSON:function(){var e=this.geojson_format.write(this.getFeatures()),t=JSON.parse(e);return t.crs=this._getSRS(),t},getFullScreenSelection:function(){var e=this._sandbox.getMap().getBbox(),t=e.toGeometry(),i=this.geojson_format.write(t),n=JSON.parse(i),a={type:"FeatureCollection",crs:this._getSRS(),features:[]},r={type:"Feature",geometry:n,properties:{geom_type:"polygon",buffer_radius:"0"}};return a.features.push(r),a},_getSRS:function(){return{type:"name",properties:{name:this._sandbox.getMap().getSrsName()}}},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/featuredata2/plugin/MapSelectionPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.event.FinishedDrawingEvent",function(e,t){this._drawing=e,this._modification=1==t},{__name:"FeatureData.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/featuredata2/event/FinishedDrawingEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.event.WFSSetFilter",function(e,t){this._geojson=e,this._filters=t},{__name:"WFSSetFilter",getName:function(){return this.__name},getFilters:function(){return this._filters},getGeoJson:function(){return this._geojson}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/featuredata2/event/WFSSetFilter",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.event.WFSSetPropertyFilter",function(e,t){this._filters=e,this._layerId=t},{__name:"WFSSetPropertyFilter",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getFilters:function(){return this._filters}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/featuredata2/event/WFSSetPropertyFilter",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.event.AddedFeatureEvent",function(e,t){this._drawing=e,this._drawingMode=t},{__name:"FeatureData.AddedFeatureEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawingMode:function(){return this._drawingMode}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/featuredata2/event/AddedFeatureEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.layers={},this.tabsContainer=null,this.selectedTab=null,this.active=!1,this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.resizable=!0,this.resizing=!1,this.resized=!1},{getName:function(){return"Oskari.mapframework.bundle.featuredata2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("featuredata")||jQuery(this.container).addClass("featuredata")},startPlugin:function(){this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("nodata"))},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},setResizable:function(e){this.resizable=e},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=this.instance.sandbox,n=i.getRequestBuilder("DimMapLayerRequest"),a=i.getRequestBuilder("HighlightMapLayerRequest");this.tabsContainer.addTabChangeListener(function(t,r){var s;t&&(s=n(t.layer.getId()),i.request(e.instance.getName(),s)),e.selectedTab=r,r&&(e.updateData(r.layer),e.active&&(s=a(r.layer.getId()),i.request(e.instance.getName(),s)))}),this.tabsContainer.insertTo(t)},layerAdded:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");t.setTitle(e.getName()),t.getContainer().append(this.instance.getLocalization("loading")),t.layer=e,this.layers[""+e.getId()]=t,this.tabsContainer.addPanel(t)},layerRemoved:function(e){var t=""+e.getId(),i=this.layers[t];this.tabsContainer.removePanel(i),i&&(i.grid=null,delete i.grid,i.layer=null,delete i.layer,this.layers[t]=null,delete this.layers[t])},updateData:function(e){if(this.active){var t,i=this.instance.sandbox.getMap(),n=this.layers[""+e.getId()],a=null;if(n.grid&&(a=n.grid.getSelection()),n.getContainer().empty(),!e.isInScale(i.getScale()))return void n.getContainer().append(this.instance.getLocalization("errorscale"));if(n.getContainer().append(this.instance.getLocalization("loading")),this._prepareData(e),a&&a.length>0&&"undefined"!=typeof a[0].featureId)for(t=0;t<a.length;++t)n.grid.select(a[t].featureId,!0);if(n.grid&&e.getClickedFeatureIds().length>0)for(t=0;t<e.getClickedFeatureIds().length;++t)n.grid.select(e.getClickedFeatureIds()[t],!0);if(n.grid&&e.getSelectedFeatures().length>0)for(t=0;t<e.getSelectedFeatures().length;++t)n.grid.select(e.getSelectedFeatures()[t][0],!0)}},updateGrid:function(){this.selectedTab&&this.updateData(this.selectedTab.layer)},_enableResize:function(){var e=this,t=jQuery("div.oskari-flyoutcontent.featuredata"),i=t.parent().parent(),n=t.parent(),a=(t.find("div.tabsContent"),0),r=0;i.find("div.tab-content").css({"padding-top":"1px","padding-right":"1px"});var s=jQuery("<div/>");s.addClass("flyout-resizer");var o=16;s.removeClass("allowHover"),s.addClass("icon-drag"),s.bind("dragstart",function(e){e.preventDefault()}),s.mousedown(function(t){e.resizing||(e.resizing=!0,a=t.pageX-i[0].offsetWidth-i[0].offsetLeft,r=t.pageY-i[0].offsetHeight-i[0].offsetTop,jQuery(document).attr("unselectable","on").css("user-select","none").on("selectstart",!1))}),jQuery(document).mouseup(function(){e.resizing=!1,e.resized=!0}),jQuery(document).mousemove(function(t){if(e.resizing){var s=100,l=60,u=i.offset(),c=n.offset();if(t.pageX>u.left){var d=t.pageX-u.left-a;i.css("max-width",d.toString()+"px"),i.css("width",d.toString()+"px")}if(t.pageY-u.top>s){var h=t.pageY-u.top-r;i.css("max-height",h.toString()+"px"),i.css("height",h.toString()+"px");var p=t.pageY-c.top-r;n.css("max-height",(p-o).toString()+"px"),n.css("height",(p-o).toString()+"px");var f=jQuery("div.oskari-flyoutcontent.featuredata").find("div.tabsContent"),m=t.pageY-f[0].offsetTop-o-l,g=jQuery("div.oskari-flyoutcontent.featuredata").find("div.tab-tools");g.length>0&&(m-=g.height()),i.find("div.tab-content").css("max-height",m.toString()+"px")}}}),i.find("div.oskari-flyoutcontent").css("padding-bottom","5px"),0===jQuery("div.flyout-resizer").length&&i.append(s)},_addNumericColumnRenderers:function(e){var t,i,n,a,r,s=e.getDataModel().data,o=e.getVisibleFields(),l={},u={};for(t=0;t<s.length;t+=1)for(n=s[t],i=0;i<o.length;i+=1)a=o[i],r=n[a],l[a]||null===r||void 0===r||(isNaN(r)&&(r=parseFloat(r)),isNaN(r)&&"string"==typeof n[a]&&n[a].length?l[a]=!0:(r+="",r=r.split("."),u[a]=Math.max(u[a]||0,2===r.length?r[1].length:0)));var c=function(e){return function(t){var i=parseFloat(t);return isNaN(i)?t:i.toFixed(e)}};for(t=0;t<o.length;t+=1)!l[o[t]]&&u[o[t]]&&e.setColumnValueRenderer(o[t],c(u[o[t]]))},_prepareData:function(e){var t=this,i=this.layers[""+e.getId()],n=this.tabsContainer.isSelected(i);if(n){i.getContainer().empty();var a=Oskari.clazz.create("Oskari.userinterface.component.GridModel");a.setIdField("__fid");var r=e.getFields().slice(0);remove_item=function(e,t){var i;for(i in e)if(e[i]==t){e.splice(i,1);break}return e};var s=e.getFields().slice(0),o=e.getLocales().slice(0),l=e.getActiveFeatures().slice(0),u=e.getSelectedFeatures().slice(0);if(this._addFeatureValues(a,s,r,l,u),this._addFeatureValues(a,s,r,u,null),s=a.getFields(),r.push("__fid"),r.push("__centerX"),r.push("__centerY"),r.push("geometry"),i.fields&&i.locales&&this._isArrayEqual(s,i.fields)&&this._isArrayEqual(o,i.locales)||(i.fields=s,i.locales=o,i.propertiesChanged=!0),!i.grid||i.propertiesChanged){i.propertiesChanged=!1;var c,d=Oskari.clazz.create("Oskari.userinterface.component.Grid",this.instance.getLocalization("columnSelectorTooltip"));if(o)for(c=0;c<o.length;c++)d.setColumnUIName(s[c],o[c]);d.addSelectionListener(function(i,n){t._handleGridSelect(e,n)});var h=this.instance.getLocalization("showmore");d.setAdditionalDataHandler(h,function(e,i){var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.show(h,i),n.moveTo(e,"bottom"),t.dialog&&t.dialog.close(!0),t.dialog=n});var p,f=function(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1},m=[];for(p=0;p<s.length;++p)f(r,s[p])||m.push(s[p]);d.setVisibleFields(m),d.setColumnSelector(!0),d.setResizableColumns(!0),d.setExcelExporter("publication_permission_ok"===e.getPermission("publish")),i.grid=d}i.grid.setDataModel(a),t._addNumericColumnRenderers(i.grid),i.grid.renderTo(i.getContainer());var g=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule").getMapEl(),v=jQuery("div.oskari-flyoutcontent.featuredata"),y=v.parent().parent();t.resized||(y.find("div.tab-content").css("max-height",(g.height()/4).toString()+"px"),y.css("max-width",g.width().toString()+"px")),t.resizable&&this._enableResize()}},_addFeatureValues:function(e,t,i,n,a){var r,s,o,l,u;for(r=0;r<n.length;r++){if(l={},u=n[r],null!==a&&void 0!==a&&a.length>0)for(o=0;o<a.length;o++)u[0]==a[o][0]&&a.splice(o,1);for(s=0;s<t.length;s++)null===u[s]||void 0===u[s]||""===u[s]?l[t[s]]="":(l[t[s]]=u[s],remove_item(i,t[s]));e.addData(l)}},_isArrayEqual:function(e,t){if(t.length!==e.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0},_handleGridSelect:function(e,t,i){var n=this.instance.sandbox,a=[t],r=n.getEventBuilder("WFSFeaturesSelectedEvent");void 0===i&&(i=n.isCtrlKeyDown());var s=r(a,e,i);n.notifyAll(s)},featureSelected:function(e){if(this.active){var t,i=e.getMapLayer(),n=this.layers[""+i.getId()],a=e.getWfsFeatureIds();if(null!==a&&void 0!==a&&a.length>0){if(n.grid.select(a[0],e.isKeepSelection()),a.length>1)for(t=1;t<a.length;++t)n.grid.select(a[t],!0)}else n.grid.removeSelections()}},setEnabled:function(e){if(this.active!=e){this.active=!!e;var t,i=this.instance.sandbox,n=i.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");if(n&&i.request(this.instance.getName(),n(!this.active)),this.active){if(this.selectedTab){var a=i.getRequestBuilder("HighlightMapLayerRequest");t=a(this.selectedTab.layer.getId()),i.request(this.instance.getName(),t),this.updateGrid()}}else{if(this.selectedTab){var r=i.getRequestBuilder("DimMapLayerRequest");t=r(this.selectedTab.layer.getId()),i.request(this.instance.getName(),t)}for(var s in this.layers)s.getContainer&&s.getContainer().empty()}}}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/featuredata2/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.plugin.FeaturedataPlugin",function(e){this._clazz="Oskari.mapframework.bundle.featuredata2.plugin.FeaturedataPlugin",this._defaultLocation="top right",this._instance=e.instance,this._index=6,this._name="FeaturedataPlugin"},{_createControlElement:function(){var e=this,t=(e._sandbox,jQuery('<div class="mapplugin featuredataplugin"><a href="JavaScript: void(0);"></a></div>')),i=t.find("a");return i.html(e._instance.getLocalization("title")),e._bindLinkClick(i),t.mousedown(function(e){e.stopPropagation()}),t},_bindLinkClick:function(e){var t=this,i=e||t.getElement().find("a"),n=t._sandbox;i.bind("click",function(){return n.postRequestByName("userinterface.UpdateExtensionRequest",[t._instance,"detach"]),!1})},refresh:function(){var e,t=this,i=t.getMapModule().getSandbox(),n=i.findAllSelectedMapLayers();for(e=0;e<n.length;e++)if(n[e].hasFeatureData())return void t.setVisible(!0);t.setVisible(!1)},_setLayerToolsEditModeImpl:function(){this.inLayerToolsEditMode()?this.getElement().find("a").unbind("click"):this._bindLinkClick()},_createEventHandlers:function(){return{AfterMapMoveEvent:function(){this.refresh()}}}},{extend:["Oskari.mapping.mapmodule.plugin.BasicMapModulePlugin"],protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/featuredata2/plugin/FeaturedataPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.request.ShowFeatureDataRequest",function(e){this._id=e},{__name:"ShowFeatureDataRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/featuredata2/request/ShowFeatureDataRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata2.request.ShowFeatureDataRequestHandler",function(e){this.featureData=e},{handleRequest:function(e,t){var i,n=t.getId(),a=this.featureData.plugins["Oskari.userinterface.Flyout"],r=a.tabsContainer.panels;for(i=0;i<r.length;i++)if(r[i].layer.getId()===n){a.tabsContainer.select(r[i]);break}this.featureData.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[this.featureData,"detach"])}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/featuredata2/request/ShowFeatureDataRequestHandler",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/featuredata2/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"cs",key:"FeatureData2",value:{title:"Objektová data",desc:"Atributy prostorových objektů",loading:"Nahrávám",showmore:"Zobrazit",nodata:"Vybrané mapové vrstvy neobsahují žádná atributová data.",featureNameAll:"Datový typ",errorscale:"Data nemohou být zobrazena v této úrovni měřítka. Změňte, prosím, úroveň přiblížení.",errordata:"Data poskytovaná serverem obsahují chyby. Prosím, posuňte trochu mapu, abyste ji aktualizovali.",columnSelectorTooltip:"Ukázat sloupce",popup:{title:"Vybrat objekty v mapě",instructions:" ",link:{title:"Vybrat více"},button:{cancel:"Storno",empty:"",show:"Zobrazit místa",close:"Zavřít",edit:"Upravit"},tools:{point:{tooltip:"Přidat bod"},line:{tooltip:"Přidat linii"},polygon:{tooltip:"Přidat polygon"},square:{tooltip:"Přidat obdélník"},circle:{tooltip:"Přidat kružnici"},select:{tooltip:"Vybrat objekty"}}}}}),define("bundles/framework/bundle/featuredata2/locale/cs",function(){}),Oskari.registerLocalization({lang:"de",key:"FeatureData2",value:{title:"Objektdaten",desc:"Sachdaten räumlicher Objekte",loading:"Wird geladen",showmore:"Anzeigen",nodata:"Die ausgewählten Kartenebenen beinhalten keine Sachdaten.",featureNameAll:"Datentyp",errorscale:"Die Daten können in dieser Maßstabsebene nicht angezeigt werden. Bitte wechseln Sie die Maßstabsebene.",errordata:"Die vom Server bereitgestellten Daten weisen Fehler auf. Bitte verschieben Sie die Karte leicht, um Sie zu aktualisieren.",columnSelectorTooltip:"Zeige Tabelle",popup:{title:"Wählen Sie ein Objekt auf der Karte",instructions:" ",link:{title:"Mehr auswählen"},button:{cancel:"Abbrechen",empty:"",show:"Orte anzeigen",close:"Schließen",edit:"Bearbeiten"},tools:{point:{tooltip:"Punkt hinzufügen"},line:{tooltip:"Linie hinzufügen"},polygon:{tooltip:"Polygon hinzufügen"},square:{tooltip:"Rechteck hinzufügen"},circle:{tooltip:"Kreis hinzufügen"},select:{tooltip:"Objekte auswählen"}}}}}),define("bundles/framework/bundle/featuredata2/locale/de",function(){}),Oskari.registerLocalization({lang:"en",key:"FeatureData2",value:{title:"Feature data",desc:"",loading:"Loading...",showmore:"Show",nodata:"The selected map layers contain no feature data.",featureNameAll:"Data type",errorscale:"The feature data on this map layer cannot be shown on this scale level. Please change the scale level at scale bar.",errordata:"The feature data at the server contains errors. Please update the map by moving it slightly.",columnSelectorTooltip:"Select visible columns.",popup:{title:"Select features on the map.",instructions:" ",link:{title:"Select more features"},button:{cancel:"Cancel",empty:"Remove selection",show:"Show features",close:"Close",edit:"Edit"},tools:{point:{tooltip:"Add a point feature to the map."},line:{tooltip:"Add a line feature to the map."},polygon:{tooltip:"Add an area feature to the map."},square:{tooltip:"Add a rectangular area feature to the map."},circle:{tooltip:"Add a circular area feature to the map."},select:{tooltip:"Select features"}}}}}),define("bundles/framework/bundle/featuredata2/locale/en",function(){}),Oskari.registerLocalization({lang:"es",key:"FeatureData2",value:{title:"Datos del objeto",desc:"Atributos de los objetos espaciales",loading:"Cargando",showmore:"Mostrar",nodata:"Las capas seleccionadas no contienen atributos.",featureNameAll:"Tipo de dato",errorscale:"Los datos no se pueden mostrar a este nivel de escala. Por favor, cambie el nivel de escala.",errordata:"Los datos porporcionados por el servidor contienen errores. Por favor, muévase por el mapa ligeramente para actualizarlo.",columnSelectorTooltip:"Muestra las columnas",popup:{title:"Selecciona los fenómenos en el mapa",instructions:" ",link:{title:"Selecciona más"},button:{cancel:"Cancelar",empty:"",show:"Ver sitios",close:"Cerrar",edit:"Editar"},tools:{point:{tooltip:"Añadir punto"},line:{tooltip:"Añadir línea"},polygon:{tooltip:"Añadir polígono"},square:{tooltip:"Añadir rectángulo"},circle:{tooltip:"Añadir círculo"},select:{tooltip:"Selecciona objetos"}}}}}),define("bundles/framework/bundle/featuredata2/locale/es",function(){}),Oskari.registerLocalization({lang:"et",key:"FeatureData2",value:{title:"Objekti info",desc:"",loading:"Laadimine",showmore:"Näita",nodata:"Valitud kaardikihid ei sisalda atribuutandmeid.",featureNameAll:"Andmete tüüp",errorscale:"Andmeid ei saa selles mõõtkavas näidata. Palun muuda mõõtkava.",errordata:"Serverist edastatud andmed sisaldavad vigu. Palun nihuta kaarti veidi selle uuendamiseks.",columnSelectorTooltip:"Näita veerge",popup:{title:"Vali nähtused kaardil",instructions:" ",link:{title:"Vali rohkem"},button:{cancel:"Cancel",empty:"Tühista",show:"NOT TRANSLATED",close:"Sulge",edit:"Toimeta"},tools:{point:{tooltip:"Lisa punkt"},line:{tooltip:"Lisa joon"},polygon:{tooltip:"Lisa polügoon"},square:{tooltip:"Lisa kolmnurk"},circle:{tooltip:"Lisa ring"},select:{tooltip:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/featuredata2/locale/et",function(){}),Oskari.registerLocalization({lang:"fi",key:"FeatureData2",value:{title:"Kohdetiedot",desc:"",loading:"Ladataan...",showmore:"Näytä",nodata:"Valitsemillasi karttatasoilla ei ole kohdetietoja.",featureNameAll:"Tietotyyppi",errorscale:"Kohdetietoja ei voida näyttää tällä mittakaavatasolla. Siirry sopivalle mittakaavatasolle mittakaavasäätimen avulla.",errordata:"Palvelimelta saatu tieto oli virheellistä. Siirrä hieman karttaa päivittääksesi tiedot.",columnSelectorTooltip:"Näytä sarakkeet",popup:{title:"Valitse kohteita kartalta",instructions:" ",link:{title:"Lisää valinta"},button:{cancel:"Peruuta",empty:"Poista valinnat",show:"Näytä kohteet",close:"Sulje",edit:"Muokkaa"},tools:{point:{tooltip:"Lisää piste"},line:{tooltip:"Lisää viiva"},polygon:{tooltip:"Lisää alue"},square:{tooltip:"Lisää suorakulmio"},circle:{tooltip:"Lisää ympyrä"},select:{tooltip:"Valitse kohteita"}}}}}),define("bundles/framework/bundle/featuredata2/locale/fi",function(){}),Oskari.registerLocalization({lang:"el",key:"FeatureData2",value:{title:"Ψηφιδωτά δεδομένα",desc:"",loading:"Γίνεται φόρτωση",showmore:"Εμφάνιση",nodata:"Τα επίπεδα του επιλεγμένου χάρτη δεν περιλαμβάνουν τιμές.",featureNameAll:"Τύπος δεδομένων.",errorscale:"Τα δεδομένα δεν μπορούν να προβληθούν σε αυτή την κλίμακα/Παρακαλούμε, αλλάξτε κλίμακα.",errordata:"Τα δεδομένα που παρέχονται από τον server περιέχουν σφάλματα/Παρακαλούμε, μετακινήστε λίγο τον χάρτη για ανανέωση.",columnSelectorTooltip:"Προβολή στηλών.",popup:{title:"Επιλογή στοιχείων στον χάρτη.",instructions:" ",link:{title:"Επιλογή περισσοτέρων."},button:{cancel:"Ακύρωση.",empty:"NOT TRANSLATED",show:"Εμφάνιση τοποθεσιών.",close:"Κλείσιμο.",edit:"Επεξεργασία."},tools:{point:{tooltip:"Πρόσθεση σημείου."},line:{tooltip:"Πρόσθεση γραμμής."},polygon:{tooltip:"Πρόσθεση γραμμής."},square:{tooltip:"Πρόσθεση παραλληλογράμμου."},circle:{tooltip:"Πρόσθεση κύκλου."},select:{tooltip:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/featuredata2/locale/el",function(){}),Oskari.registerLocalization({lang:"hr",key:"FeatureData2",value:{title:"Podaci o objektu",desc:"",loading:"Učitavanje",showmore:"Prikaži",nodata:"Odabrani slojevi karte ne sadrže atributne podatke.",featureNameAll:"Tip podataka",errorscale:"Podatke nije moguće pokazati u ovom mjerilu. Promijenite mjerilo.",errordata:"Podaci sa servera sadrže greške. Pomaknite kartu kako biste je ažurirali.",columnSelectorTooltip:"Prikaži stupce",popup:{title:"Odaberi značajke na karti",instructions:" ",link:{title:"Odaberi još"},button:{cancel:"Poništi",empty:"NOT TRANSLATED",show:"Prikaži mjesta",close:"Zatvori",edit:"Uredi"},tools:{point:{tooltip:"Dodavanje točku"},line:{tooltip:"Dodavanje linije"},polygon:{tooltip:"Dodavanje poligona"},square:{tooltip:"Dodavanje četverokuta"},circle:{tooltip:"Dodavanje kruga"},select:{tooltip:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/featuredata2/locale/hr",function(){}),Oskari.registerLocalization({lang:"nl",key:"FeatureData2",value:{title:"Objectgegevens",desc:"",loading:"Laden",showmore:"Tonen",nodata:"Geselecteerde kaartlagen bevatten geen attribuutgegevens.",featureNameAll:"Gegevenstype",errorscale:"Gegevens kunnen niet op dit schaalniveau worden getoond. Wijzig het schaalniveau.",errordata:"Gegevens van de server bevatten fouten. Verschuif de kaart om te actualiseren.",columnSelectorTooltip:"Toon kolommen",popup:{title:"Selecteer kenmerken op de kaart",instructions:" ",link:{title:"Meer selecteren"},button:{cancel:"Annuleren",empty:"NOT TRANSLATED",show:"Bekijk plaatsen",close:"Sluiten",edit:"Bewerken"},tools:{point:{tooltip:"Punkt toevoegen"},line:{tooltip:"Lijn toevoegen"},polygon:{tooltip:"Polygoon toevoegen"},square:{tooltip:"Driehoek toevoegen"},circle:{tooltip:"Cirkel toevoegen"},select:{tooltip:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/featuredata2/locale/nl",function(){}),Oskari.registerLocalization({lang:"pl",key:"FeatureData2",value:{title:"Dane Obiektów",desc:"",loading:"Ładowanie",showmore:"Pokaż",nodata:"Wybrane warstwy map nie zawierają danych atrybutowych.",featureNameAll:"Rodzaj danych",errorscale:"Dane nie mogą zostać wyświetlone w tej skali. Zmieć skalę.",errordata:"Dane dostarczone przez serwer zawierają błędy. Przesuń lekko mapę w celu akualizacji.",columnSelectorTooltip:"Pokaż kolumny",popup:{title:"Wybierz właściwości na mapie",instructions:" ",link:{title:"Zaznacz więcej"},button:{cancel:"Anuluj",empty:"NOT TRANSLATED",show:"Przejrzyj miejsca",close:"Zamknij",edit:"Edytuj"},tools:{point:{tooltip:"Dodaj punkt"},line:{tooltip:"Dodaj linię"},polygon:{tooltip:"Dodaj poligon"},square:{tooltip:"Dodaj prostokąt"},circle:{tooltip:"Dodaj okrąg"},select:{tooltip:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/featuredata2/locale/pl",function(){}),Oskari.registerLocalization({lang:"pt",key:"FeatureData2",value:{title:"Objeto",desc:"",loading:"Carregamento",showmore:"Mostrar",nodata:"Os níveis selecionados não têm atributos.",featureNameAll:"Tipo de dados",errorscale:"Dados não podem ser apresentados para esta escala. Por favor, mude de escala.",errordata:"Os dados do servidor têm erros. Por favor desloque ligeiramente a carta para atualizar.",columnSelectorTooltip:"Mostrar colunas",popup:{title:"Selecionar elementos na carta",instructions:" ",link:{title:"Selecionar mais"},button:{cancel:"Cancelar",empty:"NOT TRANSLATED",show:"Ver lugares",close:"Fechar",edit:"Editar"},tools:{point:{tooltip:"Adicionar ponto"},line:{tooltip:"Adicionar linha"},polygon:{tooltip:"Adicionar polígono"},square:{tooltip:"Adicionar retângulo"},circle:{tooltip:"Adicionar círculo"},select:{tooltip:"NOT TRANSLATED"}}}}}),define("bundles/framework/bundle/featuredata2/locale/pt",function(){}),Oskari.registerLocalization({lang:"sv",key:"FeatureData2",value:{title:"Objektuppgifter",desc:"",loading:"Laddar ned",showmore:"Visa",nodata:"Kartlagren du valt saknar uppgifter om objekt.",featureNameAll:"Datatyp",errorscale:"Uppgifter om objekt kan inte visas på denna skalnivå. Byt skalnivå.",errordata:"Fel i data från servern. Flytta något på kartan för att uppdatera.",columnSelectorTooltip:"Visa kolumner",popup:{title:"Markera objekt på kartan",instructions:" ",link:{title:"välja mer"},button:{cancel:"Avbryt",empty:"Ta bort valda objekt",show:"Visa",close:"Stäng",edit:"Redigera"},tools:{point:{tooltip:"Lägg punkt"},line:{tooltip:"Lägg rad"},polygon:{tooltip:"Lägg polygon"},square:{tooltip:"Lägg kvadrat"},circle:{tooltip:"Lägg cirkel"},select:{tooltip:"Markera objekt"}}}}}),define("bundles/framework/bundle/featuredata2/locale/sv",function(){}),define("src/framework/featuredata2/module",["oskari","jquery","src/mapping/mapmodule/plugin/AbstractMapModulePlugin","src/mapping/mapmodule/plugin/BasicMapModulePlugin","bundles/framework/bundle/featuredata2/instance","bundles/framework/bundle/featuredata2/PopupHandler","bundles/framework/bundle/featuredata2/plugin/MapSelectionPlugin","bundles/framework/bundle/featuredata2/event/FinishedDrawingEvent","bundles/framework/bundle/featuredata2/event/WFSSetFilter","bundles/framework/bundle/featuredata2/event/WFSSetPropertyFilter","bundles/framework/bundle/featuredata2/event/AddedFeatureEvent","bundles/framework/bundle/featuredata2/Flyout","bundles/framework/bundle/featuredata2/plugin/FeaturedataPlugin","bundles/framework/bundle/featuredata2/request/ShowFeatureDataRequest","bundles/framework/bundle/featuredata2/request/ShowFeatureDataRequestHandler","css!resources/framework/bundle/featuredata2/css/style.css","bundles/framework/bundle/featuredata2/locale/cs","bundles/framework/bundle/featuredata2/locale/de","bundles/framework/bundle/featuredata2/locale/en","bundles/framework/bundle/featuredata2/locale/es","bundles/framework/bundle/featuredata2/locale/et","bundles/framework/bundle/featuredata2/locale/fi","bundles/framework/bundle/featuredata2/locale/el","bundles/framework/bundle/featuredata2/locale/hr","bundles/framework/bundle/featuredata2/locale/nl","bundles/framework/bundle/featuredata2/locale/pl","bundles/framework/bundle/featuredata2/locale/pt","bundles/framework/bundle/featuredata2/locale/sv"],function(e){return e.bundleCls("featuredata2").category({create:function(){var t=e.clazz.create("Oskari.mapframework.bundle.featuredata2.FeatureDataBundleInstance");
return t},update:function(){}})}),Oskari.clazz.define("Oskari.catalogue.bundle.metadatacatalogue.service.MetadataOptionService",function(e){this._searchUrl=e},{__qname:"Oskari.catalogue.bundle.metadatacatalogue.service.MetadataOptionService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},getOptions:function(e,t){Oskari.getLang(),Oskari.getSandbox().getMap().getSrsName();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,error:t,success:e})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/catalogue/bundle/metadatacatalogue/service/MetadataOptionService",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadatacatalogue.service.MetadataSearchService",function(e){this._searchUrl=e},{__qname:"Oskari.catalogue.bundle.metadatacatalogue.service.MetadataSearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(e,t,i){Oskari.getLang(),Oskari.getSandbox().getMap().getSrsName();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,data:e,error:i,success:t})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/catalogue/bundle/metadatacatalogue/service/MetadataSearchService",function(){}),Oskari.clazz.define("Oskari.catalogue.bundle.metadatacatalogue.MetadataCatalogueBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.optionService=null,this.searchService=null,this.tabPriority=5,this.conditions=[],this.resultHeaders=[{title:this.getLocalization("grid").name,prop:"name"},{title:"",prop:"rating"},{title:"",prop:"info"},{title:"",prop:"remove"}],this.lastSearch="",this.lastResult=null,this.lastSort=null},{__name:"catalogue.bundle.metadatacatalogue",templates:{metadataTab:jQuery('<div class="metadataCatalogueContainer"></div>'),optionPanel:jQuery('<div class="main metadataOptions"><div class="metadataCatalogueDescription"></div><div class="controls"></div><div class="moreLess"></div><div class="advanced"></div></div>'),moreLessLink:jQuery('<a href="JavaScript:void(0);" class="moreLessLink"></a>'),advanced:jQuery('<div class="advanced"></div>'),metadataCheckbox:jQuery('<div class="metadataType"><label class="metadataTypeText"><input type="checkbox" class="metadataMultiDef"></label></div>'),metadataDropdown:jQuery('<div class="metadataType"><select class="metadataDef"></select></div>'),dropdownOption:jQuery("<option></option>"),checkboxRow:jQuery('<div class="metadataRow checkboxRow"><div class="rowLabel"></div class=""><div class="checkboxes"></div></div></div>'),dropdownRow:jQuery('<div class="metadataRow dropdownRow"><div class="rowLabel"></div></div>'),searchPanel:jQuery('<div class="main metadataSearching"></div>'),resultPanel:jQuery('<div class="main metadataResults"></div>'),resultHeader:jQuery('<div class="metadataResultHeader"><div class="panelHeader resultTitle"></div><div class="panelHeader resultLinks"><a href="JavaScript:void(0);" class="showLink"></a><a href="JavaScript:void(0);" class="modifyLink"></a></div></div>'),resultTable:jQuery('<div class="resultTable"><table class="metadataSearchResult"><thead><tr></tr></thead><tbody></tbody></table></div>'),resultTableHeader:jQuery('<th><a href="JavaScript:void(0);"></a></th>'),resultTableRow:jQuery('<tr class="spacerRow"><td class="spacer"></td></tr><tr class="resultRow"><td></td><td></td><td><div class="layerInfo icon-info"></div></td><td><div class="resultRemove icon-close"></div></td></tr>'),layerList:jQuery('<ul class="layerList"></ul>'),layerListItem:jQuery("<li></li>"),layerLink:jQuery('<a href="JavaScript:void(0);" class="layerLink"></a>')},getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e&&this._localization[e]?this._localization[e]:this.localization?this._localization:{}},start:function(){var e=this;if(!e.started){e.started=!0;var t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,e.localization=Oskari.getLocalization(e.getName());var a=null;a=e.conf&&e.conf.optionUrl?e.conf.optionUrl:n.getAjaxUrl()+"action_route=GetMetadataSearchOptions";var r=null;r=e.conf&&e.conf.searchUrl?e.conf.searchUrl:n.getAjaxUrl()+"action_route=GetMetadataSearch",e.conf&&"number"==typeof e.conf.priority&&(e.tabPriority=e.conf.priority);var s="Oskari.catalogue.bundle.metadatacatalogue.service.MetadataOptionService";e.optionService=Oskari.clazz.create(s,a);var o="Oskari.catalogue.bundle.metadatacatalogue.service.MetadataSearchService";e.searchService=Oskari.clazz.create(o,r),n.register(e);var l;for(l in e.eventHandlers)e.eventHandlers.hasOwnProperty(l)&&n.registerForEventByName(e,l);e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i="userinterface.RemoveExtensionRequest",n=t.getRequestBuilder(i),a=n(this);t.request(this,a),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},getTitle:function(){return this.getLocalization("tabTitle")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var e=this,t=e.templates.metadataTab.clone(),i=e.templates.optionPanel.clone(),n=e.templates.searchPanel.clone(),a=e.templates.resultPanel.clone();t.append(i),t.append(n),t.append(a),n.hide(),n.append(e.getLocalization("searching")),a.hide();var r=t.find("div.metadataCatalogueDescription");r.html(e.getLocalization("metadataCatalogueDescription"));var s=Oskari.clazz.create("Oskari.userinterface.component.FormInput");s.setPlaceholder(e.getLocalization("assistance")),s.setIds("oskari_metadatacatalogue_forminput","oskari_metadatacatalogue_forminput_searchassistance"),s.bindChange(function(){null===e.state&&(e.state={});var i=s.getValue();if(e.state.metadatacataloguetext=i,!i){var n=t.find("div.resultList");n.empty()}}),s.addClearButton("oskari_metadatacatalogue_forminput_clearbutton");var o=Oskari.clazz.create("Oskari.userinterface.component.Button");o.setTitle(e.getLocalization("metadataCatalogueButton")),o.setId("oskari_metadatacatalogue_button_search");var l=function(){t.find(".metadataOptions").hide(),t.find(".metadataSearching").show();var a={search:s.getValue()};if(v.html()===e.getLocalization("showLess")){var r,o,l,u,c,d,h,p=t.find(".checkboxRow");for(r=0;r<p.length;r+=1)if(o=jQuery(p[r]).find(".metadataMultiDef"),0!==o.length){for(l=[],u=0;u<o.length;u+=1)c=jQuery(o[u]),c.is(":checked")&&l.push(c.val());a[jQuery(o[0]).attr("name")]=l.join()}for(h=t.find(".dropdownRow"),r=0;r<h.length;r+=1)d=jQuery(h[r]).find(".metadataDef"),a[d.attr("name")]=d.find(":selected").val()}e.lastSearch=s.getValue(),e.searchService.doSearch(a,function(i){e._showResults(t,i)},function(){n.hide(),i.show();var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=t.createCloseButton("OK"),r=e.getLocalization("metadatasearchservice_alert_title"),s=e.getLocalization("metadatasearchservice_not_found_anything_text");t.show(r,s,[a])})};o.setHandler(l),s.bindEnterKey(l);var u=t.find("div.controls");u.append(s.getField()),u.append(o.getElement());var c=e.getLocalization("tabTitle"),d=t,h=this.tabPriority,p="oskari_metadatacatalogue_tabpanel_header",f="Search.AddTabRequest",m=e.sandbox.getRequestBuilder(f),g=m(c,d,h,p);e.sandbox.request(e,g);var v=this.templates.moreLessLink.clone();v.html(e.getLocalization("showMore")),v.click(function(){var i=t.find("div.advanced");v.html()===e.getLocalization("showMore")?(v.html(e.getLocalization("showLess")),i.is(":empty")?e.optionService.getOptions(function(t){e._createAdvancedPanel(t,i,v)},function(){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton("OK"),n=e.getLocalization("metadataoptionservice_alert_title"),a=e.getLocalization("metadataoptionservice_not_found_anything_text");t.show(n,a,[i])}):i.show()):(v.html(e.getLocalization("showMore")),i.hide())}),t.find("div.moreLess").append(v)},_createAdvancedPanel:function(e,t){var i,n,a,r,s,o,l,u,c,d,h,p,f,m=this,g=e.fields,v=function(){m._updateOptions(t)};for(i=0;i<g.length;i+=1)if(n=g[i],0!==n.values.length){if(a=null,r=m.getLocalization(n.field),"string"!=typeof r&&(r=n.field),n.multi)for(a=m.templates.checkboxRow.clone(),a.find("div.rowLabel").text(r),s=0;s<n.values.length;s+=1)o=n.values[s],l=m._getOptionLocalization(o),u=m.templates.metadataCheckbox.clone(),c=u.find(":checkbox"),c.attr("name",n.field),c.attr("value",o.val),u.find("label.metadataTypeText").append(l),u.change(v),a.find(".checkboxes").append(u);else{for(a=m.templates.dropdownRow.clone(),a.find("div.rowLabel").append(r),d=m.templates.metadataDropdown.clone(),h=d.find(".metadataDef"),h.attr("name",n.field),p=m.templates.dropdownOption.clone(),p.attr("value",""),p.text(m.getLocalization("emptyOption")),h.append(p),s=0;s<n.values.length;s+=1)o=n.values[s],l=m._getOptionLocalization(o),f=m.templates.dropdownOption.clone(),f.attr("value",o.val),f.text(l),h.append(f);d.find(".metadataDef").change(v),a.append(d)}"undefined"!=typeof n.shownIf&&n.shownIf.length>0&&(m.conditions.push({field:n.field,shownIf:n.shownIf}),a.hide()),a.addClass(n.field),t.append(a)}m._updateOptions(t)},_getOptionLocalization:function(e){var t,i=this;return"undefined"!=typeof e.locale?t=e.locale:(t=i.getLocalization(e.val),"string"!=typeof t&&(t=e.val)),t},_updateOptions:function(e){var t,i,n,a,r,s,o,l,u,c=this;for(t=0;t<c.conditions.length;t+=1)for(i=c.conditions[t],n=e.find("."+i.field),a=0;a<i.shownIf.length;a+=1){r=i.shownIf[a];for(s in r)if(r.hasOwnProperty(s))if(o=i.shownIf[a][s],l=e.find(".metadataRow."+s),l.hasClass("checkboxRow")){if(!l.find("input:checkbox[value="+o+"]").is(":checked"))return void n.hide()}else if(l.hasClass("dropdownRow")&&(u=l.find(".metadataDef option:selected").val(),o!==u))return void n.hide()}n.show()},_showResults:function(e,t){var i=this;i.lastResult=t.results;var n=e.find(".metadataResults"),a=e.find(".metadataSearching"),r=e.find(".metadataOptions");a.hide(),r.hide();var s=i.templates.resultHeader.clone();s.find(".resultTitle").text(i.getLocalization("metadataCatalogueResults"));var o=s.find(".showLink");o.hide(),o.html(i.getLocalization("showSearch")),o.click(function(){jQuery("table.metadataSearchResult tr").show(),o.hide()});var l=s.find(".modifyLink");l.html(i.getLocalization("modifySearch")),l.click(function(){n.empty(),r.show()});var u=i.templates.resultTable.clone(),c=u.find("thead tr"),d=u.find("tbody");d.empty();var h,p,f,m=function(e){return function(){var t,n=d.find("tr.resultRow:hidden"),a=[];for(t=0;t<n.length;t+=1)a.push(jQuery(n[t]).data("resultId"));d.empty();var r=!1;i.lastSort&&i.lastSort.attr===e.prop&&(r=!i.lastSort.descending),i._sortResults(e.prop,r),i._populateResultTable(d);var s,o,l=d.find("tr");for(t=0;t<l.length;t+=1)for(s=jQuery(l[t]).data("resultId"),o=0;o<a.length;o+=1)s===a[o]&&jQuery(l[t]).hide();var u=c.find("a:contains("+e.title+")");return c.find("th").removeClass("asc"),c.find("th").removeClass("desc"),u.parent().addClass(r?"desc":"asc"),!1}};for(h=0;h<i.resultHeaders.length;h+=1)p=i.templates.resultTableHeader.clone(),p.addClass(i.resultHeaders[h].prop),f=p.find("a"),f.append(i.resultHeaders[h].title),0===h&&f.bind("click",m(i.resultHeaders[h])),c.append(p);i._populateResultTable(d),n.append(s),n.append(u),r.hide(),n.show()},_populateResultTable:function(e){{var t,i=this,n=i.lastResult;i.sandbox.findAllSelectedMapLayers()}for(t=0;t<n.length;t+=1)n[t].name&&0!==n[t].name.length&&!function(t){var a,r,s,o,l,u,c,d,h,p;if(d=n[t],s=i.templates.resultTableRow.clone(),s.addClass("res"+t),s.data("resultId",d.id),o=s.find("td").not(".spacer"),l=d.name,d.organization&&d.organization.length>0&&(l=l+", "+d.organization),jQuery(o[0]).append(l),jQuery(o[0]).addClass(i.resultHeaders[0].prop),d.id&&d.id.length>0){if(h=i.sandbox.getService("Oskari.mapframework.service.MapLayerService"),u=h.getLayersByMetadataId(d.id),d.uuid&&d.uuid.length>0)e:for(a=0;a<d.uuid.length;a+=1)if(d.uuid[a]!==d.id){for(r=0;a>r;r+=1)if(d.uuid[r]===d.uuid[a])continue e;c=h.getLayersByMetadataId(d.uuid[a]),c&&c.length>0&&(u=u.concat(c))}a=0;e:for(;a<u.length;){for(r=0;a>r;r+=1)if(u[r].getId()===u[a].getId()){u.splice(a,1);continue e}a+=1}for(p=i.templates.layerList.clone(),a=0;a<u.length;a+=1)i._addLayerLinks(u[a],p);jQuery(o[0]).append(p),jQuery(o[1]).addClass(i.resultHeaders[1].prop),jQuery(o[2]).addClass(i.resultHeaders[2].prop),jQuery(o[2]).find("div.layerInfo").click(function(){var e="catalogue.ShowMetadataRequest";i.sandbox.postRequestByName(e,[{uuid:d.id}])}),jQuery(o[3]).addClass(i.resultHeaders[3].prop),jQuery(o[3]).find("div.resultRemove").click(function(){jQuery("table.metadataSearchResult tr.res"+t).hide(),jQuery("div.metadataResultHeader a.showLink").show()})}e.append(s)}(t)},_addLayerLinks:function(e,t){var i,n,a,r,s,o,l,u,c,d,h=this;a=!1,i=h.sandbox.findAllSelectedMapLayers();for(var p=0;p<i.length;p+=1)if(n=i[p],e.getId()===n.getId()){a=!0;break}d=h.templates.layerLink.clone(),r=h.getLocalization("show"),s=h.getLocalization("hide"),d.html(a&&e.isVisible()?s:r),d.click(function(){o=h.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),jQuery(this).html()===s?(l=h.sandbox.getRequestBuilder("RemoveMapLayerRequest"),a=!1,u=l(e.getId()),h.sandbox.request(h.getName(),u),jQuery(this).html(r)):(a||h.sandbox.postRequestByName("AddMapLayerRequest",[e.getId(),!1,e.isBaseLayer()]),u=o(e.getId(),!0),h.sandbox.request(h.getName(),u),jQuery(this).html(s))}),c=h.templates.layerListItem.clone(),c.text(e.getName()),c.append("&nbsp;&nbsp;"),c.append(d),t.append(c)},_sortResults:function(e,t){var i=this;this.lastResult&&(i.lastSort={attr:e,descending:t},this.lastResult.sort(function(n,a){return i._searchResultComparator(n,a,e,t)}))},_searchResultComparator:function(e,t,i,n){var a=e[i].toLowerCase(),r=t[i].toLowerCase(),s=0;return a===r&&(a=e.id,r=t.id),r>a?s=-1:a>r&&(s=1),n&&(s=-1*s),s},setState:function(){},getState:function(){}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),define("bundles/catalogue/bundle/metadatacatalogue/instance",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/catalogue/bundle/metadatacatalogue/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"catalogue.bundle.metadatacatalogue",value:{tabTitle:"Metatietohaku",metadataCatalogueDescription:"Hae paikkatietoaineistoja, -aineistosarjoja tai -palveluita.",metadataCatalogueButton:"Hae",assistance:"Kirjoita hakusana",showMore:"Lisää hakuehtoja",showLess:"Piilota laajennettu haku",emptyOption:"* Ei valintaa *",type:"Resurssin tyyppi",serviceType:"Palvelun tyyppi",Title:"Resurssin nimi",OrganisationName:"Vastaava organisaatio",coverage:"Maantieteellinen sijainti",inspireTheme:"Inspire-teema",Subject:"Avainsana",TopicCategory:"Aiheluokka",searchArea:"Hakualue",delimitArea:"Rajaa hakualue kartalta",dataset:"Aineisto",series:"Aineistosarja",service:"Palvelu",discovery:"Haku",download:"Lataus",other:"Muu",transformation:"Muunnos",view:"Katselu",Language:"Metatiedon kieli",ResourceLanguage:"Resurssin kieli",modifySearch:"Muokkaa hakua",showSearch:"Näytä kaikki hakutulokset",metadataCatalogueResults:"Hakutulokset",show:"Näytä karttataso",hide:"Poista karttataso",contentErrorMsg:"Hakusana ei saa sisältää merkkejä",metadataoptionservice_alert_title:"Virhe",metadataoptionservice_not_found_anything_text:"Vaihtoehtojen noutaminen epäonnistui.",metadatasearchservice_alert_title:"Virhe",metadatasearchservice_not_found_anything_text:"Hakutulosten noutaminen epäonnistui.",searching:"Haetaan…",grid:{name:"Nimi"}}}),define("bundles/catalogue/bundle/metadatacatalogue/locale/fi",function(){}),Oskari.registerLocalization({lang:"en",key:"catalogue.bundle.metadatacatalogue",value:{tabTitle:"Metadata Search",metadataCatalogueDescription:"Search metadata for datasets, dataset series or services.",metadataCatalogueButton:"Search",assistance:"Type the search term.",showMore:"Show search options",showLess:"Hide search options",emptyOption:"* No selection *",type:"Resource type",serviceType:"Service type",Title:"Resource name",OrganisationName:"Responsible party",coverage:"Geographic location",inspireTheme:"Inspire topic",Subject:"Keyword",TopicCategory:"Topic category",searchArea:"Search area",delimitArea:"Limit the search area on the map",dataset:"Dataset",series:"Series",service:"Service",discovery:"Discovery",download:"Download",other:"Other",transformation:"Transformation",view:"View",Language:"Metadata language",ResourceLanguage:"Resource language",modifySearch:"Edit search options",showSearch:"Show all search results",metadataCatalogueResults:"Search Results",show:"Show this map layer on the map.",hide:"Hide this map layer from the map.",contentErrorMsg:"Search term contains illegal characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces, *, ? and -.",metadataoptionservice_alert_title:"Error",metadataoptionservice_not_found_anything_text:"No search options found. Please try again later.",metadatasearchservice_alert_title:"Error",metadatasearchservice_not_found_anything_text:"No search results found. Please try again later.",searching:"Searching…",grid:{name:"Name"}}}),define("bundles/catalogue/bundle/metadatacatalogue/locale/en",function(){}),Oskari.registerLocalization({lang:"sv",key:"catalogue.bundle.metadatacatalogue",value:{tabTitle:"Metadatasökning",metadataCatalogueDescription:"Sök datamängder eller tjänster.",metadataCatalogueButton:"Sök",assistance:" ",showMore:"Mer sökvillkoren",showLess:"Mindre sökvillkoren",emptyOption:"* Inte valt *",type:"Typ",serviceType:"Typ av tjänst",Title:"Resursnamn",OrganisationName:"Ansvarig initiativ",coverage:"Geografisk läge",inspireTheme:"Inspire-tema",Subject:"Nyckelord",TopicCategory:"Ämneskategori",searchArea:"Sökområde",delimitArea:"Avgränsa sökområdet på kartan",dataset:"Datamängd",series:"Serie",service:"Tjänst",discovery:"Sök",download:"Nedladdning",other:"Andra",transformation:"Omvandling",view:"Visning",Language:"Metadataspråk",ResourceLanguage:"Resursspråk",modifySearch:"Redigera sök",showSearch:"Visa alla resultatet",metadataCatalogueResults:"Resultatet",show:"Visa kartlag",hide:"Ta kartlag bort",contentErrorMsg:"Sökord kan inte innehålla tecken ",metadataoptionservice_alert_title:"Fel",metadataoptionservice_not_found_anything_text:"Sök misslyckats.",metadatasearchservice_alert_title:"Fel",metadatasearchservice_not_found_anything_text:"Sök misslyckats.",searching:"Söker…",grid:{name:"Namn"}}}),define("bundles/catalogue/bundle/metadatacatalogue/locale/sv",function(){}),define("src/catalogue/metadatacatalogue/module",["oskari","jquery","bundles/catalogue/bundle/metadatacatalogue/service/MetadataOptionService","bundles/catalogue/bundle/metadatacatalogue/service/MetadataSearchService","bundles/catalogue/bundle/metadatacatalogue/instance","css!resources/catalogue/bundle/metadatacatalogue/css/style.css","bundles/catalogue/bundle/metadatacatalogue/locale/fi","bundles/catalogue/bundle/metadatacatalogue/locale/en","bundles/catalogue/bundle/metadatacatalogue/locale/sv"],function(e){return e.bundleCls("metadatacatalogue").category({create:function(){return e.clazz.create("Oskari.catalogue.bundle.metadatacatalogue.MetadataCatalogueBundleInstance")},start:function(){},stop:function(){},update:function(){}})}),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](u)}function t(){var t=c;l&&t.length&&(c=[],e(t))}function i(){l||(l=!0,s&&clearInterval(s),t())}function n(e){return l?e(u):c.push(e),n}var a,r,s,o="undefined"!=typeof window&&window.document,l=!o,u=o?document:null,c=[];if(o){if(document.addEventListener)document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1);else if(window.attachEvent){window.attachEvent("onload",i),r=document.createElement("div");try{a=null===window.frameElement}catch(d){}r.doScroll&&a&&window.external&&(s=setInterval(function(){try{r.doScroll(),i()}catch(e){}},30))}"complete"===document.readyState&&i()}return n.version="2.0.1",n.load=function(e,t,i,a){a.isBuild?i(null):n(i)},n}),require.config({baseUrl:"/Oskari/",paths:{oskari:"src/oskari/oskari","oskari-with-app":"src/oskari/oskari-with-app","oskari-with-loader":"src/oskari/oskari-with-loader",jquery:"http://code.jquery.com/jquery-1.9.1","jquery-ui":"libraries/jquery/jquery-ui-1.9.2.custom",dragevent:"libraries/jquery/jquery.event.drag-2.0.min","jquery-migrate":"libraries/jquery/jquery-migrate-1.2.1-modified",css:"libraries/requirejs/lib/css",json:"libraries/requirejs/lib/json",domReady:"libraries/requirejs/lib/domReady",text:"libraries/requirejs/lib/text",i18n:"libraries/requirejs/lib/i18n",normalize:"libraries/requirejs/lib/normalize",lodash:"libraries/lodash/2.3.0/lodash"},map:{"*":{oskari:"oskari-with-app",jquery:"jquery-migrate","openlayers-default-theme":"src/oskari/map-ol2/module",mapfull:"src/mapping/mapmodule/ol2/mapfull/module",divmanazer:"src/framework/divmanazer/module",toolbar:"src/framework/toolbar/module",statehandler:"src/framework/statehandler/module",infobox:"src/framework/infobox/module",search:"src/framework/search/module",routesearch:"src/framework/routesearch/module",layerselector2:"src/framework/layerselector2/module",layerselection2:"src/framework/layerselection2/module",personaldata:"src/framework/personaldata/module",featuredata2:"src/framework/featuredata2/module",maplegend:"src/framework/maplegend/module",userguide:"src/framework/userguide/module",backendstatus:"src/framework/backendstatus/module",postprocessor:"src/framework/postprocessor/module",publisher:"src/framework/publisher/module",guidedtour:"src/framework/guidedtour/module",mapstats:"src/framework/mapstats/module",mapwfs2:"src/framework/mapwfs2/module",mapwmts:"src/framework/mapwmts/module",mapmyplaces:"src/framework/mapmyplaces/module",mapanalysis:"src/framework/mapanalysis/module",statsgrid:"src/statistics/statsgrid/module",metadataflyout:"src/catalogue/metadataflyout/module",metadatacatalogue:"src/catalogue/metadatacatalogue/module",printout:"src/framework/printout/module",coordinatedisplay:"src/framework/coordinatedisplay/module",analyse:"src/analysis/analyse/module",myplaces2:"src/framework/myplaces2/module",promote:"src/framework/promote/module",oskariui:"src/framework/oskariui/module"},"jquery-migrate":{jquery:"jquery"}},shim:{"jquery-ui":{exports:"$",deps:["jquery"]},dragevent:{exports:"$",deps:["jquery"]},oskari:{exports:"Oskari"},lodash:{exports:"_"}},waitSeconds:30}),require(["jquery","oskari-with-app","domReady"],function(e,t){function i(e){var t=e+"=([^&]*)(&|$)",i=RegExp(t).exec(location.search);return i&&i.length&&i.length>1&&(i=i[1]),i?decodeURI(i):null}function n(e){if("true"==i("showGetFeatureInfo")){var t=e.getMap().getX(),n=e.getMap().getY(),a=e.findRegisteredModuleInstance("MainMapModule"),r=a.getMap().getViewPortPxFromLonLat({lon:t,lat:n});e.postRequestByName("MapModulePlugin.GetFeatureInfoRequest",[t,n,r.x,r.y])}}var a="json!applications/oskari2/full-map_guest/minifierAppSetup.json";if(window.ajaxUrl){var r="";if("object"==typeof window.controlParams)for(var s in controlParams)r+="&"+s+"="+controlParams[s];a="json!"+window.ajaxUrl+"action_route=GetAppSetup"+r}require([a],function(e){t.setLang(language),t.Application.create().setStartupSequence(e.startupSequence).setConfiguration(e.configuration).start().success(function(){var e=t.getSandbox();n(e)})})}),define("applications/oskari2/full-map_guest/main-dev",function(){}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer("/*! jQuery UI - v1.9.2 - 2014-06-02\n* http://jqueryui.com\n* Includes: jquery.ui.core.css, jquery.ui.resizable.css, jquery.ui.selectable.css, jquery.ui.autocomplete.css, jquery.ui.menu.css, jquery.ui.slider.css, jquery.ui.tooltip.css, jquery.ui.theme.css\n* To view and modify this theme, visit http://jqueryui.com/themeroller/?ffDefault=Segoe%20UI%2CArial%2Csans-serif&fwDefault=bold&fsDefault=1.1em&cornerRadius=6px&bgColorHeader=333333&bgTextureHeader=gloss_wave&bgImgOpacityHeader=25&borderColorHeader=333333&fcHeader=ffffff&iconColorHeader=ffffff&bgColorContent=000000&bgTextureContent=inset_soft&bgImgOpacityContent=25&borderColorContent=666666&fcContent=ffffff&iconColorContent=cccccc&bgColorDefault=555555&bgTextureDefault=glass&bgImgOpacityDefault=20&borderColorDefault=666666&fcDefault=eeeeee&iconColorDefault=cccccc&bgColorHover=0078a3&bgTextureHover=glass&bgImgOpacityHover=40&borderColorHover=59b4d4&fcHover=ffffff&iconColorHover=ffffff&bgColorActive=f58400&bgTextureActive=inset_soft&bgImgOpacityActive=30&borderColorActive=ffaf0f&fcActive=ffffff&iconColorActive=222222&bgColorHighlight=eeeeee&bgTextureHighlight=highlight_soft&bgImgOpacityHighlight=80&borderColorHighlight=cccccc&fcHighlight=2e7db2&iconColorHighlight=4b8e0b&bgColorError=ffc73d&bgTextureError=glass&bgImgOpacityError=40&borderColorError=ffb73d&fcError=111111&iconColorError=a83300&bgColorOverlay=5c5c5c&bgTextureOverlay=flat&bgImgOpacityOverlay=50&opacityOverlay=80&bgColorShadow=cccccc&bgTextureShadow=flat&bgImgOpacityShadow=30&opacityShadow=60&thicknessShadow=7px&offsetTopShadow=-7px&offsetLeftShadow=-7px&cornerRadiusShadow=8px\n* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden { display: none; }\n.ui-helper-hidden-accessible { border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px; }\n.ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }\n.ui-helper-clearfix:before, .ui-helper-clearfix:after { content: \"\"; display: table; }\n.ui-helper-clearfix:after { clear: both; }\n.ui-helper-clearfix { zoom: 1; }\n.ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled { cursor: default !important; }\n\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; }\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }\n.ui-resizable { position: relative;}\n.ui-resizable-handle { position: absolute;font-size: 0.1px; display: block; }\n.ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }\n.ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }\n.ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }\n.ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }\n.ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }\n.ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }\n.ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }\n.ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }\n.ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}.ui-selectable-helper { position: absolute; z-index: 100; border:1px dotted black; }\n.ui-autocomplete {\n    background-color: #FFF;\n    border-color: #B7B7B7;\n    border-style: solid;\n    border-width: 0 1px 1px 1px;\n    position: absolute;\n    top: 0;\n    left: 0;\n    cursor: default;\n}\n\n/* workarounds */\n* html .ui-autocomplete { width:1px; } /* without this, the menu expands to 100% in IE6 */\n.ui-menu { list-style:none; padding: 2px; margin: 0; display:block; outline: none; }\n.ui-menu .ui-menu { margin-top: -3px; position: absolute; }\n.ui-menu .ui-menu-item { margin: 0; padding: 0; zoom: 1; width: 100%; border-color:#E6E6E6; border-style: solid; border-width: 0 0 1px 0;  }\n.ui-menu .ui-menu-item:last-of-type { border-bottom: none;}\n.ui-menu .ui-menu-divider { margin: 5px -2px 5px -2px; height: 0; font-size: 0; line-height: 0; border-width: 1px 0 0 0; }\n.ui-menu .ui-menu-item a { text-decoration: none; color: #878787; display: block; padding: 2px .4em; line-height: 1.5; zoom: 1; font-weight: normal; }\n.ui-menu .ui-menu-item a.ui-state-focus,\n.ui-menu .ui-menu-item a.ui-state-active { color: #3C3C3C; background-color: #F3F3F3; }\n\n.ui-menu .ui-state-disabled { font-weight: normal; margin: .4em 0 .2em; line-height: 1.5; }\n.ui-menu .ui-state-disabled a { cursor: default; }\n\n/* icon support */\n.ui-menu-icons { position: relative; }\n.ui-menu-icons .ui-menu-item a { position: relative; padding-left: 2em; }\n\n/* left-aligned */\n.ui-menu .ui-icon { position: absolute; top: .2em; left: .2em; }\n\n/* right-aligned */\n.ui-menu .ui-menu-icon { position: static; float: right; }\n.oskariui .ui-slider { position: relative; text-align: left; }\n.oskariui .ui-slider .ui-slider-handle { position: absolute; width: 16px; height: 17px; cursor: default; }\n.oskariui .ui-slider .ui-slider-range { position: absolute; font-size: .7em; display: block; border: 0; background-position: 0 0; }\n\n.oskariui .ui-slider-horizontal { height: 14px; }\n.oskariui .ui-slider-horizontal .ui-slider-handle { background-image: url('/Oskari/resources/framework/bundle/oskariui/images/horizontal_handle.png'); background-repeat: no-repeat;}\n\n.oskariui .ui-slider-horizontal .ui-slider-range { top: 0; height: 100%; }\n.oskariui .ui-slider-horizontal .ui-slider-range-min { left: 0; }\n.oskariui .ui-slider-horizontal .ui-slider-range-max { right: 0; }\n\n.oskariui .ui-slider-vertical { margin-left: 2px; width: 24px; background-image: url('/Oskari/resources/framework/bundle/oskariui/images/zoombar_part.png'); background-repeat: repeat-y; }\n.oskariui .ui-slider-vertical .ui-slider-handle { margin-left: 0; background-image: url('/Oskari/resources/framework/bundle/oskariui/images/zoombar_cursor.png'); background-repeat: no-repeat;}\n.oskariui .ui-slider-vertical .ui-slider-range { left: 0; width: 100%; }\n.oskariui .ui-slider-vertical .ui-slider-range-min { bottom: 0; }\n.oskariui .ui-slider-vertical .ui-slider-range-max { top: 0; }.ui-tooltip {\n    padding: 8px;\n    position: absolute;\n    z-index: 9999;\n    max-width: 300px;\n    -webkit-box-shadow: 0 0 5px #aaa;\n    box-shadow: 0 0 5px #aaa;\n}\n/* Fades and background-images don't work well together in IE6, drop the image */\n* html .ui-tooltip {\n    background-image: none;\n}\nbody .oskariui .ui-tooltip { border-width: 2px; }\n\n/* Component containers\n----------------------------------*/\n.oskariui .ui-widget { font-family: Segoe UI,Arial,sans-serif; font-size: 1.1em; }\n.oskariui .ui-widget .ui-widget { font-size: 1em; }\n.oskariui .ui-widget input, .oskariui .ui-widget select, .oskariui .ui-widget textarea, .oskariui .ui-widget button { font-family: Segoe UI,Arial,sans-serif; font-size: 1em; }\n.oskariui .ui-widget-content {  }\n.oskariui .ui-widget-content a {  }\n.oskariui .ui-widget-header {  }\n.oskariui .ui-widget-header a {  }\n\n/* Interaction states\n----------------------------------*/\n.oskariui .ui-state-default, .oskariui .ui-widget-content .ui-state-default, .oskariui .ui-widget-header .ui-state-default {  }\n.oskariui .ui-state-default a, .oskariui .ui-state-default a:link, .oskariui .ui-state-default a:visited {  }\n.oskariui .ui-state-hover, .oskariui .ui-widget-content .ui-state-hover, .oskariui .ui-widget-header .ui-state-hover, .oskariui .ui-state-focus, .oskariui .ui-widget-content .ui-state-focus, .oskariui .ui-widget-header .ui-state-focus {  }\n.oskariui .ui-state-hover a, .oskariui .ui-state-hover a:hover, .oskariui .ui-state-hover a:link, .oskariui .ui-state-hover a:visited { }\n.oskariui .ui-state-active, .oskariui .ui-widget-content .ui-state-active, .oskariui .ui-widget-header .ui-state-active {  }\n.oskariui .ui-state-active a, .oskariui .ui-state-active a:link, .oskariui .ui-state-active a:visited {  }\n\n/* Interaction Cues\n----------------------------------*/\n.oskariui .ui-state-highlight, .oskariui .ui-widget-content .ui-state-highlight, .oskariui .ui-widget-header .ui-state-highlight  { }\n.oskariui .ui-state-highlight a, .oskariui .ui-widget-content .ui-state-highlight a,.oskariui .ui-widget-header .ui-state-highlight a { }\n.oskariui .ui-state-error, .oskariui .ui-widget-content .ui-state-error, .oskariui .ui-widget-header .ui-state-error { }\n.oskariui .ui-state-error a, .oskariui .ui-widget-content .ui-state-error a, .oskariui .ui-widget-header .ui-state-error a { }\n.oskariui .ui-state-error-text, .oskariui .ui-widget-content .ui-state-error-text, .oskariui .ui-widget-header .ui-state-error-text {  }\n.oskariui .ui-priority-primary, .oskariui .ui-widget-content .ui-priority-primary, .oskariui .ui-widget-header .ui-priority-primary {  }\n.oskariui .ui-priority-secondary, .oskariui .ui-widget-content .ui-priority-secondary,  .oskariui .ui-widget-header .ui-priority-secondary { }\n.oskariui .ui-state-disabled, .oskariui .ui-widget-content .ui-state-disabled, .oskariui .ui-widget-header .ui-state-disabled {  }\n.oskariui .ui-state-disabled .ui-icon { filter:Alpha(Opacity=35); } /* For IE8 - See #6059 */\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.oskariui .ui-icon { width: 16px; height: 16px; }\n.oskariui .ui-widget-content .ui-icon { }\n.oskariui .ui-widget-header .ui-icon { }\n.oskariui .ui-state-default .ui-icon {  }\n.oskariui .ui-state-hover .ui-icon, .oskariui .ui-state-focus .ui-icon {}\n.oskariui .ui-state-active .ui-icon { }\n.oskariui .ui-state-highlight .ui-icon { }\n.oskariui .ui-state-error .ui-icon, .oskariui .ui-state-error-text .ui-icon { }\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.oskariui .ui-corner-all, .oskariui .ui-corner-top, .oskariui .ui-corner-left, .oskariui .ui-corner-tl { -moz-border-radius-topleft: 6px; -webkit-border-top-left-radius: 6px; -khtml-border-top-left-radius: 6px; border-top-left-radius: 6px; }\n.oskariui .ui-corner-all, .oskariui .ui-corner-top, .oskariui .ui-corner-right, .oskariui .ui-corner-tr { -moz-border-radius-topright: 6px; -webkit-border-top-right-radius: 6px; -khtml-border-top-right-radius: 6px; border-top-right-radius: 6px; }\n.oskariui .ui-corner-all, .oskariui .ui-corner-bottom, .oskariui .ui-corner-left, .oskariui .ui-corner-bl { -moz-border-radius-bottomleft: 6px; -webkit-border-bottom-left-radius: 6px; -khtml-border-bottom-left-radius: 6px; border-bottom-left-radius: 6px; }\n.oskariui .ui-corner-all, .oskariui .ui-corner-bottom, .oskariui .ui-corner-right, .oskariui .ui-corner-br { -moz-border-radius-bottomright: 6px; -webkit-border-bottom-right-radius: 6px; -khtml-border-bottom-right-radius: 6px; border-bottom-right-radius: 6px; }\n\n/* Overlays */\n.oskariui .ui-widget-overlay { background: #5c5c5c url(\"resources/framework/bundle/oskariui/css/images/ui-bg_flat_50_5c5c5c_40x100.png\") 50% 50% repeat-x; opacity: .8;filter:Alpha(Opacity=80); }\n.oskariui .ui-widget-shadow { margin: -7px 0 0 -7px; padding: 7px; background: #cccccc url(\"resources/framework/bundle/oskariui/css/images/ui-bg_flat_30_cccccc_40x100.png\") 50% 50% repeat-x; opacity: .6;filter:Alpha(Opacity=60); -moz-border-radius: 8px; -khtml-border-radius: 8px; -webkit-border-radius: 8px; border-radius: 8px; }/*!\r\n * Bootstrap v2.3.1\r\n *\r\n * Copyright 2012 Twitter, Inc\r\n * Licensed under the Apache License v2.0\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Designed and built with all the love in the world @twitter by @mdo and @fat.\r\n */\r\n.oskariui .clearfix {\r\n  *zoom: 1;\r\n}\r\n.oskariui .clearfix:before,\r\n.oskariui .clearfix:after {\r\n  display: table;\r\n  content: \"\";\r\n  line-height: 0;\r\n}\r\n.oskariui .clearfix:after {\r\n  clear: both;\r\n}\r\n.oskariui .hide-text {\r\n  font: 0/0 a;\r\n  color: transparent;\r\n  text-shadow: none;\r\n  background-color: transparent;\r\n  border: 0;\r\n}\r\n.oskariui .input-block-level {\r\n  display: block;\r\n  width: 100%;\r\n  min-height: 30px;\r\n  -webkit-box-sizing: border-box;\r\n  -moz-box-sizing: border-box;\r\n  box-sizing: border-box;\r\n}\r\n.oskariui .row {\r\n  margin-left: -20px;\r\n  *zoom: 1;\r\n}\r\n.oskariui .row:before,\r\n.oskariui .row:after {\r\n  display: table;\r\n  content: \"\";\r\n  line-height: 0;\r\n}\r\n.oskariui .row:after {\r\n  clear: both;\r\n}\r\n[class*=\"span\"] {\r\n  float: left;\r\n  min-height: 1px;\r\n  margin-left: 20px;\r\n}\r\n.oskariui .container,\r\n.oskariui .navbar-static-top .container,\r\n.oskariui .navbar-fixed-top .container,\r\n.oskariui .navbar-fixed-bottom .container {\r\n  width: 940px;\r\n}\r\n.oskariui .span12 {\r\n  width: 940px;\r\n}\r\n.oskariui .span11 {\r\n  width: 860px;\r\n}\r\n.oskariui .span10 {\r\n  width: 780px;\r\n}\r\n.oskariui .span9 {\r\n  width: 700px;\r\n}\r\n.oskariui .span8 {\r\n  width: 620px;\r\n}\r\n.oskariui .span7 {\r\n  width: 540px;\r\n}\r\n.oskariui .span6 {\r\n  width: 460px;\r\n}\r\n.oskariui .span5 {\r\n  width: 380px;\r\n}\r\n.oskariui .span4 {\r\n  width: 300px;\r\n}\r\n.oskariui .span3 {\r\n  width: 220px;\r\n}\r\n.oskariui .span2 {\r\n  width: 140px;\r\n}\r\n.oskariui .span1 {\r\n  width: 60px;\r\n}\r\n.oskariui .offset12 {\r\n  margin-left: 980px;\r\n}\r\n.oskariui .offset11 {\r\n  margin-left: 900px;\r\n}\r\n.oskariui .offset10 {\r\n  margin-left: 820px;\r\n}\r\n.oskariui .offset9 {\r\n  margin-left: 740px;\r\n}\r\n.oskariui .offset8 {\r\n  margin-left: 660px;\r\n}\r\n.oskariui .offset7 {\r\n  margin-left: 580px;\r\n}\r\n.oskariui .offset6 {\r\n  margin-left: 500px;\r\n}\r\n.oskariui .offset5 {\r\n  margin-left: 420px;\r\n}\r\n.oskariui .offset4 {\r\n  margin-left: 340px;\r\n}\r\n.oskariui .offset3 {\r\n  margin-left: 260px;\r\n}\r\n.oskariui .offset2 {\r\n  margin-left: 180px;\r\n}\r\n.oskariui .offset1 {\r\n  margin-left: 100px;\r\n}\r\n.oskariui .row-fluid {\r\n  width: 100%;\r\n  *zoom: 1;\r\n}\r\n.oskariui .row-fluid:before,\r\n.oskariui .row-fluid:after {\r\n  display: table;\r\n  content: \"\";\r\n  line-height: 0;\r\n}\r\n.oskariui .row-fluid:after {\r\n  clear: both;\r\n}\r\n.oskariui .row-fluid [class*=\"span\"] {\r\n  display: block;\r\n  width: 100%;\r\n  min-height: 30px;\r\n  -webkit-box-sizing: border-box;\r\n  -moz-box-sizing: border-box;\r\n  box-sizing: border-box;\r\n  float: left;\r\n  margin-left: 2.127659574468085%;\r\n  *margin-left: 2.074468085106383%;\r\n}\r\n.oskariui .row-fluid [class*=\"span\"]:first-child {\r\n  margin-left: 0;\r\n}\r\n.oskariui .row-fluid .controls-row [class*=\"span\"] + [class*=\"span\"] {\r\n  margin-left: 2.127659574468085%;\r\n}\r\n.oskariui .row-fluid .span12 {\r\n  width: 100%;\r\n  *width: 99.94680851063829%;\r\n}\r\n.oskariui .row-fluid .span11 {\r\n  width: 91.48936170212765%;\r\n  *width: 91.43617021276594%;\r\n}\r\n.oskariui .row-fluid .span10 {\r\n  width: 82.97872340425532%;\r\n  *width: 82.92553191489361%;\r\n}\r\n.oskariui .row-fluid .span9 {\r\n  width: 74.46808510638297%;\r\n  *width: 74.41489361702126%;\r\n}\r\n.oskariui .row-fluid .span8 {\r\n  width: 65.95744680851064%;\r\n  *width: 65.90425531914893%;\r\n}\r\n.oskariui .row-fluid .span7 {\r\n  width: 57.44680851063829%;\r\n  *width: 57.39361702127659%;\r\n}\r\n.oskariui .row-fluid .span6 {\r\n  width: 48.93617021276595%;\r\n  *width: 48.88297872340425%;\r\n}\r\n.oskariui .row-fluid .span5 {\r\n  width: 40.42553191489362%;\r\n  *width: 40.37234042553192%;\r\n}\r\n.oskariui .row-fluid .span4 {\r\n  width: 31.914893617021278%;\r\n  *width: 31.861702127659576%;\r\n}\r\n.oskariui .row-fluid .span3 {\r\n  width: 23.404255319148934%;\r\n  *width: 23.351063829787233%;\r\n}\r\n.oskariui .row-fluid .span2 {\r\n  width: 14.893617021276595%;\r\n  *width: 14.840425531914894%;\r\n}\r\n.oskariui .row-fluid .span1 {\r\n  width: 6.382978723404255%;\r\n  *width: 6.329787234042553%;\r\n}\r\n.oskariui .row-fluid .offset12 {\r\n  margin-left: 104.25531914893617%;\r\n  *margin-left: 104.14893617021275%;\r\n}\r\n.oskariui .row-fluid .offset12:first-child {\r\n  margin-left: 102.12765957446808%;\r\n  *margin-left: 102.02127659574467%;\r\n}\r\n.oskariui .row-fluid .offset11 {\r\n  margin-left: 95.74468085106382%;\r\n  *margin-left: 95.6382978723404%;\r\n}\r\n.oskariui .row-fluid .offset11:first-child {\r\n  margin-left: 93.61702127659574%;\r\n  *margin-left: 93.51063829787232%;\r\n}\r\n.oskariui .row-fluid .offset10 {\r\n  margin-left: 87.23404255319149%;\r\n  *margin-left: 87.12765957446807%;\r\n}\r\n.oskariui .row-fluid .offset10:first-child {\r\n  margin-left: 85.1063829787234%;\r\n  *margin-left: 84.99999999999999%;\r\n}\r\n.oskariui .row-fluid .offset9 {\r\n  margin-left: 78.72340425531914%;\r\n  *margin-left: 78.61702127659572%;\r\n}\r\n.oskariui .row-fluid .offset9:first-child {\r\n  margin-left: 76.59574468085106%;\r\n  *margin-left: 76.48936170212764%;\r\n}\r\n.oskariui .row-fluid .offset8 {\r\n  margin-left: 70.2127659574468%;\r\n  *margin-left: 70.10638297872339%;\r\n}\r\n.oskariui .row-fluid .offset8:first-child {\r\n  margin-left: 68.08510638297872%;\r\n  *margin-left: 67.9787234042553%;\r\n}\r\n.oskariui .row-fluid .offset7 {\r\n  margin-left: 61.70212765957446%;\r\n  *margin-left: 61.59574468085106%;\r\n}\r\n.oskariui .row-fluid .offset7:first-child {\r\n  margin-left: 59.574468085106375%;\r\n  *margin-left: 59.46808510638297%;\r\n}\r\n.oskariui .row-fluid .offset6 {\r\n  margin-left: 53.191489361702125%;\r\n  *margin-left: 53.085106382978715%;\r\n}\r\n.oskariui .row-fluid .offset6:first-child {\r\n  margin-left: 51.063829787234035%;\r\n  *margin-left: 50.95744680851063%;\r\n}\r\n.oskariui .row-fluid .offset5 {\r\n  margin-left: 44.68085106382979%;\r\n  *margin-left: 44.57446808510638%;\r\n}\r\n.oskariui .row-fluid .offset5:first-child {\r\n  margin-left: 42.5531914893617%;\r\n  *margin-left: 42.4468085106383%;\r\n}\r\n.oskariui .row-fluid .offset4 {\r\n  margin-left: 36.170212765957444%;\r\n  *margin-left: 36.06382978723405%;\r\n}\r\n.oskariui .row-fluid .offset4:first-child {\r\n  margin-left: 34.04255319148936%;\r\n  *margin-left: 33.93617021276596%;\r\n}\r\n.oskariui .row-fluid .offset3 {\r\n  margin-left: 27.659574468085104%;\r\n  *margin-left: 27.5531914893617%;\r\n}\r\n.oskariui .row-fluid .offset3:first-child {\r\n  margin-left: 25.53191489361702%;\r\n  *margin-left: 25.425531914893618%;\r\n}\r\n.oskariui .row-fluid .offset2 {\r\n  margin-left: 19.148936170212764%;\r\n  *margin-left: 19.04255319148936%;\r\n}\r\n.oskariui .row-fluid .offset2:first-child {\r\n  margin-left: 17.02127659574468%;\r\n  *margin-left: 16.914893617021278%;\r\n}\r\n.oskariui .row-fluid .offset1 {\r\n  margin-left: 10.638297872340425%;\r\n  *margin-left: 10.53191489361702%;\r\n}\r\n.oskariui .row-fluid .offset1:first-child {\r\n  margin-left: 8.51063829787234%;\r\n  *margin-left: 8.404255319148938%;\r\n}\r\n[class*=\"span\"].hide,\r\n.oskariui .row-fluid [class*=\"span\"].hide {\r\n  display: none;\r\n}\r\n[class*=\"span\"].pull-right,\r\n.oskariui .row-fluid [class*=\"span\"].pull-right {\r\n  float: right;\r\n}\r\n.oskariui .container {\r\n  margin-right: auto;\r\n  margin-left: auto;\r\n  *zoom: 1;\r\n}\r\n.oskariui .container:before,\r\n.oskariui .container:after {\r\n  display: table;\r\n  content: \"\";\r\n  line-height: 0;\r\n}\r\n.oskariui .container:after {\r\n  clear: both;\r\n}\r\n.oskariui .container-fluid {\r\n  padding-right: 20px;\r\n  padding-left: 20px;\r\n  *zoom: 1;\r\n}\r\n.oskariui .container-fluid:before,\r\n.oskariui .container-fluid:after {\r\n  display: table;\r\n  content: \"\";\r\n  line-height: 0;\r\n}\r\n.oskariui .container-fluid:after {\r\n  clear: both;\r\n}\r\ndiv.olMap {\r\n    z-index: 0;\r\n    padding: 0 !important;\r\n    margin: 0 !important;\r\n    cursor: default;\r\n}\r\n\r\ndiv.olMapViewport {\r\n    text-align: left;\r\n}\r\n\r\ndiv.olLayerDiv {\r\n   -moz-user-select: none;\r\n   -khtml-user-select: none;\r\n}\r\n\r\n.olLayerGoogleCopyright {\r\n    left: 2px;\r\n    bottom: 2px;\r\n}\r\n.olLayerGoogleV3.olLayerGoogleCopyright {\r\n    right: auto !important;\r\n}\r\n.olLayerGooglePoweredBy {\r\n    left: 2px;\r\n    bottom: 15px;\r\n}\r\n.olLayerGoogleV3.olLayerGooglePoweredBy {\r\n    bottom: 15px !important;\r\n}\r\n.olControlAttribution {\r\n    font-size: smaller;\r\n    right: 3px;\r\n    bottom: 4.5em;\r\n    position: absolute;\r\n    display: block;\r\n}\r\n.olControlScale {\r\n    right: 3px;\r\n    bottom: 3em;\r\n    display: block;\r\n    position: absolute;\r\n    font-size: smaller;\r\n}\r\n.olControlScaleLine {\r\n   display: block;\r\n   position: absolute;\r\n   left: 10px;\r\n   bottom: 15px;\r\n   font-size: xx-small;\r\n}\r\n.olControlScaleLineBottom {\r\n   border: solid 2px black;\r\n   border-bottom: none;\r\n   margin-top:-2px;\r\n   text-align: center;\r\n}\r\n.olControlScaleLineTop {\r\n   border: solid 2px black;\r\n   border-top: none;\r\n   text-align: center;\r\n}\r\n\r\n.olControlPermalink {\r\n    right: 3px;\r\n    bottom: 1.5em;\r\n    display: block;\r\n    position: absolute;\r\n    font-size: smaller;\r\n}\r\n\r\ndiv.olControlMousePosition {\r\n    bottom: 0;\r\n    right: 3px;\r\n    display: block;\r\n    position: absolute;\r\n    font-family: Arial;\r\n    font-size: smaller;\r\n}\r\n\r\n.olControlOverviewMapContainer {\r\n    position: absolute;\r\n    bottom: 0;\r\n    right: 0;\r\n}\r\n\r\n.olControlOverviewMapElement {\r\n    padding: 10px 18px 10px 10px;\r\n    background-color: #00008B;\r\n    -moz-border-radius: 1em 0 0 0;\r\n}\r\n\r\n.olControlOverviewMapMinimizeButton,\r\n.olControlOverviewMapMaximizeButton {\r\n    height: 18px;\r\n    width: 18px;\r\n    right: 0;\r\n    bottom: 80px;\r\n    cursor: pointer;\r\n}\r\n\r\n.olControlOverviewMapExtentRectangle {\r\n    overflow: hidden;\r\n    background-image: url(\"resources/openlayers/theme/default/img/blank.gif\");\r\n    cursor: move;\r\n    border: 2px dotted red;\r\n}\r\n.olControlOverviewMapRectReplacement {\r\n    overflow: hidden;\r\n    cursor: move;\r\n    background-image: url(\"resources/openlayers/theme/default/img/overview_replacement.gif\");\r\n    background-repeat: no-repeat;\r\n    background-position: center;\r\n}\r\n\r\n.olLayerGeoRSSDescription {\r\n    float:left;\r\n    width:100%;\r\n    overflow:auto;\r\n    font-size:1.0em;\r\n}\r\n.olLayerGeoRSSClose {\r\n    float:right;\r\n    color:gray;\r\n    font-size:1.2em;\r\n    margin-right:6px;\r\n    font-family:sans-serif;\r\n}\r\n.olLayerGeoRSSTitle {\r\n    float:left;font-size:1.2em;\r\n}\r\n\r\n.olPopupContent {\r\n    padding:5px;\r\n    overflow: auto;\r\n}\r\n\r\n.olControlNavigationHistory {\r\n   background-image: url(\"resources/openlayers/theme/default/img/navigation_history.png\");\r\n   background-repeat: no-repeat;\r\n   width:  24px;\r\n   height: 24px;\r\n\r\n}\r\n.olControlNavigationHistoryPreviousItemActive {\r\n  background-position: 0 0;\r\n}\r\n.olControlNavigationHistoryPreviousItemInactive {\r\n   background-position: 0 -24px;\r\n}\r\n.olControlNavigationHistoryNextItemActive {\r\n   background-position: -24px 0;\r\n}\r\n.olControlNavigationHistoryNextItemInactive {\r\n   background-position: -24px -24px;\r\n}\r\n\r\ndiv.olControlSaveFeaturesItemActive {\r\n    background-image: url(resources/openlayers/theme/default/img/save_features_on.png);\r\n    background-repeat: no-repeat;\r\n    background-position: 0 1px;\r\n}\r\ndiv.olControlSaveFeaturesItemInactive {\r\n    background-image: url(resources/openlayers/theme/default/img/save_features_off.png);\r\n    background-repeat: no-repeat;\r\n    background-position: 0 1px;\r\n}\r\n\r\n.olHandlerBoxZoomBox {\r\n    border: 2px solid red;\r\n    position: absolute;\r\n    background-color: white;\r\n    opacity: 0.50;\r\n    font-size: 1px;\r\n    filter: alpha(opacity=50);\r\n}\r\n.olHandlerBoxSelectFeature {\r\n    border: 2px solid blue;\r\n    position: absolute;\r\n    background-color: white;\r\n    opacity: 0.50;\r\n    font-size: 1px;\r\n    filter: alpha(opacity=50);\r\n}\r\n\r\n.olControlPanPanel {\r\n    top: 10px;\r\n    left: 5px;\r\n}\r\n\r\n.olControlPanPanel div {\r\n    background-image: url(resources/openlayers/theme/default/img/pan-panel.png);\r\n    height: 18px;\r\n    width: 18px;\r\n    cursor: pointer;\r\n    position: absolute;\r\n}\r\n\r\n.olControlPanPanel .olControlPanNorthItemInactive {\r\n    top: 0;\r\n    left: 9px;\r\n    background-position: 0 0;\r\n}\r\n.olControlPanPanel .olControlPanSouthItemInactive {\r\n    top: 36px;\r\n    left: 9px;\r\n    background-position: 18px 0;\r\n}\r\n.olControlPanPanel .olControlPanWestItemInactive {\r\n    position: absolute;\r\n    top: 18px;\r\n    left: 0;\r\n    background-position: 0 18px;\r\n}\r\n.olControlPanPanel .olControlPanEastItemInactive {\r\n    top: 18px;\r\n    left: 18px;\r\n    background-position: 18px 18px;\r\n}\r\n\r\n.olControlZoomPanel {\r\n    top: 71px;\r\n    left: 14px;\r\n}\r\n\r\n.olControlZoomPanel div {\r\n    background-image: url(resources/openlayers/theme/default/img/zoom-panel.png);\r\n    position: absolute;\r\n    height: 18px;\r\n    width: 18px;\r\n    cursor: pointer;\r\n}\r\n\r\n.olControlZoomPanel .olControlZoomInItemInactive {\r\n    top: 0;\r\n    left: 0;\r\n    background-position: 0 0;\r\n}\r\n\r\n.olControlZoomPanel .olControlZoomToMaxExtentItemInactive {\r\n    top: 18px;\r\n    left: 0;\r\n    background-position: 0 -18px;\r\n}\r\n\r\n.olControlZoomPanel .olControlZoomOutItemInactive {\r\n    top: 36px;\r\n    left: 0;\r\n    background-position: 0 18px;\r\n}\r\n\r\n/*\r\n * When a potential text is bigger than the image it move the image\r\n * with some headers (closes #3154)\r\n */\r\n.olControlPanZoomBar div {\r\n    font-size: 1px;\r\n}\r\n\r\n.olPopupCloseBox {\r\n  background: url(\"resources/openlayers/theme/default/img/close.gif\") no-repeat;\r\n  cursor: pointer;\r\n}\r\n\r\n.olFramedCloudPopupContent {\r\n    padding: 5px;\r\n    overflow: auto;\r\n}\r\n\r\n.olControlNoSelect {\r\n -moz-user-select: none;\r\n -khtml-user-select: none;\r\n}\r\n\r\n.olImageLoadError {\r\n    background-color: pink;\r\n    opacity: 0.5;\r\n    filter: alpha(opacity=50); /* IE */\r\n}\r\n\r\n/**\r\n * Cursor styles\r\n */\r\n\r\n.olCursorWait {\r\n    cursor: wait;\r\n}\r\n.olDragDown {\r\n    cursor: move;\r\n}\r\n.olDrawBox {\r\n    cursor: crosshair;\r\n}\r\n.olControlDragFeatureOver {\r\n    cursor: move;\r\n}\r\n.olControlDragFeatureActive.olControlDragFeatureOver.olDragDown {\r\n    cursor: -moz-grabbing;\r\n}\r\n\r\n/**\r\n * Layer switcher\r\n */\r\n.olControlLayerSwitcher {\r\n    position: absolute;\r\n    top: 25px;\r\n    right: 0;\r\n    width: 20em;\r\n    font-family: sans-serif;\r\n    font-weight: bold;\r\n    margin-top: 3px;\r\n    margin-left: 3px;\r\n    margin-bottom: 3px;\r\n    font-size: smaller;\r\n    color: white;\r\n    background-color: transparent;\r\n}\r\n\r\n.olControlLayerSwitcher .layersDiv {\r\n    padding-top: 5px;\r\n    padding-left: 10px;\r\n    padding-bottom: 5px;\r\n    padding-right: 10px;\r\n    background-color: darkblue;\r\n}\r\n\r\n.olControlLayerSwitcher .layersDiv .baseLbl,\r\n.olControlLayerSwitcher .layersDiv .dataLbl {\r\n    margin-top: 3px;\r\n    margin-left: 3px;\r\n    margin-bottom: 3px;\r\n}\r\n\r\n.olControlLayerSwitcher .layersDiv .baseLayersDiv,\r\n.olControlLayerSwitcher .layersDiv .dataLayersDiv {\r\n    padding-left: 10px;\r\n}\r\n\r\n.olControlLayerSwitcher .maximizeDiv,\r\n.olControlLayerSwitcher .minimizeDiv {\r\n    width: 18px;\r\n    height: 18px;\r\n    top: 5px;\r\n    right: 0;\r\n    cursor: pointer;\r\n}\r\n\r\n.olBingAttribution {\r\n    color: #DDD;\r\n}\r\n.olBingAttribution.road {\r\n    color: #333;\r\n}\r\n\r\n.olGoogleAttribution.hybrid, .olGoogleAttribution.satellite {\r\n    color: #EEE;\r\n}\r\n.olGoogleAttribution {\r\n    color: #333;\r\n}\r\nspan.olGoogleAttribution a {\r\n    color: #77C;\r\n}\r\nspan.olGoogleAttribution.hybrid a, span.olGoogleAttribution.satellite a {\r\n    color: #EEE;\r\n}\r\n\r\n/**\r\n * Editing and navigation icons.\r\n * (using the editing_tool_bar.png sprint image)\r\n */\r\n.olControlNavToolbar ,\r\n.olControlEditingToolbar {\r\n    margin: 5px 5px 0 0;\r\n}\r\n.olControlNavToolbar div,\r\n.olControlEditingToolbar div {\r\n    background-image: url(\"resources/openlayers/theme/default/img/editing_tool_bar.png\");\r\n    background-repeat: no-repeat;\r\n    margin: 0 0 5px 5px;\r\n    width: 24px;\r\n    height: 22px;\r\n    cursor: pointer\r\n}\r\n/* positions */\r\n.olControlEditingToolbar {\r\n    right: 0;\r\n    top: 0;\r\n}\r\n.olControlNavToolbar {\r\n    top: 295px;\r\n    left: 9px;\r\n}\r\n/* layouts */\r\n.olControlEditingToolbar div {\r\n    float: right;\r\n}\r\n/* individual controls */\r\n.olControlNavToolbar .olControlNavigationItemInactive,\r\n.olControlEditingToolbar .olControlNavigationItemInactive {\r\n    background-position: -103px -1px;\r\n}\r\n.olControlNavToolbar .olControlNavigationItemActive ,\r\n.olControlEditingToolbar .olControlNavigationItemActive  {\r\n    background-position: -103px -24px;\r\n}\r\n.olControlNavToolbar .olControlZoomBoxItemInactive {\r\n    background-position: -128px -1px;\r\n}\r\n.olControlNavToolbar .olControlZoomBoxItemActive  {\r\n    background-position: -128px -24px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePointItemInactive {\r\n    background-position: -77px -1px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePointItemActive {\r\n    background-position: -77px -24px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePathItemInactive {\r\n    background-position: -51px -1px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePathItemActive {\r\n    background-position: -51px -24px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePolygonItemInactive{\r\n    background-position: -26px -1px;\r\n}\r\n.olControlEditingToolbar .olControlDrawFeaturePolygonItemActive {\r\n    background-position: -26px -24px;\r\n}\r\n\r\ndiv.olControlZoom {\r\n    position: absolute;\r\n    top: 8px;\r\n    left: 8px;\r\n    background: rgba(255,255,255,0.4);\r\n    border-radius: 4px;\r\n    padding: 2px;\r\n}\r\ndiv.olControlZoom a {\r\n    display: block;\r\n    margin: 1px;\r\n    padding: 0;\r\n    color: white;\r\n    font-size: 18px;\r\n    font-family: 'Lucida Grande', Verdana, Geneva, Lucida, Arial, Helvetica, sans-serif;\r\n    font-weight: bold;\r\n    text-decoration: none;\r\n    text-align: center;\r\n    height: 22px;\r\n    width:22px;\r\n    line-height: 19px;\r\n    background: #130085; /* fallback for IE - IE6 requires background shorthand*/\r\n    background: rgba(0, 60, 136, 0.5);\r\n    filter: alpha(opacity=80);\r\n}\r\ndiv.olControlZoom a:hover {\r\n    background: #130085; /* fallback for IE */\r\n    background: rgba(0, 60, 136, 0.7);\r\n    filter: alpha(opacity=100);\r\n}\r\n@media only screen and (max-width: 600px) {\r\n    div.olControlZoom a:hover {\r\n        background: rgba(0, 60, 136, 0.5);\r\n    }\r\n}\r\na.olControlZoomIn {\r\n    border-radius: 4px 4px 0 0;\r\n}\r\na.olControlZoomOut {\r\n    border-radius: 0 0 4px 4px;\r\n}\r\n\r\n\r\n/**\r\n * Animations\r\n */\r\n\r\n.olLayerGrid .olTileImage {\r\n    -webkit-transition: opacity 0.2s linear;\r\n    -moz-transition: opacity 0.2s linear;\r\n    -o-transition: opacity 0.2s linear;\r\n    transition: opacity 0.2s linear;\r\n}\r\n.getinforesult_table tr {\n  padding: 5px; }\n  .getinforesult_table tr.odd {\n    background-color: #EEEEEE; }\n.getinforesult_table td {\n  padding: 2px; }\n\n.getinforesult_header {\n  border: 1pt solid navy;\n  background-color: #424343;\n  margin-top: 14px;\n  margin-bottom: 10px;\n  height: 15px; }\n  .getinforesult_header .icon-bubble-left {\n    height: 15px;\n    display: inline;\n    float: left; }\n\n.getinforesult_header_title {\n  color: #FFF;\n  float: left;\n  display: inline;\n  margin-left: 8px;\n  max-width: 85%;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  /* Default line height is higher than the parent element... */\n  line-height: 14px; }\n\ndiv.myplaces_wrapper {\n  padding-bottom: 18px; }\n  div.myplaces_wrapper div.myplaces_place img.myplaces_img {\n    padding-bottom: 15px;\n    max-height: 350px;\n    max-width: 350px; }\n/* Mixins */\ndiv.mapplugin.search {\n  top: 10px;\n  right: 10px; }\n\ndiv.search div.close {\n  float: right; }\ndiv.search input[type=text] {\n  width: 140px !important; }\ndiv.search input[type=button] {\n  width: 60px;\n  margin-left: 3px; }\ndiv.search div.results {\n  border: 1px solid #f3f3f3;\n  background: white;\n  max-width: 350px;\n  max-height: 320px;\n  width: auto;\n  overflow: auto;\n  margin-top: 5px; }\n  div.search div.results div.header {\n    background: #DDDDDD; }\n  div.search div.results div.content table {\n    width: 100%;\n    text-align: center;\n    border-spacing: 2px; }\n    div.search div.results div.content table tr {\n      cursor: pointer; }\n\ntable.search-results {\n  width: 100%;\n  margin: 0px; }\n  table.search-results td, table.search-results th {\n    text-align: left;\n    padding: 2px;\n    padding-left: 4px;\n    padding-right: 12px; }\n  table.search-results tr.odd {\n    background-color: #F3F3F3; }\n\ndiv.published-search-div {\n  float: left; }\n  div.published-search-div div.search-area-div {\n    min-width: 180px;\n    display: block;\n    float: right; }\n    div.published-search-div div.search-area-div div.search-left, div.published-search-div div.search-area-div div.search-middle, div.published-search-div div.search-area-div div.search-right {\n      display: inline-block;\n      float: left;\n      height: 38px; }\n    div.published-search-div div.search-area-div div.search-middle {\n      min-width: 180px; }\n    div.published-search-div div.search-area-div div.search-right {\n      cursor: pointer; }\n    div.published-search-div div.search-area-div input.search-input {\n      background-color: transparent;\n      border: none;\n      box-shadow: none;\n      background-image: none;\n      width: 145px;\n      float: left;\n      padding: 10px 5px 10px 5px;\n      outline: none; }\n  div.published-search-div div.published-search-results {\n    width: 316px;\n    max-height: 320px;\n    clear: both;\n    overflow: hidden;\n    white-space: nowrap;\n    position: absolute;\n    top: 35px;\n    right: 0px;\n    display: block;\n    background-color: #FFFFFF;\n    border: 1px solid black; }\n    div.published-search-div div.published-search-results table.search-results {\n      float: left;\n      width: 316px;\n      margin: 0 0 10px 0; }\n      div.published-search-div div.published-search-results table.search-results tbody {\n        overflow: hidden;\n        overflow-y: auto;\n        float: left;\n        display: block;\n        width: 100%;\n        max-height: 250px;\n        min-height: 30px; }\n      div.published-search-div div.published-search-results table.search-results thead {\n        float: left; }\n        div.published-search-div div.published-search-results table.search-results thead tr {\n          display: block; }\n          div.published-search-div div.published-search-results table.search-results thead tr th {\n            padding: 5px;\n            background-color: #efefef;\n            width: 110px; }\n            div.published-search-div div.published-search-results table.search-results thead tr th + th {\n              width: 70px; }\n              div.published-search-div div.published-search-results table.search-results thead tr th + th + th {\n                width: 106px; }\n  div.published-search-div .oskari-publisher-search-results-rounded-dark, div.published-search-div .oskari-publisher-search-results-rounded-light {\n    -webkit-border-radius: 15px;\n    -moz-border-radius: 15px;\n    -o-border-radius: 15px;\n    -ms-border-radius: 15px;\n    border-radius: 15px;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n    div.published-search-div .oskari-publisher-search-results-rounded-dark div.published-search-results table.search-results thead tr th:first-child, div.published-search-div .oskari-publisher-search-results-rounded-light div.published-search-results table.search-results thead tr th:first-child {\n      -webkit-border-radius: 15px 0 0 0;\n      -moz-border-radius: 15px 0 0 0;\n      -o-border-radius: 15px 0 0 0;\n      -ms-border-radius: 15px 0 0 0;\n      border-radius: 15px 0 0 0;\n      -webkit-background-clip: padding-box;\n      -moz-background-clip: padding-box;\n      background-clip: padding-box; }\n    div.published-search-div .oskari-publisher-search-results-rounded-dark div.published-search-results table.search-results thead tr th:last-child, div.published-search-div .oskari-publisher-search-results-rounded-light div.published-search-results table.search-results thead tr th:last-child {\n      -webkit-border-radius: 0 15px 0 0;\n      -moz-border-radius: 0 15px 0 0;\n      -o-border-radius: 0 15px 0 0;\n      -ms-border-radius: 0 15px 0 0;\n      border-radius: 0 15px 0 0;\n      -webkit-background-clip: padding-box;\n      -moz-background-clip: padding-box;\n      background-clip: padding-box; }\n  div.published-search-div .oskari-publisher-search-results-sharp-dark, div.published-search-div .oskari-publisher-search-results-sharp-light {\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    -o-border-radius: 0;\n    -ms-border-radius: 0;\n    border-radius: 0;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n    div.published-search-div .oskari-publisher-search-results-sharp-dark div.published-search-results table.search-results thead tr th:first-child, div.published-search-div .oskari-publisher-search-results-sharp-dark div.published-search-results table.search-results thead tr th:last-child, div.published-search-div .oskari-publisher-search-results-sharp-light div.published-search-results table.search-results thead tr th:first-child, div.published-search-div .oskari-publisher-search-results-sharp-light div.published-search-results table.search-results thead tr th:last-child {\n      -webkit-border-radius: 0;\n      -moz-border-radius: 0;\n      -o-border-radius: 0;\n      -ms-border-radius: 0;\n      border-radius: 0;\n      -webkit-background-clip: padding-box;\n      -moz-background-clip: padding-box;\n      background-clip: padding-box; }\n  div.published-search-div .oskari-publisher-search-results-3d-dark, div.published-search-div .oskari-publisher-search-results-3d-light {\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n    -o-border-radius: 3px;\n    -ms-border-radius: 3px;\n    border-radius: 3px;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n    div.published-search-div .oskari-publisher-search-results-3d-dark div.published-search-results table.search-results thead tr th:first-child, div.published-search-div .oskari-publisher-search-results-3d-light div.published-search-results table.search-results thead tr th:first-child {\n      -webkit-border-radius: 3px 0 0 0;\n      -moz-border-radius: 3px 0 0 0;\n      -o-border-radius: 3px 0 0 0;\n      -ms-border-radius: 3px 0 0 0;\n      border-radius: 3px 0 0 0;\n      -webkit-background-clip: padding-box;\n      -moz-background-clip: padding-box;\n      background-clip: padding-box; }\n    div.published-search-div .oskari-publisher-search-results-3d-dark div.published-search-results table.search-results thead tr th:last-child, div.published-search-div .oskari-publisher-search-results-3d-light div.published-search-results table.search-results thead tr th:last-child {\n      -webkit-border-radius: 0 3px 0 0;\n      -moz-border-radius: 0 3px 0 0;\n      -o-border-radius: 0 3px 0 0;\n      -ms-border-radius: 0 3px 0 0;\n      border-radius: 0 3px 0 0;\n      -webkit-background-clip: padding-box;\n      -moz-background-clip: padding-box;\n      background-clip: padding-box; }\n  div.published-search-div div.published-search-results table.search-results tbody td {\n    display: inline-block;\n    overflow: hidden;\n    padding: 2px 0 2px 5px;\n    text-overflow: ellipsis;\n    max-width: 115px;\n    width: 115px; }\n    div.published-search-div div.published-search-results table.search-results tbody td + td {\n      max-width: 75px;\n      width: 75px; }\n      div.published-search-div div.published-search-results table.search-results tbody td + td + td {\n        max-width: 95px;\n        width: 95px; }\n  div.published-search-div div.search-middle div.close-results {\n    margin-right: 5px;\n    display: inline-block;\n    float: right;\n    cursor: pointer; }\n\n.right div.published-search-div {\n  float: right; }\n\n.search-textarea-and-button .search-editmode-overlay {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0; }\n\n.mappluginsContent.ui-sortable div.mapplugin.search {\n  right: 0px; }\n.logoplugin {\n  background-color: #FFF;\n  background-repeat: no-repeat;\n  display: block;\n  /* Force line to fit container */\n  line-height: 15px;\n  height: 25px;\n  z-index: 100000000 !important;\n  opacity: 0.8 !important; }\n  .logoplugin a, .logoplugin a:hover, .logoplugin a:active, .logoplugin a:visited {\n    color: inherit; }\n  .logoplugin .icon {\n    background-image: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/logo/images/pti_icon.png');\n    display: inline-block;\n    height: 25px;\n    width: 25px;\n    vertical-align: bottom;\n    cursor: pointer; }\n  .logoplugin .terms {\n    display: inline-block;\n    margin: 5px; }\n  .logoplugin .data-sources {\n    display: inline-block;\n    margin: 5px;\n    text-decoration: underline;\n    cursor: pointer; }\n\n.data-sources-dialog {\n  max-width: 400px; }\n  .data-sources-dialog .layers h4, .data-sources-dialog .indicators h4 {\n    padding-bottom: 5px; }\n  .data-sources-dialog .indicators {\n    margin-top: 10px; }\n.oskari-datasource:active, .oskari-datasource a, .oskari-datasource a:hover, .oskari-datasource a:visited {\n  color: #0091FF !important; }\n.oskari-datasource .link {\n  background-color: none;\n  background-repeat: no-repeat;\n  display: block;\n  /* Special case, let's imagine it's tabular data... */\n  font-size: 12px;\n  position: fixed;\n  bottom: 15px;\n  right: 70px;\n  z-index: 100000000 !important;\n  opacity: 0.8 !important; }\ndiv.mapplugin.indexmap .olControlOverviewMapElement {\n  /* Hide by default, control's maximize: false doesn't seem to do anything */\n  display: none;\n  background-color: #FFFFFF;\n  border-color: #D0D0D0;\n  border-left-width: 2px;\n  border-style: solid;\n  border-top-width: 2px;\n  padding: 5px;\n  margin-bottom: -46px; }\ndiv.mapplugin.indexmap .indexmapToggle {\n  width: 46px !important;\n  height: 46px !important;\n  position: relative;\n  float: left;\n  cursor: default;\n  background: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/component-indexmap.png') 0px 0px !important; }\n  div.mapplugin.indexmap .indexmapToggle:hover {\n    background: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/component-indexmap_hover.png') !important; }\n\n.right div.mapplugin.indexmap .indexmapToggle {\n  float: right; }\n\n.olControlOverviewMapContainer .olControlOverviewMapElement {\n  padding: 5px !important;\n  background-color: #FFFFFF !important;\n  border-color: #D0D0D0 !important;\n  border-style: solid;\n  border-left-width: 2px;\n  border-top-width: 2px; }\n.olControlOverviewMapContainer #OpenLayers_Control_minimizeDiv {\n  position: absolute !important;\n  width: 46px !important;\n  height: 46px !important;\n  right: 0px;\n  bottom: 0px;\n  cursor: default;\n  background: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/indexmap/images/component-indexmap_hover.png') !important; }\n\n.olControlOverviewMapExtentRectangle {\n  border: 2px dashed #f47729 !important; }\ndiv.mapplugin.scalebar {\n  /* 14px would be too big... */\n  font-size: 12px;\n  line-height: 13px; }\n.tools {\n  display: block;\n  z-index: 100000000 !important;\n  text-align: left; }\n  .tools .icon {\n    display: inline-block;\n    height: 35px;\n    width: 35px;\n    vertical-align: bottom; }\n  .tools .publishedToolbarContainer {\n    height: auto;\n    background-color: transparent;\n    min-height: 60px;\n    z-index: 16000;\n    position: absolute;\n    top: 45px; }\n    .tools .publishedToolbarContainer .tools-top-arrow {\n      width: 0;\n      height: 0;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent;\n      border-bottom: 10px solid #424343;\n      margin-left: 7.5px; }\n    .tools .publishedToolbarContainer .publishedToolbarContent {\n      background-color: #424343;\n      color: white;\n      border-radius: 6px;\n      padding-top: 3px;\n      padding-bottom: 3px;\n      display: block;\n      width: 100%;\n      clear: both; }\n      .tools .publishedToolbarContainer .publishedToolbarContent div.toolrow {\n        border-top: 1px solid rgba(255, 255, 255, 0.1);\n        padding: 0px 10px; }\n        .tools .publishedToolbarContainer .publishedToolbarContent div.toolrow div.tool {\n          display: inline-block;\n          cursor: pointer; }\n        .tools .publishedToolbarContainer .publishedToolbarContent div.toolrow div.tool.selected, .tools .publishedToolbarContainer .publishedToolbarContent div.toolrow div.tool:hover:not(.disabled), .tools .publishedToolbarContainer .publishedToolbarContent div.toolrow div.tool:active:not(.disabled) {\n          background-color: #212121; }\n      .tools .publishedToolbarContainer .publishedToolbarContent div.toolrow:first-child {\n        border-top: none; }\n    .tools .publishedToolbarContainer .publishedToolbarContent.dark {\n      background-color: #424343;\n      border: none; }\n      .tools .publishedToolbarContainer .publishedToolbarContent.dark div.toolrow div.tool.selected, .tools .publishedToolbarContainer .publishedToolbarContent.dark div.toolrow div.tool:hover:not(.disabled), .tools .publishedToolbarContainer .publishedToolbarContent.dark div.toolrow div.tool:active:not(.disabled) {\n        background-color: #212121; }\n    .tools .publishedToolbarContainer .publishedToolbarContent.light {\n      background-color: white;\n      border: 1px solid #888888; }\n      .tools .publishedToolbarContainer .publishedToolbarContent.light div.toolrow div.tool.selected, .tools .publishedToolbarContainer .publishedToolbarContent.light div.toolrow div.tool:hover:not(.disabled), .tools .publishedToolbarContainer .publishedToolbarContent.light div.toolrow div.tool:active:not(.disabled) {\n        background-color: #eeeeee; }\n    .tools .publishedToolbarContainer .publishedToolbarPopupContent.dark .publishedToolPopupContent {\n      background-color: #424343;\n      color: white;\n      border: none; }\n    .tools .publishedToolbarContainer .publishedToolbarPopupContent.light .publishedToolPopupContent {\n      background-color: white;\n      color: #424343;\n      border: 1px solid #888888; }\n    .tools .publishedToolbarContainer .publishedToolPopupContent {\n      background-color: #424343;\n      color: white;\n      border-radius: 6px;\n      padding: 0 10px 3px 10px;\n      display: block;\n      width: 220px;\n      clear: both; }\n      .tools .publishedToolbarContainer .publishedToolPopupContent .actions {\n        padding-top: 5px; }\n    .tools .publishedToolbarContainer .publishedToolPopupContent.measureline {\n      width: auto; }\n      .tools .publishedToolbarContainer .publishedToolPopupContent.measureline .content div {\n        text-align: center; }\n      .tools .publishedToolbarContainer .publishedToolPopupContent.measureline .actions input {\n        margin: 2px auto;\n        display: block; }\n    .tools .publishedToolbarContainer .publishedToolPopupContent.dark {\n      background-color: #424343;\n      border: none; }\n    .tools .publishedToolbarContainer .publishedToolPopupContent.light {\n      background-color: white;\n      border: 1px solid #888888; }\n    .tools .publishedToolbarContainer .tool-group-title {\n      font-weight: bold; }\n\n.mapplugins.left .tools {\n  float: left; }\n  .mapplugins.left .tools .icon {\n    float: left; }\n  .mapplugins.left .tools .publishedToolbarContainer {\n    left: 10px; }\n    .mapplugins.left .tools .publishedToolbarContainer .tools-top-arrow {\n      float: left;\n      margin-left: 7.5px; }\n\n.mapplugins.right .tools {\n  float: right; }\n  .mapplugins.right .tools .icon {\n    float: right; }\n  .mapplugins.right .tools .publishedToolbarContainer {\n    right: 10px; }\n    .mapplugins.right .tools .publishedToolbarContainer .tools-top-arrow {\n      float: right;\n      margin-right: 7.5px; }\n.fullscreenDiv {\n  display: block;\n  background: transparent;\n  z-index: 15000; }\n  .fullscreenDiv .fullscreenDivImg {\n    cursor: pointer; }\n/* Mixins */\ndiv.mapplugin.layerselection {\n  max-width: 200px;\n  z-index: 100000000 !important; }\n  div.mapplugin.layerselection div.content {\n    background-color: white; }\n    div.mapplugin.layerselection div.content div.content-header {\n      /* This is some sort of a theme color... leave it be */\n      background-color: #333438;\n      color: #FFFFFF;\n      text-align: left;\n      height: 25px;\n      padding: 5px; }\n      div.mapplugin.layerselection div.content div.content-header .content-close {\n        display: inline-block;\n        float: right;\n        cursor: pointer; }\n      div.mapplugin.layerselection div.content div.content-header div.content-header-title {\n        display: inline-block;\n        float: left;\n        padding: 5px; }\n    div.mapplugin.layerselection div.content div.baseLayerHeader {\n      background-color: #E6E6E6;\n      padding: 10px;\n      text-align: left; }\n    div.mapplugin.layerselection div.content div.layer {\n      margin: 5px 0;\n      text-align: left;\n      clear: both; }\n      div.mapplugin.layerselection div.content div.layer input {\n        margin-right: 10px;\n        float: left; }\n      div.mapplugin.layerselection div.content div.layer span {\n        display: block;\n        margin-left: 30px;\n        word-break: break-all; }\n    div.mapplugin.layerselection div.content div.styled-header-arrow {\n      width: 0px;\n      height: 0px;\n      margin-left: 170px;\n      margin-top: -20px;\n      border-top: 10px solid transparent;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent;\n      border-bottom: 10px solid #333438; }\n  div.mapplugin.layerselection div.layers, div.mapplugin.layerselection div.baselayers {\n    padding: 10px; }\n  div.mapplugin.layerselection div.header {\n    background-color: #3C3C3C;\n    color: #FFF !important;\n    padding: 8px;\n    cursor: pointer; }\n    div.mapplugin.layerselection div.header div.header-icon {\n      display: inline-block;\n      margin-right: 10px;\n      vertical-align: middle; }\n  div.mapplugin.layerselection div.layerselection-styled-content {\n    width: 200px;\n    border: 1px solid #333438; }\n  div.mapplugin.layerselection .oskari-publisher-layers-rounded-dark, div.mapplugin.layerselection .oskari-publisher-layers-rounded-light {\n    -webkit-border-radius: 15px;\n    -moz-border-radius: 15px;\n    -o-border-radius: 15px;\n    -ms-border-radius: 15px;\n    border-radius: 15px;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n  div.mapplugin.layerselection .oskari-publisher-layers-sharp-dark, div.mapplugin.layerselection .oskari-publisher-layers-sharp-light {\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    -o-border-radius: 0;\n    -ms-border-radius: 0;\n    border-radius: 0; }\n  div.mapplugin.layerselection .oskari-publisher-layers-3d-dark, div.mapplugin.layerselection .oskari-publisher-layers-3d-light {\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n    -o-border-radius: 3px;\n    -ms-border-radius: 3px;\n    border-radius: 3px;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n  div.mapplugin.layerselection .oskari-publisher-layers-header-rounded-dark, div.mapplugin.layerselection .oskari-publisher-layers-header-rounded-light {\n    -webkit-border-radius: 13px 13px 0 0;\n    -moz-border-radius: 13px 13px 0 0;\n    -o-border-radius: 13px 13px 0 0;\n    -ms-border-radius: 13px 13px 0 0;\n    border-radius: 13px 13px 0 0;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n  div.mapplugin.layerselection .oskari-publisher-layers-header-sharp-dark, div.mapplugin.layerselection .oskari-publisher-layers-header-sharp-light {\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    -o-border-radius: 0;\n    -ms-border-radius: 0;\n    border-radius: 0; }\n  div.mapplugin.layerselection .oskari-publisher-layers-header-3d-dark, div.mapplugin.layerselection .oskari-publisher-layers-header-3d-light {\n    -webkit-border-radius: 1px 1px 0 0;\n    -moz-border-radius: 1px 1px 0 0;\n    -o-border-radius: 1px 1px 0 0;\n    -ms-border-radius: 1px 1px 0 0;\n    border-radius: 1px 1px 0 0;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n\n.published-styled-layerselector {\n  position: relative !important; }\n\n.published-styled-layerselector-header {\n  width: 38px !important;\n  height: 38px !important;\n  padding: 0px !important;\n  background-color: transparent !important;\n  float: right !important; }\n\n.published-styled-layerselector-content {\n  position: absolute !important;\n  top: 44px !important;\n  right: 0px !important; }\n\n/* Hacketyhack, we need to keep the popup on screen */\n.mapplugins.left div.mapplugin.layerselection div.published-styled-layerselector-content {\n  left: 0px !important;\n  right: auto !important; }\n  .mapplugins.left div.mapplugin.layerselection div.published-styled-layerselector-content div.styled-header-arrow {\n    margin-left: 12px !important; }\n/* Mixins */\ndiv.mapplugin.backgroundLayerSelectionPlugin {\n  width: 100%;\n  height: 44px;\n  margin: 0;\n  z-index: 15000;\n  text-align: center; }\n  div.mapplugin.backgroundLayerSelectionPlugin div.bg {\n    background-color: black;\n    opacity: 0.3;\n    width: 100%;\n    height: 44px;\n    position: absolute;\n    bottom: 0;\n    left: 0; }\n  div.mapplugin.backgroundLayerSelectionPlugin div.content {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    margin: 8px 0;\n    width: 100%;\n    /* dropdown version */ }\n    div.mapplugin.backgroundLayerSelectionPlugin div.content div.currentSelection {\n      display: none;\n      cursor: pointer;\n      margin: 0 auto;\n      height: 28px;\n      line-height: 28px;\n      width: 120px;\n      padding: 0 10px;\n      background-color: #3c3c3c;\n      color: white;\n      overflow: hidden;\n      white-space: nowrap;\n      text-align: center;\n      text-overflow: ellipsis;\n      -webkit-border-radius: 2px;\n      -moz-border-radius: 2px;\n      -o-border-radius: 2px;\n      -ms-border-radius: 2px;\n      border-radius: 2px;\n      -webkit-background-clip: padding-box;\n      -moz-background-clip: padding-box;\n      background-clip: padding-box;\n      -webkit-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);\n      -moz-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);\n      box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3); }\n      div.mapplugin.backgroundLayerSelectionPlugin div.content div.currentSelection::selection, div.mapplugin.backgroundLayerSelectionPlugin div.content div.currentSelection::-moz-selection {\n        background: transparent; }\n    div.mapplugin.backgroundLayerSelectionPlugin div.content ul {\n      list-style: none;\n      margin: 0;\n      padding: 0;\n      width: 100%;\n      height: 28px; }\n      div.mapplugin.backgroundLayerSelectionPlugin div.content ul li {\n        display: inline-block;\n        cursor: pointer;\n        width: 120px;\n        background-color: #3c3c3c;\n        color: white;\n        margin: 0 1px 0 0;\n        padding: 0 10px;\n        line-height: 28px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        -webkit-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);\n        -moz-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);\n        box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3); }\n        div.mapplugin.backgroundLayerSelectionPlugin div.content ul li::selection, div.mapplugin.backgroundLayerSelectionPlugin div.content ul li::-moz-selection {\n          background: transparent; }\n        div.mapplugin.backgroundLayerSelectionPlugin div.content ul li:first-child {\n          -webkit-border-top-left-radius: 2px;\n          -webkit-border-bottom-left-radius: 2px;\n          -moz-border-radius-topleft: 2px;\n          -moz-border-radius-bottomleft: 2px;\n          border-top-left-radius: 2px;\n          border-bottom-left-radius: 2px; }\n        div.mapplugin.backgroundLayerSelectionPlugin div.content ul li:last-child {\n          -webkit-border-top-right-radius: 2px;\n          -webkit-border-bottom-right-radius: 2px;\n          -moz-border-radius-topright: 2px;\n          -moz-border-radius-bottomright: 2px;\n          border-top-right-radius: 2px;\n          border-bottom-right-radius: 2px; }\n        div.mapplugin.backgroundLayerSelectionPlugin div.content ul li.selected {\n          background-color: #fafafa;\n          color: #3c3c3c; }\n    div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown div.currentSelection {\n      display: block; }\n      div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown div.currentSelection div.header-icon {\n        float: left;\n        clear: none;\n        margin-left: -5px;\n        margin-top: 7px; }\n    div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown ul {\n      display: none;\n      width: 138px;\n      margin: 0 auto;\n      height: auto;\n      border: 1px solid #3c3c3c;\n      border-bottom-width: 0; }\n      div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown ul li {\n        background-color: #fafafa;\n        color: #3c3c3c;\n        display: block;\n        text-align: left;\n        padding: 0 9px;\n        line-height: 26px;\n        height: 26px;\n        border-bottom: 1px solid #e6e6e6;\n        -webkit-border-radius: 0;\n        -moz-border-radius: 0;\n        -o-border-radius: 0;\n        -ms-border-radius: 0;\n        border-radius: 0; }\n        div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown ul li.selected {\n          display: none; }\n    div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown.open ul {\n      display: block; }\n    div.mapplugin.backgroundLayerSelectionPlugin div.content.dropdown.open div.currentSelection {\n      -webkit-border-top-left-radius: 0;\n      -webkit-border-top-right-radius: 0;\n      -moz-border-radius-topleft: 0;\n      -moz-border-radius-topright: 0;\n      border-top-left-radius: 0;\n      border-top-right-radius: 0; }\n  div.mapplugin.backgroundLayerSelectionPlugin div.error {\n    margin: 0 auto;\n    display: inline-block;\n    height: 28px;\n    line-height: 28px;\n    margin: 8px 0;\n    padding: 0 10px;\n    background-color: #911;\n    color: white;\n    text-align: center; }\n#mapstatsHover_contentDiv {\n  padding: 5px; }\ndiv.mapplugin.zoombar {\n  background: transparent;\n  width: 18px; }\n  div.mapplugin.zoombar div.pzbDiv-plus {\n    width: 18px;\n    height: 46px;\n    background-image: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/zoombar_plus_patched.png'); }\n  div.mapplugin.zoombar div.pzbDiv-minus {\n    width: 18px;\n    height: 18px;\n    background-image: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/zoombar_minus.png'); }\n  div.mapplugin.zoombar div.rui-slider-vertical {\n    background-color: transparent;\n    background-image: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/zoombar.png');\n    height: 148px;\n    width: 18px;\n    border: 0;\n    margin: 0; }\n.panbuttonDiv.mapplugin {\n  color: black;\n  background: transparent;\n  z-index: 15000;\n  height: 90px;\n  width: 90px;\n  padding: 0 4px;\n  /* Slight hack, this stops the plugin from jumping when coordinatesplugin is shown */ }\n\n.panbuttonDivImg {\n  background-image: url('/Oskari/resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/sprite.png'); }\n  .panbuttonDivImg.root {\n    background-position: 0px -90px; }\n  .panbuttonDivImg.up {\n    background-position: 0px -360px; }\n  .panbuttonDivImg.right {\n    background-position: 0px -270px; }\n  .panbuttonDivImg.down {\n    background-position: 0px -450px; }\n  .panbuttonDivImg.left {\n    background-position: 0px -180px; }\n.olMap {\n  position: relative; }\n\ndiv.olMap.cursor-crosshair {\n  cursor: crosshair; }\n\ndiv.mapplugins {\n  position: absolute;\n  text-align: center;\n  z-index: 15000; }\n  div.mapplugins .mappluginsContainer {\n    margin: 0;\n    padding: 0; }\n    div.mapplugins .mappluginsContainer .mappluginsContent.ui-droppable {\n      background-color: rgba(255, 255, 255, 0.5);\n      border: 3px dashed #666666;\n      border-radius: 20px;\n      min-height: 70px;\n      min-width: 70px;\n      padding: 20px; }\n      div.mapplugins .mappluginsContainer .mappluginsContent.ui-droppable.allowed {\n        background-color: rgba(0, 255, 0, 0.3); }\n        div.mapplugins .mappluginsContainer .mappluginsContent.ui-droppable.allowed.ui-state-highlight {\n          background-color: rgba(127, 255, 127, 0.5);\n          border-color: #FFF; }\n      div.mapplugins .mappluginsContainer .mappluginsContent.ui-droppable.disallowed {\n        background-color: rgba(255, 0, 0, 0.3); }\n    div.mapplugins .mappluginsContainer .mappluginsContent .mapplugin {\n      margin: 0 auto;\n      z-index: 15000;\n      /* Hackish margin fixes */ }\n      div.mapplugins .mappluginsContainer .mappluginsContent .mapplugin.indexmap {\n        margin-bottom: 0; }\n      div.mapplugins .mappluginsContainer .mappluginsContent .mapplugin.logoplugin {\n        margin-top: 10px; }\n      div.mapplugins .mappluginsContainer .mappluginsContent .mapplugin.scalebar {\n        margin-bottom: 0; }\n      div.mapplugins .mappluginsContainer .mappluginsContent .mapplugin.zoombar {\n        margin-top: 10px;\n        margin-bottom: 10px; }\n  div.mapplugins.top {\n    top: 0; }\n    div.mapplugins.top .mappluginsContainer .mappluginsContent {\n      margin-top: 10px; }\n    div.mapplugins.top.center {\n      width: 100%; }\n      div.mapplugins.top.center .mappluginsContainer .mappluginsContent {\n        margin-right: auto;\n        margin-left: auto;\n        display: inline-block; }\n        div.mapplugins.top.center .mappluginsContainer .mappluginsContent .mapplugin {\n          display: inline-block;\n          vertical-align: top;\n          margin: 0 5px; }\n          div.mapplugins.top.center .mappluginsContainer .mappluginsContent .mapplugin.search {\n            text-align: center; }\n          div.mapplugins.top.center .mappluginsContainer .mappluginsContent .mapplugin.layerselection, div.mapplugins.top.center .mappluginsContainer .mappluginsContent .mapplugin.search {\n            float: right; }\n    div.mapplugins.top.right {\n      min-width: 100px; }\n      div.mapplugins.top.right .mapplugin.layerselection {\n        margin-left: 0; }\n      div.mapplugins.top.right .mapplugin.search {\n        text-align: right; }\n      div.mapplugins.top.right .mapplugin.layerselection, div.mapplugins.top.right .mapplugin.search {\n        display: block;\n        float: right;\n        margin: 0 5px; }\n    div.mapplugins.top.left {\n      min-width: 100px; }\n      div.mapplugins.top.left .mapplugin.layerselection {\n        margin-right: 0; }\n      div.mapplugins.top.left .mapplugin.search {\n        text-align: left; }\n      div.mapplugins.top.left .mapplugin.layerselection, div.mapplugins.top.left .mapplugin.search {\n        display: block;\n        float: left;\n        margin: 0 5px; }\n  div.mapplugins.bottom {\n    bottom: 0; }\n    div.mapplugins.bottom .mappluginsContainer .mappluginsContent {\n      margin-bottom: 10px; }\n    div.mapplugins.bottom.center {\n      width: 100%; }\n      div.mapplugins.bottom.center .mappluginsContainer .mappluginsContent {\n        margin-right: auto;\n        margin-left: auto;\n        display: inline-block; }\n        div.mapplugins.bottom.center .mappluginsContainer .mappluginsContent .mapplugin {\n          display: inline-block;\n          vertical-align: top;\n          margin: 0 5px; }\n          div.mapplugins.bottom.center .mappluginsContainer .mappluginsContent .mapplugin.layerselection, div.mapplugins.bottom.center .mappluginsContainer .mappluginsContent .mapplugin.search {\n            float: right; }\n    div.mapplugins.bottom.right .mapplugin.indexmap {\n      margin-left: 20px;\n      margin-right: -10px; }\n    div.mapplugins.bottom.right .mapplugin.logoplugin {\n      clear: both;\n      margin-right: -10px; }\n    div.mapplugins.bottom.right .mapplugin.indexmap, div.mapplugins.bottom.right .mapplugin.logoplugin, div.mapplugins.bottom.right .mapplugin.scalebar {\n      float: right;\n      display: inline-block; }\n    div.mapplugins.bottom.left .mapplugin.indexmap {\n      margin-right: 20px;\n      margin-left: -10px; }\n    div.mapplugins.bottom.left .mapplugin.logoplugin {\n      clear: both;\n      margin-left: -10px; }\n    div.mapplugins.bottom.left .mapplugin.indexmap, div.mapplugins.bottom.left .mapplugin.logoplugin, div.mapplugins.bottom.left .mapplugin.scalebar {\n      float: left;\n      display: inline-block; }\n  div.mapplugins.left {\n    left: 0; }\n    div.mapplugins.left .mappluginsContainer .mappluginsContent {\n      margin-left: 10px; }\n    div.mapplugins.left.center {\n      height: 100%;\n      display: table; }\n      div.mapplugins.left.center .mappluginsContainer {\n        display: table-cell;\n        vertical-align: middle; }\n  div.mapplugins.right {\n    right: 0; }\n    div.mapplugins.right .mappluginsContainer .mappluginsContent {\n      margin-right: 10px; }\n    div.mapplugins.right.center {\n      height: 100%;\n      display: table; }\n      div.mapplugins.right.center .mappluginsContainer {\n        display: table-cell;\n        vertical-align: middle; }\n    div.mapplugins.right .mapplugin.indexmap .indexmapToggle {\n      float: right; }\n\n/* Publisher fonts, not part of style guide */\n.oskari-publisher-font-arial {\n  font-family: Arial, sans-serif !important; }\n\n.oskari-publisher-font-georgia {\n  font-family: Georgia, serif !important; }\n#contentMap.oskari-map-window-fullscreen {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  z-index: 10000;\n  margin: 0 !important; }\n/* Mixins */\n/* setup document body so flyouts will not make scrollbars to browser window */\n/* FIXME move this somewhere else... */\nbody {\n  position: fixed;\n  width: 100%;\n  height: 100%; }\n\n/* flyout toolbar */\n.oskari-flyoutheading {\n  background-color: #ffd400;\n  border-top: 1px solid #ffdf00;\n  border-bottom: 1px solid #ebb819;\n  height: 14px;\n  width: 100%; }\n\n.oskari-flyouttoolbar {\n  height: 57px;\n  width: 100%;\n  background-color: #fdf8d9;\n  border-top: #fdfdfd;\n  border-bottom: #fef2ba; }\n\n.oskari-flyout-title {\n  float: left;\n  margin-left: 20px;\n  margin-top: 12px;\n  height: 20px;\n  display: inline-block; }\n  .oskari-flyout-title p {\n    margin: 0;\n    padding: 0;\n    font-size: 16px;\n    line-height: 20px; }\n\n/** flyout toolbar tools and tool states  */\n.oskari-flyouttools {\n  float: right;\n  margin-right: 25px;\n  height: 16px;\n  display: inline-block;\n  margin-top: 15px; }\n\n.oskari-flyouttool-detach {\n  display: none;\n  /* visualise here if this tool required */ }\n\n.oskari-detached .oskari-flyouttool-detach {\n  display: none; }\n\n.oskari-minimized .oskari-flyouttool-detach {\n  display: none; }\n\n.oskari-flyouttool-attach {\n  /* visualise here if this tool required */\n  display: none; }\n\n.oskari-attached .oskari-flyouttool-attach {\n  display: none; }\n\n.oskari-flyouttool-minimize {\n  /* visualise here if this tool required */\n  display: none; }\n\n.oskari-attached .oskari-flyouttool-minimize {\n  display: none; }\n\n.oskari-minimized .oskari-flyouttool-minimize {\n  display: none; }\n\n.oskari-flyouttool-restore {\n  /* visualise here if this tool required */\n  display: none; }\n\n.oskari-flyouttool-help {\n  /* visualise here if this tool required */\n  display: none; }\n\n.oskari-minimized .oskari-flyouttool-restore {\n  display: inline-block; }\n.oskari-minimized .oskari-flyouttool-attach {\n  display: none; }\n.oskari-minimized .oskari-flyouttool-detach {\n  display: none; }\n\n.oskari-flyouttool-close {\n  display: inline-block;\n  width: 16px;\n  height: 16px;\n  margin-right: 2px;\n  margin-left: auto; }\n\n/* flyout */\n.oskari-flyout {\n  background-color: #fafafa;\n  position: absolute;\n  z-index: 1100;\n  margin: 0px;\n  padding: 0px;\n  border: 1px solid rgba(0, 0, 0, 0.2); }\n\n/* flyout states */\n/*.oskari-minimized {\r\n width: 640px;\r\n height: 64px;\r\n overflow: hidden;\r\n\r\n min-height: 64px;\r\n max-height: 64px;\r\n }*/\n.oskari-closed {\n  display: none; }\n\n.oskari-minimized {\n  display: none; }\n\n.oskari-flyoutcontent {\n  margin: 0;\n  padding: 20px 20px 20px 25px;\n  border: 0; }\n\n/** tile */\n/* tile states */\n.oskari-tile-attached {\n  border-bottom: 1px solid white;\n  background-color: white; }\n\n.oskari-tile-detached {\n  border-top: 1px solid #484846;\n  border-bottom: 1px solid #212121;\n  background-color: #FFF; }\n\n.oskari-tile-closed, .oskari-tile-minimized {\n  border-top: 1px solid #484846;\n  border-bottom: 1px solid #212121;\n  background-color: #2d2d2d;\n  background: -webkit-gradient(linear, left top, left bottom, from(#30302e), to(#2a2a2c));\n  background: -moz-linear-gradient(top, #30302e, #2a2a2c);\n  background: -ms-linear-gradient(top, #30302e, #2a2a2c);\n  /* For some reason sass didn't like this in one line... */\n  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#30302e', endColorstr='#2a2a2c');\n  background: linear-gradient(top, #30302e, #2a2a2c); }\n  .oskari-tile-closed:hover, .oskari-tile-minimized:hover {\n    border-top: 1px solid #585856;\n    background-color: #3d3d3d;\n    background: -webkit-gradient(linear, left top, left bottom, from(#40403e), to(#3a3a3c));\n    background: -moz-linear-gradient(top, #40403e, #3a3a3c);\n    background: -ms-linear-gradient(top, #40403e, #3a3a3c);\n    /* For some reason sass didn't like this in one line... */\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#40403e', endColorstr='#3a3a3c');\n    background: linear-gradient(top, #40403e, #3a3a3c); }\n\n.oskari-tile-container {\n  margin: 0; }\n\n.oskari-tile {\n  margin: 0;\n  padding: 0;\n  cursor: pointer;\n  min-height: 31px;\n  width: 153px;\n  border-top: 1px solid #484846;\n  border-bottom: 1px solid #212121;\n  /* Used to set the tile height, doesn't conflict with the styleguide */\n  line-height: 17px; }\n  .oskari-tile.disabled {\n    opacity: 0.25;\n    cursor: default; }\n\n.oskari-tile-title {\n  display: inline-block;\n  margin: 7px 0 7px 16px;\n  padding: 0;\n  width: 112px;\n  /* This is not in the styleguide, but it's a must-have... */\n  font-weight: bold;\n  font-size: 11px;\n  text-align: left;\n  text-transform: uppercase; }\n\n.oskari-tile-attached .oskari-tile-title {\n  color: #333438; }\n\n.oskari-tile-detached .oskari-tile-title {\n  color: #333438; }\n\n.oskari-tile-minimized .oskari-tile-title {\n  color: white; }\n\n.oskari-tile-closed .oskari-tile-title {\n  color: white; }\n\n.oskari-tile-status {\n  float: right;\n  text-align: center;\n  display: inline-block;\n  /* This is not in the styleguide, but it's a must-have... */\n  font-size: 11px;\n  font-weight: bold;\n  height: 19px !important;\n  line-height: 19px;\n  width: 20px !important;\n  margin: 1px;\n  margin-top: 6px;\n  padding: 1px; }\n\n.oskari-tile-close {\n  display: none; }\n\n.oskariform .oskarifield {\n  padding: 10px; }\n\n/** media queries */\n@media screen {\n  .oskari-attached {\n    min-width: 520px;\n    max-width: 840px; }\n\n  .oskari-detached {\n    min-width: 520px;\n    max-width: 840px; }\n\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 500px; } }\n@media only screen and (min-width: 400px) and (max-width: 599px) {\n  .oskari-attached {\n    min-width: 520px;\n    max-width: 500px; }\n\n  .oskari-detached {\n    min-width: 520px;\n    max-width: 500px; } }\n@media only screen and (min-width: 600px) and (max-width: 799px) {\n  .oskari-attached {\n    min-width: 520px;\n    max-width: 700px; }\n\n  .oskari-detached {\n    min-width: 520px;\n    max-width: 600px; } }\n@media only screen and (min-width: 800px) and (max-width: 1199px) {\n  .oskari-attached {\n    min-width: 520px;\n    max-width: 1000px; }\n\n  .oskari-detached {\n    min-width: 520px;\n    max-width: 1000px; } }\n@media only screen and (min-width: 1200px) and (max-width: 1599px) {\n  .oskari-attached {\n    min-width: 520px;\n    max-width: 1000px; }\n\n  .oskari-detached {\n    min-width: 520px;\n    max-width: 1000px; } }\n@media only screen and (min-height: 400px) and (max-height: 599px) {\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 300px;\n    /* overflow: auto; */ } }\n@media only screen and (min-height: 600px) and (max-height: 799px) {\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 500px;\n    /* overflow: auto; */ } }\n@media only screen and (min-height: 800px) and (max-height: 999px) {\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 700px;\n    /* overflow: auto; */ } }\n@media only screen and (min-height: 1000px) and (max-height: 1199px) {\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 900px;\n    /* overflow: auto; */ } }\n@media only screen and (min-height: 1200px) and (max-height: 1399px) {\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 1100px;\n    /* overflow: auto; */ } }\n@media only screen and (min-height: 1400px) {\n  .oskari-flyoutcontentcontainer {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    overflow: auto;\n    max-height: 1300px;\n    /* overflow: auto; */ } }\n/* IE8 TEMP fixes */\n/* FIXME remove these, check that IE9+ doesn't blow up */\n.oskari-flyoutcontentcontainer_IE_400_599 {\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  border: 0;\n  overflow: auto;\n  max-height: 300px;\n  /* overflow: auto; */ }\n\n.oskari-flyoutcontentcontainer_IE_600_799 {\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  border: 0;\n  overflow: auto;\n  max-height: 500px;\n  /* overflow: auto; */ }\n\n.oskari-flyoutcontentcontainer_IE_800_999 {\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  border: 0;\n  overflow: auto;\n  max-height: 700px;\n  /* overflow: auto; */ }\n\n.oskari-flyoutcontentcontainer_IE_1000_1199 {\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  border: 0;\n  overflow: auto;\n  max-height: 900px;\n  /* overflow: auto; */ }\n\n.oskari-flyoutcontentcontainer_IE_1200_1399 {\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  border: 0;\n  overflow: auto;\n  max-height: 1100px;\n  /* overflow: auto; */ }\n\n.oskari-flyoutcontentcontainer_IE_1400 {\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  border: 0;\n  overflow: auto;\n  max-height: 1300px;\n  /* overflow: auto; */ }\n/* Accordion */\ndiv.accordion div.accordionmsg {\n  padding: 10px; }\ndiv.accordion div.accordion_panel {\n  background-color: #F3F3F3;\n  border: 1px solid #C0D0D0;\n  clear: both;\n  overflow: hidden;\n  margin: 0;\n  padding: 0; }\n  div.accordion div.accordion_panel.open {\n    background-color: #FAFAFA; }\n  div.accordion div.accordion_panel div.content {\n    padding: 5px; }\n  div.accordion div.accordion_panel div.header div.headerIcon {\n    display: inline-block;\n    margin-left: 12px;\n    vertical-align: middle; }\n  div.accordion div.accordion_panel div.header div.headerText {\n    /* Accordion header style, defined in styleguide */\n    font-size: 16px;\n    line-height: 19px;\n    display: inline-block;\n    font-weight: bold;\n    padding: 8px 10px 8px 12px; }\ndiv.oskariTabs {\n  /* tab headers */\n  /* \"tab\" content */ }\n  div.oskariTabs .tabsHeader {\n    clear: both;\n    font-weight: bold;\n    margin-bottom: -1px;\n    padding: 0; }\n    div.oskariTabs .tabsHeader ul {\n      display: inline-block;\n      margin: 0;\n      padding: 0;\n      white-space: nowrap; }\n      div.oskariTabs .tabsHeader ul li {\n        background: none repeat scroll 0 0 #F3F3F3;\n        display: inline-block;\n        border-style: solid;\n        border-color: #999;\n        border-width: 1px 1px 0 1px;\n        margin: 0;\n        padding: 0; }\n        div.oskariTabs .tabsHeader ul li:first-of-type, div.oskariTabs .tabsHeader ul li:last-of-type {\n          -webkit-background-clip: padding-box;\n          -moz-background-clip: padding-box;\n          background-clip: padding-box; }\n        div.oskariTabs .tabsHeader ul li:first-of-type {\n          -webkit-border-top-left-radius: 2px;\n          -moz-border-radius-topleft: 2px;\n          border-top-left-radius: 2px; }\n        div.oskariTabs .tabsHeader ul li:last-of-type {\n          -webkit-border-top-right-radius: 2px;\n          -moz-border-radius-topright: 2px;\n          border-top-right-radius: 2px; }\n        div.oskariTabs .tabsHeader ul li.active {\n          background: none repeat scroll 0 0 #FAFAFA; }\n          div.oskariTabs .tabsHeader ul li.active a {\n            font-weight: bold;\n            padding-bottom: 11px;\n            -webkit-box-shadow: none;\n            -moz-box-shadow: none;\n            box-shadow: none; }\n        div.oskariTabs .tabsHeader ul li.fill a {\n          width: 100%; }\n        div.oskariTabs .tabsHeader ul li a {\n          color: inherit;\n          display: block;\n          font-weight: normal;\n          padding: 10px 15px;\n          position: relative;\n          text-decoration: none;\n          -webkit-box-shadow: 0 -3px 3px rgba(0, 0, 0, 0.1) inset;\n          -moz-box-shadow: 0 -3px 3px rgba(0, 0, 0, 0.1) inset;\n          box-shadow: 0 -3px 3px rgba(0, 0, 0, 0.1) inset; }\n        div.oskariTabs .tabsHeader ul li select {\n          margin-right: 10px; }\n    div.oskariTabs .tabsHeader .extraContent {\n      float: right; }\n      div.oskariTabs .tabsHeader .extraContent a {\n        padding: 0 3px; }\n  div.oskariTabs div.tabsContent {\n    border: 1px solid #999;\n    /*height: 90%;*/ }\n  div.oskariTabs div.tab-content {\n    padding: 10px;\n    overflow: auto;\n    clear: both; }\n.modaldialog {\n  border: 1px solid #3C3C3C;\n  margin: 0px; }\n\n.modaltitle {\n  margin: 0px;\n  border-bottom: 1px solid #3C3C3C;\n  padding: 8px 16px 4px 16px; }\n\n.modalmessage {\n  width: 100%;\n  padding: 8px 16px 8px 16px; }\n\n.modalbuttons {\n  width: 100%;\n  display: inline-block;\n  padding: 0px 16px 4px 16px; }\n\n.modalbutton {\n  margin: 2px;\n  display: inline-block; }\n/*!\r\n * Bootstrap v2.0.3\r\n *\r\n * Copyright 2012 Twitter, Inc\r\n * Licensed under the Apache License v2.0\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Designed and built with all the love in the world @twitter by @mdo and @fat.\r\n */\n/* Mixins */\n.oskari-badge {\n  font-weight: bold;\n  color: #ffffff;\n  vertical-align: baseline;\n  white-space: nowrap;\n  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);\n  background-color: #999999;\n  padding: 1px 9px 2px;\n  -webkit-border-radius: 9px;\n  -moz-border-radius: 9px;\n  -o-border-radius: 9px;\n  -ms-border-radius: 9px;\n  border-radius: 9px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box; }\n\na.oskari-badge:hover {\n  color: #ffffff;\n  text-decoration: none;\n  cursor: pointer; }\n\n.oskari-badge-important {\n  background-color: #b94a48; }\n  .oskari-badge-important[href] {\n    background-color: #953b39; }\n\n.oskari-badge-warning {\n  background-color: #f89406; }\n  .oskari-badge-warning[href] {\n    background-color: #c67605; }\n\n.oskari-badge-success {\n  background-color: #468847; }\n  .oskari-badge-success[href] {\n    background-color: #356635; }\n\n.oskari-badge-info {\n  background-color: #3a87ad; }\n  .oskari-badge-info[href] {\n    background-color: #2d6987; }\n\n.oskari-badge-inverse {\n  background-color: #333333; }\n  .oskari-badge-inverse[href] {\n    background-color: #1a1a1a; }\n/*!\r\n * Bootstrap v2.0.3\r\n *\r\n * Copyright 2012 Twitter, Inc\r\n * Licensed under the Apache License v2.0\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Designed and built with all the love in the world @twitter by @mdo and @fat.\r\n */\n/* Mixins */\n.oskari-alert {\n  padding-left: 8px;\n  padding-top: 4px;\n  margin: 4px;\n  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);\n  background-color: #fcf8e3;\n  border: 1px solid #fbeed5;\n  -webkit-border-radius: 4px;\n  -moz-border-radius: 4px;\n  -o-border-radius: 4px;\n  -ms-border-radius: 4px;\n  border-radius: 4px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box;\n  color: #c09853;\n  position: relative;\n  /*height: 24px;*/ }\n\n.oskari-alert-heading {\n  /* Why do we need to have this here? */\n  color: inherit; }\n\n.oskari-alert-icon-close {\n  position: absolute;\n  top: 4px;\n  right: 0px;\n  width: 24px;\n  height: 24px; }\n\n.oskari-alert-success {\n  background-color: #dff0d8;\n  border-color: #d6e9c6;\n  color: #468847; }\n\n/* TODO generalize error/alert/warn/info colors */\n.oskari-alert-danger, .oskari-alert-error {\n  background-color: #f2dede;\n  border-color: #eed3d7;\n  color: #b94a48; }\n\n.oskari-alert-info {\n  background-color: #d9edf7;\n  border-color: #bce8f1;\n  color: #3a87ad; }\nbutton.oskari-formcomponent, input[type=button].oskari-formcomponent, input[type=reset].oskari-formcomponent, input[type=submit].oskari-formcomponent {\n  margin-top: 6px; }\n\nfieldset.oskari-formcomponent {\n  border: 0;\n  margin: 0; }\n  fieldset.oskari-formcomponent > legend {\n    font-weight: normal; }\n\nfieldset.oskari-formcomponent label, label.oskari-formcomponent {\n  display: block;\n  clear: both;\n  margin-bottom: 12px;\n  width: 340px; }\n  fieldset.oskari-formcomponent label input, fieldset.oskari-formcomponent label select, fieldset.oskari-formcomponent label textarea, label.oskari-formcomponent input, label.oskari-formcomponent select, label.oskari-formcomponent textarea {\n    box-sizing: border-box;\n    margin: 3px 0 0 0;\n    clear: left;\n    display: block; }\n  fieldset.oskari-formcomponent label input[type=email], fieldset.oskari-formcomponent label input[type=file], fieldset.oskari-formcomponent label input[type=number], fieldset.oskari-formcomponent label input[type=password], fieldset.oskari-formcomponent label input[type=search], fieldset.oskari-formcomponent label input[type=tel], fieldset.oskari-formcomponent label input[type=text], fieldset.oskari-formcomponent label input[type=url], fieldset.oskari-formcomponent label select, fieldset.oskari-formcomponent label textarea, label.oskari-formcomponent input[type=email], label.oskari-formcomponent input[type=file], label.oskari-formcomponent input[type=number], label.oskari-formcomponent input[type=password], label.oskari-formcomponent input[type=search], label.oskari-formcomponent input[type=tel], label.oskari-formcomponent input[type=text], label.oskari-formcomponent input[type=url], label.oskari-formcomponent select, label.oskari-formcomponent textarea {\n    width: 340px; }\n  fieldset.oskari-formcomponent label input + .icon-close, fieldset.oskari-formcomponent label textarea + .icon-close, label.oskari-formcomponent input + .icon-close, label.oskari-formcomponent textarea + .icon-close {\n    display: none;\n    cursor: pointer;\n    text-align: center;\n    position: absolute;\n    right: 6px; }\n  fieldset.oskari-formcomponent label input + .icon-close, label.oskari-formcomponent input + .icon-close {\n    top: 13px; }\n  fieldset.oskari-formcomponent label textarea + .icon-close, label.oskari-formcomponent textarea + .icon-close {\n    top: 6px; }\n  fieldset.oskari-formcomponent label input, label.oskari-formcomponent input {\n    display: inline-block; }\n    fieldset.oskari-formcomponent label input[type=checkbox], fieldset.oskari-formcomponent label input[type=radio], label.oskari-formcomponent input[type=checkbox], label.oskari-formcomponent input[type=radio] {\n      margin: 0 5px 0 0;\n      vertical-align: middle; }\n  fieldset.oskari-formcomponent label input::-ms-clear, fieldset.oskari-formcomponent label input::-ms-reveal, label.oskari-formcomponent input::-ms-clear, label.oskari-formcomponent input::-ms-reveal {\n    display: none;\n    width: 0;\n    height: 0; }\n  fieldset.oskari-formcomponent label input[type=\"search\"]::-webkit-search-decoration, fieldset.oskari-formcomponent label input[type=\"search\"]::-webkit-search-cancel-button, fieldset.oskari-formcomponent label input[type=\"search\"]::-webkit-search-results-button, fieldset.oskari-formcomponent label input[type=\"search\"]::-webkit-search-results-decoration, label.oskari-formcomponent input[type=\"search\"]::-webkit-search-decoration, label.oskari-formcomponent input[type=\"search\"]::-webkit-search-cancel-button, label.oskari-formcomponent input[type=\"search\"]::-webkit-search-results-button, label.oskari-formcomponent input[type=\"search\"]::-webkit-search-results-decoration {\n    display: none; }\n  fieldset.oskari-formcomponent label span, label.oskari-formcomponent span {\n    vertical-align: middle; }\n  fieldset.oskari-formcomponent label .input-controls, label.oskari-formcomponent .input-controls {\n    position: relative; }\n    fieldset.oskari-formcomponent label .input-controls input, label.oskari-formcomponent .input-controls input {\n      margin: 0; }\n    fieldset.oskari-formcomponent label .input-controls:hover .icon-close, label.oskari-formcomponent .input-controls:hover .icon-close {\n      display: block; }\n\nlabel.oskari-formcomponent.oskari-numberinput .input-controls:hover .icon-close {\n  display: none; }\n\nfieldset.oskari-formcomponent.oskari-radiobuttongroup {\n  margin-bottom: 12px; }\n  fieldset.oskari-formcomponent.oskari-radiobuttongroup label {\n    margin-bottom: 0; }\n\nform.oskari-searchform > label {\n  display: inline-block;\n  width: 260px; }\n  form.oskari-searchform > label .input-controls input {\n    width: 260px;\n    -webkit-border-top-right-radius: 0px;\n    -webkit-border-bottom-right-radius: 0px;\n    -moz-border-radius-topright: 0px;\n    -moz-border-radius-bottomright: 0px;\n    border-top-right-radius: 0px;\n    border-bottom-right-radius: 0px;\n    height: 39px; }\nform.oskari-searchform > input {\n  display: inline-block;\n  width: 80px;\n  -webkit-border-top-right-radius: 4px;\n  -webkit-border-bottom-right-radius: 4px;\n  -moz-border-radius-topright: 4px;\n  -moz-border-radius-bottomright: 4px;\n  border-top-right-radius: 4px;\n  border-bottom-right-radius: 4px;\n  margin: 0; }\ndiv.oskarifield div.icon-close {\n  display: inline-block;\n  left: -20px;\n  margin-left: 0px;\n  position: relative;\n  top: 3px; }\nth.asc {\n  background-image: url('/Oskari/resources/framework/bundle/divmanazer/images/asc_arrow.png');\n  background-repeat: no-repeat;\n  background-position: right center; }\nth.desc {\n  background-image: url('/Oskari/resources/framework/bundle/divmanazer/images/desc_arrow.png');\n  background-repeat: no-repeat;\n  background-position: right center; }\n\ndiv.column-selector-placeholder {\n  border-style: none;\n  float: left;\n  opacity: 1.0;\n  margin-left: 8px;\n  padding: 0;\n  right: 0;\n  width: 200px;\n  height: 30px;\n  max-width: 200px;\n  max-height: 35px; }\n\ndiv.column-selector-title {\n  margin-top: 10px;\n  margin-left: 2px;\n  background-image: url('/Oskari/resources/framework/bundle/divmanazer/images/desc_arrow.png');\n  background-repeat: no-repeat;\n  background-position: 120px 3px;\n  cursor: pointer; }\n\ndiv.icon-menu {\n  position: absolute;\n  opacity: 1.0;\n  margin: 0;\n  cursor: pointer;\n  padding: 0;\n  width: 25px;\n  height: 8px;\n  max-width: 25px;\n  max-height: 7px; }\n\ndiv.column-selector {\n  max-height: 350px;\n  width: 270px;\n  overflow: auto;\n  position: absolute;\n  visibility: hidden;\n  background-color: white;\n  margin-top: 5px;\n  margin-left: 3px;\n  margin-right: 5px;\n  padding: 0;\n  border: 1px solid;\n  z-index: 10001; }\n  div.column-selector div.close-selector-button {\n    width: 16px;\n    height: 16px;\n    position: absolute;\n    top: 5px;\n    right: 5px; }\n  div.column-selector ul.column-selector-list {\n    list-style-type: none;\n    padding-right: 30px; }\n  div.column-selector label.column-label {\n    padding-left: 5px; }\n\ndiv.tab-tools {\n  height: 34px;\n  position: static; }\n\ndiv.exporter {\n  float: right;\n  text-align: left; }\n\ninput.csvExportButton {\n  margin: 3px 5px 2px 10px; }\n\ninput.excelExportButton {\n  margin: 3px 10px 2px 5px; }\n\ntable.oskari-grid td {\n  padding: 5px; }\ntable.oskari-grid td, table.oskari-grid th {\n  min-height: 28px;\n  max-width: 110px;\n  overflow: hidden;\n  border: 1px solid #E6E6E6;\n  text-overflow: ellipsis;\n  padding-left: 10px;\n  padding-right: 10px; }\n  table.oskari-grid td.hidden, table.oskari-grid th.hidden {\n    display: none; }\ntable.oskari-grid th {\n  background-color: #F3F3F3; }\n  table.oskari-grid th a {\n    color: inherit;\n    line-height: 28px;\n    padding: 5px; }\n  table.oskari-grid th.closedSubTable {\n    background-image: url('/Oskari/resources/framework/bundle/divmanazer/images/icon-arrow-right.png');\n    background-repeat: no-repeat;\n    background-position: right center; }\n  table.oskari-grid th.openSubTable {\n    background-image: url('/Oskari/resources/framework/bundle/divmanazer/images/icon-arrow-left.png');\n    background-repeat: no-repeat;\n    background-position: right center; }\ntable.oskari-grid > tr > th, table.oskari-grid > tbody > tr > th {\n  text-align: left; }\ntable.oskari-grid tr:last-child td {\n  border: 1px solid #E6E6E6; }\ndiv.divmanazerpopup {\n  max-width: 800px;\n  min-width: 200px;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  background-color: white;\n  -moz-background-clip: border;\n  /* Firefox 3.6 */\n  -webkit-background-clip: border;\n  /* Safari 4? Chrome 6? */\n  background-clip: border-box;\n  /* Firefox 4, Safari 5, Opera 10, IE 9 */\n  -moz-background-clip: padding;\n  /* Firefox 3.6 */\n  -webkit-background-clip: padding;\n  /* Safari 4? Chrome 6? */\n  background-clip: padding-box;\n  /* Firefox 4, Safari 5, Opera 10, IE 9 */\n  -moz-background-clip: content;\n  /* Firefox 3.6 */\n  -webkit-background-clip: content;\n  /* Safari 4? Chrome 6? */\n  background-clip: content-box;\n  /* Firefox 4, Safari 5, Opera 10, IE 9 */\n  border: 5px solid rgba(0, 0, 0, 0.2);\n  border-radius: 7px;\n  z-index: 10000; }\n  div.divmanazerpopup.no_resize div.content textarea {\n    resize: none; }\n  div.divmanazerpopup.arrow:before, div.divmanazerpopup.arrow:after {\n    border: solid transparent;\n    content: \" \";\n    height: 0;\n    width: 0;\n    position: absolute; }\n  div.divmanazerpopup.top:before, div.divmanazerpopup.top:after {\n    top: 100%; }\n  div.divmanazerpopup.top:before {\n    border-top-color: #000000;\n    border-width: 6px;\n    margin-left: -6px;\n    left: 50%; }\n  div.divmanazerpopup.top:after {\n    border-top-color: #FFFFFF;\n    border-width: 5px;\n    margin-left: -5px;\n    left: 50%; }\n  div.divmanazerpopup.right:before, div.divmanazerpopup.right:after {\n    right: 100%; }\n  div.divmanazerpopup.right:before {\n    border-right-color: #000000;\n    border-width: 6px;\n    margin-top: -6px;\n    top: 50%; }\n  div.divmanazerpopup.right:after {\n    border-right-color: #FDF8D9;\n    border-width: 5px;\n    margin-top: -5px;\n    top: 50%; }\n  div.divmanazerpopup.bottom:before, div.divmanazerpopup.bottom:after {\n    bottom: 100%; }\n  div.divmanazerpopup.bottom:before {\n    border-bottom-color: #000000;\n    border-width: 6px;\n    margin-left: -6px;\n    left: 50%; }\n  div.divmanazerpopup.bottom:after {\n    border-bottom-color: #FDF8D9;\n    border-width: 5px;\n    margin-left: -5px;\n    left: 50%; }\n  div.divmanazerpopup.left:before, div.divmanazerpopup.left:after {\n    left: 100%; }\n  div.divmanazerpopup.left:before {\n    border-left-color: #000000;\n    border-width: 6px;\n    margin-top: -6px;\n    top: 50%; }\n  div.divmanazerpopup.left:after {\n    border-left-color: #FDF8D9;\n    border-width: 5px;\n    margin-top: -5px;\n    top: 50%; }\n  div.divmanazerpopup div.content {\n    margin: 10px; }\n    div.divmanazerpopup div.content textarea {\n      resize: none; }\n    div.divmanazerpopup div.content ul {\n      margin: 10px; }\n  div.divmanazerpopup div.actions {\n    margin: 10px;\n    text-align: center; }\n    div.divmanazerpopup div.actions input {\n      margin: 10px; }\n  div.divmanazerpopup h3.popupHeader {\n    background-color: #FDF8D9;\n    border-radius: 5px 5px 0 0;\n    padding: 8px 10px; }\n.oskari-button {\n  margin-bottom: 12px;\n  margin-left: 0; }\ndiv.oskarioverlay {\n  position: absolute;\n  background-color: black;\n  z-index: 8000; }\n\n.transparent {\n  zoom: 1;\n  filter: alpha(opacity=50);\n  /* unquote for libsass bug */\n  opacity: 0.5; }\n/* Mixins */\ndiv#visualization-form div.renderButton {\n  display: inline-block;\n  border: 1px solid black;\n  margin: 5px; }\n\ndiv.renderdialog label {\n  padding-top: 5px;\n  padding-bottom: 5px; }\ndiv.renderdialog div.icon-button {\n  margin: 0 2px 2px;\n  width: 30px;\n  height: 30px;\n  display: inline-block;\n  border: 1px solid #000000;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box; }\ndiv.renderdialog .ui-widget-content {\n  background: #AAAAAA repeat-x scroll 50% 50% #FFFFFF;\n  border: 1px solid #AAAAAA;\n  color: #222222; }\ndiv.renderdialog .ui-slider {\n  position: relative;\n  text-align: left;\n  width: 110px; }\n  div.renderdialog .ui-slider .ui-slider-handle {\n    cursor: default;\n    height: 1.2em;\n    position: absolute;\n    width: 1.2em;\n    z-index: 2;\n    margin-top: 2px;\n    border: 0 !important; }\ndiv.renderdialog .ui-slider-horizontal {\n  height: 0.8em; }\n  div.renderdialog .ui-slider-horizontal .ui-slider-handle {\n    margin-left: -0.6em;\n    top: -0.3em;\n    background-image: url('/Oskari/resources/framework/bundle/oskariui/images/horizontal_handle.png');\n    background-repeat: no-repeat; }\ndiv.renderdialog .ui-state-default, div.renderdialog .ui-widget-content .ui-state-default, div.renderdialog .ui-widget-header .ui-state-default {\n  background: #222222 repeat-x scroll 50% 50% #E6E6E6;\n  border: 1px solid #D3D3D3;\n  color: #555555;\n  font-weight: normal; }\ndiv.renderdialog .preview {\n  width: 50px;\n  height: 50px;\n  border: 1px solid;\n  margin: 5px; }\ndiv.renderdialog div.actions input {\n  float: right; }\ndiv.renderdialog div.sizer-values {\n  position: relative;\n  margin-left: 5px;\n  margin-top: 5px;\n  margin-bottom: 11px;\n  width: 110px;\n  height: 10px; }\ndiv.renderdialog div.sizer-value {\n  position: absolute; }\ndiv.renderdialog div.icon-buttons {\n  margin-top: 5px;\n  margin-bottom: 5px;\n  margin-left: 5px; }\ndiv.renderdialog div.color-grid {\n  width: 120px;\n  height: 40px;\n  margin: 5px; }\ndiv.renderdialog div.color-rectangle {\n  width: 120px;\n  height: 40px;\n  border: 1px solid #000000;\n  position: absolute; }\ndiv.renderdialog div.color-cell {\n  width: 20px;\n  height: 20px;\n  border: 1px solid #000000;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  float: left; }\ndiv.renderdialog div.colorcontainer {\n  width: 150px;\n  background: #223311; }\ndiv.renderdialog div.colorcolumn1 {\n  float: left;\n  width: 40px;\n  padding: 5px;\n  margin-bottom: 5px; }\ndiv.renderdialog div.colorcolumn2 {\n  float: right;\n  width: 100px;\n  margin-bottom: 5px; }\ndiv.renderdialog div.colorcolumn21 {\n  float: left;\n  width: 40px;\n  padding: 5px; }\ndiv.renderdialog div.colorcolumn22 {\n  float: right;\n  width: 40px;\n  padding: 5px; }\ndiv.renderdialog div.color-label {\n  margin-top: 10px; }\ndiv.renderdialog input.custom-color {\n  width: 25px;\n  margin-top: 5px; }\n  div.renderdialog input.custom-color:disabled {\n    background: #dddddd; }\ndiv.renderdialog input.color-source {\n  margin: 5px; }\ndiv.renderdialog input.linewidth {\n  width: 50px;\n  margin-top: 5px; }\ndiv.renderdialog input.message-text {\n  width: 120px; }\n\ndiv.myplaces2 div.buttons div.button {\n  margin: 10px;\n  padding: 10px;\n  border: 1px solid;\n  border-radius: 5px;\n  -webkit-box-shadow: 5px 5px 5px #888888;\n  -moz-box-shadow: 5px 5px 5px #888888;\n  box-shadow: 5px 5px 5px #888888; }\n\ndiv.simpleColorChooser {\n  background-color: #ffffff;\n  z-index: 10; }\n\n.renderdialog .ui-corner-all, .manageClassificationPlugin .ui-corner-bottom, .manageClassificationPlugin .ui-corner-right, .manageClassificationPlugin .ui-corner-br {\n  border-bottom-right-radius: 4px; }\n\n.renderdialog .ui-corner-all, .manageClassificationPlugin .ui-corner-bottom, .manageClassificationPlugin .ui-corner-left, .manageClassificationPlugin .ui-corner-bl {\n  border-bottom-left-radius: 4px; }\n\n.renderdialog .ui-corner-all, .manageClassificationPlugin .ui-corner-top, .manageClassificationPlugin .ui-corner-right, .manageClassificationPlugin .ui-corner-tr {\n  border-top-right-radius: 4px; }\n\n.renderdialog .ui-corner-all, .manageClassificationPlugin .ui-corner-top, .manageClassificationPlugin .ui-corner-left, .manageClassificationPlugin .ui-corner-tl {\n  border-top-left-radius: 4px; }\n\ndiv.areaform div.column2 {\n  float: right;\n  width: 565px; }\ndiv.areaform div.custom-fill {\n  width: 155px; }\n\ndiv.pointform div.column1 {\n  float: left;\n  width: 160px;\n  height: 225px;\n  padding-left: 5px;\n  padding-right: 5px; }\ndiv.pointform div.sizer {\n  margin-left: 7px;\n  margin-top: 6px; }\n\ndiv.areaform div.column1, div.lineform div.column1 {\n  float: left;\n  width: 130px;\n  height: 270px;\n  padding-left: 5px;\n  padding-right: 5px; }\n\ndiv.pointform div.column2, div.lineform div.column2, div.areaform div.column22 {\n  float: right;\n  width: 350px; }\n\ndiv.renderdialog div.column21, div.areaform div.column221 {\n  float: left;\n  width: 175px;\n  height: 200px;\n  padding-left: 5px;\n  padding-right: 5px; }\n\ndiv.pointform div.column22, div.lineform div.column22, div.areaform div.column222 {\n  float: right;\n  width: 155px;\n  height: 100px;\n  padding-left: 5px;\n  padding-right: 5px; }\n\ndiv.pointvisualization {\n  width: 540px; }\n\ndiv.linevisualization {\n  width: 530px; }\n\ndiv.areavisualization {\n  width: 730px; }\n/*!\r\n * Bootstrap v2.0.3\r\n *\r\n * Copyright 2012 Twitter, Inc\r\n * Licensed under the Apache License v2.0\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Designed and built with all the love in the world @twitter by @mdo and @fat.\r\n */\n/* TODO none of this stuff seems to be in use? */\n/* Mixins */\n.oskari-tooltip {\n  position: absolute;\n  z-index: 1200;\n  display: block;\n  visibility: visible;\n  padding: 5px;\n  font-size: 11px;\n  opacity: 0; }\n  .oskari-tooltip.in {\n    opacity: 0.8; }\n  .oskari-tooltip.top {\n    margin-top: -2px; }\n  .oskari-tooltip.right {\n    margin-left: 2px; }\n  .oskari-tooltip.bottom {\n    margin-top: 2px; }\n  .oskari-tooltip.left {\n    margin-left: -2px; }\n\n.oskari-tooltip.top .oskari-tooltip-arrow {\n  bottom: 0;\n  left: 50%;\n  margin-left: -5px;\n  border-left: 5px solid transparent;\n  border-right: 5px solid transparent;\n  border-top: 5px solid #000000; }\n\n.oskari-tooltip.left .oskari-tooltip-arrow {\n  top: 50%;\n  right: 0;\n  margin-top: -5px;\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  border-left: 5px solid #000000; }\n\n.oskari-tooltip.bottom .oskari-tooltip-arrow {\n  top: 0;\n  left: 50%;\n  margin-left: -5px;\n  border-left: 5px solid transparent;\n  border-right: 5px solid transparent;\n  border-bottom: 5px solid #000000; }\n\n.oskari-tooltip.right .oskari-tooltip-arrow {\n  top: 50%;\n  left: 0;\n  margin-top: -5px;\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  border-right: 5px solid #000000; }\n\n.oskari-tooltip-inner {\n  max-width: 640px;\n  padding: 3px 8px;\n  color: #ffffff;\n  text-align: center;\n  text-decoration: none;\n  background-color: #000000;\n  -webkit-border-radius: 4px;\n  -moz-border-radius: 4px;\n  -o-border-radius: 4px;\n  -ms-border-radius: 4px;\n  border-radius: 4px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box; }\n\n.oskari-tooltip-arrow {\n  position: absolute;\n  width: 0;\n  height: 0; }\n\n.oskari-popover {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 1210;\n  display: none;\n  padding: 5px; }\n  .oskari-popover.top {\n    margin-top: -5px; }\n    .oskari-popover.top .oskari-arrow {\n      bottom: 0;\n      left: 50%;\n      margin-left: -5px;\n      border-left: 5px solid transparent;\n      border-right: 5px solid transparent;\n      border-top: 5px solid #000000; }\n  .oskari-popover.right {\n    margin-left: 5px; }\n    .oskari-popover.right .oskari-arrow {\n      top: 50%;\n      left: 0;\n      margin-top: -5px;\n      border-top: 5px solid transparent;\n      border-bottom: 5px solid transparent;\n      border-right: 5px solid #000000; }\n  .oskari-popover.bottom {\n    margin-top: 5px; }\n    .oskari-popover.bottom .oskari-arrow {\n      top: 0;\n      left: 50%;\n      margin-left: -5px;\n      border-left: 5px solid transparent;\n      border-right: 5px solid transparent;\n      border-bottom: 5px solid #000000; }\n  .oskari-popover.left {\n    margin-left: -5px; }\n    .oskari-popover.left .oskari-arrow {\n      top: 50%;\n      right: 0;\n      margin-top: -5px;\n      border-top: 5px solid transparent;\n      border-bottom: 5px solid transparent;\n      border-left: 5px solid #000000; }\n  .oskari-popover .oskari-arrow {\n    position: absolute;\n    width: 0;\n    height: 0; }\n\n.oskari-popover-inner {\n  padding: 3px;\n  overflow: hidden;\n  background: #000000;\n  background: rgba(0, 0, 0, 0.8);\n  -webkit-border-radius: 6px;\n  -moz-border-radius: 6px;\n  -o-border-radius: 6px;\n  -ms-border-radius: 6px;\n  border-radius: 6px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box;\n  -webkit-box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);\n  -moz-box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);\n  box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3); }\n\n.oskari-popover-title {\n  padding: 9px 15px;\n  line-height: 1;\n  background-color: #f5f5f5;\n  border-bottom: 1px solid #eee;\n  -webkit-border-radius: 3px 3px 0 0;\n  -moz-border-radius: 3px 3px 0 0;\n  -o-border-radius: 3px 3px 0 0;\n  -ms-border-radius: 3px 3px 0 0;\n  border-radius: 3px 3px 0 0;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box; }\n\n.oskari-popover-content {\n  padding: 14px;\n  background-color: #ffffff;\n  -webkit-border-radius: 0 0 3px 3px;\n  -moz-border-radius: 0 0 3px 3px;\n  -o-border-radius: 0 0 3px 3px;\n  -ms-border-radius: 0 0 3px 3px;\n  border-radius: 0 0 3px 3px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box; }\n  .oskari-popover-content p, .oskari-popover-content ul, .oskari-popover-content ol {\n    margin-bottom: 0; }\n#toolbar {\n  margin-top: 30px;\n  width: 100%; }\n\ndiv.toolrow {\n  border-top: 1px solid;\n  line-height: 10px;\n  /* We'll get extra space below the tools without this */\n  padding: 0px 10px; }\n  div.toolrow div.tool {\n    display: inline-block;\n    cursor: pointer; }\n    div.toolrow div.tool.selected, div.toolrow div.tool:hover:not(.disabled), div.toolrow div.tool:active:not(.disabled) {\n      background-color: #212121; }\n\ndiv.linkcontent {\n  word-wrap: break-word;\n  border-style: dashed;\n  border-width: 1px;\n  padding: 5px;\n  max-height: 200px;\n  overflow-y: auto; }\n\ndiv.tool.disabled {\n  cursor: default;\n  opacity: 0.25; }\n\n.divmanazerpopup.oskari-measurement {\n  max-width: 260px; }\n\n.oskariui-menutoolbar {\n  width: 100%;\n  height: 36px;\n  position: relative;\n  background-color: #3C3C3C;\n  height: 40px; }\n  .oskariui-menutoolbar .oskariui-menutoolbar-modetitle {\n    display: inline-block;\n    width: 300px; }\n    .oskariui-menutoolbar .oskariui-menutoolbar-modetitle .oskariui-menutoolbar-title {\n      position: absolute;\n      top: 6px;\n      /* Inverted text... leave it for now as it doesn't even seem to be in use */ }\n      .oskariui-menutoolbar .oskariui-menutoolbar-modetitle .oskariui-menutoolbar-title p {\n        color: #fff;\n        font-size: 16px;\n        line-height: 19px; }\n  .oskariui-menutoolbar .oskariui-menutoolbar-container {\n    display: inline-block; }\n  .oskariui-menutoolbar .oskariui-menutoolbar-closebox {\n    position: absolute;\n    top: 6px;\n    right: 10px; }\n    .oskariui-menutoolbar .oskariui-menutoolbar-closebox div {\n      cursor: pointer; }\n/* Mixins */\ndiv.popupHeader {\n  background-color: #424343;\n  color: #FFFFFF;\n  position: relative;\n  left: 0px;\n  padding: 0px;\n  margin: 0px;\n  -webkit-border-radius: 6px 6px 0px 0px;\n  -moz-border-radius: 6px 6px 0px 0px;\n  -o-border-radius: 6px 6px 0px 0px;\n  -ms-border-radius: 6px 6px 0px 0px;\n  border-radius: 6px 6px 0px 0px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box;\n  display: inline-block;\n  width: 390px;\n  float: left;\n  height: 40px; }\n  div.popupHeader div {\n    vertical-align: top;\n    margin-left: 20px;\n    margin-right: 20px;\n    padding-left: 0;\n    padding-right: 0;\n    padding-top: 0;\n    position: absolute;\n    top: 12px; }\n\ndiv.popupHeaderArrow {\n  width: 0;\n  height: 0;\n  border-top: 10px solid transparent;\n  border-bottom: 10px solid transparent;\n  border-right: 10px solid #424343;\n  display: inline-block;\n  float: left;\n  margin-top: 10px; }\n\ndiv.popupContent {\n  clear: both;\n  margin-left: 10px;\n  background-color: #FFFFFF;\n  position: relative;\n  left: 0px;\n  top: 0px;\n  height: 250px;\n  -webkit-border-radius: 0px 0px 6px 6px;\n  -moz-border-radius: 0px 0px 6px 6px;\n  -o-border-radius: 0px 0px 6px 6px;\n  -ms-border-radius: 0px 0px 6px 6px;\n  border-radius: 0px 0px 6px 6px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box;\n  border: 1px solid;\n  border-color: #424343;\n  overflow: auto;\n  padding: 20px 20px 20px 25px; }\n  div.popupContent hr.infoboxLine {\n    border: 1px solid;\n    width: 90%;\n    margin-top: 10px; }\n  div.popupContent span.infoboxActionLinks {\n    padding-right: 15px;\n    padding-left: 15px; }\n\n/*Pop-up width reduced for places search */\ndiv#searchResultPopup_contentDiv div.popupContent {\n  height: 150px; }\n\ndiv.olPopup {\n  margin: 0;\n  padding: 0;\n  background-color: #ffffff;\n  overflow: auto;\n  /*\\0/ !important*/\n  height: 400px;\n  /*\\0/ !important*/\n  z-index: 16000; }\n\ndiv.olPopupContent {\n  overflow: visible;\n  padding: 0px;\n  margin: 0px;\n  left: 0px;\n  top: 0px; }\n\n.olPopupCloseBox {\n  cursor: pointer;\n  background-attachment: scroll;\n  background-color: transparent;\n  background-origin: padding-box;\n  background-repeat: no-repeat;\n  background-size: auto auto;\n  right: 0px;\n  position: absolute;\n  top: 14px; }\n\ndiv.myplaces_place {\n  padding-bottom: 18px; }\n  div.myplaces_place img.myplaces_img {\n    padding-bottom: 15px;\n    max-height: 350px;\n    max-width: 350px; }\ndiv.search .info {\n  padding-left: 5px; }\ndiv.search div.controls div.oskarifield {\n  display: inline-block; }\ndiv.search div.searchDescription {\n  margin: 0;\n  margin-bottom: 8px; }\ndiv.search div.searchContainer {\n  height: 90%; }\ndiv.search div.resultList {\n  height: 90%;\n  overflow: auto;\n  padding: 0;\n  margin: 5px;\n  border: 1px solid #DDDDDD; }\n  div.search div.resultList h3 {\n    margin: 0 6px;\n    padding-bottom: 0; }\ndiv.search table.search_result {\n  margin-bottom: 0; }\n  div.search table.search_result th {\n    text-align: left; }\ndiv.layerselector2 div.accordion div.accordion_panel div.content {\n  padding: 0; }\ndiv.layerselector2 div.layer {\n  padding: 6px 10px 6px 40px;\n  background-color: #ffffff;\n  clear: both;\n  /* Default line height is too high, make it so the text just fits */\n  min-height: 14px;\n  line-height: 14px; }\n  div.layerselector2 div.layer:nth-child(even) {\n    background-color: #f3f3f3; }\n  div.layerselector2 div.layer input {\n    float: left;\n    margin-right: 5px; }\n    div.layerselector2 div.layer input[type=checkbox] {\n      margin-top: -2px; }\n  div.layerselector2 div.layer div.layer-title {\n    /* Let's just imagine this is tabular data... */\n    font-size: 12px; }\n  div.layerselector2 div.layer div.layer-tools {\n    float: right; }\n  div.layerselector2 div.layer div.layer-icon {\n    float: left;\n    width: 16px;\n    height: 16px;\n    background-repeat: no-repeat; }\n  div.layerselector2 div.layer div.layer-info {\n    width: 16px;\n    height: 16px;\n    margin-left: 5px;\n    float: right; }\n  div.layerselector2 div.layer div.layer-backendstatus-icon {\n    float: left;\n    width: 20px;\n    height: 16px;\n    margin-right: 4px;\n    background-repeat: no-repeat; }\n  div.layerselector2 div.layer div.backendstatus-down {\n    height: 20px !important;\n    margin-bottom: 2px;\n    cursor: pointer; }\n  div.layerselector2 div.layer div.backendstatus-maintenance {\n    height: 20px !important;\n    margin-bottom: 2px;\n    cursor: pointer; }\n  div.layerselector2 div.layer div.backendstatus-ok {\n    height: 20px !important;\n    margin-bottom: 2px;\n    margin-top: -2px;\n    cursor: pointer; }\n  div.layerselector2 div.layer div.backendstatus-unknown {\n    height: 20px !important;\n    margin-bottom: 2px; }\ndiv.layerselector2 div.layerGroup {\n  background-color: #f3f3f3;\n  border: 1px solid #c0d0d0;\n  margin: 0;\n  padding: 0; }\n  div.layerselector2 div.layerGroup.open {\n    background-color: #FFFFFF; }\n  div.layerselector2 div.layerGroup div.groupIcon {\n    display: inline-block;\n    margin-left: 12px;\n    vertical-align: middle; }\n  div.layerselector2 div.layerGroup div.groupHeader {\n    display: inline-block;\n    padding: 8px 10px 8px 12px; }\ndiv.layerselector2 div.tab-content {\n  padding: 0; }\n  div.layerselector2 div.tab-content div.oskarifield {\n    padding: 10px;\n    position: relative; }\n    div.layerselector2 div.tab-content div.oskarifield input[type=text] {\n      width: 90%; }\n    div.layerselector2 div.tab-content div.oskarifield .icon-close {\n      margin-right: -20px; }\n    div.layerselector2 div.tab-content div.oskarifield .field-description {\n      padding: 3px 0;\n      color: #666; }\n      div.layerselector2 div.tab-content div.oskarifield .field-description .icon-info {\n        display: inline-block; }\n    div.layerselector2 div.tab-content div.oskarifield .related-keywords {\n      display: none;\n      overflow: hidden;\n      height: 30px;\n      line-height: 30px; }\n      div.layerselector2 div.tab-content div.oskarifield .related-keywords .keywords-title {\n        box-sizing: border-box;\n        height: 30px;\n        line-height: 30px;\n        color: #000;\n        font-weight: bold;\n        float: left; }\n      div.layerselector2 div.tab-content div.oskarifield .related-keywords .keyword-cont {\n        display: block;\n        box-sizing: border-box;\n        height: 30px;\n        line-height: 30px;\n        padding: 0 10px;\n        color: #0085D1;\n        float: left; }\n        div.layerselector2 div.tab-content div.oskarifield .related-keywords .keyword-cont .keyword {\n          float: left;\n          min-width: 91px; }\n        div.layerselector2 div.tab-content div.oskarifield .related-keywords .keyword-cont .type {\n          background-color: #333438;\n          border: solid 2px #FFDE00;\n          color: #FFDE00;\n          width: 34px;\n          line-height: 16px;\n          padding: 3px;\n          margin: 2px;\n          float: right;\n          display: inline-block;\n          text-align: center; }\n      div.layerselector2 div.tab-content div.oskarifield .related-keywords .focus {\n        background-color: #333438;\n        color: white; }\ndiv.layerselection2 .layer.selected {\n  border: 1pt solid #c0d0e0;\n  margin: 0 5px 5px 0;\n  height: 70px9;\n  /*IE9 */ }\n  div.layerselection2 .layer.selected div.layer-info {\n    background-color: #FFF;\n    padding: 5px; }\n    div.layerselection2 .layer.selected div.layer-info div.layer-icon {\n      float: left;\n      height: 20px;\n      margin-top: 5px;\n      margin-left: 20px;\n      margin-right: 20px;\n      width: 16px;\n      background-repeat: no-repeat; }\n    div.layerselection2 .layer.selected div.layer-info div.layer-title {\n      cursor: move;\n      display: inline; }\n      div.layerselection2 .layer.selected div.layer-info div.layer-title h4 {\n        font: 14pt Arial, sans-serif;\n        padding: 0; }\n    div.layerselection2 .layer.selected div.layer-info div.layer-tool-remove {\n      float: right; }\n  div.layerselection2 .layer.selected div.layer-tools {\n    background-color: #f3f3f3;\n    padding: 7px; }\n    div.layerselection2 .layer.selected div.layer-tools div.layout-slider {\n      width: 140px;\n      display: inline-block;\n      margin-right: 16px; }\n    div.layerselection2 .layer.selected div.layer-tools div.left-tools {\n      display: inline-block; }\n      div.layerselection2 .layer.selected div.layer-tools div.left-tools div.layer-visibility {\n        padding-right: 5px;\n        display: inline-block; }\n      div.layerselection2 .layer.selected div.layer-tools div.left-tools div.layer-opacity {\n        display: inline-block;\n        background-image: url('/Oskari/resources/framework/bundle/layerselection2/images/opacity_slider.png');\n        background-repeat: no-repeat; }\n        div.layerselection2 .layer.selected div.layer-tools div.left-tools div.layer-opacity input.opacity {\n          padding: 1px;\n          width: 25px; }\n    div.layerselection2 .layer.selected div.layer-tools div.right-tools {\n      padding-top: 5px;\n      float: right; }\n      div.layerselection2 .layer.selected div.layer-tools div.right-tools div {\n        float: left;\n        margin-right: 5px; }\n        div.layerselection2 .layer.selected div.layer-tools div.right-tools div.layer-rights, div.layerselection2 .layer.selected div.layer-tools div.right-tools div.object-data {\n          padding-top: 2px; }\n        div.layerselection2 .layer.selected div.layer-tools div.right-tools div.object-data a {\n          padding-left: 5px; }\n  div.layerselection2 .layer.selected div.stylesel label {\n    padding: 7px; }\ndiv.layerselection2 ul.selectedLayersList {\n  height: 100%;\n  width: 100%;\n  overflow: auto;\n  list-style-type: none;\n  padding: 0;\n  margin: 0; }\n  div.layerselection2 ul.selectedLayersList span {\n    position: absolute;\n    margin-left: -1.3em; }\n.maplegend-layer {\n  padding-left: 8px; }\n\n.maplegend-legend {\n  padding-top: 8px;\n  padding-left: 8px;\n  overflow: hidden; }\n/* Mixins */\n/* Override popup styles */\ndiv.divmanazerpopup.guidedtour.arrow:after, div.divmanazerpopup.guidedtour.arrow:before {\n  display: none; }\ndiv.divmanazerpopup.guidedtour.bluetitle h3 {\n  /* Same as h3.inverted? */\n  color: #fff;\n  font-weight: normal;\n  background-color: #1995fd;\n  -webkit-border-radius: 3px 3px 0 0;\n  -moz-border-radius: 3px 3px 0 0;\n  -o-border-radius: 3px 3px 0 0;\n  -ms-border-radius: 3px 3px 0 0;\n  border-radius: 3px 3px 0 0;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box; }\n  div.divmanazerpopup.guidedtour.bluetitle h3 span {\n    float: right;\n    padding-top: 3px; }\ndiv.divmanazerpopup.guidedtour.draggable {\n  cursor: move; }\ndiv.divmanazerpopup.guidedtour .actions input {\n  display: inline-block;\n  vertical-align: baseline;\n  margin: 0 2px;\n  outline: none;\n  cursor: pointer;\n  text-align: center;\n  text-decoration: none;\n  padding: 4px 10px;\n  -webkit-border-radius: 4px;\n  -moz-border-radius: 4px;\n  -o-border-radius: 4px;\n  -ms-border-radius: 4px;\n  border-radius: 4px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box;\n  color: #fff;\n  border: solid 1px #2670b5;\n  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.35);\n  background: #3996ed;\n  background: -webkit-gradient(linear, left top, left bottom, from(#3a97ee), to(#217ad4));\n  background: -moz-linear-gradient(top, #3a97ee, #217ad4);\n  background: -ms-linear-gradient(top, #3a97ee, #217ad4);\n  /* For some reason sass didn't like this in one line... */\n  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#3a97ee', endColorstr='#217ad4');\n  background: linear-gradient(top, #3a97ee, #217ad4); }\n  div.divmanazerpopup.guidedtour .actions input:hover {\n    text-decoration: none;\n    color: #fff;\n    background: -webkit-gradient(linear, left top, left bottom, from(#3a97ee), to(#217ad4));\n    background: -moz-linear-gradient(top, #3a97ee, #217ad4);\n    background: -ms-linear-gradient(top, #3a97ee, #217ad4);\n    /* For some reason sass didn't like this in one line... */\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#3a97ee', endColorstr='#217ad4');\n    background: linear-gradient(top, #3a97ee, #217ad4); }\n  div.divmanazerpopup.guidedtour .actions input:active {\n    position: relative;\n    top: 1px;\n    color: #19456d;\n    text-shadow: none;\n    background: -webkit-gradient(linear, left top, left bottom, from(#3a97ee), to(#217ad4));\n    background: -moz-linear-gradient(top, #3a97ee, #217ad4);\n    background: -ms-linear-gradient(top, #3a97ee, #217ad4);\n    /* For some reason sass didn't like this in one line... */\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#3a97ee', endColorstr='#217ad4');\n    background: linear-gradient(top, #3a97ee, #217ad4); }\n/* Mixins */\n.mapplugin.coordinates {\n  background: #fafafa;\n  border: 1px solid #e6e6e6;\n  -webkit-border-radius: 2px;\n  -moz-border-radius: 2px;\n  -o-border-radius: 2px;\n  -ms-border-radius: 2px;\n  border-radius: 2px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box;\n  box-sizing: border-box;\n  font-size: 11px;\n  line-height: 15px;\n  padding: 2px 5px 0;\n  text-align: left; }\n  .mapplugin.coordinates > div > div {\n    display: inline-block;\n    padding-bottom: 2px; }\n    .mapplugin.coordinates > div > div:last-child {\n      float: right; }\n/* Mixins */\n#contentMap.statsgrid-contentMap {\n  position: relative; }\n\n.oskariui-mode-content {\n  height: 100%;\n  background-color: white; }\n  .oskariui-mode-content.statsgrid-mode {\n    overflow: hidden;\n    height: auto;\n    width: 100%;\n    position: absolute;\n    top: 0;\n    bottom: 0; }\n\n.oskariui-left {\n  float: left; }\n\n.oskariui-center {\n  float: left; }\n\n.statsgrid_100 {\n  height: 100%; }\n\n.statsgrid {\n  min-width: 100%;\n  min-height: 100%;\n  height: 100%; }\n  .statsgrid .statsgrid-table {\n    min-height: 80%;\n    height: 80%; }\n  .statsgrid .idContainer {\n    margin: 4px;\n    border: 1pt solid #40B0C0;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n    -o-border-radius: 5px;\n    -ms-border-radius: 5px;\n    border-radius: 5px;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box;\n    padding: 4px;\n    background-color: #80F0A0;\n    cursor: pointer; }\n  .statsgrid .indicator-cont .icon-info {\n    display: inline-block;\n    margin: 0 0 5px 5px; }\n  .statsgrid .municipal-grid {\n    width: 100%;\n    height: 80%; }\n  .statsgrid .data-source-select {\n    margin-top: 5px; }\n    .statsgrid .data-source-select .new-indicator-cont input {\n      margin-left: 10px; }\n    .statsgrid .data-source-select .selector-cont {\n      clear: left;\n      float: left; }\n  .statsgrid .parameters-cont {\n    min-height: 115px;\n    margin-bottom: 20px; }\n    .statsgrid .parameters-cont button {\n      margin: 8px 0 10px 8px; }\n    .statsgrid .parameters-cont .cannot-display-indicator {\n      margin-left: 10px; }\n  .statsgrid .selector-cont {\n    clear: both;\n    /* Make chosen fit in a bit better */\n    /* TODO move this to either chosen override css or forms.css */ }\n    .statsgrid .selector-cont label {\n      display: inline-block;\n      width: 80px;\n      padding: 10px;\n      vertical-align: top; }\n    .statsgrid .selector-cont select.indi {\n      width: 200px; }\n    .statsgrid .selector-cont select.parameter {\n      width: 100px; }\n    .statsgrid .selector-cont .chzn-container-single .chzn-single {\n      height: 34px;\n      line-height: 35px; }\n      .statsgrid .selector-cont .chzn-container-single .chzn-single div b {\n        background-position: 0px 8px; }\n    .statsgrid .selector-cont .chzn-container-single .chzn-single-with-drop div b {\n      background-position: -16px 8px; }\n    .statsgrid .selector-cont .chzn-container-single .chzn-single, .statsgrid .selector-cont .chzn-container-single .chzn-single-with-drop {\n      background: -webkit-gradient(linear, left top, left bottom, from(#fefefe), to(#e3e3e3));\n      background: -moz-linear-gradient(top, #fefefe, #e3e3e3);\n      background: -ms-linear-gradient(top, #fefefe, #e3e3e3);\n      /* For some reason sass didn't like this in one line... */\n      filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#fefefe', endColorstr='#e3e3e3');\n      background: linear-gradient(top, #fefefe, #e3e3e3); }\n  .statsgrid .selectors-container {\n    position: relative;\n    height: 20%;\n    min-height: 157px;\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    min-width: 470px; }\n    .statsgrid .selectors-container .indisel {\n      display: inline-block; }\n    .statsgrid .selectors-container .new-indicator-cont {\n      float: left;\n      margin-top: 8px;\n      padding-left: 10px; }\n      .statsgrid .selectors-container .new-indicator-cont input {\n        float: right;\n        margin: 0px; }\n\n.statsgrid-csv-button {\n  position: absolute;\n  left: 10px;\n  bottom: 10px; }\n\n.statsgrid-variable {\n  float: left;\n  clear: both; }\n\n.statsgrid-totals-label {\n  font-weight: bold; }\n\n.statsgrid-show-total-selects label, .statsgrid-show-row-selects label {\n  margin-left: 5px; }\n\n.statsgrid-show-row-selects {\n  border-top: solid 1px black;\n  padding-top: 5px; }\n\n/**\r\n * Style the drop-down menu here since the plugin stylesheet mostly contains structural CSS.\r\n */\n.slick-header-menu {\n  border: 1px solid #999;\n  background: #fcfcfc;\n  padding: 2px;\n  -webkit-box-shadow: 2px 2px 2px #c0c0c0;\n  -moz-box-shadow: 2px 2px 2px #c0c0c0;\n  box-shadow: 2px 2px 2px #c0c0c0;\n  min-width: 100px;\n  z-index: 20; }\n  .slick-header-menu .slick-header-menuitem {\n    padding: 2px 4px;\n    border: 1px solid transparent;\n    -webkit-border-radius: 3px;\n    -moz-border-radius: 3px;\n    -o-border-radius: 3px;\n    -ms-border-radius: 3px;\n    border-radius: 3px;\n    -webkit-background-clip: padding-box;\n    -moz-background-clip: padding-box;\n    background-clip: padding-box; }\n    .slick-header-menu .slick-header-menuitem:hover {\n      border-color: silver;\n      background: white; }\n\n.slick-header-menuitem-disabled {\n  border-color: transparent !important;\n  background: inherit !important; }\n\n.icon-help {\n  background-image: url(/Oskari/libraries/slickgrid/images/help.png); }\n\n.statsgrid-highlight-row {\n  background-color: yellow; }\n\n/* Filter popup */\n.divmanazerpopup .filter-row {\n  clear: both;\n  padding-top: 10px; }\n.divmanazerpopup .filter-label {\n  float: left;\n  width: 100px;\n  /* FIXME use an h3 here or something... */\n  font-weight: bold; }\n.divmanazerpopup .filter-value {\n  float: left;\n  margin-left: 10px; }\n.divmanazerpopup .filter-container:after {\n  content: \"\";\n  display: table;\n  clear: both; }\n.divmanazerpopup .filter-select {\n  width: 195px; }\n.divmanazerpopup .filter-input {\n  width: 70px;\n  float: left;\n  margin-top: 10px; }\n.divmanazerpopup .filter-between {\n  display: none;\n  float: left;\n  margin: 20px 10px;\n  width: 10px;\n  text-align: center; }\n\ndiv.filter-region-select select {\n  width: 350px; }\ndiv.filter-region-select ul {\n  margin: 0 !important; }\n\n.statsgrid-remove-indicator {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n  width: 16px !important;\n  height: 16px !important; }\n\n.statsgrid-no-indicator-data {\n  position: absolute;\n  top: inherit;\n  right: 30px;\n  width: 20px !important;\n  height: 20px !important; }\n\n.statsgrid-hide-header {\n  visibility: hidden; }\n\nform.add-indicator h2 {\n  margin-left: 10px; }\nform.add-indicator fieldset {\n  border: 0;\n  margin: 0;\n  padding: 10px; }\n  form.add-indicator fieldset legend {\n    font-weight: bold; }\n  form.add-indicator fieldset label {\n    clear: left;\n    float: left;\n    display: block;\n    width: 150px; }\n  form.add-indicator fieldset input, form.add-indicator fieldset select {\n    clear: right;\n    display: block;\n    float: left;\n    margin-left: 0; }\n  form.add-indicator fieldset button {\n    float: right;\n    margin-left: 15px; }\n  form.add-indicator fieldset textarea {\n    display: block;\n    height: 100px;\n    width: 100%;\n    margin-bottom: 5px;\n    clear: both; }\nform.add-indicator hr {\n  border: solid 1px black;\n  margin: 0 0 10px; }\nform.add-indicator .municipalities {\n  position: absolute;\n  bottom: 40px;\n  top: 585px;\n  left: -10px;\n  width: 100%;\n  overflow: auto;\n  margin: 0; }\n  form.add-indicator .municipalities .municipality-row label {\n    display: inline-block;\n    padding-left: 10px;\n    width: 150px;\n    font-weight: bold; }\nform.add-indicator .form-submit {\n  height: 40px;\n  position: absolute;\n  bottom: 0px;\n  left: 0;\n  right: 0;\n  padding: 0; }\n  form.add-indicator .form-submit button {\n    float: right;\n    margin: 5px; }\n    form.add-indicator .form-submit button.cancel-form-button {\n      float: left; }\n\n.indicator-name-link {\n  color: #0085d1;\n  cursor: pointer; }\n.manageClassificationPlugin {\n  z-index: 1000000 !important;\n  max-width: 240px;\n  background-color: white !important;\n  color: #000 !important;\n  padding: 0px;\n  text-align: left;\n  font-size: 12px;\n  position: absolute;\n  bottom: 8px;\n  right: 10px;\n  cursor: pointer; }\n  .manageClassificationPlugin .content select {\n    padding: 0px;\n    margin: 4px; }\n  .manageClassificationPlugin div#pop-up_06052013 {\n    /* HOVER colortable details */\n    display: none;\n    position: absolute;\n    width: 100px;\n    padding: 0px;\n    background: #E6E6E6;\n    color: #000;\n    border: 1px solid #1a1a1a;\n    font-size: 90%; }\n  .manageClassificationPlugin div.classCount {\n    float: left;\n    background-color: #FFF !important;\n    padding: 0px;\n    margin: 2px; }\n  .manageClassificationPlugin div.classheader {\n    color: #FFF;\n    background-color: #000 !important;\n    padding: 4px; }\n    .manageClassificationPlugin div.classheader .header-icon {\n      display: inline-block;\n      vertical-align: middle; }\n  .manageClassificationPlugin div.classifications {\n    margin: 4px;\n    min-width: 168px; }\n    .manageClassificationPlugin div.classifications div.classificationOptions {\n      margin: 4px; }\n  .manageClassificationPlugin div.content {\n    color: black;\n    background-color: white !important; }\n    .manageClassificationPlugin div.content label {\n      float: left;\n      width: 80px;\n      padding: 10px;\n      font-weight: bold; }\n  .manageClassificationPlugin div.header-icon icon-arrow-white-right {\n    padding: 4px; }\n  .manageClassificationPlugin input[type=\"button\"] {\n    margin: 0.5em; }\n  .manageClassificationPlugin input[type=\"text\"] {\n    background-image: none;\n    color: #f6931f;\n    font-weight: bold;\n    width: 40px;\n    border: 0;\n    color: #f6931f;\n    font-weight: bold; }\n  .manageClassificationPlugin .manualBreaks input[type=\"text\"] {\n    width: 180px;\n    float: left; }\n  .manageClassificationPlugin .manualBreaks .icon-info {\n    float: left;\n    margin-top: 6px; }\n  .manageClassificationPlugin .classification-guide {\n    padding-left: 5px; }\n  .manageClassificationPlugin .ui-corner-all, .manageClassificationPlugin .ui-corner-bottom, .manageClassificationPlugin .ui-corner-right, .manageClassificationPlugin .ui-corner-br {\n    border-bottom-right-radius: 4px; }\n  .manageClassificationPlugin .ui-corner-all, .manageClassificationPlugin .ui-corner-bottom, .manageClassificationPlugin .ui-corner-left, .manageClassificationPlugin .ui-corner-bl {\n    border-bottom-left-radius: 4px; }\n  .manageClassificationPlugin .ui-corner-all, .manageClassificationPlugin .ui-corner-top, .manageClassificationPlugin .ui-corner-right, .manageClassificationPlugin .ui-corner-tr {\n    border-top-right-radius: 4px; }\n  .manageClassificationPlugin .ui-corner-all, .manageClassificationPlugin .ui-corner-top, .manageClassificationPlugin .ui-corner-left, .manageClassificationPlugin .ui-corner-tl {\n    border-top-left-radius: 4px; }\n  .manageClassificationPlugin .ui-slider {\n    position: relative;\n    text-align: left;\n    width: 200px; }\n    .manageClassificationPlugin .ui-slider .ui-slider-handle {\n      cursor: default;\n      width: 1.2em;\n      height: 1.2em;\n      position: absolute;\n      z-index: 2; }\n  .manageClassificationPlugin .ui-slider-horizontal {\n    height: 0.8em; }\n    .manageClassificationPlugin .ui-slider-horizontal .ui-slider-handle {\n      margin-left: -0.6em;\n      top: -0.3em; }\n  .manageClassificationPlugin .ui-state-default, .manageClassificationPlugin .ui-widget-content .ui-state-default, .manageClassificationPlugin .ui-widget-header .ui-state-default {\n    background: #222 repeat-x scroll 50% 50% #E6E6E6;\n    border: 1px solid #D3D3D3;\n    color: #555;\n    font-weight: normal; }\n  .manageClassificationPlugin .ui-widget {\n    font-family: Verdana, Arial, sans-serif;\n    font-size: 1.1em; }\n  .manageClassificationPlugin .ui-widget-content {\n    background: #AAA repeat-x scroll 50% 50% #FFF;\n    border: 1px solid #AAA;\n    color: #222; }\n\n/* TODO should these be under .manageClassificationPlugin? */\n.geostats-legend div {\n  margin-bottom: 3px; }\n\n.geostats-legend-block {\n  border: 1px solid #555;\n  display: inline-table;\n  float: none;\n  height: 12px;\n  margin: 2px 5px 0 0;\n  width: 20px;\n  vertical-align: middle; }\n\n.geostats-legend-counter {\n  color: #666;\n  font-size: 0.8em;\n  font-style: italic; }\n\n.geostats-legend-title {\n  font-weight: bold;\n  margin-bottom: 4px; }\n\ntable.colo_table1 td.selected {\n  background-color: #AAA; }\ntable.colo_table1 td.hover {\n  background-color: #D4A017; }\ntable.colo_table1 div {\n  display: inline-block;\n  height: 15px;\n  width: 5px; }\n/*\r\nIMPORTANT:\r\nIn order to preserve the uniform grid appearance, all cell styles need to have padding, margin and border sizes.\r\nNo built-in (selected, editable, highlight, flashing, invalid, loading, :focus) or user-specified CSS\r\nclasses should alter those!\r\n*/\r\n\r\n.slick-header.ui-state-default, .slick-headerrow.ui-state-default {\r\n  width: 100%;\r\n  overflow: hidden;\r\n  border-left: 0px;\r\n}\r\n\r\n.slick-header-columns, .slick-headerrow-columns {\r\n  position: relative;\r\n  white-space: nowrap;\r\n  cursor: default;\r\n  overflow: hidden;\r\n}\r\n\r\n.slick-header-column.ui-state-default {\r\n  position: relative;\r\n  display: inline-block;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  height: 20px;\r\n  line-height: 20px;\r\n  margin: 0;\r\n  padding: 4px;\r\n  border-right: 1px solid silver;\r\n  border-left: 0px;\r\n/* Oskari change,  border-top: 0px; */\r\n  border-bottom: 0px;\r\n  float: left;\r\n}\r\n\r\n.slick-headerrow-column.ui-state-default {\r\n  padding: 4px;\r\n}\r\n\r\n.slick-header-column-sorted {\r\n  background-color: #FEDA00;\r\n/* Oskari change,  font-style: italic;*/\r\n}\r\n\r\n.slick-sort-indicator {\r\n  display: inline-block;\r\n  width: 8px;\r\n  height: 5px;\r\n  margin-left: 4px;\r\n}\r\n\r\n.slick-sort-indicator-desc {\r\n  background: url(/Oskari/libraries/slickgrid/css/images/sort-desc.gif);\r\n}\r\n\r\n.slick-sort-indicator-asc {\r\n  background: url(/Oskari/libraries/slickgrid/css/images/sort-asc.gif);\r\n}\r\n\r\n.slick-resizable-handle {\r\n  position: absolute;\r\n  font-size: 0.1px;\r\n  display: block;\r\n  cursor: pointer;\r\n  width: 4px;\r\n  right: 0px;\r\n  top: 0;\r\n  height: 100%;\r\n}\r\n\r\n.slick-sortable-placeholder {\r\n  background: silver;\r\n}\r\n\r\n.grid-canvas {\r\n  position: relative;\r\n  outline: 0;\r\n}\r\n\r\n.slick-row.ui-widget-content, .slick-row.ui-state-active {\r\n  position: absolute;\r\n  border: 0px;\r\n  width: 100%;\r\n}\r\n\r\n.slick-cell, .slick-headerrow-column {\r\n  position: absolute;\r\n\r\n  border: 1px solid transparent;\r\n  border-right: 1px dotted silver;\r\n  border-bottom-color: silver;\r\n\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n  vertical-align: middle;\r\n  z-index: 1;\r\n  padding: 1px 2px 2px 1px;\r\n  margin: 0;\r\n\r\n  white-space: nowrap;\r\n\r\n  cursor: default;\r\n}\r\n\r\n.slick-group {\r\n}\r\n\r\n.slick-group-toggle {\r\n  display: inline-block;\r\n}\r\n\r\n.slick-cell.highlighted {\r\n  background: lightskyblue;\r\n  background: rgba(0, 0, 255, 0.2);\r\n  -webkit-transition: all 0.5s;\r\n  -moz-transition: all 0.5s;\r\n  transition: all 0.5s;\r\n}\r\n\r\n.slick-cell.flashing {\r\n  border: 1px solid red !important;\r\n}\r\n\r\n.slick-cell.editable {\r\n  z-index: 11;\r\n  overflow: visible;\r\n  background: white;\r\n  border-color: black;\r\n  border-style: solid;\r\n}\r\n\r\n.slick-cell:focus {\r\n  outline: none;\r\n}\r\n\r\n.slick-reorder-proxy {\r\n  display: inline-block;\r\n  background: blue;\r\n  opacity: 0.15;\r\n  filter: alpha(opacity = 15);\r\n  cursor: move;\r\n}\r\n\r\n.slick-reorder-guide {\r\n  display: inline-block;\r\n  height: 2px;\r\n  background: blue;\r\n  opacity: 0.7;\r\n  filter: alpha(opacity = 70);\r\n}\r\n\r\n.slick-selection {\r\n  z-index: 10;\r\n  position: absolute;\r\n  border: 2px dashed black;\r\n}\r\n\r\n.slicktick {\r\n    background-image: url('/Oskari/libraries/slickgrid/css/images/tick.png');\r\n    background-repeat: no-repeat;\r\n    height: 16px;\r\n    width: 16px;\r\n       \r\n}/*\r\nIMPORTANT:\r\nIn order to preserve the uniform grid appearance, all cell styles need to have padding, margin and border sizes.\r\nNo built-in (selected, editable, highlight, flashing, invalid, loading, :focus) or user-specified CSS\r\nclasses should alter those!\r\n*/\r\n\r\n.slick-header-columns {\r\n/* Oskari change,  background: url('/Oskari/libraries/slickgrid/css/images/header-columns-bg.gif') repeat-x center bottom;\r\n  border-bottom: 1px solid silver; */\r\n  border-bottom: 2px solid black;\r\n}\r\n\r\n.slick-header-column {\r\n/* Oskari change,  background: url('/Oskari/libraries/slickgrid/css/images/header-columns-bg.gif') repeat-x center bottom; */\r\n  border-right: 1px solid silver;\r\n/*\r\n  Oskari change:\r\n  border-top: 40px solid transparent;\r\n*/\r\n  padding-top: 40px !important;\r\n}\r\n\r\n/* Oskari change,\r\n.slick-header-column:hover, .slick-header-column-active {\r\n  background: white url('/Oskari/libraries/slickgrid/css/images/header-columns-over-bg.gif') repeat-x center bottom;\r\n}\r\n*/\r\n\r\n.slick-headerrow {\r\n  background: #fafafa;\r\n}\r\n\r\n.slick-headerrow-column {\r\n  background: #fafafa;\r\n  border-bottom: 0;\r\n  height: 100%;\r\n}\r\n\r\n.slick-row.ui-state-active {\r\n  background: #F5F7D7;\r\n}\r\n\r\n.slick-row {\r\n  position: absolute;\r\n  background: white;\r\n  border: 0px;\r\n  line-height: 20px;\r\n}\r\n\r\n.slick-row.selected {\r\n  z-index: 10;\r\n  background: #DFE8F6;\r\n}\r\n\r\n.slick-cell {\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n.slick-group {\r\n/* Oskari change,  border-bottom: 2px solid silver; */\r\nborder-bottom: 2px solid red;\r\n}\r\n\r\n.slick-group-toggle {\r\n  width: 9px;\r\n  height: 9px;\r\n  margin-right: 5px;\r\n}\r\n\r\n.slick-group-toggle.expanded {\r\n  background: url('/Oskari/libraries/slickgrid/css/images/collapse.gif') no-repeat center center;\r\n}\r\n\r\n.slick-group-toggle.collapsed {\r\n  background: url('/Oskari/libraries/slickgrid/css/images/expand.gif') no-repeat center center;\r\n}\r\n\r\n.slick-group-totals {\r\n  color: gray;\r\n  background: white;\r\n}\r\n\r\n.slick-cell.selected {\r\n  background-color: #c0d0e0;\r\n}\r\n\r\n.slick-cell.active {\r\n  border-color: gray;\r\n  border-style: solid;\r\n}\r\n\r\n.slick-sortable-placeholder {\r\n  background: silver !important;\r\n}\r\n\r\n.slick-row.odd {\r\n  background: #fafafa;\r\n}\r\n\r\n.slick-row.ui-state-active {\r\n  background: #F5F7D7;\r\n}\r\n\r\n.slick-row.loading {\r\n  opacity: 0.5;\r\n  filter: alpha(opacity = 50);\r\n}\r\n\r\n.slick-cell.invalid {\r\n  border-color: red;\r\n}\r\n.statsgrid ul {\r\n    cursor: default;\r\n    margin-left: 0;\r\n    padding: 0;\r\n}\r\n.statsgrid li {\r\n    /*background: url(\"/Oskari/libraries/slickgrid/images/arrow_right_spearmint.png\") no-repeat scroll left center transparent;*/\r\n    list-style: none outside none;\r\n    margin: 0;\r\n    padding: 0 0 0 14px;\r\n}\r\n#municipalGrid {\r\n    background: none repeat scroll 0 0 white;\r\n    border: 1px solid gray;\r\n    outline: 0 none;\r\n    -moz-box-sizing: border-box;\r\n    -ie-box-sizing: border-box;\r\n    -o-box-sizing: border-box;\r\n    box-sizing: border-box;\r\n    /* Table font */\r\n    font-size: 12px;\r\n}\r\n.slick-header {\r\n    -moz-border-bottom-colors: none;\r\n    -moz-border-left-colors: none;\r\n    -moz-border-right-colors: none;\r\n    -moz-border-top-colors: none;\r\n    background-color: #fafafa;\r\n    border-color: -moz-use-text-color gray;\r\n    border-image: none;\r\n    color: #000;\r\n    line-height: 24px;\r\n    font-weight: bold;\r\n}\r\n.grid-header label {\r\n    display: inline-block;\r\n    font-weight: bold;\r\n    margin: auto auto auto 6px;\r\n}\r\n.grid-header .ui-icon {\r\n    background-color: transparent;\r\n    border-color: transparent;\r\n    margin: 4px 4px auto 6px;\r\n}\r\n.grid-header .ui-icon.ui-state-hover {\r\n    background-color: white;\r\n}\r\n.grid-header #txtSearch {\r\n    border: 1px solid silver;\r\n    margin: 0 4px;\r\n    padding: 2px;\r\n}\r\n.options-panel {\r\n    background: none repeat scroll 0 0 #F0F0F0;\r\n    border: 1px solid silver;\r\n    left: 650px;\r\n    margin-bottom: 20px;\r\n    padding: 4px;\r\n    position: absolute;\r\n    top: 0;\r\n    width: 320px;\r\n}\r\n.slick-cell.task-name {\r\n    font-weight: bold;\r\n    text-align: right;\r\n}\r\n.slick-cell.task-percent {\r\n    text-align: right;\r\n}\r\n.slick-cell.cell-move-handle {\r\n    background: none repeat scroll 0 0 #EFEFEF;\r\n    border-right: medium solid gray;\r\n    cursor: move;\r\n    font-weight: bold;\r\n    text-align: right;\r\n}\r\n.cell-move-handle:hover {\r\n    background: none repeat scroll 0 0 #B6B9BD;\r\n}\r\n.slick-row.selected .cell-move-handle {\r\n    background: none repeat scroll 0 0 #D5DC8D;\r\n}\r\n.slick-row .cell-actions {\r\n    text-align: left;\r\n}\r\n.slick-row.complete {\r\n    background-color: #DDFFDD;\r\n    color: #555555;\r\n}\r\n.percent-complete-bar {\r\n    display: inline-block;\r\n    height: 6px;\r\n}\r\n.statsgrid input.editor-text {\r\n    background: none repeat scroll 0 0 transparent;\r\n    border: 0 none;\r\n    height: 100%;\r\n    margin: 0;\r\n    outline: 0 none;\r\n    padding: 0;\r\n    width: 100%;\r\n}\r\n.ui-datepicker-trigger {\r\n    margin-top: 2px;\r\n    padding: 0;\r\n    vertical-align: top;\r\n}\r\n.statsgrid input.editor-percentcomplete {\r\n    background: none repeat scroll 0 0 transparent;\r\n    border: 0 none;\r\n    float: left;\r\n    height: 100%;\r\n    margin: 0;\r\n    outline: 0 none;\r\n    padding: 0;\r\n    width: 100%;\r\n}\r\n.editor-percentcomplete-picker {\r\n    background: url(\"/Oskari/libraries/slickgrid/images/pencil.gif\") no-repeat scroll center center transparent;\r\n    display: inline-block;\r\n    float: right;\r\n    height: 100%;\r\n    overflow: visible;\r\n    position: relative;\r\n    width: 16px;\r\n    z-index: 1000;\r\n}\r\n.editor-percentcomplete-helper {\r\n    background: url(\"/Oskari/libraries/slickgrid/images/editor-helper-bg.gif\") no-repeat scroll left top transparent;\r\n    border: 0 solid gray;\r\n    display: none;\r\n    height: 140px;\r\n    left: -9px;\r\n    overflow: visible;\r\n    padding-left: 9px;\r\n    position: absolute;\r\n    top: -2px;\r\n    width: 120px;\r\n}\r\n.editor-percentcomplete-wrapper {\r\n    -moz-border-bottom-colors: none;\r\n    -moz-border-left-colors: none;\r\n    -moz-border-right-colors: none;\r\n    -moz-border-top-colors: none;\r\n    background: none repeat scroll 0 0 beige;\r\n    border-color: gray gray gray -moz-use-text-color;\r\n    border-image: none;\r\n    border-style: solid solid solid none;\r\n    border-width: 1px 1px 1px 0;\r\n    height: 98px;\r\n    padding: 20px 8px;\r\n    width: 100%;\r\n}\r\n.editor-percentcomplete-buttons {\r\n    float: right;\r\n}\r\n.editor-percentcomplete-buttons button {\r\n    width: 80px;\r\n}\r\n.editor-percentcomplete-slider {\r\n    float: left;\r\n}\r\n.editor-percentcomplete-picker:hover .editor-percentcomplete-helper {\r\n    display: block;\r\n}\r\n.editor-percentcomplete-helper:hover {\r\n    display: block;\r\n}\r\n.statsgrid select.editor-yesno {\r\n    margin: 0;\r\n    vertical-align: middle;\r\n    width: 100%;\r\n}\r\n.statsgrid input.editor-checkbox {\r\n    border: 0 none;\r\n    height: 100%;\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n.hidden {\r\n    display: none;\r\n}\r\n\r\n.statsgrid .slick-viewport {\r\n    background: url('/Oskari/libraries/slickgrid/css/smoothness/images/ui-bg_custom_oskari_zebra_1x50.png') repeat repeat;\r\n}/*\r\nIMPORTANT:\r\nIn order to preserve the uniform grid appearance, all cell styles need to have padding, margin and border sizes.\r\nNo built-in (selected, editable, highlight, flashing, invalid, loading, :focus) or user-specified CSS\r\nclasses should alter those!\r\n*/\r\n\r\n.slick-header-columns {\r\n/* Oskari change,  background: url('/Oskari/libraries/slickgrid/css/images/header-columns-bg.gif') repeat-x center bottom;\r\n  border-bottom: 1px solid silver; */\r\n  border-bottom: 2px solid black;\r\n}\r\n\r\n.slick-header-column {\r\n/* Oskari change,  background: url('/Oskari/libraries/slickgrid/css/images/header-columns-bg.gif') repeat-x center bottom; */\r\n  border-right: 1px solid silver;\r\n/*\r\n  Oskari change:\r\n  border-top: 40px solid transparent;\r\n*/\r\n  padding-top: 40px !important;\r\n}\r\n\r\n/* Oskari change,\r\n.slick-header-column:hover, .slick-header-column-active {\r\n  background: white url('/Oskari/libraries/slickgrid/css/images/header-columns-over-bg.gif') repeat-x center bottom;\r\n}\r\n*/\r\n\r\n.slick-headerrow {\r\n  background: #fafafa;\r\n}\r\n\r\n.slick-headerrow-column {\r\n  background: #fafafa;\r\n  border-bottom: 0;\r\n  height: 100%;\r\n}\r\n\r\n.slick-row.ui-state-active {\r\n  background: #F5F7D7;\r\n}\r\n\r\n.slick-row {\r\n  position: absolute;\r\n  background: white;\r\n  border: 0px;\r\n  line-height: 20px;\r\n}\r\n\r\n.slick-row.selected {\r\n  z-index: 10;\r\n  background: #DFE8F6;\r\n}\r\n\r\n.slick-cell {\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n.slick-group {\r\n/* Oskari change,  border-bottom: 2px solid silver; */\r\nborder-bottom: 2px solid red;\r\n}\r\n\r\n.slick-group-toggle {\r\n  width: 9px;\r\n  height: 9px;\r\n  margin-right: 5px;\r\n}\r\n\r\n.slick-group-toggle.expanded {\r\n  background: url('/Oskari/libraries/slickgrid/css/images/collapse.gif') no-repeat center center;\r\n}\r\n\r\n.slick-group-toggle.collapsed {\r\n  background: url('/Oskari/libraries/slickgrid/css/images/expand.gif') no-repeat center center;\r\n}\r\n\r\n.slick-group-totals {\r\n  color: gray;\r\n  background: white;\r\n}\r\n\r\n.slick-cell.selected {\r\n  background-color: #c0d0e0;\r\n}\r\n\r\n.slick-cell.active {\r\n  border-color: gray;\r\n  border-style: solid;\r\n}\r\n\r\n.slick-sortable-placeholder {\r\n  background: silver !important;\r\n}\r\n\r\n.slick-row.odd {\r\n  background: #fafafa;\r\n}\r\n\r\n.slick-row.ui-state-active {\r\n  background: #F5F7D7;\r\n}\r\n\r\n.slick-row.loading {\r\n  opacity: 0.5;\r\n  filter: alpha(opacity = 50);\r\n}\r\n\r\n.slick-cell.invalid {\r\n  border-color: red;\r\n}/* Menu button */\r\n.slick-header-menubutton {\r\n  position: absolute;\r\n  right: 3px;\r\n  bottom: 3px;\r\n  width: 16px;\r\n  height: 16px;\r\n  padding: 2px;\r\n  cursor: pointer;\r\n  display: inline-block;\r\n  background-color: #ddd;\r\n  border: 1px solid #a5a5a5;\r\n  border-radius: 15px;\r\n}\r\n\r\n.slick-header-column:hover > .slick-header-menubutton,\r\n.slick-header-column-active .slick-header-menubutton {\r\n  background-color: #cdcdcd;\r\n}\r\n\r\n.slick-header-column-sorted .slick-header-menubutton {\r\n  background-color: #ffffb2;\r\n}\r\n\r\n/* Menu */\r\n.slick-header-menu {\r\n  position: absolute;\r\n  display: inline-block;\r\n  margin: 0;\r\n  padding: 2px;\r\n  cursor: default;\r\n}\r\n\r\n\r\n/* Menu items */\r\n.slick-header-menuitem {\r\n  list-style: none;\r\n  margin: 0;\r\n  padding: 0;\r\n  cursor: pointer;\r\n}\r\n\r\n.slick-header-menuicon {\r\n  display: inline-block;\r\n  width: 16px;\r\n  height: 16px;\r\n  vertical-align: middle;\r\n  margin-right: 4px;\r\n  background-repeat: no-repeat;\r\n  background-position: center center;\r\n}\r\n\r\n.slick-header-menucontent {\r\n  display: inline-block;\r\n  vertical-align: middle;\r\n}\r\n\r\n\r\n/* Disabled */\r\n.slick-header-menuitem-disabled {\r\n  color: silver;\r\n}\r\n\r\n.slick-column-name {\r\n  width: 100%;\r\n  overflow: hidden;\r\n  display: inline-block;\r\n  text-overflow: ellipsis;\r\n  padding-right: 20px;\r\n  box-sizing: border-box;  \r\n}\r\n.slick-column-name {\r\n  /**\r\n   * This makes all \"float:right\" elements after it that spill over to the next line\r\n   * display way below the lower boundary of the column thus hiding them.\r\n   */\r\n  display: inline-block;\r\n  float: left;\r\n  margin-bottom: 100px;\r\n}\r\n\r\n.slick-header-button {\r\n  display: inline-block;\r\n  float: right;\r\n  vertical-align: top;\r\n  margin: 1px;\r\n  /**\r\n  * This makes all \"float:right\" elements after it that spill over to the next line\r\n  * display way below the lower boundary of the column thus hiding them.\r\n  */\r\n  margin-bottom: 100px;\r\n  height: 15px;\r\n  width: 15px;\r\n  background-repeat: no-repeat;\r\n  background-position: center center;\r\n  cursor: pointer;\r\n}\r\n\r\n.slick-header-button-hidden {\r\n  width: 0;\r\n\r\n  -webkit-transition: 0.2s width;\r\n  -ms-transition: 0.2s width;\r\n  transition: 0.2s width;\r\n}\r\n\r\n.slick-header-column:hover > .slick-header-button {\r\n  /*width: 15px;*/\r\n}/* group Base */\r\n.chzn-container {\r\n  /* font-size: 13px; We'll set the font size ourselves thankyouverymuch */\r\n  position: relative;\r\n  display: inline-block;\r\n  zoom: 1;\r\n  *display: inline;\r\n}\r\n.chzn-container .chzn-drop {\r\n  background: #fff;\r\n  border: 1px solid #aaa;\r\n  border-top: 0;\r\n  position: absolute;\r\n  top: 29px;\r\n  left: 0;\r\n  -webkit-box-shadow: 0 4px 5px rgba(0,0,0,.15);\r\n  -moz-box-shadow   : 0 4px 5px rgba(0,0,0,.15);\r\n  box-shadow        : 0 4px 5px rgba(0,0,0,.15);\r\n  z-index: 1010;\r\n}\r\n/* @end */\r\n\r\n/* @group Single Chosen */\r\n.chzn-container-single .chzn-single {\r\n  background-color: #ffffff;\r\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#eeeeee', GradientType=0 );   \r\n  background-image: -webkit-gradient(linear, 0 0, 0 100%, color-stop(20%, #ffffff), color-stop(50%, #f6f6f6), color-stop(52%, #eeeeee), color-stop(100%, #f4f4f4));\r\n  background-image: -webkit-linear-gradient(top, #ffffff 20%, #f6f6f6 50%, #eeeeee 52%, #f4f4f4 100%);\r\n  background-image: -moz-linear-gradient(top, #ffffff 20%, #f6f6f6 50%, #eeeeee 52%, #f4f4f4 100%);\r\n  background-image: -o-linear-gradient(top, #ffffff 20%, #f6f6f6 50%, #eeeeee 52%, #f4f4f4 100%);\r\n  background-image: linear-gradient(#ffffff 20%, #f6f6f6 50%, #eeeeee 52%, #f4f4f4 100%); \r\n  -webkit-border-radius: 5px;\r\n  -moz-border-radius   : 5px;\r\n  border-radius        : 5px;\r\n  -moz-background-clip   : padding;\r\n  -webkit-background-clip: padding-box;\r\n  background-clip        : padding-box;\r\n  border: 1px solid #aaaaaa;\r\n  -webkit-box-shadow: 0 0 3px #ffffff inset, 0 1px 1px rgba(0,0,0,0.1);\r\n  -moz-box-shadow   : 0 0 3px #ffffff inset, 0 1px 1px rgba(0,0,0,0.1);\r\n  box-shadow        : 0 0 3px #ffffff inset, 0 1px 1px rgba(0,0,0,0.1);\r\n  display: block;\r\n  overflow: hidden;\r\n  white-space: nowrap;\r\n  position: relative;\r\n  height: 23px;\r\n  line-height: 24px;\r\n  padding: 0 0 0 8px;\r\n  color: #444444;\r\n  text-decoration: none;\r\n}\r\n.chzn-container-single .chzn-default {\r\n  color: #666;\r\n}\r\n.chzn-container-single .chzn-single span {\r\n  margin-right: 26px;\r\n  display: block;\r\n  overflow: hidden;\r\n  white-space: nowrap;\r\n  -o-text-overflow: ellipsis;\r\n  -ms-text-overflow: ellipsis;\r\n  text-overflow: ellipsis;\r\n}\r\n.chzn-container-single .chzn-single abbr {\r\n  display: block;\r\n  position: absolute;\r\n  right: 26px;\r\n  top: 6px;\r\n  width: 12px;\r\n  height: 12px;\r\n  font-size: 1px;\r\n  background: url('libraries/chosen/chosen-sprite.png') -42px 1px no-repeat;\r\n}\r\n.chzn-container-single .chzn-single abbr:hover {\r\n  background-position: -42px -10px;\r\n}\r\n.chzn-container-single.chzn-disabled .chzn-single abbr:hover {\r\n  background-position: -42px -10px;\r\n}\r\n.chzn-container-single .chzn-single div {\r\n  position: absolute;\r\n  right: 0;\r\n  top: 0;\r\n  display: block;\r\n  height: 100%;\r\n  width: 18px;\r\n}\r\n.chzn-container-single .chzn-single div b {\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat 0px 2px;\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.chzn-container-single .chzn-search {\r\n  padding: 3px 4px;\r\n  position: relative;\r\n  margin: 0;\r\n  white-space: nowrap;\r\n  z-index: 1010;\r\n}\r\n.chzn-container-single .chzn-search input {\r\n  background: #fff url('libraries/chosen/chosen-sprite.png') no-repeat 100% -20px;\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat 100% -20px, -webkit-gradient(linear, 0 0, 0 100%, color-stop(1%, #eeeeee), color-stop(15%, #ffffff));\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat 100% -20px, -webkit-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat 100% -20px, -moz-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat 100% -20px, -o-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat 100% -20px, linear-gradient(#eeeeee 1%, #ffffff 15%);\r\n  margin: 1px 0;\r\n  padding: 4px 20px 4px 5px;\r\n  outline: 0;\r\n  border: 1px solid #aaa;\r\n  font-family: sans-serif;\r\n  font-size: 1em;\r\n}\r\n.chzn-container-single .chzn-drop {\r\n  -webkit-border-radius: 0 0 4px 4px;\r\n  -moz-border-radius   : 0 0 4px 4px;\r\n  border-radius        : 0 0 4px 4px;\r\n  -moz-background-clip   : padding;\r\n  -webkit-background-clip: padding-box;\r\n  background-clip        : padding-box;\r\n  margin-top: 0px;\r\n  border-top: 1px solid #ccc;\r\n  border-top-right-radius: 4px;\r\n}\r\n/* @end */\r\n\r\n.chzn-container-single-nosearch .chzn-search input {\r\n  position: absolute;\r\n  left: -9000px;\r\n}\r\n\r\n/* @group Multi Chosen */\r\n.chzn-container-multi .chzn-choices {\r\n  background-color: #fff;\r\n  background-image: -webkit-gradient(linear, 0 0, 0 100%, color-stop(1%, #eeeeee), color-stop(15%, #ffffff));\r\n  background-image: -webkit-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background-image: -moz-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background-image: -o-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background-image: linear-gradient(#eeeeee 1%, #ffffff 15%);\r\n  border: 1px solid #aaa;\r\n  margin: 0;\r\n  padding: 0;\r\n  cursor: text;\r\n  overflow: hidden;\r\n  height: auto !important;\r\n  height: 1%;\r\n  position: relative;\r\n}\r\n.chzn-container-multi .chzn-choices li {\r\n  float: left;\r\n  list-style: none;\r\n}\r\n.chzn-container-multi .chzn-choices .search-field {\r\n  white-space: nowrap;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n.chzn-container-multi .chzn-choices .search-field input {\r\n  color: #666;\r\n  background: transparent !important;\r\n  border: 0 !important;\r\n  font-family: sans-serif;\r\n  font-size: 100%;\r\n  height: 15px;\r\n  padding: 5px;\r\n  margin: 1px 0;\r\n  outline: 0;\r\n  -webkit-box-shadow: none;\r\n  -moz-box-shadow   : none;\r\n  box-shadow        : none;\r\n}\r\n.chzn-container-multi .chzn-choices .search-field .default {\r\n  color: #999;\r\n}\r\n.chzn-container-multi .chzn-choices .search-choice {\r\n  -webkit-border-radius: 3px;\r\n  -moz-border-radius   : 3px;\r\n  border-radius        : 3px;\r\n  -moz-background-clip   : padding;\r\n  -webkit-background-clip: padding-box;\r\n  background-clip        : padding-box;\r\n  background-color: #e4e4e4;\r\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f4f4f4', endColorstr='#eeeeee', GradientType=0 ); \r\n  background-image: -webkit-gradient(linear, 0 0, 0 100%, color-stop(20%, #f4f4f4), color-stop(50%, #f0f0f0), color-stop(52%, #e8e8e8), color-stop(100%, #eeeeee));\r\n  background-image: -webkit-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: -moz-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: -o-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: linear-gradient(#f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%); \r\n  -webkit-box-shadow: 0 0 2px #ffffff inset, 0 1px 0 rgba(0,0,0,0.05);\r\n  -moz-box-shadow   : 0 0 2px #ffffff inset, 0 1px 0 rgba(0,0,0,0.05);\r\n  box-shadow        : 0 0 2px #ffffff inset, 0 1px 0 rgba(0,0,0,0.05);\r\n  color: #333;\r\n  border: 1px solid #aaaaaa;\r\n  line-height: 13px;\r\n  padding: 3px 20px 3px 5px;\r\n  margin: 3px 0 3px 5px;\r\n  position: relative;\r\n  cursor: default;\r\n}\r\n.chzn-container-multi .chzn-choices .search-choice.search-choice-disabled {\r\n  background-color: #e4e4e4;\r\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f4f4f4', endColorstr='#eeeeee', GradientType=0 );\r\n  background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(20%, #f4f4f4), color-stop(50%, #f0f0f0), color-stop(52%, #e8e8e8), color-stop(100%, #eeeeee));\r\n  background-image: -webkit-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: -moz-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: -o-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: -ms-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  background-image: linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\r\n  color: #666;\r\n  border: 1px solid #cccccc;\r\n  padding-right: 5px;\r\n}\r\n.chzn-container-multi .chzn-choices .search-choice-focus {\r\n  background: #d4d4d4;\r\n}\r\n.chzn-container-multi .chzn-choices .search-choice .search-choice-close {\r\n  display: block;\r\n  position: absolute;\r\n  right: 3px;\r\n  top: 4px;\r\n  width: 12px;\r\n  height: 12px;\r\n  font-size: 1px;\r\n  background: url('libraries/chosen/chosen-sprite.png') -42px 1px no-repeat;\r\n}\r\n.chzn-container-multi .chzn-choices .search-choice .search-choice-close:hover {\r\n  background-position: -42px -10px;\r\n}\r\n.chzn-container-multi .chzn-choices .search-choice-focus .search-choice-close {\r\n  background-position: -42px -10px;\r\n}\r\n/* @end */\r\n\r\n/* @group Results */\r\n.chzn-container .chzn-results {\r\n  margin: 0 4px 4px 0;\r\n  max-height: 240px;\r\n  padding: 0 0 0 4px;\r\n  position: relative;\r\n  overflow-x: hidden;\r\n  overflow-y: auto;\r\n  -webkit-overflow-scrolling: touch;\r\n}\r\n.chzn-container-multi .chzn-results {\r\n  margin: -1px 0 0;\r\n  padding: 0;\r\n}\r\n.chzn-container .chzn-results li {\r\n  display: none;\r\n  line-height: 15px;\r\n  padding: 5px 6px;\r\n  margin: 0;\r\n  list-style: none;\r\n}\r\n.chzn-container .chzn-results .active-result {\r\n  cursor: pointer;\r\n  display: list-item;\r\n}\r\n.chzn-container .chzn-results .highlighted {\r\n  background-color: #3875d7;\r\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3875d7', endColorstr='#2a62bc', GradientType=0 );  \r\n  background-image: -webkit-gradient(linear, 0 0, 0 100%, color-stop(20%, #3875d7), color-stop(90%, #2a62bc));\r\n  background-image: -webkit-linear-gradient(top, #3875d7 20%, #2a62bc 90%);\r\n  background-image: -moz-linear-gradient(top, #3875d7 20%, #2a62bc 90%);\r\n  background-image: -o-linear-gradient(top, #3875d7 20%, #2a62bc 90%);\r\n  background-image: linear-gradient(#3875d7 20%, #2a62bc 90%);\r\n  color: #fff;\r\n}\r\n.chzn-container .chzn-results li em {\r\n  background: #feffde;\r\n  font-style: normal;\r\n}\r\n.chzn-container .chzn-results .highlighted em {\r\n  background: transparent;\r\n}\r\n.chzn-container .chzn-results .no-results {\r\n  background: #f4f4f4;\r\n  display: list-item;\r\n}\r\n.chzn-container .chzn-results .group-result {\r\n  cursor: default;\r\n  color: #999;\r\n  font-weight: bold;\r\n}\r\n.chzn-container .chzn-results .group-option {\r\n  padding-left: 15px;\r\n}\r\n.chzn-container-multi .chzn-drop .result-selected {\r\n  display: none;\r\n}\r\n.chzn-container .chzn-results-scroll {\r\n  background: white;\r\n  margin: 0 4px;\r\n  position: absolute;\r\n  text-align: center;\r\n  width: 321px; /* This should by dynamic with js */\r\n  z-index: 1;\r\n}\r\n.chzn-container .chzn-results-scroll span {\r\n  display: inline-block;\r\n  height: 17px;\r\n  text-indent: -5000px;\r\n  width: 9px;\r\n}\r\n.chzn-container .chzn-results-scroll-down {\r\n  bottom: 0;\r\n}\r\n.chzn-container .chzn-results-scroll-down span {\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -4px -3px;\r\n}\r\n.chzn-container .chzn-results-scroll-up span {\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -22px -3px;\r\n}\r\n/* @end */\r\n\r\n/* @group Active  */\r\n.chzn-container-active .chzn-single {\r\n  -webkit-box-shadow: 0 0 5px rgba(0,0,0,.3);\r\n  -moz-box-shadow   : 0 0 5px rgba(0,0,0,.3);\r\n  box-shadow        : 0 0 5px rgba(0,0,0,.3);\r\n  border: 1px solid #5897fb;\r\n}\r\n.chzn-container-active .chzn-single-with-drop {\r\n  border: 1px solid #aaa;\r\n  -webkit-box-shadow: 0 1px 0 #fff inset;\r\n  -moz-box-shadow   : 0 1px 0 #fff inset;\r\n  box-shadow        : 0 1px 0 #fff inset;\r\n  background-color: #eee;\r\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#eeeeee', endColorstr='#ffffff', GradientType=0 );\r\n  background-image: -webkit-gradient(linear, 0 0, 0 100%, color-stop(20%, #eeeeee), color-stop(80%, #ffffff));\r\n  background-image: -webkit-linear-gradient(top, #eeeeee 20%, #ffffff 80%);\r\n  background-image: -moz-linear-gradient(top, #eeeeee 20%, #ffffff 80%);\r\n  background-image: -o-linear-gradient(top, #eeeeee 20%, #ffffff 80%);\r\n  background-image: linear-gradient(#eeeeee 20%, #ffffff 80%);\r\n  -webkit-border-bottom-left-radius : 0;\r\n  -webkit-border-bottom-right-radius: 0;\r\n  -moz-border-radius-bottomleft : 0;\r\n  -moz-border-radius-bottomright: 0;\r\n  border-bottom-left-radius : 0;\r\n  border-bottom-right-radius: 0;\r\n  border-bottom: 1px solid #fff;\r\n  z-index: 1012;\r\n}\r\n.chzn-container-active .chzn-single-with-drop div {\r\n  background: transparent;\r\n  border-left: none;\r\n}\r\n.chzn-container-active .chzn-single-with-drop div b {\r\n  background-position: -18px 2px;\r\n}\r\n.chzn-container-active .chzn-choices {\r\n  -webkit-box-shadow: 0 0 5px rgba(0,0,0,.3);\r\n  -moz-box-shadow   : 0 0 5px rgba(0,0,0,.3);\r\n  box-shadow        : 0 0 5px rgba(0,0,0,.3);\r\n  border: 1px solid #5897fb;\r\n}\r\n.chzn-container-active .chzn-choices .search-field input {\r\n  color: #111 !important;\r\n}\r\n/* @end */\r\n\r\n/* @group Disabled Support */\r\n.chzn-disabled {\r\n  cursor: default;\r\n  opacity:0.5 !important;\r\n}\r\n.chzn-disabled .chzn-single {\r\n  cursor: default;\r\n}\r\n.chzn-disabled .chzn-choices .search-choice .search-choice-close {\r\n  cursor: default;\r\n}\r\n\r\n/* @group Right to Left */\r\n.chzn-rtl { text-align: right; }\r\n.chzn-rtl .chzn-single { padding: 0 8px 0 0; overflow: visible; }\r\n.chzn-rtl .chzn-single span { margin-left: 26px; margin-right: 0; direction: rtl; }\r\n\r\n.chzn-rtl .chzn-single div { left: 3px; right: auto; }\r\n.chzn-rtl .chzn-single abbr {\r\n  left: 26px;\r\n  right: auto;\r\n}\r\n.chzn-rtl .chzn-choices .search-field input { direction: rtl; }\r\n.chzn-rtl .chzn-choices li { float: right; }\r\n.chzn-rtl .chzn-choices .search-choice { padding: 3px 5px 3px 19px; margin: 3px 5px 3px 0; }\r\n.chzn-rtl .chzn-choices .search-choice .search-choice-close { left: 4px; right: auto; }\r\n.chzn-rtl.chzn-container-single .chzn-results { margin: 0 0 4px 4px; padding: 0 4px 0 0; }\r\n.chzn-rtl .chzn-results .group-option { padding-left: 0; padding-right: 15px; }\r\n.chzn-rtl.chzn-container-active .chzn-single-with-drop div { border-right: none; }\r\n.chzn-rtl .chzn-search input {\r\n  background: #fff url('libraries/chosen/chosen-sprite.png') no-repeat -30px -20px;\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -30px -20px, -webkit-gradient(linear, 0 0, 0 100%, color-stop(1%, #eeeeee), color-stop(15%, #ffffff));\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -30px -20px, -webkit-linear-gradient(top, #eeeeee 1%, #ffffff 15%);  \r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -30px -20px, -moz-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -30px -20px, -o-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\r\n  background: url('libraries/chosen/chosen-sprite.png') no-repeat -30px -20px, linear-gradient(#eeeeee 1%, #ffffff 15%);\r\n  padding: 4px 5px 4px 20px;\r\n  direction: rtl;\r\n}\r\n.chzn-container-single.chzn-rtl .chzn-single div b {\r\n  background-position: 6px 2px;\r\n}\r\n.chzn-container-single.chzn-rtl .chzn-single-with-drop div b {\r\n  background-position: -12px 2px;\r\n}\r\n/* @end */\r\n\r\n/* @group Retina compatibility */\r\n@media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-resolution: 144dpi)  {\r\n  .chzn-rtl .chzn-search input, .chzn-container-single .chzn-single abbr, .chzn-container-single .chzn-single div b, .chzn-container-single .chzn-search input, .chzn-container-multi .chzn-choices .search-choice .search-choice-close, .chzn-container .chzn-results-scroll-down span, .chzn-container .chzn-results-scroll-up span {\r\n      background-image: url('libraries/chosen/chosen-sprite@2x.png') !important;\r\n      background-repeat: no-repeat !important;\r\n      background-size: 52px 37px !important;\r\n  }\r\n}\r\n/* @end */\r\n.metadataflyout {\n  /* Content */ }\n  .metadataflyout .tab-content div.browseGraphic {\n    margin-left: 2px; }\n  .metadataflyout .tab-content div h1 {\n    text-align: left;\n    text-transform: uppercase;\n    margin-bottom: 8px; }\n  .metadataflyout .tab-content div table {\n    margin-right: 0px;\n    margin-left: 0px;\n    /* We have to force font size back to normal as this isn't actual table content */\n    font-size: 14px;\n    line-height: 21px; }\n    .metadataflyout .tab-content div table tr td {\n      text-align: left;\n      display: block;\n      margin-top: 4px;\n      margin-left: 4px;\n      margin-bottom: 8px;\n      vertical-align: top;\n      border: 0; }\n      .metadataflyout .tab-content div table tr td.MD_DigitalTransferOptions a {\n        text-decoration: underline;\n        cursor: pointer;\n        max-width: 700px;\n        display: block;\n        word-wrap: break-word; }\n      .metadataflyout .tab-content div table tr td a {\n        text-decoration: underline;\n        cursor: pointer; }\n    .metadataflyout .tab-content div table tr th {\n      text-align: left;\n      display: block;\n      text-transform: uppercase;\n      vertical-align: top; }\n\n/* xml */\n.metadataflyout_content_xml {\n  margin: 0;\n  padding: 0; }\n\n.metadataflyout_content_section {\n  /* We have to force font size back to normal as this isn't actual table content */\n  font-size: 14px;\n  line-height: 21px;\n  text-align: left;\n  display: block;\n  margin-bottom: 12px; }\n.routesearch > div ul {\n  list-style-type: none;\n  margin-top: 6px; }\n  .routesearch > div ul li {\n    display: inline-block;\n    margin: 6px 2px;\n    /* Custom button colors */ }\n    .routesearch > div ul li a {\n      border: 1px solid #B7B7B7;\n      color: #FAFAFA;\n      text-shadow: 1px 1px 1px #3C3C3C; }\n      .routesearch > div ul li a.disabled {\n        background: none;\n        background-color: #E6E6E6;\n        color: #3C3C3C;\n        text-shadow: -1px -1px 1px #FFFFFF; }\n.routesearch > div .oskarifield {\n  margin-bottom: 12px; }\n  .routesearch > div .oskarifield label {\n    display: block;\n    clear: both; }\n    .routesearch > div .oskarifield label span {\n      display: block; }\n  .routesearch > div .oskarifield input {\n    margin-top: 6px; }\n    .routesearch > div .oskarifield input[type=text] {\n      margin-right: 12px;\n      width: 330px; }\n  .routesearch > div .oskarifield .icon-close {\n    margin-left: -20px; }\n.oskari-userguide {\n  width: 480px;\n  min-width: 320px;\n  min-height: 320px; }\n/* Mixins */\n@font-face {\n  font-family: \"Liberation Sans\";\n  src: url(\"/Oskari/resources/framework/bundle/printout/fonts/LiberationSans-Regular.ttf\"); }\n\n@font-face {\n  font-family: \"Liberation Sans\";\n  src: url(\"/Oskari/resources/framework/bundle/printout/fonts/LiberationSans-Bold.ttf\");\n  font-weight: bold; }\n\ndiv.notLoggedIn {\n  padding: 10px; }\n\ndiv.printout div.startview div.error ul li {\n  color: red; }\n\n#contentMap.mapPrintoutMode {\n  margin-left: 252px; }\n#contentMap div.basic_printout {\n  background: white;\n  position: absolute;\n  height: 100%;\n  top: 0;\n  left: 0;\n  z-index: 1500;\n  width: 255px; }\n#contentMap div.basic_publisher div.content {\n  padding: 10px; }\n\ndiv.printout div.startview div.icon-info, div.basic_printout div.icon-info {\n  float: right; }\n\ndiv.basic_printout div.form div.field input, div.field select {\n  width: 80%;\n  background-color: white; }\n\n.printout_radiolabel, .printout_checklabel {\n  padding: 3px 6px;\n  -webkit-border-radius: 2px;\n  -moz-border-radius: 2px;\n  -o-border-radius: 2px;\n  -ms-border-radius: 2px;\n  border-radius: 2px;\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding-box;\n  background-clip: padding-box; }\n  .printout_radiolabel:hover, .printout_checklabel:hover {\n    background-color: #eee; }\n\n.printout_format_label, .printout_title_label, .printout_legend_label {\n  font-weight: bold;\n  margin: 5px 0; }\n\n.printout_settings_cont {\n  margin: 10px 5px; }\n\n/* Buttons */\ndiv.basic_printout div.buttons, div.printout div.startview div.buttons {\n  margin: 10px;\n  text-align: center; }\n  div.basic_printout div.buttons input, div.printout div.startview div.buttons input {\n    margin-left: 10px;\n    margin-right: 10px; }\n\ndiv.basic_printout > div.header {\n  background-color: #FDF8D9;\n  padding: 5px 10px; }\n  div.basic_printout > div.header div.icon-close {\n    float: right; }\ndiv.basic_printout > div.content {\n  overflow: auto;\n  height: 89%; }\ndiv.basic_printout div.tool {\n  margin: 5px; }\ndiv.basic_printout div.tool input, div.basic_printout div.printout_settings_cont input {\n  margin-right: 10px; }\ndiv.basic_printout div.preview-portrait {\n  margin: 8px;\n  padding: 5px;\n  width: 200px;\n  height: 290px;\n  background-color: white;\n  border-bottom-color: #C0D0E0;\n  border-bottom-style: solid;\n  border-bottom-width: 1pt;\n  border-top-color: #C0D0E0;\n  border-top-style: solid;\n  border-top-width: 1pt;\n  -webkit-box-shadow: 0 0 8px #d0d0d0;\n  -moz-box-shadow: 0 0 8px #d0d0d0;\n  box-shadow: 0 0 8px #d0d0d0;\n  cursor: pointer; }\ndiv.basic_printout div.preview-landscape {\n  margin: 8px;\n  padding: 5px;\n  width: 200px;\n  height: 140px;\n  background-color: white;\n  border-bottom-color: #C0D0E0;\n  border-bottom-style: solid;\n  border-bottom-width: 1pt;\n  border-top-color: #C0D0E0;\n  border-top-style: solid;\n  border-top-width: 1pt;\n  -webkit-box-shadow: 0 0 8px #d0d0d0;\n  -moz-box-shadow: 0 0 8px #d0d0d0;\n  box-shadow: 0 0 8px #d0d0d0;\n  cursor: pointer; }\ndiv.basic_printout div.location {\n  height: 30px; }\ndiv.basic_printout div.previewNotes {\n  margin-left: 8px;\n  margin-right: 8px;\n  margin-bottom: 2px; }\n.featuredata {\n  /* Selected row hightlighting */\n  /* Override common table settings */\n  /* Override sort img position */ }\n  .featuredata div.tab-content {\n    max-height: 535px;\n    overflow: auto; }\n  .featuredata .link {\n    padding: 20px 0px 0px 0px;\n    color: #0091FF;\n    text-decoration: underline;\n    display: block; }\n  .featuredata tbody tr.selected {\n    background-color: #FDF8D9; }\n  .featuredata th, .featuredata td {\n    text-align: left;\n    padding-left: 2px;\n    padding-right: 15px; }\n  .featuredata th.asc, .featuredata th.desc {\n    background-position: right center; }\n\ndiv.flyout-resizer {\n  float: right;\n  cursor: nw-resize; }\n\ndiv.mapplugins .mappluginsContainer .mappluginsContent div.featuredataplugin.mapplugin {\n  display: block;\n  background: #FFF;\n  border: 1px solid;\n  margin: 10px auto; }\ndiv.metadataCatalogueDescription {\n  margin: 0;\n  margin-bottom: 8px; }\n\ndiv.metadataCatalogueContainer {\n  height: 90%; }\n\ndiv.metadataCatalogueContainer div.main {\n  width: 100%;\n  height: 100%; }\n\ndiv.metadataCatalogueContainer div.moreLess {\n  padding: 10px 0; }\n\ndiv.metadataOptions div.rowLabel {\n  display: table-cell;\n  vertical-align: middle;\n  margin-left: 0;\n  min-width: 130px;\n  width: 130px; }\n\ndiv.metadataOptions div.checkboxes {\n  display: table-cell;\n  vertical-align: middle;\n  margin-left: 130px;\n  width: auto; }\n\ndiv.metadataOptions div.metadataType {\n  display: table-cell;\n  vertical-align: middle;\n  padding-right: 10px;\n  width: auto;\n  white-space: nowrap; }\n\ndiv.metadataOptions div.metadataRow {\n  margin-bottom: 10px; }\n\ndiv.metadataOptions div.rowLabel {\n  white-space: nowrap; }\n\ndiv.metadataResultHeader {\n  display: table;\n  width: 100%;\n  height: 35px; }\n\ndiv.metadataResultHeader div.resultHeaderContainer {\n  display: table-row; }\n\ndiv.metadataResultHeader div.resultTitle {\n  float: left;\n  text-align: left; }\n\ndiv.metadataResultHeader div.resultLinks {\n  float: right;\n  text-align: right; }\n\ndiv.metadataResultHeader div.panelHeader {\n  margin-top: 10px;\n  margin-bottom: 20px; }\n\ndiv.metadataCatalogueContainer th.name, td.name {\n  text-align: left; }\n\ndiv.metadataCatalogueContainer td.name {\n  padding-left: 8px; }\n\ndiv.metadataCatalogueContainer th.rating, td.rating {\n  text-align: right; }\n\ndiv.metadataCatalogueContainer th.info, td.info {\n  text-align: right;\n  width: 16px; }\n\ndiv.metadataCatalogueContainer th.remove, td.remove {\n  text-align: right;\n  width: 16px; }\n\ndiv.metadataCatalogueContainer td.info div.layerInfo {\n  width: 16px;\n  height: 16px;\n  margin-left: 5px;\n  float: right; }\n\ndiv.metadataCatalogueContainer td.remove div.resultRemove {\n  width: 16px;\n  height: 16px;\n  margin-left: 5px;\n  margin-right: 5px;\n  float: right; }\n\ndiv.metadataCatalogueContainer tr.resultRow {\n  padding-left: 10px;\n  outline: 1pt solid #c0d0e0; }\n\ndiv.metadataCatalogueContainer tr.spacerRow {\n  height: 7px; }\n\ndiv.metadataCatalogueContainer td {\n  border: none; }\n\ndiv.metadataCatalogueContainer td.spacer {\n  padding: 0; }\n\ndiv.metadataCatalogueContainer table.metadataSearchResult {\n  float: left; }\n\ndiv.metadataCatalogueContainer ul.layerList {\n  padding-left: 35px; }\n\ndiv.metadataCatalogueContainer a.showLink {\n  display: inline-block;\n  margin-left: 15px; }\n\ndiv.metadataCatalogueContainer a.modifyLink {\n  display: inline-block;\n  margin-left: 15px; }\n")
}),requirejs.s.contexts._.nextTick=requirejs.nextTick;