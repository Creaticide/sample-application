<html>
    <head>
        <title>Test RPC</title>
        <script src="../../libraries/JSChannel/jschannel.js"></script>
    </head>
    <body>
        <!--<iframe id="Oskari" src="http://dev.paikkatietoikkuna.fi/published/fi/6043" style="border: none; width: 700px; height: 525px;"></iframe>-->
        <iframe id="Oskari" src="http://hk-pc-112w764.mmlnet.nls.fi:8080/web/fi/kartta?p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=0&p_p_state=exclusive&published=true&viewId=6493" style="border: none; width: 700px; height: 525px;"></iframe>
        <script>
            var chan = Channel.build({
                window: document.getElementById("Oskari").contentWindow,
                origin: "*",
                //origin: "http://hk-pc-112w764.mmlnet.nls.fi:8080",
                scope: "Oskari",
                onReady: function () {
                    console.log("Channel ready");
                }
            });
            // Get current map position
            chan.call({
                method: "getMapPosition",
                success: function (data) {
                    console.log(JSON.stringify(data));
                }
            });
            // Bind AfterMapMoveEvent so we react to receiving it
            chan.bind(
                "AfterMapMoveEvent",
                function (trans, data) {
                    console.log(JSON.stringify(data));
                }
            );
            // Listen to AfterMapMoveEvent
            chan.call({
                method: "handleEvent",
                params: ["AfterMapMoveEvent", true],
                success: function(data) {
                    console.log("AfterMapMoveEvent", JSON.stringify(data));
                },
                error: function (data) {
                    console.log("error", data);
                }
            });

            // Bind MapClickedEvent so we react to receiving it
            chan.bind(
                "MapClickedEvent",
                function (trans, data) {
                    console.log(JSON.stringify(data));
                }
            );
            // Listen to MapClickedEvent
            chan.call({
                method: "handleEvent",
                params: ["MapClickedEvent", true],
                success: function(data) {
                    console.log("MapClickedEvent", JSON.stringify(data));
                },
                error: function (data) {
                    console.log("error", data);
                }
            });

            chan.call({
                method: "postRequest",
                params: ["MapMoveRequest", [354490.70442968, 6770658.0402485, 8, false, "EPSG:3067"]]
            });
        </script>
    </body>
</html>