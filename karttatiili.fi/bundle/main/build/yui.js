/* This is a packed Oskari bundle (bundle script version Tue Mar 20 2012 12:55:23 GMT+0200 (Suomen normaaliaika)) */ 
Oskari.clazz.define("Oskari.karttatiili.bundle.MainBundleInstance",function(){this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.wmtsService=null},{getMapModule:function(){return this.mapmodule},getSandbox:function(){return this.sandbox},getWMTSService:function(){return this.wmtsService},createModulesAndUi:function(j){var k=false;var h=true;var c=true;var d=true;var b=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",k,h,c,d);b.createMap=function(){var i=this._sandbox;var l=new OpenLayers.LonLat(i.getMap().getX(),i.getMap().getY());this._map=new OpenLayers.Map({projection:this._projectionCode,center:l,zoom:i.getMap().getZoom(),units:"m",controls:[new OpenLayers.Control()],resolutions:[2000,1000,500,200,100,50,20,10,4,2,1,0.5,0.25],maxExtent:new OpenLayers.Bounds(0,0,10000000,10000000),theme:null});return this._map};this.mapmodule=b;var a=j.register(b);var e=[];e.push("Oskari.mapframework.mapmodule.LayersPlugin");e.push("Oskari.mapframework.mapmodule.WmsLayerPlugin");e.push("Oskari.mapframework.mapmodule.ControlsPlugin");e.push("Oskari.mapframework.mapmodule.VectorLayerPlugin");e.push("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin");for(var f=0;f<e.length;f++){var g=Oskari.clazz.create(e[f]);b.registerPlugin(g)}a.addControl(new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:true}}));a.render("mapdiv");this.map=a},enhance:function(){var t=this;var b=t.getSandbox();b.printDebug("Checking if map is started with link...");var n=b.getRequestParameter("coord");var m=b.getRequestParameter("zoomLevel");var g=b.getRequestParameter("mapLayers");var e=b.getRequestParameter("showMarker");var j=b.getRequestParameter("keepLayersOrder");if(j===null){j=true}b.getMap().setMarkerVisible(e=="true");if(n===null||m===null){return}var o;if(n.indexOf("_")>=0){o=n.split("_")}else{o=n.split("%20")}var h=o[0];var l=o[1];if(h===null||l===null){b.printDebug("Could not parse link location. Skipping.");return}b.getMap().moveTo(h,l,m);b.request(t.getMapModule(),b.getRequestBuilder("MapMoveRequest")(h,l,m,false));b.printDebug("This is startup by link, moving map...");if(g!==null&&g!==""){b.printDebug("Continuing by adding layers...");var a=g.split(",");for(var q=0;q<a.length;q++){var f=a[q].split("+");var d=f[0];var c=f[1];var s=f[2];if(d!==null){var p=null;var k=null;p=b.getRequestBuilder("AddMapLayerRequest");k=p(d,j);b.request(t.getMapModule(),k);p=b.getRequestBuilder("ChangeMapLayerOpacityRequest");k=p(d,c);b.request(t.getMapModule(),k);p=b.getRequestBuilder("ChangeMapLayerStyleRequest");k=p(d,s);b.request(t.getMapModule(),k)}else{b.printWarn("[StartMapWithLinkEnhancement] Could not find baselayer for "+d)}}}},start:function(){var k=this;var f=Oskari.clazz.create("Oskari.karttatiili.bundle.layers.KarttatiiliFiLayerConfig");this.layers=f;var i=f.create();var h=i;Oskari.$("startup",i);var d="fi";var l=[];var n=[];var a=k;var c=Oskari.clazz.create("Oskari.mapframework.core.Core");this.core=c;var m=c.getSandbox();this.sandbox=m;var g=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService","",m);l.push(Oskari.clazz.create("Oskari.mapframework.service.LanguageService",d));l.push(g);var e=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",g);this.wmtsService=e;g.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var j=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");g.registerLayerModelBuilder("wmtslayer",j);c.init(a,l,n,i.layers,d,null,false);var b=m.getMap()},update:function(){},stop:function(){alert("Stopped!")}},{protocol:["Oskari.bundle.BundleInstance"]});Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement",function(){},{enhance:function(u){u.printDebug("Checking if map is started with link...");var o=u.getRequestParameter("coord");var n=u.getRequestParameter("zoomLevel");var h=u.getRequestParameter("mapLayers");var f=u.getRequestParameter("showMarker");var k=u.getRequestParameter("keepLayersOrder");if(k===null){k=true}u.getMap().setMarkerVisible(f=="true");
if(o===null||n===null){return}var p;if(o.indexOf("_")>=0){p=o.split("_")}else{p=o.split("%20")}var j=p[0];var m=p[1];if(j===null||m===null){u.printDebug("Could not parse link location. Skipping.");return}u.getMap().moveTo(j,m,n);u.printDebug("This is startup by link, moving map...");if(h!==null&&h!==""){u.printDebug("Continuing by adding layers...");var a=h.split(",");for(var s=0;s<a.length;s++){var g=a[s].split("+");var e=g[0];var b=g[1];var t=g[2];if((e.indexOf("_")!=-1)&&(e.indexOf("base_")==-1)&&(e.indexOf("BASE_")==-1)){var v=e.split("_");e=null;var c=null;for(var d in v){if(d){c=u.findBaselayerBySublayerIdFromAllAvailable(v[d]);if(c){e=c.getId();break}}}}if(e!==null){var q=null;var l=null;q=u.getRequestBuilder("AddMapLayerRequest");l=q(e,k);u.processRequest(l);q=u.getRequestBuilder("ChangeMapLayerOpacityRequest");l=q(e,b);u.processRequest(l);q=u.getRequestBuilder("ChangeMapLayerStyleRequest");l=q(e,t);u.processRequest(l)}else{u.printWarn("[StartMapWithLinkEnhancement] Could not find baselayer for "+e)}}}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});